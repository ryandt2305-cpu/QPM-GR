// ==UserScript==
// @name         QPM (ALPHA)
// @namespace    Quinoa
// @version      1.10.0
// @description  Quality-of-life enhancements for Magic Garden: crop type locking, mutation tracking, value calculator, harvest reminders, journal species checker, and persistent feed statistics.
// @author       TOKYO.#6464
// @match        https://1227719606223765687.discordsays.com/*
// @match        https://magiccircle.gg/r/*
// @match        https://magicgarden.gg/r/*
// @match        https://starweaver.org/r/*
// @updateURL    https://raw.githubusercontent.com/ryandt2305-cpu/QPM-GR/main/dist/QPM.user.js
// @downloadURL  https://raw.githubusercontent.com/ryandt2305-cpu/QPM-GR/main/dist/QPM.user.js
// @run-at       document-start
// @inject-into  page
// @grant        GM_registerMenuCommand
// @grant        GM_setValue
// @grant        GM_getValue
// @grant        GM_xmlhttpRequest
// @grant        unsafeWindow
// ==/UserScript==

(function() {
'use strict';

!function(){"use strict";const e=e=>new Promise(t=>setTimeout(t,e)),t=new Promise(e=>{"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>e(),{once:!0}):e()});function n(e){const t=document.createElement("style");return t.textContent=e,document.head.appendChild(t),t}function o(e,t,{root:n=document,callForExisting:o=!0}={}){const r=n=>{for(const o of n){if(o.nodeType!==Node.ELEMENT_NODE)continue;const n=o;if(("string"==typeof e?n.matches(e):e(n))&&t(n),"string"==typeof e){n.querySelectorAll(e).forEach(t)}else{Array.from(n.querySelectorAll("*")).filter(e).forEach(t)}}};if(o){("string"==typeof e?Array.from(n.querySelectorAll(e)):Array.from(n.querySelectorAll("*")).filter(e)).forEach(t)}const a=new MutationObserver(e=>{for(const t of e)r(t.addedNodes)});return a.observe(n,{childList:!0,subtree:!0}),{disconnect:()=>a.disconnect()}}function r(e){if(!e)return!1;const t=e.getBoundingClientRect();if(t.width<=0||t.height<=0)return!1;const n=getComputedStyle(e);return"hidden"!==n.visibility&&"none"!==n.display&&parseFloat(n.opacity||"1")>0}const a=["#App .QuinoaUI","#App [data-tm-main-interface]","#App [data-tm-hud-root]","#App [data-mc-app-shell]","#App > div.McFlex.css-neeqas","#App > div.McFlex.css-1k630i1","#App > div.McFlex"];function i(){for(const n of a){const e=document.querySelector(n);if(e instanceof HTMLElement)return e}const e=document.getElementById("App");if(!e)return null;const t=e.querySelector("div.McFlex");return t instanceof HTMLElement?t:e instanceof HTMLElement?e:null}const s=function(e,t=!0){const n=(...t)=>{n.enabled&&console.log(`[${e}]`,...t)};return n.enabled=t,n}("QuinoaPetMgr");function l(e){if(!e)return"‚Äî";const t=Math.max(1,Math.floor((Date.now()-e)/1e3));if(t<60)return`${t}s ago`;const n=Math.floor(t/60);if(n<60)return`${n}m ago`;const o=Math.floor(n/60);if(o<24)return`${o}h ago`;return`${Math.floor(o/24)}d ago`}function c(e){return e.toLowerCase().replace(/[''`]/g,"").replace(/\s+/g,"").replace(/-/g,"").replace(/(seed|plant|baby|fruit|crop)$/i,"")}function d(e,t=120){let n;return(...o)=>{clearTimeout(n),n=setTimeout(()=>e(...o),t)}}const u={carrot:3,strawberry:2,aloe:2.5,delphinium:3,blueberry:2,apple:2,appletree:2,orangetulip:3,tulip:3,tomato:2,daffodil:3,corn:2,cornkernel:2,watermelon:3,pumpkin:3,echeveria:2.75,echeveriacutting:2.75,coconut:3,coconuttree:3,banana:1.7,lily:2.75,squash:2.5,burrostail:2.5,burrostailcutting:2.5,mushroom:3.5,mushroomspore:3.5,cactus:1.8,bamboo:2,bambooshoot:2,grape:2,pepper:2,lemon:3,lemontree:3,passion:2,passionfruit:2,dragon:2,dragonfruit:2,lychee:2,lycheepit:2,sunflower:2.5,starweaver:2,starweaverpod:2,dawncelestial:2.5,dawnbinderpod:2.5,dawnbinder:2.5,dawnbinderbulb:2.5,mooncelestial:2,moonbinderpod:2,moonbinder:2,moonbinderbulb:2};function p(e){const t=u[e];return"number"==typeof t&&Number.isFinite(t)?t:null}const m={get(e,t=null){try{if("function"==typeof GM_getValue){const n=GM_getValue(e);if(null==n)return t;try{return JSON.parse(n)}catch{return n}}}catch{}try{const n=localStorage.getItem(e);return null==n?t:JSON.parse(n)}catch{return t}},set(e,t){try{if("function"==typeof GM_setValue)return void GM_setValue(e,JSON.stringify(t))}catch{}try{localStorage.setItem(e,JSON.stringify(t))}catch{}}},f=window,g="undefined"!=typeof unsafeWindow&&unsafeWindow?unsafeWindow:f,h=g,b=g!==f;function y(e,t){try{g[e]=t}catch{}if(b)try{f[e]=t}catch{}}function x(e){if(b){const t=f[e];if(void 0!==t)return t}return g[e]}const w="__qpmJotaiStore__",v="__qpmJotaiAtomCache__";let C=null,T=!1;const S=e=>new Promise(t=>setTimeout(t,e));function k(e){return!!e&&"function"==typeof e.get&&"function"==typeof e.values}function A(){const e=x(v);if(e&&k(e))return e;const t=h.jotaiAtomCache,n=t&&"cache"in t?t.cache:t;return k(n)?(y(v,n),n):void 0}async function P(e=5e3){const t=await async function(e=5e3){const t=Date.now();let n=A();for(;!n&&Date.now()-t<e;)await S(50),n=A();return n}(e);if(!t)throw new Error("jotaiAtomCache.cache not available");let n=null,o=null;const r=[],a=()=>{for(const e of r)try{e.__origWrite&&(e.write=e.__origWrite,delete e.__origWrite)}catch{}};for(const i of t.values()){if(!i||"function"!=typeof i.write)continue;const e=i;if(e.__origWrite)continue;const t=e.write.bind(e);e.__origWrite=e.write,e.write=function(e,r,...i){return o||(n=e,o=r,a()),t(e,r,...i)},r.push(e)}try{const t=Date.now()+e;for(;!o&&Date.now()<t;)await S(50)}finally{a()}return o&&n?{get:e=>n(e),async set(e,t){await o(e,t)},sub(e,t){let o;const r=setInterval(()=>{try{const r=n(e);r!==o&&(o=r,t())}catch{}},100);return()=>clearInterval(r)}}:(s("‚ö†Ô∏è Unable to capture Jotai store via write hook, using polyfill"),{get(){throw new Error("Jotai store unavailable (polyfill)")},set(){throw new Error("Jotai store unavailable (polyfill)")},sub:()=>()=>{},__polyfill:!0})}async function M(){if(C&&!C.__polyfill)return C;const e=x(w);if(e&&(!e.__polyfill||!C)&&(C=e,!C.__polyfill))return C;if(T){const e=6e3,t=Date.now();for(;T&&Date.now()-t<e;)await S(50);if(C&&!C.__polyfill)return C}T=!0;try{const e=function(){const e=h.__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!e?.renderers?.size)return null;for(const[t]of e.renderers){const n=e.getFiberRoots?.(t);if(n)for(const e of n){const t=new Set,n=[],o=e.current??e;for(o&&n.push(o);n.length;){const e=n.pop();if(!e||t.has(e))continue;t.add(e);const o=e.pendingProps?.value;if(o&&"object"==typeof o&&"function"==typeof o.get&&"function"==typeof o.set&&"function"==typeof o.sub)return o;e.child&&n.push(e.child),e.sibling&&n.push(e.sibling),e.alternate&&n.push(e.alternate)}}}return null}();if(e)return C=e,y(w,C),C;const t=await P();return C=t,y(w,C),C}catch(t){throw t}finally{T=!1}}function E(e){const t=A();if(!t)return[];const n=[];for(const o of t.values()){if(!o)continue;const t=String(o.debugLabel??o.label??"");e.test(t)&&n.push(o)}return n}function $(e){const t=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return E(new RegExp(`^${t}$`))[0]??null}async function F(e){return(await M()).get(e)}async function I(e,t){const n=await M();let o=!1;const r=()=>{if(!o)try{const o=n.get(e);t(o)}catch(r){s("‚ö†Ô∏è Failed reading atom value during subscription",r)}};let a;try{const t=n.sub(e,r);a="function"==typeof t?t:await t}catch(i){s("‚ö†Ô∏è Failed subscribing to atom",i),a=void 0}return r(),()=>{o=!0;try{a?.()}catch{}}}const q=Object.freeze(Object.defineProperty({__proto__:null,ensureJotaiStore:M,findAtomsByLabel:E,getAtomByLabel:$,readAtomValue:F,subscribeAtom:I},Symbol.toStringTag,{value:"Module"})),N="userSlotsAtom";let z=!1,R=!1,L=!1;function D(e){if(!Array.isArray(e)||0===e.length)return null;const t=e.find(e=>e&&"object"==typeof e);if(!t)return null;return"itemType"in t||"species"in t||"slots"in t||"plant"in t||"item"in t?e:null}function B(e,t,n){if(!e||0===e.length)return null;const o=n&&"object"==typeof n?(r=n.favoritedItemIds,Array.isArray(r)?r.filter(e=>"string"==typeof e):[]):[];var r;const a=e.some(e=>function(e){if(!e||"object"!=typeof e)return[];const t=[e.slots,e.plant?.slots,e.item?.slots,e.data?.slots,e.slots?.slots,e.growSlots];for(const n of t)if(Array.isArray(n)&&n.length>0)return n;return[]}(e).length>0);return{items:e,favoritedItemIds:o,source:t,hasSlotData:a}}function H(e,t){const n=B(D(e),t,e);if(n)return n;if(!e||"object"!=typeof e)return null;const o=e;if("inventory"in o){const e=o.inventory,n=B(D(e?.items??e),`${t}.inventory`,e);if(n)return n}if("data"in o){const e=o.data;if(e&&"inventory"in e){const n=e.inventory,o=B(D(n?.items??n),`${t}.data.inventory`,n);if(o)return o}}return null}async function j(){try{await M(),z=!1}catch(r){return z||(s("‚ö†Ô∏è Unable to capture jotai store for userSlotsAtom",r),z=!0),null}const e=await async function(){let e=$(N);e||(e=E(/userSlotsAtom/i)[0]??null);return e||R||(s("‚ö†Ô∏è Could not locate userSlotsAtom in jotai cache"),R=!0),e&&(R=!1),e}();if(!e)return null;let t;try{t=await F(e),L=!1}catch(r){return L||(s("‚ö†Ô∏è Failed reading userSlotsAtom",r),L=!0),null}const n=new WeakSet,o=[{node:t,label:N}];for(;o.length>0;){const{node:e,label:t}=o.shift(),r=H(e,t);if(r)return r;if(!e||"object"!=typeof e)continue;const a=Array.isArray(e);!a&&n.has(e)||(a||n.add(e),Array.isArray(e)?e.forEach((e,n)=>{o.push({node:e,label:`${t}[${n}]`})}):Object.entries(e).forEach(([e,n])=>{o.push({node:n,label:`${t}.${e}`})}))}return null}const G='section.chakra-modal__content[role="dialog"]',W=".McFlex.css-1cyjil4",O="div.css-vmnhaw",_="qpm-crop-lock-styles",V=".McFlex.css-1cyjil4",U=["data-tm-inventory-id","data-inventory-id","data-item-id","data-itemid","data-itemId","data-item-uuid","data-itemuuid","data-item-guid","data-uuid","data-guid","data-entity-id","data-entityid","data-record-id","data-recordid","data-row-id","data-rowid","data-tm-item-id","data-tm-itemid","data-id"];const X="quinoa:crop-lock-config",J=new Set(Object.keys(u));function K(e){return new Promise(t=>setTimeout(t,e))}function Q(e,t){let n=e;for(const o of t){if(!n||"object"!=typeof n)return;n=n[o]}return n}function Y(e,t,n=4,o=new WeakSet){if(!e||"object"!=typeof e||n<0)return null;if(o.has(e))return null;o.add(e);const r=e;for(const[a,i]of Object.entries(r)){if(t(a,i)){if("string"==typeof i&&i)return i;if("number"==typeof i&&Number.isFinite(i))return String(i)}if(i&&"object"==typeof i){const e=Y(i,t,n-1,o);if(e)return e}}return null}function Z(e){return Array.isArray(e)?e:null}function ee(){try{const e=h,t=e?.myData?.inventory;if(!t)return null;const n=function(e){if(!e||"object"!=typeof e)return[];const t=e,n=[["items"],["inventory","items"],["inventory"],["data","inventory","items"],["data","inventory"],[]];for(const o of n){const n=Z(0===o.length?e:Q(t,o));if(n)return n}return[]}(t),o=Q(t,["favoritedItemIds"]);return{items:n,favoritedItemIds:Array.isArray(o)?o.filter(e=>"string"==typeof e):[],source:"page.myData.inventory"}}catch(e){return s("‚ö†Ô∏è Unable to read inventory from page window",e),null}}function te(e){const t=[["id"],["itemId"],["itemID"],["inventoryID"],["inventoryId"],["uuid"],["item","id"],["item","itemId"],["item","itemID"],["item","inventoryId"],["item","inventoryID"],["item","uuid"],["plant","id"],["data","id"]];for(const o of t){const t=Q(e,o);if("string"==typeof t&&t)return t;if("number"==typeof t)return String(t)}const n=Y(e,e=>/(?:inventory|item).*id$/i.test(e)||/^(?:id|uuid|guid)$/i.test(e),5);return n||null}function ne(e){const t=[["species"],["item","species"],["plant","species"],["data","species"],["crop","species"],["product","species"],["product","name"],["product","displayName"],["item","name"],["item","displayName"],["data","name"],["data","displayName"],["product","productName"],["item","productName"]];for(const o of t){const t=Q(e,o);if("string"==typeof t&&t)return t}const n=Y(e,(e,t)=>{const n=e.toLowerCase();if(/(species|productname|productlabel|cropname|displayname)$/.test(n))return!0;if(n.endsWith("name")&&"string"==typeof t){return!!c(t)}return!1},4);return n||null}async function oe(){const e=ee();if(e&&e.items.length>0)return{items:[...e.items],favoritedIds:new Set(e.favoritedItemIds),source:e.source};const t=await j();return t&&t.items.length>0?{items:[...t.items],favoritedIds:new Set(t.favoritedItemIds??[]),source:t.source}:e?{items:[...e.items],favoritedIds:new Set(e.favoritedItemIds),source:e.source}:t?{items:[...t.items],favoritedIds:new Set(t.favoritedItemIds??[]),source:t.source}:null}function re(e,t){const n=t?.favoritedIds??null,o=t?function(e){const t=new Map;for(const n of e.items){const o=te(n);if(!o)continue;const r=ne(n);if(!r)continue;const a=c(r);if(!a)continue;const i={id:o,isFavorited:e.favoritedIds.has(o)},s=t.get(a);s?s.push(i):t.set(a,[i])}return t}(t):null,r={},a=[];for(const i of e){const e=i.element;if(!e)continue;const t=c(i.species||"unknown")??"unknown",s=o?.get(t)??null;let l=fe(e),d=l&&n?n.has(l):!(!i.element||!Ce(i.element));if(!l&&s&&s.length>0){const e=s.shift();l=e.id,d=e.isFavorited}else if(l&&s){const e=s.findIndex(e=>e.id===l);e>=0&&s.splice(e,1)}if(!l){r[t]=(r[t]??0)+1;continue}const u=n?n.has(l):d;a.push({item:i,element:e,itemId:l,isFavorited:u})}return Object.keys(r).length>0&&s("‚ö†Ô∏è Missing inventory ids for some crop items",{missing:r}),a}function ae(e){try{const t=h.MagicCircle_RoomConnection;if(t&&"function"==typeof t.sendMessage)return t.sendMessage({scopePath:["Room","Quinoa"],type:"ToggleFavoriteItem",itemId:e}),!0}catch(t){s("‚ö†Ô∏è Failed to send favorite toggle via MagicCircle_RoomConnection",t)}return!1}let ie={enabled:!0,syncModeEnabled:!0,lockedTypes:{},managedFavoriteIds:{},baselineFavoriteIds:{}},se=!1,le=new Map;function ce(){if(se)return;se=!0,ie=m.get(X,ie),"boolean"!=typeof ie.syncModeEnabled&&(ie.syncModeEnabled=!0),ie.managedFavoriteIds||(ie.managedFavoriteIds={}),ie.baselineFavoriteIds||(ie.baselineFavoriteIds={}),function(){if(document.getElementById(_))return;n('\n    .qpm-crop-lock-button {\n      position: absolute;\n      top: 2px;\n      right: 2px;\n      width: 20px;\n      height: 20px;\n      border: none;\n      border-radius: 4px;\n      background: rgba(0, 0, 0, 0.7);\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-size: 12px;\n      z-index: 10;\n      transition: all 0.2s;\n      backdrop-filter: blur(2px);\n    }\n    \n    .qpm-crop-lock-button:hover {\n      background: rgba(0, 0, 0, 0.9);\n      transform: scale(1.1);\n    }\n    \n    .qpm-crop-lock-button.locked {\n      background: rgba(255, 193, 7, 0.9);\n      color: #000;\n    }\n    \n    .qpm-crop-lock-button.unlocked {\n      background: rgba(108, 117, 125, 0.7);\n      color: #fff;\n    }\n    \n    .qpm-crop-lock-button.unlocked:hover {\n      background: rgba(108, 117, 125, 0.9);\n    }\n    \n    .qpm-inventory-item-wrapper {\n      position: relative;\n    }\n    \n    /* Hide default favorite button when our lock button is active */\n  .qpm-inventory-item-wrapper button[aria-label*="avorite"] {\n      display: none;\n    }\n  ').id=_}(),s("üåæ Crop type locking system starting...");new MutationObserver(()=>{const e=document.querySelector(V);if(e&&!e.hasAttribute("data-crop-lock-processed")){e.setAttribute("data-crop-lock-processed","true"),s("üîç Inventory grid found via direct observer!");let t=e.parentElement,n=null;for(;t&&t!==document.body;){if("dialog"===t.getAttribute("role")||t.classList.contains("chakra-modal__content")||"SECTION"===t.tagName){n=t,s("‚úÖ Found parent modal");break}t=t.parentElement}n?setTimeout(()=>de(n),300):(s("‚ö†Ô∏è Could not find modal parent, processing grid directly"),setTimeout(()=>{const t=Array.from(e.querySelectorAll(O));t.length>0&&ue(t,e)},300))}}).observe(document.body,{childList:!0,subtree:!0}),setTimeout(()=>{s("üîç Checking for existing inventory on startup...");const e=document.querySelector(V);if(e&&!e.hasAttribute("data-crop-lock-processed")){e.setAttribute("data-crop-lock-processed","true"),s("‚úÖ Found existing inventory grid!");let t=e.parentElement;for(;t&&t!==document.body;){if("dialog"===t.getAttribute("role")||t.classList.contains("chakra-modal__content")){s("‚úÖ Found parent modal on startup, calling enhanceInventoryPanel"),de(t);break}t=t.parentElement}}else s("‚è≥ No inventory open yet")},1e3),o(G,e=>{if(console.log("üîç Panel detected with selector:",G),console.log("Panel element:",e),console.log("Panel classes:",e.className),console.log("Panel role:",e.getAttribute("role")),console.log("Panel text preview:",e.textContent?.substring(0,100)),r(e)){const t=function(e){const t=e.textContent||"",n=t.toLowerCase();if(n.includes("inventory")||n.includes("my items")||e.querySelector('[data-testid*="inventory"]'))return!0;if(n.includes("shop")||n.includes("buy")||n.includes("purchase")||n.includes("seeds in")||n.includes("restocked")||n.includes("new seeds")||e.querySelector('[data-testid*="shop"]')||e.classList.contains("css-1ubz3lw"))return!1;const o=e.querySelector('.chakra-stack > div[role="button"]'),r=e.querySelector("div[data-tm-shop-index]");if(r&&!o)return!1;return!0}(e);console.log("Is inventory panel?",t),t?(s("üéí Inventory panel detected, adding crop lock buttons..."),setTimeout(()=>de(e),500)):s("üõí Shop panel detected, ignoring for crop locking")}else console.log("Panel not visible, skipping")}),o(V,e=>{console.log("üîç User inventory grid detected:",e),console.log("Grid classes:",e.className),console.log("Grid text preview:",e.textContent?.substring(0,100));let t=e.parentElement;for(;t;){if("dialog"===t.getAttribute("role")||t.classList.contains("chakra-modal__content")||t.hasAttribute("aria-modal")){console.log("üéí Found inventory modal for user grid:",t),setTimeout(()=>de(t),200);break}t=t.parentElement}}),o('[role="dialog"]',e=>{console.log("üîç Any dialog detected:",e),console.log("Dialog classes:",e.className),console.log("Dialog text preview:",e.textContent?.substring(0,200));const t=e.textContent?.toLowerCase()||"";(t.includes("inventory")||t.includes("my items")||t.includes("backpack"))&&(console.log("üéí This dialog might be inventory! Trying to enhance..."),setTimeout(()=>de(e),100))}),o(".chakra-modal__content",e=>{console.log("üîç Chakra modal detected:",e),console.log("Modal classes:",e.className),console.log("Modal text preview:",e.textContent?.substring(0,200));const t=e.textContent?.toLowerCase()||"";(t.includes("inventory")||t.includes("my items")||t.includes("backpack"))&&(console.log("üéí This chakra modal might be inventory! Trying to enhance..."),setTimeout(()=>de(e),100))});new MutationObserver(e=>{e.forEach(e=>{e.addedNodes.forEach(e=>{if(e.nodeType===Node.ELEMENT_NODE){const t=e,n=t.textContent?.toLowerCase()||"";if(n.includes("inventory")||n.includes("my items")){console.log("üîç Element with inventory text detected:",t),console.log("Element tag:",t.tagName),console.log("Element classes:",t.className),console.log("Element text preview:",n.substring(0,200));let e=t.parentElement;for(;e;){if("dialog"===e.getAttribute("role")||e.classList.contains("chakra-modal__content")||e.hasAttribute("aria-modal")){console.log("üéí Found parent modal for inventory element:",e),setTimeout(()=>de(e),100);break}e=e.parentElement}}}})})}).observe(document.body,{childList:!0,subtree:!0});new MutationObserver(e=>{e.forEach(e=>{e.removedNodes.forEach(e=>{if(e.nodeType===Node.ELEMENT_NODE){const t=e;if("dialog"===t.getAttribute("role")||t.classList?.contains("chakra-modal__content")||t.hasAttribute?.("aria-modal")){const e=document.getElementById("quinoa-crop-lock-sidebar");e&&(e.remove(),s("üóëÔ∏è Removed crop lock sidebar (inventory closed)"))}}})})}).observe(document.body,{childList:!0,subtree:!0}),s("‚úÖ Crop type locking system started")}function de(e){s("üéØ enhanceInventoryPanel called");const t=e.querySelector(W);if(!t)return void s(`‚ùå Could not find items container (${W})`);s("‚úÖ Found items container");const n=Array.from(t.querySelectorAll(O));s(`‚úÖ Found ${n.length} inventory items`),0!==n.length?ue(n,e):s("‚ùå No inventory items found")}function ue(e,t){const n=new Map;s(`üîç Processing ${e.length} inventory items...`);for(const o of e){const e=me(o);if(!e)continue;const t=c(e.species||"unknown");n.has(t)||n.set(t,[]),n.get(t).push({...e,element:o})}s(`üåæ Found ${n.size} different crop types`),0!==n.size?function(e,t){const n=document.querySelector("#quinoa-crop-lock-sidebar");n&&(s("üóëÔ∏è Removing existing sidebar"),n.remove());s(`üìä Creating sidebar with ${t.size} crop types`),t.forEach((e,t)=>{s(`  üåæ ${t}: ${e.length} items`)});let o=e.closest('[role="dialog"]')||e.closest(".chakra-modal__content")||e.closest('[aria-modal="true"]')||e;const r=o.getBoundingClientRect();s(`üìê Modal rect: left=${r.left}, right=${r.right}, top=${r.top}, width=${r.width}, height=${r.height}`);const a=r.right+8,i=r.top+60;s(`üìê Sidebar positioning: left=${a}px, top=${i}px`);const l=document.createElement("div");l.id="quinoa-crop-lock-sidebar",l.style.cssText=`\n    position: fixed;\n    top: ${i}px;\n    left: ${a}px;\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    z-index: 2147483646;\n    pointer-events: auto;\n  `;let d=0;if(t.forEach((e,t)=>{const n=function(e,t){const n=document.createElement("div");n.style.cssText="\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 6px;\n    cursor: pointer;\n    transition: transform 0.2s ease;\n  ",n.addEventListener("mouseenter",()=>{n.style.transform="scale(1.05)"}),n.addEventListener("mouseleave",()=>{n.style.transform="scale(1)"});const o=document.createElement("button");o.className="quinoa-crop-type-button",o.title=`${e} (${t.length} items) - Click to favorite/unfavorite all`;const r=t[0];let a="";if(r&&r.element){const t=r.element.querySelector("img");if(t&&t.src)a=t.src;else{const t=r.element.querySelector("canvas");if(t)try{a=t.toDataURL()}catch(f){s("‚ö†Ô∏è Could not get canvas data for",e)}}}o.style.cssText="\n    width: 68px;\n    height: 68px;\n    border: none;\n    background: rgba(0, 0, 0, 0.92);\n    border-radius: 8px;\n    cursor: pointer;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: flex-start;\n    position: relative;\n    padding: 11px 4px 4px 4px;\n    gap: 0px;\n  ";const i=document.createElement("div");i.style.cssText="\n    width: 100%;\n    height: 33px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    position: relative;\n    flex-shrink: 0;\n  ",a?(i.style.backgroundImage=`url(${a})`,i.style.backgroundSize="60%",i.style.backgroundRepeat="no-repeat",i.style.backgroundPosition="center"):(i.textContent=e.charAt(0).toUpperCase(),i.style.color="#fff",i.style.fontSize="24px",i.style.fontWeight="bold");o.appendChild(i);const l=document.createElement("div");l.style.cssText="\n    color: #fff;\n    font-size: 11px;\n    font-weight: 600;\n    text-align: center;\n    text-shadow: 0 1px 2px rgba(0,0,0,0.8);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    width: 100%;\n    margin-top: -24px;\n    flex-shrink: 0;\n    line-height: 1.2;\n    position: relative;\n    z-index: 10;\n  ",l.textContent=e.charAt(0).toUpperCase()+e.slice(1),o.appendChild(l);const d=c(e)??e.toLowerCase();let u=t.every(e=>Ce(e.element));function p(){const e=t.filter(e=>Ce(e.element)).length,n=e>0&&e<t.length;u?(o.style.filter="drop-shadow(0 0 8px gold)",l.style.color="#ffd700"):n?(o.style.filter="drop-shadow(0 0 6px #ffa726)",l.style.color="#ffa726"):(o.style.filter="none",l.style.color="#fff")}return p(),n.addEventListener("click",async()=>{const e=le.get(d);await async function(e,t,n){if(0===t.length)return;const o=t[0]?.species??e,r=ie.lockedTypes[e]||!1,a=!r,i=!1!==ie.syncModeEnabled;s(`üîÑ ${a?"Locking":"Unlocking"} all ${o} items...`);const l=await oe();if(!l)return s("‚ö†Ô∏è Unable to capture inventory context; aborting crop lock toggle",{speciesKey:e}),void Te(`‚ö†Ô∏è Unable to ${a?"lock":"unlock"} ${o}`);s("üì¶ Inventory context ready for crop lock",{speciesKey:e,source:l.source,items:l.items.length,favorited:l.favoritedIds.size});const c=new Set(l.favoritedIds),d=re(t,l);if(0===d.length)return s("‚ö†Ô∏è No inventory entries with ids found for crop type",{speciesKey:e}),void Te(`‚ö†Ô∏è No ${o} inventory entries found`);const u=d.filter(e=>e.isFavorited).map(e=>e.itemId),p=new Set(ie.baselineFavoriteIds[e]??u),f=new Set(ie.managedFavoriteIds[e]??[]),g=new Set;if(a)for(const s of d)s.isFavorited||g.add(s.itemId);else{if(i){const t=[];for(const e of d)e.isFavorited&&(f.has(e.itemId)||p.has(e.itemId)||(t.push(e.itemId),p.add(e.itemId)));t.length>0&&(s("‚ÑπÔ∏è Detected manual favorites during unlock; merging into baseline",{speciesKey:e,manual:t.length}),ie.baselineFavoriteIds[e]=Array.from(p),m.set(X,ie));for(const e of d){if(!e.isFavorited)continue;const t=f.has(e.itemId),n=p.has(e.itemId);!t&&n||g.add(e.itemId)}}else for(const e of d)e.isFavorited&&g.add(e.itemId);if(f.size>0)for(const e of f)g.has(e)||d.some(t=>t.itemId===e)||g.add(e);i&&0===f.size&&g.size>0&&s("‚ö†Ô∏è Unlocking without managed ids; will toggle all favorited items for this species",{speciesKey:e,count:g.size})}const h=Array.from(g);if(0===h.length)return s("‚ÑπÔ∏è Crop lock toggle skipped (state already matches request)",{speciesKey:e,shouldLock:a}),ie.lockedTypes[e]=a,p.size>0?ie.baselineFavoriteIds[e]=Array.from(p):delete ie.baselineFavoriteIds[e],n&&ve(n,a),m.set(X,ie),void Te(`${o} already ${a?"locked":"unlocked"}`);let b=0;for(const m of h)ae(m)?(b+=1,await K(40)):s("‚ö†Ô∏è Failed to dispatch favorite toggle via websocket",{speciesKey:e,itemId:m});if(0===b)return s("‚ùå No favorite toggles were dispatched; aborting state update",{speciesKey:e}),void Te(`‚ö†Ô∏è Could not ${a?"lock":"unlock"} ${o}`);await async function(e,t,n=2200,o=140){if(0===e.length)return!0;const r=Date.now()+n;for(;Date.now()<r;){const n=await oe(),r=n?.favoritedIds??null;if(r&&(t?e.every(e=>r.has(e)):e.every(e=>!r.has(e))))return!0;await K(o)}return!1}(h,a)||s("‚ö†Ô∏è Favorite state did not settle after toggle commands",{speciesKey:e,shouldLock:a});const y=await oe(),x=y?.favoritedIds??c;y||s("‚ö†Ô∏è Using initial inventory context as fallback after toggles",{speciesKey:e});const w=y??{items:l.items,favoritedIds:new Set(x),source:l.source},v=re(t,w),C=new Set(v.filter(e=>e.isFavorited).map(e=>e.itemId)),T=v.length,S=C.size,k=new Set(f);if(a)for(const s of v){if(!s.isFavorited)continue;(d.find(e=>e.itemId===s.itemId)?.isFavorited??!1)||k.add(s.itemId)}else if(f.size>0)for(const s of v)s.isFavorited||k.delete(s.itemId);else for(const s of h)C.has(s)||k.delete(s);let A;A=a?C.size===T:f.size>0?v.every(e=>!f.has(e.itemId)||!e.isFavorited):h.every(e=>!C.has(e));if(A){if(ie.lockedTypes[e]=a,a){const t=d.filter(e=>e.isFavorited).map(e=>e.itemId);t.length>0?ie.baselineFavoriteIds[e]=t:delete ie.baselineFavoriteIds[e]}else{const t=Array.from(C);t.length>0?ie.baselineFavoriteIds[e]=t:delete ie.baselineFavoriteIds[e]}n&&ve(n,a)}else ie.lockedTypes[e]=r,n&&ve(n,r),s("‚ö†Ô∏è Crop lock operation did not fully succeed",{speciesKey:e,shouldLock:a,favoritedCount:S,totalCount:T,managedBefore:f.size,dispatched:b});k.size>0?ie.managedFavoriteIds[e]=Array.from(k):delete ie.managedFavoriteIds[e];m.set(X,ie);const P=a?C.size:T-C.size;Te(`${a?"üîí Locked":"üîì Unlocked"} ${P}/${T} ${o} items`)}(d,t,e),u=t.every(e=>Ce(e.element)),p()}),n.appendChild(o),n.appendChild(l),n}(t,e);l.appendChild(n),d++}),0===t.size)return;document.body.appendChild(l),s(`‚ú® Created crop lock sidebar with ${d} buttons`);const u=new MutationObserver(()=>{document.body.contains(e)||(s("üóëÔ∏è Inventory closed, removing sidebar"),l.remove(),u.disconnect())});u.observe(document.body,{childList:!0,subtree:!0})}(t,n):s("‚ùå No crop types found - sidebar will not be created")}function pe(e){return e.replace(/\s*\+\s?\d+$/,"").replace(/\s*\([^)]+\)$/,"").replace(/\s*(produce|crop|fruit|vegetable|berry)$/i,"").trim()}function me(e){try{const t=["p.chakra-text.css-8xfasz",".McFlex.css-1gd1uup p.chakra-text","p.chakra-text.css-rbbzu5",".chakra-text",'[data-testid="item-name"]',"p"];let n=null,o=null;for(const s of t)if(n=e.querySelector(s),n&&(o=n.textContent?.trim(),o&&o.length>0))break;if(!o)return s("‚ùå No item name found"),null;const r=pe(o),a=function(e){if(!e)return!1;const t=e.toLowerCase().trim();if(/(\bplant\b|\btree\b|\bsapling\b|\bsprout\b|\bshrub\b)/.test(t))return!1;const n=["seed","spore","cutting","pod","kernel","pit","shovel","pot","watering can","tool","fertilizer","egg","decor","furniture","planter","pedestal","bench","arch"];for(const r of n)if(t.includes(r))return!1;const o=c(e);if(o&&J.has(o))return!0;if(o.endsWith("s")){const e=o.replace(/s$/,"");if(J.has(e))return!0}return!1}(r);if(!a)return null;const i=function(e){const t=pe(e);return t?t.split(/\s+/).map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):null}(r)||r;return{id:`crop-${Date.now()}-${Math.random()}`,species:i,itemType:"Crop",element:e}}catch(t){return s("‚ùå Error extracting crop data:",t),null}}function fe(e){if(!e)return null;const t=["[data-tm-inventory-id]","[data-inventory-id]","[data-item-id]","[data-itemid]","[data-item-uuid]","[data-uuid]","[data-guid]","[data-entity-id]","[data-record-id]","[data-row-id]"],n=[];let o=e;for(let i=0;o&&i<5;i++)n.push(o),o=o.parentElement;const r=e=>{const t=e.toLowerCase();return t.includes("inventoryid")||t.includes("itemid")||/(?:uuid|guid)$/.test(t)};for(const i of n){const e=ge(i,U);if(e)return e;const t=he(i,r);if(t)return t}for(const i of n)for(const e of t){const t=i.querySelector(e);if(!t)continue;const n=ge(t,U);if(n)return n;const o=he(t,r);if(o)return o}const a=function(e){for(const t of e){const e=be(t);if(e)return e;const n=xe(ye(t));if(n)return n}return null}(n);return a||null}function ge(e,t){for(const o of t){const t=e.getAttribute(o);if(null!=t)return t}const n=t.map(e=>e.toLowerCase());for(const{name:o,value:r}of Array.from(e.attributes))if(n.includes(o.toLowerCase())&&null!=r)return r;return null}function he(e,t){const n=e.dataset;if(!n)return null;for(const[o,r]of Object.entries(n))if(t(o)&&null!=r&&""!==r)return r;return null}function be(e){const t=Object.getOwnPropertyNames(e);for(const n of t){if(!n.startsWith("__reactProps$"))continue;const t=we(e[n]);if(t)return t}return null}function ye(e){const t=Object.getOwnPropertyNames(e);for(const n of t)if(n.startsWith("__reactFiber$"))return e[n];return null}function xe(e){if(!e)return null;const t=[{fiber:e,depth:0}],n=new WeakSet;for(;t.length>0;){const{fiber:e,depth:o}=t.pop();if(!e||n.has(e))continue;n.add(e);const r=we(e.memoizedProps)||we(e.pendingProps)||we(e.memoizedState)||we(e.stateNode);if(r)return r;o>=6||(e.child&&t.push({fiber:e.child,depth:o+1}),e.sibling&&t.push({fiber:e.sibling,depth:o}))}return null}function we(e,t=0,n=new WeakSet){if(!e||"object"!=typeof e)return null;if(e instanceof Element||e instanceof Node)return null;if("undefined"!=typeof Window&&e instanceof Window)return null;if(n.has(e))return null;n.add(e);const o=te(e);if(o&&!(!(r=o)||r.length<6||/^\d+$/.test(r)&&r.length<10))return o;var r;if(t>=6)return null;if(Array.isArray(e)){for(const o of e){const e=we(o,t+1,n);if(e)return e}return null}const a=e;for(const i of Object.values(a)){if(!i||"object"!=typeof i&&"function"!=typeof i)continue;const e=we(i,t+1,n);if(e)return e}return null}function ve(e,t){e.textContent=t?"üîí":"üîì",e.className="qpm-crop-lock-button "+(t?"locked":"unlocked")}function Ce(e){const t=function(e){if(!e)return null;const t=e.querySelector('button[aria-label*="avorite"]');return t instanceof HTMLButtonElement?t:null}(e);return!!t&&function(e){const t=e.getAttribute("aria-label")?.toLowerCase()??"";if(t.includes("unfavorite"))return!0;if(t.includes("favorite")&&!t.includes("unfavorite"))return!1;const n=e.getAttribute("aria-pressed");if("true"===n)return!0;if("false"===n)return!1;const o=e.querySelector("svg");if(o){const e=o.querySelector("path");if(e){const t=e.getAttribute("fill");if(t&&"none"!==t&&"currentColor"!==t)return!0}}const r=getComputedStyle(e);return"currentColor"!==r.color||e.classList.contains("active")}(t)}function Te(e){const t=document.createElement("div");t.textContent=e,t.style.cssText="\n    position: fixed;\n    bottom: 24px;\n    right: 24px;\n    background: #2e7d32;\n    color: #fff;\n    padding: 8px 12px;\n    border-radius: 6px;\n    font-size: 12px;\n    z-index: 2147483647;\n    opacity: 0.95;\n    animation: qpm-toast-in 0.3s ease;\n  ",document.querySelector("#qpm-toast-styles")||(n("\n      @keyframes qpm-toast-in {\n        from { transform: translateY(20px); opacity: 0; }\n        to { transform: translateY(0); opacity: 0.95; }\n      }\n    ").id="qpm-toast-styles"),document.body.appendChild(t),setTimeout(()=>t.remove(),2500)}function Se(){return{...ie}}function ke(e){ie.syncModeEnabled=e,m.set(X,ie)}const Ae=["#App > div.McFlex.css-1k630i1 > div.McFlex.css-neeqas > div.McFlex.css-1mq3gde > div.McGrid.css-9guy2q > div.McFlex.css-13izacw > div.css-vmnhaw","#App > div.McFlex.css-neeqas div.css-vmnhaw","#App [data-tm-hud-root] div.css-vmnhaw","#App .QuinoaUI .css-vmnhaw","#App .css-vmnhaw"],Pe=[{id:"Weather:Sunny",label:"Sunny",normalized:"sunny",kind:"sunny",category:"base",durationMs:null,rawState:"noweather",aliases:[]},{id:"Weather:Rain",label:"Rain",normalized:"rain",kind:"rain",category:"weather",durationMs:3e5,rawState:"weather",aliases:[]},{id:"Weather:Frost",label:"Frost",normalized:"frost",kind:"snow",category:"weather",durationMs:3e5,rawState:"weather",aliases:["snow"]},{id:"Weather:Dawn",label:"Dawn",normalized:"dawn",kind:"dawn",category:"lunar",durationMs:6e5,rawState:"weather",aliases:["sunrise"]},{id:"Weather:AmberMoon",label:"Amber Moon",normalized:"ambermoon",kind:"amber",category:"lunar",durationMs:6e5,rawState:"weather",aliases:["harvestmoon","amber_moon"]}],Me=new Map;for(const hu of Pe){new Set([hu.label,hu.normalized,...hu.aliases]).forEach(e=>{const t=Ee(e);t&&Me.set(t,hu)})}function Ee(e){return String(e??"").trim().toLowerCase().replace(/\s+/g,"")}function $e(e){if(null==e)return Me.get("sunny")??null;const t=Ee(e);return t?Me.get(t)??null:Me.get("sunny")??null}function Fe(e){return Array.from(e.querySelectorAll("canvas")).find(e=>{const t=e.getBoundingClientRect();return t.width>=16&&t.width<=256&&t.top>=0&&t.top<=220})||null}function Ie(e){try{const t=e.getContext("2d",{willReadFrequently:!0});if(!t)return"noweather";const n=e.width,o=e.height,{data:r}=t.getImageData(0,0,n,o);let a=0,i=0,s=0,l=0,c=0;for(let e=0;e<r.length;e+=4){const t=r[e],n=r[e+1],o=r[e+2];if(r[e+3]<50)continue;c++,o>120&&o>t+20&&o>n+10&&a++;Math.abs(t-n)<20&&Math.abs(n-o)<20&&Math.abs(t-o)<20&&t>=60&&t<=140&&i++,t>200&&n>150&&o<120&&s++,t>200&&n>200&&o>200&&l++}if(0===c)return"noweather";if(a/c>=.05||i/c>=.1)return"weather";if(s/c>=.01||l/c>=.3)return"noweather";return(80*a+100*i+220*s+255*l)/c<120?"weather":"noweather"}catch{return"noweather"}}const qe={weather:{label:"weatherAtom"},shops:{label:"shopsAtom",transform:e=>e&&"object"==typeof e?e:null},seedShop:{label:"shopsAtom",path:"seed"},eggShop:{label:"shopsAtom",path:"egg"},toolShop:{label:"shopsAtom",path:"tool"},decorShop:{label:"shopsAtom",path:"decor"},shopPurchases:{label:"myShopPurchasesAtom"}},Ne=new Set;function ze(e,t){if(!t)return e;const n=function(e){return e?Array.isArray(e)?e.slice():String(e).split(".").map(e=>e.trim()).filter(Boolean):[]}(t);let o=e;for(const r of n){if(null==o)return;o="number"==typeof r?Array.isArray(o)?o[r]:void 0:o[r]}return o}async function Re(e){const t=$(e);if(!t)throw Ne.has(e)||(s("‚ö†Ô∏è AtomRegistry missing atom",e),Ne.add(e)),new Error(`Atom ${e} not found in jotaiAtomCache`);return Ne.delete(e),t}function Le(e){return t=>{try{const n=ze(t,e.path);return e.transform?e.transform(n):n??e.fallback??null}catch(n){return s("‚ö†Ô∏è AtomRegistry transform error",e.label,n),e.fallback??null}}}function De(e){return qe[e]}async function Be(e){const t=De(e),n=await Re(t.label).catch(()=>null);if(!n){return t.fallback??null??null}return Le(t)(await F(n).catch(e=>(s("‚ö†Ô∏è AtomRegistry read error",t.label,e),null)))??null}async function He(e,t){const n=De(e),o=await Re(n.label),r=Le(n),a=await I(o,e=>{const n=r(e);t(n??null)});return()=>{try{a()}catch(e){s("‚ö†Ô∏è AtomRegistry unsubscribe error",n.label,e)}}}const je=new Set;let Ge={kind:"unknown",raw:"noweather",hash:null,canvasPresent:!1,timestamp:Date.now(),source:"unknown",label:null,startedAt:null,expectedEndAt:null},We=null,Oe=null;let _e=null,Ve=!1,Ue=!1,Xe=null,Je=null,Ke=null,Qe=null,Ye=null;function Ze(e){if(Ge.kind!==e.kind||Ge.raw!==e.raw||Ge.hash!==e.hash||Ge.canvasPresent!==e.canvasPresent||Ge.source!==e.source||Ge.label!==e.label||Ge.startedAt!==e.startedAt||Ge.expectedEndAt!==e.expectedEndAt){Ge=e;for(const e of je)try{e(Ge)}catch(t){s("‚ö†Ô∏è Weather hub listener failed",t)}}}function et(e){const t=Date.now();if(!e)return{kind:"unknown",raw:"noweather",hash:null,canvasPresent:!1,timestamp:t,source:"canvas",label:null,startedAt:null,expectedEndAt:null};if(!function(e){try{const t=e.getContext("2d",{willReadFrequently:!0});if(!t)return!1;const n=Math.min(e.width,128),o=Math.min(e.height,128);if(0===n||0===o)return!1;const r=t.getImageData(0,0,n,o);for(let e=3;e<r.data.length;e+=4)if(r.data[e]>0)return!0;return!1}catch{return!1}}(e))return{kind:"unknown",raw:"noweather",hash:null,canvasPresent:!0,timestamp:t,source:"canvas",label:null,startedAt:null,expectedEndAt:null};const n=Ie(e),o=function(e){if("noweather"===Ie(e))return"sunny";try{const t=e.getContext("2d",{willReadFrequently:!0});if(!t)return"unknown";const n=Math.min(e.width,120),o=Math.min(e.height,120),{data:r}=t.getImageData(0,0,n,o);let a=0,i=0,s=0,l=0;for(let e=0;e<r.length;e+=4)r[e+3]<40||(a+=r[e],i+=r[e+1],s+=r[e+2],l++);if(0===l)return"unknown";const c=a/l,d=i/l,u=s/l;return u>c+20&&u>d+10?"rain":u>150&&c>150&&d>150?"snow":c>120&&u>100&&d<c-10?"dawn":c>150&&d>100&&u<100?"amber":"rain"}catch{return"unknown"}}(e),r=function(e){try{const t=e.getContext("2d",{willReadFrequently:!0});if(!t)return"no-context";const{width:n,height:o}=e,r=t.getImageData(0,0,n,o),a=[[.25*n,.25*o],[.5*n,.5*o],[.75*n,.75*o],[.2*n,.65*o],[.8*n,.35*o]];let i=0;for(const[e,s]of a){const t=Math.min(n-1,Math.max(0,Math.round(e))),a=4*(Math.min(o-1,Math.max(0,Math.round(s)))*n+t);i=(i<<5)-i+r.data[a],i|=0}return i.toString(16)}catch{return"error"}}(e);return{kind:o,raw:n,hash:r,canvasPresent:!0,timestamp:t,source:"canvas",label:"unknown"===o?null:o,startedAt:t,expectedEndAt:null}}function tt(e=!1){if(Ve&&Ue)return void(e&&nt(Xe));const t=Date.now();if(Oe&&t<Oe.expiresAt){const n="sunny"===Oe.kind?"noweather":"weather",o={kind:Oe.kind,raw:n,hash:"override",canvasPresent:!0,timestamp:t,source:"unknown",label:Oe.kind,startedAt:t,expectedEndAt:Oe.expiresAt};return void((e||o.hash!==Ge.hash||o.kind!==Ge.kind)&&Ze(o))}Oe&&t>=Oe.expiresAt&&(Oe=null);const n=et(function(){for(const o of Ae){const e=document.querySelector(o);if(!e)continue;if(e instanceof HTMLCanvasElement)return e;const t=e.querySelector("canvas");if(t instanceof HTMLCanvasElement)return t}const e=[],t=i();t&&e.push(t);const n=document.getElementById("App");n instanceof HTMLElement&&!e.includes(n)&&e.push(n);for(const o of e){const e=Fe(o);if(e)return e}return Fe(document)}());Ze(n)}function nt(e){Ue=!0;const t="string"==typeof e&&e.trim().length>0?e.trim():null,n=$e(t),o=n?.kind??function(e){const t=$e(e);return t?.kind??(e?"unknown":"sunny")}(t),r=n?.rawState??("sunny"===o||"unknown"===o?"noweather":"weather"),a=`atom:${Ee(t??n?.label??"sunny")||"sunny"}`,i=Date.now(),s=n?.id??"Weather:Sunny";Ke!==s&&(Ke=s,Qe=i,Ye=n?.durationMs?i+n.durationMs:null);Ze({kind:o,raw:r,hash:a,canvasPresent:!0,timestamp:i,source:"atom",label:t??n?.label??null,startedAt:Qe,expectedEndAt:Ye})}function ot(){null==We&&(!async function(){if(!_e&&!Je){Je=(async()=>{try{const e=await He("weather",e=>{Ve=!0,Xe="string"==typeof e?e:null,nt(Xe)});_e=e;const t=await Be("weather").catch(()=>Xe);"string"!=typeof t&&null!=t||(Xe=t),Ve=!0,nt(Xe)}catch(e){Ve=!1,Ue=!1,s("‚ö†Ô∏è Weather hub atom bridge error",e),_e=null}finally{Je=null}})();try{await Je}catch{}}}(),tt(!0),We=window.setInterval(()=>tt(!1),2e3))}function rt(){Ve&&Ue?nt(Xe):tt(!0)}function at(e,t=!0){if(je.add(e),t)try{e(Ge)}catch(n){s("‚ö†Ô∏è Weather hub immediate listener failed",n)}return()=>{je.delete(e)}}function it(){return Ge}const st=new Set,lt={},ct={};function dt(e){return e.map(e=>({...e}))}function ut(e){const t={source:e.source,generatedAt:e.generatedAt,summary:e.summary,perWeather:{rain:dt(e.perWeather.rain??[]),snow:dt(e.perWeather.snow??[]),dawn:dt(e.perWeather.dawn??[]),amber:dt(e.perWeather.amber??[])}};return e.metadata&&(t.metadata={...e.metadata}),t}function pt(e){const t={...e,perWeather:{rain:dt(e.perWeather.rain??[]),snow:dt(e.perWeather.snow??[]),dawn:dt(e.perWeather.dawn??[]),amber:dt(e.perWeather.amber??[])}};e.metadata&&(t.metadata={...e.metadata}),ct[e.source]=t}function mt(e,t={}){const n=Math.max(0,e.overallTrackedPlantCount-e.overallEligiblePlantCount),o=Math.max(0,n-e.lunar.mutatedPlantCount);return{...t,lunarTrackedPlantCount:e.lunar.trackedPlantCount,lunarPendingPlantCount:e.lunar.pendingPlantCount,lunarMutatedPlantCount:e.lunar.mutatedPlantCount,nonLunarMutatedPlantCount:o,dawnPendingFruitCount:e.totals.dawn.pendingFruitCount,amberPendingFruitCount:e.totals.amber.pendingFruitCount}}function ft(e){return e?ct[e]??null:ct.garden??ct.inventory??null}function gt(e,t){lt[e]=t;const n={source:e,summary:t};for(const r of st)try{r(n)}catch(o){s("‚ö†Ô∏è Mutation summary listener error",o)}}y("__qpmMutationDebug",{get:e=>function(e){const t=ft(e);return t?ut(t):null}(e),getAll(){const e={};return Object.keys(ct).forEach(t=>{const n=ct[t];n&&(e[t]=ut(n))}),e},list(e){const t=ft(e);return t?function(e){return{source:e.source,generatedAt:e.generatedAt,activeWeather:e.summary.activeWeather,perWeather:{rain:e.perWeather.rain.map(e=>e.name),snow:e.perWeather.snow.map(e=>e.name),dawn:e.perWeather.dawn.map(e=>e.name),amber:e.perWeather.amber.map(e=>e.name)},metadata:e.metadata?{...e.metadata}:void 0}}(t):null},print(e){const t=ft(e);if(!t)return null;const n=[];["rain","snow","dawn","amber"].forEach(e=>{(t.perWeather[e]??[]).forEach(t=>{const o={weather:e,name:t.name,pending:t.pendingFruit,needsSnow:t.needsSnowFruit,fruit:t.fruitCount,source:t.source};t.tag&&(o.tag=t.tag),n.push(o)})});const o=globalThis.console;return 0===n.length?(o?.info?.("[QPM] No mutation plants recorded for current snapshot."),[]):(o?.table?o.table(n):o?.log?.(n),n)}});const ht=["F","W","C","D","A","R","G"],bt="quinoa-mutation-reminder-config",yt=".McFlex.css-1cyjil4",xt="div.css-vmnhaw",wt="myCropInventoryAtom";let vt={enabled:!0,showNotifications:!0,highlightPlants:!0},Ct="unknown",Tt="unknown",St=null,kt=null,At=null,Pt=!1,Mt=new Set,Et=!1,$t=!1,Ft=!1,It=0,qt=!1;let Nt=0;const zt=["rain","snow","dawn","amber"];function Rt(e){let t=e.toLowerCase().replace(/\+\d+$/,"").trim();return t.endsWith(" plant")&&(t=t.slice(0,-6).trim()),t}function Lt(){vt={...vt,...m.get(bt,{})},s("üå± Plant Mutation Reminder starting..."),vt.enabled&&(Bt(),Dt()),s("üå± Plant Mutation Reminder started")}function Dt(){Et||(Et=!0,o(yt,e=>{if(vt.enabled&&(Mt.size>0&&(s(`üîÑ Inventory reopened, reapplying ${Mt.size} plant highlights...`),setTimeout(()=>{!async function(){if(0===Mt.size)return void s("‚è≠Ô∏è No highlights to reapply");s(`üîç Reapplying highlights for ${Mt.size} tracked plants...`);const e=await Vt();if(0===e.length)return void s("‚ö†Ô∏è No plants found in inventory for reapply");const t=e.filter(e=>{const t=Ot(e);return Mt.has(t)});t.length>0?(s(`‚ú® Reapplying ${t.length} highlights`),hn(t)):s("‚ö†Ô∏è None of the tracked plants found in current inventory")}()},300)),At)){const{weather:e}=At;s(`üì¶ Inventory opened with pending ${e} notification`),vt.showNotifications&&yn(`${wn(e)} ${e.toUpperCase()} Weather Active`,"Checking your plants for mutation opportunities...","info");const t=(e=0)=>{const n=document.querySelector(yt);if(!n)return void s("‚ö†Ô∏è Inventory container disappeared");const o=Array.from(n.querySelectorAll(xt)).filter(e=>{const t=e.querySelector("p.chakra-text");return(t?.textContent?.trim()||"").toLowerCase().includes("plant")});o.length>0||e>=5?(o.length>0?s(`‚úÖ Found ${o.length} plant items after ${300*e}ms`):s(`‚è∞ Timeout waiting for plants after ${300*e}ms`),Wt()):(s(`‚è≥ No plants found yet, waiting... (attempt ${e+1}/5)`),setTimeout(()=>t(e+1),300))};t()}}))}function Bt(){ot(),St||(St=at(Ht,!0))}function Ht(e){kt=e;const t=function(e){switch(e.kind){case"rain":return"rain";case"snow":return"snow";case"dawn":return"dawn";case"amber":return"amber";case"sunny":return"sunny";default:return"weather"===e.raw?"rain":"sunny"}}(e);if(!vt.enabled&&!Pt)return Tt=Ct,void(Ct=t);t!==Ct&&(Tt=Ct,Ct=t,s(`üå§Ô∏è Weather changed: ${Tt} ‚Üí ${Ct}`),bn(),"sunny"===Ct||"unknown"===Ct?(At=null,s("üå§Ô∏è Weather cleared - no mutations available")):Wt())}function jt(e){switch(e){case"rain":case"snow":return 3e5;case"dawn":case"amber":return 6e5;default:return null}}function Gt(e,t){if("sunny"===e||"unknown"===e)return null;const n=jt(e),o=t?.startedAt??t?.timestamp??null,r=t?.expectedEndAt??(null!=o&&null!=n?o+n:null)??(null!=n?Date.now()+n:null),a=null!=r?Math.max(0,r-Date.now()):null;return{weather:e,startedAt:o,expectedEndAt:r,durationMs:null!=r&&null!=o?Math.max(0,r-o):n,remainingMs:a}}async function Wt(){if(!vt.enabled)return;s(`üîç Checking inventory for mutation opportunities (${Ct})...`);const e=await Vt(),t=Gt(Ct,kt),n={rain:[],snow:[],dawn:[],amber:[]},o=(e,t,o)=>{const r={name:t.name,pendingFruit:o.pendingFruit,needsSnowFruit:o.needsSnowFruit,fruitCount:t.fruitCount,source:t.slotSource};o.tag&&(r.tag=o.tag),n[e].push(r)};if(0===e.length){const e=gn([],Ct,t,o);return gt("inventory",e),pt({source:"inventory",generatedAt:e.timestamp,summary:e,perWeather:n,metadata:mt(e,{scannedPlantCount:0,highlightedPlantCount:0,notes:"Inventory empty"})}),s("üì¶ No plants found in inventory"),void("sunny"!==Ct&&"unknown"!==Ct&&(At={weather:Ct,plantCount:0},vt.showNotifications&&yn(`${wn(Ct)} ${Ct.toUpperCase()} Weather!`,"Open your inventory (press E) to check which plants to place","info")))}At=null;const r=function(e,t){const n=[];for(const o of e){mn(o,t,!0).decision&&n.push(o)}return n}(e,Ct),a=gn(e,Ct,t,o);gt("inventory",a),pt({source:"inventory",generatedAt:a.timestamp,summary:a,perWeather:n,metadata:mt(a,{scannedPlantCount:e.length,highlightedPlantCount:r.length})}),r.length>0?(s(`üå± Found ${r.length} plants to place for ${Ct}!`),vt.highlightPlants&&(r.forEach(e=>{const t=Ot(e);Mt.add(t)}),hn(r)),vt.showNotifications&&function(e,t){(function(e,t){const n=wn(t),o=e.length,r=xn(t);t.toUpperCase()})(e,t),yn(`${wn(t)} ${t.toUpperCase()} Weather!`,`Place ${e.length} plant${e.length>1?"s":""} ${xn(t)}`,"success")}(r,Ct),r.length):s(`‚úì No mutation opportunities for ${Ct}`)}function Ot(e){const t=function(e){if(!e.length)return"no-slots";return e.map(e=>{const t=e.letters.join(""),n=`${e.hasDawnbound?"d":""}${e.hasAmberbound?"a":""}`,o=t||"_";return n?`${o}+${n}`:o}).join(",")}(e.slotStates);return`${e.name}|${e.mutations}|${e.fruitCount}|${t}`}function _t(e,t,n,o){const r=e.slotStates.map((e,t)=>({index:t,letters:e.letters.join(""),wet:e.hasWet,frozen:e.hasFrozen,chilled:e.hasChilled,dawn:e.hasDawnlit,amber:e.hasAmberlit,dawnbound:e.hasDawnbound,amberbound:e.hasAmberbound,rainbow:e.hasRainbow,gold:e.hasGold,progress:e.progress}));s(`[Mutations] ${n?"‚úÖ highlight":"‚è≠Ô∏è skip"} ${e.name} for ${t}`,{slotSource:e.slotSource,fruitCount:e.fruitCount,domCounts:e.domMutationCounts,domBold:e.domBoldCounts,slotSummary:r,detail:o})}async function Vt(){const e=((e,t=document)=>t.querySelector(e))(yt);if(!e||!r(e))return s("‚ùå Inventory not open"),[];const t=Array.from(e.querySelectorAll(xt)),n=await async function(){Ft=!1,It=0,Nt=0;const e=await async function(){const e=async()=>{const e=await async function(){if("undefined"==typeof window)return null;const e=window,t=[{source:"MGTools.Core.Atoms.inventory.myCropInventory",atom:e?.MGTools?.Core?.Atoms?.inventory?.myCropInventory},{source:"MGTOOLS.Core.Atoms.inventory.myCropInventory",atom:e?.MGTOOLS?.Core?.Atoms?.inventory?.myCropInventory},{source:"Atoms.inventory.myCropInventory",atom:e?.Atoms?.inventory?.myCropInventory},{source:"__tmAtoms.inventory.myCropInventory",atom:e?.__tmAtoms?.inventory?.myCropInventory}];for(const o of t){const e=o.atom;if(!e)continue;const t=e=>{const t=Ut(e);if(t&&t.length>0)return t;if(e&&"object"==typeof e){const t=[e.items,e.value,e.current,e.state];for(const e of t){const t=Ut(e);if(t&&t.length>0)return t}}return null};try{if("function"==typeof e.get){const n=t(await e.get());if(n&&n.length>0)return{items:n,source:`${o.source}.get()`,hasSlotData:n.some(e=>en(e).length>0)}}const n=t(e);if(n&&n.length>0)return{items:n,source:`${o.source}`,hasSlotData:n.some(e=>en(e).length>0)}}catch(n){qt||(s("‚ö†Ô∏è Unable to read shared atoms inventory source",{source:o.source,error:n}),qt=!0)}}return null}();if(e)return Ft||(s("[Mutations] Using shared atoms inventory source",{source:e.source,items:e.items.length,hasSlotData:e.hasSlotData}),Ft=!0),e.items;const t=function(){if("undefined"==typeof window)return null;const e=window,t=[{source:"UnifiedState.atoms.inventory.items",value:e?.UnifiedState?.atoms?.inventory?.items},{source:"UnifiedState.atoms.inventory",value:e?.UnifiedState?.atoms?.inventory},{source:"myData.inventory.items",value:e?.myData?.inventory?.items},{source:"__mga_cachedInventory",value:e?.__mga_cachedInventory},{source:"MGTOOLS.UnifiedState.atoms.inventory.items",value:e?.MGTOOLS?.UnifiedState?.atoms?.inventory?.items}];let n=null;for(const o of t){let e=Ut(o.value),t=o.source;if((!e||0===e.length)&&o.value&&"object"==typeof o.value){const n=[{key:"myCropInventory",label:`${o.source}.myCropInventory`},{key:"cropInventory",label:`${o.source}.cropInventory`},{key:"inventory",label:`${o.source}.inventory`},{key:"items",label:`${o.source}.items`}];for(const r of n){const n=Ut(o.value[r.key]);if(n&&n.length>0){e=n,t=r.label;break}}}if(!e||0===e.length)continue;const r=e.some(e=>en(e).length>0),a={items:e,source:t,hasSlotData:r};if(r)return a;n||(n=a)}return n}();return t?(Ft||(s("[Mutations] Using global inventory source",{source:t.source,items:t.items.length,hasSlotData:t.hasSlotData}),Ft=!0),t.items):[]},t=async(t,n)=>{if(!t||0===t.length)return await e();if(t.some(e=>en(e).length>0))return Ft||(s(`[Mutations] Read crop inventory atom (${n})`,{count:t.length,hasSlotData:!0}),Ft=!0),t;if(!Ft){const e=t.slice(0,3).map((e,t)=>({index:t,summary:Xt(e)}));s("[Mutations] Crop inventory atom lacks slot data, trying fallback",{source:n,count:t.length,samples:e})}const o=await e();return o.length>0?o:(Ft||(s("[Mutations] Crop inventory atom fallback unavailable, proceeding without slot data",{source:n,count:t.length}),Ft=!0),t)};try{await M()}catch(r){return $t||(s("‚ö†Ô∏è Unable to capture jotai store for crop inventory",r),$t=!0),await e()}const n=await j();if(n&&n.items.length>0)return Ft||(s("[Mutations] Using userSlotsAtom inventory source",{source:n.source,items:n.items.length,hasSlotData:n.hasSlotData}),Ft=!0),n.hasSlotData?n.items:await t(n.items,n.source);const o=$(wt);if(!o)return $t||(s("‚ö†Ô∏è Could not locate myCropInventoryAtom in jotai cache"),$t=!0),await e();try{const n=await F(o);return $t=!1,Array.isArray(n)?await t(n,"array"):n&&Array.isArray(n.items)?await t(n.items,"items array"):(Ft||s("[Mutations] Crop inventory atom value not array-like",{sample:n}),await e())}catch(r){return $t||(s("‚ö†Ô∏è Failed reading myCropInventoryAtom",r),$t=!0),await e()}return[]}();if(0===e.length)return Ft||(s("[Mutations] Inventory lookup unavailable (no items)"),Ft=!0),null;const t=new Map,n=new Map,o=new Map;if(e.forEach((e,r)=>{const a=function(e,t){if(!e||"object"!=typeof e)return null;const n=function(e){if(!e||"object"!=typeof e)return"other";if(en(e).length>0)return"plant";const t=[e?.itemType,e?.type,e?.category,e?.kind,e?.item?.itemType,e?.item?.type,e?.plant?.itemType,e?.plant?.type];for(const n of t){if("string"!=typeof n)continue;const e=n.toLowerCase();if("plant"===e||"crop"===e||e.endsWith("plant")||e.includes("plant"))return"plant"}return"other"}(e);if("plant"!==n)return It<5&&(s("[Mutations] Inventory item skipped (type mismatch)",{index:t,itemType:n,keys:Object.keys(e).slice(0,10),sample:Xt(e)}),It+=1),null;const o=en(e),r=o.map(tn),a="string"==typeof e.id?e.id:null,i="string"==typeof e.species?e.species:null,l="string"==typeof e.itemName?e.itemName:null,c="string"==typeof e.displayName?e.displayName:null;let d="string"==typeof e.name?e.name:null;d||(d=l||c);!d&&i&&(d=i.toLowerCase().includes("plant")?i:`${i} Plant`);const u=d?Rt(d):null;return{baseIndex:t,id:a,slotStates:r,raw:e,name:d,normalizedName:u,used:!1}}(e,r);if(a&&(t.set(a.baseIndex,a),a.id&&n.set(a.id,a),a.normalizedName)){const e=o.get(a.normalizedName)??[];e.push(a),o.set(a.normalizedName,e)}}),0===t.size)return Ft||(s("[Mutations] Inventory lookup construction produced zero entries"),Ft=!0),null;Ft||(s("[Mutations] Inventory lookup ready",{items:e.length,byIndex:t.size,byId:n.size,byName:o.size}),Ft=!0);return{byIndex:t,byId:n,byName:o}}(),o=[];return t.forEach((e,t)=>{const r=function(e,t,n){try{const r=["p.chakra-text.css-8xfasz",".McFlex.css-1gd1uup p.chakra-text","p.chakra-text.css-rbbzu5","p.chakra-text"],a=[];let i="";for(const t of r){const n=Array.from(e.querySelectorAll(t));for(const e of n){const t=e.textContent?.trim();t&&(a.push(t),!i&&/plant/i.test(t)&&(i=t))}if(i)break}if(!i&&a.length){i=a.find(e=>/[a-z]/i.test(e))??""}if(!i||!function(e){e.toLowerCase().trim();const t=/\+\d+$/.test(e),n=e.match(/^(.+?)(?:\+\d+)?$/),o=(n?.[1]||e).toLowerCase().trim(),r=["seed","spore","cutting","pod","kernel","pit","shovel","pot","watering can","tool","fertilizer","egg","decor","furniture","planter"];for(const a of r)if(o.includes(a))return!1;if(o.includes("plant"))return!0;if(t)return!0;return!1}(i))return null;const l=function(e){const t=[],n=e.querySelectorAll("span, div, p");for(const o of n){const e=o.textContent?.trim();if(!e||1!==e.length)continue;const n=e.toUpperCase();if(!sn(n))continue;let r=!1;if(o instanceof HTMLElement){const e=window.getComputedStyle(o).fontWeight,t=Number.parseInt(e,10);r="bold"===e||Number.isFinite(t)&&t>=700}t.push({letter:n,isBold:r})}return t}(e),c=function(e){const t=rn();for(const n of e)t[n.letter]+=1;return t}(l),d={D:(o=l).filter(e=>"D"===e.letter&&e.isBold).length,A:o.filter(e=>"A"===e.letter&&e.isBold).length},u=i.match(/\+(\d+)/),p=u?parseInt(u[1]||"1",10):0;let m=[],f="fallback";if(t){const o=function(e,t){const n=dn(e,ln),o=pn(n);if(null!=o)return o;const r=un(e,e=>e.toLowerCase().includes("inventorybaseindex")),a=pn(r);if(null!=a)return a;const i=e.querySelector("[data-tm-inventory-base-index]");if(i){const e=pn(dn(i,ln));if(null!=e)return e;const t=pn(un(i,e=>e.toLowerCase().includes("inventorybaseindex")));if(null!=t)return t}return t}(e,n);let r=t.byIndex.get(o)??null;if(!r||r.used){const n=function(e){const t=["[data-tm-inventory-id]","[data-inventory-id]","[data-item-id]","[data-itemid]","[data-item-uuid]","[data-uuid]","[data-guid]","[data-entity-id]","[data-record-id]","[data-row-id]"],n=e=>{const t=e.toLowerCase();return t.includes("inventoryid")||t.includes("itemid")||/(?:uuid|guid)$/.test(t)},o=[];let r=e;for(let a=0;r&&a<5;a++)o.push(r),r=r.parentElement;for(const a of o){const e=dn(a,cn);if(e)return e;const t=un(a,n);if(t)return t}for(const a of o)for(const e of t){const t=a.querySelector(e);if(!t)continue;const o=dn(t,cn);if(o)return o;const r=un(t,n);if(r)return r}return null}(e);if(n){const e=t.byId.get(n)??null;e&&!e.used&&(r=e)}}if(!r||r.used){const e=Rt(i),n=t.byName.get(e);if(n){for(;n.length>0&&n[0]&&n[0].used;)n.shift();if(n.length>0){const e=n.shift();e&&(r=e)}}}r&&!r.used&&(r.used=!0,m=r.slotStates.map(on),f="inventory")}const g=an(m,c,d),h=p>0?p:m.length;return 0===h?(s(`‚è≠Ô∏è Skipping ungrown plant: ${i} (${"inventory"===f?"no slots yet":"no fruit count"})`),null):{name:i,mutations:g,element:e,fruitCount:h,slotStates:m,slotSource:f,domMutationCounts:c,domBoldCounts:d}}catch(r){return s("‚ùå Error extracting plant data:",r),null}var o}(e,n,t);r&&o.push(r)}),s(`üì¶ Scanned ${o.length} plants from inventory`),o}function Ut(e){if(Array.isArray(e))return e;if(e&&"object"==typeof e){const t=e.items;if(Array.isArray(t))return t}return null}function Xt(e){const t={},n=["id","name","species","itemType","type","category","kind"];for(const o of n)e&&"object"==typeof e&&o in e&&(t[o]=e[o]);if(e?.item&&"object"==typeof e.item){t.item={};for(const o of n)o in e.item&&(t.item[o]=e.item[o])}if(e?.plant&&"object"==typeof e.plant){t.plant={};for(const o of n)o in e.plant&&(t.plant[o]=e.plant[o])}return e?.itemName&&(t.itemName=e.itemName),t.hasSlots=!!en(e).length,t}function Jt(e){if("string"==typeof e){const t=e.trim();return t.length>0?t:null}return"number"==typeof e&&Number.isFinite(e)?e.toString():null}function Kt(e){if("number"==typeof e&&Number.isFinite(e))return e;if("string"==typeof e){const t=Number.parseInt(e,10);return Number.isNaN(t)?null:t}return null}function Qt(e,t){if(!e||"object"!=typeof e)return null;if(t.has(e))return null;if(t.add(e),Array.isArray(e)){for(const n of e){const e=Qt(n,t);if(e)return e}return null}const n=e,o=[[n.complete,n.total],[n.completed,n.total],[n.completed,n.goal],[n.count,n.total],[n.count,n.required],[n.current,n.max],[n.value,n.max]];for(const[a,i]of o){const e=Kt(a),t=Kt(i);if(null!=e&&null!=t&&t>0&&e>=0)return{complete:e,total:t}}const r=["progress","state","status","data","info","details","counts"];for(const a of r){const e=n[a];if(!e)continue;const o=Qt(e,t);if(o)return o}return null}function Yt(e,t=new WeakSet){if("string"==typeof e)return e;if("number"==typeof e&&Number.isFinite(e))return e.toString();if(!e||"object"!=typeof e)return null;if(t.has(e))return null;t.add(e);const n=e,o=["name","displayName","display_name","mutationName","mutation","label","title","text","type","kind","state","status","key"];let r=null;for(const i of o){const e=Jt(n[i]);if(e){r=e;break}}if(!r){const e=["mutation","mut","data","info","details","entry","node","item"];for(const o of e){const e=n[o];if(!e)continue;const a=Yt(e,t);if(a){r=a;break}}}const a=Qt(n,t);return a&&(r?/\d+\s*\/\s*\d+/.test(r)||(r=`${r} ${a.complete}/${a.total}`):r=`${a.complete}/${a.total}`),r}function Zt(e){if(!e||"object"!=typeof e)return{};const t=e,n={},o=Object.keys(t).slice(0,10);for(const r of o){const e=t[r];if(null!=e)if("string"!=typeof e&&"number"!=typeof e&&"boolean"!=typeof e){if(Array.isArray(e))n[r]=e.slice(0,3).map(e=>{if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return e;if(e&&"object"==typeof e){const t=e,n=Object.keys(t).find(e=>{const n=t[e];return"string"==typeof n||"number"==typeof n});return n?t[n]:Object.keys(t).slice(0,3)}return typeof e});else if("object"==typeof e){const t=e,o={};for(const e of Object.keys(t).slice(0,5)){const n=t[e];"string"!=typeof n&&"number"!=typeof n&&"boolean"!=typeof n||(o[e]=n)}Object.keys(o).length>0&&(n[r]=o)}}else n[r]=e}return n}function en(e){if(!e||"object"!=typeof e)return[];const t=[e.slots,e.plant?.slots,e.item?.slots,e.data?.slots,e.slots?.slots,e.growSlots];for(const n of t)if(Array.isArray(n)&&n.length>0)return n;return[]}function tn(e){const t=function(e){if(!e||"object"!=typeof e)return[];const t=e,n=[],o=new Set,r=e=>{if(!e)return;const t=e.trim();t&&!o.has(t)&&(o.add(t),n.push(t))},a=[t.mutations,t.mutationStates,t.mutation_states,t.mutationHistory,t.appliedMutations,t.pendingMutations,t.mutationsList];for(const s of a)if(s)if(Array.isArray(s))for(const e of s)r(Yt(e));else if("object"==typeof s)for(const e of Object.values(s))r(Yt(e));const i=["mutation","mutationName","mutationType","currentMutation","activeMutation","latestMutation"];for(const s of i)r(Yt(t[s]));if(0===n.length){const e=[["wet","wet"],["water","wet"],["rain","wet"],["freeze","wet"],["frozen","wet"],["chill","wet"],["dawn","dawn"],["amber","amber"]];for(const[n,o]of Object.entries(t)){const t=n.toLowerCase(),a=e.find(([e])=>t.includes(e));if(!a)continue;const[,i]=a,s=Qt(o,new WeakSet);s&&r(`${i} ${s.complete}/${s.total}`)}}return n}(e);if(0===t.length&&Nt<5){const t=e&&"object"==typeof e?Object.keys(e).slice(0,10):[];s("[Mutations] Inventory slot missing mutation text",{keys:t,sample:Zt(e)}),Nt+=1}return nn(t)}function nn(e){const t=new Set;let n=!1,o=!1,r=!1,a=!1,i=!1,s=!1,l=!1,c=!1,d=!1;const u={};let p=0,m=0,f=0;const g=(e,t,n)=>{if(!Number.isFinite(t)||!Number.isFinite(n))return;if(n<=0||t<0)return;const o=u[e];(!o||n>o.total||n===o.total&&t>o.complete)&&(u[e]={complete:t,total:n})};for(const b of e){const e=String(b??"").toLowerCase(),u=e.includes("frozen")||e.includes("freeze");u&&(n=!0,t.add("F"));const h=e.includes("wet");h&&(o=!0,t.add("W"));const y=e.includes("chill");y&&(r=!0,t.add("C")),(u||h||y)&&(p+=1);const x=e.includes("dawnbound");x&&(s=!0,t.add("D"));const w=e.includes("amberbound");w&&(l=!0,t.add("A"));const v=(e.includes("dawnlit")||e.includes("dawnlight")||e.includes("dawn"))&&!x;v&&(a=!0,t.add("D")),(v||x)&&(m+=1);const C=(e.includes("amberlit")||e.includes("amberlight")||e.includes("amber"))&&!w;C&&(i=!0,t.add("A")),(C||w)&&(f+=1);e.includes("rainbow")&&(c=!0,t.add("R"));e.includes("gold")&&(d=!0,t.add("G"));const T=e.match(/(\d+)\s*\/\s*(\d+)/);if(T){const e=Number.parseInt(T[1]??"0",10),t=Number.parseInt(T[2]??"0",10);(u||h||y)&&g("wet",e,t),(v||x)&&g("dawn",e,t),(C||w)&&g("amber",e,t)}}const h=Array.from(t).sort();return!u.wet&&p>0&&(u.wet={complete:p,total:p}),!u.dawn&&m>0&&(u.dawn={complete:m,total:m}),!u.amber&&f>0&&(u.amber={complete:f,total:f}),{letters:h,hasFrozen:n,hasWet:o,hasChilled:r,hasDawnlit:a,hasAmberlit:i,hasDawnbound:s,hasAmberbound:l,hasRainbow:c,hasGold:d,progress:u}}function on(e){return{letters:[...e.letters],hasFrozen:e.hasFrozen,hasWet:e.hasWet,hasChilled:e.hasChilled,hasDawnlit:e.hasDawnlit,hasAmberlit:e.hasAmberlit,hasDawnbound:e.hasDawnbound,hasAmberbound:e.hasAmberbound,hasRainbow:e.hasRainbow,hasGold:e.hasGold,progress:{...e.progress??{}}}}function rn(e=0){return{F:e,W:e,C:e,D:e,A:e,R:e,G:e}}function an(e,t,n){const o=new Set;for(const r of e)r.letters.forEach(e=>o.add(e)),r.hasDawnbound&&o.add("D"),r.hasAmberbound&&o.add("A");for(const r of ht)t[r]>0&&o.add(r);return n.D>0&&o.add("D"),n.A>0&&o.add("A"),Array.from(o).sort().join("")}function sn(e){return"F"===e||"W"===e||"C"===e||"D"===e||"A"===e||"R"===e||"G"===e}const ln=["data-tm-inventory-base-index","data-tm-inventory-baseindex","data-tm-base-index","data-base-index"],cn=["data-tm-inventory-id","data-inventory-id","data-item-id","data-itemid","data-itemId","data-item-uuid","data-itemuuid","data-item-guid","data-uuid","data-guid","data-entity-id","data-entityid","data-record-id","data-recordid","data-row-id","data-rowid","data-tm-item-id","data-tm-itemid","data-id"];function dn(e,t){for(const o of t){const t=e.getAttribute(o);if(null!=t)return t}const n=t.map(e=>e.toLowerCase());for(const{name:o,value:r}of Array.from(e.attributes))if(n.includes(o.toLowerCase())&&null!=r)return r;return null}function un(e,t){const n=e.dataset;if(!n)return null;for(const[o,r]of Object.entries(n))if(t(o)&&null!=r&&""!==r)return r;return null}function pn(e){if(null==e)return null;const t=Number.parseInt(e,10);return Number.isFinite(t)?t:null}function mn(e,t,n=!0){if("sunny"===t||"unknown"===t){const o={strategy:"fallback",fruitCount:Math.max(e.fruitCount,0),frozenCount:0,wetCount:0,chilledCount:0,dawnCount:0,amberCount:0,dawnBoundCount:0,amberBoundCount:0,rainbowCount:0,goldCount:0};return n&&_t(e,t,!1,o),{decision:!1,pendingFruits:0,totalFruits:Math.max(e.fruitCount,0),needsSnow:0,detail:o}}return e.slotStates.length>0&&("inventory"===e.slotSource||"garden"===e.slotSource)?function(e,t,n){const{slotStates:o}=e,r=o.some(e=>e.hasAmberlit||e.hasAmberbound),a=o.some(e=>e.hasDawnlit||e.hasDawnbound),i=o.some(e=>e.hasRainbow),l=o.some(e=>e.hasGold);if(!o.some(e=>e.letters.length>0||e.hasWet||e.hasFrozen||e.hasChilled||e.hasDawnlit||e.hasAmberlit||e.hasDawnbound||e.hasAmberbound||e.hasRainbow||e.hasGold))return fn(e,t,n);const c=o.filter(e=>{const t=(e.hasAmberlit||e.hasAmberbound)&&(e.hasDawnlit||e.hasDawnbound),n=e.hasRainbow&&e.hasGold;return t||n});c.length>0&&s(`‚ö†Ô∏è ${e.name} has ${c.length} fruit(s) with conflicting mutations (same fruit cannot be both amber+dawn or rainbow+gold)`);let d=0,u=0,p=0,m=0,f=0,g=Math.max(e.fruitCount,1),h=0,b=0,y=0,x=0,w=0,v=0;for(const s of o){(s.hasWet||s.hasFrozen)&&(d+=1),s.hasWet&&!s.hasFrozen&&(u+=1);(s.hasChilled||s.hasFrozen)&&(p+=1),s.hasChilled&&s.hasFrozen,(s.hasDawnlit||s.hasDawnbound)&&(m+=1),(s.hasAmberlit||s.hasAmberbound)&&(f+=1);const e=s.progress?.wet;e&&(h=Math.max(h,e.total),b=Math.max(b,e.complete));const t=s.progress?.dawn;t&&(y=Math.max(y,t.total),x=Math.max(x,t.complete));const n=s.progress?.amber;n&&(w=Math.max(w,n.total),v=Math.max(v,n.complete))}g=Math.max(g,d,p,m,f);const C=e=>Math.max(0,Math.min(g,e)),T=C(e.domMutationCounts.F),S=C(e.domMutationCounts.W),k=C(T+S),A=C(Math.max(0,k-T)),P=C(e.domMutationCounts.C),M=C(T+P),E=C(e.domMutationCounts.D+e.domBoldCounts.D),$=C(e.domMutationCounts.A+e.domBoldCounts.A);d=Math.max(d,k),u=Math.max(u,A),p=Math.max(p,M),m=Math.max(m,E),f=Math.max(f,$),h>0&&(g=Math.max(g,h),d=Math.max(d,b));y>0&&(g=Math.max(g,y),m=Math.max(m,x));w>0&&(g=Math.max(g,w),f=Math.max(f,v));const F=Math.max(0,g-d),I=Math.max(0,g-p),q=Math.max(0,g-m),N=Math.max(0,g-f),z={strategy:"inventory",totalFruits:g,wetPending:F,wetFinished:d,wetNeedsSnow:u,wetProgressComplete:b,wetProgressTotal:h,domWetProgress:k,domWetNeedsSnow:A,dawnPending:q,dawnProgressComplete:x,dawnProgressTotal:y,domDawnComplete:E,amberPending:N,amberProgressComplete:v,amberProgressTotal:w,domAmberComplete:$,hasAnyDawn:a,hasAnyAmber:r,hasAnyRainbow:i,hasAnyGold:l};let R=!1,L=0,D=u;switch(t){case"rain":R=F>0,L=F;break;case"snow":I>0?(R=!0,L=I):(R=u>0,L=u);break;case"dawn":R=q>0,L=q,D=0;break;case"amber":R=N>0,L=N,D=0;break;default:R=!1,L=0,D=0}const B={decision:R,pendingFruits:Math.max(0,L),totalFruits:Math.max(1,g),needsSnow:Math.max(0,D),detail:{...z}};n&&_t(e,t,B.decision,B.detail);return B}(e,t,n):fn(e,t,n)}function fn(e,t,n){const{fruitCount:o,domMutationCounts:r,domBoldCounts:a}=e,i=Math.max(o,0);if(i<=0){const o={strategy:"fallback",fruitCount:i,frozenCount:0,wetCount:0,chilledCount:0,dawnCount:0,amberCount:0,dawnBoundCount:0,amberBoundCount:0,rainbowCount:0,goldCount:0};return n&&_t(e,t,!1,o),{decision:!1,pendingFruits:0,totalFruits:i,needsSnow:0,detail:o}}const s=e=>Math.max(0,Math.min(e,i)),l=s(r.F),c=s(r.W),d=s(r.C),u=s(r.D),p=s(r.A),m=s(r.R),f=s(r.G),g=s(a.D),h=s(a.A),b={strategy:"fallback",fruitCount:i,frozenCount:l,wetCount:c,chilledCount:d,dawnCount:u,amberCount:p,dawnBoundCount:g,amberBoundCount:h,rainbowCount:m,goldCount:f};let y=!1,x=0,w=Math.max(0,c-l);switch(t){case"rain":{const e=c+l;if(e<i)y=!0,x=Math.max(0,i-e);else{const e=d-l;y=e>0,x=Math.max(0,e)}break}case"snow":{const e=d+l;if(e<i)y=!0,x=Math.max(0,i-e);else{const e=c-l;y=e>0,x=Math.max(0,e)}w=Math.max(0,c-l);break}case"dawn":{if(p+h>0){y=!1,x=0;break}const e=u+g;x=Math.max(0,i-e),y=x>0,w=0;break}case"amber":{if(u+g>0){y=!1,x=0;break}const e=p+h;x=Math.max(0,i-e),y=x>0,w=0;break}default:y=!1,x=0,w=0}const v={decision:y,pendingFruits:Math.max(0,x),totalFruits:i,needsSnow:Math.max(0,w),detail:b};return n&&_t(e,t,v.decision,v.detail),v}function gn(e,t,n=null,o){const r={rain:{weather:"rain",plantCount:0,pendingFruitCount:0},snow:{weather:"snow",plantCount:0,pendingFruitCount:0,needsSnowFruitCount:0},dawn:{weather:"dawn",plantCount:0,pendingFruitCount:0},amber:{weather:"amber",plantCount:0,pendingFruitCount:0}},a=new Set,i=new Set,s=new Set,l=new Set;let c=0,d=0;const u=[];for(const x of e){const e={rain:mn(x,"rain",!1),snow:mn(x,"snow",!1),dawn:mn(x,"dawn",!1),amber:mn(x,"amber",!1)};let t=null;const n=e.dawn,o=e.amber;n.decision&&o.decision&&(t="amber-preferred"),u.push({plant:x,evaluations:e,lunarTag:t})}for(const{plant:x,evaluations:w,lunarTag:v}of u){const e=Ot(x);i.add(e);const t=w.amber,n=w.dawn,u=Math.max(0,Math.round(t.pendingFruits)),p=Math.max(0,Math.round(n.pendingFruits)),m=Math.max(0,Math.round(t.totalFruits??0)),f=Math.max(0,Math.round(n.totalFruits??0));(m>0||f>0)&&s.add(e);let g=null;if(m>0||u>0?g=t:(f>0||p>0)&&(g=n),g){const t=Math.max(0,Math.round(g.totalFruits??0)),n=Math.max(0,Math.round(g.pendingFruits));t>0&&(c+=t,d+=n,n>0&&l.add(e))}for(const i of zt){const t=w[i];if(!t.decision)continue;const n=Math.max(0,Math.round(t.pendingFruits)),s="snow"===i?Math.max(0,Math.round(t.needsSnow)):0,l="amber"===i&&"amber-preferred"===v?"lunar-any":void 0;r[i].plantCount+=1,r[i].pendingFruitCount+=n,"snow"===i&&(r[i].needsSnowFruitCount=(r[i].needsSnowFruitCount??0)+s);const c={pendingFruit:n,needsSnowFruit:s};l&&(c.tag=l),o?.(i,x,c),a.add(e)}}const p=zt.reduce((e,t)=>e+r[t].pendingFruitCount,0),m=i.size,f=s.size,g=l.size,h=Math.max(0,f-g),b=Math.max(0,c-d),y=n?{...n,remainingMs:null!=n.expectedEndAt?Math.max(0,n.expectedEndAt-Date.now()):n.remainingMs??null}:null;return{timestamp:Date.now(),activeWeather:t,totals:r,overallEligiblePlantCount:a.size,overallPendingFruitCount:p,overallTrackedPlantCount:m,lunar:{trackedPlantCount:f,pendingPlantCount:g,mutatedPlantCount:h,totalFruitCount:c,pendingFruitCount:d,mutatedFruitCount:b},weatherWindow:y}}function hn(e){for(const t of e){const e=Ot(t);if(!Mt.has(e))continue;const n=t.element.parentElement;if(!n)continue;if(n.querySelector(".quinoa-mutation-highlight"))continue;const o=document.createElement("div");o.className="quinoa-mutation-highlight",o.style.cssText="\n      position: absolute;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      border: 3px solid #4CAF50;\n      border-radius: 8px;\n      pointer-events: auto;\n      z-index: 10;\n      animation: quinoa-pulse 1.5s infinite;\n      box-shadow: 0 0 15px rgba(76, 175, 80, 0.8);\n      cursor: pointer;\n    ",o.__plantId=e,o.addEventListener("click",e=>{e.stopPropagation();const n=o.__plantId;n&&(Mt.delete(n),s(`‚úÖ Manually removed highlight from ${t.name}`)),o.remove()}),n.style.position="relative",n.appendChild(o)}if(!document.getElementById("quinoa-mutation-styles")){const e=document.createElement("style");e.id="quinoa-mutation-styles",e.textContent="\n      @keyframes quinoa-pulse {\n        0%, 100% { opacity: 1; }\n        50% { opacity: 0.5; }\n      }\n    ",document.head.appendChild(e)}}function bn(){((e,t=document)=>Array.from(t.querySelectorAll(e)))(".quinoa-mutation-highlight").forEach(e=>e.remove()),Mt.clear(),s("‚ú® Cleared plant highlights")}function yn(e,t,n="info"){const o=document.querySelectorAll(".quinoa-notification");let r=20;o.forEach(e=>{const t=e.getBoundingClientRect();r=Math.max(r,t.bottom-document.documentElement.getBoundingClientRect().top+10)});const a=document.createElement("div");if(a.classList.add("quinoa-notification"),a.style.cssText=`\n    position: fixed;\n    top: ${r}px;\n    right: 20px;\n    background: ${{success:"rgba(76, 175, 80, 0.95)",info:"rgba(33, 150, 243, 0.95)",warning:"rgba(255, 152, 0, 0.95)"}[n]};\n    color: white;\n    padding: 16px 20px;\n    border-radius: 12px;\n    font-family: Arial, sans-serif;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n    z-index: 999999;\n    max-width: 320px;\n    animation: slideInRight 0.3s ease-out;\n    transition: top 0.3s ease-out;\n  `,a.innerHTML=`\n    <div style="font-size: 16px; font-weight: bold; margin-bottom: 4px;">${e}</div>\n    <div style="font-size: 13px; opacity: 0.95;">${t}</div>\n  `,!document.getElementById("quinoa-notification-styles")){const e=document.createElement("style");e.id="quinoa-notification-styles",e.textContent="\n      @keyframes slideInRight {\n        from {\n          transform: translateX(400px);\n          opacity: 0;\n        }\n        to {\n          transform: translateX(0);\n          opacity: 1;\n        }\n      }\n      @keyframes slideOutRight {\n        from {\n          transform: translateX(0);\n          opacity: 1;\n        }\n        to {\n          transform: translateX(400px);\n          opacity: 0;\n        }\n      }\n    ",document.head.appendChild(e)}document.body.appendChild(a),setTimeout(()=>{a.style.animation="slideOutRight 0.3s ease-in",setTimeout(()=>{a.remove(),function(){const e=document.querySelectorAll(".quinoa-notification");let t=20;e.forEach(e=>{e.style.top=`${t}px`;const n=e.getBoundingClientRect();t=n.bottom-document.documentElement.getBoundingClientRect().top+10})}()},300)},6e3)}function xn(e){switch(e){case"rain":return"to freeze (C‚ÜíF)";case"snow":return"to freeze (W‚ÜíF)";case"dawn":return"to get Dawnlit";case"amber":return"to get Amberlit";default:return"for mutations"}}function wn(e){switch(e){case"rain":return"üåßÔ∏è";case"snow":return"‚ùÑÔ∏è";case"dawn":return"üåÖ";case"amber":return"üåÜ";case"sunny":return"‚òÄÔ∏è";default:return"‚ùì"}}const vn=Object.freeze(Object.defineProperty({__proto__:null,buildMutationSummary:gn,checkForMutations:async function(){Bt(),rt(),vt.enabled&&"sunny"!==Ct&&"unknown"!==Ct?await Wt():vt.enabled&&s("üå§Ô∏è Current weather is sunny or unknown - no mutations available")},combineMutationSources:an,computeSlotStateFromMutationNames:nn,createMutationCountMap:rn,deriveWeatherWindowFromSnapshot:Gt,resolveWeatherDurationMs:jt,setMutationReminderEnabled:function(e){vt.enabled=e,m.set(bt,vt),e?(Bt(),Dt()):(St?.(),St=null)},simulateWeather:async function(e){s(`üß™ [DEBUG] Simulating weather: ${e}`),Pt=!0,Bt();const t=function(e){switch(e){case"rain":return"rain";case"snow":return"snow";case"dawn":return"dawn";case"amber":return"amber";case"sunny":return"sunny";default:return null}}(e);t&&(!function(e,t=3e4){const n=Date.now()+Math.max(1e3,t);Oe={kind:e,expiresAt:n},tt(!0)}(t,3e4),rt()),Tt=Ct,Ct=e,bn(),vt.enabled&&"sunny"!==e&&"unknown"!==e?await Wt():s("üå§Ô∏è Simulated weather is sunny or unknown - no mutations available"),setTimeout(()=>{Pt=!1,s("üß™ [DEBUG] Simulation mode ended, auto-detection resuming")},3e4)},startMutationReminder:Lt},Symbol.toStringTag,{value:"Module"})),Cn="myDataAtom",Tn="__qpmGardenSnapshot__";let Sn=!1,kn=x(Tn)??null;const An=new Set;let Pn=null;const Mn=1500;function En(e){kn!==e&&(kn=e,function(){y(Tn,kn);for(const t of An)try{t(kn)}catch(e){s("‚ö†Ô∏è Garden listener error",e)}}())}function $n(e){if(!e||"object"!=typeof e)return null;return e.garden??null}async function Fn(){if(Sn)return;Sn=!0,Pn&&(clearTimeout(Pn),Pn=null);try{await M()}catch(t){return s("‚ö†Ô∏è Jotai store unavailable, garden bridge deferred",t),Sn=!1,void(Pn||(Pn=window.setTimeout(()=>{Pn=null,Fn()},Mn)))}try{const e=await async function(){const e=$(Cn);if(!e)throw new Error("Unable to locate myDataAtom in jotaiAtomCache");return $n(await F(e).catch(e=>(s("‚ö†Ô∏è Failed to read myDataAtom",e),null))??void 0)}();En(e)}catch(t){s("‚ö†Ô∏è Unable to prime garden snapshot",t),Pn||(Pn=window.setTimeout(()=>{Pn=null,Sn=!1,Fn()},Mn))}const e=$(Cn);if(!e)return s("‚ö†Ô∏è myDataAtom missing after initialization"),Sn=!1,void(Pn||(Pn=window.setTimeout(()=>{Pn=null,Fn()},Mn)));await I(e,e=>{En($n(e??void 0))})}function In(){return kn}function qn(e,t=!0){if(An.add(e),t)try{e(kn)}catch(n){s("‚ö†Ô∏è Garden listener immediate call failed",n)}return()=>{An.delete(e)}}let Nn=!1,zn=null,Rn="unknown",Ln=null,Dn=null;const Bn=["wet","dawn","amber"];function Hn(){Nn&&null===Ln&&(Ln=window.setTimeout(()=>{Ln=null,function(){if(!Nn)return;const e=function(e){const t=[];if(!e)return t;const n=[{label:"garden",tiles:e.tileObjects},{label:"boardwalk",tiles:e.boardwalkTileObjects}];for(const{label:o,tiles:r}of n)if(r&&"object"==typeof r)for(const[e,n]of Object.entries(r)){if(!n||"object"!=typeof n)continue;const r=n;if("plant"!==r.objectType)continue;const{slotStates:a,inferredSpecies:i}=jn(r),s=a.length;if(0===s)continue;const l=On(a),c=_n(a),d=an(a,l,c),u=`${Vn(r,i)} [${o}:${e}]`;t.push({name:u,mutations:d,element:document.createElement("div"),fruitCount:s,slotStates:a,slotSource:"garden",domMutationCounts:l,domBoldCounts:c})}return t}(zn),t={rain:[],snow:[],dawn:[],amber:[]},n=gn(e,Rn,Gt(Rn,Dn),(e,n,o)=>{const r={name:n.name,pendingFruit:o.pendingFruit,needsSnowFruit:o.needsSnowFruit,fruitCount:n.fruitCount,source:n.slotSource};o.tag&&(r.tag=o.tag),t[e].push(r)});gt("garden",n),pt({source:"garden",generatedAt:n.timestamp,summary:n,perWeather:t,metadata:mt(n,{scannedPlantCount:e.length})})}()},75))}function jn(e){const t=Array.isArray(e.slots)?e.slots:[],n=[];let o=null;for(const r of t){if(!r||"object"!=typeof r)continue;const e=r,t=Gn(e);t&&!o&&(o=t);const a=nn((Array.isArray(e.mutations)?e.mutations:[]).map(e=>"string"==typeof e?e:null).filter(e=>!!e));Wn(a,e),n.push(a)}return{slotStates:n,inferredSpecies:o}}function Gn(e){const t=[e.species,e.seedSpecies,e.plantSpecies,e.cropSpecies,e.name];for(const n of t)if("string"==typeof n){const e=n.trim();if(e.length>0)return e}return null}function Wn(e,t){const n=[t.progress,t.mutationProgress];for(const o of n){if(!o||"object"!=typeof o)continue;const t=o;for(const n of Bn){const o=t[n];if(!o||"object"!=typeof o)continue;const r=o,a=Number(r.complete),i=Number(r.total);if(!Number.isFinite(i)||i<=0)continue;if(!Number.isFinite(a)||a<0)continue;const s=e.progress[n];(!s||i>s.total||i===s.total&&a>s.complete)&&(e.progress[n]={complete:a,total:i})}}}function On(e){const t=rn(0);for(const n of e)n.hasFrozen&&(t.F+=1),n.hasWet&&(t.W+=1),n.hasChilled&&(t.C+=1),(n.hasDawnlit||n.hasDawnbound)&&(t.D+=1),(n.hasAmberlit||n.hasAmberbound)&&(t.A+=1),n.hasRainbow&&(t.R+=1),n.hasGold&&(t.G+=1);return t}function _n(e){return{D:e.filter(e=>e.hasDawnbound).length,A:e.filter(e=>e.hasAmberbound).length}}function Vn(e,t){const n=[e.name,e.displayName,e.plantName,e.label],o=e.plant;if(o&&"object"==typeof o){const e=o;n.push(e.name),n.push(e.displayName)}for(const r of n)if("string"==typeof r){const e=r.trim();if(e.length>0)return e}return t&&t.length>0?t.toLowerCase().includes("plant")?t:`${t} Plant`:"Unknown Plant"}function Un(e){switch(e){case"rain":case"snow":case"dawn":case"amber":return e;case"sunny":return"sunny";default:return"unknown"}}const Xn=[{name:"Wet",category:"weather",multiplier:2,aliases:["Rainy"]},{name:"Chilled",category:"weather",multiplier:2},{name:"Frozen",category:"weather",multiplier:10}],Jn=[{name:"Dawnlit",category:"time",multiplier:2,aliases:["Dawn-lit"]},{name:"Dawnbound",category:"time",multiplier:3,aliases:["Dawn bound"]},{name:"Dawncharged",category:"time",multiplier:3,aliases:["Dawn charged"]},{name:"Amberlit",category:"time",multiplier:5,aliases:["Amber lit"]},{name:"Ambershine",category:"time",multiplier:5,aliases:["Amber shine"]},{name:"Amberbound",category:"time",multiplier:6,aliases:["Amber Radiant","Amberradiant","Amber-radiant","Amber radiant"]},{name:"Ambercharged",category:"time",multiplier:6,aliases:["Amber charged"]}],Kn=[{name:"Gold",category:"color",multiplier:25,aliases:["Golden"]},{name:"Rainbow",category:"color",multiplier:50},...Xn,...Jn],Qn=[Zn("Wet","Dawnlit",3),Zn("Chilled","Dawnlit",3),Zn("Wet","Amberlit",6),Zn("Chilled","Amberlit",6),Zn("Wet","Ambershine",6),Zn("Chilled","Ambershine",6),Zn("Frozen","Dawnlit",11),Zn("Frozen","Dawnbound",12),Zn("Frozen","Dawncharged",12),Zn("Frozen","Amberlit",14),Zn("Frozen","Ambershine",14),Zn("Frozen","Amberbound",15),Zn("Frozen","Ambercharged",15)],Yn=function(e){const t=new Map;for(const n of e)if(t.set(to(n.name),n),n.aliases)for(const e of n.aliases)t.set(to(e),n);return t}(Kn);function Zn(e,t,n){return{weather:eo(Xn,e),time:eo(Jn,t),multiplier:n}}function eo(e,t){const n=e.find(e=>e.name===t);if(!n)throw new Error(`Missing canonical mutation definition for ${t}`);return n}function to(e){return e.trim().toLowerCase().replace(/[^a-z0-9]/g,"")}function no(e){const t=oo(e);return t?t.name:null}function oo(e){if(!e)return null;const t=to(e);return t?Yn.get(t)??null:null}function ro(e){if(!e||0===e.length)return{color:null,weather:null,time:null,combo:null,totalMultiplier:1};const{colors:t,weathers:n,times:o}=function(e){const t=[],n=[],o=[],r=[];if(!e||0===e.length)return{colors:t,weathers:n,times:o,unknown:r};for(const a of e){const e=oo(a);if(!e){r.push(a);continue}const i={definition:e,sourceName:a};"color"===e.category?t.push(i):"weather"===e.category?n.push(i):o.push(i)}return{colors:t,weathers:n,times:o,unknown:r}}(e),r=ao(t),a=ao(n),i=ao(o),s=a&&i?function(e,t){for(const n of Qn)if(n.weather===e&&n.time===t)return n;return null}(a.definition,i.definition):null,l=r?.definition.multiplier??1;let c=1;return s?c=s.multiplier:a&&i?c=Math.max(a.definition.multiplier,i.definition.multiplier):a?c=a.definition.multiplier:i&&(c=i.definition.multiplier),{color:r,weather:a,time:i,combo:s,totalMultiplier:l*c}}function ao(e){return e.length?e.reduce((e,t)=>e?t.definition.multiplier>e.definition.multiplier?t:e:t,null):null}const io={Sunflower:75e4,Starweaver:1e7,DawnCelestial:11e6,MoonCelestial:11e6,Lychee:5e4,DragonFruit:24500,PassionFruit:24500,Lemon:1e4,Pepper:7220,Grape:7085,Bamboo:5e5,Cactus:287e3,Mushroom:16e4,BurrosTail:6e3,Lily:20123,Banana:1750,Coconut:302,Echeveria:5520,Pumpkin:3700,Watermelon:2708,Corn:36,Daffodil:1090,Tomato:27,OrangeTulip:767,Apple:73,Blueberry:23,Aloe:310,Strawberry:14,Carrot:20};function so(e){return(new Intl.NumberFormat).format(Math.round(e))}function lo(e){const t=Math.abs(e),n=e<0?"-":"";return t>=1e12?`${n}${(t/1e12).toFixed(1)}T`:t>=1e9?`${n}${(t/1e9).toFixed(1)}B`:t>=1e6?`${n}${(t/1e6).toFixed(1)}M`:t>=1e3?`${n}${(t/1e3).toFixed(1)}K`:`${n}${Math.round(t)}`}function co(e,t=1,n,o=1){const r=io[e];if(!r)return 0;const a=function(e){return e&&0!==e.length?ro(e).totalMultiplier:1}(n??[]);return Math.round(r*a*t*o)}function uo(e){return e.map(e=>({tileId:e.tileId,slotIndex:e.slotIndex,species:e.species,mutations:[...e.mutations]}))}const po=new Map;let mo="";"number"!=typeof h.devicePixelRatio||h.devicePixelRatio;let fo=[],go=null;function ho(){mo="",fo=[],go=null,po.clear()}h.document??document;const bo={Rainbow:{label:"Rainbow",highlightNames:["Rainbow"],canonicalNames:["Rainbow"]},Gold:{label:"Gold",highlightNames:["Gold"],canonicalNames:["Gold"]},Frozen:{label:"Frozen",highlightNames:["Frozen"],canonicalNames:["Frozen"]},Wet:{label:"Wet",highlightNames:["Wet"],canonicalNames:["Wet"]},Chilled:{label:"Chilled",highlightNames:["Chilled"],canonicalNames:["Chilled"]},Dawnlit:{label:"Dawnlit",highlightNames:["Dawnlit"],canonicalNames:["Dawnlit"]},Amberlit:{label:"Amberlit",highlightNames:["Amberlit","Ambershine"],canonicalNames:["Amberlit","Ambershine"]},Amberbound:{label:"Amberbound",highlightNames:["Amberbound","Ambercharged","Amber Radiant","Amberradiant","Amber-radiant"],canonicalNames:["Amberbound","Ambercharged"]},Dawnbound:{label:"Dawnbound (charged)",highlightNames:["Dawnbound","Dawncharged"],canonicalNames:["Dawnbound","Dawncharged"]}},yo=1.5,xo=new Set,wo=new Set,vo={enabled:!1,highlightEnabled:!0,toastEnabled:!0,minSize:80,selectedMutations:{Rainbow:!0,Gold:!1,Frozen:!1,Wet:!1,Chilled:!1,Dawnlit:!1,Amberlit:!1,Amberbound:!1,Dawnbound:!1}};let Co=!1,To=null,So={readyCount:0,mutatedCount:0,totalValue:0,highestValue:null,friendBonus:yo},ko=null,Ao="unknown",Po=[],Mo=new Set,Eo=null;function $o(e){if("boolean"==typeof e.enabled&&(vo.enabled=e.enabled),"boolean"==typeof e.highlightEnabled&&(vo.highlightEnabled=e.highlightEnabled,vo.highlightEnabled?Po.length>0&&Bo(Po):jo()),"boolean"==typeof e.toastEnabled&&(vo.toastEnabled=e.toastEnabled),"number"==typeof e.minSize&&(vo.minSize=Math.min(100,Math.max(50,Math.round(e.minSize)))),e.selectedMutations)for(const t of Object.keys(bo)){const n=e.selectedMutations[t];"boolean"==typeof n&&(vo.selectedMutations[t]=n)}vo.enabled&&Io(),vo.enabled?No():(Po=[],Mo.clear(),So={readyCount:0,mutatedCount:0,totalValue:0,highestValue:null,friendBonus:yo},Fo(),Ho())}function Fo(){for(const t of xo)try{t(So)}catch(e){s("‚ö†Ô∏è Harvest summary listener error",e)}}function Io(){ot(),ko||(ko=at(qo,!0))}function qo(e){const t=function(e){return"weather"===e.raw?"weather":"noweather"===e.raw?"noweather":"unknown"}(e);t!==Ao&&(Ao=t,"noweather"===Ao&&Mo.clear(),vo.enabled?No():"noweather"!==Ao&&jo())}function No(){if(!vo.enabled)return;const e=To??In();if(!e||!e.tileObjects)return Do([]),void Ho();const t=function(e,t,n){const o=[];if(!e||!e.tileObjects)return o;for(const[r,a]of Object.entries(e.tileObjects)){if(!a||"object"!=typeof a)continue;const e=a;if("plant"!==e.objectType)continue;(Array.isArray(e.slots)?e.slots:[]).forEach((e,a)=>{const i="string"==typeof e?.species?e.species:null;if(!i)return;const s=e?.endTime??e?.readyAt??e?.harvestReadyAt,l="number"==typeof s?s:Number(s);if(!Number.isFinite(l)||l>n)return;const c=(Array.isArray(e?.mutations)?e.mutations:[]).filter(e=>"string"==typeof e);if(!Ro(c,t))return;const d=e?.targetScale,u="number"==typeof d&&Number.isFinite(d)?d:1,p=Lo(u,i,e);if(p<vo.minSize)return;const m=ro(c),f=c.filter(e=>!no(e)),g=co(i,u,c,yo),h=`${r}:${a}`;o.push({key:h,tileId:r,slotIndex:a,species:i,mutations:c,size:p,value:g,multiplier:m,unknownMutations:f})})}return o.sort((e,t)=>t.value-e.value),o}(e,zo(),Date.now());Do(t),Bo(t),function(e){if(!vo.toastEnabled)return;if(0===e.length)return;const t=e.filter(e=>!Mo.has(e.key));if(0===t.length)return;for(const r of t)Mo.add(r.key);const n=function(e){const{species:t,size:n,value:o,multiplier:r,mutations:a,unknownMutations:i}=e,s=Go(r,i),l=Wo(r.totalMultiplier),c=a.length?s:"No bonus mutations";return`üåæ ${t} ‚Äî ${c} ‚Üí total x${l} ‚Ä¢ size ${n} (~${so(o)} coins)`}(t[0]);for(const r of wo)try{r(n)}catch(o){s("‚ö†Ô∏è Harvest toast listener error",o)}try{window.queueNotification?.(n,!1)}catch(o){s("‚ö†Ô∏è Failed to queue harvest notification",o)}}(t)}function zo(){return Object.keys(bo).filter(e=>vo.selectedMutations[e])}function Ro(e,t){if(0===t.length)return!0;if(!e||0===e.length)return!1;const n=new Set;for(const o of e){const e=no(o);e&&n.add(e)}return 0!==n.size&&t.some(e=>bo[e].canonicalNames.some(e=>n.has(e)))}function Lo(e,t,n){const o=Number.isFinite(e)&&e>0?e:1;let r=null;if(n&&"object"==typeof n){const e=Number(n.maxScale);Number.isFinite(e)&&e>1&&(r=e)}if("number"!=typeof r||!Number.isFinite(r)||r<=1){const e=c(t);r=(e?p(e):null)??2}const a=Math.max(1.01,r),i=Math.min(a,Math.max(1,o)),s=50+50*(a>1?(i-1)/(a-1):0);return Math.round(s)}function Do(e){if(Po=e,0===e.length)So={readyCount:0,mutatedCount:0,totalValue:0,highestValue:null,friendBonus:yo};else{const t=e[0];So={readyCount:e.length,mutatedCount:e.filter(e=>e.mutations.length>0).length,totalValue:e.reduce((e,t)=>e+t.value,0),highestValue:{species:t.species,value:t.value,mutations:t.mutations,size:t.size,multiplier:t.multiplier,breakdownText:Go(t.multiplier,t.unknownMutations),totalMultiplierText:Wo(t.multiplier.totalMultiplier),unknownMutations:t.unknownMutations},friendBonus:yo}}Fo()}function Bo(e){if(!vo.highlightEnabled)return void Ho();const t=e.map(e=>e.key).join("|");if(t!==Eo)if(Eo=t,0!==e.length){!function(e,t){try{{const n=e.map(e=>`${e.tileId}:${e.slotIndex}:${e.species}:${e.mutations.join(",")}`).join("|");return n!==mo&&(mo=n,fo=uo(e),go=t,0===e.length&&ho()),!0}}catch(n){return s("‚ö†Ô∏è Garden highlight overlay update failed",n),!1}}(e,To);try{const t=h.highlightTilesByMutation;if("function"!=typeof t)return;try{const e=h.removeAllTileOverrides;"function"==typeof e&&e.call(h)}catch(n){s("‚ö†Ô∏è Failed to clear previous highlights",n)}const o=Array.from(new Set(e.map(e=>e.species))),r=function(){const e=[];for(const t of zo())e.push(...bo[t].highlightNames);return Array.from(new Set(e))}(),a=o.map(()=>r.length>0?r[0]:null),i={highlightSpecies:o,highlightMutations:a,slotIndex:0,highlightScale:null,hiddenSpecies:"Carrot",hiddenScale:.1};y("__qpmHarvestDebugConfig",{...i,attemptedMutations:r}),t.call(h,i);const l=h.setTimeout;l?.call(h,()=>{try{h.dispatchEvent?.(new Event("visibilitychange"))}catch(n){s("‚ö†Ô∏è Failed to nudge render after highlight",n)}},120)}catch(n){s("‚ö†Ô∏è Failed to apply harvest highlight",n)}}else Ho()}function Ho(){Eo=null,jo()}function jo(){try{const e=h.removeAllTileOverrides;"function"==typeof e&&e.call(h)}catch(e){s("‚ö†Ô∏è Unable to clear harvest highlights",e)}ho()}function Go(e,t){const n=[];if(e.color&&n.push(`${e.color.definition.name} x${Wo(e.color.definition.multiplier)}`),e.combo?n.push(`${e.combo.weather.name} + ${e.combo.time.name} combo x${Wo(e.combo.multiplier)}`):(e.weather&&n.push(`${e.weather.definition.name} x${Wo(e.weather.definition.multiplier)}`),e.time&&n.push(`${e.time.definition.name} x${Wo(e.time.definition.multiplier)}`)),n.length||1!==e.totalMultiplier||n.push("No bonus mutations"),t.length){const e=1===t.length?"1 unrecognized mutation":`${t.length} unrecognized mutations`;n.push(e)}return n.join(" + ")}function Wo(e){return Number.isInteger(e)?e.toString():e.toFixed(2)}const Oo={worm:500,snail:1e3,bee:1500,chicken:3e3,bunny:750,dragonfly:250,pig:5e4,cow:25e3,squirrel:15e3,turtle:1e5,goat:2e4,butterfly:25e3,capybara:15e4,peacock:1e5};const _o={Bee:12,Butterfly:12,Ladybug:12,Dragonfly:12,Frog:18,Snake:18,Turtle:18,Lizard:18,Peacock:24,Swan:24,Flamingo:24,Unicorn:36,Dragon:36,Phoenix:36};function Vo(e){const t=function(e){if(!e)return null;const t=e.toLowerCase().trim();for(const[n,o]of Object.entries(_o))if(n.toLowerCase()===t)return o;for(const[n,o]of Object.entries(_o))if(t.includes(n.toLowerCase())||n.toLowerCase().includes(t))return o;return null}(e);return t?3600*t:null}const Uo=new Map,Xo=new Set;function Jo(e){const t={currentLevel:null,maxLevel:30,confidence:"none",totalXPNeeded:null,xpGainRate:null};if(!e.petId||null==e.xp)return t;const n=Uo.get(e.petId);if(!n||n.length<2)return t;const o=function(e){if(e.length<2)return null;const t=e[0],n=e[e.length-1],o=n.xp-t.xp,r=(n.timestamp-t.timestamp)/1e3;return r<=0||o<=0?null:o/r}(n);if(!o)return t;const r=Vo(e.species);if(!r)return e.species&&!Xo.has(e.species)&&(Xo.add(e.species),s(`‚ö†Ô∏è No time-to-mature data for species: ${e.species}`)),{...t,xpGainRate:o};const a=o*r;let i=e.xp/a*30;i=Math.max(0,Math.min(30,i));const l=(n[n.length-1].timestamp-n[0].timestamp)/1e3;let c="low";return n.length>=5&&l>=300?c="high":n.length>=3&&l>=120&&(c="medium"),{currentLevel:Math.round(i),maxLevel:30,confidence:c,totalXPNeeded:a,xpGainRate:o}}let Ko=[],Qo=null,Yo=!1;const Zo=new Set;let er=null;function tr(e){if(null==e)return null;if("number"==typeof e)return Number.isFinite(e)?e:null;if("string"==typeof e){const t=e.match(/-?\d+(?:\.\d+)?/);if(!t)return null;const n=Number(t[0]);return Number.isFinite(n)?n:null}return"object"==typeof e?tr(e?.valueOf?.()):null}function nr(e){return Number.isFinite(e)?e<0?0:e>100?100:e:0}function or(e,t=!1){if(!Number.isFinite(e))return null;if(e<0)return 0;if(e>0&&e<=1)return 100*e;if(e>=0&&e<=100)return e;if(t&&e>100&&e<=1e4){const t=e/100;if(t<=100)return t}return null}function rr(e,t,n,o){const r=t.pet??e.pet??null,a=[{value:e.hungerPct,hint:"entry.hungerPct"},{value:e.hunger_percentage,hint:"entry.hunger_percentage"},{value:e.hunger,hint:"entry.hunger"},{value:t.hungerPct,hint:"slot.hungerPct"},{value:t.hunger_percentage,hint:"slot.hunger_percentage"},{value:t.hunger,hint:"slot.hunger"},{value:n?.hungerPct,hint:"stats.hungerPct"},{value:n?.hunger,hint:"stats.hunger"},{value:r?.hungerPct,hint:"nested.hungerPct"},{value:r?.hunger,hint:"nested.hunger"}];let i=null;const s=[],l=[];for(const{value:u,hint:p}of a){if(null==u)continue;null==i&&(i=String(u));const e=tr(u);if(null==e)continue;const t=/pct|percent/i.test(p),n=or(e,t);null!=n&&(t||e<=100)?s.push(n):l.push(e)}const c=l.length>0?l[0]:null,d=o?function(e){if(!e)return null;const t=function(e){return e.replace(/[^a-z0-9]/gi,"").toLowerCase()}(e);return t?Oo[t]??null:null}(o):null;if(s.length){return{pct:nr(s[0]),value:c,max:d,raw:i}}if(null!=c){if(null!=d&&d>0){return{pct:nr(c/d*100),value:c,max:d,raw:i}}if(c>0){return{pct:nr(c/3e3*100),value:c,max:3e3,raw:i}}return{pct:0,value:c,max:d,raw:i}}return{pct:null,value:null,max:d,raw:i}}function ar(e){const t=e.slot??{},n=[e.name,e.displayName,t.name,t.displayName];for(const o of n)if("string"==typeof o&&o.trim().length>0)return o.trim();return null}function ir(e){if(!e)return[];if(Array.isArray(e))return e.filter(e=>!!e&&"object"==typeof e);if(e instanceof Map)return Array.from(e.values()).filter(e=>!!e&&"object"==typeof e);if(e instanceof Set)return Array.from(e.values()).filter(e=>!!e&&"object"==typeof e);if("object"==typeof e){const t=e,n=[];for(const[e,o]of Object.entries(t))/^\d+$/.test(e)&&o&&"object"==typeof o&&n.push(o);if(n.length)return n}return[]}function sr(e){const t=e.slot;return t&&"object"==typeof t?t:e}function lr(e){if(null==e)return null;if("string"==typeof e){const t=e.trim();return t.length>0?t:null}return"number"==typeof e&&Number.isFinite(e)?String(e):null}function cr(e){const t=new Set,n=[];for(const o of e){const e=o.toLowerCase();t.has(e)||(t.add(e),n.push(o))}return n}function dr(e){if(!e)return[];if("string"==typeof e){const t=lr(e);return t?[t]:[]}if(Array.isArray(e)){const t=[];for(const n of e){const e=lr(n);e&&t.push(e)}return t}return e instanceof Set?dr(Array.from(e.values())):[]}function ur(e){const t=sr(e),n=t.pet??e.pet??null,o=[e.slotId,t.slotId,t.slotID,t.id,n?.slotId,n?.id,e.id];for(const r of o){const e=lr(r);if(e)return e}return null}function pr(e){const t=sr(e),n=t.pet??e.pet??null,o=[e.petId,t.petId,n?.petId,n?.id,t.id,e.entityId];for(const r of o){const e=lr(r);if(e)return e}return ur(e)}function mr(e){const t=sr(e),n=t.pet??e.pet??null;return cr([...dr(e.mutations),...dr(t.mutations),...dr(n?.mutations)])}function fr(e){const t=sr(e),n=t.pet??e.pet??null;return cr([...dr(e.abilities),...dr(t.abilities),...dr(t.ability),...dr(n?.abilities)])}function gr(e){const t=sr(e),n=[e.position,e.pos,t.position,t.pos];for(const o of n){if(!o||"object"!=typeof o)continue;const e=o,t=tr(e.x??e.X??e.left??e.posX??e.longitude),n=tr(e.y??e.Y??e.top??e.posY??e.latitude);if(null!=t||null!=n)return{x:t??null,y:n??null}}return null}function hr(e){const t=function(e){const t=[e],n=new Set;for(;t.length;){const e=t.shift();if(null==e)continue;const o=ir(e);if(o.length)return o;if("object"==typeof e){if(n.has(e))continue;if(n.add(e),e instanceof Map){for(const n of e.values())t.push(n);continue}if(e instanceof Set){for(const n of e.values())t.push(n);continue}const o=e;for(const e of Object.values(o))t.push(e)}}return[]}(e);if(!t.length)return[];const n=Date.now(),o=[],r=function(){const e=[];try{const t=document.querySelectorAll("p.chakra-text.css-1jrst1o");for(const n of t){const t=(n.textContent||"").match(/\bSTR\s+(\d+)\b/i);if(t&&t[1]){const n=parseInt(t[1],10);e.includes(n)||e.push(n)}}}catch(t){}return e}();return t.forEach((e,t)=>{if(!e||"object"!=typeof e)return;const a=e,i=sr(a),s=i.stats??void 0,l=i.pet??a.pet??void 0,c=function(e,t){const n=[e.slotIndex,e.slot?.slotIndex,e.order,e.index,e.slot?.index,e.slot?.originalIndex,e.slot?.orderedIndex,t];for(const o of n){const e=tr(o);if(null!=e&&Number.isFinite(e))return Math.max(0,Math.round(e))}return t}(a,t),d=function(e){const t=e.slot??{},n=[e.species,t.species,t.petSpecies,e.petSpecies];for(const o of n)if("string"==typeof o&&o.trim().length>0)return o.trim();return null}(a),u=rr(a,i,s,d),p=[i.xp,s?.xp,a.xp];let m=null;for(const n of p){const e=tr(n);if(null!=e){m=e;break}}const f=[i.level,s?.level,a.level,l?.level];let g=null,h=null;for(const n of f){null!=n&&null==h&&(h="string"==typeof n?n:String(n));const e=tr(n);if(null!=e){g=Math.max(0,Math.round(e));break}}const b=[i.strength,s?.strength,a.strength];let y=null;for(const n of b){const e=tr(n);if(null!=e){y=e;break}}null==y&&c<r.length&&(y=r[c]??null);const x=[i.targetScale,s?.targetScale,a.targetScale,l?.targetScale];let w=null;for(const n of x){const e=tr(n);if(null!=e){w=e;break}}const v={slotIndex:c,slotId:ur(a),petId:pr(a),hungerPct:u.pct,hungerValue:u.value,hungerMax:u.max,hungerRaw:u.raw,name:ar(a),species:d,targetScale:w,mutations:mr(a),abilities:fr(a),xp:m,level:g,levelRaw:h,strength:y,position:gr(a),updatedAt:n,raw:e};if(null==v.level&&null!=v.xp&&v.petId){!function(e){if(!e.petId||null==e.xp)return;const t=Date.now();let n=Uo.get(e.petId);n||(n=[],Uo.set(e.petId,n)),n.push({xp:e.xp,timestamp:t}),n.length>10&&n.shift()}(v);const e=Jo(v);null!=e.currentLevel&&(v.level=e.currentLevel)}o.push(v)}),o.sort((e,t)=>e.slotIndex-t.slotIndex)}async function br(){if(!Qo&&!Yo){Yo=!0;try{const e=$("myPetInfosAtom");if(!e)throw new Error("myPetInfosAtom not found in jotai cache");Qo=await I(e,e=>{Ko=hr(e),function(){for(const t of Zo)try{t(Ko)}catch(e){s("‚ö†Ô∏è Pet info listener threw",e)}}()}),null!=er&&(window.clearTimeout(er),er=null)}catch(e){s("‚ö†Ô∏è Failed to start pet info store",e),null==er&&(er=window.setTimeout(()=>{er=null,Qo||br()},1500))}finally{Yo=!1}}}function yr(){return Ko}function xr(){return Ko}function wr(e,t=!0){if(Zo.add(e),t)try{e(Ko)}catch(n){s("‚ö†Ô∏è Pet info immediate callback failed",n)}return()=>{Zo.delete(e)}}const vr=/myCurrentGrowSlotIndex/i;let Cr=!1,Tr=!1,Sr=null,kr=null;const Ar=new Set;function Pr(e){const t="number"==typeof(n=e)&&Number.isFinite(n)?Math.max(0,Math.trunc(n)):null;var n;if(Sr!==t){Sr=t;try{h.__qpmCurrentGrowSlotIndex=t,"undefined"!=typeof window&&(window.__qpmCurrentGrowSlotIndex=t)}catch{}!function(e){for(const n of Ar)try{n(e)}catch(t){s("‚ö†Ô∏è Grow slot index listener error",t)}}(Sr)}}async function Mr(){try{await M()}catch(t){throw s("‚ö†Ô∏è Grow slot index tracker: jotai store unavailable",t),t}const e=await async function(){let e=$("myCurrentGrowSlotIndexAtom");return e||(E(vr)[0]??null)}();if(!e)throw new Error("myCurrentGrowSlotIndexAtom not found");try{Pr(await F(e).catch(()=>null))}catch(t){s("‚ö†Ô∏è Grow slot index tracker: failed to read initial value",t)}await I(e,e=>{Pr(e)})}async function Er(){if(!Cr&&!Tr){Tr=!0;try{await Mr(),Cr=!0}catch(e){return s("‚ö†Ô∏è Grow slot index tracker initialization failed",e),void(null==kr&&"undefined"!=typeof window&&(kr=window.setTimeout(()=>{kr=null,Tr=!1,Er()},2500)))}finally{Tr=!1}}}const $r="qpm-turtle-manual-overrides";let Fr={};function Ir(){try{m.set($r,Fr)}catch(e){s("‚ö†Ô∏è Failed to save manual pet overrides",e)}}function qr(e){return e.petId?`pet:${e.petId}`:e.species?`${e.species}:${e.slotIndex}`:`slot:${e.slotIndex}`}const Nr=[{kind:"plant",patterns:["plantgrowthboost"],minutesPerBase:5,procOdds:.27},{kind:"egg",patterns:["egggrowthboost"],minutesPerBase:10,procOdds:.24}],zr={restore:["hungerrestore"],slow:["hungerboost"]},Rr=[0,30,35,40,45],Lr=[0,.12,.14,.16,.18],Dr=[0,12,16,20,24];function Br(e,t,n){const o=function(e,t){const n=e.match(/\b(IV|III|II|I)\b/i);if(n)switch(n[1].toUpperCase()){case"I":return 1;case"II":return 2;case"III":return 3;case"IV":return 4}const o=e.match(/\b(\d+)\b/);if(o){const e=Number.parseInt(o[1],10);if(Number.isFinite(e)&&e>0)return e}return t.endsWith("iv")?4:t.endsWith("iii")?3:t.endsWith("ii")?2:1}(t,n);if("restore"===e){return{effectPct:Rr[Math.min(o,Rr.length-1)]??Rr[1],procOdds:Lr[Math.min(o,Lr.length-1)]??Lr[1]}}if("slow"===e){return{effectPct:Dr[Math.min(o,Dr.length-1)]??Dr[1],procOdds:null}}return null}function Hr(e,t){if(!t||t<=0||e<=0)return 0;const n=Math.min(.95,Math.max(0,t*(e/100)));return 60*(1-Math.pow(1-n,1/60))}function jr(e){if(!e)return!1;const t=e.toLowerCase();return!t.includes("eggplant")&&t.includes("egg")}function Gr(e){if(!e)return!1;const t=e.toLowerCase();return t.includes("plant")||t.includes("crop")}function Wr(e){return!!jr(e.objectType)||(!!jr(e.slotType)||(!!jr(e.slotCategory)||(!!jr(e.slotKind)||(!!jr(e.tileObjectType)||(!!jr(e.tileCategory)||(!!jr(e.seedSpecies)||(!!jr(e.plantSpecies)||(!!jr(e.eggId)||(!!jr(e.eggSpecies)||function(e){if(!e)return!1;const t=e.toLowerCase();return!t.includes("eggplant")&&/\begg\b/.test(t)}(e.species))))))))))}const Or="::";let _r={enabled:!0,includeBoardwalk:!0,minActiveHungerPct:2,fallbackTargetScale:1.5,focus:"latest",maxTargetScale:2.5,focusTargetTileId:null,focusTargetSlotIndex:null,eggFocus:"latest",eggFocusTargetTileId:null,eggFocusTargetSlotIndex:null},Vr=!1,Ur=In(),Xr=xr();const Jr=new Set;function Kr(e){return e.toLowerCase().replace(/[^a-z0-9]/g,"")}function Qr(e="no-data"){return{status:e,trackedSlots:0,growingSlots:0,maturedSlots:0,contributions:[],expectedMinutesRemoved:null,effectiveRate:null,naturalMsRemaining:null,adjustedMsRemaining:null,minutesSaved:null,focusSlot:null}}function Yr(){return{enabled:_r.enabled,now:Date.now(),includeBoardwalk:_r.includeBoardwalk,focus:_r.focus,focusTargetKey:null,focusTargetAvailable:!1,eggFocus:_r.eggFocus,eggFocusTargetKey:null,eggFocusTargetAvailable:!1,minActiveHungerPct:_r.minActiveHungerPct,fallbackTargetScale:_r.fallbackTargetScale,availableTurtles:0,hungerFilteredCount:0,turtlesMissingStats:0,plant:Qr(),plantTargets:[],egg:Qr(),eggTargets:[],support:{restoreCount:0,restoreActiveCount:0,slowCount:0,slowActiveCount:0,restorePctTotal:0,restorePctActive:0,restorePctPerHourTotal:0,restorePctPerHourActive:0,restoreTriggersPerHourTotal:0,restoreTriggersPerHourActive:0,slowPctTotal:0,slowPctActive:0,entries:[]}}}function Zr(e,t){return e&&null!=t?`${e}${Or}${t}`:null}let ea=Yr();function ta(e){if("number"==typeof e&&Number.isFinite(e))return e;if("string"==typeof e){const t=Number(e);if(Number.isFinite(t))return t}return null}function na(e,t){const n=[];if(!e)return n;const o=(e,t)=>{for(const n of t){const t=e[n];if("string"==typeof t&&t.trim().length>0)return t}return null},r=(e,t)=>{if("number"==typeof e&&Number.isFinite(e))return e;if("string"==typeof e){const t=Number(e);if(Number.isFinite(t))return t}return t},a=(e,t,n,a,i)=>{const s=r(n.slotIndex,r(i.slotIndex,a)),l=ta(n.endTime??n.maturedAt??n.readyAt??n.harvestReadyAt??n.finishAt??i.endTime??i.maturedAt??i.readyAt??i.harvestReadyAt??i.finishAt),c=ta(n.readyAt??n.maturedAt??n.harvestReadyAt??n.endTime??i.readyAt??i.maturedAt??i.harvestReadyAt??i.endTime),d=ta(n.plantedAt??n.startTime??n.startedAt??i.plantedAt??i.startTime??i.startedAt),u=o(i,["objectType","object_type"]),p=o(i,["slotCategory","category","slot_category"]),m=o(n,["objectType","object_type"])??u,f=o(n,["type","slotType","slot_type"]),g=o(n,["category","slotCategory","slot_category"]),h=o(n,["kind"]),b={tileId:e,slotIndex:s,species:o(n,["species","seedSpecies","plantSpecies","petSpecies"])??o(i,["species","seedSpecies","plantSpecies","petSpecies"]),seedSpecies:o(n,["seedSpecies"])??o(i,["seedSpecies"]),plantSpecies:o(n,["plantSpecies"])??o(i,["plantSpecies"]),eggId:o(n,["eggId","eggID"])??o(i,["eggId","eggID"]),eggSpecies:o(n,["eggSpecies","eggType"])??o(i,["eggSpecies","eggType"]),boardwalk:t,endTime:l,readyAt:c,plantedAt:d,slotType:f,slotCategory:g,objectType:m,tileObjectType:u,tileCategory:p,slotKind:h};return(e=>!!(Gr(e.objectType)||Gr(e.tileObjectType)||Gr(e.slotType)||Gr(e.slotCategory)||Gr(e.tileCategory)||jr(e.objectType)||jr(e.slotType)||jr(e.slotCategory)||jr(e.slotKind)||jr(e.tileObjectType)||jr(e.tileCategory)||jr(e.species)||jr(e.seedSpecies)||jr(e.plantSpecies)||jr(e.eggId)||jr(e.eggSpecies)||e.species||e.seedSpecies||e.plantSpecies||null!=e.endTime||null!=e.readyAt||null!=e.plantedAt))(b)?b:null},i=(e,t)=>{if(!e||"object"!=typeof e)return;const o=Object.entries(e);for(const[r,i]of o){if(!i||"object"!=typeof i)continue;const e=i,o=Array.isArray(e.slots)?e.slots:[];let s=!1;if(o.forEach((o,i)=>{if(!o||"object"!=typeof o)return;const l=a(r,t,o,i,e);l&&(n.push(l),s=!0)}),!s){const o=a(r,t,e,0,e);o&&n.push(o)}}};return i(e.tileObjects??null,!1),t&&i(e.boardwalkTileObjects??null,!0),n}function oa(e){const t=function(e){const t=qr(e);return Fr[t]??null}(e);let n="number"==typeof e.xp&&Number.isFinite(e.xp)?e.xp:null;null==n&&null!=t?.xp&&(n=t.xp);let o=e.targetScale;null==o&&null!=t?.targetScale&&(o=t.targetScale);const r="number"==typeof(a=o)&&Number.isFinite(a)?a<1?1:a>_r.maxTargetScale?_r.maxTargetScale:a:_r.fallbackTargetScale;var a;let i="number"==typeof e.strength&&Number.isFinite(e.strength)?e.strength:null;null==i&&null!=t?.strength&&(i=t.strength);const s=null==e.xp||null==e.targetScale,l=t&&(null!=t.xp||null!=t.targetScale||null!=t.strength);let c;if(null!=i)c=Math.max(0,i);else{const e=Math.min(Math.floor((n??0)/36e4*30),30),t=Math.floor((r-1)/(_r.maxTargetScale-1)*20+80)-30;c=Math.max(0,e+t)}return{xp:n,targetScale:r,baseScore:c,missingStats:s&&!l}}function ra(e,t,n){const o=oa(e),{xp:r,targetScale:a,baseScore:i,missingStats:s}=o,l=i>0?i/100*t.minutesPerBase*60*(1-Math.pow(1-t.procOdds*i/100,1/60)):0,c=60*l;return{ability:t.kind,abilityNames:n,slotIndex:e.slotIndex,name:e.name,species:e.species,hungerPct:e.hungerPct,xp:r,targetScale:a,baseScore:i,rateContribution:l,perHourReduction:c,missingStats:s}}function aa(e,t,n,o,r,a,i,s){const l=t.filter(e=>null!=e.endTime).length,c=t.filter(e=>null!=e.endTime&&e.endTime>o).length,d=t.filter(e=>null!=e.endTime&&e.endTime<=o).length,u={status:"no-data",trackedSlots:l,growingSlots:c,maturedSlots:d,contributions:n.slice().sort((e,t)=>t.rateContribution-e.rateContribution),expectedMinutesRemoved:null,effectiveRate:null,naturalMsRemaining:null,adjustedMsRemaining:null,minutesSaved:null,focusSlot:null};if(0===t.length||0===l)return u;if(0===c)return{...u,status:"egg"===e?"no-eggs":"no-crops"};const p=function(e,t,n,o,r){const a=e.filter(e=>null!=e.endTime&&e.endTime>r);if(!a.length)return null;if("specific"===t){if(n&&null!=o){const e=a.find(e=>e.tileId===n&&e.slotIndex===o);if(e)return e}return null}return"earliest"===t?a.reduce((e,t)=>e?(t.endTime??1/0)<(e.endTime??1/0)?t:e:t,a[0]):a.reduce((e,t)=>e?(t.endTime??-1/0)>(e.endTime??-1/0)?t:e:t,a[0])}(t,a,i,s,o);if(!p||null==p.endTime)return{...u,status:"no-data"};const m=Math.max(0,p.endTime-o),f=m/6e4,g=n.reduce((e,t)=>e+t.rateContribution,0),h=Number.isFinite(g)&&g>0,b=h?g:0,y=h?Math.max(.01,1+b):1,x=f/Math.max(.01,y),w=6e4*x,v=h?Math.max(0,f-x):null;return{status:h?"estimating":"no-turtles",trackedSlots:l,growingSlots:c,maturedSlots:d,contributions:u.contributions,expectedMinutesRemoved:h?b:null,effectiveRate:h?y:null,naturalMsRemaining:m,adjustedMsRemaining:h?w:m,minutesSaved:v,focusSlot:{...p,remainingMs:m}}}function ia(e){return e.petId??e.slotId??`${e.slotIndex}-${e.name??"pet"}`}function sa(e){ea=e;for(const n of Jr)try{n(ea)}catch(t){s("‚ö†Ô∏è Turtle timer listener error",t)}}function la(){const e=Date.now(),t=Yr();if(t.now=e,!_r.enabled)return t.enabled=!1,t.plant.status="disabled",t.egg.status="disabled",void sa(t);const n=na(Ur,_r.includeBoardwalk),o=n.filter(e=>Wr(e)),r=n.filter(e=>!Wr(e)),a=[],i=[],s=[],l=new Set,c=new Set,d=new Set;for(const F of Xr){if(!F||"object"!=typeof F)continue;const e=Array.isArray(F.abilities)?F.abilities.filter(e=>"string"==typeof e&&e.trim().length>0).map(e=>({raw:e,normalized:Kr(e)})):[];if(0===e.length)continue;const t=ia(F),n=F.hungerPct,o=null==n||n>_r.minActiveHungerPct;let r=!1;for(const s of Nr){const n=e.filter(({normalized:e})=>s.patterns.some(t=>e.includes(t))).map(({raw:e})=>e);if(0===n.length)continue;if(r=!0,l.add(t),!o){c.add(t);continue}const u=ra(F,s,n);u.missingStats&&d.add(t),u.rateContribution<=0||("plant"===s.kind?a.push(u):i.push(u))}const u=oa(F);for(const a of Object.keys(zr)){const t=e.filter(({normalized:e})=>zr[a].some(t=>e.includes(t))).map(({raw:e})=>e);if(0===t.length)continue;const r=[];let i=0,l=0,c=0,d=0;for(const e of t){const t=Kr(e),n=Br(a,e,t);if(n)if("restore"===a){const o=Hr(u.baseScore,n.procOdds),a=60*o,s=a*n.effectPct;i+=n.effectPct,l+=s,c+=a,r.push({abilityName:e,normalizedName:t,perTriggerPct:n.effectPct,slowdownPct:null,triggersPerHour:a,pctPerHour:s,probabilityPerMinute:o})}else d+=n.effectPct,r.push({abilityName:e,normalizedName:t,perTriggerPct:null,slowdownPct:n.effectPct,triggersPerHour:null,pctPerHour:null,probabilityPerMinute:null})}0!==r.length&&s.push({type:a,abilityNames:t,slotIndex:F.slotIndex,name:F.name,species:F.species,hungerPct:n,active:o,xp:u.xp,targetScale:u.targetScale,baseScore:u.baseScore,missingStats:u.missingStats,abilityDetails:r,totalRestorePerTriggerPct:i,totalRestorePerHourPct:l,totalTriggersPerHour:c,totalSlowPct:d})}r||o||c.add(t)}const u=_r.focusTargetTileId,p=_r.focusTargetSlotIndex,m=aa("plant",r,a,e,0,_r.focus,u,p),f=_r.eggFocusTargetTileId,g=_r.eggFocusTargetSlotIndex,h=aa("egg",o,i,e,0,_r.eggFocus,f,g);let b=0,y=0,x=0,w=0,v=0,C=0,T=0,S=0,k=0,A=0,P=0,M=0;s.sort((e,t)=>e.type===t.type?e.active===t.active?(e.name??"").localeCompare(t.name??""):e.active?-1:1:"restore"===e.type?-1:1);for(const F of s)"restore"===F.type?(b+=1,v+=F.totalRestorePerTriggerPct,T+=F.totalRestorePerHourPct,k+=F.totalTriggersPerHour,F.active&&(y+=1,C+=F.totalRestorePerTriggerPct,S+=F.totalRestorePerHourPct,A+=F.totalTriggersPerHour)):(x+=1,P+=F.totalSlowPct,F.active&&(w+=1,M+=F.totalSlowPct));t.enabled=!0,t.includeBoardwalk=_r.includeBoardwalk,t.focus=_r.focus,t.eggFocus=_r.eggFocus;const E=r.filter(t=>null!=t.endTime&&t.endTime>e).map(t=>({key:Zr(t.tileId,t.slotIndex)??`${t.tileId}${Or}${t.slotIndex}`,tileId:t.tileId,slotIndex:t.slotIndex,species:t.species??t.seedSpecies??t.plantSpecies,boardwalk:t.boardwalk,endTime:t.endTime??null,remainingMs:null!=t.endTime?Math.max(0,t.endTime-e):null}));t.plantTargets=E,t.focusTargetKey=Zr(u,p),t.focusTargetAvailable=null!=t.focusTargetKey&&E.some(e=>e.key===t.focusTargetKey);const $=o.filter(t=>null!=t.endTime&&t.endTime>e).map(t=>({key:Zr(t.tileId,t.slotIndex)??`${t.tileId}${Or}${t.slotIndex}`,tileId:t.tileId,slotIndex:t.slotIndex,species:t.eggSpecies??t.eggId??t.species,boardwalk:t.boardwalk,endTime:t.endTime??null,remainingMs:null!=t.endTime?Math.max(0,t.endTime-e):null}));t.eggTargets=$,t.eggFocusTargetKey=Zr(f,g),t.eggFocusTargetAvailable=null!=t.eggFocusTargetKey&&$.some(e=>e.key===t.eggFocusTargetKey),t.minActiveHungerPct=_r.minActiveHungerPct,t.fallbackTargetScale=_r.fallbackTargetScale,t.availableTurtles=l.size,t.hungerFilteredCount=c.size,t.turtlesMissingStats=d.size,t.plant=m,t.egg=h,t.support={restoreCount:b,restoreActiveCount:y,slowCount:x,slowActiveCount:w,restorePctTotal:v,restorePctActive:C,restorePctPerHourTotal:T,restorePctPerHourActive:S,restoreTriggersPerHourTotal:k,restoreTriggersPerHourActive:A,slowPctTotal:P,slowPctActive:M,entries:s},sa(t)}function ca(e){if(e){if("boolean"==typeof e.enabled&&(_r.enabled=e.enabled),"boolean"==typeof e.includeBoardwalk&&(_r.includeBoardwalk=e.includeBoardwalk),"number"==typeof e.minActiveHungerPct&&Number.isFinite(e.minActiveHungerPct)){const t=Math.max(0,Math.min(100,Math.round(e.minActiveHungerPct)));_r.minActiveHungerPct=t}if("number"==typeof e.fallbackTargetScale&&Number.isFinite(e.fallbackTargetScale)){const t=Math.max(1,Math.min(_r.maxTargetScale,e.fallbackTargetScale));_r.fallbackTargetScale=t}"latest"!==e.focus&&"earliest"!==e.focus&&"specific"!==e.focus||(_r.focus=e.focus),"string"!=typeof e.focusTargetTileId&&null!==e.focusTargetTileId||(_r.focusTargetTileId=e.focusTargetTileId??null),"number"==typeof e.focusTargetSlotIndex&&Number.isFinite(e.focusTargetSlotIndex)?_r.focusTargetSlotIndex=Math.max(0,Math.round(e.focusTargetSlotIndex)):null===e.focusTargetSlotIndex&&(_r.focusTargetSlotIndex=null),"latest"!==e.eggFocus&&"earliest"!==e.eggFocus&&"specific"!==e.eggFocus||(_r.eggFocus=e.eggFocus),"string"!=typeof e.eggFocusTargetTileId&&null!==e.eggFocusTargetTileId||(_r.eggFocusTargetTileId=e.eggFocusTargetTileId??null),"number"==typeof e.eggFocusTargetSlotIndex&&Number.isFinite(e.eggFocusTargetSlotIndex)?_r.eggFocusTargetSlotIndex=Math.max(0,Math.round(e.eggFocusTargetSlotIndex)):null===e.eggFocusTargetSlotIndex&&(_r.eggFocusTargetSlotIndex=null)}}function da(e){if(Vr)e&&ua(e);else{Vr=!0,function(){try{const e=m.get($r,null);e&&"object"==typeof e&&(Fr=e)}catch(e){s("‚ö†Ô∏è Failed to load manual pet overrides",e)}}(),ca(e);try{const e=e=>function(e){const t=_r.includeBoardwalk,n=e?.focusTileId??null,o=Math.max(1,Math.floor(e?.limit??10)),r=na(Ur??null,t).filter(e=>!n||e.tileId===n).map(e=>({tileId:e.tileId,slotIndex:e.slotIndex,boardwalk:e.boardwalk,species:e.species,seedSpecies:e.seedSpecies,plantSpecies:e.plantSpecies,eggId:e.eggId,eggSpecies:e.eggSpecies,slotType:e.slotType,slotCategory:e.slotCategory,objectType:e.objectType,tileObjectType:e.tileObjectType,tileCategory:e.tileCategory,slotKind:e.slotKind,endTime:e.endTime,readyAt:e.readyAt,plantedAt:e.plantedAt,isEgg:Wr(e)})),a=r.filter(e=>e.isEgg);if(console.log("[TurtleTimer] Egg detection snapshot",{totalSlots:r.length,eggSlots:a.length,includeBoardwalk:t,focusTileId:n}),"function"==typeof console.table?console.table(r):r.forEach(e=>console.log(e)),e?.includeRaw&&a.length>0){const e=Ur??null,t=(t,n)=>{if(!e||"object"!=typeof e)return null;const o=n?e.boardwalkTileObjects:e.tileObjects;if(!o||"object"!=typeof o)return null;const r=o[t];return r&&"object"==typeof r?r:null},n=(e,t)=>{if(!e)return null;const n=e.slots;if(Array.isArray(n)){return n[t]??null}return e};a.slice(0,o).forEach((e,r)=>{const i=t(e.tileId,e.boardwalk),s=n(i,e.slotIndex);console.log(`[TurtleTimer] Raw egg ${r+1}/${Math.min(o,a.length)}`,{tileId:e.tileId,boardwalk:e.boardwalk,rawTile:i,rawSlot:s})})}}(e);h.debugEggDetection=e,"undefined"!=typeof window&&window!==h&&(window.debugEggDetection=e)}catch(t){s("‚ö†Ô∏è Unable to attach debugEggDetection helper",t)}Er().catch(e=>{s("‚ö†Ô∏è Failed to start grow slot index tracker",e)}),br(),qn(e=>{Ur=e,la()}),wr(e=>{Xr=e,la()}),la(),s("üê¢ Turtle timer ready")}}function ua(e){ca(e),la()}function pa(e){ua({enabled:e})}function ma(){la()}function fa(){return ea}function ga(e,t=!0){if(Jr.add(e),t)try{e(ea)}catch(n){s("‚ö†Ô∏è Turtle timer immediate listener error",n)}return()=>{Jr.delete(e)}}const ha=[],ba=new Set;let ya=0;function xa(){const e=ha.slice();for(const n of ba)try{n(e)}catch(t){console.error("[notifications] subscriber error",t)}}function wa(e){ba.add(e);try{e(ha.slice())}catch(t){console.error("[notifications] initial subscriber error",t)}return()=>{ba.delete(e)}}const va="quinoa:stats:v1";let Ca,Ta=!1,Sa=null,ka=Date.now();const Aa=new Set;function Pa(e){return{feed:{totalFeeds:0,manualFeeds:0,perPet:{},lastFeedAt:null,sessionStart:e},weather:{totalSwaps:0,swapsByState:{weather:0,noweather:0},presetUsage:{weather:{primary:0,alternate:0},noweather:{primary:0,alternate:0}},cooldownBlocks:0,timeByKind:{},activeKind:"unknown",lastSwapAt:null,lastSnapshotAt:e},shop:{totalPurchases:0,totalSpentCoins:0,totalSpentCredits:0,purchasesByCategory:{seeds:0,eggs:0,tools:0,decor:0},items:{},history:[],lastPurchase:null,totalFailures:0,failuresByCategory:{seeds:0,eggs:0,tools:0,decor:0}},garden:{totalPlanted:0,totalHarvested:0,totalDestroyed:0,totalWateringCans:0,lastPlantedAt:null,lastHarvestedAt:null,lastDestroyedAt:null,lastWateredAt:null},pets:{totalHatched:0,hatchedByRarity:{normal:0,gold:0,rainbow:0},lastHatchedAt:null,lastHatchedRarity:null},abilities:{totalProcs:0,totalEstimatedValue:0,procsByAbility:{},valueByAbility:{},lastProcAt:null,lastProcAbility:null},meta:{initializedAt:e,updatedAt:e,version:1}}}function Ma(){Ta||qa()}function Ea(){const e={feed:{totalFeeds:Ca.feed.totalFeeds,manualFeeds:Ca.feed.manualFeeds,perPet:Object.fromEntries(Object.entries(Ca.feed.perPet).map(([e,t])=>[e,{...t}])),lastFeedAt:Ca.feed.lastFeedAt,sessionStart:Ca.feed.sessionStart},weather:{totalSwaps:Ca.weather.totalSwaps,swapsByState:{...Ca.weather.swapsByState},presetUsage:{weather:{...Ca.weather.presetUsage.weather},noweather:{...Ca.weather.presetUsage.noweather}},cooldownBlocks:Ca.weather.cooldownBlocks,timeByKind:{...Ca.weather.timeByKind},activeKind:Ca.weather.activeKind,lastSwapAt:Ca.weather.lastSwapAt},shop:{totalPurchases:Ca.shop.totalPurchases,totalSpentCoins:Ca.shop.totalSpentCoins,totalSpentCredits:Ca.shop.totalSpentCredits,purchasesByCategory:{...Ca.shop.purchasesByCategory},items:Object.fromEntries(Object.entries(Ca.shop.items).map(([e,t])=>[e,{...t}])),history:Ca.shop.history.map(e=>({...e})),lastPurchase:Ca.shop.lastPurchase?{...Ca.shop.lastPurchase}:null,totalFailures:Ca.shop.totalFailures,failuresByCategory:{...Ca.shop.failuresByCategory}},garden:{totalPlanted:Ca.garden.totalPlanted,totalHarvested:Ca.garden.totalHarvested,totalDestroyed:Ca.garden.totalDestroyed,totalWateringCans:Ca.garden.totalWateringCans,lastPlantedAt:Ca.garden.lastPlantedAt,lastHarvestedAt:Ca.garden.lastHarvestedAt,lastDestroyedAt:Ca.garden.lastDestroyedAt,lastWateredAt:Ca.garden.lastWateredAt},pets:{totalHatched:Ca.pets.totalHatched,hatchedByRarity:{...Ca.pets.hatchedByRarity},lastHatchedAt:Ca.pets.lastHatchedAt,lastHatchedRarity:Ca.pets.lastHatchedRarity},abilities:{totalProcs:Ca.abilities.totalProcs,totalEstimatedValue:Ca.abilities.totalEstimatedValue,procsByAbility:{...Ca.abilities.procsByAbility},valueByAbility:{...Ca.abilities.valueByAbility},lastProcAt:Ca.abilities.lastProcAt,lastProcAbility:Ca.abilities.lastProcAbility},meta:{...Ca.meta}};for(const n of Aa)try{n(e)}catch(t){console.error("[stats] subscriber error",t)}}function $a(){null!=Sa&&window.clearTimeout(Sa),Sa=window.setTimeout(()=>{Sa=null;try{m.set(va,Ca)}catch(e){console.error("[stats] save error",e)}},1200)}function Fa(){Ca.meta.updatedAt=Date.now(),$a(),Ea()}function Ia(e){const t=e,n=Math.max(0,t-ka);if(n<1e3)return ka=t,Ca.weather.lastSnapshotAt=t,!1;const o=Ca.weather.activeKind||"unknown";return Ca.weather.timeByKind[o]=(Ca.weather.timeByKind[o]??0)+n,ka=t,Ca.weather.lastSnapshotAt=t,!0}function qa(){Ta||(Ca=function(){const e=Date.now(),t=m.get(va,null);if(!t||"object"!=typeof t)return Pa(e);const n=Pa(t.meta?.initializedAt??e);if(t.feed&&(n.feed.totalFeeds=Number(t.feed.totalFeeds??n.feed.totalFeeds),n.feed.lastFeedAt=t.feed.lastFeedAt??null,n.feed.sessionStart=t.feed.sessionStart??n.feed.sessionStart,t.feed.perPet&&"object"==typeof t.feed.perPet))for(const[o,r]of Object.entries(t.feed.perPet)){const e=r;e&&(n.feed.perPet[o]={count:Number(e.count??0),lastFeedAt:e.lastFeedAt??null})}if(t.weather){if(n.weather.totalSwaps=Number(t.weather.totalSwaps??0),n.weather.cooldownBlocks=Number(t.weather.cooldownBlocks??0),n.weather.activeKind=t.weather.activeKind??n.weather.activeKind,n.weather.lastSwapAt=t.weather.lastSwapAt??null,n.weather.lastSnapshotAt=t.weather.lastSnapshotAt??e,t.weather.swapsByState&&(n.weather.swapsByState.weather=Number(t.weather.swapsByState.weather??0),n.weather.swapsByState.noweather=Number(t.weather.swapsByState.noweather??0)),t.weather.presetUsage)for(const e of["weather","noweather"]){const o=t.weather.presetUsage[e];o&&(n.weather.presetUsage[e].primary=Number(o.primary??0),n.weather.presetUsage[e].alternate=Number(o.alternate??0))}if(t.weather.timeByKind&&"object"==typeof t.weather.timeByKind)for(const[e,o]of Object.entries(t.weather.timeByKind))n.weather.timeByKind[e]=Number(o??0)}if(t.shop){if(n.shop.totalPurchases=Number(t.shop.totalPurchases??0),n.shop.totalSpentCoins=Number(t.shop.totalSpentCoins??0),n.shop.totalSpentCredits=Number(t.shop.totalSpentCredits??0),t.shop.purchasesByCategory)for(const e of["seeds","eggs","tools","decor"]){const o=t.shop.purchasesByCategory[e];n.shop.purchasesByCategory[e]=Number(o??0)}if(t.shop.items&&"object"==typeof t.shop.items)for(const[o,r]of Object.entries(t.shop.items)){const t=r;t&&(n.shop.items[o]={count:Number(t.count??0),coins:Number(t.coins??0),credits:Number(t.credits??0),lastPurchasedAt:t.lastPurchasedAt??e})}Array.isArray(t.shop.history)&&(n.shop.history=t.shop.history.map(t=>({itemName:t.itemName,category:t.category??"seeds",count:Number(t.count??0),coins:Number(t.coins??0),credits:Number(t.credits??0),timestamp:t.timestamp??e,success:t.success??!0,failureReason:t.failureReason})).slice(-1e3)),"number"==typeof t.shop.totalFailures&&(n.shop.totalFailures=t.shop.totalFailures),t.shop.failuresByCategory&&"object"==typeof t.shop.failuresByCategory&&(n.shop.failuresByCategory={seeds:Number(t.shop.failuresByCategory.seeds??0),eggs:Number(t.shop.failuresByCategory.eggs??0),tools:Number(t.shop.failuresByCategory.tools??0),decor:Number(t.shop.failuresByCategory.decor??0)}),t.shop.lastPurchase&&(n.shop.lastPurchase={itemName:t.shop.lastPurchase.itemName,category:t.shop.lastPurchase.category??"seeds",count:Number(t.shop.lastPurchase.count??0),coins:Number(t.shop.lastPurchase.coins??0),credits:Number(t.shop.lastPurchase.credits??0),timestamp:t.shop.lastPurchase.timestamp??e})}if(t.garden&&(n.garden.totalPlanted=Number(t.garden.totalPlanted??0),n.garden.totalHarvested=Number(t.garden.totalHarvested??0),n.garden.totalDestroyed=Number(t.garden.totalDestroyed??0),n.garden.totalWateringCans=Number(t.garden.totalWateringCans??0),n.garden.lastPlantedAt=t.garden.lastPlantedAt??null,n.garden.lastHarvestedAt=t.garden.lastHarvestedAt??null,n.garden.lastDestroyedAt=t.garden.lastDestroyedAt??null,n.garden.lastWateredAt=t.garden.lastWateredAt??null),t.pets&&(n.pets.totalHatched=Number(t.pets.totalHatched??0),t.pets.hatchedByRarity&&(n.pets.hatchedByRarity.normal=Number(t.pets.hatchedByRarity.normal??0),n.pets.hatchedByRarity.gold=Number(t.pets.hatchedByRarity.gold??0),n.pets.hatchedByRarity.rainbow=Number(t.pets.hatchedByRarity.rainbow??0)),n.pets.lastHatchedAt=t.pets.lastHatchedAt??null,n.pets.lastHatchedRarity=t.pets.lastHatchedRarity??null),t.abilities){if(n.abilities.totalProcs=Number(t.abilities.totalProcs??0),n.abilities.totalEstimatedValue=Number(t.abilities.totalEstimatedValue??0),t.abilities.procsByAbility&&"object"==typeof t.abilities.procsByAbility)for(const[e,o]of Object.entries(t.abilities.procsByAbility))n.abilities.procsByAbility[e]=Number(o??0);if(t.abilities.valueByAbility&&"object"==typeof t.abilities.valueByAbility)for(const[e,o]of Object.entries(t.abilities.valueByAbility))n.abilities.valueByAbility[e]=Number(o??0);n.abilities.lastProcAt=t.abilities.lastProcAt??null,n.abilities.lastProcAbility=t.abilities.lastProcAbility??null}return t.meta&&(n.meta.initializedAt=t.meta.initializedAt??n.meta.initializedAt,n.meta.updatedAt=t.meta.updatedAt??n.meta.updatedAt,n.meta.version=t.meta.version??n.meta.version),n}(),Ta=!0,function(){ot();const e=it();Ca.weather.activeKind=e.kind??"unknown",Ca.weather.lastSnapshotAt=e.timestamp,ka=Date.now(),at(e=>{Ia(e.timestamp),Ca.weather.activeKind=e.kind??"unknown",Fa()},!0),window.setInterval(()=>{Ia(Date.now())&&Fa()},5e3)}(),Ea())}function Na(e){Ma(),Aa.add(e);try{e(za())}catch(t){console.error("[stats] immediate subscriber error",t)}return()=>{Aa.delete(e)}}function za(){return Ma(),{feed:{totalFeeds:Ca.feed.totalFeeds,manualFeeds:Ca.feed.manualFeeds,perPet:Object.fromEntries(Object.entries(Ca.feed.perPet).map(([e,t])=>[e,{...t}])),lastFeedAt:Ca.feed.lastFeedAt,sessionStart:Ca.feed.sessionStart},weather:{totalSwaps:Ca.weather.totalSwaps,swapsByState:{...Ca.weather.swapsByState},presetUsage:{weather:{...Ca.weather.presetUsage.weather},noweather:{...Ca.weather.presetUsage.noweather}},cooldownBlocks:Ca.weather.cooldownBlocks,timeByKind:{...Ca.weather.timeByKind},activeKind:Ca.weather.activeKind,lastSwapAt:Ca.weather.lastSwapAt},shop:{totalPurchases:Ca.shop.totalPurchases,totalSpentCoins:Ca.shop.totalSpentCoins,totalSpentCredits:Ca.shop.totalSpentCredits,purchasesByCategory:{...Ca.shop.purchasesByCategory},items:Object.fromEntries(Object.entries(Ca.shop.items).map(([e,t])=>[e,{...t}])),history:Ca.shop.history.map(e=>({...e})),lastPurchase:Ca.shop.lastPurchase?{...Ca.shop.lastPurchase}:null,totalFailures:Ca.shop.totalFailures,failuresByCategory:{...Ca.shop.failuresByCategory}},garden:{totalPlanted:Ca.garden.totalPlanted,totalHarvested:Ca.garden.totalHarvested,totalDestroyed:Ca.garden.totalDestroyed,totalWateringCans:Ca.garden.totalWateringCans,lastPlantedAt:Ca.garden.lastPlantedAt,lastHarvestedAt:Ca.garden.lastHarvestedAt,lastDestroyedAt:Ca.garden.lastDestroyedAt,lastWateredAt:Ca.garden.lastWateredAt},pets:{totalHatched:Ca.pets.totalHatched,hatchedByRarity:{...Ca.pets.hatchedByRarity},lastHatchedAt:Ca.pets.lastHatchedAt,lastHatchedRarity:Ca.pets.lastHatchedRarity},abilities:{totalProcs:Ca.abilities.totalProcs,totalEstimatedValue:Ca.abilities.totalEstimatedValue,procsByAbility:{...Ca.abilities.procsByAbility},valueByAbility:{...Ca.abilities.valueByAbility},lastProcAt:Ca.abilities.lastProcAt,lastProcAbility:Ca.abilities.lastProcAbility},meta:{...Ca.meta}}}function Ra(){Ma();const e=Date.now();Ca=Pa(e);const t=it();Ca.weather.activeKind=t.kind??"unknown",Ca.weather.lastSnapshotAt=t.timestamp,ka=e,Ea(),$a()}const La=new Map;function Da(e,t){const n=new Set,{petId:o,slotId:r,slotIndex:a,fallbackKeys:i=[]}=t;((e,t)=>{const n=[];for(const o of t){if(!o)continue;const t=o.trim();t&&(n.push(`petId:${t}::${e}`),n.push(`slotId:${t}::${e}`),n.push(`source:${t}::${e}`))}return n})(e,[o,r,...i]).forEach(e=>n.add(e)),((e,t)=>null!=t&&Number.isFinite(t)?[`slotIndex:${Math.max(0,Math.round(t))}::${e}`]:[])(e,a).forEach(e=>n.add(e));for(const s of n){const e=La.get(s);if(e)return e}return null}function Ba(){return new Map(La)}const Ha=[{id:"ProduceScaleBoost",name:"Crop Size Boost I",aliases:["Crop Size Boost 1"],category:"misc",trigger:"continuous",baseProbability:.3,rollPeriodMinutes:1,effectUnit:"coins",effectLabel:"Scale increase",effectBaseValue:6,effectSuffix:"%",notes:"Chance: 0.30% √ó STR. Effect: 6% size increase √ó STR, capped at max scale."},{id:"ProduceScaleBoostII",name:"Crop Size Boost II",aliases:["Crop Size Boost 2"],category:"misc",trigger:"continuous",baseProbability:.4,rollPeriodMinutes:1,effectUnit:"coins",effectLabel:"Scale increase",effectBaseValue:10,effectSuffix:"%",notes:"Chance: 0.40% √ó STR. Effect: 10% size increase √ó STR, capped at max scale."},{id:"DoubleHarvest",name:"Double Harvest",category:"misc",trigger:"harvest",baseProbability:5},{id:"ProduceEater",name:"Crop Eater",category:"coins",trigger:"continuous",baseProbability:60,rollPeriodMinutes:1,notes:"Cannot estimate coin value without live crop data."},{id:"SellBoostI",name:"Sell Boost I",aliases:["Sell Boost 1"],category:"misc",trigger:"sellAllCrops",baseProbability:10},{id:"SellBoostII",name:"Sell Boost II",aliases:["Sell Boost 2"],category:"misc",trigger:"sellAllCrops",baseProbability:12},{id:"SellBoostIII",name:"Sell Boost III",aliases:["Sell Boost 3"],category:"misc",trigger:"sellAllCrops",baseProbability:14},{id:"SellBoostIV",name:"Sell Boost IV",aliases:["Sell Boost 4"],category:"misc",trigger:"sellAllCrops",baseProbability:16},{id:"ProduceRefund",name:"Crop Refund",category:"misc",trigger:"sellAllCrops",baseProbability:20},{id:"PlantGrowthBoost",name:"Plant Growth Boost I",aliases:["Plant Growth Boost 1"],category:"plantGrowth",trigger:"continuous",baseProbability:24,rollPeriodMinutes:1,effectValuePerProc:3,effectUnit:"minutes",effectLabel:"Growth time reduction",effectBaseValue:3,effectSuffix:"m"},{id:"PlantGrowthBoostII",name:"Plant Growth Boost II",aliases:["Plant Growth Boost 2"],category:"plantGrowth",trigger:"continuous",baseProbability:27,rollPeriodMinutes:1,effectValuePerProc:5,effectUnit:"minutes",effectLabel:"Growth time reduction",effectBaseValue:5,effectSuffix:"m"},{id:"ProduceMutationBoost",name:"Crop Mutation Boost I",aliases:["Crop Mutation Boost 1"],category:"misc",trigger:"continuous",baseProbability:.1,rollPeriodMinutes:1,effectUnit:"coins",effectLabel:"Chance increase",effectBaseValue:10,effectSuffix:"%",notes:"Increases the base weather mutation chance (0.1% √ó STR) by 10% √ó STR during active weather/lunar events. Only works when weather/lunar event is active. Grants: Wet (Rain), Frozen (Snow), Dawnlit (Dawn), Amberlit (Dusk)."},{id:"ProduceMutationBoostII",name:"Crop Mutation Boost II",aliases:["Crop Mutation Boost 2"],category:"misc",trigger:"continuous",baseProbability:.1,rollPeriodMinutes:1,effectUnit:"coins",effectLabel:"Chance increase",effectBaseValue:15,effectSuffix:"%",notes:"Increases the base weather mutation chance (0.1% √ó STR) by 15% √ó STR during active weather/lunar events. Only works when weather/lunar event is active. Grants: Wet (Rain), Frozen (Snow), Dawnlit (Dawn), Amberlit (Dusk)."},{id:"PetMutationBoost",name:"Pet Mutation Boost I",aliases:["Pet Mutation Boost 1"],category:"misc",trigger:"hatchEgg"},{id:"PetMutationBoostII",name:"Pet Mutation Boost II",aliases:["Pet Mutation Boost 2"],category:"misc",trigger:"hatchEgg"},{id:"GoldGranter",name:"Gold Granter",category:"misc",trigger:"continuous",baseProbability:.72,rollPeriodMinutes:1,effectUnit:"coins",notes:"Converts a random uncolored crop to Gold using live garden snapshot."},{id:"RainbowGranter",name:"Rainbow Granter",category:"misc",trigger:"continuous",baseProbability:.72,rollPeriodMinutes:1,effectUnit:"coins",notes:"Converts a random uncolored crop to Rainbow using live garden snapshot."},{id:"EggGrowthBoost",name:"Egg Growth Boost I",aliases:["Egg Growth Boost 1"],category:"eggGrowth",trigger:"continuous",baseProbability:21,rollPeriodMinutes:1,effectValuePerProc:7,effectUnit:"minutes"},{id:"EggGrowthBoostII",name:"Egg Growth Boost II",aliases:["Egg Growth Boost 2"],category:"eggGrowth",trigger:"continuous",baseProbability:24,rollPeriodMinutes:1,effectValuePerProc:10,effectUnit:"minutes"},{id:"EggGrowthBoostIII",name:"Egg Growth Boost III",aliases:["Egg Growth Boost 3"],category:"eggGrowth",trigger:"continuous",baseProbability:27,rollPeriodMinutes:1,effectValuePerProc:13,effectUnit:"minutes"},{id:"PetAgeBoost",name:"Hatch XP Boost I",aliases:["Hatch XP Boost 1"],category:"xp",trigger:"hatchEgg",baseProbability:50,effectValuePerProc:8e3,effectUnit:"xp"},{id:"PetAgeBoostII",name:"Hatch XP Boost II",aliases:["Hatch XP Boost 2"],category:"xp",trigger:"hatchEgg",baseProbability:60,effectValuePerProc:12e3,effectUnit:"xp"},{id:"PetHatchSizeBoost",name:"Max Strength Boost I",aliases:["Max Strength Boost 1"],category:"misc",trigger:"hatchEgg",baseProbability:12},{id:"PetHatchSizeBoostII",name:"Max Strength Boost II",aliases:["Max Strength Boost 2"],category:"misc",trigger:"hatchEgg",baseProbability:14},{id:"PetXpBoost",name:"XP Boost I",aliases:["Pet XP Boost I","Pet XP Boost 1","XP Boost 1"],category:"xp",trigger:"continuous",baseProbability:30,rollPeriodMinutes:1,effectValuePerProc:300,effectUnit:"xp"},{id:"PetXpBoostII",name:"XP Boost II",aliases:["Pet XP Boost II","Pet XP Boost 2","XP Boost 2"],category:"xp",trigger:"continuous",baseProbability:35,rollPeriodMinutes:1,effectValuePerProc:400,effectUnit:"xp"},{id:"HungerRestore",name:"Hunger Restore I",aliases:["Hunger Restore 1"],category:"misc",trigger:"continuous",baseProbability:12,rollPeriodMinutes:1},{id:"HungerRestoreII",name:"Hunger Restore II",aliases:["Hunger Restore 2"],category:"misc",trigger:"continuous",baseProbability:14,rollPeriodMinutes:1},{id:"HungerBoost",name:"Hunger Boost I",aliases:["Hunger Boost 1"],category:"misc",trigger:"continuous",baseProbability:0,rollPeriodMinutes:1},{id:"HungerBoostII",name:"Hunger Boost II",aliases:["Hunger Boost 2"],category:"misc",trigger:"continuous",baseProbability:0,rollPeriodMinutes:1},{id:"PetRefund",name:"Pet Refund I",aliases:["Pet Refund 1"],category:"misc",trigger:"sellPet",baseProbability:5},{id:"PetRefundII",name:"Pet Refund II",aliases:["Pet Refund 2"],category:"misc",trigger:"sellPet",baseProbability:7},{id:"Copycat",name:"Copycat",category:"misc",trigger:"continuous",baseProbability:1,rollPeriodMinutes:1},{id:"CoinFinderI",name:"Coin Finder I",aliases:["Coin Finder 1","CoinFinder I","CoinFinder 1"],category:"coins",trigger:"continuous",baseProbability:35,rollPeriodMinutes:1,effectValuePerProc:12e4,effectUnit:"coins",effectLabel:"Coin range",effectBaseValue:12e4,effectSuffix:""},{id:"CoinFinderII",name:"Coin Finder II",aliases:["Coin Finder 2","CoinFinder II","CoinFinder 2"],category:"coins",trigger:"continuous",baseProbability:13,rollPeriodMinutes:1,effectValuePerProc:12e5,effectUnit:"coins",effectLabel:"Coin range",effectBaseValue:12e5,effectSuffix:""},{id:"CoinFinderIII",name:"Coin Finder III",aliases:["Coin Finder 3","CoinFinder III","CoinFinder 3"],category:"coins",trigger:"continuous",baseProbability:6,rollPeriodMinutes:1,effectValuePerProc:1e7,effectUnit:"coins",effectLabel:"Coin range",effectBaseValue:1e7,effectSuffix:""},{id:"SeedFinderI",name:"Seed Finder I",aliases:["Seed Finder 1","SeedFinder I","SeedFinder 1"],category:"misc",trigger:"continuous",baseProbability:40,rollPeriodMinutes:1},{id:"SeedFinderII",name:"Seed Finder II",aliases:["Seed Finder 2","SeedFinder II","SeedFinder 2"],category:"misc",trigger:"continuous",baseProbability:20,rollPeriodMinutes:1},{id:"SeedFinderIII",name:"Seed Finder III",aliases:["Seed Finder 3","SeedFinder III","SeedFinder 3"],category:"misc",trigger:"continuous",baseProbability:10,rollPeriodMinutes:1},{id:"SeedFinderIV",name:"Seed Finder IV",aliases:["Seed Finder 4","SeedFinder IV","SeedFinder 4"],category:"misc",trigger:"continuous",baseProbability:.01,rollPeriodMinutes:1}],ja=new Map,Ga=e=>e.trim().toLowerCase();for(const hu of Ha)if(ja.set(Ga(hu.id),hu),ja.set(Ga(hu.name),hu),Array.isArray(hu.aliases))for(const e of hu.aliases)ja.set(Ga(e),hu);function Wa(e){if(!e)return null;const t=Ga(e);return ja.get(t)??null}const Oa=.95/60;function _a(e,t){const n=Number.isFinite(t)?t:100,o=Math.max(.25,n/100),r=Math.max(0,e.baseProbability??0)/60,a=Math.max(0,r/100),i=Math.min(Oa,a*o),s=3600*i,l=100*i,c=60*l;return{multiplier:o,chancePerRoll:i,rollPeriodMinutes:e.rollPeriodMinutes??1,procsPerHour:s,chancePerSecond:l,chancePerMinute:c}}function Va(e,t){const n=e.effectValuePerProc??0;return Number.isFinite(n)&&0!==n?t.procsPerHour*n:0}function Ua(){const e=In(),t=it();if(!e||!t)return{weather:null,eligibleCrops:[],eligibleFruits:0,averageValueGain:0,projectedMutationsPerEvent:0,baseMutationChance:0};const n=function(e){if(!e)return null;const t=e.toLowerCase();return t.includes("rain")?"rain":t.includes("snow")?"snow":t.includes("dawn")?"dawn":t.includes("amber")?"amber":null}("string"==typeof t?t:t.type||t.name);if(!n)return{weather:null,eligibleCrops:[],eligibleFruits:0,averageValueGain:0,projectedMutationsPerEvent:0,baseMutationChance:0};const o=[];let r=0,a=0;const i=e.tileObjects||{};Object.entries(i).forEach(([e,t])=>{if(!t||"plant"!==t.objectType)return;const i=t.species||t.plantSpecies||t.seedSpecies;if(!i)return;if(!(!0===t.fullyMature||!0===t.isMature))return;const s="number"==typeof t.scale?t.scale:1,l=Array.isArray(t.mutations)?[...t.mutations]:[],d=function(e,t){const n=e.some(e=>"Wet"===e||"Frozen"===e),o=e.some(e=>"Dawnlit"===e||"Dawnbound"===e),r=e.some(e=>"Amberlit"===e||"Amberbound"===e),a=e.includes("Gold"),i=e.includes("Rainbow");if("dawn"===t&&(r||a)||"amber"===t&&(o||a)||i)return!1;if(("rain"===t||"snow"===t)&&n)return!1;if("dawn"===t&&o)return!1;if("amber"===t&&r)return!1;return!0}(l,n);if(!d)return;const u=function(e){if("number"==typeof e.fruitCount&&e.fruitCount>0)return e.fruitCount;if(Array.isArray(e.slotStates)&&e.slotStates.length>0)return e.slotStates.length;const t=e.displayName||e.name;if("string"==typeof t){const e=t.match(/\+(\d+)/);if(e&&e[1])return parseInt(e[1],10)}return 1}(t);if(u<=0)return;const p=c(i),m=co(p,s,l,1.5),f=co(p,s,[...l,Xa(n)],1.5)-m;f>0&&(o.push({species:i,scale:s,mutations:l,currentValue:m,fruitCount:u,index:parseInt(e,10)}),r+=u,a+=f*u)});const s=o.length>0?a/r:0,l=function(e){switch(e){case"rain":return 22.8;case"snow":return 7.6;case"dawn":return 6.37;case"amber":return 3.19}}(n),d=o.length*(l/100);return{weather:n,eligibleCrops:o,eligibleFruits:r,averageValueGain:s,projectedMutationsPerEvent:d,baseMutationChance:l}}function Xa(e){switch(e){case"rain":return"Wet";case"snow":return"Frozen";case"dawn":return"Dawnlit";case"amber":return"Amberlit"}}const Ja=50,Ka=100;function Qa(e){return!!e&&"object"==typeof e&&!Array.isArray(e)}function Ya(e){const t="number"==typeof e?e:"string"==typeof e?Number.parseFloat(e):Number.NaN;if(!Number.isFinite(t))return null;const n=Math.floor(t);return n>0?n:null}function Za(e,t){if(!t)return 1;const n=["fruitCount","remainingFruitCount","remainingFruits","totalFruitCount","totalFruits","totalFruit"];for(const a of n)if(a in e){const t=Ya(e[a]);if(null!=t)return Math.min(t,64)}const o=e.slotStates;if(Array.isArray(o)){const e=o.filter(e=>null!=e);if(e.length>0)return Math.min(e.length,64)}const r="string"==typeof e.displayName?e.displayName:"string"==typeof e.name?e.name:null;if(r){const e=r.match(/\+(\d+)/);if(e){const t=Ya(e[1]);if(null!=t)return Math.min(t,64)}}return 1}function ei(e,t,n){const o=Number.isFinite(e)&&e>0?e:1,r=[n.maxScale,n.targetMaxScale,n.maxTargetScale,n.maximumScale,n.max],a="string"==typeof t?c(t):null;let i=null;for(const c of r){const e=Number(c);if(Number.isFinite(e)&&e>1){i=e;break}}if((null==i||i<=1)&&a){const e=p(a);null!=e&&Number.isFinite(e)&&e>1&&(i=e)}(null==i||!Number.isFinite(i)||i<=1)&&(i=2);const s=Math.max(1.01,i),l=Math.min(s,Math.max(1,o)),d=Ja+50*(s>1?(l-1)/(s-1):0);return{maxScale:s,sizePercent:Math.min(Ka,Math.max(Ja,Math.round(100*d)/100))}}function ti(e,t){return 1+(Math.min(Ka,Math.max(Ja,e))-Ja)/50*(Math.max(1.01,Number.isFinite(t)&&t>1?t:2)-1)}function ni(e=In()){const t=function(e){if(!e)return[];const t=[{tiles:e.tileObjects,allowMultiHarvest:!0},{tiles:e.boardwalkTileObjects,allowMultiHarvest:!0}],n=[],o=Date.now();for(const{tiles:r,allowMultiHarvest:a}of t)if(r&&"object"==typeof r)for(const e of Object.values(r)){if(!Qa(e))continue;if("plant"!==e.objectType)continue;const t=e.slots;if(Array.isArray(t))for(const e of t){if(!Qa(e))continue;const t="string"==typeof e.species?e.species:null;if(!t)continue;const r=e.endTime,i="number"==typeof r?r:Number(r),s=!!Number.isFinite(i)&&i<=o,l=e.targetScale??e.scale??e.plantScale,c="number"==typeof l&&Number.isFinite(l)?Math.max(1,l):1,d=(Array.isArray(e.mutations)?e.mutations:[]).map(e=>"string"==typeof e?e:null).filter(e=>!!e),u=co(t,c,d,1.5);if(!Number.isFinite(u)||u<=0)continue;const p=ro(d),m="Gold"===p.color?.definition?.name||"Rainbow"===p.color?.definition?.name,{maxScale:f,sizePercent:g}=ei(c,t,e),h=Za(e,a);n.push({species:t,scale:c,maxScale:f,sizePercent:g,mutations:d,currentValue:u,hasColorMutation:m,fruitCount:h,isMature:s})}}return n}(e),n=t.reduce((e,t)=>t.isMature?e+t.currentValue*Math.max(1,t.fruitCount):e,0),o=t.filter(e=>{const t=e.mutations.includes("Gold"),n=e.mutations.includes("Rainbow");return!t&&!n}),r=o.reduce((e,t)=>e+Math.max(1,t.fruitCount),0);return{crops:t,uncoloredCrops:o,uncoloredFruitSlots:r,totalMatureValue:n,friendBonus:1.5}}function oi(e,t,n){const o=n*("number"==typeof t&&Number.isFinite(t)?Math.max(0,t):100)/100;if(!e.crops.length||o<=0)return null;const r=e.crops.filter(e=>e.isMature&&e.sizePercent<99.99&&Math.max(1,e.fruitCount)>0);if(!r.length)return null;let a=0,i=0,s=0;for(const l of r){const e=Math.max(1,Math.floor(l.fruitCount)),t=Math.max(0,Ka-l.sizePercent);if(t<=0)continue;const n=Math.min(o,t);if(n<=0)continue;const r=ti(l.sizePercent+n,l.maxScale),c=l.scale>0?l.scale:1,d=Math.max(0,r-c);if(d<=0)continue;const u=c>0?l.currentValue/c:0;if(!Number.isFinite(u)||u<=0)continue;const p=u*d;!Number.isFinite(p)||p<=0||(s+=e,a+=p*e,i+=n*e)}if(a<=0||0===s)return null;return{effectPerProc:a/s,detail:`Boosts ${s} mature fruit${1===s?"":"s"} by ~${(i/s).toFixed(2)}% size (50% friend bonus assumed, weighted by fruit count).`}}function ri(e,t){if(!e.uncoloredCrops.length)return null;let n=0,o=0;for(const r of e.uncoloredCrops){const e=Math.max(1,Math.floor(r.fruitCount)),a=[...r.mutations,t],i=co(r.species,r.scale,a,1.5)-r.currentValue;Number.isFinite(i)&&i>0&&(o+=e,n+=i*e)}if(0===o||n<=0)return null;return{effectPerProc:n/o,detail:`Converts 1 random uncolored crop to ${t}. ${e.uncoloredFruitSlots} eligible fruit slot${1===e.uncoloredFruitSlots?"":"s"} across ${e.uncoloredCrops.length} plant${1===e.uncoloredCrops.length?"":"s"} (50% friend bonus, weighted by fruit count).`}}function ai(e,t,n){switch(e){case"ProduceScaleBoost":return oi(t,n,6);case"ProduceScaleBoostII":return oi(t,n,10);case"GoldGranter":return ri(t,"Gold");case"RainbowGranter":return ri(t,"Rainbow");case"ProduceMutationBoost":case"ProduceMutationBoostII":return function(){const e=Ua();if(!e.weather||0===e.eligibleCrops.length)return{effectPerProc:0,detail:"No active weather/lunar event or no eligible crops. Mutations only proc during Rain, Snow, Dawn, or Amber Moon."};const t="rain"===e.weather?"Rain":"snow"===e.weather?"Snow":"dawn"===e.weather?"Dawn":"Amber",n="rain"===e.weather?"Wet":"snow"===e.weather?"Frozen":"dawn"===e.weather?"Dawnlit":"Amberlit";return{effectPerProc:e.projectedMutationsPerEvent*e.averageValueGain,detail:`${t} active (${e.baseMutationChance.toFixed(1)}% chance/crop). ${e.eligibleCrops.length} eligible plant${1===e.eligibleCrops.length?"":"s"} (${e.eligibleFruits} fruit${1===e.eligibleFruits?"":"s"}). Expected: ${e.projectedMutationsPerEvent.toFixed(2)} ${n} mutation${1===e.projectedMutationsPerEvent?"":"s"}/event, avg ${ii(e.averageValueGain)}/mutation.`}}();default:return null}}function ii(e){return e>=1e6?`${(e/1e6).toFixed(2)}M`:e>=1e3?`${(e/1e3).toFixed(2)}K`:e.toFixed(0)}y("__qpmAbilityDebug",{getContext:()=>ni(),listUncolored:()=>ni().uncoloredCrops.map(e=>({species:e.species,fruitCount:Math.max(1,e.fruitCount),sizePercent:e.sizePercent,mutations:[...e.mutations],hasColorMutation:e.hasColorMutation,isMature:e.isMature,valuePerScale:e.scale>0?e.currentValue/e.scale:e.currentValue})),listAll:()=>ni().crops.map(e=>({species:e.species,fruitCount:Math.max(1,e.fruitCount),sizePercent:e.sizePercent,mutations:[...e.mutations],hasColorMutation:e.hasColorMutation,isMature:e.isMature,currentValue:e.currentValue,maxScale:e.maxScale}))});const si="qpm-window-pos-",li=new Map;let ci=1e4,di=!1;function ui(e){const t=e.getBoundingClientRect(),n=window.innerWidth,o=window.innerHeight;let r=parseFloat(e.style.right)||n-t.right,a=parseFloat(e.style.top)||t.top;const i=Math.max(8,n-t.width-8),s=Math.max(8,o-t.height-8);r=Math.min(Math.max(r,8),i),a=Math.min(Math.max(a,8),s),e.style.right=`${r}px`,e.style.top=`${a}px`,e.style.left="auto",e.style.bottom="auto"}function pi(){li.forEach(e=>{e.isMinimized||ui(e.el)})}function mi(e,t,n,o,r){if(li.has(e)){const t=li.get(e);return t.el.style.display="",t.isMinimized=!1,hi(t.el),void xi(e,!0,!1)}const a=o||"90vw",i=r||"90vh",l=document.createElement("div");l.className="qpm-window",l.id=`qpm-window-${e}`,l.style.cssText=`\n    position: fixed;\n    min-width: 260px;\n    max-width: ${a};\n    max-height: ${i};\n    background: rgba(18, 20, 26, 0.96);\n    border: 1px solid rgba(143, 130, 255, 0.5);\n    border-radius: 8px;\n    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.8), 0 0 0 1px rgba(255, 255, 255, 0.05);\n    backdrop-filter: blur(12px);\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n    font-size: 13px;\n    color: #e0e0e0;\n    z-index: ${ci++};\n    box-sizing: border-box;\n    overflow: auto;\n  `;const c=document.createElement("div");c.className="qpm-window-head",c.style.cssText="\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 12px 16px;\n    background: linear-gradient(135deg, rgba(143, 130, 255, 0.12) 0%, rgba(143, 130, 255, 0.04) 100%);\n    border-bottom: 1px solid rgba(143, 130, 255, 0.25);\n    cursor: move;\n    user-select: none;\n  ";const d=document.createElement("div");d.className="qpm-window-title",d.textContent=t,d.style.cssText="\n    font-size: 15px;\n    font-weight: 600;\n    color: #8f82ff;\n    flex: 1;\n    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);\n  ";const u=document.createElement("div");u.style.cssText="display: flex; gap: 6px;";const p=bi("‚àí","Minimize"),f=bi("√ó","Close");u.appendChild(p),u.appendChild(f),c.appendChild(d),c.appendChild(u);const g=document.createElement("div");g.className="qpm-window-body",g.style.cssText="\n    padding: 16px;\n    background: rgba(0, 0, 0, 0.25);\n    box-sizing: border-box;\n  ",function(e){const t=`qpm-window-scrollbar-${e}`;if(document.getElementById(t))return;const n=document.createElement("style");n.id=t,n.textContent=`\n    /* Scrollbar on the window itself (Aries mod pattern) */\n    #qpm-window-${e}::-webkit-scrollbar {\n      width: 8px;\n    }\n    #qpm-window-${e}::-webkit-scrollbar-track {\n      background: rgba(0, 0, 0, 0.2);\n      border-radius: 4px;\n    }\n    #qpm-window-${e}::-webkit-scrollbar-thumb {\n      background: rgba(143, 130, 255, 0.35);\n      border-radius: 4px;\n      transition: background 0.2s;\n    }\n    #qpm-window-${e}::-webkit-scrollbar-thumb:hover {\n      background: rgba(143, 130, 255, 0.55);\n    }\n\n    /* Constrain all content within window - prevent horizontal overflow */\n    #qpm-window-${e} *,\n    #qpm-window-${e} *::before,\n    #qpm-window-${e} *::after {\n      box-sizing: border-box;\n      max-width: 100%;\n      word-wrap: break-word;\n      overflow-wrap: break-word;\n    }\n\n    #qpm-window-${e} .qpm-card,\n    #qpm-window-${e} .qpm-card__body,\n    #qpm-window-${e} .qpm-card__header,\n    #qpm-window-${e} .qpm-section-muted,\n    #qpm-window-${e} input,\n    #qpm-window-${e} button,\n    #qpm-window-${e} select,\n    #qpm-window-${e} div {\n      max-width: 100%;\n      min-width: 0;\n    }\n\n    /* Prevent pre/code from breaking layout */\n    #qpm-window-${e} pre,\n    #qpm-window-${e} code {\n      white-space: pre-wrap;\n      word-break: break-all;\n    }\n  `,document.head.appendChild(n)}(e),l.appendChild(c),l.appendChild(g),document.body.appendChild(l),n(g),function(e,t){const n=m.get(si+e);n?(t.style.right=`${n.right}px`,t.style.top=`${n.top}px`,t.style.left="auto",t.style.bottom="auto"):(t.style.left="50%",t.style.top="50%",t.style.transform="translate(-50%, -50%)",t.style.right="auto",t.style.bottom="auto",requestAnimationFrame(()=>{const n=t.getBoundingClientRect();t.style.transform="",t.style.left="auto",t.style.right=window.innerWidth-n.right+"px",t.style.top=`${n.top}px`,yi(e,t)}))}(e,l),requestAnimationFrame(()=>{ui(l)}),di||(window.addEventListener("resize",pi),di=!0,s("Window resize listener added")),function(e,t,n){let o=!1,r=0,a=0,i=0,s=0;const l=t=>{if(!o)return;t.preventDefault();const n=t.clientX-r,l=t.clientY-a,c=i-n,d=s+l,u=window.innerWidth-8,p=window.innerHeight-8,m=e.getBoundingClientRect(),f=Math.max(8-m.width,Math.min(u-m.width,c)),g=Math.max(8,Math.min(p-m.height,d));e.style.right=`${f}px`,e.style.top=`${g}px`,e.style.left="auto",e.style.bottom="auto"},c=()=>{o&&(o=!1,t.style.cursor="move",document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",c),yi(n,e))};t.addEventListener("mousedown",n=>{if(n.target.closest(".qpm-window-btn"))return;o=!0,t.style.cursor="grabbing",r=n.clientX,a=n.clientY;const d=e.getBoundingClientRect();i=parseFloat(e.style.right)||window.innerWidth-d.right,s=parseFloat(e.style.top)||d.top,document.addEventListener("mousemove",l),document.addEventListener("mouseup",c),hi(e)})}(l,c,e),l.addEventListener("wheel",e=>{e.stopPropagation()},{passive:!1}),p.addEventListener("click",t=>{t.stopPropagation(),function(e){const t=li.get(e);if(!t)return;t.isMinimized=!t.isMinimized,t.isMinimized?(t.body.style.display="none",t.el.style.maxHeight="auto",t.minimizeBtn.textContent="‚ñ°",t.minimizeBtn.title="Restore"):(t.body.style.display="",t.el.style.maxHeight=t.maxHeight,t.minimizeBtn.textContent="‚àí",t.minimizeBtn.title="Minimize");xi(e,!0,t.isMinimized)}(e)}),f.addEventListener("click",t=>{t.stopPropagation(),fi(e)}),l.addEventListener("mousedown",()=>hi(l));const h={id:e,el:l,head:c,body:g,titleEl:d,minimizeBtn:p,closeBtn:f,isMinimized:!1,maxHeight:i};li.set(e,h),xi(e,!0,!1),s(`Window ${e} opened`)}function fi(e){const t=li.get(e);t&&(t.el.style.display="none",xi(e,!1,t.isMinimized),s(`Window ${e} closed`))}function gi(e,t,n,o,r){const a=li.get(e);return a?"none"!==a.el.style.display?(fi(e),!1):(a.el.style.display="",a.isMinimized=!1,hi(a.el),xi(e,!0,!1),!0):(mi(e,t,n,o,r),!0)}function hi(e){e.style.zIndex=String(ci++)}function bi(e,t){const n=document.createElement("button");return n.className="qpm-window-btn",n.textContent=e,n.title=t,n.style.cssText=`\n    width: 26px;\n    height: 26px;\n    border: none;\n    background: rgba(255, 255, 255, 0.08);\n    color: #e0e0e0;\n    font-size: ${"√ó"===e?"20px":"18px"};\n    font-weight: 300;\n    line-height: 1;\n    cursor: pointer;\n    border-radius: 4px;\n    transition: all 0.15s ease;\n    padding: 0;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  `,n.addEventListener("mouseenter",()=>{n.style.background="√ó"===e?"rgba(244, 67, 54, 0.8)":"rgba(143, 130, 255, 0.5)",n.style.color="#fff"}),n.addEventListener("mouseleave",()=>{n.style.background="rgba(255, 255, 255, 0.08)",n.style.color="#e0e0e0"}),n}function yi(e,t){const n=t.getBoundingClientRect(),o={right:parseFloat(t.style.right)||window.innerWidth-n.right,top:parseFloat(t.style.top)||n.top};m.set(si+e,o)}function xi(e,t,n){m.set("qpm-window-state-"+e,{isOpen:t,isMinimized:n})}const wi={none:1,golden:25,rainbow:50,wet:2,chilled:2,frozen:10,dawnlit:2,dawnbound:3,amberlit:5,amberbound:6},vi={"wet+dawnlit":3,"chilled+dawnlit":3,"wet+amberlit":6,"chilled+amberlit":6,"frozen+dawnlit":11,"frozen+dawnbound":12,"frozen+amberlit":14,"frozen+amberbound":15,"golden+wet":50,"golden+chilled":50,"golden+frozen":250,"golden+dawnlit":50,"golden+dawnbound":75,"golden+amberlit":125,"golden+amberbound":150,"golden+wet+dawnlit":75,"golden+chilled+dawnlit":75,"golden+wet+amberlit":150,"golden+chilled+amberlit":150,"golden+frozen+dawnlit":275,"golden+frozen+dawnbound":300,"golden+frozen+amberlit":350,"golden+frozen+amberbound":375,"rainbow+wet":100,"rainbow+chilled":100,"rainbow+frozen":500,"rainbow+dawnlit":100,"rainbow+dawnbound":150,"rainbow+amberlit":250,"rainbow+amberbound":300,"rainbow+wet+dawnlit":150,"rainbow+chilled+dawnlit":150,"rainbow+wet+amberlit":300,"rainbow+chilled+amberlit":300,"rainbow+frozen+dawnlit":550,"rainbow+frozen+dawnbound":600,"rainbow+frozen+amberlit":700,"rainbow+frozen+amberbound":750};function Ci(e,t){if(!e&&0===t.length)return wi.none;const n=[];e&&n.push(e),t.sort().forEach(e=>n.push(e));const o=n.join("+");if(vi[o])return vi[o];let r=wi.none;return e&&(r*=wi[e]),t.forEach(e=>{r*=wi[e]}),r}function Ti(){const e=ni();if(0===e.crops.length)return null;const t=e.crops.filter(e=>e.isMature);if(0===t.length)return null;let n=null;return t.forEach((e,t)=>{const{mutation:o,weather:r}=function(e){let t=null;const n=[];for(const o of e){const e=o.toLowerCase();"golden"===e||"gold"===e?t="golden":"rainbow"===e?t="rainbow":"wet"===e?n.push("wet"):"chilled"===e?n.push("chilled"):"frozen"===e?n.push("frozen"):"dawnlit"===e?n.push("dawnlit"):"dawnbound"===e?n.push("dawnbound"):"amberlit"===e?n.push("amberlit"):"amberbound"===e&&n.push("amberbound")}return{mutation:t,weather:n}}(e.mutations),a=function(e,t){const n=[{weather:"wet",event:"Rain"},{weather:"chilled",event:"Frost"},{weather:"frozen",event:"Rain+Frost"},{weather:"dawnlit",event:"Dawn"},{weather:"amberlit",event:"Amber Moon"}];let o=null;for(const{weather:r,event:a}of n){if(t.includes(r))continue;if("dawnlit"===r&&t.some(e=>"amberlit"===e||"amberbound"===e))continue;if("amberlit"===r&&t.some(e=>"dawnlit"===e||"dawnbound"===e))continue;if("wet"===r&&t.includes("chilled"))continue;if("chilled"===r&&t.includes("wet"))continue;const n=Ci(e,[...t,r]);(!o||n>o.multiplier)&&(o={weather:r,multiplier:n,weatherEventName:a})}return o}(o,r);if(!a)return;const i=Ci(o,r),s=e.currentValue*Math.max(1,e.fruitCount),l=s/i*a.multiplier,c=l-s;(!n||c>n.valueDifference)&&(n={cropSpecies:e.species,cropIndex:t,currentMutations:[...e.mutations],currentMultiplier:i,currentValue:s,targetWeather:a.weather,targetMultiplier:a.multiplier,targetValue:l,valueDifference:c,weatherEventName:a.weatherEventName})}),n}function Si(e,t){if("RainbowGranter"!==t&&"GoldGranter"!==t)return{effective:e,wastePercent:0};try{const t=ni(),n=t.crops.length,o=t.uncoloredCrops.length;if(0===n)return{effective:0,wastePercent:100};const r=o/n;return{effective:e*r,wastePercent:100*(1-r)}}catch(n){return s("‚ö†Ô∏è Failed to calculate effective proc rate",n),{effective:e,wastePercent:0}}}function ki(e,t,n){const o=n?n>0?60/n:null:t;if(!o||o<=0)return{text:"‚Äî",isOverdue:!1};const r=e+60*o*1e3-Date.now();if(r<0){const e=Math.abs(r),t=Math.floor(e/36e5),n=Math.floor(e%36e5/6e4),o=Math.floor(e%6e4/1e3);return t>0?{text:`-${t}h ${n}m ${o}s`,isOverdue:!0}:n>0?{text:`-${n}m ${o}s`,isOverdue:!0}:{text:`-${o}s`,isOverdue:!0}}const a=Math.floor(r/36e5),i=Math.floor(r%36e5/6e4),s=Math.floor(r%6e4/1e3);return a>0?{text:`${a}h ${i}m ${s}s`,isOverdue:!1}:i>0?{text:`${i}m ${s}s`,isOverdue:!1}:{text:`${s}s`,isOverdue:!1}}function Ai(e,t,n,o=!1,r){const a=n.insertRow();a.style.cssText="border-bottom: 1px solid var(--qpm-border);",a.dataset.petIndex=String(e.petIndex),a.dataset.abilityId=e.definition.id;const{effective:i,wastePercent:l}=Si(e.procsPerHour,e.definition.id),c=a.insertCell(),d=e.pet.strength,u=null!=d?` (STR ${d})`:"";c.textContent=e.displayName+u,c.style.cssText="\n    padding: 10px 12px;\n    color: var(--qpm-text);\n    font-weight: 500;\n    white-space: nowrap;\n  ",c.title=`Pet: ${e.displayName}${null!=d?`\nStrength: ${d}`:"\nStrength: Unknown"}`;const p=a.insertCell();p.textContent=t,p.style.cssText="\n    padding: 10px 12px;\n    color: var(--qpm-text);\n    white-space: nowrap;\n  ",l>0&&(p.title=`‚ö†Ô∏è ${l.toFixed(1)}% proc waste (targeting colored plants)`);const m=a.insertCell(),f=e.pet.strength??100,g=e.definition.baseProbability??0,h=g/60*f/100,b=60*h,y=`${b.toFixed(2)}%/min`;m.innerHTML=l>0?`${y} <span style="color: var(--qpm-warning); font-size: 10px;">(-${l.toFixed(0)}%)</span>`:y,m.style.cssText="\n    padding: 10px 12px;\n    text-align: right;\n    color: var(--qpm-text);\n    font-family: monospace;\n    white-space: nowrap;\n  ",m.title=l>0?`Base Chance: ${g.toFixed(2)}%/min\nWith STR ${f}: ${b.toFixed(2)}%/min\nPer Second: ${h.toFixed(3)}%/sec\n${l.toFixed(1)}% waste from colored plants`:`Base Chance: ${g.toFixed(2)}%/min\nWith STR ${f}: ${b.toFixed(2)}%/min\nPer Second: ${h.toFixed(3)}%/sec (game checks every second)`;const x=a.insertCell();x.textContent=i.toFixed(2),x.style.cssText="\n    padding: 10px 12px;\n    text-align: right;\n    color: var(--qpm-text);\n    font-family: monospace;\n  ",x.title=l>0?`Base: ${e.procsPerHour.toFixed(2)}/hr\nEffective: ${i.toFixed(2)}/hr after waste`:`${e.procsPerHour.toFixed(2)} procs/hour`;const w=a.insertCell(),v=e.effectPerProc??0,C=o?so:lo;w.textContent=v>0?C(v):"‚Äî",w.style.cssText=`\n    padding: 10px 12px;\n    text-align: right;\n    color: ${v>0?"var(--qpm-warning)":"var(--qpm-text-muted)"};\n    font-family: monospace;\n    font-weight: 500;\n  `,e.effectDetail&&(w.title=e.effectDetail),!o&&v>0&&(w.title=`Exact: ${so(v)}`);const T=a.insertCell(),S=i*(v>0?v:0);if(T.textContent=S>0?C(S):"‚Äî",T.style.cssText=`\n    padding: 10px 12px;\n    text-align: right;\n    color: ${S>0?"var(--qpm-warning)":"var(--qpm-text-muted)"};\n    font-family: monospace;\n    font-weight: 600;\n  `,l>0&&S>0){const t=e.procsPerHour*(v>0?v:0);T.title=`Base: ${so(t)}/hr\nEffective: ${so(S)}/hr after ${l.toFixed(0)}% waste`}else!o&&S>0&&(T.title=`Exact: ${so(S)}/hr`);const k=a.insertCell();k.className="eta-countdown";const A=i>0?60/i:0;if(i>0){let t,n;if(e.lastProcAt&&e.lastProcAt>0)t=e.lastProcAt,n=!1;else{const o=`${e.petIndex}:${e.definition.id}`,a=r?.get(o);t=a||Date.now(),n=!0}k.dataset.lastProc=String(t),k.dataset.effectiveRate=String(i),k.dataset.normalColor="var(--qpm-positive)",k.dataset.isEstimate=n?"true":"false";const o=ki(t,e.expectedMinutesBetween,i);k.textContent=o.text,k.style.cssText=`\n      padding: 10px 12px;\n      text-align: right;\n      color: ${o.isOverdue?"var(--qpm-danger)":"var(--qpm-positive)"};\n      font-family: monospace;\n      font-weight: 500;\n      white-space: nowrap;\n    `,k.title=n?`Estimated ${A.toFixed(1)} minutes between procs\nNo proc history yet`:`Average ${A.toFixed(1)} minutes between procs\nLast proc: ${new Date(e.lastProcAt).toLocaleTimeString()}`}else k.textContent="‚Äî",k.style.cssText="\n      padding: 10px 12px;\n      text-align: right;\n      color: var(--qpm-text-muted);\n      font-family: monospace;\n      font-weight: 500;\n      white-space: nowrap;\n    ",k.title="No proc rate available";if(o){const t=n.insertRow();t.style.cssText="\n      background: var(--qpm-surface-2);\n      border-bottom: 1px solid var(--qpm-border);\n    ";const o=t.insertCell();o.colSpan=7,o.style.cssText="\n      padding: 8px 12px;\n      font-size: 11px;\n      color: var(--qpm-text-muted);\n      line-height: 1.6;\n    ";const r=e.pet.strength??100,a=e.definition.baseProbability??0,i=r/100,c=a*i,d=[];if(a>0&&d.push(`<strong>Chance Per Minute:</strong> ${a.toFixed(2)}% √ó ${r} = ${c.toFixed(2)}%`),e.definition.effectLabel&&null!=e.definition.effectBaseValue){const t=e.definition.effectBaseValue*i,n=e.definition.effectSuffix??"";d.push(`<strong>${e.definition.effectLabel}:</strong> ${e.definition.effectBaseValue}${n} √ó ${r} = ${t.toFixed(1)}${n}`)}if("ProduceMutationBoost"===e.definition.id||"ProduceMutationBoostII"===e.definition.id)try{const e=Ti();if(e){const t=function(e,t){if(!e)return"No mutation opportunities found";const n=(e.weatherEventName.includes("Dawn")||e.weatherEventName.includes("Amber")?1:7)*(t/100);return`Best: ${e.cropSpecies} ‚Üí ${e.weatherEventName} (${n.toFixed(2)}% chance, +${(e.targetMultiplier/e.currentMultiplier).toFixed(1)}√ó value)`}(e,r);d.push(`<strong>üåü Opportunity:</strong> ${t}`)}}catch(P){s("‚ö†Ô∏è Failed to calculate mutation opportunity",P)}if("observed"===e.procsPerHourSource?d.push(`<strong>Data Source:</strong> Observed (${e.sampleCount} sample${1!==e.sampleCount?"s":""})`):d.push("<strong>Data Source:</strong> Estimated from ability definition"),l>0){const e=ni();d.push(`<strong>Efficiency:</strong> ${(100-l).toFixed(1)}% (${e.uncoloredCrops.length}/${e.crops.length} uncolored crops)`)}if(e.lastProcAt){const t=new Date(e.lastProcAt),n=Date.now()-e.lastProcAt,o=Math.floor(n/6e4),r=Math.floor(o/60),a=r>0?`${r}h ${o%60}m ago`:`${o}m ago`;d.push(`<strong>Last Proc:</strong> ${t.toLocaleTimeString()} (${a})`)}o.innerHTML=d.join(" ‚Ä¢ ")}return a}let Pi={stats:{wetCount:0,wetPerHour:0,wetTotalValue:0,wetLastAt:null,chilledCount:0,chilledPerHour:0,chilledTotalValue:0,chilledLastAt:null,frozenCount:0,frozenPerHour:0,frozenTotalValue:0,frozenLastAt:null,dawnlitCount:0,dawnlitPerHour:0,dawnlitTotalValue:0,dawnlitLastAt:null,dawnboundCount:0,dawnboundPerHour:0,dawnboundTotalValue:0,dawnboundLastAt:null,amberlitCount:0,amberlitPerHour:0,amberlitTotalValue:0,amberlitLastAt:null,amberboundCount:0,amberboundPerHour:0,amberboundTotalValue:0,amberboundLastAt:null,sessionValue:0,sessionStart:Date.now(),bestHourValue:0,bestHourTime:null,bestSessionValue:0,bestSessionTime:null},updatedAt:Date.now()},Mi=new Map;const Ei=new Set;function $i(e){const t=[e.species,e.seedSpecies,e.plantSpecies,e.cropSpecies,e.name];for(const n of t)if("string"==typeof n){const e=n.trim();if(e.length>0)return e}return null}function Fi(){return{stats:{...Pi.stats},updatedAt:Pi.updatedAt}}function Ii(e){return Ei.add(e),e(Fi()),()=>Ei.delete(e)}function qi(){Pi={stats:{wetCount:0,wetPerHour:0,wetTotalValue:0,wetLastAt:null,chilledCount:0,chilledPerHour:0,chilledTotalValue:0,chilledLastAt:null,frozenCount:0,frozenPerHour:0,frozenTotalValue:0,frozenLastAt:null,dawnlitCount:0,dawnlitPerHour:0,dawnlitTotalValue:0,dawnlitLastAt:null,dawnboundCount:0,dawnboundPerHour:0,dawnboundTotalValue:0,dawnboundLastAt:null,amberlitCount:0,amberlitPerHour:0,amberlitTotalValue:0,amberlitLastAt:null,amberboundCount:0,amberboundPerHour:0,amberboundTotalValue:0,amberboundLastAt:null,sessionValue:0,sessionStart:Date.now(),bestHourValue:Pi.stats.bestHourValue,bestHourTime:Pi.stats.bestHourTime,bestSessionValue:Pi.stats.bestSessionValue,bestSessionTime:Pi.stats.bestSessionTime},updatedAt:Date.now()},Mi=new Map;const e=function(e){const t=[];if(!e)return t;const n=[{tiles:e.tileObjects},{tiles:e.boardwalkTileObjects}];for(const{tiles:o}of n)if(o&&"object"==typeof o)for(const[e,n]of Object.entries(o)){if(!n||"object"!=typeof n)continue;const o=n;"plant"===o.objectType&&(Array.isArray(o.slots)?o.slots:[]).forEach((n,o)=>{if(!n||"object"!=typeof n)return;const r=n,a=(Array.isArray(r.mutations)?r.mutations:[]).map(e=>"string"==typeof e?e:null).filter(e=>!!e);if(0===a.length)return;const i=$i(r),s=nn(a);t.push({tileId:e,slotIndex:o,cropName:i,mutations:a,slotState:s})})}return t}(In());for(const n of e){const e=`${n.tileId}-${n.slotIndex}`,t=new Set;n.slotState.hasWet&&t.add("wet"),n.slotState.hasChilled&&t.add("chilled"),n.slotState.hasFrozen&&t.add("frozen"),n.slotState.hasDawnlit&&t.add("dawnlit"),n.slotState.hasDawnbound&&t.add("dawnbound"),n.slotState.hasAmberlit&&t.add("amberlit"),n.slotState.hasAmberbound&&t.add("amberbound"),t.size>0&&Mi.set(e,t)}try{m.set("qpm.weatherMutationTracking.v1",function(){const e=[];for(const[t,n]of Mi.entries())e.push([t,Array.from(n)]);return{version:2,stats:{...Pi.stats},updatedAt:Pi.updatedAt,trackedSlots:e}}())}catch(t){console.error("[weatherMutationTracking] Failed to save after reset:",t)}!function(){for(const e of Ei)try{e(Pi)}catch(t){console.error("[weatherMutationTracking] Listener error:",t)}}(),console.log(`[QPM] üîÑ Weather mutation tracking reset - ${Mi.size} existing slots marked as seen`)}const Ni="qpm.mutationValueTracking.v1",zi=36e5,Ri=5e5,Li=1e6,Di=5e6;let Bi={stats:{goldProcs:0,goldPerHour:0,goldTotalValue:0,goldLastProcAt:null,rainbowProcs:0,rainbowPerHour:0,rainbowTotalValue:0,rainbowLastProcAt:null,cropBoostProcs:0,cropBoostPerHour:0,cropBoostTotalValue:0,cropBoostLastProcAt:null,sessionValue:0,sessionStart:Date.now(),bestHourValue:0,bestHourTime:null,bestSessionValue:0,bestSessionTime:null},sessions:[],hourlyBreakdown:new Map,updatedAt:Date.now()},Hi=!1;const ji=new Set;function Gi(e,t){const n=Ba();let o=0,r=null;for(const a of n.values())if(a.abilityId===e){const e=a.events.filter(e=>e.performedAt>=t);if(o+=e.length,e.length>0){const t=Math.max(...e.map(e=>e.performedAt));(null===r||t>r)&&(r=t)}}return{count:o,lastProcAt:r}}function Wi(){const e=Date.now(),t=Bi.stats.sessionStart,n=Math.max(1,e-t)/zi,o=ni(),r=ai("GoldGranter",o,null),a=ai("RainbowGranter",o,null),i=ai("ProduceScaleBoost",o,null),s=ai("ProduceScaleBoostII",o,null),l=r?.effectPerProc||Ri,c=a?.effectPerProc||Li,d=i?.effectPerProc||Di,u=s?.effectPerProc||Di,p=Gi("GoldGranter",t);Bi.stats.goldProcs=p.count,Bi.stats.goldLastProcAt=p.lastProcAt,Bi.stats.goldTotalValue=p.count*l,Bi.stats.goldPerHour=n>0?p.count/n:0;const m=Gi("RainbowGranter",t);Bi.stats.rainbowProcs=m.count,Bi.stats.rainbowLastProcAt=m.lastProcAt,Bi.stats.rainbowTotalValue=m.count*c,Bi.stats.rainbowPerHour=n>0?m.count/n:0;const f=Gi("ProduceScaleBoost",t),g=Gi("ProduceScaleBoostII",t),h=f.count+g.count,b=f.lastProcAt&&g.lastProcAt?Math.max(f.lastProcAt,g.lastProcAt):f.lastProcAt||g.lastProcAt,y=f.count*d+g.count*u;Bi.stats.cropBoostProcs=h,Bi.stats.cropBoostLastProcAt=b,Bi.stats.cropBoostTotalValue=y,Bi.stats.cropBoostPerHour=n>0?h/n:0,Bi.stats.sessionValue=Bi.stats.goldTotalValue+Bi.stats.rainbowTotalValue+Bi.stats.cropBoostTotalValue,function(e){const t=new Map,n=ai("GoldGranter",e,null),o=ai("RainbowGranter",e,null),r=ai("ProduceScaleBoost",e,null),a=ai("ProduceScaleBoostII",e,null),i=n?.effectPerProc||Ri,s=o?.effectPerProc||Li,l=r?.effectPerProc||Di,c=a?.effectPerProc||Di,d=Ba();for(const u of d.values())for(const e of u.events){const n=new Date(e.performedAt).getHours();let o=0;if("GoldGranter"===u.abilityId?o=i:"RainbowGranter"===u.abilityId?o=s:"ProduceScaleBoost"===u.abilityId?o=l:"ProduceScaleBoostII"===u.abilityId&&(o=c),o>0){const e=t.get(n)||{value:0,count:0};e.value+=o,e.count+=1,t.set(n,e)}}Bi.hourlyBreakdown=new Map;for(const[u,p]of t)Bi.hourlyBreakdown.set(u,p.value/Math.max(1,p.count))}(o);const x=function(e,t){const n=e-zi,o=Gi("GoldGranter",n),r=Gi("RainbowGranter",n),a=Gi("ProduceScaleBoost",n),i=Gi("ProduceScaleBoostII",n),s=ai("GoldGranter",t,null),l=ai("RainbowGranter",t,null),c=ai("ProduceScaleBoost",t,null),d=ai("ProduceScaleBoostII",t,null),u=s?.effectPerProc||Ri,p=l?.effectPerProc||Li,m=c?.effectPerProc||Di,f=d?.effectPerProc||Di;return o.count*u+r.count*p+a.count*m+i.count*f}(e,o);x>Bi.stats.bestHourValue&&(Bi.stats.bestHourValue=x,Bi.stats.bestHourTime=e),Bi.stats.sessionValue>Bi.stats.bestSessionValue&&(Bi.stats.bestSessionValue=Bi.stats.sessionValue,Bi.stats.bestSessionTime=e),Bi.updatedAt=e,Oi(),Vi()}const Oi=d(()=>{try{m.set(Ni,_i())}catch(e){console.error("[mutationValueTracking] Failed to save:",e)}},3e3);function _i(){return{version:1,stats:{goldProcs:Bi.stats.goldProcs,goldPerHour:Bi.stats.goldPerHour,goldTotalValue:Bi.stats.goldTotalValue,goldLastProcAt:Bi.stats.goldLastProcAt,rainbowProcs:Bi.stats.rainbowProcs,rainbowPerHour:Bi.stats.rainbowPerHour,rainbowTotalValue:Bi.stats.rainbowTotalValue,rainbowLastProcAt:Bi.stats.rainbowLastProcAt,cropBoostProcs:Bi.stats.cropBoostProcs,cropBoostPerHour:Bi.stats.cropBoostPerHour,cropBoostTotalValue:Bi.stats.cropBoostTotalValue,cropBoostLastProcAt:Bi.stats.cropBoostLastProcAt,sessionValue:Bi.stats.sessionValue,sessionStart:Bi.stats.sessionStart,bestHourValue:Bi.stats.bestHourValue,bestHourTime:Bi.stats.bestHourTime,bestSessionValue:Bi.stats.bestSessionValue,bestSessionTime:Bi.stats.bestSessionTime},sessions:Bi.sessions,updatedAt:Bi.updatedAt}}function Vi(){for(const t of ji)try{t(Bi)}catch(e){console.error("[mutationValueTracking] Listener error:",e)}}function Ui(){if(!Hi){Hi=!0;try{!function(e){e&&1===e.version&&(Bi.stats.bestHourValue=e.stats.bestHourValue||0,Bi.stats.bestHourTime=e.stats.bestHourTime||null,Bi.stats.bestSessionValue=e.stats.bestSessionValue||0,Bi.stats.bestSessionTime=e.stats.bestSessionTime||null,Bi.sessions=e.sessions||[],Bi.stats.sessionStart=Date.now(),Bi.updatedAt=Date.now())}(m.get(Ni,null)),s("üîÑ Mutation value tracking initialized - session data reset, tracking only current session")}catch(e){console.error("[mutationValueTracking] Failed to restore:",e)}Wi(),setInterval(()=>{Wi()},1e4)}}function Xi(){return{stats:{...Bi.stats},sessions:[...Bi.sessions],hourlyBreakdown:new Map(Bi.hourlyBreakdown),updatedAt:Bi.updatedAt}}function Ji(e){return ji.add(e),e(Xi()),()=>ji.delete(e)}function Ki(){!function(){const e=Date.now(),t=new Date(e).toISOString().split("T")[0];(Bi.stats.sessionValue>0||Bi.stats.goldProcs+Bi.stats.rainbowProcs+Bi.stats.cropBoostProcs>0)&&(Bi.sessions.push({date:t,value:Bi.stats.sessionValue,goldProcs:Bi.stats.goldProcs,rainbowProcs:Bi.stats.rainbowProcs,cropBoostProcs:Bi.stats.cropBoostProcs,duration:e-Bi.stats.sessionStart}),Bi.sessions.length>30&&(Bi.sessions=Bi.sessions.slice(-30)))}(),qi();const e=Date.now();Bi={stats:{goldProcs:0,goldPerHour:0,goldTotalValue:0,goldLastProcAt:null,rainbowProcs:0,rainbowPerHour:0,rainbowTotalValue:0,rainbowLastProcAt:null,cropBoostProcs:0,cropBoostPerHour:0,cropBoostTotalValue:0,cropBoostLastProcAt:null,sessionValue:0,sessionStart:e,bestHourValue:Bi.stats.bestHourValue,bestHourTime:Bi.stats.bestHourTime,bestSessionValue:Bi.stats.bestSessionValue,bestSessionTime:Bi.stats.bestSessionTime},sessions:Bi.sessions,hourlyBreakdown:new Map,updatedAt:Date.now()};try{m.set(Ni,_i())}catch(t){console.error("[mutationValueTracking] Failed to save after reset:",t)}Vi(),s("‚úÖ [MUTATION-VALUE] Reset complete - session stats cleared")}const Qi="myInventoryAtom",Yi="myCropInventoryAtom";let Zi=[],es=new Set,ts=null,ns=!1;function os(e){if(!e||"object"!=typeof e)return null;const t=String(e.id??e.itemId??"");return t?{id:t,itemId:e.itemId,species:e.species??e.petSpecies??null,name:e.name??e.displayName??null,displayName:e.displayName??e.name??null,itemType:e.itemType??null,quantity:e.quantity??e.count??e.amount??e.stackSize,count:e.count,amount:e.amount,stackSize:e.stackSize,raw:e}:null}function rs(e){if(!e)return null;let t=[];if(Array.isArray(e))t=e;else if(Array.isArray(e.items))t=e.items;else if(Array.isArray(e.inventory))t=e.inventory;else if("object"==typeof e){const n=Object.values(e).find(e=>Array.isArray(e)&&e.length>0&&"object"==typeof e[0]);n&&(t=n)}const n=[];for(const r of t){const e=os(r);e&&n.push(e)}let o=[];return Array.isArray(e?.favoritedItemIds)?o=e.favoritedItemIds.filter(e=>"string"==typeof e):Array.isArray(e?.favorites)&&(o=e.favorites.filter(e=>"string"==typeof e)),{items:n,favoritedItemIds:o}}async function as(){if(!ts&&!ns){ns=!0;try{let e=$(Qi);if(e||(s("‚ö†Ô∏è myInventoryAtom not found, trying myCropInventoryAtom"),e=$(Yi)),!e)return s("‚ö†Ô∏è Inventory atom not found"),void(ns=!1);ts=await I(e,e=>{!function(e){const t=rs(e);t?(Zi=t.items,es=new Set(t.favoritedItemIds??[])):(Zi=[],es=new Set)}(e)}),s("‚úÖ Inventory store initialized")}catch(e){s("‚ùå Failed to initialize inventory store",e)}finally{ns=!1}}}async function is(){try{let e=$(Qi);if(e||(e=$(Yi)),!e)return s("‚ö†Ô∏è Inventory atom not found"),null;return rs(await F(e))}catch(e){return s("‚ùå Failed to read inventory atom",e),null}}const ss="qpm.autoFavorite.v1";let ls={enabled:!1,species:[],mutations:[],petAbilities:[]};const cs=new Set;let ds=null,us=new Set;function ps(){try{m.set(ss,ls),function(){for(const t of cs)try{t({...ls})}catch(e){s("‚ö†Ô∏è Auto-favorite listener error",e)}}()}catch(e){s("‚ö†Ô∏è Failed to save auto-favorite config",e)}}function ms(e){const t=h;if(!t?.myData?.inventory?.items)return void s("üåü [AUTO-FAVORITE] No myData available yet - waiting for game to load");const n=t.myData.inventory.items,o=new Set(t.myData.inventory.favoritedItemIds||[]);let r=0;for(const a of n)"Produce"===a.itemType&&"Pet"!==a.itemType&&"Egg"!==a.itemType&&"Tool"!==a.itemType&&"Pet"!==a.category&&"Egg"!==a.category&&"Tool"!==a.category&&(a.species&&(a.species.includes("Pet")||a.species.includes("Egg"))||a.species!==e||o.has(a.id)||ws(a.id)&&r++);s(r>0?`‚úÖ [AUTO-FAVORITE] Favorited ${r} ${e} crops`:`‚ÑπÔ∏è [AUTO-FAVORITE] No ${e} crops to favorite (already favorited or none in inventory)`)}function fs(e){s(`üîí [AUTO-FAVORITE] Checkbox unchecked for ${e} - Auto-favorite disabled, but existing favorites are preserved (script never removes favorites)`)}function gs(e){const t=h;if(!t?.myData?.inventory?.items)return void s("üåü [AUTO-FAVORITE] No myData available yet - waiting for game to load");const n=t.myData.inventory.items,o=new Set(t.myData.inventory.favoritedItemIds||[]);let r=0;for(const a of n){if("Produce"!==a.itemType)continue;if("Pet"===a.itemType||"Egg"===a.itemType||"Tool"===a.itemType)continue;if("Pet"===a.category||"Egg"===a.category||"Tool"===a.category)continue;if(a.species&&(a.species.includes("Pet")||a.species.includes("Egg")))continue;(a.mutations||[]).includes(e)&&!o.has(a.id)&&ws(a.id)&&r++}s(r>0?`‚úÖ [AUTO-FAVORITE] Favorited ${r} crops with ${e} mutation`:`‚ÑπÔ∏è [AUTO-FAVORITE] No crops with ${e} mutation to favorite (already favorited or none in inventory)`)}function hs(e){s(`üîí [AUTO-FAVORITE] Checkbox unchecked for ${e} mutation - Auto-favorite disabled, but existing favorites are preserved (script never removes favorites)`)}function bs(e){const t=h;if(!t?.myData?.inventory?.items)return void s("üåü [AUTO-FAVORITE-PET] No myData available yet - waiting for game to load");s(`üîç [AUTO-FAVORITE-PET] Searching for pets with ${e}...`);const n=t.myData.inventory.items,o=new Set(t.myData.inventory.favoritedItemIds||[]);let r=0,a=0;const i=n.find(e=>"Pet"===e.itemType);i&&s("üêæ [AUTO-FAVORITE-PET-DEBUG] Sample pet structure:",{species:i.petSpecies,mutations:i.mutations,abilities:i.abilities,hasAbilitiesArray:Array.isArray(i.abilities),hasMutationsArray:Array.isArray(i.mutations)});for(const l of n){if("Pet"!==l.itemType)continue;if(a++,o.has(l.id))continue;const t=l.mutations||[],n=t.includes("Gold"),i=t.includes("Rainbow"),c=l.abilities||[],d=c.some(e=>{const t="string"==typeof e?e:e?.type||e?.abilityType||"";return t.toLowerCase().includes("gold")&&t.toLowerCase().includes("grant")}),u=c.some(e=>{const t="string"==typeof e?e:e?.type||e?.abilityType||"";return t.toLowerCase().includes("rainbow")&&t.toLowerCase().includes("grant")});("Gold Granter"===e&&(n||d)||"Rainbow Granter"===e&&(i||u))&&(s(`‚ú® [AUTO-FAVORITE-PET] Found matching pet: ${l.petSpecies||l.species} (${l.id}) - mutations: [${t.join(", ")}], abilities: ${c.length}`),ws(l.id)&&r++)}s(`‚úÖ [AUTO-FAVORITE-PET] Scanned ${a} pets, favorited ${r} with ${e}`)}function ys(e){s(`üîí [AUTO-FAVORITE-PET] Checkbox unchecked for ${e} - Auto-favorite disabled, but existing favorites are preserved (script never removes favorites)`)}function xs(){try{const e=h;return e?.__mga_lastScopePath?.slice()??["Room","Quinoa"]}catch{return["Room","Quinoa"]}}function ws(e){try{const t=h,n=t?.MagicCircle_RoomConnection;return!(!n||"function"!=typeof n.sendMessage)&&(n.sendMessage({scopePath:xs(),type:"ToggleFavoriteItem",itemId:e}),!0)}catch(t){return s(`‚ö†Ô∏è Failed to favorite item ${e}`,t),!1}}function vs(){null===ds&&(ds=window.setInterval(()=>{if(!ls.enabled)return;const e=ls.species||[],t=ls.mutations||[],n=ls.petAbilities||[];if(0===e.length&&0===t.length&&0===n.length)return;if(null===ts)return;const o=[...Zi],r=new Set(es),a=new Set;for(const s of o)s?.id&&a.add(s.id);const i=new Set;for(const s of a)us.has(s)||i.add(s);if(i.size>0){const a=o.filter(e=>e.id&&i.has(e.id));for(const o of a){if(r.has(o.id))continue;const a=o.raw,i=Array.isArray(a?.mutations)?a.mutations:[],l=Array.isArray(a?.abilities)?a.abilities:[];let c=!1,d="";if(t.length>0&&i.length>0){const e=i.find(e=>t.some(t=>t.toLowerCase()===String(e).toLowerCase()));e&&(c=!0,d=`mutation: ${e}`)}if(n.length>0&&l.length>0){const e=l.find(e=>n.some(t=>t.toLowerCase()===String(e).toLowerCase()));e&&(c=!0,d=`ability: ${e}`)}if(e.length>0&&o.species){e.some(e=>e.toLowerCase()===o.species.toLowerCase())&&(c=!0,d=`species: ${o.species}`)}c&&(s(`[AUTO-FAVORITE] Favoriting ${o.species||"item"} (${d})`),ws(o.id))}}us=a},2e3),s("‚úÖ Auto-favorite polling started (2 second interval)"))}function Cs(){!function(){try{const e=m.get(ss,null);e&&"object"==typeof e&&(ls={enabled:e.enabled??ls.enabled,species:e.species??ls.species,mutations:e.mutations??ls.mutations,petAbilities:e.petAbilities??ls.petAbilities})}catch(e){s("‚ö†Ô∏è Failed to load auto-favorite config",e)}}(),vs();const e=h;e.qpm_favoriteSpecies=ms,e.qpm_unfavoriteSpecies=fs,e.qpm_favoriteMutation=gs,e.qpm_unfavoriteMutation=hs,e.qpm_favoritePetAbility=bs,e.qpm_unfavoritePetAbility=ys,s("‚úÖ [AUTO-FAVORITE] System initialized - monitoring inventory changes",ls)}function Ts(){return{...ls}}function Ss(e){ls={...ls,...e},ps(),ls.enabled&&vs()}const ks="qpm.shopRestocks.v1",As="qpm.shopRestockConfig.v1",Ps="qpm.shopRestocks.migration",Ms={Starweaver:"celestial",Dawnbinder:"celestial",Moonbinder:"celestial",Sunflower:"divine",Lychee:"divine","Dragon Fruit":"divine","Passion Fruit":"divine",Lemon:"divine",Pepper:"divine","Mythical Eggs":"mythic",Grape:"mythic",Chrysanthemum:"mythic",Bamboo:"mythic",Cactus:"mythic",Mushroom:"mythic",Lily:"rare","Burro's Tail":"rare",Echeveria:"rare","Legendary Eggs":"rare","Rare Eggs":"rare",Watermelon:"uncommon",Pumpkin:"uncommon","Uncommon Eggs":"uncommon",Carrot:"common",Strawberry:"common",Aloe:"common",Delphinium:"common",Blueberry:"common",Apple:"common",Tulip:"common",Tomato:"common",Daffodil:"common",Corn:"common",Coconut:"common",Banana:"common",Camellia:"common",Squash:"common"};function Es(e){return Ms[e]||"common"}let $s=[],Fs={importedFiles:[],watchedItems:[]},Is=[],qs=!1;function Ns(){if(qs)s("üìä Restock tracker already initialized, skipping reload");else try{const e=m.get(ks,[]);$s=e;const t=m.get(As,{importedFiles:[],watchedItems:[]});Fs=t;const n=function(){if(m.get(Ps,0)>=1)return 0;if(0===$s.length)return m.set(Ps,1),0;s("üîÑ Migrating restock data to fix timezone interpretation...");const e=60*-(new Date).getTimezoneOffset()*1e3-36e6;let t=0;for(const n of $s)n.timestamp+=e,t++;return t>0&&(m.set(ks,$s),s(`‚úÖ Migrated ${t} restock events (adjusted by ${(e/36e5).toFixed(1)} hours)`)),m.set(Ps,1),t}();qs=!0,n>0?(s(`üìä Loaded ${$s.length} restock events from storage (${n} migrated to correct timezone)`),setTimeout(()=>{!function(e){const t={...e,id:`notif-${Date.now()}-${++ya}`,timestamp:Date.now()};ha.push(t),ha.length>100&&ha.splice(0,ha.length-100),xa()}({feature:"shop-restock-tracker",level:"success",message:`‚úÖ Updated ${n} restock times to correct timezone`})},2e3)):s(`üìä Loaded ${$s.length} restock events from storage`)}catch(e){s("‚ö†Ô∏è Failed to load restock data",e)}}function zs(){try{const e=m.get(ks,[]),t=new Set($s.map(e=>e.id));let n=0;for(const o of e)t.has(o.id)||($s.push(o),t.add(o.id),n++);n>0&&($s.sort((e,t)=>e.timestamp-t.timestamp),s(`üîÑ Merged ${n} events from storage (multi-tab sync)`)),m.set(ks,$s),m.set(As,Fs)}catch(e){s("‚ö†Ô∏è Failed to save restock data",e)}}function Rs(){return[...$s]}function Ls(){const e=new Map,t=$s.length;if(0===t)return e;for(const n of $s)for(const t of n.items){const o=e.get(t.name);o?(o.totalRestocks++,o.totalQuantity+=t.quantity,o.lastSeen=Math.max(o.lastSeen,n.timestamp),o.firstSeen=Math.min(o.firstSeen,n.timestamp)):e.set(t.name,{name:t.name,type:t.type,totalRestocks:1,totalQuantity:t.quantity,avgQuantity:0,lastSeen:n.timestamp,firstSeen:n.timestamp,appearanceRate:0,rarity:Es(t.name)})}for(const n of e.values())n.avgQuantity=n.totalQuantity/n.totalRestocks,n.appearanceRate=n.totalRestocks/t*100,n.rarity=Es(n.name);return e}function Ds(){if(0===$s.length)return{totalRestocks:0,totalItems:0,dateRange:null,avgRestockInterval:0,uniqueItems:0};const e=$s.reduce((e,t)=>e+t.items.length,0),t=$s.map(e=>e.timestamp).sort((e,t)=>e-t),n={start:t[0],end:t[t.length-1]};let o=0;for(let i=1;i<t.length;i++){const e=t[i],n=t[i-1];void 0!==e&&void 0!==n&&(o+=e-n)}const r=t.length>1?o/(t.length-1)/1e3/60:0,a=new Set($s.flatMap(e=>e.items.map(e=>e.name))).size;return{totalRestocks:$s.length,totalItems:e,dateRange:t.length>0?n:null,avgRestockInterval:r,uniqueItems:a}}function Bs(e){if($s.length<2)return null;const t=Ls().get(e);if(!t||0===t.appearanceRate)return null;const n=60*Ds().avgRestockInterval*1e3;if(0===n)return null;const o=1/(t.appearanceRate/100);let r=t.lastSeen+n*o;const a=Date.now();if(r<a){const e=a-r;r+=n*o*Math.ceil(e/(n*o))}return r}function Hs(e){return Is.push(e),()=>{Is=Is.filter(t=>t!==e)}}function js(){Is.forEach(e=>{try{e()}catch(t){s("‚ö†Ô∏è Restock callback error",t)}})}const Gs=["seeds","eggs","tools","decor"],Ws={seeds:"seed",eggs:"egg",tools:"tool",decor:"decor"},Os=new Set;let _s=null,Vs=null,Us=function(){const e=Object.create(null),t=Date.now();for(const n of Gs)e[n]={category:n,secondsUntilRestock:null,nextRestockAt:null,restockIntervalMs:null,items:[],availableCount:0,signature:"",updatedAt:t,raw:null};return{updatedAt:t,categories:e}}(),Xs=null,Js=null,Ks=null;function Qs(e){const t=function(e){if("number"==typeof e&&Number.isFinite(e))return e;if("string"==typeof e){const t=e.match(/-?\d+(?:\.\d+)?/);if(t){const e=Number(t[0]);if(Number.isFinite(e))return e}}return null}(e);if(null==t)return null;const n=Math.round(t);return n>0?n:null}function Ys(e,t,n,o){if(!t||"object"!=typeof t)return null;const r=function(e,t){switch(e){case"seeds":return null!=t.species?String(t.species):null!=t.id?String(t.id):null;case"eggs":return null!=t.eggId?String(t.eggId):null!=t.id?String(t.id):null;case"tools":return null!=t.toolId?String(t.toolId):null!=t.id?String(t.id):null;case"decor":return null!=t.decorId?String(t.decorId):null!=t.id?String(t.id):null;default:return null!=t.id?String(t.id):null}}(e,t);if(!r)return null;const a=function(e){const t=e.name??e.displayName??e.species??e.petSpecies??e.toolId??e.decorId??e.eggId??e.id??"Item";return String(t).trim()}(t),i=function(e){const t=[e.initialStock,e.stock,e.availableStock,e.quantity,e.count,e.amount];for(const n of t){const e=Qs(n);if(null!=e)return e}return 0===e.initialStock?0:null}(t),s=Qs(t.stock??t.availableStock??t.remaining),l=function(e){const t=[e.quantityPerPurchase,e.bundleSize,e.quantityPerClick,e.quantity];for(const n of t){const e=Qs(n);if(null!=e)return e}return 1}(t),{coins:c,credits:d}=function(e){const t=[e.priceCoins,e.coins,e.price,e.cost],n=[e.priceCredits,e.credits,e.creditCost];let o=null,r=null;for(const a of t){const e=Qs(a);if(null!=e){o=e;break}}for(const a of n){const e=Qs(a);if(null!=e){r=e;break}}return{coins:o,credits:r}}(t),u=!1!==t.canSpawnHere,p=function(e,t,n){const o=Ws[e],r=n?.[o]?.purchases;if(!r||"object"!=typeof r)return 0;const a=r[t];if(null!=a&&Number.isFinite(Number(a)))return Number(a);const i=Number(t);return Number.isFinite(i)&&null!=r[i]&&Number.isFinite(Number(r[i]))?Number(r[i]):0}(e,String(r),n);let m=function(e,t,n){if(null==e)return n?null:0;const o=Number.isFinite(t)?Math.max(0,Math.round(t)):0,r=Math.max(0,e-o);return n?r:0}(i,p,u);null!=s&&(m=s);let f=!1;return f=!!u&&(null!=s?s>0:null==m||m>0),{category:e,id:String(r),label:a,orderIndex:o,initialStock:i,currentStock:s,remaining:m,purchased:p,canSpawn:u,isAvailable:f,priceCoins:c,priceCredits:d,quantityPerPurchase:l,raw:t}}function Zs(e,t,n){const o=Date.now(),r=Array.isArray(t?.inventory)?t.inventory:[],a=[];r.forEach((t,o)=>{const r=Ys(e,t,n,o);r&&a.push(r)});const i=a.filter(e=>e.isAvailable).length,s=a.map(e=>`${e.id}:${e.remaining??"x"}:${e.currentStock??"x"}:${e.purchased}`).join("|"),l="number"==typeof t?.secondsUntilRestock?t.secondsUntilRestock:null,c="number"==typeof t?.nextRestockAt?t.nextRestockAt:null,d="number"==typeof t?.restockIntervalMs?t.restockIntervalMs:null;return{category:e,secondsUntilRestock:l,nextRestockAt:c,restockIntervalMs:d,items:a,availableCount:i,signature:s,updatedAt:o,raw:t??null}}function el(){const e=Date.now(),t=Object.create(null);for(const n of Gs){const e=Ws[n],o=_s?.[e]??null;t[n]=Zs(n,o,Vs)}Us={updatedAt:e,categories:t},function(){for(const t of Os)try{t(Us)}catch(e){s("‚ö†Ô∏è ShopStock listener error",e)}}()}let tl=null,nl=null,ol=!1;const rl=["Carrot","Strawberry","Aloe","Delphinium","Blueberry","Apple","Tulip","Tomato","Daffodil","Corn","Watermelon","Pumpkin","Echeveria","Coconut","Banana","Lily","Camellia","Squash","Burro's Tail","Mushroom","Cactus","Bamboo","Chrysanthemum","Grape","Pepper","Lemon","Passion Fruit","Dragon Fruit","Lychee","Sunflower","Starweaver","Dawnbinder","Moonbinder","Starweaver Pod","Dawnbinder Pod","Moonbinder Pod","Uncommon Eggs","Uncommon Egg","Rare Eggs","Rare Egg","Mythical Eggs","Mythical Egg","Legendary Eggs","Legendary Egg"],al=[/!!!/,/omg/i,/ping/i,/spam/i,/^\d+/,/\d+\s+[A-Z]/,/stock!!!/i,/vegetables/i,/named/i];function il(e){return!!function(e){return!(al.some(t=>t.test(e))||e.length>50)}(e)&&rl.some(t=>e.includes(t))}function sl(e){return e.includes("Eggs")||e.includes("Egg")||e.includes("egg")?"egg":rl.some(t=>e.includes(t))?"seed":"unknown"}function ll(e,t){const n=t.map(e=>`${e.name}:${e.quantity}`).join(",");return`${e}-${btoa(n).substring(0,8)}`}async function cl(){if(ol)s("‚ö†Ô∏è Shop tracking already active");else try{s("üìä Starting live shop restock tracking..."),await async function(){return Xs||(Xs=(async()=>{try{_s=await Be("shops")}catch(e){s("‚ö†Ô∏è Failed to read shops atom initially",e),_s=null}try{Vs=await Be("shopPurchases")}catch(e){s("‚ö†Ô∏è Failed to read shop purchases atom initially",e),Vs=null}el();try{Js=await He("shops",e=>{_s=e,el()})}catch(e){s("‚ö†Ô∏è Failed to subscribe to shops atom",e)}try{Ks=await He("shopPurchases",e=>{Vs=e,el()})}catch(e){s("‚ö†Ô∏è Failed to subscribe to shop purchases atom",e)}})().catch(e=>{s("‚ö†Ô∏è startShopStockStore error",e),Xs=null}),Xs)}().catch(e=>{s("‚ö†Ô∏è Failed to start shop stock store",e)});const e=function(e,t=!0){if(Os.add(e),t)try{e(Us)}catch(n){s("‚ö†Ô∏è ShopStock immediate listener error",n)}return()=>{Os.delete(e)}}(e=>{try{const t=function(e){const t=new Map;try{for(const[n,o]of Object.entries(e.categories))if(o&&o.items)for(const e of o.items){const n=e.label||e.id,o=e.initialStock||e.currentStock||e.remaining||0;n&&il(n)&&o>0&&t.set(n,o)}}catch(n){s("‚ö†Ô∏è Failed to extract shop inventory:",n)}return t}(e),n=function(e,t){const n=[];if(!t)return n;for(const[o,r]of e.entries())r>(t.get(o)||0)&&n.push({name:o,quantity:r,type:sl(o)});return n}(t,nl);if(n.length>0){s(`üè™ RESTOCK DETECTED! Items: ${n.map(e=>`${e.name} (${e.quantity})`).join(", ")}`);const e=Date.now();!function(e){$s.some(t=>t.id===e.id)?s("‚ö†Ô∏è Duplicate restock event skipped"):($s.push(e),$s.sort((e,t)=>e.timestamp-t.timestamp),s(`‚úÖ Saved restock event (${e.source}): Total ${$s.length} events`),zs(),js())}({id:ll(e,n),timestamp:e,dateString:new Date(e).toLocaleString(),items:n,source:"live"})}nl=t}catch(t){s("‚ö†Ô∏è Error processing shop update:",t)}},!1);tl=e,ol=!0,s("‚úÖ Live shop tracking active")}catch(e){s("‚ùå Failed to start live shop tracking:",e)}}const dl="https://raw.githubusercontent.com/ryandt2305-cpu/QPM-GR/main/dist/QPM.user.js",ul="1.10.0",pl=36e5;let ml=null,fl=0,gl=null;function hl(e){return e.split(".").map(e=>parseInt(e,10)||0)}async function bl(e=!1){const t=Date.now();if(!e&&ml&&t-fl<pl)return ml;gl&&gl({current:ul,latest:null,status:"checking",updateUrl:dl}),fl=t;const n=await async function(){try{if("undefined"!=typeof GM_xmlhttpRequest)return new Promise(e=>{GM_xmlhttpRequest({method:"GET",url:dl,headers:{"Cache-Control":"no-cache"},onload:t=>{if(200!==t.status)return s(`‚ö†Ô∏è Failed to fetch latest version: ${t.status}`),void e(null);const n=t.responseText.match(/\/\/\s*@version\s+([\d.]+)/);n&&n[1]?e(n[1]):(s("‚ö†Ô∏è Could not parse version from GitHub file"),e(null))},onerror:t=>{s("‚ùå Error fetching latest version via GM_xmlhttpRequest:",t),e(null)},ontimeout:()=>{s("‚ùå Timeout fetching latest version"),e(null)}})});const e=await fetch(dl,{cache:"no-cache",headers:{"Cache-Control":"no-cache"}});if(!e.ok)return s(`‚ö†Ô∏è Failed to fetch latest version: ${e.status}`),null;const t=(await e.text()).match(/\/\/\s*@version\s+([\d.]+)/);return t&&t[1]?t[1]:(s("‚ö†Ô∏è Could not parse version from GitHub file"),null)}catch(e){return s("‚ùå Error fetching latest version:",e),null}}();let o="error";if(n){(function(e,t){const n=hl(e),o=hl(t);for(let r=0;r<Math.max(n.length,o.length);r++){const e=n[r]||0,t=o[r]||0;if(e>t)return 1;if(e<t)return-1}return 0})(ul,n)<0?(o="outdated",s(`üì¶ New version available: ${n} (current: ${ul})`)):(o="up-to-date",s(`‚úÖ QPM is up to date (${ul})`))}return ml={current:ul,latest:n,status:o,updateUrl:dl},gl&&gl(ml),ml}function yl(){return ml||{current:ul,latest:null,status:"checking",updateUrl:dl}}let xl={panel:null,content:null,status:null,toggle:null,weatherStatus:null,shopStatus:null,shopItemToggles:null,mutationStatus:null,headerContainer:null,headerAutoFeed:null,headerWeather:null,headerShop:null,headerMeta:null,headerTimer:null,dashboardFeedList:null,dashboardFeedMeta:null,dashboardRestockSummary:null,dashboardRestockValues:{seeds:null,eggs:null,tools:null,decor:null},turtleStatus:null,turtleDetail:null,turtleFooter:null,turtleEnableButtons:[],turtleBoardwalkToggles:[],turtleFocusSelects:[],turtleFocusTargetSelects:[],turtleFocusTargetContainers:[],turtleEggFocusSelects:[],turtleEggFocusTargetSelects:[],turtleEggFocusTargetContainers:[],turtlePlantSummary:null,turtlePlantEta:null,turtlePlantTable:null,turtlePlantTotals:null,turtlePlantSimple:null,turtlePlantLuck:null,turtleEggSummary:null,turtleEggEta:null,turtleEggTable:null,turtleEggTotals:null,turtleEggSimple:null,turtleEggLuck:null,turtleSupportSummary:null,turtleSupportTotals:null,turtleSupportSimple:null,turtleSupportList:null,trackerAbilitySummary:null,trackerAbilityFilterSelect:null,trackerAbilityTable:null,trackerAbilityUnknown:null,trackerXpSummary:null,trackerXpAbilityTable:null,trackerXpPerPetTable:null,trackerXpTargetModeSelect:null,trackerXpTargetPetSelect:null,mutationTrackerCard:null,mutationTrackerSummary:null,mutationTrackerTotals:null,mutationTrackerRatios:null,mutationTrackerCountdown:null,mutationTrackerDetail:null,mutationTrackerTable:null,mutationTrackerSourceSelect:null,mutationTrackerDetailToggle:null,mutationTrackerSourceBadge:null,mutationTrackerEmpty:null,trackerAbilityHistoryUnsubscribe:null,trackerAbilityTicker:null,xpTrackerWindow:null,shopRestockWindow:null,mutationTrackerUnsubscribe:null,mutationTrackerTicker:null,turtleUnsubscribe:null,notificationsSection:null,notificationsListWrapper:null,notificationsList:null,notificationsFilterBar:null,notificationsEmpty:null,notificationsUnsubscribe:null,notificationsDetail:null,notificationsDetailHeader:null,notificationsDetailTitle:null,notificationsDetailTimestamp:null,notificationsDetailMeta:null,notificationsDetailMessage:null,notificationsDetailActions:null,notificationsDetailRaw:null,notificationsDetailPlaceholder:null,notificationsDetailToggle:null},wl="Waiting for auto-feed...",vl=0,Cl=0,Tl=null;const Sl={info:"#64b5f6",success:"var(--qpm-accent)",warn:"#ffb74d",error:"#ef5350"},kl={info:"‚ÑπÔ∏è",success:"‚úÖ",warn:"‚ö†Ô∏è",error:"‚õî"},Al="quinoa-ui-panel-position",Pl="quinoa-ui-panel-collapsed",Ml="quinoa-ui-notifications-collapsed",El="quinoa-ui-notifications-detail-expanded",$l="qpm-toast-style",Fl=new Set;let Il=[],ql=null;const Nl=new Map,zl=new Map;let Rl=null,Ll=m.get(Ml,!1)??!1,Dl=m.get(El,!1)??!1,Bl=0;const Hl={plant:5,egg:10};function jl(e){if(!e)return{tileId:null,slotIndex:null};const[t,n]=e.split("::"),o=Number.parseInt(n??"",10);return t&&Number.isFinite(o)?{tileId:t,slotIndex:o}:{tileId:null,slotIndex:null}}function Gl(e){if(null==e||!Number.isFinite(e))return"‚Äî";if(e<=0)return"Ready";const t=Math.round(e/1e3);if(t<60)return`${t}s`;const n=Math.floor(t/60),o=t%60;if(n<60)return o>0?`${n}m ${o}s`:`${n}m`;const r=Math.floor(n/60),a=n%60;return a>0?`${r}h ${a.toString().padStart(2,"0")}m`:`${r}h`}function Wl(e){return null!=e&&Number.isFinite(e)?`${e.toFixed(2)}√ó`:"1.00√ó"}function Ol(e){return null!=e&&Number.isFinite(e)?`${Math.round(e)}%`:"‚Äî"}function _l(e,t=0){return null!=e&&Number.isFinite(e)?`${e.toFixed(t)}%`:"0%"}function Vl(e,t=1){if(null==e||!Number.isFinite(e)||e<=0)return"0.0 feeds/hr";return`${(e/100).toFixed(t)} feeds/hr`}function Ul(e){if(null==e||!Number.isFinite(e))return"‚Äî";if(e<1){return`${Math.max(1,Math.round(60*e))}s`}if(e>=60){const t=Math.floor(e/60),n=Math.round(e%60);return n>0?`${t}h ${n}m`:`${t}h`}return`${Math.round(e)}m`}function Xl(e,t,n,o){const r=document.createElement("span");return r.style.cssText="cursor:pointer;text-decoration:underline dotted;",r.title=`Click to manually set ${t} value (leave empty to clear)`,r.textContent=o(n),r.addEventListener("click",o=>{o.stopPropagation();const a=document.createElement("input");a.type="number",a.style.cssText="width:60px;font-size:9px;padding:2px;border:1px solid #4CAF50;background:#1a1a1a;color:#fff;",a.value=null!=n?String(n):"",a.placeholder="xp"===t?"XP":"Scale",a.step="targetScale"===t?"0.01":"1";const i=()=>{const n=a.value.trim(),o={species:e.species,slotIndex:e.slotIndex,petId:e.petId??null};if(""===n)!function(e,t){const n=qr(e);Fr[n]&&(t?(delete Fr[n][t],0===Object.keys(Fr[n]).length&&delete Fr[n]):delete Fr[n],Ir(),ma())}(o,t);else{const e=Number(n);Number.isFinite(e)&&e>=0&&function(e,t){const n=qr(e);Fr[n]||(Fr[n]={}),Object.assign(Fr[n],t),Ir(),ma()}(o,{[t]:e})}a.remove(),r.style.display=""};a.addEventListener("blur",()=>setTimeout(i,100)),a.addEventListener("keydown",e=>{"Enter"===e.key?(e.preventDefault(),i()):"Escape"===e.key&&(r.style.display="",a.remove())}),r.style.display="none",r.parentElement?.insertBefore(a,r.nextSibling),a.focus(),a.select()}),r}function Jl(e){if(null==e||!Number.isFinite(e)||0===e)return"0m per hour";const t=e>=0?"-":"+",n=Math.abs(e),o=Math.max(0,Math.round(n)),r=Math.floor(o/60),a=o%60,i=[];return r>0&&i.push(`${r}hr`),(a>0||0===i.length)&&i.push(`${a}m`),`${t}${i.join(" ")} per hour`}const Kl=e=>{if("number"==typeof e&&Number.isFinite(e))return e;if("string"==typeof e){const t=e.replace(/[^0-9.+-]/g,"");if(!t)return null;const n=Number(t);return Number.isFinite(n)?n:null}return null},Ql=(e,...t)=>{if(!e||"object"!=typeof e)return null;const n=e;for(const o of t){if(!(o in n))continue;const e=Kl(n[o]);if(null!=e)return e}return null},Yl=(e,t)=>{const n=[];return e.petId&&n.push(e.petId),e.slotId&&n.push(e.slotId),"number"==typeof e.slotIndex&&Number.isFinite(e.slotIndex)&&n.push(String(Math.max(0,Math.round(e.slotIndex)))),Da(t,{petId:e.petId,slotId:e.slotId,slotIndex:"number"==typeof e.slotIndex&&Number.isFinite(e.slotIndex)?e.slotIndex:null,fallbackKeys:n})},Zl=e=>{const t=Date.now()-144e5;return e.events.filter(e=>e.performedAt>=t)},ec=(e,t)=>{const n=t.data;switch(e.category){case"xp":return Ql(n,"bonusXp","xp","value");case"plantGrowth":return Ql(n,"plantGrowthReductionMinutes","reductionMinutes","minutes");case"eggGrowth":return Ql(n,"eggGrowthTimeReductionMinutes","reductionMinutes","minutes");case"coins":return Ql(n,"coinsFound","coins","coinsEarned","sellPrice","bonusCoins","value","valueEarned","coinsValue");default:return null}},tc=(e,t)=>{const n=Zl(e);if(!n.length)return null;const o=n[n.length-1],r=n[0];let a=null;if(n.length>=2){const e=o.performedAt-r.performedAt;e>0&&(a=(n.length-1)/(e/36e5))}const i=[];for(const s of n){const e=ec(t,s);null!=e&&Number.isFinite(e)&&i.push(e)}return{procsPerHour:a,effectPerProc:i.length?i.reduce((e,t)=>e+t,0)/i.length:null,lastProcAt:o.performedAt,sampleCount:n.length}};function nc(e){return e.name&&e.name.trim().length>0?e.name:e.species&&e.species.trim().length>0?e.species:"number"==typeof e.slotIndex&&Number.isFinite(e.slotIndex)?`Pet ${e.slotIndex+1}`:"Unknown pet"}function oc(){const e=cc.turtleTimer??{},t={enabled:e.enabled??!0,includeBoardwalk:e.includeBoardwalk??!1,focus:"earliest"===e.focus||"specific"===e.focus?e.focus:"latest",focusTargetTileId:"string"==typeof e.focusTargetTileId?e.focusTargetTileId:null,focusTargetSlotIndex:"number"==typeof e.focusTargetSlotIndex&&Number.isFinite(e.focusTargetSlotIndex)?Math.max(0,Math.round(e.focusTargetSlotIndex)):null,eggFocus:"earliest"===e.eggFocus||"specific"===e.eggFocus?e.eggFocus:"latest",eggFocusTargetTileId:"string"==typeof e.eggFocusTargetTileId?e.eggFocusTargetTileId:null,eggFocusTargetSlotIndex:"number"==typeof e.eggFocusTargetSlotIndex&&Number.isFinite(e.eggFocusTargetSlotIndex)?Math.max(0,Math.round(e.eggFocusTargetSlotIndex)):null};return cc.turtleTimer=t,t}function rc(e){if(null==e||!Number.isFinite(e))return"";const t=new Date(Date.now()+e),n=t.getHours(),o=n>=12?"PM":"AM";return` ‚Ä¢ ${n%12||12}:${t.getMinutes().toString().padStart(2,"0")} ${o}`}function ac(e){if("estimating"!==e.status||null==e.naturalMsRemaining||null==e.adjustedMsRemaining||!Number.isFinite(e.adjustedMsRemaining))return{luckyMs:null,unluckyMs:null,stdMinutes:null};const t=Math.max(0,e.adjustedMsRemaining/6e4),n=Math.max(1,t);let o=0;for(const a of e.contributions){const e=a.ability,t=Hl[e];if(!Number.isFinite(t))continue;const r=t*(a.baseScore/100);if(!Number.isFinite(r)||r<=0)continue;const i=a.rateContribution;if(!Number.isFinite(i)||i<=0)continue;const s=Math.min(.99,Math.max(0,i/Math.max(r,1e-4)));if(s<=0)continue;o+=n*s*(1-s)*r*r}if(o<=0)return{luckyMs:e.adjustedMsRemaining,unluckyMs:e.adjustedMsRemaining,stdMinutes:0};const r=Math.sqrt(o);return{luckyMs:6e4*Math.max(0,t-r),unluckyMs:6e4*(t+r),stdMinutes:r}}function ic(e){const t=e.plant,n=e.egg,o=e.support,r=t.contributions.reduce((e,t)=>e+(t.perHourReduction??0),0),a=null!=t.naturalMsRemaining?t.naturalMsRemaining/6e4:null;null!=t.adjustedMsRemaining&&t.adjustedMsRemaining;const i=t.minutesSaved??null,s=ac(t),l=n.contributions.reduce((e,t)=>e+(t.perHourReduction??0),0),c=null!=n.naturalMsRemaining?n.naturalMsRemaining/6e4:null;null!=n.adjustedMsRemaining&&n.adjustedMsRemaining;const d=n.minutesSaved??null,u=ac(n),p=o.restorePctActive;o.restorePctTotal;const m=o.restorePctPerHourActive,f=o.restorePctPerHourTotal,g=o.restoreTriggersPerHourActive;o.restoreTriggersPerHourTotal;const h=o.slowPctActive,b=o.slowPctTotal,y=e=>{const t=document.createElement("div");return t.textContent=e,t.style.cssText="font-size:10px;color:#90a4ae;font-style:italic;",t},x=xl.turtleEnableButtons;0===x.length&&(xl.turtleEnableButtons=x);for(const K of x)K&&(e.enabled?(K.textContent="Enabled",K.style.background="rgba(56, 142, 60, 0.28)",K.style.borderColor="rgba(56, 142, 60, 0.55)",K.style.color="#e8f5e9"):(K.textContent="Disabled",K.style.background="rgba(158, 158, 158, 0.22)",K.style.borderColor="rgba(158, 158, 158, 0.35)",K.style.color="#eceff1"));for(const K of xl.turtleBoardwalkToggles)K&&(K.checked=e.includeBoardwalk);for(const K of xl.turtleFocusSelects)K&&K.value!==e.focus&&(K.value=e.focus);for(const K of xl.turtleEggFocusSelects)K&&K.value!==e.eggFocus&&(K.value=e.eggFocus);const w=e.focusTargetKey,v=e.plantTargets??[],C="specific"===e.focus,T=v.length>0;xl.turtleFocusTargetSelects.forEach((t,n)=>{if(!t)return;const o=xl.turtleFocusTargetContainers[n];o&&(o.style.display=C?"inline-flex":"none");const r=Array.from(t.options).map(e=>e.value),a=v.map(e=>e.key);if(r.length!==a.length+1||r.slice(1).some((e,t)=>e!==a[t])){t.textContent="";const e=document.createElement("option");e.value="",e.textContent=v.length?"Pick a plant...":"No plants detected yet",e.disabled=v.length>0,e.hidden=v.length>0,t.appendChild(e);for(const n of v){const e=document.createElement("option");e.value=n.key;const o=n.species??"Unknown plant",r=null!=n.remainingMs?Gl(n.remainingMs):"Ready",a=n.boardwalk?" (boardwalk)":"";e.textContent=`${o} - ${r}${a}`,t.appendChild(e)}}const i=C&&e.focusTargetAvailable&&w?w:"";t.value!==i&&(t.value=i),t.disabled=!C||0===v.length});const S=e.eggFocusTargetKey,k=e.eggTargets??[],A="specific"===e.eggFocus,P=k.length>0;xl.turtleEggFocusTargetSelects.forEach((t,n)=>{if(!t)return;const o=xl.turtleEggFocusTargetContainers[n];o&&(o.style.display=A?"inline-flex":"none");const r=Array.from(t.options).map(e=>e.value),a=k.map(e=>e.key);if(r.length!==a.length+1||r.slice(1).some((e,t)=>e!==a[t])){t.textContent="";const e=document.createElement("option");e.value="",e.textContent=k.length?"Pick an egg...":"No eggs detected yet",e.disabled=k.length>0,e.hidden=k.length>0,t.appendChild(e);for(const n of k){const e=document.createElement("option");e.value=n.key;const o=n.species??"Unknown egg",r=null!=n.remainingMs?Gl(n.remainingMs):"Ready",a=n.boardwalk?" (boardwalk)":"";e.textContent=`${o} - ${r}${a}`,t.appendChild(e)}}const i=A&&e.eggFocusTargetAvailable&&S?S:"";t.value!==i&&(t.value=i),t.disabled=!A||0===k.length});const M=[];e.hungerFilteredCount>0&&M.push(`${e.hungerFilteredCount} need feeding`),e.turtlesMissingStats>0&&M.push(`${e.turtlesMissingStats} missing stats`),e.includeBoardwalk;const E=xl.turtleStatus,$=xl.turtleDetail,F=xl.turtleFooter,I=(e,t,n,o=!1)=>{E&&(E.textContent=e),$&&(o?$.innerHTML=t:$.textContent=t),F&&(F.textContent=n)},q=xl.turtlePlantNameText;if(e.enabled)if("no-data"===t.status)q&&(q.textContent="Waiting..."),I("Waiting for garden data‚Ä¶","Move camera or interact with garden","");else if("no-crops"===t.status)q&&(q.textContent="No Crops"),I("No crops growing","Plant seeds to start tracking","");else if("no-turtles"===t.status){const e=t.focusSlot?.species||"Crop";q&&(q.textContent=e);I(`${e} ‚Ä¢ ${t.naturalMsRemaining?Gl(t.naturalMsRemaining):"‚Äî"}`,`No plant boost ‚Ä¢ ${`${t.growingSlots}/${t.trackedSlots} crops`}`,"")}else if("estimating"===t.status){const e=t.focusSlot?.species||"Crop";q&&(q.textContent=e);const r=Gl(t.adjustedMsRemaining),a=rc(t.adjustedMsRemaining),i=Wl(t.effectiveRate),s=ac(t),l=null!=s.unluckyMs?Gl(s.unluckyMs):"",c=[];if(t.contributions.length>0&&c.push(`üå± ${i} plant`),n.contributions.length>0&&"estimating"===n.status&&null!=n.effectiveRate){const e=Wl(n.effectiveRate);c.push(`ü•ö ${e} egg`)}else n.contributions.length>0&&c.push(`ü•ö ${n.contributions.length} egg`);const d=o.restoreCount+o.slowCount;d>0&&c.push(`üçΩÔ∏è ${d} food`);let u=`${c.length>0?c.join(" ‚Ä¢ "):"No turtles"} ‚Ä¢ ${`${t.growingSlots}/${t.trackedSlots} crops`}`;l&&(u+=` ‚Ä¢ <span style="color:#ff5252;font-size:9px;">(${l})</span>`),I(`${e} ‚Ä¢ ${r}${a}`,u,"",!0)}else q&&(q.textContent="Idle"),I("Turtle timer idle","","");else q&&(q.textContent="Timer Disabled"),I("Timer disabled","Enable to track crops and eggs","");const N=xl.turtlePlantSummary;if(N)if(e.enabled)if("no-data"===t.status)N.textContent=C&&!e.focusTargetAvailable&&T?"Select a target plant with Focus to start tracking.":"Waiting for garden snapshot‚Ä¶";else if("no-crops"===t.status)N.textContent="No growing crops.";else{const e=t.focusSlot?.species||"Unknown crop",n=t.contributions.length;N.textContent=`${e} ‚Ä¢ ${n} plant booster${1===n?"":"s"}`}else N.textContent="Timer disabled";const z=xl.turtlePlantEta;if(z)if(e.enabled)if("estimating"===t.status){const e=rc(t.adjustedMsRemaining);z.textContent=`${Gl(t.adjustedMsRemaining)} (${Wl(t.effectiveRate)})${e}`}else if("no-turtles"===t.status)if(null!=t.naturalMsRemaining){const e=rc(t.naturalMsRemaining);z.textContent=`${Gl(t.naturalMsRemaining)} (no turtle boost)${e}`}else z.textContent="‚Äî";else z.textContent="‚Äî";else z.textContent="‚Äî";const R=xl.turtlePlantTotals;if(R)if(e.enabled)if(C&&!e.focusTargetAvailable)R.textContent=T?"Total Growth Boost will appear once a target plant is selected.":"Waiting for a fresh garden snapshot...";else if("no-data"===t.status)R.textContent="Waiting for a fresh garden snapshot...";else if("no-crops"===t.status)R.textContent="No growing crops yet - plant something to see totals.";else if("no-turtles"===t.status){const e=null!=a?Ul(a):"‚Äî";R.textContent=`No growth turtles boosting yet. Normal ETA: ${e}. Feed or assign turtles to cut this down.`}else R.textContent=`Total Growth Boost: ${Jl(r)} ‚Ä¢ Normal ETA: ${null!=a?Ul(a):"‚Äî"} ‚Ä¢ Estimated Time Cut: ${null!=i?Ul(i):"‚Äî"}`;else R.textContent="Totals paused while the temple is disabled.";const L=xl.turtlePlantSimple;if(L)if(e.enabled)if(C&&!e.focusTargetAvailable)L.textContent=T?"Pick a target plant with Focus to show its Normal ETA and estimated cut.":"Waiting for an active garden snapshot - move the camera or harvest to refresh.";else if("no-data"===t.status)L.textContent="Waiting for an active garden snapshot - move the camera or harvest to refresh.";else if("no-crops"===t.status)L.textContent="No crops are growing. Plant seeds to start the turtle timer.";else if("no-turtles"===t.status){const e=null!=a?Ul(a):"‚Äî";L.textContent=`Focused crop matures in ${Gl(t.naturalMsRemaining)} (no turtle boost active). Normal ETA: ${e}.`}else{const e=null!=a?Ul(a):"‚Äî",n=null!=i?Ul(i):"‚Äî";L.textContent=`Focused crop matures in ${Gl(t.adjustedMsRemaining)} (Normal ETA: ${e}); Estimated Time Cut: ${n}.`}else L.textContent="Enable Bella's temple to project crop finish times with turtle boosts.";const D=xl.turtlePlantLuck;if(D)if(e.enabled&&"estimating"===t.status){const e=null!=s.luckyMs?Gl(s.luckyMs):"‚Äî",t=null!=s.unluckyMs?Gl(s.unluckyMs):"‚Äî",n=null!=s.stdMinutes?Ul(s.stdMinutes):"‚Äî";D.textContent=`Lucky ‚âà ${e} ‚Ä¢ Unlucky ‚âà ${t} (¬±${n})`}else D.textContent="";const B=xl.turtleEggSummary;B&&(e.enabled?"no-data"===n.status?B.textContent=A&&!e.eggFocusTargetAvailable&&P?"Select a target egg with Egg focus to track hatching.":"Waiting for garden snapshot‚Ä¶":"no-eggs"===n.status?B.textContent="No eggs incubating.":B.textContent=`${n.growingSlots}/${n.trackedSlots} growing eggs ‚Ä¢ ${n.contributions.length} booster${1===n.contributions.length?"":"s"}`:B.textContent="Timer disabled");const H=xl.turtleEggEta;if(H)if(e.enabled)if("estimating"===n.status){const e=rc(n.adjustedMsRemaining);H.textContent=`${Gl(n.adjustedMsRemaining)} (${Wl(n.effectiveRate)})${e}`}else if("no-turtles"===n.status)if(null!=n.naturalMsRemaining){const e=rc(n.naturalMsRemaining);H.textContent=`${Gl(n.naturalMsRemaining)} (no turtle boost)${e}`}else H.textContent="‚Äî";else H.textContent="‚Äî";else H.textContent="‚Äî";const j=xl.turtleEggTotals;if(j)if(e.enabled)if(A&&!e.eggFocusTargetAvailable)j.textContent=P?"Total Hatch Boost will appear once a target egg is selected.":"Waiting for a fresh egg snapshot...";else if("no-eggs"===n.status)j.textContent="No incubating eggs detected yet ‚Äì hatchery estimates will appear here.";else if("no-turtles"===n.status){const e=null!=c?Ul(c):"‚Äî";j.textContent=`No hatch turtles boosting yet. Normal ETA: ${e}. Assign turtles to speed this up.`}else"estimating"===n.status?j.textContent=`Total Growth Boost: ${Jl(l)} ‚Ä¢ Normal ETA: ${null!=c?Ul(c):"‚Äî"} ‚Ä¢ Estimated Time Cut: ${null!=d?Ul(d):"‚Äî"}`:j.textContent="Waiting for an egg snapshot‚Ä¶";else j.textContent="Totals paused while the temple is disabled.";const G=xl.turtleEggSimple;if(G)if(e.enabled)if("no-eggs"===n.status)G.textContent="No eggs on the boardwalk or garden right now. Drop an egg to start tracking.";else if(A&&!e.eggFocusTargetAvailable)G.textContent=P?"Pick a target egg with Egg focus to show its hatch ETA and boost cut.":"Waiting on egg snapshots ‚Äì try moving the camera or drop an egg to refresh.";else if("no-data"===n.status)G.textContent="Waiting on egg snapshots ‚Äì try moving the camera or interacting with the garden.";else if("no-turtles"===n.status){const e=null!=c?Ul(c):"‚Äî";G.textContent=`Focused egg hatches in ${Gl(n.naturalMsRemaining)} (no turtle boost active). Normal ETA: ${e}.`}else if("estimating"===n.status){const e=null!=c?Ul(c):"‚Äî",t=null!=d?Ul(d):"‚Äî";G.textContent=`Focused egg hatches in ${Gl(n.adjustedMsRemaining)} (Normal ETA: ${e}); Estimated Time Cut: ${t}.`}else G.textContent="";else G.textContent="Enable the temple to see egg hatching boosts too.";const W=xl.turtleEggLuck;if(W)if(e.enabled)if("estimating"===n.status){const e=null!=u.luckyMs?Gl(u.luckyMs):"‚Äî",t=null!=u.unluckyMs?Gl(u.unluckyMs):"‚Äî",n=null!=u.stdMinutes?Ul(u.stdMinutes):"‚Äî";W.textContent=`Lucky ‚âà ${e} ‚Ä¢ Unlucky ‚âà ${t} (¬±${n})`}else"no-turtles"===n.status?W.textContent="No turtle boosts active for eggs right now.":W.textContent="";else W.textContent="";const O=xl.turtleSupportSummary,_=xl.turtleSupportTotals,V=xl.turtleSupportSimple,U=xl.turtleSupportList;if(O&&(e.enabled?0===o.entries.length?O.textContent="No food turtles detected ‚Äì add Hunger Restore or Hunger Boost companions.":O.textContent=`Restore turtles active ${o.restoreActiveCount}/${o.restoreCount} ‚Ä¢ Slow drain turtles active ${o.slowActiveCount}/${o.slowCount}`:O.textContent="Food buffs paused while the temple is disabled."),_)if(e.enabled&&0!==o.entries.length){const e=m>0?Vl(m,1):"0.0 feeds/hr",t=f>0?Vl(f,1):"0.0 feeds/hr",n=o.restoreCount>0?`Restore: ~${e} (max ${t})`:"Restore: none yet",r=o.slowCount>0?`Slow drain: ${_l(h,0)} active (${_l(b,0)} possible)`:"Slow drain: none yet";_.textContent=`${n} ‚Ä¢ ${r}`}else _.textContent="";if(V)if(e.enabled)if(0===o.entries.length)V.textContent="Assign turtles with Hunger Restore (refills) or Hunger Boost (slow drain) abilities to see food support stats.";else{const e=o.restoreCount>0,t=p>0&&o.restoreActiveCount>0,n=o.slowActiveCount>0&&h>0;if(t&&g>0){const e=m/100;V.textContent=`Restore turtles are covering ~${e.toFixed(1)} feeds/hr and slow drain buffs are cutting hunger by ${_l(h,0)} while they stay fed.`}else e&&0===o.restoreActiveCount?V.textContent="Your restore turtles need food before their hourly refills kick back in.":V.textContent=n?`Slow drain buffs are active, trimming hunger by ${_l(h,0)} as long as the turtles stay full.`:e?"Restore turtles are present but idle‚Äîfeed them to start the hourly refills.":"Add food turtles with Hunger Restore or Hunger Boost abilities to see refills and slowdown buffs here."}else V.textContent="Enable the turtle temple and keep turtles fed to maintain hunger buffs.";if(U)if(U.textContent="",e.enabled)if(0===o.entries.length)U.appendChild(y("No food turtles detected."));else{for(const t of o.entries){const e=document.createElement("div");e.style.cssText="display:flex;flex-direction:column;gap:3px;padding:4px 0;border-bottom:1px solid rgba(255,255,255,0.05);font-size:10px;";const n=document.createElement("div");n.style.cssText="display:flex;justify-content:space-between;align-items:center;gap:12px;color:#ffe9a6;";const o=document.createElement("span");o.textContent=`${t.name??"Unknown"} ‚Ä¢ ${t.abilityNames.join(", ")}`;const r=document.createElement("span");r.textContent=t.active?"Active":"Needs feed",r.style.cssText=`padding:1px 6px;border-radius:12px;font-size:9px;background:${t.active?"rgba(129,199,132,0.25)":"rgba(255,138,128,0.25)"};color:${t.active?"#c8e6c9":"#ffab91"};`,n.append(o,r);const a=document.createElement("div");a.style.cssText="display:flex;flex-direction:column;gap:2px;color:#ffecb3;";const i=t.totalRestorePerHourPct>0?t.totalRestorePerHourPct/100:0;if(t.totalRestorePerHourPct>0){const e=document.createElement("div");e.textContent=`Restore: ${i.toFixed(1)} feeds/hr (${_l(t.totalRestorePerTriggerPct,0)} per proc, ~${t.totalTriggersPerHour.toFixed(1)} procs/hr)`,a.appendChild(e)}if(t.totalSlowPct>0){const e=document.createElement("div");e.textContent=`Slow drain: ${_l(t.totalSlowPct,0)} less hunger/hr while active`,a.appendChild(e)}if(i>0||t.totalSlowPct>0){const e=document.createElement("div");i>0&&t.totalSlowPct>0?e.textContent=`Auto-feed relief: ~${i.toFixed(1)} fewer feeds/hr and pets eat ~${_l(t.totalSlowPct,0)} less often.`:e.textContent=i>0?`Auto-feed relief: ~${i.toFixed(1)} fewer feeds/hr thanks to this turtle.`:`Auto-feed relief: pets eat ~${_l(t.totalSlowPct,0)} less often.`,a.appendChild(e)}if(!a.hasChildNodes()){const e=document.createElement("div");e.textContent="No active food effects yet.",a.appendChild(e)}const s=document.createElement("div");s.style.cssText="font-size:9px;color:#ffdd99;display:flex;flex-wrap:wrap;gap:8px;";const l=`Hunger ${Ol(t.hungerPct)}`,c=`Score ${Math.round(t.baseScore)}`,d=document.createElement("span");d.textContent="xp: ";const u=Xl({species:t.species,slotIndex:t.slotIndex},"xp",t.xp,e=>null!=e?`${Math.round(e/1e3)}k`:"?"),p=document.createElement("span");p.textContent=" ‚Ä¢ Scale: ";const m=Xl({species:t.species,slotIndex:t.slotIndex},"targetScale",t.targetScale,e=>null!=e&&Number.isFinite(e)?`${e.toFixed(2)}√ó`:"?");s.textContent=`${l} ‚Ä¢ ${c} ‚Ä¢ `,s.appendChild(d),s.appendChild(u),s.appendChild(p),s.appendChild(m),e.append(n,a,s),U.appendChild(e)}const e=U.querySelectorAll(":scope > div");e.length>0&&(e[e.length-1].style.borderBottom="none")}else U.appendChild(y("Timer disabled."));const X=xl.turtlePlantTable;if(X)if(X.textContent="",e.enabled)if(0===t.contributions.length)X.appendChild(y("No growth turtles contributing yet."));else for(const K of t.contributions){const t=document.createElement("div");t.style.cssText="display:grid;grid-template-columns:1.4fr 0.7fr 0.6fr 0.8fr;gap:6px;font-size:10px;padding:2px 0;";const n=document.createElement("div");n.textContent=K.name??`Slot ${K.slotIndex+1}`,n.style.color=K.missingStats?"#ffcc80":"#e0f2f1";const o=document.createElement("div");o.textContent=Ol(K.hungerPct),o.style.color=null!=K.hungerPct&&K.hungerPct<e.minActiveHungerPct?"#ff8a80":"#b2dfdb";const r=document.createElement("div");r.textContent=`${K.perHourReduction.toFixed(1)} min/hr`,r.style.color="#aed581";const a=document.createElement("div");a.style.color=K.missingStats?"#ffcc80":"#c5cae9";const i=Xl({species:K.species,slotIndex:K.slotIndex},"xp",K.xp,e=>null!=e?`${Math.round(e/1e3)}k xp`:"‚Äî");a.appendChild(i),t.append(n,o,r,a),X.appendChild(t)}else X.appendChild(y("Timer disabled."));const J=xl.turtleEggTable;if(J)if(J.textContent="",e.enabled)if(0===n.contributions.length)J.appendChild(y("No egg boosters contributing yet."));else for(const K of n.contributions){const t=document.createElement("div");t.style.cssText="display:grid;grid-template-columns:1.4fr 0.7fr 0.6fr 0.8fr;gap:6px;font-size:10px;padding:2px 0;";const n=document.createElement("div");n.textContent=K.name??`Slot ${K.slotIndex+1}`,n.style.color=K.missingStats?"#ffcc80":"#e0f2f1";const o=document.createElement("div");o.textContent=Ol(K.hungerPct),o.style.color=null!=K.hungerPct&&K.hungerPct<e.minActiveHungerPct?"#ff8a80":"#b2dfdb";const r=document.createElement("div");r.textContent=`${K.perHourReduction.toFixed(1)} min/hr`,r.style.color="#aed581";const a=document.createElement("div");a.style.color=K.missingStats?"#ffcc80":"#c5cae9";const i=Xl({species:K.species,slotIndex:K.slotIndex},"xp",K.xp,e=>null!=e?`${Math.round(e/1e3)}k xp`:"‚Äî");a.appendChild(i),t.append(n,o,r,a),J.appendChild(t)}else J.appendChild(y("Timer disabled."))}let sc=!1;function lc(e,t={}){const n=document.createElement("div");n.className="qpm-card",n.style.display="flex",n.style.flexDirection="column",n.style.gap="10px";const o=document.createElement("div");o.className="qpm-card__header",t.collapsible&&(o.style.cursor="pointer");const r=document.createElement("div");r.className="qpm-card__title",r.textContent=e,o.appendChild(r);const a=[];let i=null;t.subtitleElement?(i=t.subtitleElement,a.push(i)):t.subtitle&&(i=document.createElement("span"),i.className="qpm-section-muted",i.textContent=t.subtitle,a.push(i)),Array.isArray(t.headerActions)&&t.headerActions.length>0&&a.push(...t.headerActions);let s=null;if(t.collapsible&&(s=document.createElement("span"),s.className="qpm-section-muted",s.textContent=t.startCollapsed?"‚ñ≤":"‚ñº",a.push(s)),a.length>0){const e=document.createElement("div");e.className="qpm-row",e.style.justifyContent="flex-end",e.style.gap="6px",e.style.flexWrap="nowrap";for(const t of a)e.appendChild(t);o.appendChild(e)}n.appendChild(o);const l=document.createElement("div");if(l.style.display=t.startCollapsed?"none":"flex",l.style.flexDirection="column",l.style.gap="10px",n.appendChild(l),t.collapsible){let e=!!t.startCollapsed;const n=t=>{e=t,l.style.display=e?"none":"flex",s&&(s.textContent=e?"‚ñ≤":"‚ñº")};n(e),o.addEventListener("click",()=>{n(!e)})}return{root:n,header:o,body:l,indicator:s,subtitleEl:i}}let cc={};function dc(){const{root:e,body:t}=lc("üíé Mutation Value & Reminders",{subtitle:"Gold/Rainbow generation and mutation alerts",collapsible:!0});e.dataset.qpmSection="mutation-value";const n=document.createElement("div");n.style.cssText="padding:10px;background:#1a1a2a;border-radius:6px;font-size:11px;line-height:1.5;margin-bottom:12px;",n.innerHTML="\n    <strong>üí∞ Value generation tracking:</strong> Gold/Rainbow proc rates, session value, and best records.\n  ",t.appendChild(n);const o=document.createElement("div");o.style.cssText="margin-bottom:16px;padding:12px;background:#2a1a3a;border-radius:6px;border-left:3px solid #9C27B0;";const r=document.createElement("div");r.style.cssText="font-weight:bold;font-size:12px;margin-bottom:8px;color:#9C27B0;",r.textContent="üß¨ Mutation Reminder",o.appendChild(r);const a=document.createElement("div");a.innerHTML="üí° Detects weather events (Rain/Snow/Dawn/Amber) and notifies which plants to place for mutations.",a.style.cssText="font-size:10px;line-height:1.5;color:#aaa;margin-bottom:8px;",o.appendChild(a);const i=Xc(cc.mutationReminder?.enabled?"‚úì Reminders Enabled":"‚úó Reminders Disabled",async()=>{if(!cc.mutationReminder)return;cc.mutationReminder.enabled=!cc.mutationReminder.enabled,i.textContent=cc.mutationReminder.enabled?"‚úì Reminders Enabled":"‚úó Reminders Disabled",i.classList.toggle("qpm-button--positive",cc.mutationReminder.enabled),i.classList.toggle("qpm-button--accent",cc.mutationReminder.enabled),Jc();const{setMutationReminderEnabled:e}=await Promise.resolve().then(()=>vn);e(cc.mutationReminder.enabled)});i.style.cssText="width:100%;margin-bottom:6px;",cc.mutationReminder?.enabled&&i.classList.add("qpm-button--positive","qpm-button--accent"),o.appendChild(i);const l=Xc("üîç Check Now",async()=>{l.disabled=!0,l.textContent="‚è≥ Checking...";try{const{checkForMutations:e}=await Promise.resolve().then(()=>vn);await e(),l.textContent="‚úÖ Done!",setTimeout(()=>{l.textContent="üîç Check Now",l.disabled=!1},2e3)}catch(e){l.textContent="‚ùå Error",s("Error checking mutations:",e),setTimeout(()=>{l.textContent="üîç Check Now",l.disabled=!1},2e3)}});l.style.cssText="width:100%;background:#9C27B0;",l.title="Manually check for mutation opportunities",o.appendChild(l),t.appendChild(o);const c=document.createElement("button");c.textContent="üîÑ Reset Session Stats",c.style.cssText="width:100%;padding:8px;background:#2a1a1a;color:#FF6B6B;border:1px solid #FF6B6B;border-radius:4px;cursor:pointer;font-size:11px;font-weight:bold;margin-bottom:12px;transition:all 0.2s;",c.onmouseenter=()=>{c.style.background="#3a2020",c.style.borderColor="#FF8888"},c.onmouseleave=()=>{c.style.background="#2a1a1a",c.style.borderColor="#FF6B6B"},c.onclick=()=>{confirm("Reset mutation value tracking? This will start a new session but keep your best records.")&&(Ki(),s("üîÑ Mutation value tracking reset"))},t.appendChild(c);const d=document.createElement("div");d.style.cssText="display:flex;flex-direction:column;gap:12px;",t.appendChild(d);const u=e=>e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString(),p=()=>{const e=Xi(),t=Fi();d.innerHTML="";const n=e.stats,o=t.stats,r=o.wetCount+o.chilledCount+o.frozenCount+o.dawnlitCount+o.dawnboundCount+o.amberlitCount+o.amberboundCount,a=o.wetPerHour+o.chilledPerHour+o.frozenPerHour+o.dawnlitPerHour+o.dawnboundPerHour+o.amberlitPerHour+o.amberboundPerHour,i=document.createElement("div");i.style.cssText="padding:12px;background:linear-gradient(135deg,rgba(255,215,0,0.1),rgba(139,69,19,0.1));border-radius:6px;border-left:3px solid #FFD700;",i.innerHTML=`\n      <div style="font-weight:bold;font-size:12px;margin-bottom:8px;">üí∞ Current Session Value</div>\n      <div style="font-size:20px;font-weight:bold;color:#FFD700;">${u(n.sessionValue)}</div>\n      <div style="font-size:10px;color:#888;margin-top:4px;">Session started ${(e=>{const t=Date.now()-e,n=Math.floor(t/6e4),o=Math.floor(n/60);return o>0?`${o}h ${n%60}m ago`:`${n}m ago`})(n.sessionStart)}</div>\n    `,d.appendChild(i);const s=document.createElement("div");if(s.style.cssText="display:grid;grid-template-columns:1fr 1fr;gap:8px;",s.innerHTML=`\n      <div style="padding:10px;background:#1a1a2a;border-radius:6px;text-align:center;">\n        <div style="font-size:18px;margin-bottom:4px;">üü°</div>\n        <div style="font-size:14px;font-weight:bold;color:#FFD700;">${n.goldProcs}</div>\n        <div style="font-size:9px;color:#888;margin-top:2px;">Gold Procs</div>\n        <div style="font-size:10px;color:#4CAF50;margin-top:4px;">${n.goldPerHour.toFixed(1)}/hr</div>\n      </div>\n      <div style="padding:10px;background:#1a1a2a;border-radius:6px;text-align:center;">\n        <div style="font-size:18px;margin-bottom:4px;">üåà</div>\n        <div style="font-size:14px;font-weight:bold;color:#FFD700;">${n.rainbowProcs}</div>\n        <div style="font-size:9px;color:#888;margin-top:2px;">Rainbow Procs</div>\n        <div style="font-size:10px;color:#4CAF50;margin-top:4px;">${n.rainbowPerHour.toFixed(1)}/hr</div>\n      </div>\n      <div style="padding:10px;background:#1a1a2a;border-radius:6px;text-align:center;">\n        <div style="font-size:18px;margin-bottom:4px;">üìà</div>\n        <div style="font-size:14px;font-weight:bold;color:#FFD700;">${n.cropBoostProcs}</div>\n        <div style="font-size:9px;color:#888;margin-top:2px;">Crop Boosts</div>\n        <div style="font-size:10px;color:#4CAF50;margin-top:4px;">${n.cropBoostPerHour.toFixed(1)}/hr</div>\n      </div>\n      <div style="padding:10px;background:#1a1a2a;border-radius:6px;text-align:center;">\n        <div style="font-size:18px;margin-bottom:4px;">‚òÅÔ∏è</div>\n        <div style="font-size:14px;font-weight:bold;color:#FFD700;">${r}</div>\n        <div style="font-size:9px;color:#888;margin-top:2px;">Weather Procs</div>\n        <div style="font-size:10px;color:#4CAF50;margin-top:4px;">${a.toFixed(1)}/hr</div>\n      </div>\n    `,d.appendChild(s),n.bestSessionValue>0||n.bestHourValue>0){const e=document.createElement("div");e.style.cssText="padding:10px;background:#1a1a2a;border-radius:6px;",e.innerHTML=`\n        <div style="font-weight:bold;font-size:11px;margin-bottom:8px;">üèÜ Best Records</div>\n        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;font-size:10px;">\n          <div><span style="color:#888;">Best Hour:</span> <strong style="color:#FFD700;">${u(n.bestHourValue)}</strong></div>\n          <div><span style="color:#888;">Best Session:</span> <strong style="color:#FFD700;">${u(n.bestSessionValue)}</strong></div>\n        </div>\n      `,d.appendChild(e)}};p();const m=Ji(p),f=Ii(p),g=new MutationObserver(t=>{t.forEach(t=>{t.removedNodes.forEach(t=>{(t===e||t.contains?.(e))&&(m(),f(),g.disconnect())})})});return e.parentElement&&g.observe(e.parentElement,{childList:!0,subtree:!0}),e}function uc(){const{root:e,body:t}=lc("üìä Statistics Overview",{subtitle:"Session performance and value tracking"});e.dataset.qpmSection="stats-overview";const n=e=>e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString(),o=(e,t,n="‚Ä¢")=>{const o=document.createElement("div");return o.style.cssText="display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid #2a2a2a;font-size:11px;",o.innerHTML=`\n      <span style="color:#888;">${n} ${e}</span>\n      <span style="color:#FFD700;font-weight:bold;">${t}</span>\n    `,o},r=(e,t)=>{const n=document.createElement("div");return n.style.cssText="font-weight:bold;font-size:13px;color:#FFD700;margin:16px 0 8px 0;padding-bottom:4px;border-bottom:2px solid #FFD700;",n.textContent=`${t} ${e}`,n},a=new Set(["GoldGranter","RainbowGranter","ProduceScaleBoost","ProduceScaleBoostII","ProduceRefund","DoubleHarvest","SellBoostI","SellBoostII","SellBoostIII","SellBoostIV","CoinFinderI","CoinFinderII","CoinFinderIII","PetRefund","PetRefundII"]),i=()=>{t.innerHTML="";const e=Xi(),l=za(),c=Fi();t.appendChild(r("Current Session","‚è±Ô∏è"));const d=Date.now()-e.stats.sessionStart;t.appendChild(o("Session Duration",(e=>{const t=Math.floor(e/36e5),n=Math.floor(e%36e5/6e4);return t>0?`${t}h ${n}m`:`${n}m`})(d),"‚è±Ô∏è")),t.appendChild(o("Session Value",n(e.stats.sessionValue)+" coins","üí∞"));const u=d>0?Math.round(e.stats.sessionValue/d*36e5):0;if(t.appendChild(o("Value per Hour",n(u)+" coins/hr","üìä")),t.appendChild(r("Mutation Value","üíé")),t.appendChild(o("Gold Procs",e.stats.goldProcs+" ("+e.stats.goldPerHour.toFixed(1)+"/hr)","üü°")),t.appendChild(o("Gold Value",n(e.stats.goldTotalValue)+" coins","üí∞")),t.appendChild(o("Rainbow Procs",e.stats.rainbowProcs+" ("+e.stats.rainbowPerHour.toFixed(1)+"/hr)","üåà")),t.appendChild(o("Rainbow Value",n(e.stats.rainbowTotalValue)+" coins","üí∞")),t.appendChild(o("Crop Boost Procs",e.stats.cropBoostProcs+" ("+e.stats.cropBoostPerHour.toFixed(1)+"/hr)","üìà")),t.appendChild(o("Boost Value",n(e.stats.cropBoostTotalValue)+" coins","üí∞")),t.appendChild(r("Personal Records","üèÜ")),e.stats.bestHourValue>0&&(t.appendChild(o("Best Hour",n(e.stats.bestHourValue)+" coins","‚≠ê")),e.stats.bestHourTime)){const n=new Date(e.stats.bestHourTime);t.appendChild(o("Best Hour Date",n.toLocaleDateString(),"üìÖ"))}if(e.stats.bestSessionValue>0&&(t.appendChild(o("Best Session",n(e.stats.bestSessionValue)+" coins","üåü")),e.stats.bestSessionTime)){const n=new Date(e.stats.bestSessionTime);t.appendChild(o("Best Session Date",n.toLocaleDateString(),"üìÖ"))}if(0===e.stats.bestHourValue&&0===e.stats.bestSessionValue){const e=document.createElement("div");e.style.cssText="padding:8px;background:rgba(139,195,74,0.1);border-radius:4px;font-size:10px;color:#8BC34A;margin-top:4px;",e.innerHTML="‚ÑπÔ∏è Personal records will be tracked as you play.",t.appendChild(e)}const p=c.stats.wetCount+c.stats.chilledCount+c.stats.frozenCount+c.stats.dawnlitCount+c.stats.dawnboundCount+c.stats.amberlitCount+c.stats.amberboundCount,m=c.stats.wetPerHour+c.stats.chilledPerHour+c.stats.frozenPerHour+c.stats.dawnlitPerHour+c.stats.dawnboundPerHour+c.stats.amberlitPerHour+c.stats.amberboundPerHour,f=c.stats.wetTotalValue+c.stats.chilledTotalValue+c.stats.frozenTotalValue+c.stats.dawnlitTotalValue+c.stats.dawnboundTotalValue+c.stats.amberlitTotalValue+c.stats.amberboundTotalValue;p>0&&(t.appendChild(r("Weather Mutations","üå§Ô∏è")),t.appendChild(o("Total Weather Procs",n(p),"üå§Ô∏è")),t.appendChild(o("Procs per Hour",m.toFixed(1),"‚ö°")),t.appendChild(o("Total Value",n(f)+" coins","üí∞"))),t.appendChild(r("Top Abilities by Value","‚ö°"));const g=Object.entries(l.abilities.valueByAbility).filter(([e])=>a.has(e)).sort(([,e],[,t])=>t-e).slice(0,5);if(g.length>0)g.forEach(([e,r])=>{const a=Wa(e),i=a?.name||e,s=l.abilities.procsByAbility[e]||0,c=i+" ("+String(s)+"x)",d=n(r)+" coins";t.appendChild(o(c,d,"‚ñ∏"))});else{const e=document.createElement("div");e.style.cssText="padding:8px;background:rgba(139,195,74,0.1);border-radius:4px;font-size:10px;color:#8BC34A;margin-top:4px;",e.innerHTML="‚ÑπÔ∏è Ability stats will appear as your pets proc abilities.",t.appendChild(e)}if(e.sessions&&e.sessions.length>0){t.appendChild(r("Session History","üìà"));const a=e.sessions.slice(-7),i=a.reduce((e,t)=>e+t.value,0)/a.length;t.appendChild(o("Sessions Logged",e.sessions.length.toString(),"üìù"));const s=n(Math.round(i))+" coins/session";if(t.appendChild(o("Last 7 Days Avg",s,"üìä")),a.length>=2){const e=a.slice(-3).reduce((e,t)=>e+t.value,0)/Math.min(3,a.length),n=a.slice(0,-3).reduce((e,t)=>e+t.value,0)/Math.max(1,a.length-3),r=e>n?"üìà Improving":e<n?"üìâ Declining":"‚û°Ô∏è Stable";t.appendChild(o("Trend",r,"üìâ"))}}if(l.garden.totalHarvested>0){t.appendChild(r("Garden Insights","üå±")),t.appendChild(o("Total Harvested",n(l.garden.totalHarvested),"üåæ"));const e=d>0?Math.round(l.garden.totalHarvested/d*36e5):0;t.appendChild(o("Harvest Rate",e+"/hr","‚ö°")),l.garden.totalWateringCans>0&&t.appendChild(o("Watering Cans Used",n(l.garden.totalWateringCans),"üíß"))}const h=Xc("üóëÔ∏è Reset All Stats",async()=>{if(confirm("‚ö†Ô∏è This will reset ALL statistics including:\n\n‚Ä¢ Session value tracking\n‚Ä¢ Mutation records\n‚Ä¢ Ability performance\n‚Ä¢ Garden metrics\n\nThis action cannot be undone. Continue?")){h.disabled=!0,h.textContent="‚è≥ Resetting...";try{const{resetPetHatchingTracker:e}=await Promise.resolve().then(()=>_d);Ra(),e(),Ki(),h.textContent="‚úÖ Reset Complete!",setTimeout(()=>{h.textContent="üóëÔ∏è Reset All Stats",h.disabled=!1,i()},2e3)}catch(e){s("Error resetting stats:",e),h.textContent="‚ùå Error",setTimeout(()=>{h.textContent="üóëÔ∏è Reset All Stats",h.disabled=!1},2e3)}}});h.style.cssText="width:100%;margin-top:16px;background:#d32f2f;",h.title="Reset all QPM statistics",t.appendChild(h)};i();const l=Na(()=>i()),c=Ji(()=>i()),d=Ii(()=>i()),u=new MutationObserver(()=>{document.contains(e)||(l(),c(),d(),u.disconnect())});return e.parentElement&&u.observe(e.parentElement,{childList:!0,subtree:!0}),e}function pc(){const{root:e,body:t}=lc("‚≠ê Auto-Favorite",{subtitle:"Automatically favorite crops and pets"});e.dataset.qpmSection="auto-favorite";const n=Ts(),o=document.createElement("label");o.style.cssText="\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 12px;\n    background: var(--qpm-surface-1, #1a1a1a);\n    border-radius: 8px;\n    cursor: pointer;\n    margin-bottom: 16px;\n  ";const r=document.createElement("input");r.type="checkbox",r.checked=n.enabled,r.style.cssText="\n    width: 20px;\n    height: 20px;\n    cursor: pointer;\n  ";const a=document.createElement("span");a.textContent="Enable Auto-Favorite",a.style.cssText="\n    font-weight: 600;\n    font-size: 14px;\n    color: var(--qpm-text, #fff);\n  ",r.addEventListener("change",()=>{Ss({enabled:r.checked})}),o.appendChild(r),o.appendChild(a),t.appendChild(o);const i=document.createElement("div");i.style.cssText="\n    padding: 12px;\n    background: rgba(76, 175, 80, 0.1);\n    border-left: 3px solid var(--qpm-accent, #4CAF50);\n    border-radius: 4px;\n    margin-bottom: 16px;\n    font-size: 12px;\n    line-height: 1.6;\n    color: var(--qpm-text-muted, #aaa);\n  ",i.innerHTML="\n    üí° <strong>How it works:</strong><br>\n    ‚Ä¢ Monitors inventory in background (no need to open inventory)<br>\n    ‚Ä¢ Automatically favorites matching items when detected<br>\n    ‚Ä¢ Never unfavorites items (safe for manual favorites)<br>\n    ‚Ä¢ Works via WebSocket (instant, no lag)\n  ",t.appendChild(i);const s=document.createElement("div");s.style.cssText="\n    margin-bottom: 16px;\n  ";const l=document.createElement("h4");l.textContent="üêæ Pet Abilities",l.style.cssText="\n    margin: 0 0 8px 0;\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--qpm-accent, #4CAF50);\n  ",s.appendChild(l);[{id:"Gold Granter",label:"Gold Granter"},{id:"Rainbow Granter",label:"Rainbow Granter"}].forEach(e=>{const t=document.createElement("label");t.style.cssText="\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      padding: 8px;\n      cursor: pointer;\n      border-radius: 4px;\n      transition: background 0.2s;\n    ",t.addEventListener("mouseenter",()=>{t.style.background="rgba(255, 255, 255, 0.05)"}),t.addEventListener("mouseleave",()=>{t.style.background="transparent"});const o=document.createElement("input");o.type="checkbox",o.checked=n.petAbilities?.includes(e.id)??!1,o.style.cssText="width: 16px; height: 16px; cursor: pointer;",o.addEventListener("change",()=>{const t=Ts().petAbilities||[];Ss({petAbilities:o.checked?[...t,e.id]:t.filter(t=>t!==e.id)}),o.checked&&window.qpm_favoritePetAbility?.(e.id)});const r=document.createElement("span");r.textContent=e.label,r.style.cssText="font-size: 13px; color: var(--qpm-text, #fff);",t.appendChild(o),t.appendChild(r),s.appendChild(t)}),t.appendChild(s);const c=document.createElement("div");c.style.cssText="\n    margin-bottom: 16px;\n  ";const d=document.createElement("h4");d.textContent="‚ú® Crop Mutations",d.style.cssText="\n    margin: 0 0 8px 0;\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--qpm-accent, #4CAF50);\n  ",c.appendChild(d);var u;return[{id:"Rainbow",label:"Rainbow",color:"#9C27B0"},{id:"Gold",label:"Golden",color:"#FFD700"},{id:"Frozen",label:"Frozen",color:"#2196F3"},{id:"Wet",label:"Wet",color:"#03A9F4"},{id:"Chilled",label:"Chilled",color:"#00BCD4"},{id:"Dawnlit",label:"Dawnlit",color:"#FF9800"},{id:"Dawnbound",label:"Dawnbound",color:"#FF5722"},{id:"Amberlit",label:"Amberlit",color:"#FFC107"},{id:"Amberbound",label:"Amberbound",color:"#FF6F00"}].forEach(e=>{const t=document.createElement("label");t.style.cssText="\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      padding: 8px;\n      cursor: pointer;\n      border-radius: 4px;\n      transition: background 0.2s;\n    ",t.addEventListener("mouseenter",()=>{t.style.background="rgba(255, 255, 255, 0.05)"}),t.addEventListener("mouseleave",()=>{t.style.background="transparent"});const o=document.createElement("input");o.type="checkbox",o.checked=n.mutations.includes(e.id),o.style.cssText="width: 16px; height: 16px; cursor: pointer;",o.addEventListener("change",()=>{const t=Ts().mutations;Ss({mutations:o.checked?[...t,e.id]:t.filter(t=>t!==e.id)}),o.checked&&window.qpm_favoriteMutation?.(e.id)});const r=document.createElement("span");r.style.cssText=`\n      width: 12px;\n      height: 12px;\n      border-radius: 50%;\n      background: ${e.color};\n      flex-shrink: 0;\n    `;const a=document.createElement("span");a.textContent=e.label,a.style.cssText="font-size: 13px; color: var(--qpm-text, #fff);",t.appendChild(o),t.appendChild(r),t.appendChild(a),c.appendChild(t)}),t.appendChild(c),u=e=>{r.checked=e.enabled},cs.add(u),u({...ls}),e}function mc(){return function(){const e=document.createElement("div");e.dataset.qpmSection="journal-checker",e.style.cssText="\n    background: rgba(0, 0, 0, 0.85);\n    border-radius: 8px;\n    padding: 16px;\n    color: #fff;\n  ";const t=document.createElement("div");t.style.cssText="\n    margin-bottom: 20px;\n    border-bottom: 2px solid #333;\n    padding-bottom: 12px;\n  ",t.innerHTML='\n    <div style="display: flex; align-items: center; justify-content: space-between;">\n      <div>\n        <div style="font-size: 18px; font-weight: bold; color: #fff; margin-bottom: 4px;">\n          üìî Journal Checker\n        </div>\n        <div style="font-size: 12px; color: #aaa;">\n          Track your collection progress across all categories\n        </div>\n      </div>\n    </div>\n  ',e.appendChild(t);const n=document.createElement("div");n.style.cssText="\n    display: grid;\n    grid-template-columns: repeat(2, 1fr);\n    gap: 12px;\n    margin-bottom: 24px;\n  ";const o=(e,t,n,o,r)=>{const a=document.createElement("div");a.style.cssText=`\n      background: linear-gradient(135deg, ${r});\n      border-radius: 12px;\n      padding: 18px;\n      text-align: center;\n      border: 2px solid ${o}22;\n      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n      cursor: pointer;\n      position: relative;\n      overflow: hidden;\n    `;const i=document.createElement("div");return i.style.cssText="position: relative; z-index: 1;",i.innerHTML=`\n      <div style="font-size: 32px; margin-bottom: 8px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));">${e}</div>\n      <div class="stat-value" style="color: ${o}; font-size: 26px; font-weight: bold; margin-bottom: 6px; font-family: 'Segoe UI', Arial, sans-serif; text-shadow: 0 2px 8px rgba(0,0,0,0.4);">${n}</div>\n      <div style="color: #bbb; font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px;">${t}</div>\n    `,a.appendChild(i),a.addEventListener("mouseenter",()=>{a.style.transform="translateY(-4px)",a.style.borderColor=`${o}55`,a.style.boxShadow=`0 8px 16px ${o}22`}),a.addEventListener("mouseleave",()=>{a.style.transform="translateY(0)",a.style.borderColor=`${o}22`,a.style.boxShadow="none"}),a},r=o("üåæ","Produce","...","#8BC34A","#1e2a1e, #1a1a1a"),a=o("üêæ","Pet Variants","...","#42A5F5","#1a212a, #1a1a1a"),i=o("‚ú®","Overall","...","#9C27B0","#241a2a, #1a1a1a");n.appendChild(r),n.appendChild(a),n.appendChild(i),e.appendChild(n);const s=document.createElement("div");s.style.cssText="\n    display: flex;\n    gap: 10px;\n    margin-bottom: 20px;\n    flex-wrap: wrap;\n  ";const l=[{key:"produce",label:"Produce",icon:"üåæ",color:"#8BC34A"},{key:"pets",label:"Pets",icon:"üêæ",color:"#42A5F5"},{key:"recommendations",label:"Smart Tips",icon:"üí°",color:"#9C27B0"},{key:"missing",label:"Missing",icon:"üìã",color:"#FF9800"}];let c="produce",d=!1;const u=async()=>{const e=await Promise.resolve().then(()=>Rd).then(e=>e.getJournalSummary()),t=await Promise.resolve().then(()=>Rd).then(e=>e.getJournalStats());if(!e||!t)return void(p.innerHTML='<div style="color: #999; text-align: center; padding: 40px; font-size: 14px;">‚ö†Ô∏è Unable to load journal data<br><span style="font-size: 12px; color: #666;">Try refreshing or check console for errors</span></div>');const n=(e,t)=>{const n=e.querySelector(".stat-value");n&&(n.textContent=t,n.animate([{transform:"scale(1.2)",opacity:.5},{transform:"scale(1)",opacity:1}],{duration:300,easing:"ease-out"}))};if(n(r,`${t.produce.collected}/${t.produce.total}`),n(a,`${t.petVariants.collected}/${t.petVariants.total}`),n(i,`${Math.round(t.overall.percentage)}%`),p.innerHTML="","produce"===c)for(const o of e.produce){const e=d?o.variants.filter(e=>!e.collected):o.variants;if(0===e.length)continue;const t=o.variants.filter(e=>e.collected).length,n=o.variants.length,r=t/n*100,a=document.createElement("div");100===r?(a.classList.add("qpm-rainbow-complete"),a.style.cssText="\n            border-radius: 10px;\n            padding: 16px;\n            margin-bottom: 10px;\n            border: 1px solid #333;\n            transition: all 0.2s;\n          "):a.style.cssText="\n            background: linear-gradient(135deg, #1f1f1f, #1a1a1a);\n            border-radius: 10px;\n            padding: 16px;\n            margin-bottom: 10px;\n            border: 1px solid #333;\n            transition: all 0.2s;\n          ",a.addEventListener("mouseenter",()=>{100!==r&&(a.style.borderColor="#8BC34A44"),a.style.transform="translateX(4px)"}),a.addEventListener("mouseleave",()=>{100!==r&&(a.style.borderColor="#333"),a.style.transform="translateX(0)"}),a.innerHTML=`\n          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">\n            <div style="display: flex; align-items: center; gap: 8px;">\n              <span style="font-size: 18px;">üåø</span>\n              <strong style="color: #fff; font-size: 14px;">${o.species}</strong>\n            </div>\n            <div style="display: flex; align-items: center; gap: 8px;">\n              <span style="color: #8BC34A; font-size: 13px; font-weight: bold;">${t}/${n}</span>\n              <span style="\n                background: ${100===r?"#8BC34A":"#555"};\n                color: ${100===r?"#000":"#fff"};\n                padding: 2px 8px;\n                border-radius: 12px;\n                font-size: 11px;\n                font-weight: bold;\n              ">${Math.round(r)}%</span>\n            </div>\n          </div>\n          <div style="\n            background: #111;\n            border-radius: 8px;\n            height: 6px;\n            margin-bottom: 12px;\n            overflow: hidden;\n          ">\n            <div style="\n              background: linear-gradient(90deg, #8BC34A, #66BB6A);\n              height: 100%;\n              width: ${r}%;\n              transition: width 0.5s ease;\n              box-shadow: 0 0 10px #8BC34A77;\n            "></div>\n          </div>\n          <div style="display: flex; gap: 8px; flex-wrap: wrap;">\n            ${e.map(e=>{const t={Normal:{bg:e.collected?"#42A5F5":"#333",text:e.collected?"#fff":"#777"},Rainbow:{bg:e.collected?"#9C27B0":"#333",text:e.collected?"#fff":"#777"},Gold:{bg:e.collected?"#FFB300":"#333",text:e.collected?"#fff":"#777"},Frozen:{bg:e.collected?"#00BCD4":"#333",text:e.collected?"#fff":"#777"},Wet:{bg:e.collected?"#2196F3":"#333",text:e.collected?"#fff":"#777"},Chilled:{bg:e.collected?"#03A9F4":"#333",text:e.collected?"#fff":"#777"},Dawnlit:{bg:e.collected?"#FF6F00":"#333",text:e.collected?"#fff":"#777"},Dawnbound:{bg:e.collected?"#FF9800":"#333",text:e.collected?"#fff":"#777"},Amberlit:{bg:e.collected?"#FFA726":"#333",text:e.collected?"#fff":"#777"},Amberbound:{bg:e.collected?"#FFB74D":"#333",text:e.collected?"#fff":"#777"},Max:{bg:e.collected?"#E91E63":"#333",text:e.collected?"#fff":"#777"}}[e.variant]||{bg:e.collected?"#4CAF50":"#333",text:e.collected?"#fff":"#777"};return`\n                <span style="\n                  padding: 6px 12px;\n                  border-radius: 6px;\n                  font-size: 12px;\n                  background: ${t.bg};\n                  color: ${t.text};\n                  font-weight: ${e.collected?"600":"400"};\n                  transition: all 0.2s;\n                  ${e.collected?"box-shadow: 0 2px 4px rgba(0,0,0,0.2);":""}\n                ">${e.collected?"‚úì ":""}${e.variant}</span>\n              `}).join("")}\n          </div>\n        `,p.appendChild(a)}else if("pets"===c)for(const o of e.pets){const e=d?o.variants.filter(e=>!e.collected):o.variants;if(0===e.length)continue;const t=o.variants.filter(e=>e.collected).length,n=o.variants.length,r=t/n*100,a=document.createElement("div");100===r?(a.classList.add("qpm-rainbow-complete"),a.style.cssText="\n            border-radius: 10px;\n            padding: 16px;\n            margin-bottom: 10px;\n            border: 1px solid #333;\n            transition: all 0.2s;\n          "):a.style.cssText="\n            background: linear-gradient(135deg, #1f1f1f, #1a1a1a);\n            border-radius: 10px;\n            padding: 16px;\n            margin-bottom: 10px;\n            border: 1px solid #333;\n            transition: all 0.2s;\n          ",a.addEventListener("mouseenter",()=>{100!==r&&(a.style.borderColor="#42A5F544"),a.style.transform="translateX(4px)"}),a.addEventListener("mouseleave",()=>{100!==r&&(a.style.borderColor="#333"),a.style.transform="translateX(0)"});let i=`\n          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">\n            <div style="display: flex; align-items: center; gap: 8px;">\n              <span style="font-size: 18px;">üêæ</span>\n              <strong style="color: #fff; font-size: 14px;">${o.species}</strong>\n            </div>\n            <span style="\n              background: ${100===r?"#42A5F5":"#555"};\n              color: ${100===r?"#000":"#fff"};\n              padding: 2px 8px;\n              border-radius: 12px;\n              font-size: 11px;\n              font-weight: bold;\n            ">${Math.round(r)}%</span>\n          </div>\n          <div style="\n            background: #111;\n            border-radius: 8px;\n            height: 6px;\n            margin-bottom: 12px;\n            overflow: hidden;\n          ">\n            <div style="\n              background: linear-gradient(90deg, #42A5F5, #64B5F6);\n              height: 100%;\n              width: ${r}%;\n              transition: width 0.5s ease;\n              box-shadow: 0 0 10px #42A5F577;\n            "></div>\n          </div>\n        `;e.length>0&&(i+=`\n            <div style="margin-bottom: 12px;">\n              <div style="color: #42A5F5; font-size: 11px; font-weight: 600; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px;">\n                Variants (${t}/${n})\n              </div>\n              <div style="display: flex; gap: 8px; flex-wrap: wrap;">\n                ${e.map(e=>{const t={Normal:{bg:e.collected?"#42A5F5":"#333",text:e.collected?"#fff":"#777"},Rainbow:{bg:e.collected?"#9C27B0":"#333",text:e.collected?"#fff":"#777"},Gold:{bg:e.collected?"#FFB300":"#333",text:e.collected?"#fff":"#777"},Max:{bg:e.collected?"#E91E63":"#333",text:e.collected?"#fff":"#777"}}[e.variant]||{bg:e.collected?"#42A5F5":"#333",text:e.collected?"#fff":"#777"};return`\n                    <span style="\n                      padding: 6px 12px;\n                      border-radius: 6px;\n                      font-size: 12px;\n                      background: ${t.bg};\n                      color: ${t.text};\n                      font-weight: ${e.collected?"600":"400"};\n                      ${e.collected?"box-shadow: 0 2px 4px rgba(0,0,0,0.2);":""}\n                    ">${e.collected?"‚úì ":""}${e.variant}</span>\n                  `}).join("")}\n              </div>\n            </div>\n          `),a.innerHTML=i,p.appendChild(a)}else if("recommendations"===c){const{generateJournalStrategy:e,getDifficultyEmoji:t,getPriorityEmoji:n,getDifficultyDescription:o}=await Promise.resolve().then(()=>Wd),r=await e();if(!r)return void(p.innerHTML='<div style="color: #999; text-align: center; padding: 40px; font-size: 14px;">‚ö†Ô∏è Unable to generate recommendations<br><span style="font-size: 12px; color: #666;">Try refreshing or check console for errors</span></div>');if(r.recommendedFocus.length>0){const e=document.createElement("div");e.style.cssText="\n          margin-bottom: 24px;\n        ",e.innerHTML=`\n          <div style="\n            font-size: 16px;\n            font-weight: bold;\n            color: #9C27B0;\n            margin-bottom: 12px;\n            padding-bottom: 8px;\n            border-bottom: 2px solid #9C27B033;\n          ">\n            üéØ Recommended Focus (Top ${Math.min(5,r.recommendedFocus.length)})\n          </div>\n        `,r.recommendedFocus.slice(0,5).forEach(n=>{const r=document.createElement("div");r.style.cssText=`\n            background: linear-gradient(135deg, #1f1f1f, #1a1a1a);\n            border-left: 4px solid ${"high"===n.priority?"#f44336":"medium"===n.priority?"#ff9800":"#666"};\n            border-radius: 8px;\n            padding: 14px;\n            margin-bottom: 10px;\n            transition: all 0.2s;\n          `,r.addEventListener("mouseenter",()=>{r.style.transform="translateX(4px)",r.style.boxShadow="0 4px 12px rgba(0,0,0,0.3)"}),r.addEventListener("mouseleave",()=>{r.style.transform="translateX(0)",r.style.boxShadow="none"});const a="high"===n.priority?"HIGH":"medium"===n.priority?"MED":"LOW",i="high"===n.priority?"#f44336":"medium"===n.priority?"#ff9800":"#666";r.innerHTML=`\n            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">\n              <div style="display: flex; align-items: center; gap: 8px;">\n                <span style="font-size: 18px;">${"produce"===n.type?"üåø":"üêæ"}</span>\n                <strong style="color: #fff; font-size: 14px;">${n.species}</strong>\n              </div>\n              <div style="display: flex; gap: 6px;">\n                <span style="\n                  background: ${i}33;\n                  color: ${i};\n                  padding: 2px 8px;\n                  border-radius: 4px;\n                  font-size: 10px;\n                  font-weight: bold;\n                ">${a}</span>\n                <span style="\n                  background: #555;\n                  color: #fff;\n                  padding: 2px 8px;\n                  border-radius: 4px;\n                  font-size: 10px;\n                  font-weight: bold;\n                ">${t(n.difficulty)} ${o(n.difficulty)}</span>\n              </div>\n            </div>\n            <div style="\n              background: #111;\n              border-radius: 8px;\n              height: 4px;\n              margin-bottom: 8px;\n              overflow: hidden;\n            ">\n              <div style="\n                background: linear-gradient(90deg, #9C27B0, #BA68C8);\n                height: 100%;\n                width: ${n.completionPct}%;\n                box-shadow: 0 0 8px #9C27B077;\n              "></div>\n            </div>\n            <div style="color: #aaa; font-size: 11px; margin-bottom: 6px;">\n              <strong style="color: #9C27B0;">${n.completionPct.toFixed(0)}% complete</strong> ‚Ä¢ ${n.missingVariants.length} variant${1!==n.missingVariants.length?"s":""} remaining ‚Ä¢ Est. ${n.estimatedTime}\n            </div>\n            <div style="color: #ccc; font-size: 12px; margin-bottom: 8px; line-height: 1.4;">\n              ${n.strategy}\n            </div>\n            <div style="display: flex; gap: 6px; flex-wrap: wrap; margin-top: 8px;">\n              ${n.missingVariants.map(e=>`\n                <span style="\n                  padding: 4px 8px;\n                  border-radius: 4px;\n                  font-size: 10px;\n                  background: #333;\n                  color: #999;\n                ">${e}</span>\n              `).join("")}\n            </div>\n          `,e.appendChild(r)}),p.appendChild(e)}if(r.lowHangingFruit.length>0){const e=document.createElement("div");e.style.cssText="\n          margin-bottom: 24px;\n        ",e.innerHTML='\n          <div style="\n            font-size: 16px;\n            font-weight: bold;\n            color: #4CAF50;\n            margin-bottom: 12px;\n            padding-bottom: 8px;\n            border-bottom: 2px solid #4CAF5033;\n          ">\n            üçí Quick Wins (Easy Completions)\n          </div>\n        ',r.lowHangingFruit.slice(0,5).forEach(n=>{const r=document.createElement("div");r.style.cssText="\n            background: #1a1a1a;\n            border: 1px solid #4CAF5033;\n            border-radius: 6px;\n            padding: 10px;\n            margin-bottom: 8px;\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            transition: all 0.2s;\n          ",r.addEventListener("mouseenter",()=>{r.style.background="#1f1f1f",r.style.borderColor="#4CAF5055"}),r.addEventListener("mouseleave",()=>{r.style.background="#1a1a1a",r.style.borderColor="#4CAF5033"}),r.innerHTML=`\n            <div style="display: flex; align-items: center; gap: 10px;">\n              <span style="font-size: 16px;">${"produce"===n.type?"üåø":"üêæ"}</span>\n              <div>\n                <div style="font-size: 13px; font-weight: 600; color: #fff;">${n.species}</div>\n                <div style="font-size: 10px; color: #999;">${n.missingVariants.join(", ")}</div>\n              </div>\n            </div>\n            <div style="text-align: right;">\n              <div style="font-size: 11px; color: #4CAF50; font-weight: bold;">${n.estimatedTime}</div>\n              <div style="font-size: 10px; color: #666;">${t(n.difficulty)} ${o(n.difficulty)}</div>\n            </div>\n          `,e.appendChild(r)}),p.appendChild(e)}if(r.fastestPath.steps.length>0){const e=document.createElement("div");e.style.cssText="\n          margin-bottom: 24px;\n        ",e.innerHTML=`\n          <div style="\n            font-size: 16px;\n            font-weight: bold;\n            color: #FF9800;\n            margin-bottom: 12px;\n            padding-bottom: 8px;\n            border-bottom: 2px solid #FF980033;\n          ">\n            üöÄ Fastest Path to ${r.fastestPath.expectedCompletion} More Variants\n          </div>\n          <div style="\n            background: #FF980022;\n            border-left: 3px solid #FF9800;\n            border-radius: 6px;\n            padding: 12px;\n            margin-bottom: 12px;\n          ">\n            <div style="font-size: 12px; color: #FF9800; font-weight: 600; margin-bottom: 4px;">\n              ‚è±Ô∏è Estimated Time: ${r.fastestPath.estimatedTime}\n            </div>\n            <div style="font-size: 11px; color: #aaa;">\n              Complete these ${r.fastestPath.steps.length} species for maximum journal progress\n            </div>\n          </div>\n        `,r.fastestPath.steps.slice(0,8).forEach((n,r)=>{const a=document.createElement("div");a.style.cssText="\n            background: #1a1a1a;\n            border-left: 3px solid #FF9800;\n            border-radius: 4px;\n            padding: 10px;\n            margin-bottom: 6px;\n            display: flex;\n            align-items: center;\n            gap: 10px;\n          ",a.innerHTML=`\n            <div style="\n              background: #FF9800;\n              color: #000;\n              width: 24px;\n              height: 24px;\n              border-radius: 50%;\n              display: flex;\n              align-items: center;\n              justify-content: center;\n              font-size: 11px;\n              font-weight: bold;\n              flex-shrink: 0;\n            ">${r+1}</div>\n            <div style="flex: 1;">\n              <div style="font-size: 12px; font-weight: 600; color: #fff; margin-bottom: 2px;">\n                ${"produce"===n.type?"üåø":"üêæ"} ${n.species} (${n.missingVariants.join(", ")})\n              </div>\n              <div style="font-size: 10px; color: #999;">${n.estimatedTime} ‚Ä¢ ${t(n.difficulty)} ${o(n.difficulty)}</div>\n            </div>\n          `,e.appendChild(a)}),p.appendChild(e)}if(r.longTermGoals.length>0){const e=document.createElement("div");e.style.cssText="\n          margin-bottom: 24px;\n        ",e.innerHTML='\n          <div style="\n            font-size: 16px;\n            font-weight: bold;\n            color: #f44336;\n            margin-bottom: 12px;\n            padding-bottom: 8px;\n            border-bottom: 2px solid #f4433633;\n          ">\n            üéñÔ∏è Long-Term Challenges\n          </div>\n          <div style="\n            background: #f4433622;\n            border-left: 3px solid #f44336;\n            border-radius: 6px;\n            padding: 10px;\n            margin-bottom: 12px;\n            font-size: 11px;\n            color: #f44336;\n          ">\n            ‚ö†Ô∏è These variants are very difficult or require rare conditions\n          </div>\n        ',r.longTermGoals.slice(0,5).forEach(n=>{const o=document.createElement("div");o.style.cssText="\n            background: #1a1a1a;\n            border: 1px solid #f4433633;\n            border-radius: 6px;\n            padding: 10px;\n            margin-bottom: 8px;\n          ",o.innerHTML=`\n            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 6px;">\n              <div style="display: flex; align-items: center; gap: 8px;">\n                <span style="font-size: 16px;">${"produce"===n.type?"üåø":"üêæ"}</span>\n                <strong style="color: #fff; font-size: 13px;">${n.species}</strong>\n              </div>\n              <span style="font-size: 20px;">${t(n.difficulty)}</span>\n            </div>\n            <div style="font-size: 11px; color: #aaa; margin-bottom: 6px;">\n              ${n.missingVariants.join(", ")}\n            </div>\n            <div style="font-size: 10px; color: #999; line-height: 1.4;">\n              ${n.strategy}\n            </div>\n          `,e.appendChild(o)}),p.appendChild(e)}}};l.forEach(e=>{const t=c===e.key||"missing"===e.key&&d,n=document.createElement("button");n.textContent=`${e.icon} ${e.label}`,n.style.cssText=`\n      flex: 1;\n      padding: 10px 18px;\n      border-radius: 8px;\n      border: 2px solid ${t?e.color:"#333"};\n      background: ${t?`${e.color}22`:"#222"};\n      color: ${t?e.color:"#999"};\n      cursor: pointer;\n      font-size: 13px;\n      font-weight: 600;\n      transition: all 0.2s;\n      min-width: 110px;\n    `,n.addEventListener("mouseenter",()=>{t||(n.style.background="#2a2a2a",n.style.borderColor="#444",n.style.color="#ccc")}),n.addEventListener("mouseleave",()=>{t||(n.style.background="#222",n.style.borderColor="#333",n.style.color="#999")}),n.addEventListener("click",()=>{"missing"===e.key?d=!d:(c=e.key,d=!1),s.querySelectorAll("button").forEach((e,t)=>{const n=l[t];if(!n)return;const o=c===n.key||"missing"===n.key&&d;e.style.background=o?`${n.color}22`:"#222",e.style.borderColor=o?n.color:"#333",e.style.color=o?n.color:"#999"}),u()}),s.appendChild(n)}),e.appendChild(s);const p=document.createElement("div");p.style.cssText="\n    max-height: 550px;\n    overflow-y: auto;\n    padding-right: 4px;\n  ";const m=document.createElement("style");m.textContent='\n    div[data-qpm-section="journal-checker"] ::-webkit-scrollbar {\n      width: 8px;\n    }\n    div[data-qpm-section="journal-checker"] ::-webkit-scrollbar-track {\n      background: #1a1a1a;\n      border-radius: 4px;\n    }\n    div[data-qpm-section="journal-checker"] ::-webkit-scrollbar-thumb {\n      background: #444;\n      border-radius: 4px;\n    }\n    div[data-qpm-section="journal-checker"] ::-webkit-scrollbar-thumb:hover {\n      background: #555;\n    }\n\n    /* Rainbow animation for completed items */\n    @keyframes qpm-rainbow-border {\n      0% { border-color: #ff0000; box-shadow: 0 0 20px #ff000044, inset 0 0 20px #ff000011; }\n      16.67% { border-color: #ff8800; box-shadow: 0 0 20px #ff880044, inset 0 0 20px #ff880011; }\n      33.33% { border-color: #ffff00; box-shadow: 0 0 20px #ffff0044, inset 0 0 20px #ffff0011; }\n      50% { border-color: #00ff00; box-shadow: 0 0 20px #00ff0044, inset 0 0 20px #00ff0011; }\n      66.67% { border-color: #0088ff; box-shadow: 0 0 20px #0088ff44, inset 0 0 20px #0088ff11; }\n      83.33% { border-color: #8800ff; box-shadow: 0 0 20px #8800ff44, inset 0 0 20px #8800ff11; }\n      100% { border-color: #ff0000; box-shadow: 0 0 20px #ff000044, inset 0 0 20px #ff000011; }\n    }\n\n    @keyframes qpm-rainbow-gradient {\n      0% { background-position: 0% 50%; }\n      50% { background-position: 100% 50%; }\n      100% { background-position: 0% 50%; }\n    }\n\n    .qpm-rainbow-complete {\n      animation: qpm-rainbow-border 3s linear infinite, qpm-rainbow-gradient 8s ease infinite;\n      border-width: 2px !important;\n      background: linear-gradient(\n        135deg,\n        #ff0000 0%,\n        #ff8800 16.67%,\n        #ffff00 33.33%,\n        #00ff00 50%,\n        #0088ff 66.67%,\n        #8800ff 83.33%,\n        #ff0000 100%\n      );\n      background-size: 400% 400%;\n    }\n\n    .qpm-rainbow-complete strong {\n      color: #000 !important;\n      text-shadow: 0 0 2px rgba(255, 255, 255, 0.5);\n    }\n\n    .qpm-rainbow-complete span[style*="color"] {\n      color: #000 !important;\n    }\n  ',document.head.appendChild(m),e.appendChild(p);const f=document.createElement("button");return f.textContent="üîÑ Refresh Journal Data",f.style.cssText="\n    width: 100%;\n    padding: 12px;\n    margin-top: 16px;\n    border-radius: 8px;\n    border: 2px solid #333;\n    background: linear-gradient(135deg, #2a2a2a, #222);\n    color: #fff;\n    cursor: pointer;\n    font-size: 13px;\n    font-weight: 600;\n    transition: all 0.2s;\n  ",f.addEventListener("mouseenter",()=>{f.style.background="linear-gradient(135deg, #333, #2a2a2a)",f.style.borderColor="#444",f.style.transform="translateY(-2px)",f.style.boxShadow="0 4px 8px rgba(0,0,0,0.3)"}),f.addEventListener("mouseleave",()=>{f.style.background="linear-gradient(135deg, #2a2a2a, #222)",f.style.borderColor="#333",f.style.transform="translateY(0)",f.style.boxShadow="none"}),f.addEventListener("click",()=>{f.textContent="‚è≥ Loading...",f.style.opacity="0.6",Promise.resolve().then(()=>Rd).then(e=>{e.refreshJournalCache(),u().then(()=>{f.textContent="üîÑ Refresh Journal Data",f.style.opacity="1"})})}),e.appendChild(f),u(),e}()}function fc(){if(function(){if(sc)return;const e=document.createElement("style");e.id="qpm-panel-styles",e.textContent=':root {\n    --qpm-surface-1: rgba(18, 21, 32, 0.95);\n    --qpm-surface-2: rgba(32, 36, 52, 0.9);\n    --qpm-surface-3: rgba(52, 58, 78, 0.85);\n    --qpm-border: rgba(120, 130, 170, 0.28);\n    --qpm-text: #eef0ff;\n    --qpm-text-muted: #97a0c0;\n    --qpm-accent: #8f82ff;\n    --qpm-accent-strong: #b39cff;\n    --qpm-positive: #4fd18b;\n    --qpm-danger: #ff6f91;\n    --qpm-warning: #ffb347;\n    --qpm-shadow: 0 14px 32px rgba(15, 17, 28, 0.55);\n    --qpm-divider: rgba(120, 130, 170, 0.2);\n    --qpm-font: \'Inter\', \'Segoe UI\', Arial, sans-serif;\n  }\n\n  .qpm-panel {\n    position: fixed;\n    right: 16px;\n    bottom: 16px;\n    z-index: 2147483647;\n    background: var(--qpm-surface-1);\n    color: var(--qpm-text);\n    padding: 0;\n    border-radius: 14px;\n    font: 12px/1.55 var(--qpm-font);\n    box-shadow: var(--qpm-shadow);\n    min-width: 360px;\n    max-width: 430px;\n    max-height: calc(100vh - 32px);\n    overflow: hidden;\n    backdrop-filter: blur(18px);\n    border: 1px solid var(--qpm-border);\n  }\n\n  .qpm-panel__titlebar {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 12px 16px;\n    font-size: 15px;\n    font-weight: 600;\n    background: linear-gradient(135deg, rgba(143, 130, 255, 0.28), rgba(32, 36, 52, 0.85));\n    cursor: move;\n    user-select: none;\n  }\n\n  .qpm-panel__titlebar button {\n    background: rgba(255, 255, 255, 0.08);\n    border: 1px solid rgba(255, 255, 255, 0.18);\n    color: var(--qpm-text-muted);\n    border-radius: 18px;\n    font-size: 11px;\n    padding: 4px 10px;\n    cursor: pointer;\n    transition: background 0.2s ease, color 0.2s ease;\n  }\n\n  .qpm-panel__titlebar button:hover {\n    background: rgba(255, 255, 255, 0.16);\n    color: var(--qpm-text);\n  }\n\n  .qpm-version-bubble {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    padding: 4px 10px;\n    border-radius: 4px;\n    font-size: 11px;\n    font-weight: 600;\n    letter-spacing: 0.3px;\n    transition: all 0.2s ease;\n    margin-left: auto;\n    margin-right: 8px;\n  }\n\n  .qpm-version-bubble[data-status="up-to-date"] {\n    background: rgba(76, 175, 80, 0.2);\n    color: #4CAF50;\n    border: 1px solid rgba(76, 175, 80, 0.4);\n  }\n\n  .qpm-version-bubble[data-status="outdated"] {\n    background: rgba(255, 193, 7, 0.2);\n    color: #FFC107;\n    border: 1px solid rgba(255, 193, 7, 0.4);\n    animation: pulse-warning 2s ease-in-out infinite;\n  }\n\n  .qpm-version-bubble[data-status="checking"] {\n    background: rgba(158, 158, 158, 0.2);\n    color: #9E9E9E;\n    border: 1px solid rgba(158, 158, 158, 0.4);\n  }\n\n  .qpm-version-bubble[data-status="error"] {\n    background: rgba(244, 67, 54, 0.2);\n    color: #F44336;\n    border: 1px solid rgba(244, 67, 54, 0.4);\n  }\n\n  .qpm-version-bubble:hover[data-status="outdated"] {\n    transform: scale(1.05);\n    background: rgba(255, 193, 7, 0.3);\n  }\n\n  @keyframes pulse-warning {\n    0%, 100% {\n      opacity: 1;\n    }\n    50% {\n      opacity: 0.7;\n    }\n  }\n\n  .qpm-content {\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n    padding: 12px 16px 16px;\n    overflow-y: auto;\n    overflow-x: hidden;\n    max-height: calc(100vh - 120px);\n  }\n\n  .qpm-nav {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 8px;\n    margin-bottom: 6px;\n  }\n\n  .qpm-nav__button {\n    flex: 1 1 calc(33% - 8px);\n    min-width: 120px;\n    border: 1px solid var(--qpm-border);\n    background: rgba(255, 255, 255, 0.04);\n    color: var(--qpm-text-muted);\n    border-radius: 10px;\n    padding: 8px 10px;\n    font-size: 12px;\n    font-weight: 600;\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    cursor: pointer;\n    transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;\n  }\n\n  .qpm-nav__button:hover {\n    border-color: var(--qpm-accent-strong);\n    color: var(--qpm-text);\n  }\n\n  .qpm-nav__button--active {\n    background: rgba(143, 130, 255, 0.22);\n    border-color: var(--qpm-accent);\n    color: var(--qpm-text);\n    box-shadow: 0 6px 18px rgba(143, 130, 255, 0.24);\n  }\n\n  .qpm-tabs {\n    position: relative;\n  }\n\n  .qpm-tab {\n    display: none;\n    flex-direction: column;\n    gap: 12px;\n  }\n\n  .qpm-tab--active {\n    display: flex;\n  }\n\n  .qpm-card {\n    background: var(--qpm-surface-2);\n    border: 1px solid var(--qpm-border);\n    border-radius: 12px;\n    padding: 12px 14px;\n    box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.03);\n  }\n\n  .qpm-table {\n    width: 100%;\n    border-collapse: collapse;\n  }\n\n  .qpm-table thead {\n    background: rgba(255, 255, 255, 0.05);\n    text-transform: uppercase;\n    letter-spacing: 0.3px;\n    font-size: 9px;\n    color: var(--qpm-text-muted);\n  }\n\n  .qpm-table th,\n  .qpm-table td {\n    padding: 6px 8px;\n    text-align: left;\n    border-bottom: 1px solid rgba(255, 255, 255, 0.04);\n  }\n\n  .qpm-table tbody tr:nth-child(odd) {\n    background: rgba(255, 255, 255, 0.02);\n  }\n\n  .qpm-table--compact th,\n  .qpm-table--compact td {\n    font-size: 10px;\n  }\n\n  .qpm-ability-divider td {\n    border-top: 1px solid rgba(255, 255, 255, 0.08);\n  }\n\n  .qpm-ability-section td {\n    background: rgba(255, 255, 255, 0.04);\n    font-weight: 600;\n    font-size: 11px;\n    color: var(--qpm-text);\n    padding: 7px 8px;\n    border-top: 1px solid rgba(255, 255, 255, 0.08);\n  }\n\n  .qpm-ability-section__content {\n    display: flex;\n    align-items: baseline;\n    justify-content: space-between;\n    gap: 12px;\n    flex-wrap: wrap;\n  }\n\n  .qpm-ability-section__title {\n    font-weight: 600;\n  }\n\n  .qpm-ability-section__meta {\n    font-weight: 400;\n    font-size: 10px;\n    color: var(--qpm-text-muted);\n  }\n\n  .qpm-ability-total {\n    font-weight: 600;\n    background: rgba(255, 255, 255, 0.03);\n  }\n\n  .qpm-ability-total td {\n    border-top: 1px solid rgba(255, 255, 255, 0.08);\n  }\n\n  .qpm-tracker-summary {\n    font-size: 11px;\n    color: var(--qpm-text-muted);\n    line-height: 1.5;\n  }\n\n  .qpm-mutation-meta {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    gap: 8px;\n    flex-wrap: wrap;\n    font-size: 11px;\n  }\n\n  .qpm-mutation-meta__group {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    flex-wrap: wrap;\n  }\n\n  .qpm-mutation-source {\n    font-size: 10px;\n    color: var(--qpm-text-muted);\n    background: rgba(255, 255, 255, 0.06);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: 999px;\n    padding: 2px 8px;\n  }\n\n  .qpm-mutation-countdown {\n    font-size: 11px;\n    color: var(--qpm-text-muted);\n    margin-top: 4px;\n  }\n\n  .qpm-mutation-countdown[data-state=\'active\'] {\n    color: #b3ffe0;\n  }\n\n  .qpm-mutation-countdown[data-state=\'expired\'] {\n    color: #ffcc80;\n  }\n\n  .qpm-mutation-totals {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 6px;\n    margin-top: 8px;\n  }\n\n  .qpm-mutation-chip {\n    background: rgba(255, 255, 255, 0.05);\n    border: 1px solid rgba(255, 255, 255, 0.08);\n    border-radius: 10px;\n    padding: 6px 10px;\n    min-width: 130px;\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n  }\n\n  .qpm-mutation-chip--active {\n    border-color: rgba(143, 130, 255, 0.5);\n    box-shadow: 0 0 0 1px rgba(143, 130, 255, 0.3);\n  }\n\n  .qpm-mutation-chip__label {\n    font-size: 11px;\n    font-weight: 600;\n    color: var(--qpm-text);\n  }\n\n  .qpm-mutation-chip__meta {\n    font-size: 10px;\n    color: var(--qpm-text-muted);\n  }\n\n  .qpm-mutation-detail {\n    margin-top: 8px;\n  }\n\n  .qpm-tracker-note {\n    font-size: 10px;\n    color: #90caf9;\n    background: rgba(144, 202, 249, 0.08);\n    border: 1px dashed rgba(144, 202, 249, 0.4);\n    border-radius: 8px;\n    padding: 8px;\n  }\n\n  .qpm-card__header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    margin-bottom: 6px;\n  }\n\n  .qpm-card__title {\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--qpm-text);\n    display: flex;\n    align-items: center;\n    gap: 6px;\n  }\n\n  .qpm-section-muted {\n    color: var(--qpm-text-muted);\n    font-size: 11px;\n  }\n\n  .qpm-button {\n    padding: 6px 10px;\n    font-size: 12px;\n    cursor: pointer;\n    border: 1px solid var(--qpm-border);\n    border-radius: 10px;\n    background: rgba(255, 255, 255, 0.06);\n    color: var(--qpm-text);\n    transition: background 0.2s ease, border-color 0.2s ease;\n  }\n\n  .qpm-button:hover:not(:disabled) {\n    background: rgba(255, 255, 255, 0.12);\n    border-color: var(--qpm-accent);\n  }\n\n  .qpm-button:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n  }\n\n  .qpm-button--accent {\n    background: rgba(143, 130, 255, 0.24);\n    border-color: var(--qpm-accent);\n  }\n\n  .qpm-button--positive {\n    background: rgba(79, 209, 139, 0.28);\n    border-color: rgba(79, 209, 139, 0.6);\n  }\n\n  .qpm-grid {\n    display: grid;\n    gap: 10px;\n  }\n\n  .qpm-grid--two {\n    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\n  }\n\n  .qpm-row {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    flex-wrap: wrap;\n  }\n\n  .qpm-input,\n  .qpm-select {\n    padding: 4px 8px;\n    border: 1px solid var(--qpm-border);\n    border-radius: 8px;\n    background: rgba(20, 24, 36, 0.65);\n    color: var(--qpm-text);\n    font-size: 11px;\n    transition: border-color 0.2s ease, box-shadow 0.2s ease;\n  }\n\n  .qpm-input:focus,\n  .qpm-select:focus {\n    outline: none;\n    border-color: var(--qpm-accent);\n    box-shadow: 0 0 0 2px rgba(143, 130, 255, 0.18);\n  }\n\n  .qpm-checkbox {\n    accent-color: var(--qpm-accent);\n  }\n\n  .qpm-coming-grid {\n    display: grid;\n    gap: 10px;\n    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));\n  }\n\n  .qpm-coming-card {\n    background: var(--qpm-surface-3);\n    border: 1px dashed rgba(143, 130, 255, 0.35);\n    border-radius: 10px;\n    padding: 10px;\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n    color: var(--qpm-text-muted);\n  }\n\n  .qpm-coming-card strong {\n    color: var(--qpm-text);\n    font-size: 12px;\n  }\n\n  .qpm-coming-card span {\n    color: var(--qpm-accent-strong);\n    font-size: 11px;\n    font-weight: 600;\n  }\n\n  .qpm-chip {\n    display: inline-flex;\n    align-items: center;\n    gap: 4px;\n    padding: 2px 6px;\n    border-radius: 999px;\n    font-size: 10px;\n    background: rgba(143, 130, 255, 0.22);\n    color: var(--qpm-text);\n    border: 1px solid rgba(143, 130, 255, 0.35);\n  }\n\n  .qpm-toast {\n    position: fixed;\n    bottom: 24px;\n    right: 24px;\n    background: rgba(20, 26, 40, 0.92);\n    border: 1px solid rgba(143, 130, 255, 0.35);\n    color: var(--qpm-text);\n    padding: 10px 14px;\n    border-radius: 12px;\n    font-size: 12px;\n    z-index: 2147483647;\n    box-shadow: 0 10px 26px rgba(12, 16, 28, 0.55);\n    animation: qpm-toast-in 0.25s ease;\n  }\n\n  @keyframes qpm-toast-in {\n    from { opacity: 0; transform: translateY(12px); }\n    to { opacity: 1; transform: translateY(0); }\n  }\n\n  /* Custom scrollbar for main panel content */\n  .qpm-content::-webkit-scrollbar {\n    width: 8px;\n  }\n  .qpm-content::-webkit-scrollbar-track {\n    background: rgba(0, 0, 0, 0.2);\n    border-radius: 4px;\n  }\n  .qpm-content::-webkit-scrollbar-thumb {\n    background: rgba(143, 130, 255, 0.35);\n    border-radius: 4px;\n    transition: background 0.2s;\n  }\n  .qpm-content::-webkit-scrollbar-thumb:hover {\n    background: rgba(143, 130, 255, 0.55);\n  }\n  ',document.head.appendChild(e),sc=!0}(),xl.panel)return xl.panel;const e=document.createElement("div");e.className="qpm-panel";const t=document.createElement("div");t.className="qpm-panel__titlebar",t.title="Drag to move ‚Ä¢ Click to collapse";const n=document.createElement("span");n.textContent="üçñ Quinoa Pet Manager";const o=document.createElement("div");o.className="qpm-version-bubble",o.dataset.status="checking",o.textContent=`v${ul}`,o.title="Checking for updates...",o.style.cssText="display: none;";const r=e=>{switch(o.dataset.status=e.status,o.textContent=`v${e.current}`,o.style.display="",e.status){case"up-to-date":o.title=`‚úÖ Up to date (v${e.current})`,o.style.cursor="default";break;case"outdated":o.title=`‚ö†Ô∏è Update available: v${e.latest}\nClick to update`,o.style.cursor="pointer";break;case"checking":o.title="Checking for updates...",o.style.cursor="default";break;case"error":o.title="‚ùå Failed to check for updates",o.style.cursor="default"}};gl=r,r(yl()),o.addEventListener("click",e=>{e.stopPropagation();const t=yl();"outdated"===t.status&&window.open(t.updateUrl,"_blank")});const a=document.createElement("button");a.type="button",a.dataset.qpmCollapseButton="true",a.className="qpm-button",a.setAttribute("aria-label","Collapse panel");const i=document.createElement("span");i.textContent="‚ñº",a.appendChild(i),t.append(n,o,a);const c=document.createElement("div");c.className="qpm-content";const d=document.createElement("div");d.className="qpm-nav";const u=document.createElement("div");u.className="qpm-tabs",c.append(d,u),e.append(t,c);const p=Se(),f=!1!==p.syncModeEnabled,g=cc.inventoryLocker?.syncMode,h="boolean"==typeof g?g:f;let b=!1;cc.inventoryLocker?cc.inventoryLocker.syncMode!==h&&(cc.inventoryLocker.syncMode=h,b=!0):(cc.inventoryLocker={syncMode:h},b=!0),b&&Jc(),p.syncModeEnabled!==h&&ke(h);const y=function(){const e=document.createElement("div");e.className="qpm-card",e.dataset.qpmSection="header",e.style.cssText="background: linear-gradient(135deg, rgba(143,130,255,0.08), rgba(143,130,255,0.03)); border: 1px solid rgba(143,130,255,0.15);";const t=document.createElement("div");t.className="qpm-card__header";const n=document.createElement("div");n.className="qpm-card__title",n.textContent="Session Overview",n.style.cssText="font-size: 14px; font-weight: 700; letter-spacing: 0.3px;";const o=Xc("‚ôª Reset Stats",qc);o.classList.add("qpm-button--accent"),o.style.fontSize="11px",o.title="Reset header and detailed stats counters",t.append(n,o),e.appendChild(t);const r=document.createElement("div");r.style.cssText="display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:10px;margin-top:10px;",e.appendChild(r);const a=oc(),i=function(e,t,n){const o=document.createElement("div");o.style.cssText=`padding:8px 10px;border-radius:6px;background:${n};border:1px solid ${n.replace("0.15","0.25")};display:flex;flex-direction:column;gap:4px;`;const r=document.createElement("div");r.className="indicator-header",r.style.cssText="display:flex;align-items:center;justify-content:space-between;gap:6px;margin-bottom:2px;";const a=document.createElement("div");return a.style.cssText="font-size:11px;font-weight:600;color:#b0b0b0;letter-spacing:0.3px;",a.textContent=`${e} ${t}`,r.appendChild(a),o.appendChild(r),o}("üê¢","Bella's Turtle Temple","rgba(0,150,136,0.15)"),l=i.querySelector(".indicator-header"),c=document.createElement("button");c.type="button",c.className="qpm-chip",c.style.cssText="cursor:pointer;user-select:none;font-size:9px;padding:2px 6px;",l.appendChild(c);const d=document.createElement("div");d.style.cssText="display:flex;align-items:center;justify-content:space-between;gap:4px;cursor:pointer;padding:4px 6px;background:rgba(255,255,255,0.04);border-radius:4px;margin:4px 0;transition:background 0.2s;",d.title="Click to select a different plant";const u=document.createElement("div");u.style.cssText="font-size:12px;font-weight:600;color:#e0f2f1;flex:1;",u.textContent="Loading...",d.appendChild(u);const p=document.createElement("span");p.style.cssText="font-size:9px;color:#80cbc4;",p.textContent="‚ñº",d.appendChild(p),i.appendChild(d);const m=document.createElement("select");m.className="qpm-select",m.style.cssText="display:none;width:100%;padding:4px 6px;font-size:10px;background:rgba(0,0,0,0.3);border:1px solid rgba(0,150,136,0.3);border-radius:4px;color:#e0e0e0;margin-bottom:6px;",i.appendChild(m);const f=document.createElement("option");f.value="",f.textContent="Select a plant...",f.disabled=!0,m.appendChild(f),d.addEventListener("click",e=>{e.stopPropagation();const t="none"===m.style.display;m.style.display=t?"block":"none",p.textContent=t?"‚ñ≤":"‚ñº",t&&g()}),d.addEventListener("mouseenter",()=>{d.style.background="rgba(255,255,255,0.08)"}),d.addEventListener("mouseleave",()=>{d.style.background="rgba(255,255,255,0.04)"}),m.addEventListener("change",()=>{const e=m.value;if(e){const{tileId:t,slotIndex:n}=jl(e);cc.turtleTimer={...oc(),focus:"specific",focusTargetTileId:t,focusTargetSlotIndex:n},Jc(),ua({focus:"specific",focusTargetTileId:t,focusTargetSlotIndex:n}),m.style.display="none",p.textContent="‚ñº"}});const g=()=>{const e=fa();for(;m.options.length>1;)m.remove(1);for(const t of e.plantTargets){const e=document.createElement("option");e.value=t.key;const n=t.species??"Unknown",o=null!=t.remainingMs?Gl(t.remainingMs):"Ready";e.textContent=`${n} - ${o}`,m.appendChild(e)}},h=document.createElement("div");h.style.cssText="font-size:11px;color:#e0f2f1;font-weight:500;margin-bottom:2px;",i.appendChild(h);const b=document.createElement("div");b.style.cssText="font-size:10px;color:#b2dfdb;line-height:1.4;",i.appendChild(b);const y=document.createElement("div");y.style.cssText="font-size:9px;color:#80cbc4;margin-top:4px;",i.appendChild(y);const x=document.createElement("label");x.style.cssText="display:flex;align-items:center;gap:4px;font-size:9px;color:#80cbc4;cursor:pointer;margin-top:6px;";const w=document.createElement("input");w.type="checkbox",w.className="qpm-checkbox",w.checked=a.includeBoardwalk;const v=document.createElement("span");v.textContent="Include boardwalk tiles",x.append(w,v),i.appendChild(x),c.addEventListener("click",()=>{const e=!(cc.turtleTimer?.enabled??1);cc.turtleTimer={...oc(),enabled:e},Jc(),pa(e)}),w.addEventListener("change",()=>{const e=w.checked;cc.turtleTimer={...oc(),includeBoardwalk:e},Jc(),ua({includeBoardwalk:e})}),xl.turtleStatus=h,xl.turtleDetail=b,xl.turtleFooter=y,xl.turtleEnableButtons.push(c),xl.turtleBoardwalkToggles.push(w),xl.turtlePlantNameText=u,xl.turtleUnsubscribe&&xl.turtleUnsubscribe();xl.turtleUnsubscribe=ga(e=>{ic(e)}),r.appendChild(i);const C=document.createElement("div");C.style.cssText="font-size:12px;font-weight:600;color:#64b5f6;margin-top:16px;margin-bottom:8px;text-transform:uppercase;letter-spacing:0.5px;",C.textContent="üè™ Shop Restock Tracker",e.appendChild(C);const T=document.createElement("div");T.style.cssText="display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:10px;",e.appendChild(T);const S=[{name:"Starweaver",emoji:"‚≠ê",color:"rgba(255,215,0,0.2)",textColor:"#FFD700"},{name:"Dawnbinder",emoji:"üåÖ",color:"rgba(255,152,0,0.2)",textColor:"#FF9800"},{name:"Moonbinder",emoji:"üåô",color:"rgba(156,39,176,0.2)",textColor:"#CE93D8"},{name:"Mythical Eggs",emoji:"ü•ö",color:"rgba(66,165,245,0.2)",textColor:"#42A5F5"}],k=e=>{const t=Date.now()-e,n=Math.floor(t/864e5),o=Math.floor(t/36e5),r=Math.floor(t/6e4);return n>0?1===n?"1 day ago":`${n} days ago`:o>0?1===o?"1 hour ago":`${o} hours ago`:r>0?1===r?"1 min ago":`${r} mins ago`:"Just now"},A=()=>{T.innerHTML="";const e=Ls();S.forEach(t=>{let n=e.get(t.name);if(!n)for(const[s,l]of e.entries())if(s.includes(t.name)||t.name.includes(s)){n=l;break}const o=document.createElement("div");o.style.cssText=`\n        padding:12px;\n        background:${t.color};\n        border-radius:8px;\n        border:2px solid ${t.textColor}40;\n        box-shadow:0 2px 8px rgba(0,0,0,0.2);\n        transition:all 0.2s ease;\n        cursor:default;\n      `,o.addEventListener("mouseenter",()=>{o.style.transform="translateY(-2px)",o.style.boxShadow="0 4px 12px rgba(0,0,0,0.3)"}),o.addEventListener("mouseleave",()=>{o.style.transform="translateY(0)",o.style.boxShadow="0 2px 8px rgba(0,0,0,0.2)"});const r=document.createElement("div");r.style.cssText="display:flex;align-items:center;gap:6px;margin-bottom:8px;";const a=document.createElement("span");a.style.cssText="font-size:18px;",a.textContent=t.emoji;const i=document.createElement("div");if(i.style.cssText=`font-size:11px;font-weight:700;color:${t.textColor};text-transform:uppercase;letter-spacing:0.5px;`,i.textContent=t.name,r.appendChild(a),r.appendChild(i),o.appendChild(r),n&&n.lastSeen){const e=new Date(n.lastSeen),r=e.toLocaleTimeString([],{hour:"numeric",minute:"2-digit",hour12:!0}),a=e.toLocaleDateString([],{month:"short",day:"numeric"}),i=k(n.lastSeen),s=document.createElement("div");s.style.cssText="margin-bottom:4px;";const l=document.createElement("div");l.style.cssText="font-size:13px;color:#fff;font-weight:600;",l.textContent=`${a} ${r}`,s.appendChild(l),o.appendChild(s);const c=document.createElement("div");c.style.cssText=`font-size:10px;color:${t.textColor};font-weight:600;background:rgba(0,0,0,0.2);padding:3px 8px;border-radius:4px;display:inline-block;`,c.textContent=i,o.appendChild(c)}else{const e=document.createElement("div");e.style.cssText="font-size:11px;color:#999;font-style:italic;text-align:center;padding:12px 0;",e.textContent="No data yet",o.appendChild(e)}T.appendChild(o)})};return Ns(),cl().catch(e=>{s("‚ö†Ô∏è Failed to start live shop tracking",e)}),Hs(()=>{A()}),A(),e}();!function(){Tl&&(Tl(),Tl=null);const e=document.createElement("div");e.className="qpm-card",e.dataset.qpmSection="stats",e.style.cssText="background: linear-gradient(135deg, rgba(100,181,246,0.08), rgba(100,181,246,0.03)); border: 1px solid rgba(100,181,246,0.15);";const t=document.createElement("div");t.className="qpm-card__header",t.style.cssText="cursor: pointer; padding: 12px 14px; border-radius: 8px; transition: all 0.2s ease; user-select: none;";const n=document.createElement("div");n.className="qpm-card__title",n.textContent="üìä Detailed Stats",n.style.cssText="font-size: 14px; font-weight: 700; letter-spacing: 0.3px; color: #64b5f6;";const o=document.createElement("span");o.style.cssText="font-size: 14px; color: #64b5f6; transition: transform 0.2s ease;",o.textContent="‚ñº";const r=document.createElement("span");r.style.cssText="font-size: 10px; color: #90a4ae; margin-left: 8px; font-weight: 400;",r.textContent="(click to expand)",t.append(n,o,r);const a=document.createElement("div");a.style.cssText="display:block;margin-top:12px;font-size:11px;color:#dbe1ff;line-height:1.6;",t.addEventListener("click",()=>{const e="none"===a.style.display;a.style.display=e?"block":"none",o.textContent=e?"‚ñº":"‚ñ≤",o.style.transform=e?"rotate(0deg)":"rotate(180deg)",r.textContent=e?"(click to expand)":"(click to collapse)",t.style.background=e?"transparent":"rgba(100,181,246,0.08)"}),t.addEventListener("mouseenter",()=>{"none"===a.style.display&&(t.style.background="rgba(100,181,246,0.05)")}),t.addEventListener("mouseleave",()=>{"none"===a.style.display&&(t.style.background="transparent")});const i=document.createElement("div");i.textContent="üçñ Auto Feed",i.style.cssText="font-weight:700;color:#ffcc80;font-size:12px;margin-bottom:4px;text-transform:uppercase;letter-spacing:0.5px;margin-top:4px;";const s=document.createElement("div");s.style.cssText="color:#f0f0f0;margin-bottom:3px;font-size:11px;line-height:1.5;";const c=document.createElement("div");c.style.cssText="color:#c0c0c0;font-size:10px;margin-bottom:10px;line-height:1.5;";const d=document.createElement("div");d.textContent="‚òÄÔ∏è Weather",d.style.cssText="font-weight:700;color:#80deea;font-size:12px;margin-bottom:4px;text-transform:uppercase;letter-spacing:0.5px;";const u=document.createElement("div");u.style.cssText="color:#f0f0f0;margin-bottom:3px;font-size:11px;line-height:1.5;";const p=document.createElement("div");p.style.cssText="color:#c0c0c0;font-size:10px;margin-bottom:10px;line-height:1.5;";const m=document.createElement("div");m.textContent="üõí Auto Shop",m.style.cssText="font-weight:700;color:#ffab91;font-size:12px;margin-bottom:4px;text-transform:uppercase;letter-spacing:0.5px;";const f=document.createElement("div");f.style.cssText="color:#f0f0f0;margin-bottom:3px;font-size:11px;line-height:1.5;";const g=document.createElement("div");g.style.cssText="color:#c0c0c0;font-size:10px;margin-bottom:8px;line-height:1.5;";const h=document.createElement("div");h.textContent="Recent Purchases",h.style.cssText="font-weight:700;font-size:11px;color:#d0d0d0;margin-top:8px;margin-bottom:4px;letter-spacing:0.5px;text-transform:uppercase;";const b=document.createElement("div");b.style.cssText="display:flex;flex-direction:column;gap:3px;font-size:10px;color:#b0b0b0;line-height:1.5;";const y=document.createElement("div");y.style.cssText="margin-top:14px;display:flex;justify-content:flex-end;padding-top:10px;border-top:1px solid rgba(255,255,255,0.08);";const x=Xc("‚ôª Reset Stats",qc);x.classList.add("qpm-button--accent"),x.style.cssText="font-size:11px;font-weight:600;",y.append(x),a.append(i,s,c,d,u,p,m,f,g,h,b,y),e.append(t,a);Tl=Na(e=>{const{feed:t,weather:n,shop:o}=e;const r=[];r.push(`${t.totalFeeds} total feeds`);if(t.lastFeedAt){r.push(`last ${l(t.lastFeedAt)}`)}s.textContent=r.join(" ‚Ä¢ ");const a=Object.entries(t.perPet).sort((e,t)=>(t[1]?.count??0)-(e[1]?.count??0)).slice(0,3);if(a.length===0){c.textContent="No feed history yet"}else{const e=a.map(([e,t])=>{const n=t.lastFeedAt?` (${l(t.lastFeedAt)})`:"";return`${e} √ó${t.count}${n}`});c.textContent=e.join(" ‚Ä¢ ")}const i=n.presetUsage.weather.primary+n.presetUsage.noweather.primary;const d=n.presetUsage.weather.alternate+n.presetUsage.noweather.alternate;const m=[];m.push(`Swaps ${n.totalSwaps}`);m.push(`Primary ${i}`);if(d>0)m.push(`Alternate ${d}`);if(n.cooldownBlocks>0)m.push(`Cooldown blocks ${n.cooldownBlocks}`);u.textContent=m.join(" ‚Ä¢ ");const h=Object.entries(n.timeByKind).filter(([,e])=>e>0).sort((e,t)=>(t[1]??0)-(e[1]??0)).slice(0,3).map(([e,t])=>`${Fc(e)} ${Ic(t)}`);p.textContent=h.length>0?h.join(" ‚Ä¢ "):"No uptime recorded yet";const y=[];y.push(`Items ${o.totalPurchases}`);if(o.totalSpentCoins>0){y.push(`ü™ô ${so(o.totalSpentCoins)}`)}if(o.totalSpentCredits>0){y.push(`üç© ${o.totalSpentCredits.toLocaleString()}`)}f.textContent=y.join(" ‚Ä¢ ");const x=Object.entries(o.purchasesByCategory).filter(([,e])=>e>0).sort((e,t)=>(t[1]??0)-(e[1]??0)).map(([e,t])=>`${e}: ${t}`);g.textContent=x.length>0?x.join(" ‚Ä¢ "):"No purchases yet";b.innerHTML="";const w=o.history.slice(-5).reverse();if(w.length===0){const e=document.createElement("div");e.textContent="No recent purchases";b.appendChild(e)}else{for(const e of w){const t=document.createElement("div");const n=[];if(e.coins>0)n.push(`ü™ô ${so(e.coins)}`);if(e.credits>0)n.push(`üç© ${e.credits.toLocaleString()}`);const o=n.length?` (${n.join(" ‚Ä¢ ")})`:"";t.textContent=`${e.itemName} √ó${e.count}${o} ‚Äî ${l(e.timestamp)}`;b.appendChild(t)}}})}(),function(){if(xl.notificationsSection)return xl.notificationsSection;const e=document.createElement("div");e.className="qpm-card",e.dataset.qpmSection="notifications";const t=document.createElement("div");t.className="qpm-card__header";const n=document.createElement("div");n.className="qpm-card__title",n.textContent="üîî Notifications";const o=document.createElement("div");o.style.cssText="display:flex;gap:6px;flex-wrap:wrap";const r=Xc("",()=>{bc(!Ll),C()});r.style.fontSize="10px";const a=Xc("",()=>{Dl=!Dl,m.set(El,Dl),yc();xc(Rl?Il.find(e=>e.id===Rl)??null:null),wc()});a.style.fontSize="10px";const i=Xc("Clear",()=>{ha.length=0,xa(),hc(),Rl=null,zl.clear(),Sc(null),vc([]),wc()});i.style.fontSize="10px",o.append(r,a,i),t.append(n,o),e.appendChild(t);const s=document.createElement("div");s.style.cssText="display:flex;flex-direction:column;gap:8px;margin-top:8px;",e.appendChild(s);const l=document.createElement("div");l.style.cssText="display:flex;flex-wrap:wrap;gap:6px",s.appendChild(l);const c=document.createElement("div");c.style.cssText="max-height:240px;overflow-y:auto;padding-right:4px;",s.appendChild(c);const d=document.createElement("div");d.style.cssText="display:flex;flex-direction:column;gap:8px",c.appendChild(d);const u=document.createElement("div");u.textContent="No notifications yet.",u.style.cssText="font-size:11px;color:var(--qpm-text-muted);padding:12px;border:1px dashed rgba(255,255,255,0.1);border-radius:6px;text-align:center;",s.appendChild(u);const p=document.createElement("div");p.style.cssText="border:1px solid rgba(255,255,255,0.08);background:rgba(10,12,20,0.72);border-radius:8px;padding:12px;display:flex;flex-direction:column;gap:10px;min-height:120px",s.appendChild(p);const f=document.createElement("div");f.textContent="Select a notification to see full details.",f.style.cssText="font-size:11px;color:var(--qpm-text-muted);text-align:center;",p.appendChild(f);const g=document.createElement("div");g.style.cssText="display:none;justify-content:space-between;align-items:flex-start;gap:12px;",p.appendChild(g);const h=document.createElement("div");h.style.cssText="font-weight:600;font-size:12px;color:#fff;flex:1 1 auto;overflow:hidden;text-overflow:ellipsis;",g.appendChild(h);const b=document.createElement("div");b.style.cssText="font-size:10px;color:#ccc;white-space:nowrap;",g.appendChild(b);const y=document.createElement("div");y.style.cssText="display:none;flex-wrap:wrap;gap:6px;font-size:10px;color:#d7e3ff;",p.appendChild(y);const x=document.createElement("div");x.style.cssText="display:none;font-size:11px;line-height:1.5;color:#f5f7ff;white-space:pre-wrap;word-break:break-word;",p.appendChild(x);const w=document.createElement("div");w.style.cssText="display:none;flex-wrap:wrap;gap:6px;",p.appendChild(w);const v=document.createElement("pre");v.style.cssText="display:none;font-size:10px;color:#9cd2ff;background:rgba(255,255,255,0.05);padding:8px;border-radius:4px;margin:0;max-height:140px;overflow:auto;",p.appendChild(v),xl.notificationsSection=e,xl.notificationsFilterBar=l,xl.notificationsListWrapper=c,xl.notificationsList=d,xl.notificationsEmpty=u,xl.notificationsDetail=p,xl.notificationsDetailHeader=g,xl.notificationsDetailTitle=h,xl.notificationsDetailTimestamp=b,xl.notificationsDetailMeta=y,xl.notificationsDetailMessage=x,xl.notificationsDetailActions=w,xl.notificationsDetailRaw=v,xl.notificationsDetailPlaceholder=f,xl.notificationsDetailToggle=a,Fl.clear(),Nl.clear(),ql=null,zl.clear(),Rl=null,Sc(null),xl.notificationsUnsubscribe?.(),xl.notificationsUnsubscribe=wa(e=>{if(Il=e,function(e){const t=xl.notificationsFilterBar;if(!t)return;const n=Array.from(new Set(e.map(e=>e.feature))).sort();for(const o of Array.from(Fl))n.includes(o)||Fl.delete(o);t.textContent="",ql=Ac("All",()=>{hc(),vc(Il)}),Pc(ql,0===Fl.size),t.appendChild(ql),Nl.clear();for(const o of n){const e=Ac(Mc(o),()=>{gc(o)});Pc(e,Fl.has(o)),t.appendChild(e),Nl.set(o,e)}}(e),vc(e),Rl){(e.find(e=>e.id===Rl)??null)||Sc(null)}});const C=()=>{r.textContent=Ll?"Expand":"Collapse",r.classList.toggle("qpm-button--accent",Ll)};C(),yc(),bc(Ll),xc(null),wc()}();const x=Nc();!function(){xl.mutationTrackerUnsubscribe&&(xl.mutationTrackerUnsubscribe(),xl.mutationTrackerUnsubscribe=null);null!=xl.mutationTrackerTicker&&(window.clearInterval(xl.mutationTrackerTicker),xl.mutationTrackerTicker=null);xl.trackerAbilityHistoryUnsubscribe&&(xl.trackerAbilityHistoryUnsubscribe(),xl.trackerAbilityHistoryUnsubscribe=null);null!=xl.trackerAbilityTicker&&(window.clearInterval(xl.trackerAbilityTicker),xl.trackerAbilityTicker=null)}();const w=_c(h),v=Vc();dc(),uc();const C=new Map,T=new Map;let S=null;const k=e=>{if(S!==e){S=e;for(const[t,n]of C)n.classList.toggle("qpm-tab--active",t===e);for(const[t,n]of T)n.classList.toggle("qpm-nav__button--active",t===e)}},A=(e,t,n,o)=>{const r=document.createElement("button");r.type="button",r.className="qpm-nav__button",r.innerHTML=`${n}<span>${t}</span>`,r.addEventListener("click",()=>k(e)),d.appendChild(r),T.set(e,r);const a=document.createElement("div");a.className="qpm-tab";for(const i of o)a.appendChild(i);u.appendChild(a),C.set(e,a)},P=pc(),M=mc(),E=function(){const{root:e,body:t}=lc("üìñ Magic Garden Guide",{subtitle:"Reference guide for game mechanics"});e.dataset.qpmSection="guide";const n=document.createElement("div");n.style.cssText="\n    width: 100%;\n    text-align: center;\n    padding: 12px;\n    background: var(--qpm-surface-1, #1a1a1a);\n    border-radius: 8px;\n    position: relative;\n  ";const o=document.createElement("div");o.textContent="(Click to open full size!)",o.style.cssText="\n    position: absolute;\n    top: 20px;\n    right: 20px;\n    color: rgba(150, 150, 150, 0.7);\n    font-size: 12px;\n    font-style: italic;\n    background: rgba(0, 0, 0, 0.5);\n    padding: 4px 8px;\n    border-radius: 4px;\n    pointer-events: none;\n    z-index: 10;\n  ";const r=document.createElement("img");return r.src="https://raw.githubusercontent.com/ryandt2305-cpu/QPM-GR/master/MGGuide.jpeg",r.alt="Magic Garden Guide",r.style.cssText="\n    width: 100%;\n    max-width: 100%;\n    height: auto;\n    border-radius: 8px;\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);\n    cursor: pointer;\n    transition: transform 0.2s;\n    display: block;\n  ",r.addEventListener("mouseenter",()=>{r.style.transform="scale(1.02)"}),r.addEventListener("mouseleave",()=>{r.style.transform="scale(1)"}),r.addEventListener("click",()=>{window.open(r.src,"_blank")}),r.onerror=()=>{n.innerHTML='\n      <div style="padding: 40px; color: var(--qpm-text-muted, #999); font-style: italic;">\n        üìñ Guide image not found. Please ensure MGGuide.jpeg is uploaded to the master branch of the repository.\n      </div>\n    '},n.appendChild(o),n.appendChild(r),t.appendChild(n),e}();A("dashboard","Dashboard","üìä",[y]),A("turtle","Turtle Timer","üê¢",[x]),A("trackers","Trackers","üìà",[]),A("xp-tracker","XP Tracker","‚ú®",[]),A("shop-restock","Shop Restock","üè™",[]),A("auto-favorite","Auto-Favorite","‚≠ê",[P]),A("journal-checker","Journal","üìî",[M]),A("guide","Guide","üìñ",[E]),A("weather","Reminders","üîî",[v]),A("locker","Locker","üîí",[w]);const $=T.get("trackers");if($){const e=$.cloneNode(!0);e.addEventListener("click",()=>{gi("trackers-detail","üìä Ability & Mutation Trackers",Hc)}),$.replaceWith(e),T.set("trackers",e)}const F=T.get("xp-tracker");if(F){const e=F.cloneNode(!0);e.addEventListener("click",async()=>{try{const{createXpTrackerWindow:e,showXpTrackerWindow:t,hideXpTrackerWindow:n,setGlobalXpTrackerState:o}=await Promise.resolve().then(()=>nu);xl.xpTrackerWindow||(xl.xpTrackerWindow=e(),o(xl.xpTrackerWindow));"none"!==xl.xpTrackerWindow.root.style.display?n(xl.xpTrackerWindow):t(xl.xpTrackerWindow)}catch(e){s("‚ö†Ô∏è Failed to toggle XP Tracker window",e)}}),F.replaceWith(e),T.set("xp-tracker",e)}const I=T.get("shop-restock");if(I){const e=I.cloneNode(!0);e.addEventListener("click",async()=>{try{const{createShopRestockWindow:e,showShopRestockWindow:t,hideShopRestockWindow:n}=await Promise.resolve().then(()=>gu);xl.shopRestockWindow||(xl.shopRestockWindow=e());"none"!==xl.shopRestockWindow.root.style.display?n(xl.shopRestockWindow):t(xl.shopRestockWindow)}catch(e){s("‚ö†Ô∏è Failed to toggle Shop Restock window",e)}}),I.replaceWith(e),T.set("shop-restock",e)}const q=T.get("turtle");if(q){const e=q.cloneNode(!0);e.addEventListener("click",()=>{gi("turtle-timer","üê¢ Bella's Turtle Temple",Gc)}),q.replaceWith(e),T.set("turtle",e)}const N=T.get("weather");if(N){const e=N.cloneNode(!0);e.addEventListener("click",()=>{gi("reminders","üîî Reminders",Wc,"650px","85vh")}),N.replaceWith(e),T.set("weather",e)}const z=T.get("locker");if(z){const e=z.cloneNode(!0);e.addEventListener("click",()=>{gi("locker","üîí Locker",Oc,"650px","85vh")}),z.replaceWith(e),T.set("locker",e)}k("dashboard");const R=(t,n)=>{e.style.left=`${t}px`,e.style.top=`${n}px`,e.style.right="auto",e.style.bottom="auto"},L=m.get(Al,null);L&&Number.isFinite(L.left)&&Number.isFinite(L.top)&&R(L.left,L.top);const D=t=>{c.style.display=t?"none":"",i.textContent=t?"‚ñ≤":"‚ñº",a.setAttribute("aria-expanded",String(!t)),e.style.overflowY=t?"visible":"auto",m.set(Pl,t)};a.addEventListener("pointerdown",e=>{e.stopPropagation()}),a.addEventListener("click",e=>{e.stopPropagation();const t="none"===c.style.display;D(!t)}),D(!!m.get(Pl,!1));let B=!1,H=!1,j=null,G=0,W=0,O=!1;const _=(e,t,n)=>Math.min(Math.max(e,t),n),V=t=>{if(!B||j!==t.pointerId)return;const n=e.offsetWidth,o=e.offsetHeight,r=Math.max(8,window.innerWidth-n-8),a=Math.max(8,window.innerHeight-o-8),i=_(t.clientX-G,8,r),s=_(t.clientY-W,8,a),l=e.getBoundingClientRect();!H&&(Math.abs(i-l.left)>2||Math.abs(s-l.top)>2)&&(H=!0),R(i,s)},U=n=>{if(B&&j===n.pointerId){if(B=!1,window.removeEventListener("pointermove",V),window.removeEventListener("pointerup",U),window.removeEventListener("pointercancel",U),e.hasPointerCapture&&e.hasPointerCapture(n.pointerId))e.releasePointerCapture(n.pointerId);else try{e.releasePointerCapture(n.pointerId)}catch{}if(t.style.touchAction="",H){O=!0;const t=e.getBoundingClientRect();m.set(Al,{left:Math.round(t.left),top:Math.round(t.top)})}j=null,H=!1}};return t.addEventListener("pointerdown",n=>{const o=n.target;if(o&&o.closest("[data-qpm-collapse-button]"))return;if(!n.isPrimary)return;if("mouse"===n.pointerType){if(0!==n.button)return;if(1&~n.buttons)return}window.addEventListener("pointermove",V),window.addEventListener("pointerup",U),window.addEventListener("pointercancel",U),B=!0,H=!1,O=!1,j=n.pointerId;const r=e.getBoundingClientRect();G=n.clientX-r.left,W=n.clientY-r.top,e.setPointerCapture&&e.setPointerCapture(n.pointerId),t.style.touchAction="none",n.preventDefault()}),t.addEventListener("click",()=>{if(O)return void(O=!1);const e="none"===c.style.display;D(!e)}),document.body.appendChild(e),setFeedStatusCallback(e=>{!function(e){xl.status&&(xl.status.textContent=e);!function(e){"string"==typeof e&&(wl=e);const t=xl.dashboardFeedList,n=xl.dashboardFeedMeta;if(!t||!n)return;const o=("string"==typeof e?e:wl).trim();if(t.textContent="",n.textContent="",n.style.display="none",!o){const e=document.createElement("div");return e.textContent="Waiting for auto-feed...",e.style.cssText="font-size:11px;color:var(--qpm-text-muted)",void t.appendChild(e)}const r=o.split("|").map(e=>e.trim()).filter(Boolean),a=r.filter(e=>!/^(Waiting|No pets|Auto-feed disabled)/i.test(e)),i=r.filter(e=>/^(Waiting|No pets|Auto-feed disabled)/i.test(e));if(0===a.length){const e=document.createElement("div");return e.textContent=o,e.style.cssText="font-size:11px;color:var(--qpm-text-muted)",void t.appendChild(e)}a.forEach(e=>{const n=e.match(/^(.+?)\s*:\s*(.+)$/),o=n?.[1]?n[1].trim():e.trim(),r=n?.[2]??"",a=document.createElement("div");a.style.cssText="display:flex;justify-content:space-between;align-items:center;font-size:10px;color:var(--qpm-text);";const i=document.createElement("span");i.textContent=o,i.style.cssText="font-size:10px;";const s=document.createElement("span"),l=r.trim();if(s.textContent=l||"‚Äî",s.style.cssText="font-family:monospace;color:var(--qpm-text);font-size:10px;",/skip/i.test(l))s.style.color="#ffb74d";else{const e=l.match(/(\d+(?:\.\d+)?)/);if(e){const t=Number(e[1]);Number.isFinite(t)&&(s.style.color=t<=40?"#ef5350":t<=70?"#ffca28":"#81c784")}}a.append(i,s),t.appendChild(a)}),i.length>0&&(n.textContent=i.join(" | "),n.style.display="block")}(e)}(e),Ec()}),setWeatherStatusCallback(e=>{var t;t=e,xl.weatherStatus&&(xl.weatherStatus.textContent=`Current: ${t}`),Ec()}),xl.panel=e,xl.content=c,e}function gc(e){Fl.has(e)?Fl.delete(e):Fl.add(e),0===Fl.size?Pc(ql,!0):Pc(ql,!1);for(const[t,n]of Nl)Pc(n,Fl.has(t));vc(Il)}function hc(){Fl.clear(),Pc(ql,!0);for(const e of Nl.values())Pc(e,!1);wc()}function bc(e){Ll=e;try{m.set(Ml,e)}catch(t){console.warn("[qpm] failed to persist notification collapse state",t)}wc()}function yc(){const e=xl.notificationsDetailToggle;e&&(e.textContent=Dl?"Hide extra info":"Show extra info",e.classList.toggle("qpm-button--positive",Dl))}function xc(e){const t=xl.notificationsDetailMeta,n=xl.notificationsDetailActions,o=xl.notificationsDetailRaw;if(t&&n&&o)return e?void(Dl?(t.style.display="flex",n.style.display=n.childElementCount>0?"flex":"none",o.style.display="block"):(t.style.display="none",n.style.display="none",o.style.display="none")):(t.style.display="none",n.style.display="none",void(o.style.display="none"))}function wc(){const e=xl.notificationsFilterBar,t=xl.notificationsListWrapper,n=xl.notificationsEmpty,o=xl.notificationsDetail,r=xl.notificationsDetailToggle,a=xl.notificationsSection;a&&(a.dataset.collapsed=Ll?"true":"false");const i=Bl>0;e&&(e.style.display=Ll?"none":"flex"),t&&(t.style.display=Ll?"none":i?"block":"none"),n&&(n.style.display=Ll||i?"none":"block"),o&&(o.style.display=Ll?"none":Dl?"flex":"none"),r&&(r.style.display=Ll?"none":"inline-flex",r.disabled=!Rl,r.style.opacity=r.disabled?"0.6":"1")}function vc(e){Il=e;const t=xl.notificationsList,n=xl.notificationsEmpty;if(!t||!n)return;const o=Fl.size>0?e.filter(e=>Fl.has(e.feature)):e;Rl&&!o.some(e=>e.id===Rl)&&(Rl=null);const r=o.slice().reverse();if(Bl=r.length,r.length>0&&!Rl&&(Rl=r[0]?.id??null),t.textContent="",zl.clear(),0===r.length)return t.style.display="none",n.style.display="block",Sc(null),void wc();t.style.display="flex",n.style.display="none";for(const a of r){const e=Cc(a);zl.set(a.id,e),t.appendChild(e)}Tc();Sc(r.find(e=>e.id===Rl)??null),wc()}function Cc(e){const t=Sl[e.level]||Sl.info,n=kl[e.level]||kl.info,o=document.createElement("button");o.type="button",o.dataset.notificationId=e.id,o.dataset.accent=t,o.setAttribute("aria-pressed","false"),o.style.cssText=`\n    text-align: left;\n    background: linear-gradient(135deg, rgba(255,255,255,0.04), rgba(255,255,255,0.01));\n    border: 1px solid rgba(255,255,255,0.1);\n    border-left: 4px solid ${t};\n    border-radius: 8px;\n    padding: 12px 14px;\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    color: #f8f8f8;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    backdrop-filter: blur(8px);\n  `,o.addEventListener("click",()=>function(e){Rl=e.id,Tc(),Sc(e)}(e)),o.addEventListener("mouseenter",()=>{o.dataset.notificationId!==Rl&&(o.style.background="linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03))",o.style.borderColor="rgba(255,255,255,0.16)",o.style.transform="translateX(2px)")}),o.addEventListener("mouseleave",()=>{o.dataset.notificationId!==Rl&&(o.style.background="linear-gradient(135deg, rgba(255,255,255,0.04), rgba(255,255,255,0.01))",o.style.borderColor="rgba(255,255,255,0.1)",o.style.transform="none")});const r=document.createElement("div");r.style.cssText="display:flex;justify-content:space-between;align-items:center;gap:10px;";const a=document.createElement("div");a.style.cssText="display:flex;align-items:center;gap:8px;flex-wrap:wrap;flex:1;";const i=document.createElement("span");i.textContent=n,i.style.cssText=`\n    font-size: 16px;\n    line-height: 1;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    background: ${t}14;\n    border-radius: 6px;\n    flex-shrink: 0;\n  `,a.appendChild(i);const s=document.createElement("span");if(s.textContent=Mc(e.feature),s.style.cssText="\n    background: rgba(143,130,255,0.12);\n    padding: 3px 8px;\n    border-radius: 6px;\n    font-size: 11px;\n    color: #c7b8ff;\n    font-weight: 600;\n    letter-spacing: 0.3px;\n  ",a.appendChild(s),"warn"===e.level||"error"===e.level){const n=document.createElement("span");n.textContent=e.level.toUpperCase(),n.style.cssText=`\n      padding: 3px 8px;\n      border-radius: 6px;\n      background: ${t}20;\n      color: ${t};\n      font-size: 10px;\n      font-weight: 700;\n      letter-spacing: 0.5px;\n    `,a.appendChild(n)}const c=document.createElement("span");c.textContent=l(e.timestamp),c.title=new Date(e.timestamp).toLocaleString(),c.style.cssText="\n    font-size: 11px;\n    color: rgba(255,255,255,0.4);\n    white-space: nowrap;\n    flex-shrink: 0;\n    font-weight: 500;\n  ",r.append(a,c),o.appendChild(r);const d=e.message.length>160?`${e.message.slice(0,160)}‚Ä¶`:e.message,u=document.createElement("div");if(u.textContent=d,u.style.cssText="\n    font-size: 12px;\n    color: rgba(255,255,255,0.85);\n    line-height: 1.6;\n    margin-left: 36px;\n  ",o.appendChild(u),Array.isArray(e.actions)&&e.actions.length>0){const t=document.createElement("div");t.textContent=`‚ö° ${e.actions.length} quick action${e.actions.length>1?"s":""} available`,t.style.cssText="\n      font-size: 11px;\n      color: #90caf9;\n      margin-left: 36px;\n      font-weight: 500;\n    ",o.appendChild(t)}return o}function Tc(){for(const[e,t]of zl){const n=t.dataset.accent??Sl.info;e===Rl?(t.style.background=`linear-gradient(135deg, ${n}14, ${n}08)`,t.style.borderColor=`${n}`,t.style.borderLeftWidth="4px",t.style.boxShadow=`0 4px 12px ${n}30, inset 0 0 0 1px ${n}20`,t.style.transform="translateX(4px)",t.setAttribute("aria-pressed","true")):(t.style.background="linear-gradient(135deg, rgba(255,255,255,0.04), rgba(255,255,255,0.01))",t.style.borderColor="rgba(255,255,255,0.1)",t.style.borderLeftWidth="4px",t.style.boxShadow="none",t.style.transform="none",t.setAttribute("aria-pressed","false"))}}function Sc(e){const t=xl.notificationsDetailPlaceholder,n=xl.notificationsDetailHeader,o=xl.notificationsDetailTitle,r=xl.notificationsDetailTimestamp,a=xl.notificationsDetailMeta,i=xl.notificationsDetailMessage,s=xl.notificationsDetailActions,c=xl.notificationsDetailRaw;if(!(t&&n&&o&&r&&a&&i&&s&&c))return;if(!e)return t.style.display="block",n.style.display="none",i.style.display="none",a.style.display="none",s.style.display="none",c.style.display="none",c.textContent="",yc(),void wc();t.style.display="none",n.style.display="flex",i.style.display="block";const d=new Date(e.timestamp);if(o.textContent=`${Mc(e.feature)} ‚Äî ${e.level.toUpperCase()}`,o.title=e.message,r.textContent=`${l(e.timestamp)} ‚Ä¢ ${d.toLocaleString()}`,a.textContent="",a.appendChild(kc("ID",e.id)),a.appendChild(kc("Feature",Mc(e.feature))),a.appendChild(kc("Level",e.level.toUpperCase())),i.textContent=e.message,s.textContent="",Array.isArray(e.actions)&&e.actions.length>0)for(const l of e.actions){const e=document.createElement("button");e.type="button",e.textContent=l.label,e.className="qpm-button",e.style.fontSize="10px",e.addEventListener("click",()=>{try{l.onClick()}catch(e){console.error("[qpm] notification action error",e)}}),s.appendChild(e)}const u=Array.isArray(e.actions)?e.actions.map(({label:e})=>({label:e})):void 0,p={...e,actions:u};c.textContent=JSON.stringify(p,null,2),c.scrollTop=0,xc(e),yc(),wc()}function kc(e,t){const n=document.createElement("span");n.style.cssText="padding:2px 6px;border-radius:4px;background:rgba(255,255,255,0.08);color:#d7e3ff;display:inline-flex;gap:4px;align-items:center;";const o=document.createElement("span");o.textContent=`${e}:`,o.style.cssText="font-weight:600;color:#ffffff;",n.appendChild(o);const r=document.createElement("span");return r.textContent=t,n.appendChild(r),n}function Ac(e,t){const n=document.createElement("button");return n.type="button",n.textContent=e,n.className="qpm-button",n.style.fontSize="10px",n.addEventListener("click",t),n}function Pc(e,t){e&&(e.dataset.active=t?"true":"false",t?e.classList.add("qpm-button--positive"):e.classList.remove("qpm-button--positive"))}function Mc(e){return e?e.split(/[^a-zA-Z0-9]+/g).filter(Boolean).map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):"General"}function Ec(){if(!xl.headerAutoFeed||!xl.headerWeather||!xl.headerShop)return;let e=!!cc.enabled,t=vl,n=null;try{e=!!getAutoFeedConfig().enabled}catch{}try{const e=getAutoFeedState();"number"!=typeof e.feedCount||Number.isNaN(e.feedCount)||(t=e.feedCount)}catch{}try{n=getSessionStats()}catch{}const o=[];if(o.push(e?"On":"Off"),o.push(`${t} feeds`),n){const e=Number(n.feedsPerHour);if(Number.isFinite(e)){const t="events"===n.feedRateSource?"events":"model"===n.feedRateSource?"est.":"est";o.push(`${e.toFixed(1)}/h ${t}`)}}xl.headerAutoFeed.textContent=o.join(" ‚Ä¢ ");let r="Unknown",a="never",i="‚Äî";const s=[];try{const e=it();r=Fc(e.kind);const t=getWeatherSwapInfo();if(t.lastSwapAt){const e=l(t.lastSwapAt);a="‚Äî"===e?"just now":e}if(t.currentPreset)i=$c(t.currentPreset);else{i=`Next ${$c("weather"===e.raw?t.nextWeatherPreset:t.nextSunnyPreset)}`}const n=t.cooldownRemainingMs>0?`CD ${Math.ceil(t.cooldownRemainingMs/1e3)}s`:"";s.push(r,a,i),n&&s.push(n)}catch{s.push(r,a,i)}0===s.length&&s.push(r,a,i),xl.headerWeather.textContent=s.join(" ‚Ä¢ ");let c=Cl,d=0;try{const e=getShopStats();"number"==typeof e.totalPurchasedCount&&(c=e.totalPurchasedCount),"number"==typeof e.totalSpent&&(d=e.totalSpent)}catch{}const u=[`${c} items`,`ü™ô ${so(Math.max(0,Math.round(d)))}`];if(xl.headerShop.textContent=u.join(" ‚Ä¢ "),xl.headerMeta){const e=[];n?.uptime&&e.push(`‚è±Ô∏è ${n.uptime}`),xl.headerMeta.textContent=e.join(" ‚Ä¢ ")}}function $c(e){return e?e.charAt(0).toUpperCase()+e.slice(1):"‚Äî"}function Fc(e){return e?e.split(/[_\s]+/).filter(Boolean).map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):"Unknown"}function Ic(e){const t=Math.max(0,Math.floor(e)),n=Math.floor(t/1e3),o=Math.floor(n/3600),r=Math.floor(n%3600/60),a=n%60;return o>0?`${o}h ${r}m`:r>0?`${r}m ${a.toString().padStart(2,"0")}s`:`${a}s`}function qc(){Ra(),vl=0,Cl=0,Ec(),Uc("Stats reset")}function Nc(){const{root:e,body:t}=lc("üê¢ Bella's Turtle Temple",{subtitle:"Growth, eggs, and support breakdown"});e.dataset.qpmSection="turtle-timer";const n=oc(),o=document.createElement("div");o.style.cssText="display:flex;flex-wrap:wrap;gap:10px;align-items:center;";const r=document.createElement("button");r.type="button",r.className="qpm-chip",r.style.cssText="cursor:pointer;user-select:none;min-width:84px;text-align:center;",r.addEventListener("click",()=>{const e=!(cc.turtleTimer?.enabled??1);cc.turtleTimer={...oc(),enabled:e},Jc(),pa(e)}),o.appendChild(r),xl.turtleEnableButtons.push(r);const a=document.createElement("label");a.style.cssText="display:inline-flex;align-items:center;gap:6px;font-size:11px;color:#b2dfdb;";const i=document.createElement("input");i.type="checkbox",i.className="qpm-checkbox",i.checked=n.includeBoardwalk,i.addEventListener("change",()=>{const e=i.checked;cc.turtleTimer={...oc(),includeBoardwalk:e},Jc(),ua({includeBoardwalk:e})});const s=document.createElement("span");s.textContent="Include boardwalk tiles",a.append(i,s),o.appendChild(a),xl.turtleBoardwalkToggles.push(i);const l=document.createElement("label");l.style.cssText="display:inline-flex;align-items:center;gap:6px;font-size:11px;color:#b2dfdb;";const c=document.createElement("select");c.className="qpm-select",c.style.cssText="min-width:120px;padding:4px 8px;font-size:11px;",c.addEventListener("click",e=>e.stopPropagation());const d=document.createElement("option");d.value="latest",d.textContent="Latest finish";const u=document.createElement("option");u.value="earliest",u.textContent="Earliest finish";const p=document.createElement("option");p.value="specific",p.textContent="Specific plant",c.append(d,u,p),c.value=n.focus;const m=document.createElement("label");m.style.cssText="display:inline-flex;align-items:center;gap:6px;font-size:11px;color:#b2dfdb;",m.style.display="specific"===n.focus?"inline-flex":"none";const f=document.createElement("select");f.className="qpm-select",f.style.cssText="min-width:180px;padding:4px 8px;font-size:11px;",f.addEventListener("click",e=>e.stopPropagation()),c.addEventListener("change",()=>{const e=c.value,t="earliest"===e?"earliest":"specific"===e?"specific":"latest",n={...oc(),focus:t};cc.turtleTimer=n,Jc();const o={focus:t};"specific"===t&&(o.focusTargetTileId=n.focusTargetTileId,o.focusTargetSlotIndex=n.focusTargetSlotIndex),ua(o),m.style.display="specific"===t?"inline-flex":"none"});const g=document.createElement("span");g.textContent="Focus",l.append(g,c),o.appendChild(l),xl.turtleFocusSelects.push(c);const h=document.createElement("span");h.textContent="Target plant",m.append(h,f),o.appendChild(m),xl.turtleFocusTargetContainers.push(m),xl.turtleFocusTargetSelects.push(f),f.addEventListener("change",()=>{const{tileId:e,slotIndex:t}=jl(f.value),n={...oc(),focus:"specific",focusTargetTileId:e,focusTargetSlotIndex:t};cc.turtleTimer=n,Jc(),ua({focus:"specific",focusTargetTileId:e,focusTargetSlotIndex:t})});const b=document.createElement("label");b.style.cssText="display:inline-flex;align-items:center;gap:6px;font-size:11px;color:#bda7f5;";const y=document.createElement("select");y.className="qpm-select",y.style.cssText="min-width:120px;padding:4px 8px;font-size:11px;",y.addEventListener("click",e=>e.stopPropagation());const x=document.createElement("option");x.value="latest",x.textContent="Latest hatch";const w=document.createElement("option");w.value="earliest",w.textContent="Earliest hatch";const v=document.createElement("option");v.value="specific",v.textContent="Specific egg",y.append(x,w,v),y.value=n.eggFocus;const C=document.createElement("label");C.style.cssText="display:inline-flex;align-items:center;gap:6px;font-size:11px;color:#bda7f5;",C.style.display="specific"===n.eggFocus?"inline-flex":"none";const T=document.createElement("select");T.className="qpm-select",T.style.cssText="min-width:180px;padding:4px 8px;font-size:11px;",T.addEventListener("click",e=>e.stopPropagation()),y.addEventListener("change",()=>{const e=y.value,t="earliest"===e?"earliest":"specific"===e?"specific":"latest",n={...oc(),eggFocus:t};cc.turtleTimer=n,Jc();const o={eggFocus:t};"specific"===t&&(o.eggFocusTargetTileId=n.eggFocusTargetTileId,o.eggFocusTargetSlotIndex=n.eggFocusTargetSlotIndex),ua(o),C.style.display="specific"===t?"inline-flex":"none"});const S=document.createElement("span");S.textContent="Egg focus",b.append(S,y),o.appendChild(b),xl.turtleEggFocusSelects.push(y);const k=document.createElement("span");k.textContent="Target egg",C.append(k,T),o.appendChild(C),xl.turtleEggFocusTargetContainers.push(C),xl.turtleEggFocusTargetSelects.push(T),T.addEventListener("change",()=>{const{tileId:e,slotIndex:t}=jl(T.value),n={...oc(),eggFocus:"specific",eggFocusTargetTileId:e,eggFocusTargetSlotIndex:t};cc.turtleTimer=n,Jc(),ua({eggFocus:"specific",eggFocusTargetTileId:e,eggFocusTargetSlotIndex:t})}),t.appendChild(o);const A=document.createElement("div");A.style.cssText="font-size:10px;color:#9acccc;line-height:1.4;",A.textContent="Change your target plant's with Focus to display the estimated time to mature. The Egg Hatching section displays info on egg maturing. The Food Turtles section displays food drain and restore info.",t.appendChild(A);const P=(e,t)=>{const n=document.createElement("div");n.style.cssText=`padding:10px;border-radius:10px;border:1px solid ${t};background:rgba(10,20,20,0.35);display:flex;flex-direction:column;gap:6px;`;const o=document.createElement("div");o.style.cssText="display:flex;justify-content:space-between;align-items:center;gap:8px;";const r=document.createElement("div");r.style.cssText="font-weight:600;font-size:12px;color:#e0f7fa;",r.textContent=e;const a=document.createElement("div");a.style.cssText="font-size:11px;color:#c5e1a5;",o.append(r,a),n.appendChild(o);const i=document.createElement("div");i.style.cssText="font-size:11px;color:#dcedc8;",n.appendChild(i);const s=document.createElement("div");s.style.cssText="font-size:10px;color:#cfd8dc;",n.appendChild(s);const l=document.createElement("div");l.style.cssText="font-size:10px;color:#b2dfdb;line-height:1.4;",n.appendChild(l);const c=document.createElement("div");c.style.cssText="font-size:10px;color:#9acccc;",n.appendChild(c);const d=document.createElement("div");d.style.cssText="display:grid;grid-template-columns:1.4fr 0.7fr 0.6fr 0.8fr;gap:6px;font-size:10px;color:#80cbc4;text-transform:uppercase;letter-spacing:0.4px;",d.innerHTML="<span>Pet</span><span>Hunger</span><span>Boost</span><span>XP</span>",n.appendChild(d);const u=document.createElement("div");return u.style.cssText="display:flex;flex-direction:column;gap:2px;min-height:18px;",n.appendChild(u),{card:n,etaEl:a,summaryEl:i,totalsEl:s,simpleEl:l,luckEl:c,tableBody:u}},M=P("üå± Plant Growth","rgba(129,199,132,0.45)");t.appendChild(M.card),xl.turtlePlantEta=M.etaEl,xl.turtlePlantSummary=M.summaryEl,xl.turtlePlantTotals=M.totalsEl,xl.turtlePlantSimple=M.simpleEl,xl.turtlePlantLuck=M.luckEl,xl.turtlePlantTable=M.tableBody;const E=P("ü•ö Egg Hatching","rgba(179,157,219,0.45)");t.appendChild(E.card),xl.turtleEggEta=E.etaEl,xl.turtleEggSummary=E.summaryEl,xl.turtleEggTotals=E.totalsEl,xl.turtleEggSimple=E.simpleEl,xl.turtleEggLuck=E.luckEl,xl.turtleEggTable=E.tableBody;const $=document.createElement("div");$.style.cssText="padding:10px;border-radius:10px;border:1px solid rgba(255,224,130,0.45);background:rgba(30,24,12,0.4);display:flex;flex-direction:column;gap:6px;";const F=document.createElement("div");F.style.cssText="font-weight:600;font-size:12px;color:#ffe082;display:flex;justify-content:space-between;align-items:center;",F.textContent="üçΩÔ∏è Food Turtles",$.appendChild(F);const I=document.createElement("div");I.style.cssText="font-size:11px;color:#ffe9a6;",$.appendChild(I);const q=document.createElement("div");q.style.cssText="font-size:10px;color:#f6e7b5;",$.appendChild(q);const N=document.createElement("div");N.style.cssText="font-size:10px;color:#ffecb3;line-height:1.4;",$.appendChild(N);const z=document.createElement("div");z.style.cssText="display:flex;flex-direction:column;gap:4px;",$.appendChild(z),t.appendChild($),xl.turtleSupportSummary=I,xl.turtleSupportTotals=q,xl.turtleSupportSimple=N,xl.turtleSupportList=z;const R=document.createElement("div");R.style.cssText="padding:12px;border-radius:10px;border:1px solid rgba(100,181,246,0.45);background:linear-gradient(135deg, rgba(100,181,246,0.08), rgba(100,181,246,0.03));display:flex;flex-direction:column;gap:10px;";const L=document.createElement("div");L.style.cssText="font-weight:700;font-size:13px;color:#64b5f6;letter-spacing:0.3px;",L.textContent="‚è∞ Specified ETA Helper",R.appendChild(L);const D=document.createElement("div");D.style.cssText="font-size:10px;color:#90caf9;line-height:1.5;",D.textContent="Calculate how many watering cans you need to finish a plant by a specific time.",R.appendChild(D);const B=document.createElement("div");B.style.cssText="font-size:10px;color:#ffb74d;line-height:1.5;padding:6px;background:rgba(255,152,0,0.1);border-radius:4px;border-left:3px solid #ffb74d;margin-top:6px;",B.textContent="‚ö†Ô∏è Switch to your Plant Growth Turtles before you calculate!",B.title="Calculation uses your CURRENT turtle setup. Make sure you have Plant Growth boost turtles active if you want accurate watering can counts.",R.appendChild(B);const H=document.createElement("div");H.style.cssText="display:flex;flex-wrap:wrap;gap:10px;align-items:flex-end;",R.appendChild(H);const j=document.createElement("div");j.style.cssText="display:flex;flex-direction:column;gap:4px;";const G=document.createElement("label");G.style.cssText="font-size:10px;color:#b3e5fc;font-weight:600;",G.textContent="Target Date (DD/MM)";const W=document.createElement("input");W.type="text",W.className="qpm-input",W.placeholder="DD/MM",W.style.cssText="padding:6px 10px;font-size:11px;min-width:80px;max-width:80px;",W.addEventListener("keydown",e=>e.stopPropagation()),W.addEventListener("input",e=>{let t=W.value.replace(/\D/g,"");t.length>=2&&(t=t.slice(0,2)+"/"+t.slice(2,4)),W.value=t}),j.append(G,W),H.appendChild(j);const O=document.createElement("div");O.style.cssText="display:flex;flex-direction:column;gap:4px;";const _=document.createElement("label");_.style.cssText="font-size:10px;color:#b3e5fc;font-weight:600;",_.textContent="Target Time";const V=document.createElement("input");V.type="time",V.className="qpm-input",V.style.cssText="padding:6px 10px;font-size:11px;min-width:120px;",V.addEventListener("keydown",e=>e.stopPropagation()),O.append(_,V),H.appendChild(O);const U=document.createElement("div");U.style.cssText="display:flex;flex-direction:column;gap:4px;flex:1;min-width:180px;";const X=document.createElement("label");X.style.cssText="font-size:10px;color:#b3e5fc;font-weight:600;",X.textContent="Select Plant";const J=document.createElement("select");J.className="qpm-select",J.style.cssText="padding:6px 10px;font-size:11px;",J.addEventListener("click",e=>e.stopPropagation());const K=document.createElement("option");K.value="",K.textContent="Choose a growing plant...",K.disabled=!0,K.selected=!0,J.appendChild(K),U.append(X,J),H.appendChild(U);const Q=document.createElement("button");Q.type="button",Q.className="qpm-button qpm-button--accent",Q.textContent="Calculate",Q.style.cssText="padding:6px 16px;font-size:11px;font-weight:600;align-self:flex-end;",H.appendChild(Q);const Y=document.createElement("div");Y.style.cssText="display:none;flex-direction:column;gap:6px;padding:10px;background:rgba(10,20,30,0.5);border-radius:8px;border:1px solid rgba(100,181,246,0.2);",R.appendChild(Y);const Z=()=>{const e=fa(),t=Date.now(),n=J.value;for(;J.options.length>1;)J.remove(1);let o=0;for(const r of e.plantTargets)if(r.endTime&&r.endTime>t){const e=document.createElement("option");e.value=r.key,e.textContent=`${r.species||"Unknown"} - ${Gl(r.remainingMs||0)}`,e.dataset.endTime=String(r.endTime),e.dataset.species=r.species||"Unknown",J.appendChild(e),o++}if(0===o){const e=document.createElement("option");e.value="",e.textContent="No growing plants found",e.disabled=!0,J.appendChild(e)}if(n){Array.from(J.options).find(e=>e.value===n)&&(J.value=n)}};return Q.addEventListener("click",()=>{const e=J.selectedOptions[0];if(!e||!V.value||!W.value)return void(Y.style.display="none");const t=Number(e.dataset.endTime),n=e.dataset.species||"Unknown",o=Date.now(),r=W.value.split("/").map(Number),a=r[0],i=r[1];if(!a||!i||a<1||a>31||i<1||i>12)return Y.innerHTML='<div style="color:#ef5350;font-size:11px;">Invalid date! Use DD/MM format (e.g., 15/11)</div>',void(Y.style.display="flex");const s=V.value.split(":").map(Number),l=s[0]??0,c=s[1]??0,d=t-o,u=(new Date).getFullYear();let p=new Date(u,i-1,a,l,c,0,0);p.getTime()<o&&(p=new Date(u+1,i-1,a,l,c,0,0));const m=p.getTime(),f=Math.floor((m-o)/864e5),g=m-o;if(g<=0)return Y.innerHTML='<div style="color:#ef5350;font-size:11px;">Target time is in the past!</div>',void(Y.style.display="flex");const h=fa(),b=h.plant.effectiveRate||0,y=h.plant.adjustedMsRemaining,x=b>0&&y?y:d,w=b>0&&!!y&&y>0,v=Math.max(0,x-g),C=Math.ceil(v/3e5);Y.innerHTML="";const T=document.createElement("div");T.style.cssText="font-weight:700;font-size:11px;color:#64b5f6;margin-bottom:4px;",T.textContent=`Results for ${n}`,Y.appendChild(T);const S=document.createElement("div");S.style.cssText="font-size:10px;color:#e0e0e0;line-height:1.6;padding:6px;background:rgba(255,255,255,0.05);border-radius:4px;margin-bottom:4px;",S.innerHTML=w?`<strong style="color:#81c784;">üê¢ Current State (With Turtles):</strong> ${Gl(x)} ‚Ä¢ ${rc(x)}`:`<strong style="color:#90caf9;">Current State (No Turtles):</strong> ${Gl(x)} ‚Ä¢ ${rc(x)}`,Y.appendChild(S);const k=document.createElement("div");k.style.cssText="font-size:10px;color:#e0e0e0;line-height:1.6;";const A=0===f?"today":1===f?"tomorrow":`in ${f} days`,P=`${W.value} ${V.value}`;k.innerHTML=`<strong style="color:#ffb74d;">Target:</strong> ${P} (${A}) ‚Ä¢ ${Gl(g)} from now`,Y.appendChild(k);const M=document.createElement("div");if(M.style.cssText="font-size:11px;color:#fff;font-weight:700;padding:8px;background:rgba(100,181,246,0.15);border-radius:6px;margin-top:4px;",0===C)M.innerHTML=`‚úÖ <span style="color:#81c784;">No watering cans needed!</span><br><span style="font-size:10px;font-weight:400;color:#b0b0b0;">Plant will finish ${Gl(Math.abs(v))} before target time.</span>`;else{const e=w?"(based on current turtle boost)":"(no turtle boost applied)";M.innerHTML=`üíß <span style="color:#64b5f6;">Watering Cans Needed: ${C}</span><br><span style="font-size:10px;font-weight:400;color:#b0b0b0;">Each can saves 5 minutes ${e}</span>`}Y.appendChild(M),Y.style.display="flex"}),ga(()=>{Z()}),Z(),t.appendChild(R),ic(fa()),e}let zc={groups:[],totals:{xpPerHour:0,plantMinutesPerHour:0,eggMinutesPerHour:0,coinsPerHour:0},unknown:[]},Rc=[];const Lc={detailedView:!1,filterCoinOnly:!1,selectedAbilities:[]};let Dc={...Lc};function Bc(e,t,n,o){const r=document.createElement("div");r.style.cssText="display: flex; align-items: center; gap: 10px; padding: 8px; background: rgba(0, 0, 0, 0.2); border-radius: 4px;";const a=document.createElement("div");a.style.cssText="flex: 1; display: flex; flex-direction: column; gap: 2px;";const i=document.createElement("div");i.textContent=e,i.style.cssText="font-size: 12px; color: rgba(255, 255, 255, 0.9); font-weight: 500;",a.appendChild(i);const s=document.createElement("div");s.textContent=t,s.style.cssText="font-size: 11px; color: rgba(255, 255, 255, 0.6);",a.appendChild(s),r.appendChild(a);const l=document.createElement("button");l.style.cssText=`\n    width: 48px;\n    height: 24px;\n    border-radius: 12px;\n    border: none;\n    cursor: pointer;\n    position: relative;\n    transition: background 0.2s;\n    background: ${n?"var(--qpm-accent)":"rgba(255, 255, 255, 0.2)"};\n  `;const c=document.createElement("div");c.style.cssText=`\n    width: 18px;\n    height: 18px;\n    border-radius: 50%;\n    background: white;\n    position: absolute;\n    top: 3px;\n    left: ${n?"27px":"3px"};\n    transition: left 0.2s;\n  `,l.appendChild(c);let d=n;return l.addEventListener("click",()=>{d=!d,l.style.background=d?"var(--qpm-accent)":"rgba(255, 255, 255, 0.2)",c.style.left=d?"27px":"3px",o(d)}),r.appendChild(l),r}function Hc(e){const t=m.get("qpm-tracker-settings");t&&(Dc={...Lc,...t}),e.style.cssText="display: flex; flex-direction: column; gap: 12px; min-width: 900px; max-width: 1200px;";const n=document.createElement("div");n.style.cssText="\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 12px 16px;\n    background: var(--qpm-surface-2);\n    border-radius: 6px;\n    border: 1px solid var(--qpm-border);\n  ";const o=document.createElement("div");o.className="tracker-summary",o.style.cssText="font-size: 13px; color: var(--qpm-text); font-weight: 500;",o.textContent="Loading pet data...",n.appendChild(o);const r=document.createElement("div");r.className="tracker-settings-panel",r.style.cssText="display: none;";const a=document.createElement("button");a.className="qpm-button qpm-button--secondary",a.textContent="‚öôÔ∏è Filters",a.style.cssText="padding: 6px 12px; font-size: 12px;",a.title="Show filter options",a.addEventListener("click",()=>{const e="none"===r.style.display;r.style.display=e?"":"none",a.textContent=e?"‚öôÔ∏è Hide Filters":"‚öôÔ∏è Filters"}),n.appendChild(a),e.appendChild(n),r.style.cssText="\n    display: none;\n    padding: 16px;\n    background: var(--qpm-surface-2);\n    border-radius: 6px;\n    border: 1px solid var(--qpm-border);\n    margin-bottom: 12px;\n    gap: 16px;\n  ";const i=document.createElement("div");i.textContent="‚öôÔ∏è Display Options",i.style.cssText="font-weight: 600; color: var(--qpm-accent); margin-bottom: 12px; font-size: 13px;",r.appendChild(i);const l=document.createElement("div");l.style.cssText="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;";const c=Bc("üìä Detailed View","Show additional statistics and context",Dc.detailedView,e=>{Dc.detailedView=e,m.set("qpm-tracker-settings",Dc),jc({summaryText:o,tbody:x,footer:w,abilityCheckboxGrid:f})});l.appendChild(c);const d=Bc("üí∞ Coin Abilities Only","Show only coin-generating abilities",Dc.filterCoinOnly,e=>{Dc.filterCoinOnly=e,m.set("qpm-tracker-settings",Dc),jc({summaryText:o,tbody:x,footer:w,abilityCheckboxGrid:f})});l.appendChild(d);const u=document.createElement("div");u.className="ability-filter-container",u.style.cssText="grid-column: 1 / -1; display: flex; flex-direction: column; gap: 8px;";const p=document.createElement("div");p.textContent="‚ú® Filter by Ability",p.style.cssText="font-size: 12px; color: rgba(255, 255, 255, 0.9); font-weight: 500;",u.appendChild(p);const f=document.createElement("div");f.className="ability-checkbox-grid",f.style.cssText="\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));\n    gap: 6px;\n    max-height: 200px;\n    overflow-y: auto;\n    padding: 8px;\n    background: rgba(0, 0, 0, 0.2);\n    border-radius: 4px;\n  ",u.appendChild(f),l.appendChild(u),r.appendChild(l),e.appendChild(r);const g=document.createElement("div");g.style.cssText="\n    overflow-x: auto;\n    background: var(--qpm-surface-1);\n    border-radius: 6px;\n    border: 1px solid var(--qpm-border);\n    max-height: 60vh;\n    overflow-y: auto;\n  ";const h=document.createElement("table");h.className="tracker-detail-table",h.style.cssText="\n    width: 100%;\n    border-collapse: collapse;\n    font-size: 12px;\n  ";const b=h.createTHead();b.style.cssText="position: sticky; top: 0; z-index: 10; background: var(--qpm-surface-1);";const y=b.insertRow();y.style.cssText="\n    background: var(--qpm-surface-2);\n    border-bottom: 2px solid var(--qpm-border);\n  ";[{text:"üêæ Pet",tooltip:"Pet name or species"},{text:"‚ú® Ability",tooltip:"Pet ability name"},{text:"üé≤ Chance %",tooltip:"Calculated proc chance per minute (baseProbability √ó STR)"},{text:"‚ö° Procs/Hr",tooltip:"Expected procs per hour"},{text:"üí∞ Per Proc",tooltip:"Coins earned per successful proc"},{text:"üí∏ Per Hour",tooltip:"Total coins per hour from this ability"},{text:"‚è±Ô∏è Next ETA",tooltip:"Live countdown to next expected proc"}].forEach(({text:e,tooltip:t})=>{const n=document.createElement("th");n.textContent=e,n.title=t,n.style.cssText="\n      padding: 10px 12px;\n      text-align: left;\n      font-weight: 600;\n      color: var(--qpm-accent);\n      white-space: nowrap;\n      border-bottom: 1px solid var(--qpm-border);\n      cursor: help;\n    ",y.appendChild(n)});const x=h.createTBody();x.className="tracker-tbody",g.appendChild(h),e.appendChild(g);const w=document.createElement("div");w.className="tracker-footer",w.style.cssText="\n    padding: 12px 16px;\n    background: var(--qpm-surface-2);\n    border-radius: 6px;\n    border: 1px solid var(--qpm-border);\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--qpm-accent);\n  ",w.textContent="Total: Loading...",e.appendChild(w);const v={root:e,summaryText:o,tbody:x,footer:w,abilityCheckboxGrid:f,updateInterval:null};wr(e=>{Rc=e,zc=function(e){if(!e.length)return{groups:[],totals:{xpPerHour:0,plantMinutesPerHour:0,eggMinutesPerHour:0,coinsPerHour:0},unknown:[]};const t=ni(),n=new Map,o=new Map,r=[];if(e.forEach((e,a)=>{const i=Array.isArray(e.abilities)?e.abilities:[];for(const s of i){if(!s)continue;const i=Wa(s);if(!i){r.push({abilityName:s,pet:e});continue}if("continuous"!==i.trigger)continue;const l=_a(i,e.strength),c=Yl(e,i.id),d=c?tc(c,i):null,u="number"==typeof e.strength&&Number.isFinite(e.strength)?e.strength:null,p=`${i.id}::${null!=u?u.toFixed(2):"baseline"}`;let m=n.get(p);void 0===m&&(m=ai(i.id,t,u),n.set(p,m??null));const f=d?.procsPerHour??null,g=null!=f&&f>0?f:l.procsPerHour,h=null!=f&&f>0?"observed":"estimated",b=d?.effectPerProc??null,y=m?.effectPerProc??null,x=i.effectValuePerProc??null;let w=null,v="definition",C=m?.detail??null;null!=b&&b>0?(w=b,v="observed",C=d?.sampleCount?`Observed average from ${d.sampleCount} recent sample${1===d.sampleCount?"":"s"}.`:"Observed from ability log."):null!=y&&y>0?(w=y,v="computed"):null!=x&&x>0&&(w=x,v="definition",C=i.notes??null);const T=null!=w&&g>0?g*w:Va(i,l),S=d?.lastProcAt??c?.lastPerformedAt??null,k=d?.sampleCount??0,A={pet:e,petIndex:a,displayName:nc(e),abilityName:s,definition:i,procsPerHour:g,procsPerHourSource:h,chancePerMinute:l.chancePerMinute,expectedMinutesBetween:g>0?60/g:null,lastProcAt:S,sampleCount:k,effectPerProc:w,effectSource:v,effectDetail:C,effectPerHour:T},P=i.id,M=o.get(P);M?(M.entries.push(A),M.totalProcsPerHour+=g,M.effectPerHour+=T,M.totalSamples+=k,(null==M.lastProcAt||null!=S&&S>M.lastProcAt)&&(M.lastProcAt=S)):o.set(P,{definition:i,entries:[A],totalProcsPerHour:g,chancePerMinute:g/60,combinedEtaMinutes:g>0?60/g:null,effectPerHour:T,totalSamples:k,lastProcAt:S,averageEffectPerProc:w})}}),0===o.size&&0===r.length)return{groups:[],totals:{xpPerHour:0,plantMinutesPerHour:0,eggMinutesPerHour:0,coinsPerHour:0},unknown:[]};const a={xpPerHour:0,plantMinutesPerHour:0,eggMinutesPerHour:0,coinsPerHour:0};return{groups:Array.from(o.values()).map(e=>{switch(e.chancePerMinute=e.entries.reduce((e,t)=>e+t.chancePerMinute,0),e.combinedEtaMinutes=e.totalProcsPerHour>0?60/e.totalProcsPerHour:null,e.averageEffectPerProc=e.totalProcsPerHour>0?e.effectPerHour/e.totalProcsPerHour:null,e.definition.category){case"xp":a.xpPerHour+=e.effectPerHour;break;case"plantGrowth":a.plantMinutesPerHour+=e.effectPerHour;break;case"eggGrowth":a.eggMinutesPerHour+=e.effectPerHour;break;case"coins":a.coinsPerHour+=e.effectPerHour}return e}).sort((e,t)=>t.totalProcsPerHour-e.totalProcsPerHour),totals:a,unknown:r}}(e),jc(v)}),jc(v),v.updateInterval=window.setInterval(()=>{!function(e){const t=e.querySelectorAll(".eta-countdown");t.forEach(e=>{if(!(e instanceof HTMLElement))return;const t=parseInt(e.dataset.lastProc||"0",10),n=parseFloat(e.dataset.effectiveRate||"0"),o=e.dataset.normalColor||"var(--qpm-positive)";if(!t||!n||0===t||0===n)return;const r=ki(t,n>0?60/n:null,n);e.textContent=r.text,e.style.color=r.isOverdue?"var(--qpm-danger)":o})}(v.tbody)},1e3);const C=new MutationObserver(()=>{document.body.contains(e)||(null!==v.updateInterval&&clearInterval(v.updateInterval),C.disconnect(),s("Tracker window cleanup: interval cleared"))});C.observe(document.body,{childList:!0,subtree:!0}),s("Trackers window rendered with live updates")}function jc(e){const t=zc,n=Rc;!function(e,t){const n=t.groups.map(e=>({id:e.definition.id,name:e.definition.name,count:e.entries.length})),o=n.map(e=>e.id).sort().join(",");if(o===(e.dataset.abilityIds||"")&&e.children.length>0)return;if(e.dataset.abilityIds=o,e.innerHTML="",0===n.length){const t=document.createElement("div");return t.textContent="No abilities available",t.style.cssText="padding: 8px; color: rgba(255, 255, 255, 0.5); font-size: 11px;",void e.appendChild(t)}const r=document.createElement("div");r.style.cssText="display: flex; align-items: center; gap: 8px;";const a=document.createElement("span");a.textContent="Filter Ability:",a.style.cssText="font-size: 12px; color: var(--qpm-text-muted);",r.appendChild(a);const i=document.createElement("select");i.className="qpm-select",i.style.cssText="flex: 1; min-width: 200px; padding: 6px 8px; font-size: 12px;";const s=document.createElement("option");s.value="",s.textContent="All abilities",i.appendChild(s),n.forEach(({id:e,name:t,count:n})=>{const o=document.createElement("option");o.value=e,o.textContent=`${t} (${n})`,i.appendChild(o)}),1===Dc.selectedAbilities.length?i.value=Dc.selectedAbilities[0]||"":i.value="",i.addEventListener("change",()=>{""===i.value?Dc.selectedAbilities=[]:Dc.selectedAbilities=[i.value],m.set("qpm-tracker-settings",Dc),jc({summaryText:e.closest(".qpm-modal-window")?.querySelector(".tracker-summary"),tbody:e.closest(".qpm-modal-window")?.querySelector(".tracker-tbody"),footer:e.closest(".qpm-modal-window")?.querySelector(".tracker-footer"),abilityCheckboxGrid:e})}),r.appendChild(i),e.appendChild(r)}(e.abilityCheckboxGrid,t);const o=new Map,r=new Map;if(e.tbody.querySelectorAll('.eta-countdown[data-is-estimate="true"]').forEach(e=>{if(!(e instanceof HTMLElement))return;const t=e.dataset.lastProc,n=e.closest("tr"),a=n?.dataset.petIndex,i=n?.dataset.abilityId,s="true"===n?.dataset.isGroupRow;if(t&&i)if(s){const e=`group:${i}`;r.set(e,parseInt(t,10))}else if(void 0!==a){const e=`${a}:${i}`;o.set(e,parseInt(t,10))}}),e.tbody.innerHTML="",0===t.groups.length){const t=e.tbody.insertRow().insertCell();return t.colSpan=7,t.style.cssText="padding: 40px; text-align: center; color: rgba(255, 255, 255, 0.5);",t.innerHTML='\n      <div style="font-size: 48px; margin-bottom: 12px;">üê¢</div>\n      <div style="font-size: 14px; font-weight: 600; margin-bottom: 6px;">No Active Pet Abilities</div>\n      <div style="font-size: 12px; opacity: 0.7;">Make sure pets are active and assigned in your garden</div>\n    ',e.footer.textContent="üìä Total: No data",void(e.summaryText.textContent="üêæ No Active Pets")}let a=t.groups;Dc.filterCoinOnly&&(a=a.filter(e=>"coins"===e.definition.effectUnit||"coins"===e.definition.category)),Dc.selectedAbilities.length>0&&(a=a.filter(e=>Dc.selectedAbilities.includes(e.definition.id)));const i=n.length,s=t.groups.length,l=a.length,c=a.filter(e=>"coins"===e.definition.effectUnit||"coins"===e.definition.category).length;let d=[`üêæ ${i} Active Pet${1!==i?"s":""}`];Dc.filterCoinOnly||Dc.selectedAbilities.length>0?d.push(`üìä ${l}/${s} Abilities (filtered)`):d.push(`üìä ${s} Abilit${1!==s?"ies":"y"}`),c>0&&d.push(`üí∞ ${c} Coin-Generating`),e.summaryText.textContent=d.join(" ‚Ä¢ ");let u=0,p=0,f=0,g=0;if(0===a.length){const t=e.tbody.insertRow().insertCell();return t.colSpan=7,t.style.cssText="padding: 40px; text-align: center; color: rgba(255, 255, 255, 0.5);",t.innerHTML='\n      <div style="font-size: 48px; margin-bottom: 12px;">üîç</div>\n      <div style="font-size: 14px; font-weight: 600; margin-bottom: 6px;">No Abilities Match Filter</div>\n      <div style="font-size: 12px; opacity: 0.7;">Try adjusting your filter settings above</div>\n    ',void(e.footer.innerHTML="<strong>üìä Total:</strong> 0 abilities (filtered)")}const h=a.filter(e=>"coins"===e.definition.effectUnit||"coins"===e.definition.category),b=a.filter(e=>"coins"!==e.definition.effectUnit&&"coins"!==e.definition.category);if([...h,...b].forEach(t=>{for(const n of t.entries){Ai(n,t.definition.name,e.tbody,Dc.detailedView,o);const{effective:r}=Si(n.procsPerHour,n.definition.id),a=r*(n.effectPerProc??0);u+=r,p+=n.chancePerMinute,("coins"===t.definition.effectUnit||"coins"===t.definition.category)&&n.effectPerProc&&n.effectPerProc>0&&(f+=a),g++}!function(e,t,n=!1,o){if(e.entries.length<2){const e=t.rows.length-1;return e>=0?t.rows[e]??null:null}const r=t.insertRow();r.style.cssText="\n    border-bottom: 2px solid var(--qpm-border);\n    background: var(--qpm-surface-2);\n    font-weight: 600;\n  ",r.dataset.isGroupRow="true",r.dataset.abilityId=e.definition.id;const a=r.insertCell();a.textContent=`üìä Total (${e.entries.length})`,a.style.cssText="\n    padding: 10px 12px;\n    color: var(--qpm-accent);\n    font-weight: 600;\n    white-space: nowrap;\n  ";const i=r.insertCell();i.textContent=e.definition.name,i.style.cssText="\n    padding: 10px 12px;\n    color: var(--qpm-accent);\n    white-space: nowrap;\n  ";const s=r.insertCell();s.textContent=`${e.chancePerMinute.toFixed(2)}%/min`,s.style.cssText="\n    padding: 10px 12px;\n    text-align: right;\n    color: var(--qpm-accent);\n    font-family: monospace;\n    white-space: nowrap;\n    font-weight: 600;\n  ",s.title=`Combined chance from ${e.entries.length} pets`;const l=r.insertCell();l.textContent=e.totalProcsPerHour.toFixed(2),l.style.cssText="\n    padding: 10px 12px;\n    text-align: right;\n    color: var(--qpm-accent);\n    font-family: monospace;\n    font-weight: 600;\n  ",l.title=`Combined procs/hour from ${e.entries.length} pets`;const c=r.insertCell(),d=e.averageEffectPerProc??0,u=n?so:lo;c.textContent=d>0?u(d):"‚Äî",c.style.cssText=`\n    padding: 10px 12px;\n    text-align: right;\n    color: ${d>0?"var(--qpm-warning)":"var(--qpm-text-muted)"};\n    font-family: monospace;\n    font-weight: 600;\n  `,d>0&&(c.title=n?"Average coins per proc":`Exact: ${so(d)}`);const p=r.insertCell(),m=e.effectPerHour;p.textContent=m>0?u(m):"‚Äî",p.style.cssText=`\n    padding: 10px 12px;\n    text-align: right;\n    color: ${m>0?"var(--qpm-warning)":"var(--qpm-text-muted)"};\n    font-family: monospace;\n    font-weight: 600;\n  `,m>0&&(p.title=n?`Combined coins/hour from ${e.entries.length} pets`:`Exact: ${so(m)}/hr`);const f=r.insertCell();f.className="eta-countdown";const g=e.totalProcsPerHour>0?60/e.totalProcsPerHour:0;if(e.totalProcsPerHour>0){let t,n;if(e.lastProcAt&&e.lastProcAt>0)t=e.lastProcAt,n=!1;else{const r=`group:${e.definition.id}`,a=o?.get(r);t=a||Date.now(),n=!0}f.dataset.lastProc=String(t),f.dataset.effectiveRate=String(e.totalProcsPerHour),f.dataset.normalColor="var(--qpm-accent)",f.dataset.isEstimate=n?"true":"false";const r=ki(t,e.combinedEtaMinutes,e.totalProcsPerHour);f.textContent=r.text,f.style.cssText=`\n      padding: 10px 12px;\n      text-align: right;\n      color: ${r.isOverdue?"var(--qpm-danger)":"var(--qpm-accent)"};\n      font-family: monospace;\n      font-weight: 600;\n      white-space: nowrap;\n    `,f.title=n?`Estimated ${g.toFixed(1)} minutes between procs\nNo proc history yet`:`Combined average: ${g.toFixed(1)} minutes between procs\nLast proc: ${new Date(e.lastProcAt).toLocaleTimeString()}`}else f.textContent="‚Äî",f.style.cssText="\n      padding: 10px 12px;\n      text-align: right;\n      color: var(--qpm-text-muted);\n      font-family: monospace;\n      font-weight: 600;\n      white-space: nowrap;\n    ",f.title="No proc rate available"}(t,e.tbody,Dc.detailedView,r)}),g>0){const t=e.tbody.insertRow();t.style.cssText="\n      background: var(--qpm-surface-2);\n      border-top: 2px solid var(--qpm-border);\n      font-weight: 600;\n      position: sticky;\n      bottom: 0;\n      z-index: 5;\n    ";const n=t.insertCell();n.textContent="üìä TOTAL",n.colSpan=2,n.style.cssText="padding: 12px; color: var(--qpm-accent); font-weight: 700; font-size: 13px; text-transform: uppercase;";const o=t.insertCell();o.textContent=`${p.toFixed(2)}%/min`,o.style.cssText="padding: 12px; text-align: right; color: var(--qpm-accent); font-family: monospace;";const r=t.insertCell();r.textContent=u.toFixed(2),r.style.cssText="padding: 12px; text-align: right; color: var(--qpm-accent); font-family: monospace;";const a=t.insertCell();a.textContent="‚Äî",a.style.cssText="padding: 12px; text-align: right; color: rgba(255, 255, 255, 0.5);";const i=t.insertCell();i.textContent=so(f),i.style.cssText="padding: 12px; text-align: right; color: #ffa500; font-family: monospace; font-weight: 700; font-size: 14px;";const s=t.insertCell();s.textContent="‚Äî",s.style.cssText="padding: 12px; text-align: right; color: rgba(255, 255, 255, 0.5);";const l=h.reduce((e,t)=>e+t.entries.length,0),c=[`<strong>üìä Total:</strong> ${g} abilit${1!==g?"ies":"y"}`];if(l>0){let e=0;for(const t of h)for(const n of t.entries){const o=Da(t.definition.id,{petId:n.pet.petId,slotId:n.pet.slotId,slotIndex:"number"==typeof n.pet.slotIndex&&Number.isFinite(n.pet.slotIndex)?n.pet.slotIndex:null,fallbackKeys:[]});if(o){const n=Zl(o);for(const o of n){const n=ec(t.definition,o);null!=n&&Number.isFinite(n)&&n>0&&(e+=n)}}}e>0?c.push(`<span style="color: #ffd700;">üí∞ ${so(e)} earned</span>`):c.push(`<span style="color: #ffd700;">üí∞ ${l} coin</span>`)}f>0&&c.push(`<span style="color: #ffa500; font-size: 14px; font-weight: 700;">üí∏ ${so(f)}/hr</span>`),u>0&&c.push(`<span style="color: var(--qpm-accent); font-size: 12px;">‚ö° ${u.toFixed(1)} procs/hr</span>`),e.footer.innerHTML=c.join(" ‚Ä¢ ")}}function Gc(e){e.style.cssText="display: flex; flex-direction: column; gap: 16px; min-width: 600px;";const t=Nc();t.style.margin="0",e.appendChild(t)}function Wc(e){e.style.cssText="display: flex; flex-direction: column; gap: 16px; min-width: 600px;";const t=Vc();t.style.margin="0",e.appendChild(t)}function Oc(e){e.style.cssText="display: flex; flex-direction: column; gap: 16px; min-width: 600px;";const t=_c(!1!==Se().syncModeEnabled);t.style.margin="0",e.appendChild(t)}function _c(e){const t=document.createElement("span");t.className="qpm-chip",t.textContent=e?"Sync Mode":"Basic Mode";const{root:n,body:o}=lc("üîí Inventory Locker",{collapsible:!0,startCollapsed:!0,subtitleElement:t});n.dataset.qpmSection="inventory-locker";const r=document.createElement("div");r.className="qpm-section-muted",r.style.marginBottom="8px";const a=e=>{r.textContent=e?"Unlock keeps manual favorites; only locker-added favorites are removed.":"Unlock toggles every favorite for the selected crop species.",t.textContent=e?"Sync Mode":"Basic Mode"};a(e),o.appendChild(r);const i=document.createElement("div");i.innerHTML="üí° <strong>How it works:</strong><br>‚Ä¢ Open inventory to lock species<br>‚Ä¢ Locked species are favorited automatically<br>‚Ä¢ Sync mode preserves manual favorites<br>‚Ä¢ Basic mode toggles all favorites",i.style.cssText="background:#333;padding:8px;border-radius:4px;margin-bottom:8px;font-size:10px;line-height:1.5;border-left:3px solid #FFCA28",o.appendChild(i);const s=function(e,t,n){const o=document.createElement("label");o.style.cssText="display:flex;align-items:center;gap:8px;margin-bottom:6px;font-size:11px;color:#ddd";const r=document.createElement("input");r.type="checkbox",r.checked=t,r.style.cssText="width:14px;height:14px;cursor:pointer",r.addEventListener("click",e=>e.stopPropagation()),r.addEventListener("change",()=>{n(r.checked)});const a=document.createElement("span");return a.textContent=e,a.style.cssText="flex:1",o.append(r,a),o.addEventListener("click",e=>e.stopPropagation()),o}("Sync mode (preserve manual favorites)",e,e=>{cc.inventoryLocker?cc.inventoryLocker.syncMode=e:cc.inventoryLocker={syncMode:e},ke(e),Jc(),a(e),Uc(e?"Inventory locker sync mode enabled":"Inventory locker sync mode disabled")});o.appendChild(s);const l=document.createElement("div");return l.textContent="Tip: open inventory to lock species. Sync mode avoids unfavoriting crops you already starred.",l.style.cssText="font-size:10px;color:#A5D6A7;line-height:1.4;margin-top:8px;",o.appendChild(l),n}function Vc(){const e=document.createElement("span");e.className="qpm-chip",e.textContent=cc.mutationReminder?.enabled?"Enabled":"Disabled";const{root:t,body:n}=lc("üß¨ Mutation Reminder",{collapsible:!0,startCollapsed:!0,subtitleElement:e});t.dataset.qpmSection="mutation-reminder";const o=document.createElement("div");o.textContent="Monitoring weather...",o.className="qpm-section-muted",n.appendChild(o);const r=document.createElement("div");r.innerHTML="üí° <strong>How it works:</strong><br>‚Ä¢ Detects weather events (Rain/Snow/Dawn/Amber)<br>‚Ä¢ Scans your plant inventory for mutations (F/W/C/D/A)<br>‚Ä¢ Notifies which plants to place for mutations<br>‚Ä¢ Example: Wet plant + Snow ‚Üí Frozen mutation!",r.style.cssText="background:#333;padding:8px;border-radius:4px;font-size:10px;line-height:1.5;border-left:3px solid #9C27B0",n.appendChild(r);const a=Xc(cc.mutationReminder?.enabled?"‚úì Reminders Enabled":"‚úó Reminders Disabled",async()=>{if(!cc.mutationReminder)return;cc.mutationReminder.enabled=!cc.mutationReminder.enabled,a.textContent=cc.mutationReminder.enabled?"‚úì Reminders Enabled":"‚úó Reminders Disabled",a.classList.toggle("qpm-button--positive",cc.mutationReminder.enabled),a.classList.toggle("qpm-button--accent",cc.mutationReminder.enabled),e.textContent=cc.mutationReminder.enabled?"Enabled":"Disabled",Jc();const{setMutationReminderEnabled:t}=await Promise.resolve().then(()=>vn);t(cc.mutationReminder.enabled)});a.style.width="100%",cc.mutationReminder?.enabled&&a.classList.add("qpm-button--positive","qpm-button--accent"),n.appendChild(a);const i=Xc("üîç Check Now",async()=>{i.disabled=!0,i.textContent="‚è≥ Checking...";try{const{checkForMutations:e}=await Promise.resolve().then(()=>vn);await e(),i.textContent="‚úÖ Done!",setTimeout(()=>{i.textContent="üîç Check Now",i.disabled=!1},2e3)}catch(e){i.textContent="‚ùå Error",s("Error checking mutations:",e),setTimeout(()=>{i.textContent="üîç Check Now",i.disabled=!1},2e3)}});i.style.width="100%",i.style.background="#9C27B0",i.title="Manually check for mutation opportunities",n.appendChild(i);const l=document.createElement("div");l.style.cssText="margin-top:8px;padding:8px;background:#2a1a3a;border-radius:4px;border:1px dashed #9C27B0";const c=document.createElement("div");c.textContent="üß™ Debug: Simulate Weather",c.style.cssText="font-size:10px;color:#aaa;margin-bottom:6px;font-weight:bold";const d=document.createElement("div");d.style.cssText="display:grid;grid-template-columns:1fr 1fr;gap:4px";const u=[{emoji:"üåßÔ∏è",name:"Rain",type:"rain"},{emoji:"‚ùÑÔ∏è",name:"Snow",type:"snow"},{emoji:"üåÖ",name:"Dawn",type:"dawn"},{emoji:"üåÜ",name:"Amber",type:"amber"}];for(const p of u){const e=Xc(`${p.emoji} ${p.name}`,async()=>{e.disabled=!0;try{const{simulateWeather:t}=await Promise.resolve().then(()=>vn);await t(p.type),e.textContent=`‚úÖ ${p.name}`,setTimeout(()=>{e.textContent=`${p.emoji} ${p.name}`,e.disabled=!1},2e3)}catch(t){s("Error simulating weather:",t),e.textContent=`‚ùå ${p.name}`,setTimeout(()=>{e.textContent=`${p.emoji} ${p.name}`,e.disabled=!1},2e3)}});e.style.cssText="padding:4px 8px;font-size:10px;background:#333;border:1px solid #555",e.title=`Simulate ${p.name} weather for testing`,d.appendChild(e)}return l.append(c,d),n.appendChild(l),xl.mutationStatus=o,t}function Uc(e){!function(){if(document.getElementById($l))return;const e=document.createElement("style");e.id=$l,e.textContent="@keyframes qpm-toast-in { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 0.95; } }",document.head.appendChild(e)}();const t=document.createElement("div");t.textContent=e,t.style.cssText="position:fixed;bottom:24px;right:24px;background:#2e7d32;color:#fff;padding:8px 12px;border-radius:6px;font-size:12px;z-index:2147483647;opacity:0.95;animation:qpm-toast-in 0.3s ease",document.body.appendChild(t),setTimeout(()=>t.remove(),2500)}function Xc(e,t){const n=document.createElement("button");return n.textContent=e,n.style.cssText="padding:6px 10px;font-size:12px;cursor:pointer;border:none;border-radius:4px;background:#555;color:#fff;transition:background 0.2s",n.onmouseover=()=>{n.disabled||(n.style.background="#777")},n.onmouseout=()=>{n.disabled||(n.textContent?.includes("‚úì")?n.style.background="#4CAF50":n.style.background="#555")},n.onclick=t,n}function Jc(){try{localStorage.setItem("quinoa-pet-manager",JSON.stringify(cc))}catch{}}const Kc="qpm.petXpObservations.v1",Qc=new Map,Yc=new Map,Zc=new Map,ed=new Map;let td=!1;const nd=d(()=>{try{m.set(Kc,function(){const e=[];for(const[t,n]of ed){const o=Array.from(n.values()).sort((e,t)=>e.level-t.level).map(e=>({...e}));e.push({key:t,displayName:Yc.get(t)??t,lastUpdated:Zc.get(t)??0,levels:o})}return{version:1,savedAt:Date.now(),species:e}}())}catch(e){s("‚ö†Ô∏è Failed to persist pet XP observations",e)}},2500);function od(e,t,n,o,r,a){const i=c(e);if(!i)return;const s=Math.max(0,Math.round(t));if(!Number.isFinite(s))return;const l=Math.max(0,Math.round(n));if(!Number.isFinite(l))return;const d=(u=i,ed.has(u)||ed.set(u,new Map),ed.get(u));var u;const p=d.get(s);if(p){(l>p.xp||l===p.xp&&"level-up"===r&&"level-up"!==p.source)&&(p.xp=l,p.strength=o??p.strength??null,p.source=r),p.samples+=1,p.lastObservedAt=a}else d.set(s,{level:s,xp:l,strength:o??null,samples:1,lastObservedAt:a,source:r});Yc.set(i,e),Zc.set(i,a),nd()}function rd(e){const t=Date.now(),n=new Set;e.forEach((e,o)=>{const r=function(e,t){return e.slotId&&e.slotId.trim().length>0?`slot:${e.slotId}`:e.petId&&e.petId.trim().length>0?`pet:${e.petId}`:`index:${t}`}(e,o);n.add(r);const a=Qc.get(r),i=e.species??a?.species??null,s="number"==typeof e.level&&Number.isFinite(e.level)?e.level:null,l="number"==typeof e.xp&&Number.isFinite(e.xp)?e.xp:null,c="number"==typeof e.strength&&Number.isFinite(e.strength)?e.strength:null;if(a&&i&&a.species===i){const e=a.level,n=a.xp,o=a.strength;null!=e&&null!=s&&s>e&&null!=n&&n>0&&od(i,e,n,o,"level-up",t)}if(i&&null!=s&&null!=l){const e=a?.xp,n=a?.level;(null==e||Math.round(e)!==Math.round(l)||(null==n||n!==s))&&od(i,s,l,c,"snapshot",t)}Qc.set(r,{species:i,level:s,xp:l,strength:c})});for(const o of Qc.keys())n.has(o)||Qc.delete(o)}function ad(){if(!td){td=!0;try{const t=m.get(Kc,null);(e=t??null)&&1===e.version&&(ed.clear(),Yc.clear(),Zc.clear(),e.species.forEach(e=>{const t=new Map;e.levels.forEach(e=>{const n=Math.max(0,Math.round(e.level)),o=Number.isFinite(e.xp)?Math.max(0,Math.round(e.xp)):null;null!=o&&t.set(n,{level:n,xp:o,strength:e.strength??null,samples:Math.max(1,Math.round(e.samples??1)),lastObservedAt:e.lastObservedAt??0,source:"level-up"===e.source?"level-up":"snapshot"})}),0!==t.size&&(ed.set(e.key,t),Yc.set(e.key,e.displayName??e.key),Zc.set(e.key,e.lastUpdated??Date.now()))}))}catch(t){s("‚ö†Ô∏è Failed to restore pet XP observations",t)}var e;br(),wr(rd)}}const id=[],sd={speciesXpPerLevel:{}};let ld=[];function cd(e,t,n,o,r){const a=e.strength??100,i=e.petId??"",s=e.species??"Unknown",l=Math.max(.25,a/100),c=o/60,d=o*l,u=c*l,p=Math.max(0,c/100),m=3600*Math.min(.95/60,p*l),f=r*l,g=m*f,h=id.filter(e=>e.petId===i&&e.abilityId===t),b=h.length>0?h[h.length-1]:null;return{petId:i,petName:e.name??e.species??"Unknown",species:s,abilityId:t,abilityName:n,strength:a,baseXpPerProc:r,actualXpPerProc:f,baseChancePerMinute:o,actualChancePerMinute:d,baseChancePerSecond:c,actualChancePerSecond:u,expectedProcsPerHour:m,expectedXpPerHour:g,lastProcAt:b?.timestamp??null,procCount:h.length,level:e.level??null,currentXp:e.xp??null}}const dd={Worm:12,Snail:12,Bee:12,Chicken:24,Bunny:24,Dragonfly:24,Pig:72,Cow:72,Squirrel:100,Turtle:100,Goat:100,Butterfly:144,Peacock:144,Capybara:144};function ud(e){const t=dd[e];if(!t)return sd.speciesXpPerLevel[e]??null;return 3600*t/30}const pd={Worm:1.75,Snail:1.75,Bee:1.75,Chicken:1.75,Bunny:1.75,Dragonfly:1.75,Pig:2.25,Cow:2.5,Sheep:2,Squirrel:2,Turtle:2,Goat:2,Butterfly:2.5,Peacock:2.5,Capybara:2.5};function md(e,t){if(!e||e<1)return null;const n=function(e){return pd[e]??null}(t);if(!n||n<=1)return null;const o=20*((e-1)/(n-1))+80,r=Math.floor(o);return r<80||r>100?null:r}function fd(e,t,n){if(n<=0||e>=t)return null;const o=(t-e)/n,r=60*o,a=Math.floor(o);return{hours:a,minutes:Math.round(60*(o-a)),totalMinutes:r}}const gd={respectRules:!1,avoidFavorited:!0,overrides:{},updatedAt:Date.now()},hd=["Carrot","Strawberry","Blueberry","Apple","Watermelon","Pumpkin"],bd=Object.fromEntries(Object.entries({Worm:["Carrot","Strawberry","Aloe","Tomato","Apple"],Snail:["Blueberry","Tomato","Corn","Daffodil"],Bee:["Strawberry","Blueberry","Daffodil","Lily"],Chicken:["Aloe","Corn","Watermelon","Pumpkin"],Bunny:["Carrot","Strawberry","Blueberry","OrangeTulip","Apple"],Dragonfly:["Apple","OrangeTulip","Echeveria"],Pig:["Watermelon","Pumpkin","Mushroom","Bamboo"],Cow:["Coconut","Banana","BurrosTail","Mushroom"],Squirrel:["Pumpkin","Banana","Grape"],Turtle:["Watermelon","BurrosTail","Bamboo","Pepper"],Goat:["Pumpkin","Coconut","Pepper","Camellia","PassionFruit"],Butterfly:["Daffodil","Lily","Grape","Lemon","Sunflower","Chrysanthemum"],Capybara:["Lemon","PassionFruit","DragonFruit","Lychee"],Peacock:["Cactus","Sunflower","Lychee"]}).map(([e,t])=>{const n=c(e),o=t.map(e=>c(e)).filter(Boolean);return[n,{display:[...t],normalized:o}]})),yd=hd.map(e=>c(e));let xd=function(){const e=m.get("quinoa-pet-food-rules",{});if(!e||"object"!=typeof e)return{...gd};return{respectRules:"boolean"==typeof e.respectRules?e.respectRules:gd.respectRules,avoidFavorited:"boolean"==typeof e.avoidFavorited?e.avoidFavorited:gd.avoidFavorited,overrides:"object"==typeof e.overrides&&e.overrides?e.overrides:{},updatedAt:"number"==typeof e.updatedAt?e.updatedAt:Date.now()}}();function wd(e){const t=[e.species,e.itemType,e.name];for(const n of t){if("string"!=typeof n||0===n.length)continue;const e=c(n);if(e)return e}return null}function vd(e,t,n={}){if(!t||0===t.items.length)return null;const o=function(e){if(!e)return{display:[...hd],normalized:[...yd]};const t=c(e),n=t?bd[t]:void 0;return n||{display:[...hd],normalized:[...yd]}}(e),r=function(e){if(!e)return null;const t=c(e);return t&&xd.overrides[t]||null}(e),a=new Set(o.normalized),i=r?.preferred?c(r.preferred):null;if(i&&a.add(i),r?.allowed)for(const g of r.allowed){const e=c(g);e&&a.add(e)}const s=new Set;if(r?.forbidden)for(const g of r.forbidden){const e=c(g);e&&s.add(e)}0===a.size&&yd.forEach(e=>a.add(e));const l=n.avoidFavorited??xd.avoidFavorited,d=(e,n)=>{for(const o of t.items){const r=wd(o);if(r&&((!e||!t.favoritedIds.has(o.id))&&n(r,o)))return o}return null},u=e=>i?d(e,e=>e===i):null,p=e=>d(e,e=>a.has(e)&&!s.has(e)),m=u(!0);if(m)return{item:m,usedFavoriteFallback:!1};if(l){const e=u(!1);if(e)return{item:e,usedFavoriteFallback:t.favoritedIds.has(e.id)}}const f=p(!0);if(f)return{item:f,usedFavoriteFallback:!1};if(l){const e=p(!1);if(e)return{item:e,usedFavoriteFallback:t.favoritedIds.has(e.id)}}return null}function Cd(){return h.MagicCircle_RoomConnection??null}function Td(){const e=h;return e.__mga_lastScopePath?.slice()??["Room","Quinoa"]}function Sd(e,t){try{const n=Cd();if(!n)return s("‚ö†Ô∏è MagicCircle_RoomConnection not found"),!1;const o={type:"FeedPet",petItemId:e,cropItemId:t,scopePath:Td()};return s("üì§ Sending FeedPet WebSocket message",o),n.sendMessage(o),!0}catch(n){return s("‚ùå Failed to send FeedPet message",n),!1}}async function kd(e,t=!1){try{const t=xr();if(0===t.length)return{success:!1,petName:null,petSpecies:null,foodSpecies:null,error:"No active pets found"};const n=t[e];if(!n)return{success:!1,petName:null,petSpecies:null,foodSpecies:null,error:`Pet at index ${e} not found`};if(!n.petId)return{success:!1,petName:n.name,petSpecies:n.species,foodSpecies:null,error:"Pet has no petId (UUID)"};const o=await is();if(!o||!o.items||0===o.items.length)return{success:!1,petName:n.name,petSpecies:n.species,foodSpecies:null,error:"Failed to read inventory"};const r={items:o.items.filter(e=>"Produce"===e.itemType||"Crop"===e.itemType).map(e=>({id:e.id,species:e.species??null,itemType:e.itemType??null,name:e.name??null})),favoritedIds:new Set(o.favoritedItemIds??[]),source:"myInventoryAtom"},a=vd(n.species,r,{avoidFavorited:!0});if(!a)return{success:!1,petName:n.name,petSpecies:n.species,foodSpecies:null,error:"No suitable food found in inventory"};const i=a.item;if(!i.id)return{success:!1,petName:n.name,petSpecies:n.species,foodSpecies:i.species,error:"Crop has no ID"};const l=null!==n.hungerPct?`hunger: ${n.hungerPct}%`:"hunger: unknown";s(`üçñ Attempting to feed ${n.name||n.species||"pet"} (${l}) with ${i.species||"food"}`);return Sd(n.petId,i.id)?(s(`‚úÖ Fed ${n.name||n.species||"pet"} with ${i.species||"food"}`),{success:!0,petName:n.name,petSpecies:n.species,foodSpecies:i.species}):{success:!1,petName:n.name,petSpecies:n.species,foodSpecies:i.species,error:"Failed to send WebSocket message"}}catch(n){return s("‚ùå Instant feed error",n),{success:!1,petName:null,petSpecies:null,foodSpecies:null,error:n instanceof Error?n.message:"Unknown error"}}}y("QPM",{debugPets:()=>{const e=yr();return console.log("=== Active Pets Debug (v2024-11-13-DOM-STRENGTH) ==="),console.table(e.map(e=>({Slot:e.slotIndex,Name:e.name||e.species,Species:e.species,Level:e.level,Strength:e.strength,TargetScale:e.targetScale,Abilities:e.abilities.join(", "),Hunger:e.hungerPct?`${e.hungerPct.toFixed(1)}%`:"N/A"}))),console.log("Full normalized data:",e),console.log("\n=== Raw Data Inspection ==="),e.forEach((e,t)=>{if(console.log(`\nPet ${t} (${e.name}):`),console.log("Raw object:",e.raw),e.raw&&"object"==typeof e.raw){const t=e.raw;console.log("Available fields:",Object.keys(t)),t.slot&&"object"==typeof t.slot&&(console.log("slot fields:",Object.keys(t.slot)),console.log("slot.xp:",t.slot.xp)),t.pet&&"object"==typeof t.pet&&console.log("pet fields:",Object.keys(t.pet))}}),e},debugAllAtoms:()=>{try{const e=window.__qpmJotaiAtomCache__;if(!e||"function"!=typeof e.entries)return console.error("Jotai atom cache not available"),null;console.log("=== All Available Atoms ===");const t=[];for(const[o,r]of e.entries())if(r&&"object"==typeof r&&"debugLabel"in r){const n=r.debugLabel;"string"==typeof n&&t.push({label:n,hasValue:e.has(o)})}console.table(t),console.log("\n=== Pet-related Atoms ===");const n=t.filter(e=>e.label.toLowerCase().includes("pet"));return console.table(n),t}catch(e){return console.error("Failed to list atoms:",e),null}},checkTargetScale:()=>{const e=yr();return console.log("=== TargetScale Analysis ==="),console.log("Checking if targetScale might be strength-related...\n"),e.forEach((e,t)=>{const n=e.targetScale??0,o=e.xp??0,r=Math.round(50*n),a=Math.round(100*(n-1)),i=Math.round(45*n+5);console.log(`Pet ${t}: ${e.name}`),console.log(`  XP: ${o}`),console.log(`  TargetScale: ${n.toFixed(6)}`),console.log(`  Possible STR (√ó50): ${r}`),console.log(`  Possible STR ((x-1)√ó100): ${a}`),console.log(`  Possible STR (√ó45+5): ${i}\n`)}),e},debugSlotInfos:()=>{try{const e=window.__qpmJotaiAtomCache__,t=window.__qpmJotaiStore__;if(!e||!t)return console.error("Jotai cache/store not available"),null;console.log("=== myPetSlotInfosAtom Data ===");let n=null;for(const[r,a]of e.entries())if(a&&"object"==typeof a&&"debugLabel"in a){if("myPetSlotInfosAtom"===a.debugLabel){n=r;break}}if(!n)return console.error("myPetSlotInfosAtom not found in cache"),null;const o=t.get(n);return console.log("Raw value:",o),Array.isArray(o)&&(console.log(`\nFound ${o.length} entries:\n`),o.forEach((e,t)=>{console.log(`Entry ${t}:`,e),e&&"object"==typeof e&&(console.log("  Fields:",Object.keys(e)),"slot"in e&&e.slot&&"object"==typeof e.slot&&console.log("  slot fields:",Object.keys(e.slot)),"pet"in e&&e.pet&&"object"==typeof e.pet&&console.log("  pet fields:",Object.keys(e.pet)),"stats"in e&&e.stats&&"object"==typeof e.stats&&(console.log("  stats fields:",Object.keys(e.stats)),console.log("  stats content:",e.stats)))})),o}catch(e){return console.error("Failed to inspect myPetSlotInfosAtom:",e),null}},debugPetInventory:()=>{try{const t=window.__qpmJotaiAtomCache__,n=window.__qpmJotaiStore__;if(!t||!n)return console.error("Jotai cache/store not available"),null;console.log("=== Pet Inventory & Hutch Atoms ===\n");const o=["myPetInventoryAtom","myPetHutchPetItemsAtom","myPrimitivePetSlotsAtom","petInfosAtom"],r={};for(const a of o){console.log(`\n--- ${a} ---`);let o=null;for(const[e,n]of t.entries())if(n&&"object"==typeof n&&"debugLabel"in n){if(n.debugLabel===a){o=e;break}}if(o)try{const e=n.get(o);if(r[a]=e,console.log("Value:",e),Array.isArray(e)&&e.length>0){const t=e[0];t&&"object"==typeof t&&(console.log("First entry fields:",Object.keys(t)),"pet"in t&&t.pet&&"object"==typeof t.pet&&(console.log("  pet fields:",Object.keys(t.pet)),console.log("  pet sample:",t.pet)),"stats"in t&&t.stats&&"object"==typeof t.stats&&(console.log("  stats fields:",Object.keys(t.stats)),console.log("  stats sample:",t.stats)),"slot"in t&&t.slot&&"object"==typeof t.slot&&console.log("  slot fields:",Object.keys(t.slot)))}}catch(e){console.error(`Error reading ${a}:`,e)}else console.log(`${a} not found`)}return r}catch(e){return console.error("Failed to inspect pet atoms:",e),null}},searchPageWindow:()=>{try{const e=window.unsafeWindow||window;console.log("=== Searching Page Window for Pet Data ===\n");const t=["myData","myPets","activePets","petData","pets","UnifiedState","gameState","quinoaData"],n={};for(const r of t)if(r in e){console.log(`\nFound: ${r}`);const t=e[r];if(console.log("Type:",typeof t),t&&"object"==typeof t&&(console.log("Keys:",Object.keys(t).slice(0,20)),n[r]=t,"pets"in t&&console.log("  ‚Üí has pets property:",t.pets),"activePets"in t&&console.log("  ‚Üí has activePets property:",t.activePets),"inventory"in t&&t.inventory)){console.log("  ‚Üí has inventory property");const e=t.inventory;if(e&&"object"==typeof e&&"items"in e){const t=e.items;if(Array.isArray(t)){console.log(`  ‚Üí inventory has ${t.length} items`);const e=t.filter(e=>e&&"object"==typeof e&&("Pet"===e.itemType||"Pet"===e.type||"petSpecies"in e||"species"in e));e.length>0&&(console.log(`  ‚Üí Found ${e.length} pet items in inventory`),console.log("  ‚Üí First pet item:",e[0]),console.log("  ‚Üí First pet fields:",Object.keys(e[0])))}}}}console.log("\n=== Searching all window properties ===");const o=Object.keys(e).filter(e=>e.toLowerCase().includes("pet")||e.toLowerCase().includes("animal")||e.toLowerCase().includes("creature"));return console.log("Pet-related keys:",o),n}catch(e){return console.error("Failed to search page window:",e),null}},inspectPetCards:()=>{try{console.log("=== Inspecting Pet Card UI Elements ===\n");const e=["[data-pet-slot]","[data-pet-id]","[data-slot-index]",".pet-card",".pet-slot",'[class*="pet"]','[class*="Pet"]'],t=[];for(const n of e){const e=document.querySelectorAll(n);e.length>0&&(console.log(`Found ${e.length} elements with selector: ${n}`),e.forEach(e=>{e instanceof HTMLElement&&!t.includes(e)&&t.push(e)}))}return console.log(`\nTotal unique pet card elements found: ${t.length}\n`),t.slice(0,10).forEach((e,t)=>{console.log(`\n--- Element ${t} ---`),console.log("Tag:",e.tagName),console.log("Classes:",e.className),console.log("Text content:",e.textContent?.substring(0,200)),console.log("Data attributes:",Object.keys(e.dataset));const n=e.textContent||"",o=n.match(/(?:level|lvl|lv)[:\s]*(\d+)/i),r=n.match(/(?:str|strength)[:\s]*(\d+)/i),a=n.match(/(?:age)[:\s]*(\d+)/i);o&&console.log("  ‚Üí Found level:",o[1]),r&&console.log("  ‚Üí Found strength:",r[1]),a&&console.log("  ‚Üí Found age:",a[1])}),t}catch(e){return console.error("Failed to inspect pet cards:",e),null}},findPetDataInDOM:()=>{try{console.log("=== Searching DOM for Pet Level/Strength Data ===\n");const e=yr().map(e=>e.name).filter(Boolean);console.log("Looking for pets:",e);const t=document.querySelectorAll("*"),n=[];for(const o of t){const t=o.textContent?.toLowerCase()||"";if(!(t.length>500)){for(const r of e)if(r&&t.includes(r.toLowerCase())){n.push({el:o,reason:`Contains pet name: ${r}`});break}/\b(age|level|lvl|lv|str|strength|max str)\b/i.test(t)&&n.push({el:o,reason:"Contains level/strength keywords"})}}return console.log(`\nFound ${n.length} potentially relevant elements\n`),n.slice(0,15).forEach(({el:e,reason:t},n)=>{console.log(`\n--- Element ${n} ---`),console.log("Reason:",t),console.log("Tag:",e.tagName),console.log("Classes:",e.className),console.log("Text (first 300 chars):",e.textContent?.substring(0,300));const o=e.textContent||"",r=o.match(/age[:\s]*(\d+)/i),a=o.match(/(?:max\s+)?str[:\s]*(\d+)/i),i=o.match(/(?:level|lvl|lv)[:\s]*(\d+)/i);r&&console.log("  ‚úì Age:",r[1]),a&&console.log("  ‚úì Strength:",a[1]),i&&console.log("  ‚úì Level:",i[1])}),n}catch(e){return console.error("Failed to search DOM:",e),null}},extractStrengthFromUI:()=>{try{console.log("=== Extracting Strength from Pet Card UI ===\n");const e=yr(),t=[],n=Array.from(document.querySelectorAll("*"));for(const o of e){const e=o.name||o.species||`Pet ${o.slotIndex}`;let r=null,a=null;for(const t of n){const e=t.textContent||"";if(e.length>100)continue;const n=e.match(/\bSTR\s+(\d+)\b/i);if(n&&n[1]){const o=parseInt(n[1],10);console.log(`Found STR ${o} in element:`,t),console.log("  Tag:",t.tagName),console.log("  Classes:",t.className),console.log("  Text:",e.trim()),console.log("  Parent:",t.parentElement?.className),r||(r=o,a=t)}}t.push({pet:e,strength:r,element:a})}return console.log("\n=== Extracted Strength Values ==="),console.table(t.map(e=>({Pet:e.pet,Strength:e.strength??"Not found"}))),t}catch(e){return console.error("Failed to extract strength from UI:",e),null}},debugLevels:()=>{try{console.log("=== Pet Level Calculation Debug ===\n");const e=yr();return e.forEach((e,t)=>{if(console.log(`\n--- Pet ${t}: ${e.name} (${e.species}) ---`),console.log(`XP: ${e.xp??"N/A"}`),console.log(`Strength: ${e.strength??"N/A"}`),console.log(`Level (Jotai): ${e.level??"null"}`),e.petId){const t=(n=e.petId,Uo.get(n)??[]);if(console.log(`XP History: ${t.length} samples`),t.length>=2){const e=t[0],n=t[t.length-1],o=n.xp-e.xp,r=(n.timestamp-e.timestamp)/1e3,a=o/r;console.log(`  First sample: ${e.xp} XP at ${new Date(e.timestamp).toLocaleTimeString()}`),console.log(`  Last sample: ${n.xp} XP at ${new Date(n.timestamp).toLocaleTimeString()}`),console.log(`  XP gained: ${o.toFixed(0)} over ${r.toFixed(0)}s`),console.log(`  XP rate: ${a.toFixed(2)} XP/sec`)}const o=Jo(e);if(console.log("\nLevel Estimate:"),console.log(`  Current Level: ${o.currentLevel??"N/A"} / ${o.maxLevel}`),console.log(`  Confidence: ${o.confidence}`),console.log(`  Total XP Needed: ${o.totalXPNeeded?.toFixed(0)??"N/A"}`),console.log(`  XP Rate: ${o.xpGainRate?.toFixed(2)??"N/A"} XP/sec`),o.totalXPNeeded&&e.xp){const t=e.xp/o.totalXPNeeded*100;console.log(`  Progress: ${t.toFixed(1)}%`)}}var n}),e}catch(e){return console.error("Failed to debug levels:",e),null}},feedPet:async e=>{console.log(`üçñ Feeding pet at index ${e}...`);const t=await kd(e);return t.success?console.log(`‚úÖ Successfully fed ${t.petName||t.petSpecies} with ${t.foodSpecies}`):console.error(`‚ùå Failed to feed pet: ${t.error}`),t},feedPetByIds:async(e,t)=>{console.log(`üçñ Feeding pet ${e} with crop ${t}...`);const n=await async function(e,t){try{const n=xr().find(t=>t.petId===e);return Sd(e,t)?(s(`‚úÖ Fed pet ${e} with crop ${t}`),{success:!0,petName:n?.name??null,petSpecies:n?.species??null,foodSpecies:null}):{success:!1,petName:n?.name??null,petSpecies:n?.species??null,foodSpecies:null,error:"Failed to send WebSocket message"}}catch(n){return s("‚ùå Feed by IDs error",n),{success:!1,petName:null,petSpecies:null,foodSpecies:null,error:n instanceof Error?n.message:"Unknown error"}}}(e,t);return n.success?console.log("‚úÖ Successfully fed pet"):console.error(`‚ùå Failed to feed pet: ${n.error}`),n},feedAllPets:async(e=40)=>{console.log(`üçñ Feeding all pets below ${e}% hunger...`);const t=await async function(e=40,t=!1){const n=xr(),o=[];for(let r=0;r<n.length;r++){const a=n[r];if(!a)continue;const i=a.hungerPct??100;if(i>=e){s(`‚è≠Ô∏è Skipping ${a.name||a.species} - hunger ${i}% >= ${e}%`);continue}s(`üçñ Feeding ${a.name||a.species} - hunger ${i}%`);const l=await kd(r,t);o.push(l),r<n.length-1&&await new Promise(e=>setTimeout(e,500))}return o}(e),n=t.filter(e=>e.success).length,o=t.filter(e=>!e.success).length;return console.log(`‚úÖ Fed ${n} pets, ${o} failed`),t},isInstantFeedAvailable:()=>{const e=null!==Cd();return console.log(e?"‚úÖ Instant feed is available":"‚ùå Instant feed is NOT available (RoomConnection missing)"),e},debugInventory:async()=>{try{const{getAtomByLabel:e,readAtomValue:t}=await Promise.resolve().then(()=>q);console.log("=== Inventory Debug ===\n");const n=e("userSlotsAtom");if(n){const e=await t(n);console.log("userSlotsAtom inventory:",e);const o=Array.isArray(e)?e.filter(e=>"Plant"===e.itemType||e.slots&&e.slots.length>0):[];return console.log(`\nFound ${o?.length||0} plant items:`),console.table(o?.map((e,t)=>({Index:t,Species:e.species||"N/A",Name:e.name||"N/A",ItemType:e.itemType,HasSlots:!!(e.slots&&e.slots.length>0),NumSlots:e.slots?.length||0,Keys:Object.keys(e).join(", ")}))),o&&o.length>0&&(console.log("\n=== First Plant Item (Full Structure) ==="),console.log(o[0]),o[0].slots&&(console.log("\n=== Slots Detail ==="),console.log(o[0].slots))),{userSlots:e,plantItems:o}}return console.error("‚ùå userSlotsAtom not found"),null}catch(e){return console.error("Failed to debug inventory:",e),null}}}),s("‚úÖ QPM debug API registered (use QPM.debugPets() in console)");const Ad={enabled:!1,threshold:40,pollMs:3e3,clickCooldownMs:4e3,retryDelaySeconds:15,logs:!0,ui:{preventScrollClicks:!0},inventoryLocker:{syncMode:!0},mutationReminder:{enabled:!0,showNotifications:!0,highlightPlants:!0},harvestReminder:{enabled:!1,highlightEnabled:!0,toastEnabled:!0,minSize:80,selectedMutations:{Rainbow:!0,Gold:!1,Frozen:!1,Wet:!1,Chilled:!1,Dawnlit:!1,Amberlit:!1,Amberbound:!1,Dawnbound:!1}},turtleTimer:{enabled:!0,includeBoardwalk:!1,minActiveHungerPct:2,fallbackTargetScale:1.5,focus:"latest"}};const Pd=function(){try{return JSON.parse(localStorage.getItem("quinoa-pet-manager")||"{}")}catch{return{}}}(),Md={...Ad,...Pd,ui:{...Ad.ui,...Pd.ui||{}},inventoryLocker:{...Ad.inventoryLocker,...Pd.inventoryLocker||{}},mutationReminder:{...Ad.mutationReminder,...Pd.mutationReminder||{}},harvestReminder:{...Ad.harvestReminder,...Pd.harvestReminder||{},selectedMutations:{...Ad.harvestReminder.selectedMutations,...Pd.harvestReminder?.selectedMutations||{}}},turtleTimer:{...Ad.turtleTimer,...Pd.turtleTimer||{}}};window.addEventListener("error",e=>{try{if(String(e?.message||"").includes("Failed to execute 'contains' on 'Node'"))return e.stopImmediatePropagation?.(),e.preventDefault?.(),!1}catch{}return!0},!0),async function(){var n;s("üöÄ Quinoa Pet Manager initializing..."),await async function(){s("‚è≥ Waiting for game to load..."),await t,await e(100);const n=Date.now()+3e4;for(;Date.now()<n;){const t=i();if(t&&t.querySelector("canvas, button, [data-tm-main-interface], [data-tm-hud-root], [data-tm-player-id]"))return void s("‚úÖ Game UI detected");if(document.querySelector("#App canvas"))return void s("‚úÖ Game UI detected");await e(500)}s("‚ö†Ô∏è Game UI not detected within timeout, proceeding anyway")}(),qa(),ad(),function(){try{const e=m.get("qpm.xpTrackerProcs.v1",null);e?.procs&&id.splice(0,id.length,...e.procs);const t=m.get("qpm.xpTrackerConfig.v1",null);t?.speciesXpPerLevel&&Object.assign(sd.speciesXpPerLevel,t.speciesXpPerLevel)}catch(e){s("‚ö†Ô∏è Failed to restore XP tracker data",e)}}(),Ui(),Cs(),await as(),ce(),await Fn(),n={enabled:Md.harvestReminder.enabled,highlightEnabled:Md.harvestReminder.highlightEnabled,toastEnabled:Md.harvestReminder.toastEnabled,minSize:Md.harvestReminder.minSize,selectedMutations:Md.harvestReminder.selectedMutations},Co?n&&$o(n):(Co=!0,n&&$o(n),To=In(),qn(e=>{To=e,vo.enabled&&No()},!1),Io(),No(),s("üåæ Harvest reminder ready")),da(Md.turtleTimer),Lt(),Nn||(Nn=!0,s("üåø Garden mutation tracker starting..."),ot(),Dn=it(),Rn=Un(Dn.kind),zn=In(),at(e=>{const t=Dn;Dn=e;const n=Un(e.kind),o=n!==Rn,r=!t||t.startedAt!==e.startedAt||t.expectedEndAt!==e.expectedEndAt||t.hash!==e.hash;o?(Rn=n,Hn()):r&&"unknown"!==n&&Hn()}),qn(e=>{zn=e,Hn()},!0),Hn(),s("üåø Garden mutation tracker ready")),$o({enabled:Md.harvestReminder.enabled,highlightEnabled:Md.harvestReminder.highlightEnabled,toastEnabled:Md.harvestReminder.toastEnabled,minSize:Md.harvestReminder.minSize,selectedMutations:Md.harvestReminder.selectedMutations}),ua(Md.turtleTimer),cc=Md,fc(),s("üîç Starting version checker..."),setTimeout(()=>{bl().catch(e=>{s("‚ùå Initial version check failed:",e)})},5e3),setInterval(()=>{bl().catch(e=>{s("‚ùå Periodic version check failed:",e)})},pl),s("‚úÖ Quinoa Pet Manager initialized successfully")}().catch(e=>{console.error("[QuinoaPetMgr] Initialization failed:",e)});const Ed={Carrot:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Tomato:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Corn:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Pepper:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Pumpkin:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Squash:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Strawberry:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Blueberry:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Watermelon:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Grape:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Apple:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Banana:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Lemon:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Coconut:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Lychee:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],DragonFruit:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],PassionFruit:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Lily:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Sunflower:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Daffodil:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Camellia:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Delphinium:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],OrangeTulip:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Chrysanthemum:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Aloe:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Cactus:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Echeveria:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],BurrosTail:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Bamboo:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Mushroom:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Starweaver:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],DawnCelestial:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],MoonCelestial:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"]},$d={Worm:["Normal","Rainbow","Gold","Max Weight"],Snail:["Normal","Rainbow","Gold","Max Weight"],Bee:["Normal","Rainbow","Gold","Max Weight"],Chicken:["Normal","Rainbow","Gold","Max Weight"],Bunny:["Normal","Rainbow","Gold","Max Weight"],Dragonfly:["Normal","Rainbow","Gold","Max Weight"],Pig:["Normal","Rainbow","Gold","Max Weight"],Cow:["Normal","Rainbow","Gold","Max Weight"],Sheep:["Normal","Rainbow","Gold","Max Weight"],Squirrel:["Normal","Rainbow","Gold","Max Weight"],Turtle:["Normal","Rainbow","Gold","Max Weight"],Goat:["Normal","Rainbow","Gold","Max Weight"],Butterfly:["Normal","Rainbow","Gold","Max Weight"],Peacock:["Normal","Rainbow","Gold","Max Weight"],Capybara:["Normal","Rainbow","Gold","Max Weight"]};let Fd=null,Id=0;async function qd(){try{const e=$("stateAtom");if(!e)return s("‚ö†Ô∏è stateAtom not found"),null;const t=await F(e);if(!t)return s("‚ö†Ô∏è State is null"),null;const n=$("playerAtom");if(!n)return s("‚ö†Ô∏è playerAtom not found"),null;const o=await F(n),r=o?.id;if(!r)return s("‚ö†Ô∏è Player ID not found"),null;s(`[JOURNAL-DEBUG] Current player ID: ${r}`);const a=t?.child?.data?.userSlots||[];s(`[JOURNAL-DEBUG] Found ${Array.isArray(a)?a.length:Object.keys(a||{}).length} slots (isArray: ${Array.isArray(a)})`);let i=null;if(Array.isArray(a))i=a.find(e=>String(e?.playerId)===String(r)),s(`[JOURNAL-DEBUG] Searched array slots, found match: ${!!i}`);else if(a&&"object"==typeof a){for(const e of Object.values(a))if(String(e?.playerId)===String(r)){i=e;break}s(`[JOURNAL-DEBUG] Searched object slots, found match: ${!!i}`)}if(!i)return s("‚ö†Ô∏è Player slot not found"),s(`[JOURNAL-DEBUG] Available slot player IDs: ${Array.isArray(a)?a.map(e=>e?.playerId).join(", "):Object.values(a||{}).map(e=>e?.playerId).join(", ")}`),null;const l=i?.data?.journal||i?.journal;return l&&"object"==typeof l?(s(`[JOURNAL-DEBUG] Found journal with keys: ${JSON.stringify(Object.keys(l))}`),l.produce&&s(`[JOURNAL-DEBUG] Produce species: ${JSON.stringify(Object.keys(l.produce))}`),l.pets&&s(`[JOURNAL-DEBUG] Pet species: ${JSON.stringify(Object.keys(l.pets))}`),function(e){const t={};e.produce&&"object"==typeof e.produce&&(t.produce=Object.fromEntries(Object.entries(e.produce).map(([e,t])=>[e,{variantsLogged:Array.isArray(t?.variantsLogged)?t.variantsLogged:[]}])));e.pets&&"object"==typeof e.pets&&(t.pets=Object.fromEntries(Object.entries(e.pets).map(([e,t])=>[e,{variantsLogged:Array.isArray(t?.variantsLogged)?t.variantsLogged:[],abilitiesLogged:Array.isArray(t?.abilitiesLogged)?t.abilitiesLogged:[]}])));return t}(l)):(s("‚ÑπÔ∏è No journal data found for player"),s(`[JOURNAL-DEBUG] Player slot structure: ${JSON.stringify(Object.keys(i||{}))}`),s(`[JOURNAL-DEBUG] Player slot.data structure: ${JSON.stringify(Object.keys(i?.data||{}))}`),{produce:{},pets:{}})}catch(e){return s("‚ùå Error fetching journal:",e),null}}async function Nd(){const e=Date.now();if(Fd&&e-Id<5e3)return Fd;const t=await qd();return t&&(Fd=t,Id=e),t}async function zd(){const e=await Nd();if(!e)return null;const t={produce:[],pets:[]};for(const[n,o]of Object.entries(Ed)){const r=e.produce?.[n],a=new Map;if(r?.variantsLogged)for(const e of r.variantsLogged)a.set(e.variant,e.createdAt||0);t.produce.push({species:n,variants:o.map(e=>({variant:e,collected:a.has(e),collectedAt:a.get(e)}))})}for(const[n,o]of Object.entries($d)){const r=e.pets?.[n],a=new Map;if(r?.variantsLogged)for(const e of r.variantsLogged)a.set(e.variant,e.createdAt||0);t.pets.push({species:n,variants:o.map(e=>({variant:e,collected:a.has(e),collectedAt:a.get(e)}))})}return t}const Rd=Object.freeze(Object.defineProperty({__proto__:null,getJournal:Nd,getJournalStats:async function(){const e=await zd();if(!e)return null;let t=0,n=0,o=0,r=0;for(const s of e.produce)for(const e of s.variants)n++,e.collected&&t++;for(const s of e.pets)for(const e of s.variants)r++,e.collected&&o++;const a=t+o,i=n+r;return{produce:{collected:t,total:n,percentage:n>0?t/n*100:0},petVariants:{collected:o,total:r,percentage:r>0?o/r*100:0},overall:{collected:a,total:i,percentage:i>0?a/i*100:0}}},getJournalSummary:zd,refreshJournalCache:function(){Fd=null,Id=0}},Symbol.toStringTag,{value:"Module"}));function Ld(e,t,n){return.4*e+(t<=2?30:t<=4?20:10)+("easy"===n?30:"medium"===n?20:"hard"===n?10:"very-hard"===n?5:0)}function Dd(e,t,n,o,r){const a=(o-n.length)/o*100,i=function(e,t,n,o){if(0===e.length)return"easy";const r=e.map(e=>function(e,t,n,o){return"Normal"===e?"easy":"Max Weight"===e||"Max"===e?"pet"===n?"very-hard":"hard":"Rainbow"===e?"pet"===n?"very-hard":o.hasRainbowGranter?"medium":"very-hard":"Gold"===e?"pet"===n?"hard":o.hasGoldGranter?"medium":"very-hard":"Wet"===e||"Chilled"===e?"easy":"Frozen"===e?"medium":"Dawnlit"===e||"Ambershine"===e?o.hasRainbowGranter?"hard":"medium":"Amberlit"===e?o.hasRainbowGranter?"very-hard":"hard":"Dawncharged"===e?o.hasDawnbinder?"hard":"impossible":"Ambercharged"===e?o.hasMoonbinder?"hard":"impossible":"medium"}(e,0,n,o)),a=["easy","medium","hard","very-hard","impossible"];return r.reduce((e,t)=>a.indexOf(t)>a.indexOf(e)?t:e)}(n,0,t,r),s=Ld(a,n.length,i),l=(c=s)>=70?"high":c>=40?"medium":"low";var c;const d=function(e,t,n,o){if(0===e.length)return"Complete!";const r=[],a=e.includes("Rainbow"),i=e.includes("Gold");if(a||i)if("produce"===n)if(o.hasRainbowGranter||o.hasGoldGranter){const e=[];a&&o.hasRainbowGranter&&e.push("Rainbow"),i&&o.hasGoldGranter&&e.push("Gold"),e.length>0?r.push(`Use ${e.join(" and/or ")} Pets`):r.push("‚ö†Ô∏è Rare without Granters")}else r.push("‚ö†Ô∏è Rare without Granters");else r.push("Hatch eggs (0.1-1%)");const s=e.includes("Wet"),l=e.includes("Chilled"),c=e.includes("Frozen");s&&r.push("Rain (~20-35min)"),l&&r.push("Snow (~20-35min)"),c&&r.push("Wet+Chilled (~30-45min)");const d=e.includes("Dawnlit")||e.includes("Ambershine"),u=e.includes("Amberlit"),p=e.includes("Dawncharged"),m=e.includes("Ambercharged");d&&r.push("‚ö†Ô∏è Log before charging! Dawn event"),u&&r.push("‚ö†Ô∏è Log before charging! Amber event"),p&&(o.hasDawnbinder?r.push("Dawnlit + Dawnbinder (25%/min)"):r.push("‚ö†Ô∏è Need Dawnbinder")),m&&(o.hasMoonbinder?r.push("Amberlit + Moonbinder (25%/min)"):r.push("‚ö†Ô∏è Need Moonbinder")),(e.includes("Max Weight")||e.includes("Max"))&&("pet"===n?r.push("‚ö†Ô∏è Hatch at lvl 70+ (rare)"):r.push("Needs Size Boost ability")),"produce"===n&&["Starweaver","Moonbinder","Dawnbinder"].includes(t)&&e.includes("Normal")&&r.unshift("üåü Log NORMAL first!");return r.join(" | ")||"Grow normally"}(n,e,t,r),u=function(e,t,n,o,r){const a=[];return n>=90?a.push(`Almost complete (${n.toFixed(0)}%)`):n>=70&&a.push(`Good progress (${n.toFixed(0)}%)`),1===r?a.push("Just 1 variant away from completion"):2===r?a.push("Only 2 variants remaining"):r<=4&&a.push(`${r} variants remaining`),"easy"===o?a.push("Quick and easy to complete"):"medium"===o?a.push("Moderate effort required"):"hard"===o?a.push("Challenging but achievable"):"very-hard"===o&&a.push("Very difficult - requires rare conditions"),a}(0,0,a,i,n.length),p=function(e,t){if(0===e.length)return"Complete";if("impossible"===t)return"Impossible without required resources";const n=function(e){switch(e){case"easy":return"20-30 minutes";case"medium":return"30-45 minutes";case"hard":return"Several hours to 1 day";case"very-hard":return"Days to weeks"}}(t);return 1===e.length?n:2===e.length?"easy"===t?"30-60 minutes":"medium"===t?"1-2 hours":"hard"===t?"1-2 days":"1-2 weeks":e.length<=4?"easy"===t?"1-2 hours":"medium"===t?"2-4 hours":"hard"===t?"2-4 days":"2-4 weeks":"easy"===t?"2-4 hours":"medium"===t?"4-8 hours":"hard"===t?"1 week":"1+ month"}(n,i);return{species:e,type:t,priority:l,missingVariants:n,completionPct:a,difficulty:i,estimatedTime:p,strategy:d,reasons:u}}async function Bd(e){const t=await async function(){const e={hasRainbowGranter:!1,hasGoldGranter:!1,hasMutationBoost:!1,hasDawnbinder:!1,hasMoonbinder:!1,granterCount:0,granterStrengthAvg:0};try{let t=0;const n=xr();s(`[JOURNAL-GRANTER] Checking ${n.length} active pets`);for(const a of n){const n=a.abilities||[],o=a.strength??100,r=n.some(e=>{const t="string"==typeof e?e:e?.type||e?.abilityType||"";return t.toLowerCase().includes("rainbow")&&t.toLowerCase().includes("grant")}),i=n.some(e=>{const t="string"==typeof e?e:e?.type||e?.abilityType||"";return t.toLowerCase().includes("gold")&&t.toLowerCase().includes("grant")});r&&(s(`[JOURNAL-GRANTER] Found Rainbow Granter in active pets: ${a.species||"unknown"}`),e.hasRainbowGranter=!0,e.granterCount++,t+=o),i&&(s(`[JOURNAL-GRANTER] Found Gold Granter in active pets: ${a.species||"unknown"}`),e.hasGoldGranter=!0,e.granterCount++,t+=o),(n.includes("Crop Mutation Boost I")||n.includes("Crop Mutation Boost II"))&&(e.hasMutationBoost=!0)}const o=await is();if(o?.items){const t=o.items.filter(e=>"Pet"===e.itemType);s(`[JOURNAL-GRANTER] Checking ${t.length} pets in inventory`);for(const n of t){if("Pet"!==n.itemType)continue;const t=n.abilities||[],o=(n.strength,t.some(e=>{const t="string"==typeof e?e:e?.type||e?.abilityType||"";return t.toLowerCase().includes("rainbow")&&t.toLowerCase().includes("grant")})),r=t.some(e=>{const t="string"==typeof e?e:e?.type||e?.abilityType||"";return t.toLowerCase().includes("gold")&&t.toLowerCase().includes("grant")});o&&(s(`[JOURNAL-GRANTER] Found Rainbow Granter in inventory: ${n.species||"unknown"}`),e.hasRainbowGranter=!0),r&&(s(`[JOURNAL-GRANTER] Found Gold Granter in inventory: ${n.species||"unknown"}`),e.hasGoldGranter=!0),(t.includes("Crop Mutation Boost I")||t.includes("Crop Mutation Boost II"))&&(e.hasMutationBoost=!0),"Dawnbinder"===n.species&&(e.hasDawnbinder=!0),"Moonbinder"===n.species&&(e.hasMoonbinder=!0)}}const r=$("myPetHutchAtom");if(r){const t=await F(r),n=t?.pets||[];s(`[JOURNAL-GRANTER] Checking ${n.length} pets in hutch`);for(const o of n){const t=o.abilities||[],n=t.some(e=>{const t="string"==typeof e?e:e?.type||e?.abilityType||"";return t.toLowerCase().includes("rainbow")&&t.toLowerCase().includes("grant")}),r=t.some(e=>{const t="string"==typeof e?e:e?.type||e?.abilityType||"";return t.toLowerCase().includes("gold")&&t.toLowerCase().includes("grant")});n&&(s(`[JOURNAL-GRANTER] Found Rainbow Granter in hutch: ${o.species||"unknown"}`),e.hasRainbowGranter=!0),r&&(s(`[JOURNAL-GRANTER] Found Gold Granter in hutch: ${o.species||"unknown"}`),e.hasGoldGranter=!0),(t.includes("Crop Mutation Boost I")||t.includes("Crop Mutation Boost II"))&&(e.hasMutationBoost=!0)}}e.granterCount>0&&(e.granterStrengthAvg=t/e.granterCount),s(`[JOURNAL-GRANTER] Final detection results: Rainbow=${e.hasRainbowGranter}, Gold=${e.hasGoldGranter}, Granters=${e.granterCount}, MutationBoost=${e.hasMutationBoost}`)}catch(t){s("‚ùå Error detecting player resources:",t)}return e}(),n=[];for(const o of e.produce){const e=o.variants.filter(e=>!e.collected).map(e=>e.variant);if(0===e.length)continue;const r=Dd(o.species,"produce",e,o.variants.length,t);n.push(r)}for(const o of e.pets){const e=o.variants.filter(e=>!e.collected).map(e=>e.variant);if(0===e.length)continue;const r=Dd(o.species,"pet",e,o.variants.length,t);n.push(r)}return n}function Hd(e){const t=[...e].sort((e,t)=>{const n=Ld(e.completionPct,e.missingVariants.length,e.difficulty);return Ld(t.completionPct,t.missingVariants.length,t.difficulty)-n}).filter(e=>"impossible"!==e.difficulty).slice(0,10),n=t.reduce((e,t)=>e+t.missingVariants.length,0),o=t.some(e=>"very-hard"===e.difficulty),r=t.some(e=>"hard"===e.difficulty);let a="1-2 weeks";return a=o?"2-4 weeks":r?"1-2 weeks":t.every(e=>"easy"===e.difficulty)?"2-3 days":"4-7 days",{steps:t,estimatedTime:a,expectedCompletion:n}}function jd(e){return e.filter(e=>e.missingVariants.length<=2&&("easy"===e.difficulty||"medium"===e.difficulty)).sort((e,t)=>e.missingVariants.length-t.missingVariants.length).slice(0,10)}function Gd(e){return e.filter(e=>"hard"===e.difficulty||"very-hard"===e.difficulty).sort((e,t)=>{const n=["easy","medium","hard","very-hard","impossible"];return n.indexOf(t.difficulty)-n.indexOf(e.difficulty)}).slice(0,10)}const Wd=Object.freeze(Object.defineProperty({__proto__:null,generateJournalStrategy:async function(){try{const e=await zd();if(!e)return s("‚ö†Ô∏è Could not get journal summary"),null;const t=await Bd(e),n={recommendedFocus:t.sort((e,t)=>{const n=Ld(e.completionPct,e.missingVariants.length,e.difficulty);return Ld(t.completionPct,t.missingVariants.length,t.difficulty)-n}).slice(0,10),fastestPath:Hd(t),lowHangingFruit:jd(t),longTermGoals:Gd(t)};return s(`[JOURNAL] Generated strategy: ${n.recommendedFocus.length} recommendations, ${n.fastestPath.steps.length} fastest path steps`),n}catch(e){return s("‚ùå Error generating journal strategy:",e),null}},getDifficultyDescription:function(e){switch(e){case"easy":return"Easy";case"medium":return"Medium";case"hard":return"Hard";case"very-hard":return"Very Hard";case"impossible":return"Impossible"}},getDifficultyEmoji:function(e){switch(e){case"easy":return"üü¢";case"medium":return"üü°";case"hard":return"üü†";case"very-hard":return"üî¥";case"impossible":return"‚õî"}},getPriorityEmoji:function(e){switch(e){case"high":return"üî¥";case"medium":return"üü°";case"low":return"‚ö™"}}},Symbol.toStringTag,{value:"Module"}));let Od=new Set;const _d=Object.freeze(Object.defineProperty({__proto__:null,resetPetHatchingTracker:function(){Od.clear(),function(){try{m.set("qpm.petHatchingTracker.knownPetIds.v1",Array.from(Od))}catch(e){s("‚ö†Ô∏è Failed to save known pet IDs to storage",e)}}(),s("üóëÔ∏è Pet hatching tracker reset - all known pet IDs cleared")}},Symbol.toStringTag,{value:"Module"})),Vd=["PetXpBoost","PetXpBoostII"];function Ud(e){if(!e)return null;const t=e.match(/\((\d+)\)/);return t&&t[1]?parseInt(t[1],10):null}async function Xd(e,t,n=10){const o=await async function(e){const t=[];for(const o of e){if(!o.species||null===o.xp||null===o.strength)continue;const e=ud(o.species);if(!e)continue;const n=Math.floor(o.xp/e),r=Math.min(30,n),a=o.strength-r,i=Math.min(a+30,100);if(o.strength>=i)continue;const s=i-o.strength,l=e-o.xp%e+e*(s-1);t.push({name:o.name||o.species,species:o.species,level:o.strength,xp:o.xp,maxStr:i,xpNeeded:l,xpPerLevel:e,source:"active"})}try{const e=$("myInventoryAtom");if(e){const n=await F(e);if(n&&Array.isArray(n.items))for(const e of n.items){const n=e.petSpecies||e.species;if("Pet"!==e.itemType||!n||null===e.xp||void 0===e.xp)continue;const o=ud(n);if(!o)continue;let r,a;if(null!==e.strength&&void 0!==e.strength){r=e.strength;const t=Math.floor(e.xp/o),n=r-Math.min(30,t);a=Math.min(n+30,100)}else{const t=Ud(e.name);if(!t||t<80||t>100)continue;a=t;const n=a-30,i=Math.floor(e.xp/o);r=n+Math.min(30,i)}if(r>=a)continue;const i=a-r,s=o-e.xp%o+o*(i-1);t.push({name:e.name||n,species:n,level:r,xp:e.xp,maxStr:a,xpNeeded:s,xpPerLevel:o,source:"inventory"})}}}catch(n){s("‚ö†Ô∏è Failed to read inventory for near max level pets:",n)}try{const e=$("myPetHutchPetItemsAtom");if(e){const n=await F(e);if(Array.isArray(n))for(const e of n){const n=e.petSpecies||e.species;if(!n||null===e.xp||void 0===e.xp)continue;const o=ud(n);if(!o)continue;let r,a;if(null!==e.strength&&void 0!==e.strength){r=e.strength;const t=Math.floor(e.xp/o),n=r-Math.min(30,t);a=Math.min(n+30,100)}else{const t=Ud(e.name);if(!t||t<80||t>100)continue;a=t;const n=a-30,i=Math.floor(e.xp/o);r=n+Math.min(30,i)}if(r>=a)continue;const i=a-r,s=o-e.xp%o+o*(i-1);t.push({name:e.name||n,species:n,level:r,xp:e.xp,maxStr:a,xpNeeded:s,xpPerLevel:o,source:"hutch"})}}}catch(n){s("‚ö†Ô∏è Failed to read hutch for near max level pets:",n)}return t}(e);return o.sort((e,t)=>e.xpNeeded-t.xpNeeded).slice(0,n)}function Jd(e){const t=[];if(!e.abilities||0===e.abilities.length)return t;for(const n of e.abilities){if(!n)continue;const e=Wa(n);e&&("continuous"===e.trigger&&Vd.includes(e.id)&&t.push({ability:e,rawName:n}))}return t}function Kd(e,t,n=!0){const o=document.createElement("div");o.style.cssText="\n    border-bottom: 1px solid var(--qpm-border, #444);\n  ";const r=document.createElement("div");r.style.cssText="\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 10px 16px;\n    background: var(--qpm-surface-2, #222);\n    cursor: pointer;\n    user-select: none;\n  ";const a=document.createElement("div");a.textContent=e,a.style.cssText="\n    color: var(--qpm-text, #fff);\n    font-size: 13px;\n    font-weight: 600;\n  ";const i=document.createElement("span");i.textContent=n?"‚ñº":"‚ñ≤",i.style.cssText="\n    color: var(--qpm-text-muted, #aaa);\n    font-size: 10px;\n  ",r.appendChild(a),r.appendChild(i);const s=document.createElement("div");s.style.cssText=`\n    display: ${n?"block":"none"};\n    padding: 0;\n  `;const l=()=>{const e="block"===s.style.display;s.style.display=e?"none":"block",i.textContent=e?"‚ñ≤":"‚ñº"};return r.onclick=l,o.appendChild(r),o.appendChild(s),{root:o,content:s,toggle:l}}let Qd={species:new Set,sources:new Set(["active","inventory","hutch"])};async function Yd(e){try{const t=await Xd(e.latestPets,e.totalTeamXpPerHour,50);if(0===t.length)return void(e.nearMaxLevelContainer.innerHTML='\n        <div style="color: var(--qpm-text-muted, #aaa); font-style: italic;">\n          No pets near max level (all pets are either at max level or don\'t have enough data)\n        </div>\n      ');const n=[...new Set(t.map(e=>e.species))].sort();let o='<div style="font-weight: 600; margin-bottom: 8px; color: var(--qpm-accent, #4CAF50);">Pets Closest to Max Level:</div>';o+='<div style="margin-bottom: 12px; padding: 8px; background: rgba(255, 255, 255, 0.05); border-radius: 4px;">',o+='<div style="font-size: 11px; font-weight: 600; margin-bottom: 4px; color: var(--qpm-text-muted, #aaa);">Filter by Species:</div>',o+='<div style="display: flex; flex-wrap: wrap; gap: 6px;">';const r=0===Qd.species.size;o+=`<button\n      onclick="window.qpmNearMaxToggleSpecies('__ALL__')"\n      style="\n        padding: 4px 8px;\n        font-size: 11px;\n        background: ${r?"var(--qpm-accent, #4CAF50)":"rgba(255, 255, 255, 0.1)"};\n        color: var(--qpm-text, #fff);\n        border: 1px solid ${r?"var(--qpm-accent, #4CAF50)":"rgba(255, 255, 255, 0.2)"};\n        border-radius: 4px;\n        cursor: pointer;\n        font-weight: ${r?"600":"400"};\n      ">All</button>`;for(const e of n){const t=0===Qd.species.size||Qd.species.has(e);o+=`<button\n        onclick="window.qpmNearMaxToggleSpecies('${e}')"\n        style="\n          padding: 4px 8px;\n          font-size: 11px;\n          background: ${t?"var(--qpm-accent, #4CAF50)":"rgba(255, 255, 255, 0.1)"};\n          color: var(--qpm-text, #fff);\n          border: 1px solid ${t?"var(--qpm-accent, #4CAF50)":"rgba(255, 255, 255, 0.2)"};\n          border-radius: 4px;\n          cursor: pointer;\n          font-weight: ${t?"600":"400"};\n        ">${e}</button>`}o+="</div>",o+='<div style="font-size: 11px; font-weight: 600; margin: 8px 0 4px 0; color: var(--qpm-text-muted, #aaa);">Filter by Location:</div>',o+='<div style="display: flex; flex-wrap: wrap; gap: 6px;">';const a=[{key:"active",label:"Active",icon:"üü¢"},{key:"inventory",label:"Inventory",icon:"üì¶"},{key:"hutch",label:"Hutch",icon:"üè†"}];for(const e of a){const t=Qd.sources.has(e.key);o+=`<button\n        onclick="window.qpmNearMaxToggleSource('${e.key}')"\n        style="\n          padding: 4px 8px;\n          font-size: 11px;\n          background: ${t?"var(--qpm-accent, #4CAF50)":"rgba(255, 255, 255, 0.1)"};\n          color: var(--qpm-text, #fff);\n          border: 1px solid ${t?"var(--qpm-accent, #4CAF50)":"rgba(255, 255, 255, 0.2)"};\n          border-radius: 4px;\n          cursor: pointer;\n          font-weight: ${t?"600":"400"};\n        ">${e.icon} ${e.label}</button>`}o+="</div>",o+="</div>";const i=t.filter(e=>!(Qd.species.size>0&&!Qd.species.has(e.species))&&!!Qd.sources.has(e.source)).slice(0,10);if(0===i.length)return o+='<div style="color: var(--qpm-text-muted, #aaa); font-style: italic; margin-top: 8px;">No pets match the current filters</div>',void(e.nearMaxLevelContainer.innerHTML=o);o+=`<div style="margin-top: 8px; font-size: 10px; color: var(--qpm-text-muted, #aaa);">Showing ${i.length} of ${t.length} pets</div>`;for(const s of i){const t="active"===s.source?"üü¢":"inventory"===s.source?"üì¶":"üè†",n="active"===s.source?e.totalTeamXpPerHour:3600;let r="‚Äî";if(n>0&&s.xpNeeded>0&&s.maxStr){const e=fd(0,s.xpNeeded,n);if(e)if(e.hours>=24){const t=Math.floor(e.hours/24);r=`${t}d ${e.hours%24}h ${e.minutes}m`}else r=`${e.hours}h ${e.minutes}m`}o+=`\n        <div style="padding: 4px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">\n          <span style="color: var(--qpm-text, #fff);">${t} ${s.name} (${s.species})</span>\n          <span style="color: var(--qpm-text-muted, #aaa); margin-left: 8px;">Lv${s.level} ‚Üí Lv${s.maxStr||"?"}</span>\n          <span style="color: var(--qpm-warning, #FF9800); margin-left: 8px;">(${r})</span>\n          <span style="color: var(--qpm-positive, #4CAF50); margin-left: 8px;">(${so(s.xp)} XP, needs ${so(s.xpNeeded)})</span>\n        </div>\n      `}e.nearMaxLevelContainer.innerHTML=o}catch(t){s("‚ö†Ô∏è Failed to update near max level display:",t),e.nearMaxLevelContainer.innerHTML='\n      <div style="color: var(--qpm-danger, #f44336);">\n        Failed to load near max level pets\n      </div>\n    '}}function Zd(e){e.petLevelTbody.innerHTML="",e.tbody.innerHTML="";const t=[];for(const i of e.latestPets){const e=Jd(i);for(const{ability:n,rawName:o}of e){const e=cd(i,n.id,o,n.baseProbability??0,n.effectValuePerProc??0);t.push(e)}}e.latestStats=t;const n=t.length>0?function(e){const t=e.reduce((e,t)=>e+t.expectedXpPerHour,0),n=e.reduce((e,t)=>e+t.expectedProcsPerHour,0),o=100*(1-e.map(e=>e.actualChancePerSecond/100).reduce((e,t)=>e*(1-t),1)),r=60*o,a=e.map(e=>e.lastProcAt).filter(e=>null!==e);return{totalXpPerHour:t,totalProcsPerHour:n,combinedChancePerSecond:o,combinedChancePerMinute:r,lastProcAt:a.length>0?Math.max(...a):null,totalProcCount:e.reduce((e,t)=>e+t.procCount,0)}}(t):null,o=n?n.totalXpPerHour:0;if(e.totalTeamXpPerHour=3600+o,0===t.length)e.tbody.innerHTML='\n      <div style="color: var(--qpm-warning, #FF9800); font-style: italic;">\n        ‚ö†Ô∏è No pets with XP Boost abilities detected. Equip pets with XP Boost I or XP Boost II to generate team-wide XP.\n      </div>\n      <div style="margin-top: 8px; color: var(--qpm-text-muted, #aaa); font-size: 11px;">\n        Each active pet still receives 3,600 XP/hour base (1 XP/second).\n      </div>\n    ';else{const r=t.map(e=>`${e.petName} (${e.abilityName}, ${e.actualChancePerMinute.toFixed(2)}%/min)`).join(", ");e.tbody.innerHTML=`\n      <div style="margin-bottom: 12px; padding: 10px; background: var(--qpm-surface-2, #1a1a1a); border-left: 3px solid var(--qpm-accent, #4CAF50); border-radius: 4px;">\n        <div style="font-size: 12px; font-weight: 600; margin-bottom: 6px; color: var(--qpm-accent, #4CAF50);">XP Rate Per Pet (Each Active Pet Receives):</div>\n        <div style="margin-left: 8px; font-size: 11px; color: var(--qpm-text, #fff); line-height: 1.6;">\n          ‚Ä¢ Base: <span style="color: var(--qpm-warning, #FF9800); font-weight: 600; font-family: monospace;">3,600 XP/hr</span> <span style="color: var(--qpm-text-muted, #aaa);">(1 XP/second, always)</span><br/>\n          ‚Ä¢ Ability Bonus: <span style="color: var(--qpm-warning, #FF9800); font-weight: 600; font-family: monospace;">+${so(o)} XP/hr</span> <span style="color: var(--qpm-text-muted, #aaa);">(shared by all pets)</span><br/>\n          ‚Ä¢ <strong style="color: var(--qpm-accent, #4CAF50);">Total: ${so(e.totalTeamXpPerHour)} XP/hr per pet</strong>\n        </div>\n      </div>\n      <div style="margin-bottom: 8px;">\n        <strong style="color: var(--qpm-accent, #4CAF50);">Combined Chance:</strong>\n        <span style="color: var(--qpm-accent, #4CAF50); font-weight: 600; font-family: monospace;">${n.combinedChancePerMinute.toFixed(2)}%/min</span>\n        <span style="color: var(--qpm-text-muted, #aaa); font-size: 11px; margin-left: 8px;">(~${n.totalProcsPerHour.toFixed(1)} procs/hr)</span>\n      </div>\n      <div style="margin-bottom: 6px; color: var(--qpm-text-muted, #aaa); font-size: 11px; font-style: italic;">\n        Note: Each ability rolls independently every second. When an XP Boost procs, all active pets receive the XP.\n      </div>\n      <div>\n        <strong style="color: var(--qpm-accent, #4CAF50);">XP Boost Pets:</strong>\n        <span style="color: var(--qpm-text, #fff);">${r}</span>\n      </div>\n    `}0===t.length?e.summaryText.textContent="‚ö†Ô∏è No pets with XP Boost abilities detected. Each pet receives 3,600 XP/hr base only.":e.summaryText.innerHTML=`\n      <strong>Each Pet Receives:</strong> ${so(e.totalTeamXpPerHour)} XP/hr (${so(3600)} base + ${so(o)} ability bonus) ‚Ä¢\n      <strong>Active Pets:</strong> ${e.latestPets.length} (${t.length} with XP Boost)\n    `;for(const i of e.latestPets)eu(e.petLevelTbody,i,e.totalTeamXpPerHour);const r=new Set;for(const i of e.latestPets)i.species&&r.add(i.species);const a={...sd.speciesXpPerLevel};for(const i of Object.keys(a))r.add(i);e.lastKnownSpecies=r,Yd(e)}function eu(e,t,n){const o=e.insertRow();o.style.cssText="border-bottom: 1px solid var(--qpm-border, #444);";const r=o.insertCell(),a=t.species&&t.targetScale?md(t.targetScale,t.species):null,i=t.name||t.species||"Unknown";a?r.innerHTML=`\n      <div style="font-weight: 500; color: var(--qpm-text, #fff);">${i}</div>\n      <div style="font-size: 10px; color: var(--qpm-text-muted, #888); margin-top: 2px;">MAX STR ${a}</div>\n    `:r.textContent=i,r.style.cssText="\n    padding: 10px 12px;\n    color: var(--qpm-text, #fff);\n  ",r.title=`Slot: ${t.slotIndex}\nPet ID: ${t.petId||"N/A"}\nStrength: ${t.strength??"N/A"}${a?`\nMAX STR: ${a}`:""}${t.targetScale?`\nTarget Scale: ${t.targetScale.toFixed(2)}`:""}`;const s=o.insertCell();s.textContent=t.species||"‚Äî",s.style.cssText="\n    padding: 10px 12px;\n    color: var(--qpm-text-muted, #aaa);\n  ";const l=o.insertCell(),c=Jd(t);if(c.length>0){const e=c.map(e=>e.rawName).join(", ");l.textContent=e,l.style.cssText="\n      padding: 10px 12px;\n      color: var(--qpm-accent, #4CAF50);\n      font-size: 11px;\n    ",l.title="This pet generates XP for the team"}else l.textContent="‚Äî",l.style.cssText="\n      padding: 10px 12px;\n      color: var(--qpm-text-muted, #666);\n      font-size: 11px;\n    ";const d=o.insertCell();null!==t.strength&&void 0!==t.strength?(d.textContent=String(t.strength),d.style.cssText="\n      padding: 10px 12px;\n      text-align: right;\n      color: var(--qpm-accent, #4CAF50);\n      font-family: monospace;\n      font-weight: 600;\n    ",d.title=`Current Strength: ${t.strength}\n(Strength increases by 1 each time XP threshold is reached)`):(d.textContent="‚ö†Ô∏è ‚Äî",d.style.cssText="\n      padding: 10px 12px;\n      text-align: right;\n      color: var(--qpm-warning, #FF9800);\n      font-family: monospace;\n      font-weight: 600;\n    ",d.title="Strength data not available");const u=o.insertCell();u.textContent=null!==t.xp?so(t.xp):"‚Äî",u.style.cssText="\n    padding: 10px 12px;\n    text-align: right;\n    color: var(--qpm-warning, #FF9800);\n    font-family: monospace;\n  ";const p=o.insertCell();if(p.style.cssText="\n    padding: 10px 12px;\n    text-align: right;\n    color: var(--qpm-text, #fff);\n    min-width: 200px;\n  ",t.species&&null!==t.xp&&null!==t.strength){const e=ud(t.species);if(e){const n=Math.floor(t.xp/e),o=Math.min(30,n),r=t.strength-o,a=Math.min(r+30,100),i=t.xp%e,s=i/e*100;t.strength>=a?(p.innerHTML=`\n          <div style="color: var(--qpm-accent, #4CAF50); font-weight: 600; font-size: 12px;">üåü MAX STR ${a}</div>\n          <div style="font-size: 10px; color: var(--qpm-text-muted, #aaa); margin-top: 2px;">No further STR gains</div>\n        `,p.title=`Pet is at MAX Strength (${a})\nTotal XP: ${so(t.xp)}\nLevels gained from hatch: ${n}${t.targetScale?`\nTarget Scale: ${t.targetScale.toFixed(2)}`:""}`):(p.innerHTML=`\n          <div style="font-size: 11px; margin-bottom: 4px;">${so(i)} / ${so(e)} (${Math.min(100,s).toFixed(1)}%)</div>\n          <div style="width: 100%; height: 8px; background: #333; border-radius: 4px; overflow: hidden;">\n            <div style="width: ${Math.min(100,s).toFixed(1)}%; height: 100%; background: linear-gradient(90deg, #4CAF50, #8BC34A);"></div>\n          </div>\n        `,p.title=`Total XP: ${so(t.xp)}\nLevels gained from hatch: ${n}${a?`\nMAX STR: ${a}`:""}${t.targetScale?`\nTarget Scale: ${t.targetScale.toFixed(2)}`:""}`)}else p.innerHTML='<span style="color: var(--qpm-text-muted, #aaa); font-size: 11px;">Configure XP/level</span>'}else p.textContent="‚Äî";const m=o.insertCell();if(m.style.cssText="\n    padding: 10px 12px;\n    text-align: right;\n    color: var(--qpm-text, #fff);\n    font-family: monospace;\n    font-weight: 500;\n  ",t.species&&null!==t.xp&&null!==t.strength){const e=ud(t.species);if(e){const o=Math.floor(t.xp/e),r=Math.min(30,o),a=t.strength-r,i=Math.min(a+30,100);if(t.strength>=i)m.innerHTML='<span style="color: var(--qpm-accent, #4CAF50); font-weight: 600;">‚Äî</span>',m.title="Pet is at MAX Strength - no further STR gains possible";else if(n>0){const o=t.xp%e,r=fd(o,e,n);r?(m.innerHTML=`\n            <div style="color: var(--qpm-positive, #4CAF50);">${r.hours}h ${r.minutes}m</div>\n            <div style="font-size: 10px; color: var(--qpm-text-muted, #aaa); margin-top: 2px;">${so(n)} XP/hr</div>\n          `,m.title=`This pet receives ${so(n)} XP/hr\n(3,600 base + ability bonus shared by all pets)`):o>=e?m.innerHTML='<span style="color: var(--qpm-accent, #4CAF50); font-weight: 600;">Ready!</span>':m.textContent="‚Äî"}else 0===n?m.innerHTML='<span style="color: var(--qpm-text-muted, #aaa); font-size: 11px;">No XP boost</span>':m.textContent="‚Äî"}else m.innerHTML='<span style="color: var(--qpm-text-muted, #aaa); font-size: 11px;">‚Äî</span>'}else m.textContent="‚Äî";const f=o.insertCell();if(f.style.cssText="\n    padding: 10px 12px;\n    text-align: right;\n    color: var(--qpm-text, #fff);\n    font-family: monospace;\n    font-weight: 500;\n  ",t.species&&null!==t.xp&&null!==t.strength){const e=ud(t.species);if(e){const o=Math.floor(t.xp/e),r=Math.min(30,o),a=t.strength-r,i=Math.min(a+30,100);if(t.strength>=i)f.innerHTML='<span style="color: var(--qpm-accent, #4CAF50); font-weight: 600;">‚Äî</span>',f.title="Pet is already at MAX Strength";else if(n>0){const o=i-t.strength,r=e-t.xp%e+e*(o-1),a=r/n,s=Math.floor(a/24),l=Math.floor(a%24),c=Math.floor(a%1*60);let d="";d=s>0?`${s}d ${l}h`:l>0?`${l}h ${c}m`:`${c}m`,f.innerHTML=`\n          <div style="color: var(--qpm-warning, #FF9800); font-weight: 600;">${d}</div>\n          <div style="font-size: 10px; color: var(--qpm-text-muted, #aaa); margin-top: 2px;">${o} STR left</div>\n        `,f.title=`${o} STR levels remaining\n${so(r)} XP needed\nThis pet receives ${so(n)} XP/hr\n(3,600 base + ability bonus)`}else 0===n?f.innerHTML='<span style="color: var(--qpm-text-muted, #aaa); font-size: 11px;">No XP boost</span>':(f.innerHTML='<span style="color: var(--qpm-text-muted, #aaa); font-size: 11px;">‚Äî</span>',f.title="Max STR unknown")}else f.innerHTML='<span style="color: var(--qpm-text-muted, #aaa); font-size: 11px;">‚Äî</span>'}else f.textContent="‚Äî"}let tu=null;const nu=Object.freeze(Object.defineProperty({__proto__:null,createXpTrackerWindow:function(){const e=document.createElement("div");e.style.cssText="\n    position: fixed;\n    top: 80px;\n    right: 20px;\n    width: 850px;\n    max-height: 80vh;\n    overflow-y: auto;\n    background: var(--qpm-background, rgba(0, 0, 0, 0.92));\n    border: 2px solid var(--qpm-border, #555);\n    border-radius: 8px;\n    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);\n    z-index: 10002;\n    font-family: Arial, sans-serif;\n    display: none;\n  ";const t=document.createElement("div");t.style.cssText="\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 12px 16px;\n    background: var(--qpm-surface-1, #1a1a1a);\n    border-bottom: 2px solid var(--qpm-border, #555);\n    cursor: move;\n  ";const n=document.createElement("h3");n.textContent="‚ú® XP Tracker",n.style.cssText="\n    margin: 0;\n    color: var(--qpm-text, #fff);\n    font-size: 16px;\n    font-weight: 600;\n  ";const o=document.createElement("button");o.textContent="‚úï",o.style.cssText="\n    background: transparent;\n    border: none;\n    color: var(--qpm-text, #fff);\n    font-size: 20px;\n    cursor: pointer;\n    padding: 0 8px;\n    line-height: 1;\n  ",o.onclick=()=>{e.style.display="none"},t.appendChild(n),t.appendChild(o),e.appendChild(t);const r=document.createElement("div");r.style.cssText="\n    padding: 12px 16px;\n    background: var(--qpm-surface-1, #1a1a1a);\n    border-bottom: 1px solid var(--qpm-border, #444);\n  ";const a=document.createElement("div");a.style.cssText="\n    color: var(--qpm-text, #fff);\n    font-size: 13px;\n    line-height: 1.6;\n  ",a.textContent="Loading XP data...",r.appendChild(a),e.appendChild(r);const i=Kd("üêæ All Active Pets"),s=function(){const e=document.createElement("table");e.style.cssText="\n    width: 100%;\n    border-collapse: collapse;\n    font-size: 12px;\n  ";const t=document.createElement("thead");t.innerHTML='\n    <tr style="background: var(--qpm-surface-2, #222); border-bottom: 2px solid var(--qpm-border, #555);">\n      <th style="padding: 10px 12px; text-align: left; color: var(--qpm-text, #fff); font-weight: 600;">Pet</th>\n      <th style="padding: 10px 12px; text-align: left; color: var(--qpm-text, #fff); font-weight: 600;">Species</th>\n      <th style="padding: 10px 12px; text-align: left; color: var(--qpm-text, #fff); font-weight: 600;">XP Ability</th>\n      <th style="padding: 10px 12px; text-align: right; color: var(--qpm-text, #fff); font-weight: 600;">Strength</th>\n      <th style="padding: 10px 12px; text-align: right; color: var(--qpm-text, #fff); font-weight: 600;">Current XP</th>\n      <th style="padding: 10px 12px; text-align: right; color: var(--qpm-text, #fff); font-weight: 600;">Progress to Next STR</th>\n      <th style="padding: 10px 12px; text-align: right; color: var(--qpm-text, #fff); font-weight: 600;">Time to Next STR</th>\n      <th style="padding: 10px 12px; text-align: right; color: var(--qpm-text, #fff); font-weight: 600;">Time to Max STR</th>\n    </tr>\n  ';const n=document.createElement("tbody");return e.appendChild(t),e.appendChild(n),e}(),l=s.querySelector("tbody");i.content.appendChild(s),e.appendChild(i.root);const c=Kd("‚ú® XP Generation Summary"),d=document.createElement("div");d.style.cssText="\n    padding: 12px 16px;\n    color: var(--qpm-text, #fff);\n    font-size: 12px;\n    line-height: 1.6;\n  ",c.content.appendChild(d),e.appendChild(c.root);const u=Kd("üèÜ Near Max Level","near-max-level-section",!1),p=document.createElement("div");p.style.cssText="\n    padding: 12px 16px;\n    color: var(--qpm-text, #fff);\n    font-size: 12px;\n    line-height: 1.8;\n    font-family: monospace;\n  ",p.textContent="Loading...",u.content.appendChild(p),e.appendChild(u.root);const m=d,f=document.createElement("tbody");document.body.appendChild(e),function(e,t){let n=0,o=0,r=0,a=0;function i(e){e.preventDefault(),r=e.clientX,a=e.clientY,document.onmouseup=l,document.onmousemove=s}function s(t){t.preventDefault(),n=r-t.clientX,o=a-t.clientY,r=t.clientX,a=t.clientY,e.style.top=e.offsetTop-o+"px",e.style.left=e.offsetLeft-n+"px"}function l(){document.onmouseup=null,document.onmousemove=null}t.onmousedown=i}(e,t);const g={root:e,summaryText:a,petLevelTbody:l,tbody:m,combinedTbody:f,nearMaxLevelContainer:p,updateInterval:null,latestPets:[],latestStats:[],totalTeamXpPerHour:0,lastKnownSpecies:new Set,unsubscribePets:null,unsubscribeXpTracker:null};var h;return g.unsubscribePets=wr(e=>{g.latestPets=e,Zd(g)}),g.unsubscribeXpTracker=(h=()=>{!function(e){e.petLevelTbody.innerHTML="";for(const t of e.latestPets)eu(e.petLevelTbody,t,e.totalTeamXpPerHour)}(g)},ld.push(h),()=>{ld=ld.filter(e=>e!==h)}),g.updateInterval=window.setInterval(()=>{!function(e){const t=e.root.querySelectorAll(".eta-countdown");t.forEach(e=>{const t=parseInt(e.dataset.lastProc??"0",10),n=parseFloat(e.dataset.effectiveRate??"0");if(!n||n<=0)return;const o=ki(t,60/n,n);e.textContent=o.text,e.style.color=o.isOverdue?"var(--qpm-danger, #f44336)":e.classList.contains("combined")?"var(--qpm-accent, #4CAF50)":"var(--qpm-positive, #4CAF50)"})}(g)},1e3),g},hideXpTrackerWindow:function(e){e.root.style.display="none"},setGlobalXpTrackerState:function(e){tu=e,window.qpmNearMaxToggleSpecies=e=>{tu?(alert(`[QPM DEBUG] Filter button clicked!\nSpecies: ${e}\nCurrent filters: ${Array.from(Qd.species).join(", ")||"ALL"}`),"__ALL__"===e?Qd.species.clear():Qd.species.has(e)?Qd.species.delete(e):(Qd.species.size,Qd.species.add(e)),Yd(tu)):alert("[QPM DEBUG] globalXpTrackerState not set! Window not initialized properly.")},window.qpmNearMaxToggleSource=e=>{tu?(alert(`[QPM DEBUG] Location filter clicked!\nSource: ${e}\nCurrent filters: ${Array.from(Qd.sources).join(", ")}`),Qd.sources.has(e)?Qd.sources.delete(e):Qd.sources.add(e),Yd(tu)):alert("[QPM DEBUG] globalXpTrackerState not set! Window not initialized properly.")}},showXpTrackerWindow:function(e){e.root.style.display="block",Zd(e)}},Symbol.toStringTag,{value:"Module"})),ou={weather:["Rain","Snow","Frost"],eggs:["Uncommon Eggs","Rare Eggs","Mythical Eggs","Legendary Eggs"],crops:["Carrot","Strawberry","Aloe","Delphinium","Blueberry","Apple","Tulip","Tomato","Corn","Camellia","Squash","Mushroom","Banana","Grape","Coconut","Lychee","Bamboo"],seeds:["Carrot","Strawberry","Aloe","Delphinium","Blueberry","Apple","Tulip","Tomato","Daffodil","Corn","Watermelon","Pumpkin","Echeveria","Coconut","Banana","Lily","Camellia","Squash","Burro's Tail","Mushroom","Cactus","Bamboo","Chrysanthemum","Grape","Pepper","Lemon","Passion Fruit","Dragon Fruit","Lychee","Sunflower","Starweaver","Dawnbinder","Moonbinder"]};function ru(e){return ou.weather.includes(e)?"weather":ou.eggs.some(t=>e.includes(t))?"egg":ou.crops.includes(e)?"crop":ou.seeds.includes(e)?"seed":"unknown"}const au=[/!!!/,/omg/i,/ping/i,/spam/i,/^\d+/,/\d+\s+[A-Z]/,/stock!!!/i,/vegetables/i,/named/i];function iu(e){if(!function(e){return!(au.some(t=>t.test(e))||e.length>50)}(e))return!1;const t=ru(e);return"seed"===t||"egg"===t}const su=36e6;function lu(e,t){try{if(e.includes("/")){const t=e.split(" ");if(t.length<3)return Date.now();const n=t[0],o=t[1],r=t[2],a=n.split("/").map(Number),i=o.split(":").map(Number);if(3!==a.length||2!==i.length)return Date.now();const s=a[0],l=a[1],c=a[2],d=i[0],u=i[1];let p=d;"pm"===r&&12!==d?p+=12:"am"===r&&12===d&&(p=0);const m=Date.UTC(c,l-1,s,p,u,0,0);return m-su}if(t){const n=e.split(" ");if(n.length<2)return Date.now();const o=n[0],r=n[1],a=o.split(":").map(Number);if(2!==a.length)return Date.now();const i=a[0],s=a[1];let l=i;"pm"===r&&12!==i?l+=12:"am"===r&&12===i&&(l=0);const c=new Date(t).getUTCFullYear(),d=new Date(t).getUTCMonth(),u=new Date(t).getUTCDate(),p=Date.UTC(c,d,u,l,s,0,0);return p-su}return Date.now()}catch(n){return s("‚ö†Ô∏è Failed to parse timestamp:",e,n),Date.now()}}function cu(e){const t=[],n=e.split("|").map(e=>e.trim());for(const o of n){const e=o.match(/@([^@]+?)(?:\s+(\d+))?$/);if(e&&e[1]){const n=e[1].trim();if(!iu(n))continue;const o=e[2]?parseInt(e[2],10):0;t.push({name:n,quantity:o,type:ru(n)})}}return t}function du(e,t){const n=t.map(e=>`${e.name}:${e.quantity}`).join(",");return`${e}-${btoa(n).substring(0,8)}`}async function uu(e){return new Promise((t,n)=>{const o=new FileReader;o.onload=e=>{try{const n=e.target?.result,o=function(e){const t=[],n=(new DOMParser).parseFromString(e,"text/html").querySelectorAll(".chatlog__message-group");let o;for(const r of n){const e=r.querySelector(".chatlog__author");if(!e||!e.textContent?.includes("Magic Shopkeeper"))continue;const n=r.querySelector(".chatlog__timestamp a");if(n){const e=lu(n.textContent?.trim()||"");o=new Date(e)}const a=r.querySelectorAll(".chatlog__message-container");for(const r of a){let e="",n=0;const a=r.querySelector(".chatlog__timestamp a"),i=r.querySelector(".chatlog__short-timestamp");if(a)e=a.textContent?.trim()||"",n=lu(e),o=new Date(n);else{if(!i)continue;e=i.textContent?.trim()||"",n=lu(e,o)}const s=r.querySelector(".chatlog__content");if(!s)continue;const l=s.textContent?.trim()||"";if(!l)continue;const c=cu(l);if(0===c.length)continue;const d={id:du(n,c),timestamp:n,dateString:e,items:c,source:"discord"};t.push(d)}}return s(`üìä Parsed ${t.length} restock events from Discord HTML`),t}(n);t(o)}catch(o){n(o)}},o.onerror=()=>{n(new Error("Failed to read file"))},o.readAsText(e)})}function pu(e){return e.toLocaleString()}function mu(e){return new Date(e).toLocaleString()}function fu(e){const t=Rs(),n=Ds();null!==e.countdownInterval&&(clearInterval(e.countdownInterval),e.countdownInterval=null),e.contentContainer.innerHTML="";const o=function(){const e=document.createElement("div");e.style.cssText="\n    margin-bottom: 20px;\n    padding: 16px;\n    background: rgba(76, 175, 80, 0.1);\n    border-radius: 8px;\n    border: 2px solid rgba(76, 175, 80, 0.3);\n  ";const t=document.createElement("h4");t.textContent="üì° Live Shop Monitoring",t.style.cssText="\n    margin: 0 0 12px 0;\n    color: var(--qpm-accent, #4CAF50);\n    font-size: 14px;\n  ",e.appendChild(t);const n=document.createElement("div"),o=ol;n.style.cssText="\n    margin-bottom: 12px;\n    font-size: 12px;\n    padding: 8px 12px;\n    background: rgba(0, 0, 0, 0.3);\n    border-radius: 4px;\n  ",n.innerHTML=o?'<span style="color: #4CAF50;">‚óè Active</span> - Monitoring shop for restocks in real-time':'<span style="color: #aaa;">‚óã Inactive</span> - Live tracking is not running',e.appendChild(n);const r=document.createElement("p");return r.style.cssText="\n    margin: 0 0 12px 0;\n    font-size: 12px;\n    color: var(--qpm-text-muted, #aaa);\n    line-height: 1.5;\n  ",r.textContent="Automatically detects and records shop restocks while you play.",e.appendChild(r),e}();e.contentContainer.appendChild(o);const r=function(){const e=document.createElement("div");e.style.cssText="\n    margin-bottom: 20px;\n    padding: 16px;\n    background: rgba(255, 255, 255, 0.05);\n    border-radius: 8px;\n    border: 2px dashed rgba(255, 255, 255, 0.2);\n  ";const t=document.createElement("h4");t.textContent="üì• Import Discord Data",t.style.cssText="\n    margin: 0 0 12px 0;\n    color: var(--qpm-accent, #4CAF50);\n    font-size: 14px;\n  ",e.appendChild(t);const n=document.createElement("p");n.style.cssText="\n    margin: 0 0 12px 0;\n    font-size: 12px;\n    color: var(--qpm-text-muted, #aaa);\n    line-height: 1.5;\n  ",n.textContent="Upload a Discord HTML export from the restock channel to import historical data.",e.appendChild(n);const o=document.createElement("input");o.type="file",o.accept=".html",o.style.display="none";const r=document.createElement("button");r.textContent="üìÅ Choose HTML File",r.style.cssText="\n    padding: 8px 16px;\n    background: var(--qpm-accent, #4CAF50);\n    color: white;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 12px;\n    font-weight: 600;\n    margin-right: 8px;\n  ",r.onclick=()=>o.click(),o.onchange=async e=>{const t=e.target,n=t.files?.[0];if(n){r.disabled=!0,r.textContent="‚è≥ Parsing...";try{const e=await uu(n);!function(e){let t=0;const n=new Set($s.map(e=>e.id));for(const o of e)n.has(o.id)||($s.push(o),n.add(o.id),t++);$s.sort((e,t)=>e.timestamp-t.timestamp),zs(),js(),s(`üìä Added ${t} new restock events (${e.length-t} duplicates skipped)`)}(e),r.textContent=`‚úÖ Imported ${e.length} restocks`,setTimeout(()=>{r.disabled=!1,r.textContent="üìÅ Choose HTML File"},3e3)}catch(o){s("‚ùå Failed to parse Discord HTML:",o),r.textContent="‚ùå Import failed",setTimeout(()=>{r.disabled=!1,r.textContent="üìÅ Choose HTML File"},3e3)}}},e.appendChild(o),e.appendChild(r);const a=Rs();if(a.length>0){const t=document.createElement("div");t.style.cssText="display: flex; gap: 8px; margin-top: 12px;";const n=document.createElement("button");n.textContent="üì§ Export HTML",n.style.cssText="\n      padding: 8px 16px;\n      background: rgba(66, 165, 245, 0.2);\n      color: #42A5F5;\n      border: 1px solid #42A5F5;\n      border-radius: 4px;\n      cursor: pointer;\n      font-size: 12px;\n      font-weight: 600;\n    ",n.onclick=()=>{!function(){const e=Rs();if(0===e.length)return void s("‚ö†Ô∏è No restock data to export");const t=[...e].sort((e,t)=>e.timestamp-t.timestamp),n=`<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="utf-8">\n  <title>Shop Restock Data Export</title>\n  <style>\n    body { font-family: Arial, sans-serif; background: #36393f; color: #dcddde; padding: 20px; }\n    .chatlog__message-group { margin-bottom: 20px; padding: 10px; background: #2f3136; border-radius: 4px; }\n    .chatlog__author { font-weight: 600; color: #7289da; margin-bottom: 8px; }\n    .chatlog__message-container { margin: 4px 0; padding: 4px 0; }\n    .chatlog__timestamp { font-size: 11px; color: #72767d; margin-right: 8px; }\n    .chatlog__short-timestamp { font-size: 11px; color: #72767d; margin-right: 8px; }\n    .chatlog__content { color: #dcddde; }\n  </style>\n</head>\n<body>\n  <h1>Shop Restock Data Export</h1>\n  <p>Total Events: ${e.length} | Exported: ${(new Date).toLocaleString()}</p>\n  <p style="font-size: 12px; color: #72767d;">Note: All times are shown in your local timezone (${Intl.DateTimeFormat().resolvedOptions().timeZone})</p>\n\n  <div class="chatlog__message-group">\n    <div class="chatlog__author">Magic Shopkeeper</div>\n${t.map(e=>{const t=new Date(e.timestamp);return`    <div class="chatlog__message-container">\n      <span class="chatlog__timestamp"><a>${t.toLocaleString(void 0,{day:"2-digit",month:"2-digit",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}).replace(",","")}</a></span>\n      <span class="chatlog__short-timestamp">${t.toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit",hour12:!0})}</span>\n      <div class="chatlog__content">${e.items.map(e=>e.quantity>0?`@${e.name} ${e.quantity}`:`@${e.name}`).join(" | ")}</div>\n    </div>`}).join("\n")}\n  </div>\n</body>\n</html>`,o=new Blob([n],{type:"text/html"}),r=URL.createObjectURL(o),a=document.createElement("a");a.href=r,a.download=`qpm-shop-restock-export-${Date.now()}.html`,a.click(),URL.revokeObjectURL(r),s(`‚úÖ Exported ${e.length} restock events to HTML`)}()},t.appendChild(n);const o=document.createElement("button");o.textContent="üóëÔ∏è Clear All Data",o.style.cssText="\n      padding: 8px 16px;\n      background: rgba(244, 67, 54, 0.2);\n      color: #f44336;\n      border: 1px solid #f44336;\n      border-radius: 4px;\n      cursor: pointer;\n      font-size: 12px;\n      font-weight: 600;\n    ",o.onclick=()=>{confirm("Are you sure you want to clear all restock data? This cannot be undone.")&&($s=[],Fs.importedFiles=[],zs(),js(),s("üìä Cleared all restock data"))},t.appendChild(o),e.appendChild(t)}return e}();if(e.contentContainer.appendChild(r),t.length>0){const t=function(){const e=document.createElement("div");e.style.cssText="\n    margin-bottom: 20px;\n    padding: 16px;\n    background: rgba(66, 165, 245, 0.1);\n    border-radius: 8px;\n    border: 2px solid rgba(66, 165, 245, 0.3);\n  ";const t=document.createElement("h4");t.textContent="üîÆ Next Rare Restock Prediction",t.style.cssText="\n    margin: 0 0 12px 0;\n    color: #42A5F5;\n    font-size: 14px;\n  ",e.appendChild(t);const n=[{name:"Sunflower",color:"#FFD700"},{name:"Mythical Eggs",color:"#9C27B0"},{name:"Starweaver",color:"#FFD700"},{name:"Moonbinder",color:"#CE93D8"},{name:"Dawnbinder",color:"#FF9800"}],o=document.createElement("div");o.style.cssText="\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n  ";for(const r of n){const e=Bs(r.name),t=document.createElement("div");t.style.cssText=`\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      padding: 10px 12px;\n      background: rgba(0, 0, 0, 0.3);\n      border-radius: 6px;\n      border-left: 3px solid ${r.color};\n    `;const n=document.createElement("span");n.textContent=r.name,n.style.cssText=`\n      color: ${r.color};\n      font-weight: 600;\n      font-size: 12px;\n    `;const a=document.createElement("span");if(a.style.cssText="\n      color: var(--qpm-text-muted, #aaa);\n      font-size: 11px;\n    ",e){const t=new Date(e),n=e-Date.now(),o=Math.floor(n/36e5),r=Math.floor(o/24);let i="";i=r>0?`~${r}d ${o%24}h`:o>0?`~${o}h`:"Soon";const s=t.toLocaleTimeString([],{hour:"numeric",minute:"2-digit",hour12:!0}),l=t.toLocaleDateString([],{month:"short",day:"numeric"});a.innerHTML=`\n        <span style="color: #42A5F5; font-weight: 600;">${i}</span>\n        <span style="margin-left: 8px; font-size: 10px;">(${s}, ${l})</span>\n      `}else a.textContent="Insufficient data";t.appendChild(n),t.appendChild(a),o.appendChild(t)}return e.appendChild(o),e}();e.contentContainer.appendChild(t);const o=function(e){const t=document.createElement("div");t.style.cssText="\n    margin-bottom: 20px;\n    padding: 16px;\n    background: rgba(255, 255, 255, 0.05);\n    border-radius: 8px;\n  ";const n=document.createElement("h4");n.textContent="üìä Summary Statistics",n.style.cssText="\n    margin: 0 0 12px 0;\n    color: var(--qpm-accent, #4CAF50);\n    font-size: 14px;\n  ",t.appendChild(n);const o=document.createElement("div");o.style.cssText="\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n    gap: 12px;\n  ";const r=[{label:"Total Restocks",value:pu(e.totalRestocks),icon:"üîÑ"},{label:"Unique Items",value:pu(e.uniqueItems),icon:"üì¶"},{label:"Avg Interval",value:`${e.avgRestockInterval.toFixed(1)} min`,icon:"‚è±Ô∏è"},{label:"Total Items",value:pu(e.totalItems),icon:"üìä"}];e.dateRange&&r.push({label:"First Restock",value:mu(e.dateRange.start),icon:"üìÖ"},{label:"Last Restock",value:mu(e.dateRange.end),icon:"üìÖ"});for(const a of r){const e=document.createElement("div");e.style.cssText="\n      padding: 12px;\n      background: rgba(0, 0, 0, 0.3);\n      border-radius: 4px;\n      border: 1px solid rgba(255, 255, 255, 0.1);\n    ";const t=document.createElement("div");t.textContent=`${a.icon} ${a.label}`,t.style.cssText="\n      font-size: 11px;\n      color: var(--qpm-text-muted, #aaa);\n      margin-bottom: 4px;\n    ";const n=document.createElement("div");n.textContent=a.value,n.style.cssText="\n      font-size: 16px;\n      font-weight: 600;\n      color: var(--qpm-text, #fff);\n    ",e.appendChild(t),e.appendChild(n),o.appendChild(e)}return t.appendChild(o),t}(n);e.contentContainer.appendChild(o);const r=function(){const e=document.createElement("div");e.style.cssText="\n    margin-bottom: 20px;\n  ";const t=document.createElement("h4");t.textContent="üéØ Item Statistics",t.style.cssText="\n    margin: 0 0 12px 0;\n    color: var(--qpm-accent, #4CAF50);\n    font-size: 14px;\n  ",e.appendChild(t);const n=Ls(),o=Array.from(n.values()).filter(e=>"unknown"!==e.type).sort((e,t)=>t.totalRestocks-e.totalRestocks),r=document.createElement("table");r.style.cssText="\n    width: 100%;\n    border-collapse: collapse;\n    font-size: 12px;\n  ";const a=document.createElement("thead"),i=document.createElement("tr");i.style.cssText="\n    border-bottom: 2px solid var(--qpm-border, #444);\n    background: rgba(255, 255, 255, 0.05);\n  ";const s=["Item","Type","Restocks","Avg Qty","Rate","Rarity","Last Seen","Next Restock"];for(const c of s){const e=document.createElement("th");e.textContent=c,e.style.cssText="\n      padding: 10px 12px;\n      text-align: left;\n      color: var(--qpm-text-muted, #aaa);\n      font-weight: 600;\n    ",i.appendChild(e)}a.appendChild(i),r.appendChild(a);const l=document.createElement("tbody");for(const c of o){const e=document.createElement("tr");e.style.cssText="\n      border-bottom: 1px solid var(--qpm-border, #444);\n    ";const t={common:"#aaa",uncommon:"#4CAF50",rare:"#42A5F5",mythic:"#9C27B0",divine:"#FF9800",celestial:"#FFD700"};let n="N/A",o="font-size: 11px; color: #aaa;";const r=Bs(c.name);if(r){const e=new Date(r),t=e.toLocaleTimeString([],{hour:"numeric",minute:"2-digit",hour12:!0});n=`${e.toLocaleDateString([],{month:"short",day:"numeric"})} ${t}`,o="font-size: 11px; color: #42A5F5; font-weight: 600;"}const a=[{value:c.name,style:"font-weight: 600;"},{value:c.type,style:"text-transform: capitalize; color: #aaa;"},{value:pu(c.totalRestocks),style:""},{value:c.avgQuantity.toFixed(1),style:""},{value:`${c.appearanceRate.toFixed(1)}%`,style:""},{value:c.rarity,style:`color: ${t[c.rarity]}; text-transform: capitalize; font-weight: 600;`},{value:new Date(c.lastSeen).toLocaleDateString(),style:"font-size: 11px; color: #aaa;"},{value:n,style:o}];for(const i of a){const t=document.createElement("td");t.textContent=i.value,t.style.cssText=`\n        padding: 10px 12px;\n        ${i.style}\n      `,e.appendChild(t)}l.appendChild(e)}return r.appendChild(l),e.appendChild(r),e}();e.contentContainer.appendChild(r)}else{const t=document.createElement("div");t.style.cssText="\n      text-align: center;\n      padding: 40px 20px;\n      color: var(--qpm-text-muted, #aaa);\n      font-style: italic;\n    ",t.textContent="No restock data imported yet. Upload a Discord HTML export to get started!",e.contentContainer.appendChild(t)}}const gu=Object.freeze(Object.defineProperty({__proto__:null,createShopRestockWindow:function(){const e=document.createElement("div");e.style.cssText="\n    position: fixed;\n    top: 80px;\n    right: 20px;\n    width: 900px;\n    max-height: 80vh;\n    overflow-y: auto;\n    background: var(--qpm-background, rgba(0, 0, 0, 0.92));\n    border: 2px solid var(--qpm-border, #555);\n    border-radius: 8px;\n    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);\n    z-index: 10003;\n    font-family: Arial, sans-serif;\n    display: none;\n  ";const t=document.createElement("div");t.style.cssText="\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 12px 16px;\n    background: var(--qpm-surface-1, #1a1a1a);\n    border-bottom: 2px solid var(--qpm-border, #555);\n    cursor: move;\n  ";const n=document.createElement("h3");n.textContent="üè™ Shop Restock Tracker",n.style.cssText="\n    margin: 0;\n    color: var(--qpm-text, #fff);\n    font-size: 16px;\n    font-weight: 600;\n  ";const o=document.createElement("button");o.textContent="‚úï",o.style.cssText="\n    background: transparent;\n    border: none;\n    color: var(--qpm-text, #fff);\n    font-size: 20px;\n    cursor: pointer;\n    padding: 0 8px;\n    line-height: 1;\n  ",o.onclick=()=>{e.style.display="none"},t.appendChild(n),t.appendChild(o),e.appendChild(t);const r=document.createElement("div");r.style.cssText="\n    padding: 16px;\n    color: var(--qpm-text, #fff);\n  ",e.appendChild(r),function(e,t){let n=0,o=0,r=0,a=0;function i(e){e.preventDefault(),r=e.clientX,a=e.clientY,document.onmouseup=l,document.onmousemove=s}function s(t){t.preventDefault(),n=r-t.clientX,o=a-t.clientY,r=t.clientX,a=t.clientY,e.style.top=e.offsetTop-o+"px",e.style.left=e.offsetLeft-n+"px"}function l(){document.onmouseup=null,document.onmousemove=null}t.onmousedown=i}(e,t),document.body.appendChild(e);const a={root:e,contentContainer:r,countdownInterval:null};return Ns(),cl(),fu(a),Hs(()=>{fu(a)}),a},hideShopRestockWindow:function(e){e.root.style.display="none"},showShopRestockWindow:function(e){e.root.style.display="block"}},Symbol.toStringTag,{value:"Module"}))}();

})();