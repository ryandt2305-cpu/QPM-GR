// ==UserScript==
// @name         QPM - General Release
// @namespace    Quinoa
// @version      5.0.0
// @description  Information and analytics tools for Magic Garden. Features crop locking, mutation tracking, manual timers, and ability analytics.
// @match        https://1227719606223765687.discordsays.com/*
// @match        https://magiccircle.gg/r/*
// @match        https://magicgarden.gg/r/*
// @match        https://starweaver.org/r/*
// @run-at       document-start
// @inject-into  page
// @grant        GM_registerMenuCommand
// @grant        GM_setValue
// @grant        GM_getValue
// @grant        unsafeWindow
// ==/UserScript==

(function() {
'use strict';

!function(){"use strict";const e=e=>new Promise(t=>setTimeout(t,e)),t=new Promise(e=>{"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>e(),{once:!0}):e()});function n(e){const t=document.createElement("style");return t.textContent=e,document.head.appendChild(t),t}function o(e,t,{root:n=document,callForExisting:o=!0}={}){const r=n=>{for(const o of n){if(o.nodeType!==Node.ELEMENT_NODE)continue;const n=o;if(("string"==typeof e?n.matches(e):e(n))&&t(n),"string"==typeof e){n.querySelectorAll(e).forEach(t)}else{Array.from(n.querySelectorAll("*")).filter(e).forEach(t)}}};if(o){("string"==typeof e?Array.from(n.querySelectorAll(e)):Array.from(n.querySelectorAll("*")).filter(e)).forEach(t)}const a=new MutationObserver(e=>{for(const t of e)r(t.addedNodes)});return a.observe(n,{childList:!0,subtree:!0}),{disconnect:()=>a.disconnect()}}function r(e){if(!e)return!1;const t=e.getBoundingClientRect();if(t.width<=0||t.height<=0)return!1;const n=getComputedStyle(e);return"hidden"!==n.visibility&&"none"!==n.display&&parseFloat(n.opacity||"1")>0}const a=["#App .QuinoaUI","#App [data-tm-main-interface]","#App [data-tm-hud-root]","#App [data-mc-app-shell]","#App > div.McFlex.css-neeqas","#App > div.McFlex.css-1k630i1","#App > div.McFlex"];function s(){for(const n of a){const e=document.querySelector(n);if(e instanceof HTMLElement)return e}const e=document.getElementById("App");if(!e)return null;const t=e.querySelector("div.McFlex");return t instanceof HTMLElement?t:e instanceof HTMLElement?e:null}const i=function(e,t=!0){const n=(...t)=>{n.enabled&&console.log(`[${e}]`,...t)};return n.enabled=t,n}("QuinoaPetMgr");function l(e){if(!e)return"‚Äî";const t=Math.max(1,Math.floor((Date.now()-e)/1e3));if(t<60)return`${t}s ago`;const n=Math.floor(t/60);if(n<60)return`${n}m ago`;const o=Math.floor(n/60);if(o<24)return`${o}h ago`;return`${Math.floor(o/24)}d ago`}function c(e){return e.toLowerCase().replace(/[''`]/g,"").replace(/\s+/g,"").replace(/-/g,"").replace(/(seed|plant|baby|fruit|crop)$/i,"")}const u={carrot:3,strawberry:2,aloe:2.5,delphinium:3,blueberry:2,apple:2,appletree:2,orangetulip:3,tulip:3,tomato:2,daffodil:3,corn:2,cornkernel:2,watermelon:3,pumpkin:3,echeveria:2.75,echeveriacutting:2.75,coconut:3,coconuttree:3,banana:1.7,lily:2.75,squash:2.5,burrostail:2.5,burrostailcutting:2.5,mushroom:3.5,mushroomspore:3.5,cactus:1.8,bamboo:2,bambooshoot:2,grape:2,pepper:2,lemon:3,lemontree:3,passion:2,passionfruit:2,dragon:2,dragonfruit:2,lychee:2,lycheepit:2,sunflower:2.5,starweaver:2,starweaverpod:2,dawncelestial:2.5,dawnbinderpod:2.5,dawnbinder:2.5,dawnbinderbulb:2.5,mooncelestial:2,moonbinderpod:2,moonbinder:2,moonbinderbulb:2};const d={get(e,t=null){try{if("function"==typeof GM_getValue){const n=GM_getValue(e);if(null==n)return t;try{return JSON.parse(n)}catch{return n}}}catch{}try{const n=localStorage.getItem(e);return null==n?t:JSON.parse(n)}catch{return t}},set(e,t){try{if("function"==typeof GM_setValue)return void GM_setValue(e,JSON.stringify(t))}catch{}try{localStorage.setItem(e,JSON.stringify(t))}catch{}}},p=window,m="undefined"!=typeof unsafeWindow&&unsafeWindow?unsafeWindow:p,f=m,g=m!==p;function h(e,t){try{m[e]=t}catch{}if(g)try{p[e]=t}catch{}}function b(e){if(g){const t=p[e];if(void 0!==t)return t}return m[e]}const y="__qpmJotaiStore__",x="__qpmJotaiAtomCache__";let w=null,v=!1;const C=e=>new Promise(t=>setTimeout(t,e));function S(e){return!!e&&"function"==typeof e.get&&"function"==typeof e.values}function T(){const e=b(x);if(e&&S(e))return e;const t=f.jotaiAtomCache,n=t&&"cache"in t?t.cache:t;return S(n)?(h(x,n),n):void 0}async function k(e=5e3){const t=await async function(e=5e3){const t=Date.now();let n=T();for(;!n&&Date.now()-t<e;)await C(50),n=T();return n}(e);if(!t)throw new Error("jotaiAtomCache.cache not available");let n=null,o=null;const r=[],a=()=>{for(const e of r)try{e.__origWrite&&(e.write=e.__origWrite,delete e.__origWrite)}catch{}};for(const s of t.values()){if(!s||"function"!=typeof s.write)continue;const e=s;if(e.__origWrite)continue;const t=e.write.bind(e);e.__origWrite=e.write,e.write=function(e,r,...s){return o||(n=e,o=r,a()),t(e,r,...s)},r.push(e)}try{const t=Date.now()+e;for(;!o&&Date.now()<t;)await C(50)}finally{a()}return o&&n?{get:e=>n(e),async set(e,t){await o(e,t)},sub(e,t){let o;const r=setInterval(()=>{try{const r=n(e);r!==o&&(o=r,t())}catch{}},100);return()=>clearInterval(r)}}:(i("‚ö†Ô∏è Unable to capture Jotai store via write hook, using polyfill"),{get(){throw new Error("Jotai store unavailable (polyfill)")},set(){throw new Error("Jotai store unavailable (polyfill)")},sub:()=>()=>{},__polyfill:!0})}async function P(){if(w&&!w.__polyfill)return w;const e=b(y);if(e&&(!e.__polyfill||!w)&&(w=e,!w.__polyfill))return w;if(v){const e=6e3,t=Date.now();for(;v&&Date.now()-t<e;)await C(50);if(w&&!w.__polyfill)return w}v=!0;try{const e=function(){const e=f.__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!e?.renderers?.size)return null;for(const[t]of e.renderers){const n=e.getFiberRoots?.(t);if(n)for(const e of n){const t=new Set,n=[],o=e.current??e;for(o&&n.push(o);n.length;){const e=n.pop();if(!e||t.has(e))continue;t.add(e);const o=e.pendingProps?.value;if(o&&"object"==typeof o&&"function"==typeof o.get&&"function"==typeof o.set&&"function"==typeof o.sub)return o;e.child&&n.push(e.child),e.sibling&&n.push(e.sibling),e.alternate&&n.push(e.alternate)}}}return null}();if(e)return w=e,h(y,w),w;const t=await k();return w=t,h(y,w),w}catch(t){throw t}finally{v=!1}}function M(e){const t=T();if(!t)return[];const n=[];for(const o of t.values()){if(!o)continue;const t=String(o.debugLabel??o.label??"");e.test(t)&&n.push(o)}return n}function E(e){const t=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return M(new RegExp(`^${t}$`))[0]??null}async function $(e){return(await P()).get(e)}async function A(e,t){const n=await P();let o=!1;const r=()=>{if(!o)try{const o=n.get(e);t(o)}catch(r){i("‚ö†Ô∏è Failed reading atom value during subscription",r)}};let a;try{const t=n.sub(e,r);a="function"==typeof t?t:await t}catch(s){i("‚ö†Ô∏è Failed subscribing to atom",s),a=void 0}return r(),()=>{o=!0;try{a?.()}catch{}}}const I="userSlotsAtom";let F=!1,q=!1,N=!1;function z(e){if(!Array.isArray(e)||0===e.length)return null;const t=e.find(e=>e&&"object"==typeof e);if(!t)return null;return"itemType"in t||"species"in t||"slots"in t||"plant"in t||"item"in t?e:null}function L(e,t,n){if(!e||0===e.length)return null;const o=n&&"object"==typeof n?(r=n.favoritedItemIds,Array.isArray(r)?r.filter(e=>"string"==typeof e):[]):[];var r;const a=e.some(e=>function(e){if(!e||"object"!=typeof e)return[];const t=[e.slots,e.plant?.slots,e.item?.slots,e.data?.slots,e.slots?.slots,e.growSlots];for(const n of t)if(Array.isArray(n)&&n.length>0)return n;return[]}(e).length>0);return{items:e,favoritedItemIds:o,source:t,hasSlotData:a}}function R(e,t){const n=L(z(e),t,e);if(n)return n;if(!e||"object"!=typeof e)return null;const o=e;if("inventory"in o){const e=o.inventory,n=L(z(e?.items??e),`${t}.inventory`,e);if(n)return n}if("data"in o){const e=o.data;if(e&&"inventory"in e){const n=e.inventory,o=L(z(n?.items??n),`${t}.data.inventory`,n);if(o)return o}}return null}async function B(){try{await P(),F=!1}catch(r){return F||(i("‚ö†Ô∏è Unable to capture jotai store for userSlotsAtom",r),F=!0),null}const e=await async function(){let e=E(I);e||(e=M(/userSlotsAtom/i)[0]??null);return e||q||(i("‚ö†Ô∏è Could not locate userSlotsAtom in jotai cache"),q=!0),e&&(q=!1),e}();if(!e)return null;let t;try{t=await $(e),N=!1}catch(r){return N||(i("‚ö†Ô∏è Failed reading userSlotsAtom",r),N=!0),null}const n=new WeakSet,o=[{node:t,label:I}];for(;o.length>0;){const{node:e,label:t}=o.shift(),r=R(e,t);if(r)return r;if(!e||"object"!=typeof e)continue;const a=Array.isArray(e);!a&&n.has(e)||(a||n.add(e),Array.isArray(e)?e.forEach((e,n)=>{o.push({node:e,label:`${t}[${n}]`})}):Object.entries(e).forEach(([e,n])=>{o.push({node:n,label:`${t}.${e}`})}))}return null}const j='section.chakra-modal__content[role="dialog"]',D=".McFlex.css-1cyjil4",H="div.css-vmnhaw",_="qpm-crop-lock-styles",W=".McFlex.css-1cyjil4",O=["data-tm-inventory-id","data-inventory-id","data-item-id","data-itemid","data-itemId","data-item-uuid","data-itemuuid","data-item-guid","data-uuid","data-guid","data-entity-id","data-entityid","data-record-id","data-recordid","data-row-id","data-rowid","data-tm-item-id","data-tm-itemid","data-id"];const G="quinoa:crop-lock-config",U=new Set(Object.keys(u));function X(e){return new Promise(t=>setTimeout(t,e))}function V(e,t){let n=e;for(const o of t){if(!n||"object"!=typeof n)return;n=n[o]}return n}function K(e,t,n=4,o=new WeakSet){if(!e||"object"!=typeof e||n<0)return null;if(o.has(e))return null;o.add(e);const r=e;for(const[a,s]of Object.entries(r)){if(t(a,s)){if("string"==typeof s&&s)return s;if("number"==typeof s&&Number.isFinite(s))return String(s)}if(s&&"object"==typeof s){const e=K(s,t,n-1,o);if(e)return e}}return null}function J(e){return Array.isArray(e)?e:null}function Y(){try{const e=f,t=e?.myData?.inventory;if(!t)return null;const n=function(e){if(!e||"object"!=typeof e)return[];const t=e,n=[["items"],["inventory","items"],["inventory"],["data","inventory","items"],["data","inventory"],[]];for(const o of n){const n=J(0===o.length?e:V(t,o));if(n)return n}return[]}(t),o=V(t,["favoritedItemIds"]);return{items:n,favoritedItemIds:Array.isArray(o)?o.filter(e=>"string"==typeof e):[],source:"page.myData.inventory"}}catch(e){return i("‚ö†Ô∏è Unable to read inventory from page window",e),null}}function Q(e){const t=[["id"],["itemId"],["itemID"],["inventoryID"],["inventoryId"],["uuid"],["item","id"],["item","itemId"],["item","itemID"],["item","inventoryId"],["item","inventoryID"],["item","uuid"],["plant","id"],["data","id"]];for(const o of t){const t=V(e,o);if("string"==typeof t&&t)return t;if("number"==typeof t)return String(t)}const n=K(e,e=>/(?:inventory|item).*id$/i.test(e)||/^(?:id|uuid|guid)$/i.test(e),5);return n||null}function Z(e){const t=[["species"],["item","species"],["plant","species"],["data","species"],["crop","species"],["product","species"],["product","name"],["product","displayName"],["item","name"],["item","displayName"],["data","name"],["data","displayName"],["product","productName"],["item","productName"]];for(const o of t){const t=V(e,o);if("string"==typeof t&&t)return t}const n=K(e,(e,t)=>{const n=e.toLowerCase();if(/(species|productname|productlabel|cropname|displayname)$/.test(n))return!0;if(n.endsWith("name")&&"string"==typeof t){return!!c(t)}return!1},4);return n||null}async function ee(){const e=Y();if(e&&e.items.length>0)return{items:[...e.items],favoritedIds:new Set(e.favoritedItemIds),source:e.source};const t=await B();return t&&t.items.length>0?{items:[...t.items],favoritedIds:new Set(t.favoritedItemIds??[]),source:t.source}:e?{items:[...e.items],favoritedIds:new Set(e.favoritedItemIds),source:e.source}:t?{items:[...t.items],favoritedIds:new Set(t.favoritedItemIds??[]),source:t.source}:null}function te(e,t){const n=t?.favoritedIds??null,o=t?function(e){const t=new Map;for(const n of e.items){const o=Q(n);if(!o)continue;const r=Z(n);if(!r)continue;const a=c(r);if(!a)continue;const s={id:o,isFavorited:e.favoritedIds.has(o)},i=t.get(a);i?i.push(s):t.set(a,[s])}return t}(t):null,r={},a=[];for(const s of e){const e=s.element;if(!e)continue;const t=c(s.species||"unknown")??"unknown",i=o?.get(t)??null;let l=de(e),u=l&&n?n.has(l):!(!s.element||!xe(s.element));if(!l&&i&&i.length>0){const e=i.shift();l=e.id,u=e.isFavorited}else if(l&&i){const e=i.findIndex(e=>e.id===l);e>=0&&i.splice(e,1)}if(!l){r[t]=(r[t]??0)+1;continue}const d=n?n.has(l):u;a.push({item:s,element:e,itemId:l,isFavorited:d})}return Object.keys(r).length>0&&i("‚ö†Ô∏è Missing inventory ids for some crop items",{missing:r}),a}function ne(e){try{const t=f.MagicCircle_RoomConnection;if(t&&"function"==typeof t.sendMessage)return t.sendMessage({scopePath:["Room","Quinoa"],type:"ToggleFavoriteItem",itemId:e}),!0}catch(t){i("‚ö†Ô∏è Failed to send favorite toggle via MagicCircle_RoomConnection",t)}return!1}let oe={enabled:!0,syncModeEnabled:!0,lockedTypes:{},managedFavoriteIds:{},baselineFavoriteIds:{}},re=!1,ae=new Map;function se(){if(re)return;re=!0,oe=d.get(G,oe),"boolean"!=typeof oe.syncModeEnabled&&(oe.syncModeEnabled=!0),oe.managedFavoriteIds||(oe.managedFavoriteIds={}),oe.baselineFavoriteIds||(oe.baselineFavoriteIds={}),function(){if(document.getElementById(_))return;n('\n    .qpm-crop-lock-button {\n      position: absolute;\n      top: 2px;\n      right: 2px;\n      width: 20px;\n      height: 20px;\n      border: none;\n      border-radius: 4px;\n      background: rgba(0, 0, 0, 0.7);\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-size: 12px;\n      z-index: 10;\n      transition: all 0.2s;\n      backdrop-filter: blur(2px);\n    }\n    \n    .qpm-crop-lock-button:hover {\n      background: rgba(0, 0, 0, 0.9);\n      transform: scale(1.1);\n    }\n    \n    .qpm-crop-lock-button.locked {\n      background: rgba(255, 193, 7, 0.9);\n      color: #000;\n    }\n    \n    .qpm-crop-lock-button.unlocked {\n      background: rgba(108, 117, 125, 0.7);\n      color: #fff;\n    }\n    \n    .qpm-crop-lock-button.unlocked:hover {\n      background: rgba(108, 117, 125, 0.9);\n    }\n    \n    .qpm-inventory-item-wrapper {\n      position: relative;\n    }\n    \n    /* Hide default favorite button when our lock button is active */\n  .qpm-inventory-item-wrapper button[aria-label*="avorite"] {\n      display: none;\n    }\n  ').id=_}(),i("üåæ Crop type locking system starting...");new MutationObserver(()=>{const e=document.querySelector(W);if(e&&!e.hasAttribute("data-crop-lock-processed")){e.setAttribute("data-crop-lock-processed","true"),i("üîç Inventory grid found via direct observer!");let t=e.parentElement,n=null;for(;t&&t!==document.body;){if("dialog"===t.getAttribute("role")||t.classList.contains("chakra-modal__content")||"SECTION"===t.tagName){n=t,i("‚úÖ Found parent modal");break}t=t.parentElement}n?setTimeout(()=>ie(n),300):(i("‚ö†Ô∏è Could not find modal parent, processing grid directly"),setTimeout(()=>{const t=Array.from(e.querySelectorAll(H));t.length>0&&le(t,e)},300))}}).observe(document.body,{childList:!0,subtree:!0}),setTimeout(()=>{i("üîç Checking for existing inventory on startup...");const e=document.querySelector(W);if(e&&!e.hasAttribute("data-crop-lock-processed")){e.setAttribute("data-crop-lock-processed","true"),i("‚úÖ Found existing inventory grid!");let t=e.parentElement;for(;t&&t!==document.body;){if("dialog"===t.getAttribute("role")||t.classList.contains("chakra-modal__content")){i("‚úÖ Found parent modal on startup, calling enhanceInventoryPanel"),ie(t);break}t=t.parentElement}}else i("‚è≥ No inventory open yet")},1e3),o(j,e=>{if(console.log("üîç Panel detected with selector:",j),console.log("Panel element:",e),console.log("Panel classes:",e.className),console.log("Panel role:",e.getAttribute("role")),console.log("Panel text preview:",e.textContent?.substring(0,100)),r(e)){const t=function(e){const t=e.textContent||"",n=t.toLowerCase();if(n.includes("inventory")||n.includes("my items")||e.querySelector('[data-testid*="inventory"]'))return!0;if(n.includes("shop")||n.includes("buy")||n.includes("purchase")||n.includes("seeds in")||n.includes("restocked")||n.includes("new seeds")||e.querySelector('[data-testid*="shop"]')||e.classList.contains("css-1ubz3lw"))return!1;const o=e.querySelector('.chakra-stack > div[role="button"]'),r=e.querySelector("div[data-tm-shop-index]");if(r&&!o)return!1;return!0}(e);console.log("Is inventory panel?",t),t?(i("üéí Inventory panel detected, adding crop lock buttons..."),setTimeout(()=>ie(e),500)):i("üõí Shop panel detected, ignoring for crop locking")}else console.log("Panel not visible, skipping")}),o(W,e=>{console.log("üîç User inventory grid detected:",e),console.log("Grid classes:",e.className),console.log("Grid text preview:",e.textContent?.substring(0,100));let t=e.parentElement;for(;t;){if("dialog"===t.getAttribute("role")||t.classList.contains("chakra-modal__content")||t.hasAttribute("aria-modal")){console.log("üéí Found inventory modal for user grid:",t),setTimeout(()=>ie(t),200);break}t=t.parentElement}}),o('[role="dialog"]',e=>{console.log("üîç Any dialog detected:",e),console.log("Dialog classes:",e.className),console.log("Dialog text preview:",e.textContent?.substring(0,200));const t=e.textContent?.toLowerCase()||"";(t.includes("inventory")||t.includes("my items")||t.includes("backpack"))&&(console.log("üéí This dialog might be inventory! Trying to enhance..."),setTimeout(()=>ie(e),100))}),o(".chakra-modal__content",e=>{console.log("üîç Chakra modal detected:",e),console.log("Modal classes:",e.className),console.log("Modal text preview:",e.textContent?.substring(0,200));const t=e.textContent?.toLowerCase()||"";(t.includes("inventory")||t.includes("my items")||t.includes("backpack"))&&(console.log("üéí This chakra modal might be inventory! Trying to enhance..."),setTimeout(()=>ie(e),100))});new MutationObserver(e=>{e.forEach(e=>{e.addedNodes.forEach(e=>{if(e.nodeType===Node.ELEMENT_NODE){const t=e,n=t.textContent?.toLowerCase()||"";if(n.includes("inventory")||n.includes("my items")){console.log("üîç Element with inventory text detected:",t),console.log("Element tag:",t.tagName),console.log("Element classes:",t.className),console.log("Element text preview:",n.substring(0,200));let e=t.parentElement;for(;e;){if("dialog"===e.getAttribute("role")||e.classList.contains("chakra-modal__content")||e.hasAttribute("aria-modal")){console.log("üéí Found parent modal for inventory element:",e),setTimeout(()=>ie(e),100);break}e=e.parentElement}}}})})}).observe(document.body,{childList:!0,subtree:!0});new MutationObserver(e=>{e.forEach(e=>{e.removedNodes.forEach(e=>{if(e.nodeType===Node.ELEMENT_NODE){const t=e;if("dialog"===t.getAttribute("role")||t.classList?.contains("chakra-modal__content")||t.hasAttribute?.("aria-modal")){const e=document.getElementById("quinoa-crop-lock-sidebar");e&&(e.remove(),i("üóëÔ∏è Removed crop lock sidebar (inventory closed)"))}}})})}).observe(document.body,{childList:!0,subtree:!0}),i("‚úÖ Crop type locking system started")}function ie(e){i("üéØ enhanceInventoryPanel called");const t=e.querySelector(D);if(!t)return void i(`‚ùå Could not find items container (${D})`);i("‚úÖ Found items container");const n=Array.from(t.querySelectorAll(H));i(`‚úÖ Found ${n.length} inventory items`),0!==n.length?le(n,e):i("‚ùå No inventory items found")}function le(e,t){const n=new Map;i(`üîç Processing ${e.length} inventory items...`);for(const o of e){const e=ue(o);if(!e)continue;const t=c(e.species||"unknown");n.has(t)||n.set(t,[]),n.get(t).push({...e,element:o})}i(`üåæ Found ${n.size} different crop types`),0!==n.size?function(e,t){const n=document.querySelector("#quinoa-crop-lock-sidebar");n&&(i("üóëÔ∏è Removing existing sidebar"),n.remove());i(`üìä Creating sidebar with ${t.size} crop types`),t.forEach((e,t)=>{i(`  üåæ ${t}: ${e.length} items`)});let o=e.closest('[role="dialog"]')||e.closest(".chakra-modal__content")||e.closest('[aria-modal="true"]')||e;const r=o.getBoundingClientRect();i(`üìê Modal rect: left=${r.left}, right=${r.right}, top=${r.top}, width=${r.width}, height=${r.height}`);const a=r.right+8,s=r.top+60;i(`üìê Sidebar positioning: left=${a}px, top=${s}px`);const l=document.createElement("div");l.id="quinoa-crop-lock-sidebar",l.style.cssText=`\n    position: fixed;\n    top: ${s}px;\n    left: ${a}px;\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    z-index: 2147483646;\n    pointer-events: auto;\n  `;let u=0;if(t.forEach((e,t)=>{const n=function(e,t){const n=document.createElement("div");n.style.cssText="\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 6px;\n    cursor: pointer;\n    transition: transform 0.2s ease;\n  ",n.addEventListener("mouseenter",()=>{n.style.transform="scale(1.05)"}),n.addEventListener("mouseleave",()=>{n.style.transform="scale(1)"});const o=document.createElement("button");o.className="quinoa-crop-type-button",o.title=`${e} (${t.length} items) - Click to favorite/unfavorite all`;const r=t[0];let a="";if(r&&r.element){const t=r.element.querySelector("img");if(t&&t.src)a=t.src;else{const t=r.element.querySelector("canvas");if(t)try{a=t.toDataURL()}catch(f){i("‚ö†Ô∏è Could not get canvas data for",e)}}}o.style.cssText="\n    width: 68px;\n    height: 68px;\n    border: none;\n    background: rgba(0, 0, 0, 0.92);\n    border-radius: 8px;\n    cursor: pointer;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: flex-start;\n    position: relative;\n    padding: 11px 4px 4px 4px;\n    gap: 0px;\n  ";const s=document.createElement("div");s.style.cssText="\n    width: 100%;\n    height: 33px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    position: relative;\n    flex-shrink: 0;\n  ",a?(s.style.backgroundImage=`url(${a})`,s.style.backgroundSize="60%",s.style.backgroundRepeat="no-repeat",s.style.backgroundPosition="center"):(s.textContent=e.charAt(0).toUpperCase(),s.style.color="#fff",s.style.fontSize="24px",s.style.fontWeight="bold");o.appendChild(s);const l=document.createElement("div");l.style.cssText="\n    color: #fff;\n    font-size: 11px;\n    font-weight: 600;\n    text-align: center;\n    text-shadow: 0 1px 2px rgba(0,0,0,0.8);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    width: 100%;\n    margin-top: -24px;\n    flex-shrink: 0;\n    line-height: 1.2;\n    position: relative;\n    z-index: 10;\n  ",l.textContent=e.charAt(0).toUpperCase()+e.slice(1),o.appendChild(l);const u=c(e)??e.toLowerCase();let p=t.every(e=>xe(e.element));function m(){const e=t.filter(e=>xe(e.element)).length,n=e>0&&e<t.length;p?(o.style.filter="drop-shadow(0 0 8px gold)",l.style.color="#ffd700"):n?(o.style.filter="drop-shadow(0 0 6px #ffa726)",l.style.color="#ffa726"):(o.style.filter="none",l.style.color="#fff")}return m(),n.addEventListener("click",async()=>{const e=ae.get(u);await async function(e,t,n){if(0===t.length)return;const o=t[0]?.species??e,r=oe.lockedTypes[e]||!1,a=!r,s=!1!==oe.syncModeEnabled;i(`üîÑ ${a?"Locking":"Unlocking"} all ${o} items...`);const l=await ee();if(!l)return i("‚ö†Ô∏è Unable to capture inventory context; aborting crop lock toggle",{speciesKey:e}),void we(`‚ö†Ô∏è Unable to ${a?"lock":"unlock"} ${o}`);i("üì¶ Inventory context ready for crop lock",{speciesKey:e,source:l.source,items:l.items.length,favorited:l.favoritedIds.size});const c=new Set(l.favoritedIds),u=te(t,l);if(0===u.length)return i("‚ö†Ô∏è No inventory entries with ids found for crop type",{speciesKey:e}),void we(`‚ö†Ô∏è No ${o} inventory entries found`);const p=u.filter(e=>e.isFavorited).map(e=>e.itemId),m=new Set(oe.baselineFavoriteIds[e]??p),f=new Set(oe.managedFavoriteIds[e]??[]),g=new Set;if(a)for(const i of u)i.isFavorited||g.add(i.itemId);else{if(s){const t=[];for(const e of u)e.isFavorited&&(f.has(e.itemId)||m.has(e.itemId)||(t.push(e.itemId),m.add(e.itemId)));t.length>0&&(i("‚ÑπÔ∏è Detected manual favorites during unlock; merging into baseline",{speciesKey:e,manual:t.length}),oe.baselineFavoriteIds[e]=Array.from(m),d.set(G,oe));for(const e of u){if(!e.isFavorited)continue;const t=f.has(e.itemId),n=m.has(e.itemId);!t&&n||g.add(e.itemId)}}else for(const e of u)e.isFavorited&&g.add(e.itemId);if(f.size>0)for(const e of f)g.has(e)||u.some(t=>t.itemId===e)||g.add(e);s&&0===f.size&&g.size>0&&i("‚ö†Ô∏è Unlocking without managed ids; will toggle all favorited items for this species",{speciesKey:e,count:g.size})}const h=Array.from(g);if(0===h.length)return i("‚ÑπÔ∏è Crop lock toggle skipped (state already matches request)",{speciesKey:e,shouldLock:a}),oe.lockedTypes[e]=a,m.size>0?oe.baselineFavoriteIds[e]=Array.from(m):delete oe.baselineFavoriteIds[e],n&&ye(n,a),d.set(G,oe),void we(`${o} already ${a?"locked":"unlocked"}`);let b=0;for(const d of h)ne(d)?(b+=1,await X(40)):i("‚ö†Ô∏è Failed to dispatch favorite toggle via websocket",{speciesKey:e,itemId:d});if(0===b)return i("‚ùå No favorite toggles were dispatched; aborting state update",{speciesKey:e}),void we(`‚ö†Ô∏è Could not ${a?"lock":"unlock"} ${o}`);await async function(e,t,n=2200,o=140){if(0===e.length)return!0;const r=Date.now()+n;for(;Date.now()<r;){const n=await ee(),r=n?.favoritedIds??null;if(r&&(t?e.every(e=>r.has(e)):e.every(e=>!r.has(e))))return!0;await X(o)}return!1}(h,a)||i("‚ö†Ô∏è Favorite state did not settle after toggle commands",{speciesKey:e,shouldLock:a});const y=await ee(),x=y?.favoritedIds??c;y||i("‚ö†Ô∏è Using initial inventory context as fallback after toggles",{speciesKey:e});const w=y??{items:l.items,favoritedIds:new Set(x),source:l.source},v=te(t,w),C=new Set(v.filter(e=>e.isFavorited).map(e=>e.itemId)),S=v.length,T=C.size,k=new Set(f);if(a)for(const i of v){if(!i.isFavorited)continue;(u.find(e=>e.itemId===i.itemId)?.isFavorited??!1)||k.add(i.itemId)}else if(f.size>0)for(const i of v)i.isFavorited||k.delete(i.itemId);else for(const i of h)C.has(i)||k.delete(i);let P;P=a?C.size===S:f.size>0?v.every(e=>!f.has(e.itemId)||!e.isFavorited):h.every(e=>!C.has(e));if(P){if(oe.lockedTypes[e]=a,a){const t=u.filter(e=>e.isFavorited).map(e=>e.itemId);t.length>0?oe.baselineFavoriteIds[e]=t:delete oe.baselineFavoriteIds[e]}else{const t=Array.from(C);t.length>0?oe.baselineFavoriteIds[e]=t:delete oe.baselineFavoriteIds[e]}n&&ye(n,a)}else oe.lockedTypes[e]=r,n&&ye(n,r),i("‚ö†Ô∏è Crop lock operation did not fully succeed",{speciesKey:e,shouldLock:a,favoritedCount:T,totalCount:S,managedBefore:f.size,dispatched:b});k.size>0?oe.managedFavoriteIds[e]=Array.from(k):delete oe.managedFavoriteIds[e];d.set(G,oe);const M=a?C.size:S-C.size;we(`${a?"üîí Locked":"üîì Unlocked"} ${M}/${S} ${o} items`)}(u,t,e),p=t.every(e=>xe(e.element)),m()}),n.appendChild(o),n.appendChild(l),n}(t,e);l.appendChild(n),u++}),0===t.size)return;document.body.appendChild(l),i(`‚ú® Created crop lock sidebar with ${u} buttons`);const p=new MutationObserver(()=>{document.body.contains(e)||(i("üóëÔ∏è Inventory closed, removing sidebar"),l.remove(),p.disconnect())});p.observe(document.body,{childList:!0,subtree:!0})}(t,n):i("‚ùå No crop types found - sidebar will not be created")}function ce(e){return e.replace(/\s*\+\s?\d+$/,"").replace(/\s*\([^)]+\)$/,"").replace(/\s*(produce|crop|fruit|vegetable|berry)$/i,"").trim()}function ue(e){try{const t=["p.chakra-text.css-8xfasz",".McFlex.css-1gd1uup p.chakra-text","p.chakra-text.css-rbbzu5",".chakra-text",'[data-testid="item-name"]',"p"];let n=null,o=null;for(const i of t)if(n=e.querySelector(i),n&&(o=n.textContent?.trim(),o&&o.length>0))break;if(!o)return i("‚ùå No item name found"),null;i(`üîé Checking item: "${o}"`);const r=ce(o),a=function(e){if(!e)return!1;const t=e.toLowerCase().trim();if(/(\bplant\b|\btree\b|\bsapling\b|\bsprout\b|\bshrub\b)/.test(t))return!1;const n=["seed","spore","cutting","pod","kernel","pit","shovel","pot","watering can","tool","fertilizer","egg","decor","furniture","planter","pedestal","bench","arch"];for(const r of n)if(t.includes(r))return!1;const o=c(e);if(o&&U.has(o))return!0;if(o.endsWith("s")){const e=o.replace(/s$/,"");if(U.has(e))return!0}return!1}(r);if(!a)return i(`  ‚è≠Ô∏è Skipping "${o}" - not a crop`),null;const s=function(e){const t=ce(e);return t?t.split(/\s+/).map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):null}(r)||r;return i(`‚úÖ Found crop: ${s}`),{id:`crop-${Date.now()}-${Math.random()}`,species:s,itemType:"Crop",element:e}}catch(t){return i("‚ùå Error extracting crop data:",t),null}}function de(e){if(!e)return null;const t=["[data-tm-inventory-id]","[data-inventory-id]","[data-item-id]","[data-itemid]","[data-item-uuid]","[data-uuid]","[data-guid]","[data-entity-id]","[data-record-id]","[data-row-id]"],n=[];let o=e;for(let s=0;o&&s<5;s++)n.push(o),o=o.parentElement;const r=e=>{const t=e.toLowerCase();return t.includes("inventoryid")||t.includes("itemid")||/(?:uuid|guid)$/.test(t)};for(const s of n){const e=pe(s,O);if(e)return e;const t=me(s,r);if(t)return t}for(const s of n)for(const e of t){const t=s.querySelector(e);if(!t)continue;const n=pe(t,O);if(n)return n;const o=me(t,r);if(o)return o}const a=function(e){for(const t of e){const e=fe(t);if(e)return e;const n=he(ge(t));if(n)return n}return null}(n);return a||null}function pe(e,t){for(const o of t){const t=e.getAttribute(o);if(null!=t)return t}const n=t.map(e=>e.toLowerCase());for(const{name:o,value:r}of Array.from(e.attributes))if(n.includes(o.toLowerCase())&&null!=r)return r;return null}function me(e,t){const n=e.dataset;if(!n)return null;for(const[o,r]of Object.entries(n))if(t(o)&&null!=r&&""!==r)return r;return null}function fe(e){const t=Object.getOwnPropertyNames(e);for(const n of t){if(!n.startsWith("__reactProps$"))continue;const t=be(e[n]);if(t)return t}return null}function ge(e){const t=Object.getOwnPropertyNames(e);for(const n of t)if(n.startsWith("__reactFiber$"))return e[n];return null}function he(e){if(!e)return null;const t=[{fiber:e,depth:0}],n=new WeakSet;for(;t.length>0;){const{fiber:e,depth:o}=t.pop();if(!e||n.has(e))continue;n.add(e);const r=be(e.memoizedProps)||be(e.pendingProps)||be(e.memoizedState)||be(e.stateNode);if(r)return r;o>=6||(e.child&&t.push({fiber:e.child,depth:o+1}),e.sibling&&t.push({fiber:e.sibling,depth:o}))}return null}function be(e,t=0,n=new WeakSet){if(!e||"object"!=typeof e)return null;if(e instanceof Element||e instanceof Node)return null;if("undefined"!=typeof Window&&e instanceof Window)return null;if(n.has(e))return null;n.add(e);const o=Q(e);if(o&&!(!(r=o)||r.length<6||/^\d+$/.test(r)&&r.length<10))return o;var r;if(t>=6)return null;if(Array.isArray(e)){for(const o of e){const e=be(o,t+1,n);if(e)return e}return null}const a=e;for(const s of Object.values(a)){if(!s||"object"!=typeof s&&"function"!=typeof s)continue;const e=be(s,t+1,n);if(e)return e}return null}function ye(e,t){e.textContent=t?"üîí":"üîì",e.className="qpm-crop-lock-button "+(t?"locked":"unlocked")}function xe(e){const t=function(e){if(!e)return null;const t=e.querySelector('button[aria-label*="avorite"]');return t instanceof HTMLButtonElement?t:null}(e);return!!t&&function(e){const t=e.getAttribute("aria-label")?.toLowerCase()??"";if(t.includes("unfavorite"))return!0;if(t.includes("favorite")&&!t.includes("unfavorite"))return!1;const n=e.getAttribute("aria-pressed");if("true"===n)return!0;if("false"===n)return!1;const o=e.querySelector("svg");if(o){const e=o.querySelector("path");if(e){const t=e.getAttribute("fill");if(t&&"none"!==t&&"currentColor"!==t)return!0}}const r=getComputedStyle(e);return"currentColor"!==r.color||e.classList.contains("active")}(t)}function we(e){const t=document.createElement("div");t.textContent=e,t.style.cssText="\n    position: fixed;\n    bottom: 24px;\n    right: 24px;\n    background: #2e7d32;\n    color: #fff;\n    padding: 8px 12px;\n    border-radius: 6px;\n    font-size: 12px;\n    z-index: 2147483647;\n    opacity: 0.95;\n    animation: qpm-toast-in 0.3s ease;\n  ",document.querySelector("#qpm-toast-styles")||(n("\n      @keyframes qpm-toast-in {\n        from { transform: translateY(20px); opacity: 0; }\n        to { transform: translateY(0); opacity: 0.95; }\n      }\n    ").id="qpm-toast-styles"),document.body.appendChild(t),setTimeout(()=>t.remove(),2500)}function ve(){return{...oe}}function Ce(e){oe.syncModeEnabled=e,d.set(G,oe)}let Se=null;const Te=new Set;function ke(){return Se}function Pe(e,t){if(e){if(Te.add(e),t&&Se)try{e(Se)}catch{}return()=>{Te.delete(e)}}return()=>{}}!function(e){const t=Date.now(),n={kind:e,timestamp:t,raw:e,startedAt:t};Se=n;for(const r of Te)try{r(n)}catch(o){console.error("[WeatherInfo] Listener error:",o)}}("sunny");const Me=new Set,Ee={},$e={};function Ae(e){return e.map(e=>({...e}))}function Ie(e){const t={source:e.source,generatedAt:e.generatedAt,summary:e.summary,perWeather:{rain:Ae(e.perWeather.rain??[]),snow:Ae(e.perWeather.snow??[]),dawn:Ae(e.perWeather.dawn??[]),amber:Ae(e.perWeather.amber??[])}};return e.metadata&&(t.metadata={...e.metadata}),t}function Fe(e){const t={...e,perWeather:{rain:Ae(e.perWeather.rain??[]),snow:Ae(e.perWeather.snow??[]),dawn:Ae(e.perWeather.dawn??[]),amber:Ae(e.perWeather.amber??[])}};e.metadata&&(t.metadata={...e.metadata}),$e[e.source]=t}function qe(e,t={}){const n=Math.max(0,e.overallTrackedPlantCount-e.overallEligiblePlantCount),o=Math.max(0,n-e.lunar.mutatedPlantCount);return{...t,lunarTrackedPlantCount:e.lunar.trackedPlantCount,lunarPendingPlantCount:e.lunar.pendingPlantCount,lunarMutatedPlantCount:e.lunar.mutatedPlantCount,nonLunarMutatedPlantCount:o,dawnPendingFruitCount:e.totals.dawn.pendingFruitCount,amberPendingFruitCount:e.totals.amber.pendingFruitCount}}function Ne(e){return e?$e[e]??null:$e.garden??$e.inventory??null}function ze(e,t){Ee[e]=t;const n={source:e,summary:t};for(const r of Me)try{r(n)}catch(o){i("‚ö†Ô∏è Mutation summary listener error",o)}}h("__qpmMutationDebug",{get:e=>function(e){const t=Ne(e);return t?Ie(t):null}(e),getAll(){const e={};return Object.keys($e).forEach(t=>{const n=$e[t];n&&(e[t]=Ie(n))}),e},list(e){const t=Ne(e);return t?function(e){return{source:e.source,generatedAt:e.generatedAt,activeWeather:e.summary.activeWeather,perWeather:{rain:e.perWeather.rain.map(e=>e.name),snow:e.perWeather.snow.map(e=>e.name),dawn:e.perWeather.dawn.map(e=>e.name),amber:e.perWeather.amber.map(e=>e.name)},metadata:e.metadata?{...e.metadata}:void 0}}(t):null},print(e){const t=Ne(e);if(!t)return null;const n=[];["rain","snow","dawn","amber"].forEach(e=>{(t.perWeather[e]??[]).forEach(t=>{const o={weather:e,name:t.name,pending:t.pendingFruit,needsSnow:t.needsSnowFruit,fruit:t.fruitCount,source:t.source};t.tag&&(o.tag=t.tag),n.push(o)})});const o=globalThis.console;return 0===n.length?(o?.info?.("[QPM] No mutation plants recorded for current snapshot."),[]):(o?.table?o.table(n):o?.log?.(n),n)}});const Le=["F","W","C","D","A","R","G"],Re="quinoa-mutation-reminder-config",Be=".McFlex.css-1cyjil4",je="div.css-vmnhaw",De="myCropInventoryAtom";let He={enabled:!0,showNotifications:!0,highlightPlants:!0},_e="unknown",We="unknown",Oe=null,Ge=null,Ue=null,Xe=!1,Ve=new Set,Ke=!1,Je=!1,Ye=!1,Qe=0,Ze=!1;let et=0;const tt=["rain","snow","dawn","amber"];function nt(e){return e.toLowerCase().replace(/\+\d+$/,"").trim()}function ot(){He={...He,...d.get(Re,{})},i("üå± Plant Mutation Reminder starting..."),He.enabled&&(at(),rt()),i("üå± Plant Mutation Reminder started")}function rt(){Ke||(Ke=!0,o(Be,e=>{if(He.enabled&&(Ve.size>0&&(i(`üîÑ Inventory reopened, reapplying ${Ve.size} plant highlights...`),setTimeout(()=>{!async function(){if(0===Ve.size)return void i("‚è≠Ô∏è No highlights to reapply");i(`üîç Reapplying highlights for ${Ve.size} tracked plants...`);const e=await pt();if(0===e.length)return void i("‚ö†Ô∏è No plants found in inventory for reapply");const t=e.filter(e=>{const t=ut(e);return Ve.has(t)});t.length>0?(i(`‚ú® Reapplying ${t.length} highlights`),zt(t)):i("‚ö†Ô∏è None of the tracked plants found in current inventory")}()},300)),Ue)){const{weather:e}=Ue;i(`üì¶ Inventory opened with pending ${e} notification`),He.showNotifications&&Rt(`${jt(e)} ${e.toUpperCase()} Weather Active`,"Checking your plants for mutation opportunities...","info");const t=(e=0)=>{const n=document.querySelector(Be);if(!n)return void i("‚ö†Ô∏è Inventory container disappeared");const o=Array.from(n.querySelectorAll(je)).filter(e=>{const t=e.querySelector("p.chakra-text");return(t?.textContent?.trim()||"").toLowerCase().includes("plant")});o.length>0||e>=5?(o.length>0?i(`‚úÖ Found ${o.length} plant items after ${300*e}ms`):i(`‚è∞ Timeout waiting for plants after ${300*e}ms`),ct()):(i(`‚è≥ No plants found yet, waiting... (attempt ${e+1}/5)`),setTimeout(()=>t(e+1),300))};t()}}))}function at(){Oe||(Oe=Pe(st,!0))}function st(e){Ge=e;const t=function(e){switch(e.kind){case"rain":return"rain";case"snow":return"snow";case"dawn":return"dawn";case"amber":return"amber";case"sunny":return"sunny";default:return"weather"===e.raw?"rain":"sunny"}}(e);if(!He.enabled&&!Xe)return We=_e,void(_e=t);t!==_e&&(We=_e,_e=t,i(`üå§Ô∏è Weather changed: ${We} ‚Üí ${_e}`),Lt(),"sunny"===_e||"unknown"===_e?(Ue=null,i("üå§Ô∏è Weather cleared - no mutations available")):ct())}function it(e){switch(e){case"rain":case"snow":return 3e5;case"dawn":case"amber":return 6e5;default:return null}}function lt(e,t){if("sunny"===e||"unknown"===e)return null;const n=it(e),o=t?.startedAt??t?.timestamp??null,r=t?.expectedEndAt??(null!=o&&null!=n?o+n:null)??(null!=n?Date.now()+n:null),a=null!=r?Math.max(0,r-Date.now()):null;return{weather:e,startedAt:o,expectedEndAt:r,durationMs:null!=r&&null!=o?Math.max(0,r-o):n,remainingMs:a}}async function ct(){if(!He.enabled)return;i(`üîç Checking inventory for mutation opportunities (${_e})...`);const e=await pt(),t=lt(_e,Ge),n={rain:[],snow:[],dawn:[],amber:[]},o=(e,t,o)=>{const r={name:t.name,pendingFruit:o.pendingFruit,needsSnowFruit:o.needsSnowFruit,fruitCount:t.fruitCount,source:t.slotSource};o.tag&&(r.tag=o.tag),n[e].push(r)};if(0===e.length){const e=Nt([],_e,t,o);return ze("inventory",e),Fe({source:"inventory",generatedAt:e.timestamp,summary:e,perWeather:n,metadata:qe(e,{scannedPlantCount:0,highlightedPlantCount:0,notes:"Inventory empty"})}),i("üì¶ No plants found in inventory"),void("sunny"!==_e&&"unknown"!==_e&&(Ue={weather:_e,plantCount:0},He.showNotifications&&Rt(`${jt(_e)} ${_e.toUpperCase()} Weather!`,"Open your inventory (press E) to check which plants to place","info")))}Ue=null;const r=function(e,t){const n=[];for(const o of e){Ft(o,t,!0).decision&&n.push(o)}return n}(e,_e),a=Nt(e,_e,t,o);ze("inventory",a),Fe({source:"inventory",generatedAt:a.timestamp,summary:a,perWeather:n,metadata:qe(a,{scannedPlantCount:e.length,highlightedPlantCount:r.length})}),r.length>0?(i(`üå± Found ${r.length} plants to place for ${_e}!`),He.highlightPlants&&(r.forEach(e=>{const t=ut(e);Ve.add(t)}),zt(r)),He.showNotifications&&function(e,t){(function(e,t){const n=jt(t),o=e.length,r=Bt(t);t.toUpperCase()})(e,t),Rt(`${jt(t)} ${t.toUpperCase()} Weather!`,`Place ${e.length} plant${e.length>1?"s":""} ${Bt(t)}`,"success")}(r,_e),r.length):i(`‚úì No mutation opportunities for ${_e}`)}function ut(e){const t=function(e){if(!e.length)return"no-slots";return e.map(e=>{const t=e.letters.join(""),n=`${e.hasDawnbound?"d":""}${e.hasAmberbound?"a":""}`,o=t||"_";return n?`${o}+${n}`:o}).join(",")}(e.slotStates);return`${e.name}|${e.mutations}|${e.fruitCount}|${t}`}function dt(e,t,n,o){const r=e.slotStates.map((e,t)=>({index:t,letters:e.letters.join(""),wet:e.hasWet,frozen:e.hasFrozen,chilled:e.hasChilled,dawn:e.hasDawnlit,amber:e.hasAmberlit,dawnbound:e.hasDawnbound,amberbound:e.hasAmberbound,rainbow:e.hasRainbow,gold:e.hasGold,progress:e.progress}));i(`[Mutations] ${n?"‚úÖ highlight":"‚è≠Ô∏è skip"} ${e.name} for ${t}`,{slotSource:e.slotSource,fruitCount:e.fruitCount,domCounts:e.domMutationCounts,domBold:e.domBoldCounts,slotSummary:r,detail:o})}async function pt(){const e=((e,t=document)=>t.querySelector(e))(Be);if(!e||!r(e))return i("‚ùå Inventory not open"),[];const t=Array.from(e.querySelectorAll(je)),n=await async function(){Ye=!1,Qe=0,et=0;const e=await async function(){const e=async()=>{const e=await async function(){if("undefined"==typeof window)return null;const e=window,t=[{source:"MGTools.Core.Atoms.inventory.myCropInventory",atom:e?.MGTools?.Core?.Atoms?.inventory?.myCropInventory},{source:"MGTOOLS.Core.Atoms.inventory.myCropInventory",atom:e?.MGTOOLS?.Core?.Atoms?.inventory?.myCropInventory},{source:"Atoms.inventory.myCropInventory",atom:e?.Atoms?.inventory?.myCropInventory},{source:"__tmAtoms.inventory.myCropInventory",atom:e?.__tmAtoms?.inventory?.myCropInventory}];for(const o of t){const e=o.atom;if(!e)continue;const t=e=>{const t=mt(e);if(t&&t.length>0)return t;if(e&&"object"==typeof e){const t=[e.items,e.value,e.current,e.state];for(const e of t){const t=mt(e);if(t&&t.length>0)return t}}return null};try{if("function"==typeof e.get){const n=t(await e.get());if(n&&n.length>0)return{items:n,source:`${o.source}.get()`,hasSlotData:n.some(e=>wt(e).length>0)}}const n=t(e);if(n&&n.length>0)return{items:n,source:`${o.source}`,hasSlotData:n.some(e=>wt(e).length>0)}}catch(n){Ze||(i("‚ö†Ô∏è Unable to read shared atoms inventory source",{source:o.source,error:n}),Ze=!0)}}return null}();if(e)return Ye||(i("[Mutations] Using shared atoms inventory source",{source:e.source,items:e.items.length,hasSlotData:e.hasSlotData}),Ye=!0),e.items;const t=function(){if("undefined"==typeof window)return null;const e=window,t=[{source:"UnifiedState.atoms.inventory.items",value:e?.UnifiedState?.atoms?.inventory?.items},{source:"UnifiedState.atoms.inventory",value:e?.UnifiedState?.atoms?.inventory},{source:"myData.inventory.items",value:e?.myData?.inventory?.items},{source:"__mga_cachedInventory",value:e?.__mga_cachedInventory},{source:"MGTOOLS.UnifiedState.atoms.inventory.items",value:e?.MGTOOLS?.UnifiedState?.atoms?.inventory?.items}];let n=null;for(const o of t){let e=mt(o.value),t=o.source;if((!e||0===e.length)&&o.value&&"object"==typeof o.value){const n=[{key:"myCropInventory",label:`${o.source}.myCropInventory`},{key:"cropInventory",label:`${o.source}.cropInventory`},{key:"inventory",label:`${o.source}.inventory`},{key:"items",label:`${o.source}.items`}];for(const r of n){const n=mt(o.value[r.key]);if(n&&n.length>0){e=n,t=r.label;break}}}if(!e||0===e.length)continue;const r=e.some(e=>wt(e).length>0),a={items:e,source:t,hasSlotData:r};if(r)return a;n||(n=a)}return n}();return t?(Ye||(i("[Mutations] Using global inventory source",{source:t.source,items:t.items.length,hasSlotData:t.hasSlotData}),Ye=!0),t.items):[]},t=async(t,n)=>{if(!t||0===t.length)return await e();if(t.some(e=>wt(e).length>0))return Ye||(i(`[Mutations] Read crop inventory atom (${n})`,{count:t.length,hasSlotData:!0}),Ye=!0),t;if(!Ye){const e=t.slice(0,3).map((e,t)=>({index:t,summary:ft(e)}));i("[Mutations] Crop inventory atom lacks slot data, trying fallback",{source:n,count:t.length,samples:e})}const o=await e();return o.length>0?o:(Ye||(i("[Mutations] Crop inventory atom fallback unavailable, proceeding without slot data",{source:n,count:t.length}),Ye=!0),t)};try{await P()}catch(r){return Je||(i("‚ö†Ô∏è Unable to capture jotai store for crop inventory",r),Je=!0),await e()}const n=await B();if(n&&n.items.length>0)return Ye||(i("[Mutations] Using userSlotsAtom inventory source",{source:n.source,items:n.items.length,hasSlotData:n.hasSlotData}),Ye=!0),n.hasSlotData?n.items:await t(n.items,n.source);const o=E(De);if(!o)return Je||(i("‚ö†Ô∏è Could not locate myCropInventoryAtom in jotai cache"),Je=!0),await e();try{const n=await $(o);return Je=!1,Array.isArray(n)?await t(n,"array"):n&&Array.isArray(n.items)?await t(n.items,"items array"):(Ye||i("[Mutations] Crop inventory atom value not array-like",{sample:n}),await e())}catch(r){return Je||(i("‚ö†Ô∏è Failed reading myCropInventoryAtom",r),Je=!0),await e()}return[]}();if(0===e.length)return Ye||(i("[Mutations] Inventory lookup unavailable (no items)"),Ye=!0),null;const t=new Map,n=new Map,o=new Map;if(e.forEach((e,r)=>{const a=function(e,t){if(!e||"object"!=typeof e)return null;const n=function(e){if(!e||"object"!=typeof e)return"other";if(wt(e).length>0)return"plant";const t=[e?.itemType,e?.type,e?.category,e?.kind,e?.item?.itemType,e?.item?.type,e?.plant?.itemType,e?.plant?.type];for(const n of t){if("string"!=typeof n)continue;const e=n.toLowerCase();if("plant"===e||"crop"===e||e.endsWith("plant")||e.includes("plant"))return"plant"}return"other"}(e);if("plant"!==n)return Qe<5&&(i("[Mutations] Inventory item skipped (type mismatch)",{index:t,itemType:n,keys:Object.keys(e).slice(0,10),sample:ft(e)}),Qe+=1),null;const o=wt(e),r=o.map(vt),a="string"==typeof e.id?e.id:null,s="string"==typeof e.species?e.species:null,l="string"==typeof e.itemName?e.itemName:null,c="string"==typeof e.displayName?e.displayName:null;let u="string"==typeof e.name?e.name:null;u||(u=l||c);!u&&s&&(u=s.toLowerCase().includes("plant")?s:`${s} Plant`);const d=u?nt(u):null;return{baseIndex:t,id:a,slotStates:r,raw:e,name:u,normalizedName:d,used:!1}}(e,r);if(a&&(t.set(a.baseIndex,a),a.id&&n.set(a.id,a),a.normalizedName)){const e=o.get(a.normalizedName)??[];e.push(a),o.set(a.normalizedName,e)}}),0===t.size)return Ye||(i("[Mutations] Inventory lookup construction produced zero entries"),Ye=!0),null;Ye||(i("[Mutations] Inventory lookup ready",{items:e.length,byIndex:t.size,byId:n.size,byName:o.size}),Ye=!0);return{byIndex:t,byId:n,byName:o}}(),o=[];return t.forEach((e,t)=>{const r=function(e,t,n){try{const r=["p.chakra-text.css-8xfasz",".McFlex.css-1gd1uup p.chakra-text","p.chakra-text.css-rbbzu5","p.chakra-text"],a=[];let s="";for(const t of r){const n=Array.from(e.querySelectorAll(t));for(const e of n){const t=e.textContent?.trim();t&&(a.push(t),!s&&/plant/i.test(t)&&(s=t))}if(s)break}if(!s&&a.length){s=a.find(e=>/[a-z]/i.test(e))??""}if(!s||!function(e){e.toLowerCase().trim();const t=e.match(/^(.+?)(?:\+\d+)?$/),n=(t?.[1]||e).toLowerCase().trim();if(!n.includes("plant"))return!1;const o=["seed","spore","cutting","pod","kernel","pit","shovel","pot","watering can","tool","fertilizer","egg","decor","furniture","planter"];for(const r of o)if(n.includes(r))return!1;return!0}(s))return null;const l=function(e){const t=[],n=e.querySelectorAll("span, div, p");for(const o of n){const e=o.textContent?.trim();if(!e||1!==e.length)continue;const n=e.toUpperCase();if(!Pt(n))continue;let r=!1;if(o instanceof HTMLElement){const e=window.getComputedStyle(o).fontWeight,t=Number.parseInt(e,10);r="bold"===e||Number.isFinite(t)&&t>=700}t.push({letter:n,isBold:r})}return t}(e),c=function(e){const t=Tt();for(const n of e)t[n.letter]+=1;return t}(l),u={D:(o=l).filter(e=>"D"===e.letter&&e.isBold).length,A:o.filter(e=>"A"===e.letter&&e.isBold).length},d=s.match(/\+(\d+)/),p=d?parseInt(d[1]||"1",10):0;let m=[],f="fallback";if(t){const o=function(e,t){const n=$t(e,Mt),o=It(n);if(null!=o)return o;const r=At(e,e=>e.toLowerCase().includes("inventorybaseindex")),a=It(r);if(null!=a)return a;const s=e.querySelector("[data-tm-inventory-base-index]");if(s){const e=It($t(s,Mt));if(null!=e)return e;const t=It(At(s,e=>e.toLowerCase().includes("inventorybaseindex")));if(null!=t)return t}return t}(e,n);let r=t.byIndex.get(o)??null;if(!r||r.used){const n=function(e){const t=["[data-tm-inventory-id]","[data-inventory-id]","[data-item-id]","[data-itemid]","[data-item-uuid]","[data-uuid]","[data-guid]","[data-entity-id]","[data-record-id]","[data-row-id]"],n=e=>{const t=e.toLowerCase();return t.includes("inventoryid")||t.includes("itemid")||/(?:uuid|guid)$/.test(t)},o=[];let r=e;for(let a=0;r&&a<5;a++)o.push(r),r=r.parentElement;for(const a of o){const e=$t(a,Et);if(e)return e;const t=At(a,n);if(t)return t}for(const a of o)for(const e of t){const t=a.querySelector(e);if(!t)continue;const o=$t(t,Et);if(o)return o;const r=At(t,n);if(r)return r}return null}(e);if(n){const e=t.byId.get(n)??null;e&&!e.used&&(r=e)}}if(!r||r.used){const e=nt(s),n=t.byName.get(e);if(n){for(;n.length>0&&n[0]&&n[0].used;)n.shift();if(n.length>0){const e=n.shift();e&&(r=e)}}}r&&!r.used&&(r.used=!0,m=r.slotStates.map(St),f="inventory")}const g=kt(m,c,u),h=p>0?p:m.length;return 0===h?(i(`‚è≠Ô∏è Skipping ungrown plant: ${s} (${"inventory"===f?"no slots yet":"no fruit count"})`),null):{name:s,mutations:g,element:e,fruitCount:h,slotStates:m,slotSource:f,domMutationCounts:c,domBoldCounts:u}}catch(r){return i("‚ùå Error extracting plant data:",r),null}var o}(e,n,t);r&&o.push(r)}),i(`üì¶ Scanned ${o.length} plants from inventory`),o}function mt(e){if(Array.isArray(e))return e;if(e&&"object"==typeof e){const t=e.items;if(Array.isArray(t))return t}return null}function ft(e){const t={},n=["id","name","species","itemType","type","category","kind"];for(const o of n)e&&"object"==typeof e&&o in e&&(t[o]=e[o]);if(e?.item&&"object"==typeof e.item){t.item={};for(const o of n)o in e.item&&(t.item[o]=e.item[o])}if(e?.plant&&"object"==typeof e.plant){t.plant={};for(const o of n)o in e.plant&&(t.plant[o]=e.plant[o])}return e?.itemName&&(t.itemName=e.itemName),t.hasSlots=!!wt(e).length,t}function gt(e){if("string"==typeof e){const t=e.trim();return t.length>0?t:null}return"number"==typeof e&&Number.isFinite(e)?e.toString():null}function ht(e){if("number"==typeof e&&Number.isFinite(e))return e;if("string"==typeof e){const t=Number.parseInt(e,10);return Number.isNaN(t)?null:t}return null}function bt(e,t){if(!e||"object"!=typeof e)return null;if(t.has(e))return null;if(t.add(e),Array.isArray(e)){for(const n of e){const e=bt(n,t);if(e)return e}return null}const n=e,o=[[n.complete,n.total],[n.completed,n.total],[n.completed,n.goal],[n.count,n.total],[n.count,n.required],[n.current,n.max],[n.value,n.max]];for(const[a,s]of o){const e=ht(a),t=ht(s);if(null!=e&&null!=t&&t>0&&e>=0)return{complete:e,total:t}}const r=["progress","state","status","data","info","details","counts"];for(const a of r){const e=n[a];if(!e)continue;const o=bt(e,t);if(o)return o}return null}function yt(e,t=new WeakSet){if("string"==typeof e)return e;if("number"==typeof e&&Number.isFinite(e))return e.toString();if(!e||"object"!=typeof e)return null;if(t.has(e))return null;t.add(e);const n=e,o=["name","displayName","display_name","mutationName","mutation","label","title","text","type","kind","state","status","key"];let r=null;for(const s of o){const e=gt(n[s]);if(e){r=e;break}}if(!r){const e=["mutation","mut","data","info","details","entry","node","item"];for(const o of e){const e=n[o];if(!e)continue;const a=yt(e,t);if(a){r=a;break}}}const a=bt(n,t);return a&&(r?/\d+\s*\/\s*\d+/.test(r)||(r=`${r} ${a.complete}/${a.total}`):r=`${a.complete}/${a.total}`),r}function xt(e){if(!e||"object"!=typeof e)return{};const t=e,n={},o=Object.keys(t).slice(0,10);for(const r of o){const e=t[r];if(null!=e)if("string"!=typeof e&&"number"!=typeof e&&"boolean"!=typeof e){if(Array.isArray(e))n[r]=e.slice(0,3).map(e=>{if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return e;if(e&&"object"==typeof e){const t=e,n=Object.keys(t).find(e=>{const n=t[e];return"string"==typeof n||"number"==typeof n});return n?t[n]:Object.keys(t).slice(0,3)}return typeof e});else if("object"==typeof e){const t=e,o={};for(const e of Object.keys(t).slice(0,5)){const n=t[e];"string"!=typeof n&&"number"!=typeof n&&"boolean"!=typeof n||(o[e]=n)}Object.keys(o).length>0&&(n[r]=o)}}else n[r]=e}return n}function wt(e){if(!e||"object"!=typeof e)return[];const t=[e.slots,e.plant?.slots,e.item?.slots,e.data?.slots,e.slots?.slots,e.growSlots];for(const n of t)if(Array.isArray(n)&&n.length>0)return n;return[]}function vt(e){const t=function(e){if(!e||"object"!=typeof e)return[];const t=e,n=[],o=new Set,r=e=>{if(!e)return;const t=e.trim();t&&!o.has(t)&&(o.add(t),n.push(t))},a=[t.mutations,t.mutationStates,t.mutation_states,t.mutationHistory,t.appliedMutations,t.pendingMutations,t.mutationsList];for(const i of a)if(i)if(Array.isArray(i))for(const e of i)r(yt(e));else if("object"==typeof i)for(const e of Object.values(i))r(yt(e));const s=["mutation","mutationName","mutationType","currentMutation","activeMutation","latestMutation"];for(const i of s)r(yt(t[i]));if(0===n.length){const e=[["wet","wet"],["water","wet"],["rain","wet"],["freeze","wet"],["frozen","wet"],["chill","wet"],["dawn","dawn"],["amber","amber"]];for(const[n,o]of Object.entries(t)){const t=n.toLowerCase(),a=e.find(([e])=>t.includes(e));if(!a)continue;const[,s]=a,i=bt(o,new WeakSet);i&&r(`${s} ${i.complete}/${i.total}`)}}return n}(e);if(0===t.length&&et<5){const t=e&&"object"==typeof e?Object.keys(e).slice(0,10):[];i("[Mutations] Inventory slot missing mutation text",{keys:t,sample:xt(e)}),et+=1}return Ct(t)}function Ct(e){const t=new Set;let n=!1,o=!1,r=!1,a=!1,s=!1,i=!1,l=!1,c=!1,u=!1;const d={};let p=0,m=0,f=0;const g=(e,t,n)=>{if(!Number.isFinite(t)||!Number.isFinite(n))return;if(n<=0||t<0)return;const o=d[e];(!o||n>o.total||n===o.total&&t>o.complete)&&(d[e]={complete:t,total:n})};for(const b of e){const e=String(b??"").toLowerCase(),d=e.includes("frozen")||e.includes("freeze");d&&(n=!0,t.add("F"));const h=e.includes("wet");h&&(o=!0,t.add("W"));const y=e.includes("chill");y&&(r=!0,t.add("C")),(d||h||y)&&(p+=1);const x=e.includes("dawnbound");x&&(i=!0,t.add("D"));const w=e.includes("amberbound");w&&(l=!0,t.add("A"));const v=(e.includes("dawnlit")||e.includes("dawnlight")||e.includes("dawn"))&&!x;v&&(a=!0,t.add("D")),(v||x)&&(m+=1);const C=(e.includes("amberlit")||e.includes("amberlight")||e.includes("amber"))&&!w;C&&(s=!0,t.add("A")),(C||w)&&(f+=1);e.includes("rainbow")&&(c=!0,t.add("R"));e.includes("gold")&&(u=!0,t.add("G"));const S=e.match(/(\d+)\s*\/\s*(\d+)/);if(S){const e=Number.parseInt(S[1]??"0",10),t=Number.parseInt(S[2]??"0",10);(d||h||y)&&g("wet",e,t),(v||x)&&g("dawn",e,t),(C||w)&&g("amber",e,t)}}const h=Array.from(t).sort();return!d.wet&&p>0&&(d.wet={complete:p,total:p}),!d.dawn&&m>0&&(d.dawn={complete:m,total:m}),!d.amber&&f>0&&(d.amber={complete:f,total:f}),{letters:h,hasFrozen:n,hasWet:o,hasChilled:r,hasDawnlit:a,hasAmberlit:s,hasDawnbound:i,hasAmberbound:l,hasRainbow:c,hasGold:u,progress:d}}function St(e){return{letters:[...e.letters],hasFrozen:e.hasFrozen,hasWet:e.hasWet,hasChilled:e.hasChilled,hasDawnlit:e.hasDawnlit,hasAmberlit:e.hasAmberlit,hasDawnbound:e.hasDawnbound,hasAmberbound:e.hasAmberbound,hasRainbow:e.hasRainbow,hasGold:e.hasGold,progress:{...e.progress??{}}}}function Tt(e=0){return{F:e,W:e,C:e,D:e,A:e,R:e,G:e}}function kt(e,t,n){const o=new Set;for(const r of e)r.letters.forEach(e=>o.add(e)),r.hasDawnbound&&o.add("D"),r.hasAmberbound&&o.add("A");for(const r of Le)t[r]>0&&o.add(r);return n.D>0&&o.add("D"),n.A>0&&o.add("A"),Array.from(o).sort().join("")}function Pt(e){return"F"===e||"W"===e||"C"===e||"D"===e||"A"===e||"R"===e||"G"===e}const Mt=["data-tm-inventory-base-index","data-tm-inventory-baseindex","data-tm-base-index","data-base-index"],Et=["data-tm-inventory-id","data-inventory-id","data-item-id","data-itemid","data-itemId","data-item-uuid","data-itemuuid","data-item-guid","data-uuid","data-guid","data-entity-id","data-entityid","data-record-id","data-recordid","data-row-id","data-rowid","data-tm-item-id","data-tm-itemid","data-id"];function $t(e,t){for(const o of t){const t=e.getAttribute(o);if(null!=t)return t}const n=t.map(e=>e.toLowerCase());for(const{name:o,value:r}of Array.from(e.attributes))if(n.includes(o.toLowerCase())&&null!=r)return r;return null}function At(e,t){const n=e.dataset;if(!n)return null;for(const[o,r]of Object.entries(n))if(t(o)&&null!=r&&""!==r)return r;return null}function It(e){if(null==e)return null;const t=Number.parseInt(e,10);return Number.isFinite(t)?t:null}function Ft(e,t,n=!0){if("sunny"===t||"unknown"===t){const o={strategy:"fallback",fruitCount:Math.max(e.fruitCount,0),frozenCount:0,wetCount:0,chilledCount:0,dawnCount:0,amberCount:0,dawnBoundCount:0,amberBoundCount:0,rainbowCount:0,goldCount:0};return n&&dt(e,t,!1,o),{decision:!1,pendingFruits:0,totalFruits:Math.max(e.fruitCount,0),needsSnow:0,detail:o}}return e.slotStates.length>0&&("inventory"===e.slotSource||"garden"===e.slotSource)?function(e,t,n){const{slotStates:o}=e,r=o.some(e=>e.hasAmberlit||e.hasAmberbound),a=o.some(e=>e.hasDawnlit||e.hasDawnbound),s=o.some(e=>e.hasRainbow),l=o.some(e=>e.hasGold);if(!o.some(e=>e.letters.length>0||e.hasWet||e.hasFrozen||e.hasChilled||e.hasDawnlit||e.hasAmberlit||e.hasDawnbound||e.hasAmberbound||e.hasRainbow||e.hasGold))return qt(e,t,n);const c=o.filter(e=>{const t=(e.hasAmberlit||e.hasAmberbound)&&(e.hasDawnlit||e.hasDawnbound),n=e.hasRainbow&&e.hasGold;return t||n});c.length>0&&i(`‚ö†Ô∏è ${e.name} has ${c.length} fruit(s) with conflicting mutations (same fruit cannot be both amber+dawn or rainbow+gold)`);let u=0,d=0,p=0,m=0,f=Math.max(e.fruitCount,1),g=0,h=0,b=0,y=0,x=0,w=0;for(const i of o){(i.hasWet||i.hasFrozen)&&(u+=1),i.hasWet&&!i.hasFrozen&&(d+=1),(i.hasDawnlit||i.hasDawnbound)&&(p+=1),(i.hasAmberlit||i.hasAmberbound)&&(m+=1);const e=i.progress?.wet;e&&(g=Math.max(g,e.total),h=Math.max(h,e.complete));const t=i.progress?.dawn;t&&(b=Math.max(b,t.total),y=Math.max(y,t.complete));const n=i.progress?.amber;n&&(x=Math.max(x,n.total),w=Math.max(w,n.complete))}f=Math.max(f,u,p,m);const v=e=>Math.max(0,Math.min(f,e)),C=v(e.domMutationCounts.F),S=v(e.domMutationCounts.W),T=v(C+S),k=v(Math.max(0,T-C)),P=v(e.domMutationCounts.D+e.domBoldCounts.D),M=v(e.domMutationCounts.A+e.domBoldCounts.A);u=Math.max(u,T),d=Math.max(d,k),p=Math.max(p,P),m=Math.max(m,M),g>0&&(f=Math.max(f,g),u=Math.max(u,h));b>0&&(f=Math.max(f,b),p=Math.max(p,y));x>0&&(f=Math.max(f,x),m=Math.max(m,w));const E=Math.max(0,f-u),$=Math.max(0,f-p),A=Math.max(0,f-m),I={strategy:"inventory",totalFruits:f,wetPending:E,wetFinished:u,wetNeedsSnow:d,wetProgressComplete:h,wetProgressTotal:g,domWetProgress:T,domWetNeedsSnow:k,dawnPending:$,dawnProgressComplete:y,dawnProgressTotal:b,domDawnComplete:P,amberPending:A,amberProgressComplete:w,amberProgressTotal:x,domAmberComplete:M,hasAnyDawn:a,hasAnyAmber:r,hasAnyRainbow:s,hasAnyGold:l};let F=!1,q=0,N=d;switch(t){case"rain":F=E>0,q=E;break;case"snow":F=d>0,q=d;break;case"dawn":F=$>0,q=$,N=0;break;case"amber":F=A>0,q=A,N=0;break;default:F=!1,q=0,N=0}const z={decision:F,pendingFruits:Math.max(0,q),totalFruits:Math.max(1,f),needsSnow:Math.max(0,N),detail:{...I}};n&&dt(e,t,z.decision,z.detail);return z}(e,t,n):qt(e,t,n)}function qt(e,t,n){const{fruitCount:o,domMutationCounts:r,domBoldCounts:a}=e,s=Math.max(o,0);if(s<=0){const o={strategy:"fallback",fruitCount:s,frozenCount:0,wetCount:0,chilledCount:0,dawnCount:0,amberCount:0,dawnBoundCount:0,amberBoundCount:0,rainbowCount:0,goldCount:0};return n&&dt(e,t,!1,o),{decision:!1,pendingFruits:0,totalFruits:s,needsSnow:0,detail:o}}const i=e=>Math.max(0,Math.min(e,s)),l=i(r.F),c=i(r.W),u=i(r.C),d=i(r.D),p=i(r.A),m=i(r.R),f=i(r.G),g=i(a.D),h=i(a.A),b={strategy:"fallback",fruitCount:s,frozenCount:l,wetCount:c,chilledCount:u,dawnCount:d,amberCount:p,dawnBoundCount:g,amberBoundCount:h,rainbowCount:m,goldCount:f};let y=!1,x=0,w=Math.max(0,c-l);switch(t){case"rain":{const e=c+l;if(e<s)y=!0,x=Math.max(0,s-e);else{const e=u-l;y=e>0,x=Math.max(0,e)}break}case"snow":y=w>0,x=w;break;case"dawn":{if(p+h>0){y=!1,x=0;break}const e=d+g;x=Math.max(0,s-e),y=x>0,w=0;break}case"amber":{if(d+g>0){y=!1,x=0;break}const e=p+h;x=Math.max(0,s-e),y=x>0,w=0;break}default:y=!1,x=0,w=0}const v={decision:y,pendingFruits:Math.max(0,x),totalFruits:s,needsSnow:Math.max(0,w),detail:b};return n&&dt(e,t,v.decision,v.detail),v}function Nt(e,t,n=null,o){const r={rain:{weather:"rain",plantCount:0,pendingFruitCount:0},snow:{weather:"snow",plantCount:0,pendingFruitCount:0,needsSnowFruitCount:0},dawn:{weather:"dawn",plantCount:0,pendingFruitCount:0},amber:{weather:"amber",plantCount:0,pendingFruitCount:0}},a=new Set,s=new Set,i=new Set,l=new Set;let c=0,u=0;const d=[];for(const x of e){const e={rain:Ft(x,"rain",!1),snow:Ft(x,"snow",!1),dawn:Ft(x,"dawn",!1),amber:Ft(x,"amber",!1)};let t=null;const n=e.dawn,o=e.amber;n.decision&&o.decision&&(t="amber-preferred"),d.push({plant:x,evaluations:e,lunarTag:t})}for(const{plant:x,evaluations:w,lunarTag:v}of d){const e=ut(x);s.add(e);const t=w.amber,n=w.dawn,d=Math.max(0,Math.round(t.pendingFruits)),p=Math.max(0,Math.round(n.pendingFruits)),m=Math.max(0,Math.round(t.totalFruits??0)),f=Math.max(0,Math.round(n.totalFruits??0));(m>0||f>0)&&i.add(e);let g=null;if(m>0||d>0?g=t:(f>0||p>0)&&(g=n),g){const t=Math.max(0,Math.round(g.totalFruits??0)),n=Math.max(0,Math.round(g.pendingFruits));t>0&&(c+=t,u+=n,n>0&&l.add(e))}for(const s of tt){const t=w[s];if(!t.decision)continue;const n=Math.max(0,Math.round(t.pendingFruits)),i="snow"===s?Math.max(0,Math.round(t.needsSnow)):0,l="amber"===s&&"amber-preferred"===v?"lunar-any":void 0;r[s].plantCount+=1,r[s].pendingFruitCount+=n,"snow"===s&&(r[s].needsSnowFruitCount=(r[s].needsSnowFruitCount??0)+i);const c={pendingFruit:n,needsSnowFruit:i};l&&(c.tag=l),o?.(s,x,c),a.add(e)}}const p=tt.reduce((e,t)=>e+r[t].pendingFruitCount,0),m=s.size,f=i.size,g=l.size,h=Math.max(0,f-g),b=Math.max(0,c-u),y=n?{...n,remainingMs:null!=n.expectedEndAt?Math.max(0,n.expectedEndAt-Date.now()):n.remainingMs??null}:null;return{timestamp:Date.now(),activeWeather:t,totals:r,overallEligiblePlantCount:a.size,overallPendingFruitCount:p,overallTrackedPlantCount:m,lunar:{trackedPlantCount:f,pendingPlantCount:g,mutatedPlantCount:h,totalFruitCount:c,pendingFruitCount:u,mutatedFruitCount:b},weatherWindow:y}}function zt(e){for(const t of e){const e=ut(t);if(!Ve.has(e))continue;const n=t.element.parentElement;if(!n)continue;if(n.querySelector(".quinoa-mutation-highlight"))continue;const o=document.createElement("div");o.className="quinoa-mutation-highlight",o.style.cssText="\n      position: absolute;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      border: 3px solid #4CAF50;\n      border-radius: 8px;\n      pointer-events: auto;\n      z-index: 10;\n      animation: quinoa-pulse 1.5s infinite;\n      box-shadow: 0 0 15px rgba(76, 175, 80, 0.8);\n      cursor: pointer;\n    ",o.__plantId=e,o.addEventListener("click",e=>{e.stopPropagation();const n=o.__plantId;n&&(Ve.delete(n),i(`‚úÖ Manually removed highlight from ${t.name}`)),o.remove()}),n.style.position="relative",n.appendChild(o)}if(!document.getElementById("quinoa-mutation-styles")){const e=document.createElement("style");e.id="quinoa-mutation-styles",e.textContent="\n      @keyframes quinoa-pulse {\n        0%, 100% { opacity: 1; }\n        50% { opacity: 0.5; }\n      }\n    ",document.head.appendChild(e)}}function Lt(){((e,t=document)=>Array.from(t.querySelectorAll(e)))(".quinoa-mutation-highlight").forEach(e=>e.remove()),Ve.clear(),i("‚ú® Cleared plant highlights")}function Rt(e,t,n="info"){const o=document.querySelectorAll(".quinoa-notification");let r=20;o.forEach(e=>{const t=e.getBoundingClientRect();r=Math.max(r,t.bottom-document.documentElement.getBoundingClientRect().top+10)});const a=document.createElement("div");if(a.classList.add("quinoa-notification"),a.style.cssText=`\n    position: fixed;\n    top: ${r}px;\n    right: 20px;\n    background: ${{success:"rgba(76, 175, 80, 0.95)",info:"rgba(33, 150, 243, 0.95)",warning:"rgba(255, 152, 0, 0.95)"}[n]};\n    color: white;\n    padding: 16px 20px;\n    border-radius: 12px;\n    font-family: Arial, sans-serif;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n    z-index: 999999;\n    max-width: 320px;\n    animation: slideInRight 0.3s ease-out;\n    transition: top 0.3s ease-out;\n  `,a.innerHTML=`\n    <div style="font-size: 16px; font-weight: bold; margin-bottom: 4px;">${e}</div>\n    <div style="font-size: 13px; opacity: 0.95;">${t}</div>\n  `,!document.getElementById("quinoa-notification-styles")){const e=document.createElement("style");e.id="quinoa-notification-styles",e.textContent="\n      @keyframes slideInRight {\n        from {\n          transform: translateX(400px);\n          opacity: 0;\n        }\n        to {\n          transform: translateX(0);\n          opacity: 1;\n        }\n      }\n      @keyframes slideOutRight {\n        from {\n          transform: translateX(0);\n          opacity: 1;\n        }\n        to {\n          transform: translateX(400px);\n          opacity: 0;\n        }\n      }\n    ",document.head.appendChild(e)}document.body.appendChild(a),setTimeout(()=>{a.style.animation="slideOutRight 0.3s ease-in",setTimeout(()=>{a.remove(),function(){const e=document.querySelectorAll(".quinoa-notification");let t=20;e.forEach(e=>{e.style.top=`${t}px`;const n=e.getBoundingClientRect();t=n.bottom-document.documentElement.getBoundingClientRect().top+10})}()},300)},6e3)}function Bt(e){switch(e){case"rain":return"to freeze (C‚ÜíF)";case"snow":return"to freeze (W‚ÜíF)";case"dawn":return"to get Dawnlit";case"amber":return"to get Amberlit";default:return"for mutations"}}function jt(e){switch(e){case"rain":return"üåßÔ∏è";case"snow":return"‚ùÑÔ∏è";case"dawn":return"üåÖ";case"amber":return"üåÜ";case"sunny":return"‚òÄÔ∏è";default:return"‚ùì"}}const Dt=Object.freeze(Object.defineProperty({__proto__:null,buildMutationSummary:Nt,checkForMutations:async function(){at(),He.enabled&&"sunny"!==_e&&"unknown"!==_e?await ct():He.enabled&&i("üå§Ô∏è Current weather is sunny or unknown - no mutations available")},combineMutationSources:kt,computeSlotStateFromMutationNames:Ct,createMutationCountMap:Tt,deriveWeatherWindowFromSnapshot:lt,resolveWeatherDurationMs:it,setMutationReminderEnabled:function(e){He.enabled=e,d.set(Re,He),e?(at(),rt()):(Oe?.(),Oe=null)},simulateWeather:async function(e){i(`üß™ [DEBUG] Simulating weather: ${e}`),Xe=!0,at(),We=_e,_e=e,Lt(),He.enabled&&"sunny"!==e&&"unknown"!==e?await ct():i("üå§Ô∏è Simulated weather is sunny or unknown - no mutations available"),setTimeout(()=>{Xe=!1,i("üß™ [DEBUG] Simulation mode ended, auto-detection resuming")},3e4)},startMutationReminder:ot},Symbol.toStringTag,{value:"Module"})),Ht="myDataAtom",_t="__qpmGardenSnapshot__";let Wt=!1,Ot=b(_t)??null;const Gt=new Set;let Ut=null;const Xt=1500;function Vt(e){Ot!==e&&(Ot=e,function(){h(_t,Ot);for(const t of Gt)try{t(Ot)}catch(e){i("‚ö†Ô∏è Garden listener error",e)}}())}function Kt(e){if(!e||"object"!=typeof e)return null;return e.garden??null}async function Jt(){if(Wt)return;Wt=!0,Ut&&(clearTimeout(Ut),Ut=null);try{await P()}catch(t){return i("‚ö†Ô∏è Jotai store unavailable, garden bridge deferred",t),Wt=!1,void(Ut||(Ut=window.setTimeout(()=>{Ut=null,Jt()},Xt)))}try{const e=await async function(){const e=E(Ht);if(!e)throw new Error("Unable to locate myDataAtom in jotaiAtomCache");return Kt(await $(e).catch(e=>(i("‚ö†Ô∏è Failed to read myDataAtom",e),null))??void 0)}();Vt(e)}catch(t){i("‚ö†Ô∏è Unable to prime garden snapshot",t),Ut||(Ut=window.setTimeout(()=>{Ut=null,Wt=!1,Jt()},Xt))}const e=E(Ht);if(!e)return i("‚ö†Ô∏è myDataAtom missing after initialization"),Wt=!1,void(Ut||(Ut=window.setTimeout(()=>{Ut=null,Jt()},Xt)));await A(e,e=>{Vt(Kt(e??void 0))})}function Yt(){return Ot}function Qt(e,t=!0){if(Gt.add(e),t)try{e(Ot)}catch(n){i("‚ö†Ô∏è Garden listener immediate call failed",n)}return()=>{Gt.delete(e)}}let Zt=!1,en=null,tn="unknown",nn=null,on=null;const rn=["wet","dawn","amber"];function an(){Zt&&null===nn&&(nn=window.setTimeout(()=>{nn=null,function(){if(!Zt)return;const e=function(e){const t=[];if(!e)return t;const n=[{label:"garden",tiles:e.tileObjects},{label:"boardwalk",tiles:e.boardwalkTileObjects}];for(const{label:o,tiles:r}of n)if(r&&"object"==typeof r)for(const[e,n]of Object.entries(r)){if(!n||"object"!=typeof n)continue;const r=n;if("plant"!==r.objectType)continue;const{slotStates:a,inferredSpecies:s}=sn(r),i=a.length;if(0===i)continue;const l=un(a),c=dn(a),u=kt(a,l,c),d=`${pn(r,s)} [${o}:${e}]`;t.push({name:d,mutations:u,element:document.createElement("div"),fruitCount:i,slotStates:a,slotSource:"garden",domMutationCounts:l,domBoldCounts:c})}return t}(en),t={rain:[],snow:[],dawn:[],amber:[]},n=Nt(e,tn,lt(tn,on),(e,n,o)=>{const r={name:n.name,pendingFruit:o.pendingFruit,needsSnowFruit:o.needsSnowFruit,fruitCount:n.fruitCount,source:n.slotSource};o.tag&&(r.tag=o.tag),t[e].push(r)});ze("garden",n),Fe({source:"garden",generatedAt:n.timestamp,summary:n,perWeather:t,metadata:qe(n,{scannedPlantCount:e.length})})}()},75))}function sn(e){const t=Array.isArray(e.slots)?e.slots:[],n=[];let o=null;for(const r of t){if(!r||"object"!=typeof r)continue;const e=r,t=ln(e);t&&!o&&(o=t);const a=Ct((Array.isArray(e.mutations)?e.mutations:[]).map(e=>"string"==typeof e?e:null).filter(e=>!!e));cn(a,e),n.push(a)}return{slotStates:n,inferredSpecies:o}}function ln(e){const t=[e.species,e.seedSpecies,e.plantSpecies,e.cropSpecies,e.name];for(const n of t)if("string"==typeof n){const e=n.trim();if(e.length>0)return e}return null}function cn(e,t){const n=[t.progress,t.mutationProgress];for(const o of n){if(!o||"object"!=typeof o)continue;const t=o;for(const n of rn){const o=t[n];if(!o||"object"!=typeof o)continue;const r=o,a=Number(r.complete),s=Number(r.total);if(!Number.isFinite(s)||s<=0)continue;if(!Number.isFinite(a)||a<0)continue;const i=e.progress[n];(!i||s>i.total||s===i.total&&a>i.complete)&&(e.progress[n]={complete:a,total:s})}}}function un(e){const t=Tt(0);for(const n of e)n.hasFrozen&&(t.F+=1),n.hasWet&&(t.W+=1),n.hasChilled&&(t.C+=1),(n.hasDawnlit||n.hasDawnbound)&&(t.D+=1),(n.hasAmberlit||n.hasAmberbound)&&(t.A+=1),n.hasRainbow&&(t.R+=1),n.hasGold&&(t.G+=1);return t}function dn(e){return{D:e.filter(e=>e.hasDawnbound).length,A:e.filter(e=>e.hasAmberbound).length}}function pn(e,t){const n=[e.name,e.displayName,e.plantName,e.label],o=e.plant;if(o&&"object"==typeof o){const e=o;n.push(e.name),n.push(e.displayName)}for(const r of n)if("string"==typeof r){const e=r.trim();if(e.length>0)return e}return t&&t.length>0?t.toLowerCase().includes("plant")?t:`${t} Plant`:"Unknown Plant"}function mn(e){switch(e){case"rain":case"snow":case"dawn":case"amber":return e;case"sunny":return"sunny";default:return"unknown"}}const fn={worm:500,snail:1e3,bee:1500,chicken:3e3,bunny:750,dragonfly:250,pig:5e4,cow:25e3,squirrel:15e3,turtle:1e5,goat:2e4,butterfly:25e3,capybara:15e4,peacock:1e5};const gn={Bee:12,Butterfly:12,Ladybug:12,Dragonfly:12,Frog:18,Snake:18,Turtle:18,Lizard:18,Peacock:24,Swan:24,Flamingo:24,Unicorn:36,Dragon:36,Phoenix:36};function hn(e){const t=function(e){if(!e)return null;const t=e.toLowerCase().trim();for(const[n,o]of Object.entries(gn))if(n.toLowerCase()===t)return o;for(const[n,o]of Object.entries(gn))if(t.includes(n.toLowerCase())||n.toLowerCase().includes(t))return o;return null}(e);return t?3600*t:null}const bn=new Map,yn=new Set;function xn(e){const t={currentLevel:null,maxLevel:30,confidence:"none",totalXPNeeded:null,xpGainRate:null};if(!e.petId||null==e.xp)return t;const n=bn.get(e.petId);if(!n||n.length<2)return t;const o=function(e){if(e.length<2)return null;const t=e[0],n=e[e.length-1],o=n.xp-t.xp,r=(n.timestamp-t.timestamp)/1e3;return r<=0||o<=0?null:o/r}(n);if(!o)return t;const r=hn(e.species);if(!r)return e.species&&!yn.has(e.species)&&(yn.add(e.species),i(`‚ö†Ô∏è No time-to-mature data for species: ${e.species}`)),{...t,xpGainRate:o};const a=o*r;let s=e.xp/a*30;s=Math.max(0,Math.min(30,s));const l=(n[n.length-1].timestamp-n[0].timestamp)/1e3;let c="low";return n.length>=5&&l>=300?c="high":n.length>=3&&l>=120&&(c="medium"),{currentLevel:Math.round(s),maxLevel:30,confidence:c,totalXPNeeded:a,xpGainRate:o}}let wn=[],vn=null,Cn=!1;const Sn=new Set;let Tn=null;function kn(e){if(null==e)return null;if("number"==typeof e)return Number.isFinite(e)?e:null;if("string"==typeof e){const t=e.match(/-?\d+(?:\.\d+)?/);if(!t)return null;const n=Number(t[0]);return Number.isFinite(n)?n:null}return"object"==typeof e?kn(e?.valueOf?.()):null}function Pn(e){return Number.isFinite(e)?e<0?0:e>100?100:e:0}function Mn(e,t=!1){if(!Number.isFinite(e))return null;if(e<0)return 0;if(e>0&&e<=1)return 100*e;if(e>=0&&e<=100)return e;if(t&&e>100&&e<=1e4){const t=e/100;if(t<=100)return t}return null}function En(e,t,n,o){const r=t.pet??e.pet??null,a=[{value:e.hungerPct,hint:"entry.hungerPct"},{value:e.hunger_percentage,hint:"entry.hunger_percentage"},{value:e.hunger,hint:"entry.hunger"},{value:t.hungerPct,hint:"slot.hungerPct"},{value:t.hunger_percentage,hint:"slot.hunger_percentage"},{value:t.hunger,hint:"slot.hunger"},{value:n?.hungerPct,hint:"stats.hungerPct"},{value:n?.hunger,hint:"stats.hunger"},{value:r?.hungerPct,hint:"nested.hungerPct"},{value:r?.hunger,hint:"nested.hunger"}];let s=null;const i=[],l=[];for(const{value:d,hint:p}of a){if(null==d)continue;null==s&&(s=String(d));const e=kn(d);if(null==e)continue;const t=/pct|percent/i.test(p),n=Mn(e,t);null!=n&&(t||e<=100)?i.push(n):l.push(e)}const c=l.length>0?l[0]:null,u=o?function(e){if(!e)return null;const t=function(e){return e.replace(/[^a-z0-9]/gi,"").toLowerCase()}(e);return t?fn[t]??null:null}(o):null;if(i.length){return{pct:Pn(i[0]),value:c,max:u,raw:s}}if(null!=c){if(null!=u&&u>0){return{pct:Pn(c/u*100),value:c,max:u,raw:s}}if(c>0){return{pct:Pn(c/3e3*100),value:c,max:3e3,raw:s}}return{pct:0,value:c,max:u,raw:s}}return{pct:null,value:null,max:u,raw:s}}function $n(e){const t=e.slot??{},n=[e.name,e.displayName,t.name,t.displayName];for(const o of n)if("string"==typeof o&&o.trim().length>0)return o.trim();return null}function An(e){if(!e)return[];if(Array.isArray(e))return e.filter(e=>!!e&&"object"==typeof e);if(e instanceof Map)return Array.from(e.values()).filter(e=>!!e&&"object"==typeof e);if(e instanceof Set)return Array.from(e.values()).filter(e=>!!e&&"object"==typeof e);if("object"==typeof e){const t=e,n=[];for(const[e,o]of Object.entries(t))/^\d+$/.test(e)&&o&&"object"==typeof o&&n.push(o);if(n.length)return n}return[]}function In(e){const t=e.slot;return t&&"object"==typeof t?t:e}function Fn(e){if(null==e)return null;if("string"==typeof e){const t=e.trim();return t.length>0?t:null}return"number"==typeof e&&Number.isFinite(e)?String(e):null}function qn(e){const t=new Set,n=[];for(const o of e){const e=o.toLowerCase();t.has(e)||(t.add(e),n.push(o))}return n}function Nn(e){if(!e)return[];if("string"==typeof e){const t=Fn(e);return t?[t]:[]}if(Array.isArray(e)){const t=[];for(const n of e){const e=Fn(n);e&&t.push(e)}return t}return e instanceof Set?Nn(Array.from(e.values())):[]}function zn(e){const t=In(e),n=t.pet??e.pet??null,o=[e.slotId,t.slotId,t.slotID,t.id,n?.slotId,n?.id,e.id];for(const r of o){const e=Fn(r);if(e)return e}return null}function Ln(e){const t=In(e),n=t.pet??e.pet??null,o=[e.petId,t.petId,n?.petId,n?.id,t.id,e.entityId];for(const r of o){const e=Fn(r);if(e)return e}return zn(e)}function Rn(e){const t=In(e),n=t.pet??e.pet??null;return qn([...Nn(e.mutations),...Nn(t.mutations),...Nn(n?.mutations)])}function Bn(e){const t=In(e),n=t.pet??e.pet??null;return qn([...Nn(e.abilities),...Nn(t.abilities),...Nn(t.ability),...Nn(n?.abilities)])}function jn(e){const t=In(e),n=[e.position,e.pos,t.position,t.pos];for(const o of n){if(!o||"object"!=typeof o)continue;const e=o,t=kn(e.x??e.X??e.left??e.posX??e.longitude),n=kn(e.y??e.Y??e.top??e.posY??e.latitude);if(null!=t||null!=n)return{x:t??null,y:n??null}}return null}function Dn(e){const t=function(e){const t=[e],n=new Set;for(;t.length;){const e=t.shift();if(null==e)continue;const o=An(e);if(o.length)return o;if("object"==typeof e){if(n.has(e))continue;if(n.add(e),e instanceof Map){for(const n of e.values())t.push(n);continue}if(e instanceof Set){for(const n of e.values())t.push(n);continue}const o=e;for(const e of Object.values(o))t.push(e)}}return[]}(e);if(!t.length)return[];const n=Date.now(),o=[],r=function(){const e=[];try{const t=document.querySelectorAll("p.chakra-text.css-1jrst1o");for(const n of t){const t=(n.textContent||"").match(/\bSTR\s+(\d+)\b/i);if(t&&t[1]){const n=parseInt(t[1],10);e.includes(n)||e.push(n)}}}catch(t){}return e}();return t.forEach((e,t)=>{if(!e||"object"!=typeof e)return;const a=e,s=In(a),i=s.stats??void 0,l=s.pet??a.pet??void 0,c=function(e,t){const n=[e.slotIndex,e.slot?.slotIndex,e.order,e.index,e.slot?.index,e.slot?.originalIndex,e.slot?.orderedIndex,t];for(const o of n){const e=kn(o);if(null!=e&&Number.isFinite(e))return Math.max(0,Math.round(e))}return t}(a,t),u=function(e){const t=e.slot??{},n=[e.species,t.species,t.petSpecies,e.petSpecies];for(const o of n)if("string"==typeof o&&o.trim().length>0)return o.trim();return null}(a),d=En(a,s,i,u),p=[s.xp,i?.xp,a.xp];let m=null;for(const n of p){const e=kn(n);if(null!=e){m=e;break}}const f=[s.level,i?.level,a.level,l?.level];let g=null,h=null;for(const n of f){null!=n&&null==h&&(h="string"==typeof n?n:String(n));const e=kn(n);if(null!=e){g=Math.max(0,Math.round(e));break}}const b=[s.strength,i?.strength,a.strength];let y=null;for(const n of b){const e=kn(n);if(null!=e){y=e;break}}null==y&&c<r.length&&(y=r[c]??null);const x=[s.targetScale,i?.targetScale,a.targetScale,l?.targetScale];let w=null;for(const n of x){const e=kn(n);if(null!=e){w=e;break}}const v={slotIndex:c,slotId:zn(a),petId:Ln(a),hungerPct:d.pct,hungerValue:d.value,hungerMax:d.max,hungerRaw:d.raw,name:$n(a),species:u,targetScale:w,mutations:Rn(a),abilities:Bn(a),xp:m,level:g,levelRaw:h,strength:y,position:jn(a),updatedAt:n,raw:e};if(null==v.level&&null!=v.xp&&v.petId){!function(e){if(!e.petId||null==e.xp)return;const t=Date.now();let n=bn.get(e.petId);n||(n=[],bn.set(e.petId,n)),n.push({xp:e.xp,timestamp:t}),n.length>10&&n.shift()}(v);const e=xn(v);null!=e.currentLevel&&(v.level=e.currentLevel)}o.push(v)}),o.sort((e,t)=>e.slotIndex-t.slotIndex)}async function Hn(){if(!vn&&!Cn){Cn=!0;try{const e=E("myPetInfosAtom");if(!e)throw new Error("myPetInfosAtom not found in jotai cache");vn=await A(e,e=>{wn=Dn(e),function(){for(const t of Sn)try{t(wn)}catch(e){i("‚ö†Ô∏è Pet info listener threw",e)}}()}),null!=Tn&&(window.clearTimeout(Tn),Tn=null)}catch(e){i("‚ö†Ô∏è Failed to start pet info store",e),null==Tn&&(Tn=window.setTimeout(()=>{Tn=null,vn||Hn()},1500))}finally{Cn=!1}}}function _n(){return wn}function Wn(e,t=!0){if(Sn.add(e),t)try{e(wn)}catch(n){i("‚ö†Ô∏è Pet info immediate callback failed",n)}return()=>{Sn.delete(e)}}const On=/myCurrentGrowSlotIndex/i;let Gn=!1,Un=!1,Xn=null,Vn=null;const Kn=new Set;function Jn(e){const t="number"==typeof(n=e)&&Number.isFinite(n)?Math.max(0,Math.trunc(n)):null;var n;if(Xn!==t){Xn=t;try{f.__qpmCurrentGrowSlotIndex=t,"undefined"!=typeof window&&(window.__qpmCurrentGrowSlotIndex=t)}catch{}!function(e){for(const n of Kn)try{n(e)}catch(t){i("‚ö†Ô∏è Grow slot index listener error",t)}}(Xn)}}async function Yn(){try{await P()}catch(t){throw i("‚ö†Ô∏è Grow slot index tracker: jotai store unavailable",t),t}const e=await async function(){let e=E("myCurrentGrowSlotIndexAtom");return e||(M(On)[0]??null)}();if(!e)throw new Error("myCurrentGrowSlotIndexAtom not found");try{Jn(await $(e).catch(()=>null))}catch(t){i("‚ö†Ô∏è Grow slot index tracker: failed to read initial value",t)}await A(e,e=>{Jn(e)})}async function Qn(){if(!Gn&&!Un){Un=!0;try{await Yn(),Gn=!0}catch(e){return i("‚ö†Ô∏è Grow slot index tracker initialization failed",e),void(null==Vn&&"undefined"!=typeof window&&(Vn=window.setTimeout(()=>{Vn=null,Un=!1,Qn()},2500)))}finally{Un=!1}}}const Zn="qpm-turtle-manual-overrides";let eo={};function to(){try{d.set(Zn,eo)}catch(e){i("‚ö†Ô∏è Failed to save manual pet overrides",e)}}function no(e){return e.petId?`pet:${e.petId}`:e.species?`${e.species}:${e.slotIndex}`:`slot:${e.slotIndex}`}const oo=[{kind:"plant",patterns:["plantgrowthboost"],minutesPerBase:5,procOdds:.27},{kind:"egg",patterns:["egggrowthboost"],minutesPerBase:10,procOdds:.24}],ro={restore:["hungerrestore"],slow:["hungerboost"]},ao=[0,30,35,40,45],so=[0,.12,.14,.16,.18],io=[0,12,16,20,24];function lo(e,t,n){const o=function(e,t){const n=e.match(/\b(IV|III|II|I)\b/i);if(n)switch(n[1].toUpperCase()){case"I":return 1;case"II":return 2;case"III":return 3;case"IV":return 4}const o=e.match(/\b(\d+)\b/);if(o){const e=Number.parseInt(o[1],10);if(Number.isFinite(e)&&e>0)return e}return t.endsWith("iv")?4:t.endsWith("iii")?3:t.endsWith("ii")?2:1}(t,n);if("restore"===e){return{effectPct:ao[Math.min(o,ao.length-1)]??ao[1],procOdds:so[Math.min(o,so.length-1)]??so[1]}}if("slow"===e){return{effectPct:io[Math.min(o,io.length-1)]??io[1],procOdds:null}}return null}function co(e,t){if(!t||t<=0||e<=0)return 0;const n=Math.min(.95,Math.max(0,t*(e/100)));return 60*(1-Math.pow(1-n,1/60))}function uo(e){if(!e)return!1;const t=e.toLowerCase();return!t.includes("eggplant")&&t.includes("egg")}function po(e){if(!e)return!1;const t=e.toLowerCase();return t.includes("plant")||t.includes("crop")}function mo(e){return!!uo(e.objectType)||(!!uo(e.slotType)||(!!uo(e.slotCategory)||(!!uo(e.slotKind)||(!!uo(e.tileObjectType)||(!!uo(e.tileCategory)||(!!uo(e.seedSpecies)||(!!uo(e.plantSpecies)||(!!uo(e.eggId)||(!!uo(e.eggSpecies)||function(e){if(!e)return!1;const t=e.toLowerCase();return!t.includes("eggplant")&&/\begg\b/.test(t)}(e.species))))))))))}const fo="::";let go={enabled:!0,includeBoardwalk:!0,minActiveHungerPct:2,fallbackTargetScale:1.5,focus:"latest",maxTargetScale:2.5,focusTargetTileId:null,focusTargetSlotIndex:null,eggFocus:"latest",eggFocusTargetTileId:null,eggFocusTargetSlotIndex:null},ho=!1,bo=Yt(),yo=wn;const xo=new Set;function wo(e){return e.toLowerCase().replace(/[^a-z0-9]/g,"")}function vo(e="no-data"){return{status:e,trackedSlots:0,growingSlots:0,maturedSlots:0,contributions:[],expectedMinutesRemoved:null,effectiveRate:null,naturalMsRemaining:null,adjustedMsRemaining:null,minutesSaved:null,focusSlot:null}}function Co(){return{enabled:go.enabled,now:Date.now(),includeBoardwalk:go.includeBoardwalk,focus:go.focus,focusTargetKey:null,focusTargetAvailable:!1,eggFocus:go.eggFocus,eggFocusTargetKey:null,eggFocusTargetAvailable:!1,minActiveHungerPct:go.minActiveHungerPct,fallbackTargetScale:go.fallbackTargetScale,availableTurtles:0,hungerFilteredCount:0,turtlesMissingStats:0,plant:vo(),plantTargets:[],egg:vo(),eggTargets:[],support:{restoreCount:0,restoreActiveCount:0,slowCount:0,slowActiveCount:0,restorePctTotal:0,restorePctActive:0,restorePctPerHourTotal:0,restorePctPerHourActive:0,restoreTriggersPerHourTotal:0,restoreTriggersPerHourActive:0,slowPctTotal:0,slowPctActive:0,entries:[]}}}function So(e,t){return e&&null!=t?`${e}${fo}${t}`:null}let To=Co();function ko(e){if("number"==typeof e&&Number.isFinite(e))return e;if("string"==typeof e){const t=Number(e);if(Number.isFinite(t))return t}return null}function Po(e,t){const n=[];if(!e)return n;const o=(e,t)=>{for(const n of t){const t=e[n];if("string"==typeof t&&t.trim().length>0)return t}return null},r=(e,t)=>{if("number"==typeof e&&Number.isFinite(e))return e;if("string"==typeof e){const t=Number(e);if(Number.isFinite(t))return t}return t},a=(e,t,n,a,s)=>{const i=r(n.slotIndex,r(s.slotIndex,a)),l=ko(n.endTime??n.maturedAt??n.readyAt??n.harvestReadyAt??n.finishAt??s.endTime??s.maturedAt??s.readyAt??s.harvestReadyAt??s.finishAt),c=ko(n.readyAt??n.maturedAt??n.harvestReadyAt??n.endTime??s.readyAt??s.maturedAt??s.harvestReadyAt??s.endTime),u=ko(n.plantedAt??n.startTime??n.startedAt??s.plantedAt??s.startTime??s.startedAt),d=o(s,["objectType","object_type"]),p=o(s,["slotCategory","category","slot_category"]),m=o(n,["objectType","object_type"])??d,f=o(n,["type","slotType","slot_type"]),g=o(n,["category","slotCategory","slot_category"]),h=o(n,["kind"]),b={tileId:e,slotIndex:i,species:o(n,["species","seedSpecies","plantSpecies","petSpecies"])??o(s,["species","seedSpecies","plantSpecies","petSpecies"]),seedSpecies:o(n,["seedSpecies"])??o(s,["seedSpecies"]),plantSpecies:o(n,["plantSpecies"])??o(s,["plantSpecies"]),eggId:o(n,["eggId","eggID"])??o(s,["eggId","eggID"]),eggSpecies:o(n,["eggSpecies","eggType"])??o(s,["eggSpecies","eggType"]),boardwalk:t,endTime:l,readyAt:c,plantedAt:u,slotType:f,slotCategory:g,objectType:m,tileObjectType:d,tileCategory:p,slotKind:h};return(e=>!!(po(e.objectType)||po(e.tileObjectType)||po(e.slotType)||po(e.slotCategory)||po(e.tileCategory)||uo(e.objectType)||uo(e.slotType)||uo(e.slotCategory)||uo(e.slotKind)||uo(e.tileObjectType)||uo(e.tileCategory)||uo(e.species)||uo(e.seedSpecies)||uo(e.plantSpecies)||uo(e.eggId)||uo(e.eggSpecies)||e.species||e.seedSpecies||e.plantSpecies||null!=e.endTime||null!=e.readyAt||null!=e.plantedAt))(b)?b:null},s=(e,t)=>{if(!e||"object"!=typeof e)return;const o=Object.entries(e);for(const[r,s]of o){if(!s||"object"!=typeof s)continue;const e=s,o=Array.isArray(e.slots)?e.slots:[];let i=!1;if(o.forEach((o,s)=>{if(!o||"object"!=typeof o)return;const l=a(r,t,o,s,e);l&&(n.push(l),i=!0)}),!i){const o=a(r,t,e,0,e);o&&n.push(o)}}};return s(e.tileObjects??null,!1),t&&s(e.boardwalkTileObjects??null,!0),n}function Mo(e){const t=function(e){const t=no(e);return eo[t]??null}(e);let n="number"==typeof e.xp&&Number.isFinite(e.xp)?e.xp:null;null==n&&null!=t?.xp&&(n=t.xp);let o=e.targetScale;null==o&&null!=t?.targetScale&&(o=t.targetScale);const r="number"==typeof(a=o)&&Number.isFinite(a)?a<1?1:a>go.maxTargetScale?go.maxTargetScale:a:go.fallbackTargetScale;var a;let s="number"==typeof e.strength&&Number.isFinite(e.strength)?e.strength:null;null==s&&null!=t?.strength&&(s=t.strength);const i=null==e.xp||null==e.targetScale,l=t&&(null!=t.xp||null!=t.targetScale||null!=t.strength);let c;if(null!=s)c=Math.max(0,s);else{const e=Math.min(Math.floor((n??0)/36e4*30),30),t=Math.floor((r-1)/(go.maxTargetScale-1)*20+80)-30;c=Math.max(0,e+t)}return{xp:n,targetScale:r,baseScore:c,missingStats:i&&!l}}function Eo(e,t,n){const o=Mo(e),{xp:r,targetScale:a,baseScore:s,missingStats:i}=o,l=s>0?s/100*t.minutesPerBase*60*(1-Math.pow(1-t.procOdds*s/100,1/60)):0,c=60*l;return{ability:t.kind,abilityNames:n,slotIndex:e.slotIndex,name:e.name,species:e.species,hungerPct:e.hungerPct,xp:r,targetScale:a,baseScore:s,rateContribution:l,perHourReduction:c,missingStats:i}}function $o(e,t,n,o,r,a,s,i){const l=t.filter(e=>null!=e.endTime).length,c=t.filter(e=>null!=e.endTime&&e.endTime>o).length,u=t.filter(e=>null!=e.endTime&&e.endTime<=o).length,d={status:"no-data",trackedSlots:l,growingSlots:c,maturedSlots:u,contributions:n.slice().sort((e,t)=>t.rateContribution-e.rateContribution),expectedMinutesRemoved:null,effectiveRate:null,naturalMsRemaining:null,adjustedMsRemaining:null,minutesSaved:null,focusSlot:null};if(0===t.length||0===l)return d;if(0===c)return{...d,status:"egg"===e?"no-eggs":"no-crops"};const p=function(e,t,n,o,r){const a=e.filter(e=>null!=e.endTime&&e.endTime>r);if(!a.length)return null;if("specific"===t){if(n&&null!=o){const e=a.find(e=>e.tileId===n&&e.slotIndex===o);if(e)return e}return null}return"earliest"===t?a.reduce((e,t)=>e?(t.endTime??1/0)<(e.endTime??1/0)?t:e:t,a[0]):a.reduce((e,t)=>e?(t.endTime??-1/0)>(e.endTime??-1/0)?t:e:t,a[0])}(t,a,s,i,o);if(!p||null==p.endTime)return{...d,status:"no-data"};const m=Math.max(0,p.endTime-o),f=m/6e4,g=n.reduce((e,t)=>e+t.rateContribution,0),h=Number.isFinite(g)&&g>0,b=h?g:0,y=h?Math.max(.01,1+b):1,x=f/Math.max(.01,y),w=6e4*x,v=h?Math.max(0,f-x):null;return{status:h?"estimating":"no-turtles",trackedSlots:l,growingSlots:c,maturedSlots:u,contributions:d.contributions,expectedMinutesRemoved:h?b:null,effectiveRate:h?y:null,naturalMsRemaining:m,adjustedMsRemaining:h?w:m,minutesSaved:v,focusSlot:{...p,remainingMs:m}}}function Ao(e){return e.petId??e.slotId??`${e.slotIndex}-${e.name??"pet"}`}function Io(e){To=e;for(const n of xo)try{n(To)}catch(t){i("‚ö†Ô∏è Turtle timer listener error",t)}}function Fo(){const e=Date.now(),t=Co();if(t.now=e,!go.enabled)return t.enabled=!1,t.plant.status="disabled",t.egg.status="disabled",void Io(t);const n=Po(bo,go.includeBoardwalk),o=n.filter(e=>mo(e)),r=n.filter(e=>!mo(e)),a=[],s=[],i=[],l=new Set,c=new Set,u=new Set;for(const I of yo){if(!I||"object"!=typeof I)continue;const e=Array.isArray(I.abilities)?I.abilities.filter(e=>"string"==typeof e&&e.trim().length>0).map(e=>({raw:e,normalized:wo(e)})):[];if(0===e.length)continue;const t=Ao(I),n=I.hungerPct,o=null==n||n>go.minActiveHungerPct;let r=!1;for(const i of oo){const n=e.filter(({normalized:e})=>i.patterns.some(t=>e.includes(t))).map(({raw:e})=>e);if(0===n.length)continue;if(r=!0,l.add(t),!o){c.add(t);continue}const d=Eo(I,i,n);d.missingStats&&u.add(t),d.rateContribution<=0||("plant"===i.kind?a.push(d):s.push(d))}const d=Mo(I);for(const a of Object.keys(ro)){const t=e.filter(({normalized:e})=>ro[a].some(t=>e.includes(t))).map(({raw:e})=>e);if(0===t.length)continue;const r=[];let s=0,l=0,c=0,u=0;for(const e of t){const t=wo(e),n=lo(a,e,t);if(n)if("restore"===a){const o=co(d.baseScore,n.procOdds),a=60*o,i=a*n.effectPct;s+=n.effectPct,l+=i,c+=a,r.push({abilityName:e,normalizedName:t,perTriggerPct:n.effectPct,slowdownPct:null,triggersPerHour:a,pctPerHour:i,probabilityPerMinute:o})}else u+=n.effectPct,r.push({abilityName:e,normalizedName:t,perTriggerPct:null,slowdownPct:n.effectPct,triggersPerHour:null,pctPerHour:null,probabilityPerMinute:null})}0!==r.length&&i.push({type:a,abilityNames:t,slotIndex:I.slotIndex,name:I.name,species:I.species,hungerPct:n,active:o,xp:d.xp,targetScale:d.targetScale,baseScore:d.baseScore,missingStats:d.missingStats,abilityDetails:r,totalRestorePerTriggerPct:s,totalRestorePerHourPct:l,totalTriggersPerHour:c,totalSlowPct:u})}r||o||c.add(t)}const d=go.focusTargetTileId,p=go.focusTargetSlotIndex,m=$o("plant",r,a,e,0,go.focus,d,p),f=go.eggFocusTargetTileId,g=go.eggFocusTargetSlotIndex,h=$o("egg",o,s,e,0,go.eggFocus,f,g);let b=0,y=0,x=0,w=0,v=0,C=0,S=0,T=0,k=0,P=0,M=0,E=0;i.sort((e,t)=>e.type===t.type?e.active===t.active?(e.name??"").localeCompare(t.name??""):e.active?-1:1:"restore"===e.type?-1:1);for(const I of i)"restore"===I.type?(b+=1,v+=I.totalRestorePerTriggerPct,S+=I.totalRestorePerHourPct,k+=I.totalTriggersPerHour,I.active&&(y+=1,C+=I.totalRestorePerTriggerPct,T+=I.totalRestorePerHourPct,P+=I.totalTriggersPerHour)):(x+=1,M+=I.totalSlowPct,I.active&&(w+=1,E+=I.totalSlowPct));t.enabled=!0,t.includeBoardwalk=go.includeBoardwalk,t.focus=go.focus,t.eggFocus=go.eggFocus;const $=r.filter(t=>null!=t.endTime&&t.endTime>e).map(t=>({key:So(t.tileId,t.slotIndex)??`${t.tileId}${fo}${t.slotIndex}`,tileId:t.tileId,slotIndex:t.slotIndex,species:t.species??t.seedSpecies??t.plantSpecies,boardwalk:t.boardwalk,endTime:t.endTime??null,remainingMs:null!=t.endTime?Math.max(0,t.endTime-e):null}));t.plantTargets=$,t.focusTargetKey=So(d,p),t.focusTargetAvailable=null!=t.focusTargetKey&&$.some(e=>e.key===t.focusTargetKey);const A=o.filter(t=>null!=t.endTime&&t.endTime>e).map(t=>({key:So(t.tileId,t.slotIndex)??`${t.tileId}${fo}${t.slotIndex}`,tileId:t.tileId,slotIndex:t.slotIndex,species:t.eggSpecies??t.eggId??t.species,boardwalk:t.boardwalk,endTime:t.endTime??null,remainingMs:null!=t.endTime?Math.max(0,t.endTime-e):null}));t.eggTargets=A,t.eggFocusTargetKey=So(f,g),t.eggFocusTargetAvailable=null!=t.eggFocusTargetKey&&A.some(e=>e.key===t.eggFocusTargetKey),t.minActiveHungerPct=go.minActiveHungerPct,t.fallbackTargetScale=go.fallbackTargetScale,t.availableTurtles=l.size,t.hungerFilteredCount=c.size,t.turtlesMissingStats=u.size,t.plant=m,t.egg=h,t.support={restoreCount:b,restoreActiveCount:y,slowCount:x,slowActiveCount:w,restorePctTotal:v,restorePctActive:C,restorePctPerHourTotal:S,restorePctPerHourActive:T,restoreTriggersPerHourTotal:k,restoreTriggersPerHourActive:P,slowPctTotal:M,slowPctActive:E,entries:i},Io(t)}function qo(e){if(e){if("boolean"==typeof e.enabled&&(go.enabled=e.enabled),"boolean"==typeof e.includeBoardwalk&&(go.includeBoardwalk=e.includeBoardwalk),"number"==typeof e.minActiveHungerPct&&Number.isFinite(e.minActiveHungerPct)){const t=Math.max(0,Math.min(100,Math.round(e.minActiveHungerPct)));go.minActiveHungerPct=t}if("number"==typeof e.fallbackTargetScale&&Number.isFinite(e.fallbackTargetScale)){const t=Math.max(1,Math.min(go.maxTargetScale,e.fallbackTargetScale));go.fallbackTargetScale=t}"latest"!==e.focus&&"earliest"!==e.focus&&"specific"!==e.focus||(go.focus=e.focus),"string"!=typeof e.focusTargetTileId&&null!==e.focusTargetTileId||(go.focusTargetTileId=e.focusTargetTileId??null),"number"==typeof e.focusTargetSlotIndex&&Number.isFinite(e.focusTargetSlotIndex)?go.focusTargetSlotIndex=Math.max(0,Math.round(e.focusTargetSlotIndex)):null===e.focusTargetSlotIndex&&(go.focusTargetSlotIndex=null),"latest"!==e.eggFocus&&"earliest"!==e.eggFocus&&"specific"!==e.eggFocus||(go.eggFocus=e.eggFocus),"string"!=typeof e.eggFocusTargetTileId&&null!==e.eggFocusTargetTileId||(go.eggFocusTargetTileId=e.eggFocusTargetTileId??null),"number"==typeof e.eggFocusTargetSlotIndex&&Number.isFinite(e.eggFocusTargetSlotIndex)?go.eggFocusTargetSlotIndex=Math.max(0,Math.round(e.eggFocusTargetSlotIndex)):null===e.eggFocusTargetSlotIndex&&(go.eggFocusTargetSlotIndex=null)}}function No(e){if(ho)e&&zo(e);else{ho=!0,function(){try{const e=d.get(Zn,null);e&&"object"==typeof e&&(eo=e)}catch(e){i("‚ö†Ô∏è Failed to load manual pet overrides",e)}}(),qo(e);try{const e=e=>function(e){const t=go.includeBoardwalk,n=e?.focusTileId??null,o=Math.max(1,Math.floor(e?.limit??10)),r=Po(bo??null,t).filter(e=>!n||e.tileId===n).map(e=>({tileId:e.tileId,slotIndex:e.slotIndex,boardwalk:e.boardwalk,species:e.species,seedSpecies:e.seedSpecies,plantSpecies:e.plantSpecies,eggId:e.eggId,eggSpecies:e.eggSpecies,slotType:e.slotType,slotCategory:e.slotCategory,objectType:e.objectType,tileObjectType:e.tileObjectType,tileCategory:e.tileCategory,slotKind:e.slotKind,endTime:e.endTime,readyAt:e.readyAt,plantedAt:e.plantedAt,isEgg:mo(e)})),a=r.filter(e=>e.isEgg);if(console.log("[TurtleTimer] Egg detection snapshot",{totalSlots:r.length,eggSlots:a.length,includeBoardwalk:t,focusTileId:n}),"function"==typeof console.table?console.table(r):r.forEach(e=>console.log(e)),e?.includeRaw&&a.length>0){const e=bo??null,t=(t,n)=>{if(!e||"object"!=typeof e)return null;const o=n?e.boardwalkTileObjects:e.tileObjects;if(!o||"object"!=typeof o)return null;const r=o[t];return r&&"object"==typeof r?r:null},n=(e,t)=>{if(!e)return null;const n=e.slots;if(Array.isArray(n)){return n[t]??null}return e};a.slice(0,o).forEach((e,r)=>{const s=t(e.tileId,e.boardwalk),i=n(s,e.slotIndex);console.log(`[TurtleTimer] Raw egg ${r+1}/${Math.min(o,a.length)}`,{tileId:e.tileId,boardwalk:e.boardwalk,rawTile:s,rawSlot:i})})}}(e);f.debugEggDetection=e,"undefined"!=typeof window&&window!==f&&(window.debugEggDetection=e)}catch(t){i("‚ö†Ô∏è Unable to attach debugEggDetection helper",t)}Qn().catch(e=>{i("‚ö†Ô∏è Failed to start grow slot index tracker",e)}),Hn(),Qt(e=>{bo=e,Fo()}),Wn(e=>{yo=e,Fo()}),Fo(),i("üê¢ Turtle timer ready")}}function zo(e){qo(e),Fo()}function Lo(e){zo({enabled:e})}function Ro(){Fo()}function Bo(){return To}function jo(e,t=!0){if(xo.add(e),t)try{e(To)}catch(n){i("‚ö†Ô∏è Turtle timer immediate listener error",n)}return()=>{xo.delete(e)}}const Do=["#App > div.McFlex.css-1k630i1 > div.McFlex.css-neeqas > div.McFlex.css-1mq3gde > div.McGrid.css-9guy2q > div.McFlex.css-13izacw > div.css-vmnhaw","#App > div.McFlex.css-neeqas div.css-vmnhaw","#App [data-tm-hud-root] div.css-vmnhaw","#App .QuinoaUI .css-vmnhaw","#App .css-vmnhaw"],Ho=[{id:"Weather:Sunny",label:"Sunny",normalized:"sunny",kind:"sunny",category:"base",durationMs:null,rawState:"noweather",aliases:[]},{id:"Weather:Rain",label:"Rain",normalized:"rain",kind:"rain",category:"weather",durationMs:3e5,rawState:"weather",aliases:[]},{id:"Weather:Frost",label:"Frost",normalized:"frost",kind:"snow",category:"weather",durationMs:3e5,rawState:"weather",aliases:["snow"]},{id:"Weather:Dawn",label:"Dawn",normalized:"dawn",kind:"dawn",category:"lunar",durationMs:6e5,rawState:"weather",aliases:["sunrise"]},{id:"Weather:AmberMoon",label:"Amber Moon",normalized:"ambermoon",kind:"amber",category:"lunar",durationMs:6e5,rawState:"weather",aliases:["harvestmoon","amber_moon"]}],_o=new Map;for(const Li of Ho){new Set([Li.label,Li.normalized,...Li.aliases]).forEach(e=>{const t=Wo(e);t&&_o.set(t,Li)})}function Wo(e){return String(e??"").trim().toLowerCase().replace(/\s+/g,"")}function Oo(e){if(null==e)return _o.get("sunny")??null;const t=Wo(e);return t?_o.get(t)??null:_o.get("sunny")??null}function Go(e){return Array.from(e.querySelectorAll("canvas")).find(e=>{const t=e.getBoundingClientRect();return t.width>=16&&t.width<=256&&t.top>=0&&t.top<=220})||null}function Uo(e){try{const t=e.getContext("2d",{willReadFrequently:!0});if(!t)return"noweather";const n=e.width,o=e.height,{data:r}=t.getImageData(0,0,n,o);let a=0,s=0,i=0,l=0,c=0;for(let e=0;e<r.length;e+=4){const t=r[e],n=r[e+1],o=r[e+2];if(r[e+3]<50)continue;c++,o>120&&o>t+20&&o>n+10&&a++;Math.abs(t-n)<20&&Math.abs(n-o)<20&&Math.abs(t-o)<20&&t>=60&&t<=140&&s++,t>200&&n>150&&o<120&&i++,t>200&&n>200&&o>200&&l++}if(0===c)return"noweather";if(a/c>=.05||s/c>=.1)return"weather";if(i/c>=.01||l/c>=.3)return"noweather";return(80*a+100*s+220*i+255*l)/c<120?"weather":"noweather"}catch{return"noweather"}}function Xo(){return{totalPurchasedCount:0,totalSpent:0,purchasesByCategory:{seeds:0,eggs:0,tools:0,decor:0}}}const Vo=Object.freeze(Object.defineProperty({__proto__:null,addShopItems:function(e,t){},getConfig:function(){return{enabled:!1,seeds:{},eggs:{},tools:{},decor:{}}},getNextSchedules:function(){return{seeds:null,eggs:null,tools:null,decor:null}},getRestockInfo:function(){return{nextRestockAt:{seeds:null,eggs:null,tools:null,decor:null}}},getShopBuyCount:function(){return 0},getShopSpendTotal:function(){return 0},getShopStats:Xo,resetShopStats:function(){},setAutoShopEnabled:function(e){},setItemEnabled:function(e,t,n){},setRestockInfoCallback:function(e){},setShopStatusCallback:function(e){},setShopUIRefreshCallback:function(e){},startAutoShop:function(){}},Symbol.toStringTag,{value:"Module"})),Ko=[{name:"Wet",category:"weather",multiplier:2,aliases:["Rainy"]},{name:"Chilled",category:"weather",multiplier:2},{name:"Frozen",category:"weather",multiplier:10}],Jo=[{name:"Dawnlit",category:"time",multiplier:2,aliases:["Dawn-lit"]},{name:"Dawnbound",category:"time",multiplier:3,aliases:["Dawn bound"]},{name:"Dawncharged",category:"time",multiplier:3,aliases:["Dawn charged"]},{name:"Amberlit",category:"time",multiplier:5,aliases:["Amber lit"]},{name:"Ambershine",category:"time",multiplier:5,aliases:["Amber shine"]},{name:"Amberbound",category:"time",multiplier:6,aliases:["Amber Radiant","Amberradiant","Amber-radiant","Amber radiant"]},{name:"Ambercharged",category:"time",multiplier:6,aliases:["Amber charged"]}],Yo=[{name:"Gold",category:"color",multiplier:25,aliases:["Golden"]},{name:"Rainbow",category:"color",multiplier:50},...Ko,...Jo],Qo=[er("Wet","Dawnlit",3),er("Chilled","Dawnlit",3),er("Wet","Amberlit",6),er("Chilled","Amberlit",6),er("Wet","Ambershine",6),er("Chilled","Ambershine",6),er("Frozen","Dawnlit",11),er("Frozen","Dawnbound",12),er("Frozen","Dawncharged",12),er("Frozen","Amberlit",14),er("Frozen","Ambershine",14),er("Frozen","Amberbound",15),er("Frozen","Ambercharged",15)],Zo=function(e){const t=new Map;for(const n of e)if(t.set(nr(n.name),n),n.aliases)for(const e of n.aliases)t.set(nr(e),n);return t}(Yo);function er(e,t,n){return{weather:tr(Ko,e),time:tr(Jo,t),multiplier:n}}function tr(e,t){const n=e.find(e=>e.name===t);if(!n)throw new Error(`Missing canonical mutation definition for ${t}`);return n}function nr(e){return e.trim().toLowerCase().replace(/[^a-z0-9]/g,"")}function or(e){if(!e)return null;const t=nr(e);return t?Zo.get(t)??null:null}function rr(e){if(!e||0===e.length)return{color:null,weather:null,time:null,combo:null,totalMultiplier:1};const{colors:t,weathers:n,times:o}=function(e){const t=[],n=[],o=[],r=[];if(!e||0===e.length)return{colors:t,weathers:n,times:o,unknown:r};for(const a of e){const e=or(a);if(!e){r.push(a);continue}const s={definition:e,sourceName:a};"color"===e.category?t.push(s):"weather"===e.category?n.push(s):o.push(s)}return{colors:t,weathers:n,times:o,unknown:r}}(e),r=ar(t),a=ar(n),s=ar(o),i=a&&s?function(e,t){for(const n of Qo)if(n.weather===e&&n.time===t)return n;return null}(a.definition,s.definition):null,l=r?.definition.multiplier??1;let c=1;return i?c=i.multiplier:a&&s?c=Math.max(a.definition.multiplier,s.definition.multiplier):a?c=a.definition.multiplier:s&&(c=s.definition.multiplier),{color:r,weather:a,time:s,combo:i,totalMultiplier:l*c}}function ar(e){return e.length?e.reduce((e,t)=>e?t.definition.multiplier>e.definition.multiplier?t:e:t,null):null}const sr={Sunflower:75e4,Starweaver:1e7,DawnCelestial:11e6,MoonCelestial:11e6,Lychee:5e4,DragonFruit:24500,PassionFruit:24500,Lemon:1e4,Pepper:7220,Grape:7085,Bamboo:5e5,Cactus:287e3,Mushroom:16e4,BurrosTail:6e3,Lily:20123,Banana:1750,Coconut:302,Echeveria:5520,Pumpkin:3700,Watermelon:2708,Corn:36,Daffodil:1090,Tomato:27,OrangeTulip:767,Apple:73,Blueberry:23,Aloe:310,Strawberry:14,Carrot:20};function ir(e){return(new Intl.NumberFormat).format(Math.round(e))}function lr(e){const t=Math.abs(e),n=e<0?"-":"";return t>=1e12?`${n}${(t/1e12).toFixed(1)}T`:t>=1e9?`${n}${(t/1e9).toFixed(1)}B`:t>=1e6?`${n}${(t/1e6).toFixed(1)}M`:t>=1e3?`${n}${(t/1e3).toFixed(1)}K`:`${n}${Math.round(t)}`}function cr(e,t=1,n,o=1){const r=sr[e];if(!r)return 0;const a=function(e){return e&&0!==e.length?rr(e).totalMultiplier:1}(n??[]);return Math.round(r*a*t*o)}"number"!=typeof f.devicePixelRatio||f.devicePixelRatio,f.document??document;const ur={weather:{label:"weatherAtom"},shops:{label:"shopsAtom",transform:e=>e&&"object"==typeof e?e:null},seedShop:{label:"shopsAtom",path:"seed"},eggShop:{label:"shopsAtom",path:"egg"},toolShop:{label:"shopsAtom",path:"tool"},decorShop:{label:"shopsAtom",path:"decor"},shopPurchases:{label:"myShopPurchasesAtom"}},dr=new Set;function pr(e,t){if(!t)return e;const n=function(e){return e?Array.isArray(e)?e.slice():String(e).split(".").map(e=>e.trim()).filter(Boolean):[]}(t);let o=e;for(const r of n){if(null==o)return;o="number"==typeof r?Array.isArray(o)?o[r]:void 0:o[r]}return o}async function mr(e){const t=E(e);if(!t)throw dr.has(e)||(i("‚ö†Ô∏è AtomRegistry missing atom",e),dr.add(e)),new Error(`Atom ${e} not found in jotaiAtomCache`);return dr.delete(e),t}function fr(e){return t=>{try{const n=pr(t,e.path);return e.transform?e.transform(n):n??e.fallback??null}catch(n){return i("‚ö†Ô∏è AtomRegistry transform error",e.label,n),e.fallback??null}}}function gr(e){return ur[e]}const hr=new Set;let br={kind:"unknown",raw:"noweather",hash:null,canvasPresent:!1,timestamp:Date.now(),source:"unknown",label:null,startedAt:null,expectedEndAt:null},yr=null;let xr=null,wr=!1,vr=!1,Cr=null,Sr=null,Tr=null,kr=null,Pr=null;function Mr(e){if(br.kind!==e.kind||br.raw!==e.raw||br.hash!==e.hash||br.canvasPresent!==e.canvasPresent||br.source!==e.source||br.label!==e.label||br.startedAt!==e.startedAt||br.expectedEndAt!==e.expectedEndAt){br=e;for(const e of hr)try{e(br)}catch(t){i("‚ö†Ô∏è Weather hub listener failed",t)}}}function Er(e){const t=Date.now();if(!e)return{kind:"unknown",raw:"noweather",hash:null,canvasPresent:!1,timestamp:t,source:"canvas",label:null,startedAt:null,expectedEndAt:null};if(!function(e){try{const t=e.getContext("2d",{willReadFrequently:!0});if(!t)return!1;const n=Math.min(e.width,128),o=Math.min(e.height,128);if(0===n||0===o)return!1;const r=t.getImageData(0,0,n,o);for(let e=3;e<r.data.length;e+=4)if(r.data[e]>0)return!0;return!1}catch{return!1}}(e))return{kind:"unknown",raw:"noweather",hash:null,canvasPresent:!0,timestamp:t,source:"canvas",label:null,startedAt:null,expectedEndAt:null};const n=Uo(e),o=function(e){if("noweather"===Uo(e))return"sunny";try{const t=e.getContext("2d",{willReadFrequently:!0});if(!t)return"unknown";const n=Math.min(e.width,120),o=Math.min(e.height,120),{data:r}=t.getImageData(0,0,n,o);let a=0,s=0,i=0,l=0;for(let e=0;e<r.length;e+=4)r[e+3]<40||(a+=r[e],s+=r[e+1],i+=r[e+2],l++);if(0===l)return"unknown";const c=a/l,u=s/l,d=i/l;return d>c+20&&d>u+10?"rain":d>150&&c>150&&u>150?"snow":c>120&&d>100&&u<c-10?"dawn":c>150&&u>100&&d<100?"amber":"rain"}catch{return"unknown"}}(e),r=function(e){try{const t=e.getContext("2d",{willReadFrequently:!0});if(!t)return"no-context";const{width:n,height:o}=e,r=t.getImageData(0,0,n,o),a=[[.25*n,.25*o],[.5*n,.5*o],[.75*n,.75*o],[.2*n,.65*o],[.8*n,.35*o]];let s=0;for(const[e,i]of a){const t=Math.min(n-1,Math.max(0,Math.round(e))),a=4*(Math.min(o-1,Math.max(0,Math.round(i)))*n+t);s=(s<<5)-s+r.data[a],s|=0}return s.toString(16)}catch{return"error"}}(e);return{kind:o,raw:n,hash:r,canvasPresent:!0,timestamp:t,source:"canvas",label:"unknown"===o?null:o,startedAt:t,expectedEndAt:null}}function $r(e=!1){if(wr&&vr)return void(e&&Ar(Cr));const t=Er(function(){for(const o of Do){const e=document.querySelector(o);if(!e)continue;if(e instanceof HTMLCanvasElement)return e;const t=e.querySelector("canvas");if(t instanceof HTMLCanvasElement)return t}const e=[],t=s();t&&e.push(t);const n=document.getElementById("App");n instanceof HTMLElement&&!e.includes(n)&&e.push(n);for(const o of e){const e=Go(o);if(e)return e}return Go(document)}());Mr(t)}function Ar(e){vr=!0;const t="string"==typeof e&&e.trim().length>0?e.trim():null,n=Oo(t),o=n?.kind??function(e){const t=Oo(e);return t?.kind??(e?"unknown":"sunny")}(t),r=n?.rawState??("sunny"===o||"unknown"===o?"noweather":"weather"),a=`atom:${Wo(t??n?.label??"sunny")||"sunny"}`,s=Date.now(),i=n?.id??"Weather:Sunny";Tr!==i&&(Tr=i,kr=s,Pr=n?.durationMs?s+n.durationMs:null);Mr({kind:o,raw:r,hash:a,canvasPresent:!0,timestamp:s,source:"atom",label:t??n?.label??null,startedAt:kr,expectedEndAt:Pr})}async function Ir(){if(!xr&&!Sr){Sr=(async()=>{try{const e=await async function(e,t){const n=gr(e),o=await mr(n.label),r=fr(n),a=await A(o,e=>{const n=r(e);t(n??null)});return()=>{try{a()}catch(e){i("‚ö†Ô∏è AtomRegistry unsubscribe error",n.label,e)}}}("weather",e=>{wr=!0,Cr="string"==typeof e?e:null,Ar(Cr)});xr=e;const t=await async function(e){const t=gr(e),n=await mr(t.label).catch(()=>null);if(!n)return t.fallback??null??null;return fr(t)(await $(n).catch(e=>(i("‚ö†Ô∏è AtomRegistry read error",t.label,e),null)))??null}("weather").catch(()=>Cr);"string"!=typeof t&&null!=t||(Cr=t),wr=!0,Ar(Cr)}catch(e){wr=!1,vr=!1,i("‚ö†Ô∏è Weather hub atom bridge error",e),xr=null}finally{Sr=null}})();try{await Sr}catch{}}}function Fr(){return br}const qr=new Set,Nr=new Set;let zr={readyCount:0,mutatedCount:0,totalValue:0,highestValue:null,friendBonus:1.5};function Lr(){return zr}const Rr="quinoa:stats:v1";let Br,jr=!1,Dr=null,Hr=Date.now();const _r=new Set;function Wr(e){return{feed:{totalFeeds:0,perPet:{},lastFeedAt:null,sessionStart:e},weather:{totalSwaps:0,swapsByState:{weather:0,noweather:0},presetUsage:{weather:{primary:0,alternate:0},noweather:{primary:0,alternate:0}},cooldownBlocks:0,timeByKind:{},activeKind:"unknown",lastSwapAt:null,lastSnapshotAt:e},shop:{totalPurchases:0,totalSpentCoins:0,totalSpentCredits:0,purchasesByCategory:{seeds:0,eggs:0,tools:0,decor:0},items:{},history:[],lastPurchase:null,totalFailures:0,failuresByCategory:{seeds:0,eggs:0,tools:0,decor:0}},meta:{initializedAt:e,updatedAt:e,version:1}}}function Or(){jr||Jr()}function Gr(){const e={feed:{totalFeeds:Br.feed.totalFeeds,perPet:Object.fromEntries(Object.entries(Br.feed.perPet).map(([e,t])=>[e,{...t}])),lastFeedAt:Br.feed.lastFeedAt,sessionStart:Br.feed.sessionStart},weather:{totalSwaps:Br.weather.totalSwaps,swapsByState:{...Br.weather.swapsByState},presetUsage:{weather:{...Br.weather.presetUsage.weather},noweather:{...Br.weather.presetUsage.noweather}},cooldownBlocks:Br.weather.cooldownBlocks,timeByKind:{...Br.weather.timeByKind},activeKind:Br.weather.activeKind,lastSwapAt:Br.weather.lastSwapAt},shop:{totalPurchases:Br.shop.totalPurchases,totalSpentCoins:Br.shop.totalSpentCoins,totalSpentCredits:Br.shop.totalSpentCredits,purchasesByCategory:{...Br.shop.purchasesByCategory},items:Object.fromEntries(Object.entries(Br.shop.items).map(([e,t])=>[e,{...t}])),history:Br.shop.history.map(e=>({...e})),lastPurchase:Br.shop.lastPurchase?{...Br.shop.lastPurchase}:null,totalFailures:Br.shop.totalFailures,failuresByCategory:{...Br.shop.failuresByCategory}},meta:{...Br.meta}};for(const n of _r)try{n(e)}catch(t){console.error("[stats] subscriber error",t)}}function Ur(){null!=Dr&&window.clearTimeout(Dr),Dr=window.setTimeout(()=>{Dr=null;try{d.set(Rr,Br)}catch(e){console.error("[stats] save error",e)}},1200)}function Xr(){Br.meta.updatedAt=Date.now(),Ur(),Gr()}function Vr(e){const t=e,n=Math.max(0,t-Hr);if(n<1e3)return Hr=t,Br.weather.lastSnapshotAt=t,!1;const o=Br.weather.activeKind||"unknown";return Br.weather.timeByKind[o]=(Br.weather.timeByKind[o]??0)+n,Hr=t,Br.weather.lastSnapshotAt=t,!0}function Kr(){null==yr&&(Ir(),$r(!0),yr=window.setInterval(()=>$r(!1),2e3));const e=Fr();Br.weather.activeKind=e.kind??"unknown",Br.weather.lastSnapshotAt=e.timestamp,Hr=Date.now(),function(e,t=!0){if(hr.add(e),t)try{e(br)}catch(n){i("‚ö†Ô∏è Weather hub immediate listener failed",n)}}(e=>{Vr(e.timestamp);Br.weather.activeKind=e.kind??"unknown",Xr()},!0),window.setInterval(()=>{Vr(Date.now())&&Xr()},5e3)}function Jr(){jr||(Br=function(){const e=Date.now(),t=d.get(Rr,null);if(!t||"object"!=typeof t)return Wr(e);const n=Wr(t.meta?.initializedAt??e);if(t.feed&&(n.feed.totalFeeds=Number(t.feed.totalFeeds??n.feed.totalFeeds),n.feed.lastFeedAt=t.feed.lastFeedAt??null,n.feed.sessionStart=t.feed.sessionStart??n.feed.sessionStart,t.feed.perPet&&"object"==typeof t.feed.perPet))for(const[o,r]of Object.entries(t.feed.perPet)){const e=r;e&&(n.feed.perPet[o]={count:Number(e.count??0),lastFeedAt:e.lastFeedAt??null})}if(t.weather){if(n.weather.totalSwaps=Number(t.weather.totalSwaps??0),n.weather.cooldownBlocks=Number(t.weather.cooldownBlocks??0),n.weather.activeKind=t.weather.activeKind??n.weather.activeKind,n.weather.lastSwapAt=t.weather.lastSwapAt??null,n.weather.lastSnapshotAt=t.weather.lastSnapshotAt??e,t.weather.swapsByState&&(n.weather.swapsByState.weather=Number(t.weather.swapsByState.weather??0),n.weather.swapsByState.noweather=Number(t.weather.swapsByState.noweather??0)),t.weather.presetUsage)for(const e of["weather","noweather"]){const o=t.weather.presetUsage[e];o&&(n.weather.presetUsage[e].primary=Number(o.primary??0),n.weather.presetUsage[e].alternate=Number(o.alternate??0))}if(t.weather.timeByKind&&"object"==typeof t.weather.timeByKind)for(const[e,o]of Object.entries(t.weather.timeByKind))n.weather.timeByKind[e]=Number(o??0)}if(t.shop){if(n.shop.totalPurchases=Number(t.shop.totalPurchases??0),n.shop.totalSpentCoins=Number(t.shop.totalSpentCoins??0),n.shop.totalSpentCredits=Number(t.shop.totalSpentCredits??0),t.shop.purchasesByCategory)for(const e of["seeds","eggs","tools","decor"]){const o=t.shop.purchasesByCategory[e];n.shop.purchasesByCategory[e]=Number(o??0)}if(t.shop.items&&"object"==typeof t.shop.items)for(const[o,r]of Object.entries(t.shop.items)){const t=r;t&&(n.shop.items[o]={count:Number(t.count??0),coins:Number(t.coins??0),credits:Number(t.credits??0),lastPurchasedAt:t.lastPurchasedAt??e})}Array.isArray(t.shop.history)&&(n.shop.history=t.shop.history.map(t=>({itemName:t.itemName,category:t.category??"seeds",count:Number(t.count??0),coins:Number(t.coins??0),credits:Number(t.credits??0),timestamp:t.timestamp??e,success:t.success??!0,failureReason:t.failureReason})).slice(-1e3)),"number"==typeof t.shop.totalFailures&&(n.shop.totalFailures=t.shop.totalFailures),t.shop.failuresByCategory&&"object"==typeof t.shop.failuresByCategory&&(n.shop.failuresByCategory={seeds:Number(t.shop.failuresByCategory.seeds??0),eggs:Number(t.shop.failuresByCategory.eggs??0),tools:Number(t.shop.failuresByCategory.tools??0),decor:Number(t.shop.failuresByCategory.decor??0)}),t.shop.lastPurchase&&(n.shop.lastPurchase={itemName:t.shop.lastPurchase.itemName,category:t.shop.lastPurchase.category??"seeds",count:Number(t.shop.lastPurchase.count??0),coins:Number(t.shop.lastPurchase.coins??0),credits:Number(t.shop.lastPurchase.credits??0),timestamp:t.shop.lastPurchase.timestamp??e})}return t.meta&&(n.meta.initializedAt=t.meta.initializedAt??n.meta.initializedAt,n.meta.updatedAt=t.meta.updatedAt??n.meta.updatedAt,n.meta.version=t.meta.version??n.meta.version),n}(),jr=!0,Kr(),Gr())}function Yr(e){Or(),_r.add(e);try{e((Or(),{feed:{totalFeeds:Br.feed.totalFeeds,perPet:Object.fromEntries(Object.entries(Br.feed.perPet).map(([e,t])=>[e,{...t}])),lastFeedAt:Br.feed.lastFeedAt,sessionStart:Br.feed.sessionStart},weather:{totalSwaps:Br.weather.totalSwaps,swapsByState:{...Br.weather.swapsByState},presetUsage:{weather:{...Br.weather.presetUsage.weather},noweather:{...Br.weather.presetUsage.noweather}},cooldownBlocks:Br.weather.cooldownBlocks,timeByKind:{...Br.weather.timeByKind},activeKind:Br.weather.activeKind,lastSwapAt:Br.weather.lastSwapAt},shop:{totalPurchases:Br.shop.totalPurchases,totalSpentCoins:Br.shop.totalSpentCoins,totalSpentCredits:Br.shop.totalSpentCredits,purchasesByCategory:{...Br.shop.purchasesByCategory},items:Object.fromEntries(Object.entries(Br.shop.items).map(([e,t])=>[e,{...t}])),history:Br.shop.history.map(e=>({...e})),lastPurchase:Br.shop.lastPurchase?{...Br.shop.lastPurchase}:null,totalFailures:Br.shop.totalFailures,failuresByCategory:{...Br.shop.failuresByCategory}},meta:{...Br.meta}}))}catch(t){console.error("[stats] immediate subscriber error",t)}return()=>{_r.delete(e)}}const Qr=new Map;function Zr(e,t){const n=new Set,{petId:o,slotId:r,slotIndex:a,fallbackKeys:s=[]}=t;((e,t)=>{const n=[];for(const o of t){if(!o)continue;const t=o.trim();t&&(n.push(`petId:${t}::${e}`),n.push(`slotId:${t}::${e}`),n.push(`source:${t}::${e}`))}return n})(e,[o,r,...s]).forEach(e=>n.add(e)),((e,t)=>null!=t&&Number.isFinite(t)?[`slotIndex:${Math.max(0,Math.round(t))}::${e}`]:[])(e,a).forEach(e=>n.add(e));for(const i of n){const e=Qr.get(i);if(e)return e}return null}const ea=[{id:"ProduceScaleBoost",name:"Crop Size Boost I",aliases:["Crop Size Boost 1"],category:"misc",trigger:"continuous",baseProbability:.3,rollPeriodMinutes:1,effectUnit:"coins",effectLabel:"Scale increase",effectBaseValue:6,effectSuffix:"%",notes:"Chance: 0.30% √ó STR. Effect: 6% size increase √ó STR, capped at max scale."},{id:"ProduceScaleBoostII",name:"Crop Size Boost II",aliases:["Crop Size Boost 2"],category:"misc",trigger:"continuous",baseProbability:.4,rollPeriodMinutes:1,effectUnit:"coins",effectLabel:"Scale increase",effectBaseValue:10,effectSuffix:"%",notes:"Chance: 0.40% √ó STR. Effect: 10% size increase √ó STR, capped at max scale."},{id:"DoubleHarvest",name:"Double Harvest",category:"misc",trigger:"harvest",baseProbability:5},{id:"ProduceEater",name:"Crop Eater",category:"coins",trigger:"continuous",baseProbability:60,rollPeriodMinutes:1,notes:"Cannot estimate coin value without live crop data."},{id:"SellBoostI",name:"Sell Boost I",aliases:["Sell Boost 1"],category:"misc",trigger:"sellAllCrops",baseProbability:10},{id:"SellBoostII",name:"Sell Boost II",aliases:["Sell Boost 2"],category:"misc",trigger:"sellAllCrops",baseProbability:12},{id:"SellBoostIII",name:"Sell Boost III",aliases:["Sell Boost 3"],category:"misc",trigger:"sellAllCrops",baseProbability:14},{id:"SellBoostIV",name:"Sell Boost IV",aliases:["Sell Boost 4"],category:"misc",trigger:"sellAllCrops",baseProbability:16},{id:"ProduceRefund",name:"Crop Refund",category:"misc",trigger:"sellAllCrops",baseProbability:20},{id:"PlantGrowthBoost",name:"Plant Growth Boost I",aliases:["Plant Growth Boost 1"],category:"plantGrowth",trigger:"continuous",baseProbability:24,rollPeriodMinutes:1,effectValuePerProc:3,effectUnit:"minutes",effectLabel:"Growth time reduction",effectBaseValue:3,effectSuffix:"m"},{id:"PlantGrowthBoostII",name:"Plant Growth Boost II",aliases:["Plant Growth Boost 2"],category:"plantGrowth",trigger:"continuous",baseProbability:27,rollPeriodMinutes:1,effectValuePerProc:5,effectUnit:"minutes",effectLabel:"Growth time reduction",effectBaseValue:5,effectSuffix:"m"},{id:"ProduceMutationBoost",name:"Crop Mutation Boost I",aliases:["Crop Mutation Boost 1"],category:"misc",trigger:"continuous",baseProbability:.1,rollPeriodMinutes:1,effectUnit:"coins",effectLabel:"Chance increase",effectBaseValue:10,effectSuffix:"%",notes:"Increases the base weather mutation chance (0.1% √ó STR) by 10% √ó STR during active weather/lunar events. Only works when weather/lunar event is active. Grants: Wet (Rain), Frozen (Snow), Dawnlit (Dawn), Amberlit (Dusk)."},{id:"ProduceMutationBoostII",name:"Crop Mutation Boost II",aliases:["Crop Mutation Boost 2"],category:"misc",trigger:"continuous",baseProbability:.1,rollPeriodMinutes:1,effectUnit:"coins",effectLabel:"Chance increase",effectBaseValue:15,effectSuffix:"%",notes:"Increases the base weather mutation chance (0.1% √ó STR) by 15% √ó STR during active weather/lunar events. Only works when weather/lunar event is active. Grants: Wet (Rain), Frozen (Snow), Dawnlit (Dawn), Amberlit (Dusk)."},{id:"PetMutationBoost",name:"Pet Mutation Boost I",aliases:["Pet Mutation Boost 1"],category:"misc",trigger:"hatchEgg"},{id:"PetMutationBoostII",name:"Pet Mutation Boost II",aliases:["Pet Mutation Boost 2"],category:"misc",trigger:"hatchEgg"},{id:"GoldGranter",name:"Gold Granter",category:"misc",trigger:"continuous",baseProbability:.72,rollPeriodMinutes:1,effectUnit:"coins",notes:"Converts a random uncolored crop to Gold using live garden snapshot."},{id:"RainbowGranter",name:"Rainbow Granter",category:"misc",trigger:"continuous",baseProbability:.72,rollPeriodMinutes:1,effectUnit:"coins",notes:"Converts a random uncolored crop to Rainbow using live garden snapshot."},{id:"EggGrowthBoost",name:"Egg Growth Boost I",aliases:["Egg Growth Boost 1"],category:"eggGrowth",trigger:"continuous",baseProbability:21,rollPeriodMinutes:1,effectValuePerProc:7,effectUnit:"minutes"},{id:"EggGrowthBoostII",name:"Egg Growth Boost II",aliases:["Egg Growth Boost 2"],category:"eggGrowth",trigger:"continuous",baseProbability:24,rollPeriodMinutes:1,effectValuePerProc:10,effectUnit:"minutes"},{id:"EggGrowthBoostIII",name:"Egg Growth Boost III",aliases:["Egg Growth Boost 3"],category:"eggGrowth",trigger:"continuous",baseProbability:27,rollPeriodMinutes:1,effectValuePerProc:13,effectUnit:"minutes"},{id:"PetAgeBoost",name:"Hatch XP Boost I",aliases:["Hatch XP Boost 1"],category:"xp",trigger:"hatchEgg",baseProbability:50,effectValuePerProc:8e3,effectUnit:"xp"},{id:"PetAgeBoostII",name:"Hatch XP Boost II",aliases:["Hatch XP Boost 2"],category:"xp",trigger:"hatchEgg",baseProbability:60,effectValuePerProc:12e3,effectUnit:"xp"},{id:"PetHatchSizeBoost",name:"Max Strength Boost I",aliases:["Max Strength Boost 1"],category:"misc",trigger:"hatchEgg",baseProbability:12},{id:"PetHatchSizeBoostII",name:"Max Strength Boost II",aliases:["Max Strength Boost 2"],category:"misc",trigger:"hatchEgg",baseProbability:14},{id:"PetXpBoost",name:"XP Boost I",aliases:["Pet XP Boost I","Pet XP Boost 1","XP Boost 1"],category:"xp",trigger:"continuous",baseProbability:30,rollPeriodMinutes:1,effectValuePerProc:300,effectUnit:"xp"},{id:"PetXpBoostII",name:"XP Boost II",aliases:["Pet XP Boost II","Pet XP Boost 2","XP Boost 2"],category:"xp",trigger:"continuous",baseProbability:35,rollPeriodMinutes:1,effectValuePerProc:400,effectUnit:"xp"},{id:"HungerRestore",name:"Hunger Restore I",aliases:["Hunger Restore 1"],category:"misc",trigger:"continuous",baseProbability:12,rollPeriodMinutes:1},{id:"HungerRestoreII",name:"Hunger Restore II",aliases:["Hunger Restore 2"],category:"misc",trigger:"continuous",baseProbability:14,rollPeriodMinutes:1},{id:"HungerBoost",name:"Hunger Boost I",aliases:["Hunger Boost 1"],category:"misc",trigger:"continuous",baseProbability:0,rollPeriodMinutes:1},{id:"HungerBoostII",name:"Hunger Boost II",aliases:["Hunger Boost 2"],category:"misc",trigger:"continuous",baseProbability:0,rollPeriodMinutes:1},{id:"PetRefund",name:"Pet Refund I",aliases:["Pet Refund 1"],category:"misc",trigger:"sellPet",baseProbability:5},{id:"PetRefundII",name:"Pet Refund II",aliases:["Pet Refund 2"],category:"misc",trigger:"sellPet",baseProbability:7},{id:"Copycat",name:"Copycat",category:"misc",trigger:"continuous",baseProbability:1,rollPeriodMinutes:1},{id:"CoinFinderI",name:"Coin Finder I",aliases:["Coin Finder 1","CoinFinder I","CoinFinder 1"],category:"coins",trigger:"continuous",baseProbability:35,rollPeriodMinutes:1,effectValuePerProc:12e4,effectUnit:"coins",effectLabel:"Coin range",effectBaseValue:12e4,effectSuffix:""},{id:"CoinFinderII",name:"Coin Finder II",aliases:["Coin Finder 2","CoinFinder II","CoinFinder 2"],category:"coins",trigger:"continuous",baseProbability:13,rollPeriodMinutes:1,effectValuePerProc:12e5,effectUnit:"coins",effectLabel:"Coin range",effectBaseValue:12e5,effectSuffix:""},{id:"CoinFinderIII",name:"Coin Finder III",aliases:["Coin Finder 3","CoinFinder III","CoinFinder 3"],category:"coins",trigger:"continuous",baseProbability:6,rollPeriodMinutes:1,effectValuePerProc:1e7,effectUnit:"coins",effectLabel:"Coin range",effectBaseValue:1e7,effectSuffix:""},{id:"SeedFinderI",name:"Seed Finder I",aliases:["Seed Finder 1","SeedFinder I","SeedFinder 1"],category:"misc",trigger:"continuous",baseProbability:40,rollPeriodMinutes:1},{id:"SeedFinderII",name:"Seed Finder II",aliases:["Seed Finder 2","SeedFinder II","SeedFinder 2"],category:"misc",trigger:"continuous",baseProbability:20,rollPeriodMinutes:1},{id:"SeedFinderIII",name:"Seed Finder III",aliases:["Seed Finder 3","SeedFinder III","SeedFinder 3"],category:"misc",trigger:"continuous",baseProbability:10,rollPeriodMinutes:1},{id:"SeedFinderIV",name:"Seed Finder IV",aliases:["Seed Finder 4","SeedFinder IV","SeedFinder 4"],category:"misc",trigger:"continuous",baseProbability:.01,rollPeriodMinutes:1}],ta=new Map,na=e=>e.trim().toLowerCase();for(const Li of ea)if(ta.set(na(Li.id),Li),ta.set(na(Li.name),Li),Array.isArray(Li.aliases))for(const e of Li.aliases)ta.set(na(e),Li);function oa(e){if(!e)return null;const t=na(e);return ta.get(t)??null}const ra=.95/60;function aa(e,t){const n=Number.isFinite(t)?t:100,o=Math.max(.25,n/100),r=Math.max(0,e.baseProbability??0)/60,a=Math.max(0,r/100),s=Math.min(ra,a*o),i=3600*s,l=100*s,c=60*l;return{multiplier:o,chancePerRoll:s,rollPeriodMinutes:e.rollPeriodMinutes??1,procsPerHour:i,chancePerSecond:l,chancePerMinute:c}}function sa(e,t){const n=e.effectValuePerProc??0;return Number.isFinite(n)&&0!==n?t.procsPerHour*n:0}function ia(){const e=Yt(),t=ke();if(!e||!t)return{weather:null,eligibleCrops:[],eligibleFruits:0,averageValueGain:0,projectedMutationsPerEvent:0,baseMutationChance:0};const n=function(e){if(!e)return null;const t=e.toLowerCase();return t.includes("rain")?"rain":t.includes("snow")?"snow":t.includes("dawn")?"dawn":t.includes("amber")?"amber":null}("string"==typeof t?t:t.type||t.name);if(!n)return{weather:null,eligibleCrops:[],eligibleFruits:0,averageValueGain:0,projectedMutationsPerEvent:0,baseMutationChance:0};const o=[];let r=0,a=0;const s=e.tileObjects||{};Object.entries(s).forEach(([e,t])=>{if(!t||"plant"!==t.objectType)return;const s=t.species||t.plantSpecies||t.seedSpecies;if(!s)return;if(!(!0===t.fullyMature||!0===t.isMature))return;const i="number"==typeof t.scale?t.scale:1,l=Array.isArray(t.mutations)?[...t.mutations]:[],u=function(e,t){const n=e.some(e=>"Wet"===e||"Frozen"===e),o=e.some(e=>"Dawnlit"===e||"Dawnbound"===e),r=e.some(e=>"Amberlit"===e||"Amberbound"===e),a=e.includes("Gold"),s=e.includes("Rainbow");if("dawn"===t&&(r||a)||"amber"===t&&(o||a)||s)return!1;if(("rain"===t||"snow"===t)&&n)return!1;if("dawn"===t&&o)return!1;if("amber"===t&&r)return!1;return!0}(l,n);if(!u)return;const d=function(e){if("number"==typeof e.fruitCount&&e.fruitCount>0)return e.fruitCount;if(Array.isArray(e.slotStates)&&e.slotStates.length>0)return e.slotStates.length;const t=e.displayName||e.name;if("string"==typeof t){const e=t.match(/\+(\d+)/);if(e&&e[1])return parseInt(e[1],10)}return 1}(t);if(d<=0)return;const p=c(s),m=cr(p,i,l,1.5),f=cr(p,i,[...l,la(n)],1.5)-m;f>0&&(o.push({species:s,scale:i,mutations:l,currentValue:m,fruitCount:d,index:parseInt(e,10)}),r+=d,a+=f*d)});const i=o.length>0?a/r:0,l=function(e){switch(e){case"rain":return 22.8;case"snow":return 7.6;case"dawn":return 6.37;case"amber":return 3.19}}(n),u=o.length*(l/100);return{weather:n,eligibleCrops:o,eligibleFruits:r,averageValueGain:i,projectedMutationsPerEvent:u,baseMutationChance:l}}function la(e){switch(e){case"rain":return"Wet";case"snow":return"Frozen";case"dawn":return"Dawnlit";case"amber":return"Amberlit"}}const ca=50,ua=100;function da(e){return!!e&&"object"==typeof e&&!Array.isArray(e)}function pa(e){const t="number"==typeof e?e:"string"==typeof e?Number.parseFloat(e):Number.NaN;if(!Number.isFinite(t))return null;const n=Math.floor(t);return n>0?n:null}function ma(e,t){if(!t)return 1;const n=["fruitCount","remainingFruitCount","remainingFruits","totalFruitCount","totalFruits","totalFruit"];for(const a of n)if(a in e){const t=pa(e[a]);if(null!=t)return Math.min(t,64)}const o=e.slotStates;if(Array.isArray(o)){const e=o.filter(e=>null!=e);if(e.length>0)return Math.min(e.length,64)}const r="string"==typeof e.displayName?e.displayName:"string"==typeof e.name?e.name:null;if(r){const e=r.match(/\+(\d+)/);if(e){const t=pa(e[1]);if(null!=t)return Math.min(t,64)}}return 1}function fa(e,t,n){const o=Number.isFinite(e)&&e>0?e:1,r=[n.maxScale,n.targetMaxScale,n.maxTargetScale,n.maximumScale,n.max],a="string"==typeof t?c(t):null;let s=null;for(const c of r){const e=Number(c);if(Number.isFinite(e)&&e>1){s=e;break}}if((null==s||s<=1)&&a){const e=function(e){const t=u[e];return"number"==typeof t&&Number.isFinite(t)?t:null}(a);null!=e&&Number.isFinite(e)&&e>1&&(s=e)}(null==s||!Number.isFinite(s)||s<=1)&&(s=2);const i=Math.max(1.01,s),l=Math.min(i,Math.max(1,o)),d=ca+50*(i>1?(l-1)/(i-1):0);return{maxScale:i,sizePercent:Math.min(ua,Math.max(ca,Math.round(100*d)/100))}}function ga(e,t){return 1+(Math.min(ua,Math.max(ca,e))-ca)/50*(Math.max(1.01,Number.isFinite(t)&&t>1?t:2)-1)}function ha(e=Yt()){const t=function(e){if(!e)return[];const t=[{tiles:e.tileObjects,allowMultiHarvest:!0},{tiles:e.boardwalkTileObjects,allowMultiHarvest:!0}],n=[],o=Date.now();for(const{tiles:r,allowMultiHarvest:a}of t)if(r&&"object"==typeof r)for(const e of Object.values(r)){if(!da(e))continue;if("plant"!==e.objectType)continue;const t=e.slots;if(Array.isArray(t))for(const e of t){if(!da(e))continue;const t="string"==typeof e.species?e.species:null;if(!t)continue;const r=e.endTime,s="number"==typeof r?r:Number(r),i=!!Number.isFinite(s)&&s<=o,l=e.targetScale??e.scale??e.plantScale,c="number"==typeof l&&Number.isFinite(l)?Math.max(1,l):1,u=(Array.isArray(e.mutations)?e.mutations:[]).map(e=>"string"==typeof e?e:null).filter(e=>!!e),d=cr(t,c,u,1.5);if(!Number.isFinite(d)||d<=0)continue;const p=rr(u),m="Gold"===p.color?.definition?.name||"Rainbow"===p.color?.definition?.name,{maxScale:f,sizePercent:g}=fa(c,t,e),h=ma(e,a);n.push({species:t,scale:c,maxScale:f,sizePercent:g,mutations:u,currentValue:d,hasColorMutation:m,fruitCount:h,isMature:i})}}return n}(e),n=t.reduce((e,t)=>t.isMature?e+t.currentValue*Math.max(1,t.fruitCount):e,0),o=t.filter(e=>{const t=e.mutations.includes("Gold"),n=e.mutations.includes("Rainbow");return!t&&!n}),r=o.reduce((e,t)=>e+Math.max(1,t.fruitCount),0);return{crops:t,uncoloredCrops:o,uncoloredFruitSlots:r,totalMatureValue:n,friendBonus:1.5}}function ba(e,t,n){const o=n*("number"==typeof t&&Number.isFinite(t)?Math.max(0,t):100)/100;if(!e.crops.length||o<=0)return null;const r=e.crops.filter(e=>e.isMature&&e.sizePercent<99.99&&Math.max(1,e.fruitCount)>0);if(!r.length)return null;let a=0,s=0,i=0;for(const l of r){const e=Math.max(1,Math.floor(l.fruitCount)),t=Math.max(0,ua-l.sizePercent);if(t<=0)continue;const n=Math.min(o,t);if(n<=0)continue;const r=ga(l.sizePercent+n,l.maxScale),c=l.scale>0?l.scale:1,u=Math.max(0,r-c);if(u<=0)continue;const d=c>0?l.currentValue/c:0;if(!Number.isFinite(d)||d<=0)continue;const p=d*u;!Number.isFinite(p)||p<=0||(i+=e,a+=p*e,s+=n*e)}if(a<=0||0===i)return null;return{effectPerProc:a/i,detail:`Boosts ${i} mature fruit${1===i?"":"s"} by ~${(s/i).toFixed(2)}% size (50% friend bonus assumed, weighted by fruit count).`}}function ya(e,t){if(!e.uncoloredCrops.length)return null;let n=0,o=0;for(const r of e.uncoloredCrops){const e=Math.max(1,Math.floor(r.fruitCount)),a=[...r.mutations,t],s=cr(r.species,r.scale,a,1.5)-r.currentValue;Number.isFinite(s)&&s>0&&(o+=e,n+=s*e)}if(0===o||n<=0)return null;return{effectPerProc:n/o,detail:`Converts 1 random uncolored crop to ${t}. ${e.uncoloredFruitSlots} eligible fruit slot${1===e.uncoloredFruitSlots?"":"s"} across ${e.uncoloredCrops.length} plant${1===e.uncoloredCrops.length?"":"s"} (50% friend bonus, weighted by fruit count).`}}function xa(e,t,n){switch(e){case"ProduceScaleBoost":return ba(t,n,6);case"ProduceScaleBoostII":return ba(t,n,10);case"GoldGranter":return ya(t,"Gold");case"RainbowGranter":return ya(t,"Rainbow");case"ProduceMutationBoost":case"ProduceMutationBoostII":return function(){const e=ia();if(!e.weather||0===e.eligibleCrops.length)return{effectPerProc:0,detail:"No active weather/lunar event or no eligible crops. Mutations only proc during Rain, Snow, Dawn, or Amber Moon."};const t="rain"===e.weather?"Rain":"snow"===e.weather?"Snow":"dawn"===e.weather?"Dawn":"Amber",n="rain"===e.weather?"Wet":"snow"===e.weather?"Frozen":"dawn"===e.weather?"Dawnlit":"Amberlit";return{effectPerProc:e.projectedMutationsPerEvent*e.averageValueGain,detail:`${t} active (${e.baseMutationChance.toFixed(1)}% chance/crop). ${e.eligibleCrops.length} eligible plant${1===e.eligibleCrops.length?"":"s"} (${e.eligibleFruits} fruit${1===e.eligibleFruits?"":"s"}). Expected: ${e.projectedMutationsPerEvent.toFixed(2)} ${n} mutation${1===e.projectedMutationsPerEvent?"":"s"}/event, avg ${wa(e.averageValueGain)}/mutation.`}}();default:return null}}function wa(e){return e>=1e6?`${(e/1e6).toFixed(2)}M`:e>=1e3?`${(e/1e3).toFixed(2)}K`:e.toFixed(0)}h("__qpmAbilityDebug",{getContext:()=>ha(),listUncolored:()=>ha().uncoloredCrops.map(e=>({species:e.species,fruitCount:Math.max(1,e.fruitCount),sizePercent:e.sizePercent,mutations:[...e.mutations],hasColorMutation:e.hasColorMutation,isMature:e.isMature,valuePerScale:e.scale>0?e.currentValue/e.scale:e.currentValue})),listAll:()=>ha().crops.map(e=>({species:e.species,fruitCount:Math.max(1,e.fruitCount),sizePercent:e.sizePercent,mutations:[...e.mutations],hasColorMutation:e.hasColorMutation,isMature:e.isMature,currentValue:e.currentValue,maxScale:e.maxScale}))});const va="qpm-window-pos-",Ca=new Map;let Sa=1e4,Ta=!1;function ka(e){const t=e.getBoundingClientRect(),n=window.innerWidth,o=window.innerHeight;let r=parseFloat(e.style.right)||n-t.right,a=parseFloat(e.style.top)||t.top;const s=Math.max(8,n-t.width-8),i=Math.max(8,o-t.height-8);r=Math.min(Math.max(r,8),s),a=Math.min(Math.max(a,8),i),e.style.right=`${r}px`,e.style.top=`${a}px`,e.style.left="auto",e.style.bottom="auto"}function Pa(){Ca.forEach(e=>{e.isMinimized||ka(e.el)})}function Ma(e,t,n,o,r){if(Ca.has(e)){const t=Ca.get(e);return t.el.style.display="",t.isMinimized=!1,Aa(t.el),void qa(e,!0,!1)}const a=o||"90vw",s=r||"90vh",l=document.createElement("div");l.className="qpm-window",l.id=`qpm-window-${e}`,l.style.cssText=`\n    position: fixed;\n    min-width: 260px;\n    max-width: ${a};\n    max-height: ${s};\n    background: rgba(18, 20, 26, 0.96);\n    border: 1px solid rgba(143, 130, 255, 0.5);\n    border-radius: 8px;\n    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.8), 0 0 0 1px rgba(255, 255, 255, 0.05);\n    backdrop-filter: blur(12px);\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n    font-size: 13px;\n    color: #e0e0e0;\n    z-index: ${Sa++};\n    box-sizing: border-box;\n    overflow: auto;\n  `;const c=document.createElement("div");c.className="qpm-window-head",c.style.cssText="\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 12px 16px;\n    background: linear-gradient(135deg, rgba(143, 130, 255, 0.12) 0%, rgba(143, 130, 255, 0.04) 100%);\n    border-bottom: 1px solid rgba(143, 130, 255, 0.25);\n    cursor: move;\n    user-select: none;\n  ";const u=document.createElement("div");u.className="qpm-window-title",u.textContent=t,u.style.cssText="\n    font-size: 15px;\n    font-weight: 600;\n    color: #8f82ff;\n    flex: 1;\n    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);\n  ";const p=document.createElement("div");p.style.cssText="display: flex; gap: 6px;";const m=Ia("‚àí","Minimize"),f=Ia("√ó","Close");p.appendChild(m),p.appendChild(f),c.appendChild(u),c.appendChild(p);const g=document.createElement("div");g.className="qpm-window-body",g.style.cssText="\n    padding: 16px;\n    background: rgba(0, 0, 0, 0.25);\n    box-sizing: border-box;\n  ",function(e){const t=`qpm-window-scrollbar-${e}`;if(document.getElementById(t))return;const n=document.createElement("style");n.id=t,n.textContent=`\n    /* Scrollbar on the window itself (Aries mod pattern) */\n    #qpm-window-${e}::-webkit-scrollbar {\n      width: 8px;\n    }\n    #qpm-window-${e}::-webkit-scrollbar-track {\n      background: rgba(0, 0, 0, 0.2);\n      border-radius: 4px;\n    }\n    #qpm-window-${e}::-webkit-scrollbar-thumb {\n      background: rgba(143, 130, 255, 0.35);\n      border-radius: 4px;\n      transition: background 0.2s;\n    }\n    #qpm-window-${e}::-webkit-scrollbar-thumb:hover {\n      background: rgba(143, 130, 255, 0.55);\n    }\n\n    /* Constrain all content within window - prevent horizontal overflow */\n    #qpm-window-${e} *,\n    #qpm-window-${e} *::before,\n    #qpm-window-${e} *::after {\n      box-sizing: border-box;\n      max-width: 100%;\n      word-wrap: break-word;\n      overflow-wrap: break-word;\n    }\n\n    #qpm-window-${e} .qpm-card,\n    #qpm-window-${e} .qpm-card__body,\n    #qpm-window-${e} .qpm-card__header,\n    #qpm-window-${e} .qpm-section-muted,\n    #qpm-window-${e} input,\n    #qpm-window-${e} button,\n    #qpm-window-${e} select,\n    #qpm-window-${e} div {\n      max-width: 100%;\n      min-width: 0;\n    }\n\n    /* Prevent pre/code from breaking layout */\n    #qpm-window-${e} pre,\n    #qpm-window-${e} code {\n      white-space: pre-wrap;\n      word-break: break-all;\n    }\n  `,document.head.appendChild(n)}(e),l.appendChild(c),l.appendChild(g),document.body.appendChild(l),n(g),function(e,t){const n=d.get(va+e);n?(t.style.right=`${n.right}px`,t.style.top=`${n.top}px`,t.style.left="auto",t.style.bottom="auto"):(t.style.left="50%",t.style.top="50%",t.style.transform="translate(-50%, -50%)",t.style.right="auto",t.style.bottom="auto",requestAnimationFrame(()=>{const n=t.getBoundingClientRect();t.style.transform="",t.style.left="auto",t.style.right=window.innerWidth-n.right+"px",t.style.top=`${n.top}px`,Fa(e,t)}))}(e,l),requestAnimationFrame(()=>{ka(l)}),Ta||(window.addEventListener("resize",Pa),Ta=!0,i("Window resize listener added")),function(e,t,n){let o=!1,r=0,a=0,s=0,i=0;const l=t=>{if(!o)return;t.preventDefault();const n=t.clientX-r,l=t.clientY-a,c=s-n,u=i+l,d=window.innerWidth-8,p=window.innerHeight-8,m=e.getBoundingClientRect(),f=Math.max(8-m.width,Math.min(d-m.width,c)),g=Math.max(8,Math.min(p-m.height,u));e.style.right=`${f}px`,e.style.top=`${g}px`,e.style.left="auto",e.style.bottom="auto"},c=()=>{o&&(o=!1,t.style.cursor="move",document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",c),Fa(n,e))};t.addEventListener("mousedown",n=>{if(n.target.closest(".qpm-window-btn"))return;o=!0,t.style.cursor="grabbing",r=n.clientX,a=n.clientY;const u=e.getBoundingClientRect();s=parseFloat(e.style.right)||window.innerWidth-u.right,i=parseFloat(e.style.top)||u.top,document.addEventListener("mousemove",l),document.addEventListener("mouseup",c),Aa(e)})}(l,c,e),l.addEventListener("wheel",e=>{e.stopPropagation()},{passive:!1}),m.addEventListener("click",t=>{t.stopPropagation(),function(e){const t=Ca.get(e);if(!t)return;t.isMinimized=!t.isMinimized,t.isMinimized?(t.body.style.display="none",t.el.style.maxHeight="auto",t.minimizeBtn.textContent="‚ñ°",t.minimizeBtn.title="Restore"):(t.body.style.display="",t.el.style.maxHeight=t.maxHeight,t.minimizeBtn.textContent="‚àí",t.minimizeBtn.title="Minimize");qa(e,!0,t.isMinimized)}(e)}),f.addEventListener("click",t=>{t.stopPropagation(),Ea(e)}),l.addEventListener("mousedown",()=>Aa(l));const h={id:e,el:l,head:c,body:g,titleEl:u,minimizeBtn:m,closeBtn:f,isMinimized:!1,maxHeight:s};Ca.set(e,h),qa(e,!0,!1),i(`Window ${e} opened`)}function Ea(e){const t=Ca.get(e);t&&(t.el.style.display="none",qa(e,!1,t.isMinimized),i(`Window ${e} closed`))}function $a(e,t,n,o,r){const a=Ca.get(e);return a?"none"!==a.el.style.display?(Ea(e),!1):(a.el.style.display="",a.isMinimized=!1,Aa(a.el),qa(e,!0,!1),!0):(Ma(e,t,n,o,r),!0)}function Aa(e){e.style.zIndex=String(Sa++)}function Ia(e,t){const n=document.createElement("button");return n.className="qpm-window-btn",n.textContent=e,n.title=t,n.style.cssText=`\n    width: 26px;\n    height: 26px;\n    border: none;\n    background: rgba(255, 255, 255, 0.08);\n    color: #e0e0e0;\n    font-size: ${"√ó"===e?"20px":"18px"};\n    font-weight: 300;\n    line-height: 1;\n    cursor: pointer;\n    border-radius: 4px;\n    transition: all 0.15s ease;\n    padding: 0;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  `,n.addEventListener("mouseenter",()=>{n.style.background="√ó"===e?"rgba(244, 67, 54, 0.8)":"rgba(143, 130, 255, 0.5)",n.style.color="#fff"}),n.addEventListener("mouseleave",()=>{n.style.background="rgba(255, 255, 255, 0.08)",n.style.color="#e0e0e0"}),n}function Fa(e,t){const n=t.getBoundingClientRect(),o={right:parseFloat(t.style.right)||window.innerWidth-n.right,top:parseFloat(t.style.top)||n.top};d.set(va+e,o)}function qa(e,t,n){d.set("qpm-window-state-"+e,{isOpen:t,isMinimized:n})}const Na={none:1,golden:25,rainbow:50,wet:2,chilled:2,frozen:10,dawnlit:2,dawnbound:3,amberlit:5,amberbound:6},za={"wet+dawnlit":3,"chilled+dawnlit":3,"wet+amberlit":6,"chilled+amberlit":6,"frozen+dawnlit":11,"frozen+dawnbound":12,"frozen+amberlit":14,"frozen+amberbound":15,"golden+wet":50,"golden+chilled":50,"golden+frozen":250,"golden+dawnlit":50,"golden+dawnbound":75,"golden+amberlit":125,"golden+amberbound":150,"golden+wet+dawnlit":75,"golden+chilled+dawnlit":75,"golden+wet+amberlit":150,"golden+chilled+amberlit":150,"golden+frozen+dawnlit":275,"golden+frozen+dawnbound":300,"golden+frozen+amberlit":350,"golden+frozen+amberbound":375,"rainbow+wet":100,"rainbow+chilled":100,"rainbow+frozen":500,"rainbow+dawnlit":100,"rainbow+dawnbound":150,"rainbow+amberlit":250,"rainbow+amberbound":300,"rainbow+wet+dawnlit":150,"rainbow+chilled+dawnlit":150,"rainbow+wet+amberlit":300,"rainbow+chilled+amberlit":300,"rainbow+frozen+dawnlit":550,"rainbow+frozen+dawnbound":600,"rainbow+frozen+amberlit":700,"rainbow+frozen+amberbound":750};function La(e,t){if(!e&&0===t.length)return Na.none;const n=[];e&&n.push(e),t.sort().forEach(e=>n.push(e));const o=n.join("+");if(za[o])return za[o];let r=Na.none;return e&&(r*=Na[e]),t.forEach(e=>{r*=Na[e]}),r}function Ra(){const e=ha();if(0===e.crops.length)return null;const t=e.crops.filter(e=>e.isMature);if(0===t.length)return null;let n=null;return t.forEach((e,t)=>{const{mutation:o,weather:r}=function(e){let t=null;const n=[];for(const o of e){const e=o.toLowerCase();"golden"===e||"gold"===e?t="golden":"rainbow"===e?t="rainbow":"wet"===e?n.push("wet"):"chilled"===e?n.push("chilled"):"frozen"===e?n.push("frozen"):"dawnlit"===e?n.push("dawnlit"):"dawnbound"===e?n.push("dawnbound"):"amberlit"===e?n.push("amberlit"):"amberbound"===e&&n.push("amberbound")}return{mutation:t,weather:n}}(e.mutations),a=function(e,t){const n=[{weather:"wet",event:"Rain"},{weather:"chilled",event:"Frost"},{weather:"frozen",event:"Rain+Frost"},{weather:"dawnlit",event:"Dawn"},{weather:"amberlit",event:"Amber Moon"}];let o=null;for(const{weather:r,event:a}of n){if(t.includes(r))continue;if("dawnlit"===r&&t.some(e=>"amberlit"===e||"amberbound"===e))continue;if("amberlit"===r&&t.some(e=>"dawnlit"===e||"dawnbound"===e))continue;if("wet"===r&&t.includes("chilled"))continue;if("chilled"===r&&t.includes("wet"))continue;const n=La(e,[...t,r]);(!o||n>o.multiplier)&&(o={weather:r,multiplier:n,weatherEventName:a})}return o}(o,r);if(!a)return;const s=La(o,r),i=e.currentValue*Math.max(1,e.fruitCount),l=i/s*a.multiplier,c=l-i;(!n||c>n.valueDifference)&&(n={cropSpecies:e.species,cropIndex:t,currentMutations:[...e.mutations],currentMultiplier:s,currentValue:i,targetWeather:a.weather,targetMultiplier:a.multiplier,targetValue:l,valueDifference:c,weatherEventName:a.weatherEventName})}),n}function Ba(e,t){if("RainbowGranter"!==t&&"GoldGranter"!==t)return{effective:e,wastePercent:0};try{const t=ha(),n=t.crops.length,o=t.uncoloredCrops.length;if(0===n)return{effective:0,wastePercent:100};const r=o/n;return{effective:e*r,wastePercent:100*(1-r)}}catch(n){return i("‚ö†Ô∏è Failed to calculate effective proc rate",n),{effective:e,wastePercent:0}}}function ja(e,t,n){const o=n?n>0?60/n:null:t;if(!e||!o||o<=0){const e=t;if(e&&e>0){const t=Math.floor(e/60),n=Math.floor(e%60),o=Math.round(e%1*60);return t>0?{text:`${t}h ${n}m ${o}s Est.`,isOverdue:!1}:n>0?{text:`${n}m ${o}s Est.`,isOverdue:!1}:{text:`${o}s Est.`,isOverdue:!1}}return{text:"‚Äî",isOverdue:!1}}const r=e+60*o*1e3-Date.now();if(r<0){const e=Math.abs(r),t=Math.floor(e/36e5),n=Math.floor(e%36e5/6e4),o=Math.floor(e%6e4/1e3);return t>0?{text:`-${t}h ${n}m ${o}s`,isOverdue:!0}:n>0?{text:`-${n}m ${o}s`,isOverdue:!0}:{text:`-${o}s`,isOverdue:!0}}const a=Math.floor(r/36e5),s=Math.floor(r%36e5/6e4),i=Math.floor(r%6e4/1e3);return a>0?{text:`${a}h ${s}m ${i}s Est.`,isOverdue:!1}:s>0?{text:`${s}m ${i}s Est.`,isOverdue:!1}:{text:`${i}s Est.`,isOverdue:!1}}function Da(e,t,n,o=!1){const r=n.insertRow();r.style.cssText="border-bottom: 1px solid var(--qpm-border);";const{effective:a,wastePercent:s}=Ba(e.procsPerHour,e.definition.id),l=r.insertCell(),c=e.pet.strength,u=null!=c?` (STR ${c})`:"";l.textContent=e.displayName+u,l.style.cssText="\n    padding: 10px 12px;\n    color: var(--qpm-text);\n    font-weight: 500;\n    white-space: nowrap;\n  ",l.title=`Pet: ${e.displayName}${null!=c?`\nStrength: ${c}`:"\nStrength: Unknown"}`;const d=r.insertCell();d.textContent=t,d.style.cssText="\n    padding: 10px 12px;\n    color: var(--qpm-text);\n    white-space: nowrap;\n  ",s>0&&(d.title=`‚ö†Ô∏è ${s.toFixed(1)}% proc waste (targeting colored plants)`);const p=r.insertCell(),m=e.pet.strength??100,f=(e.definition.baseProbability??0)/60,g=60*(f*m/100),h=`${g.toFixed(2)}%/min`;p.innerHTML=s>0?`${h} <span style="color: var(--qpm-warning); font-size: 10px;">(-${s.toFixed(0)}%)</span>`:h,p.style.cssText="\n    padding: 10px 12px;\n    text-align: right;\n    color: var(--qpm-text);\n    font-family: monospace;\n    white-space: nowrap;\n  ",p.title=s>0?`Base: ${(60*f).toFixed(2)}%/min √ó ${m}/100 = ${g.toFixed(2)}%/min\n${s.toFixed(1)}% waste from colored plants`:`Base: ${(60*f).toFixed(2)}%/min √ó ${m}/100 = ${g.toFixed(2)}%/min (game checks every second)`;const b=r.insertCell();b.textContent=a.toFixed(2),b.style.cssText="\n    padding: 10px 12px;\n    text-align: right;\n    color: var(--qpm-text);\n    font-family: monospace;\n  ",b.title=s>0?`Base: ${e.procsPerHour.toFixed(2)}/hr\nEffective: ${a.toFixed(2)}/hr after waste`:`${e.procsPerHour.toFixed(2)} procs/hour`;const y=r.insertCell(),x=e.effectPerProc??0,w=o?ir:lr;y.textContent=x>0?w(x):"‚Äî",y.style.cssText=`\n    padding: 10px 12px;\n    text-align: right;\n    color: ${x>0?"var(--qpm-warning)":"var(--qpm-text-muted)"};\n    font-family: monospace;\n    font-weight: 500;\n  `,e.effectDetail&&(y.title=e.effectDetail),!o&&x>0&&(y.title=`Exact: ${ir(x)}`);const v=r.insertCell(),C=a*(x>0?x:0);if(v.textContent=C>0?w(C):"‚Äî",v.style.cssText=`\n    padding: 10px 12px;\n    text-align: right;\n    color: ${C>0?"var(--qpm-warning)":"var(--qpm-text-muted)"};\n    font-family: monospace;\n    font-weight: 600;\n  `,s>0&&C>0){const t=e.procsPerHour*(x>0?x:0);v.title=`Base: ${ir(t)}/hr\nEffective: ${ir(C)}/hr after ${s.toFixed(0)}% waste`}else!o&&C>0&&(v.title=`Exact: ${ir(C)}/hr`);const S=r.insertCell();S.className="eta-countdown",S.dataset.lastProc=String(e.lastProcAt??0),S.dataset.effectiveRate=String(a);const T=ja(e.lastProcAt,e.expectedMinutesBetween,a);S.textContent=T.text,S.style.cssText=`\n    padding: 10px 12px;\n    text-align: right;\n    color: ${T.isOverdue?"var(--qpm-danger)":"var(--qpm-positive)"};\n    font-family: monospace;\n    font-weight: 500;\n    white-space: nowrap;\n  `;const k=a>0?60/a:0;if(S.title=k>0?`Average ${k.toFixed(1)} minutes between procs${e.lastProcAt?"\nLast proc: "+new Date(e.lastProcAt).toLocaleTimeString():""}`:"No proc history yet",o){const t=n.insertRow();t.style.cssText="\n      background: var(--qpm-surface-2);\n      border-bottom: 1px solid var(--qpm-border);\n    ";const o=t.insertCell();o.colSpan=7,o.style.cssText="\n      padding: 8px 12px;\n      font-size: 11px;\n      color: var(--qpm-text-muted);\n      line-height: 1.6;\n    ";const r=e.pet.strength??100,a=e.definition.baseProbability??0,l=r/100,c=a*l,u=[];if(a>0&&u.push(`<strong>Chance Per Minute:</strong> ${a.toFixed(2)}% √ó ${r} = ${c.toFixed(2)}%`),e.definition.effectLabel&&null!=e.definition.effectBaseValue){const t=e.definition.effectBaseValue*l,n=e.definition.effectSuffix??"";u.push(`<strong>${e.definition.effectLabel}:</strong> ${e.definition.effectBaseValue}${n} √ó ${r} = ${t.toFixed(1)}${n}`)}if("ProduceMutationBoost"===e.definition.id||"ProduceMutationBoostII"===e.definition.id)try{const e=Ra();if(e){const t=function(e,t){if(!e)return"No mutation opportunities found";const n=(e.weatherEventName.includes("Dawn")||e.weatherEventName.includes("Amber")?1:7)*(t/100);return`Best: ${e.cropSpecies} ‚Üí ${e.weatherEventName} (${n.toFixed(2)}% chance, +${(e.targetMultiplier/e.currentMultiplier).toFixed(1)}√ó value)`}(e,r);u.push(`<strong>üåü Opportunity:</strong> ${t}`)}}catch(P){i("‚ö†Ô∏è Failed to calculate mutation opportunity",P)}if("observed"===e.procsPerHourSource?u.push(`<strong>Data Source:</strong> Observed (${e.sampleCount} sample${1!==e.sampleCount?"s":""})`):u.push("<strong>Data Source:</strong> Estimated from ability definition"),s>0){const e=ha();u.push(`<strong>Efficiency:</strong> ${(100-s).toFixed(1)}% (${e.uncoloredCrops.length}/${e.crops.length} uncolored crops)`)}if(e.lastProcAt){const t=new Date(e.lastProcAt),n=Date.now()-e.lastProcAt,o=Math.floor(n/6e4),r=Math.floor(o/60),a=r>0?`${r}h ${o%60}m ago`:`${o}m ago`;u.push(`<strong>Last Proc:</strong> ${t.toLocaleTimeString()} (${a})`)}o.innerHTML=u.join(" ‚Ä¢ ")}return r}let Ha={panel:null,content:null,status:null,toggle:null,weatherStatus:null,shopStatus:null,shopItemToggles:null,mutationStatus:null,harvestStatus:null,harvestSummary:null,headerContainer:null,headerMeta:null,headerTimer:null,headerAutoFeed:null,headerWeather:null,headerShop:null,dashboardFeedList:null,dashboardFeedMeta:null,dashboardRestockSummary:null,dashboardRestockValues:{seeds:null,eggs:null,tools:null,decor:null},turtleStatus:null,turtleDetail:null,turtleFooter:null,turtleEnableButtons:[],turtleBoardwalkToggles:[],turtleFocusSelects:[],turtleFocusTargetSelects:[],turtleFocusTargetContainers:[],turtleEggFocusSelects:[],turtleEggFocusTargetSelects:[],turtleEggFocusTargetContainers:[],turtlePlantSummary:null,turtlePlantEta:null,turtlePlantTable:null,turtlePlantTotals:null,turtlePlantSimple:null,turtlePlantLuck:null,turtleEggSummary:null,turtleEggEta:null,turtleEggTable:null,turtleEggTotals:null,turtleEggSimple:null,turtleEggLuck:null,turtleSupportSummary:null,turtleSupportTotals:null,turtleSupportSimple:null,turtleSupportList:null,trackerAbilitySummary:null,trackerAbilityFilterSelect:null,trackerAbilityTable:null,trackerAbilityUnknown:null,trackerXpSummary:null,trackerXpAbilityTable:null,trackerXpPerPetTable:null,trackerXpTargetModeSelect:null,trackerXpTargetPetSelect:null,mutationTrackerCard:null,mutationTrackerSummary:null,mutationTrackerTotals:null,mutationTrackerRatios:null,mutationTrackerCountdown:null,mutationTrackerDetail:null,mutationTrackerTable:null,mutationTrackerSourceSelect:null,mutationTrackerDetailToggle:null,mutationTrackerSourceBadge:null,mutationTrackerEmpty:null,trackerAbilityHistoryUnsubscribe:null,trackerAbilityTicker:null,xpTrackerWindow:null,mutationTrackerUnsubscribe:null,mutationTrackerTicker:null,turtleUnsubscribe:null,notificationsSection:null,notificationsListWrapper:null,notificationsList:null,notificationsFilterBar:null,notificationsEmpty:null,notificationsUnsubscribe:null,notificationsDetail:null,notificationsDetailHeader:null,notificationsDetailTitle:null,notificationsDetailTimestamp:null,notificationsDetailMeta:null,notificationsDetailMessage:null,notificationsDetailActions:null,notificationsDetailRaw:null,notificationsDetailPlaceholder:null,notificationsDetailToggle:null};const _a=[];let Wa=null,Oa=null,Ga=0,Ua=0,Xa=null,Va="",Ka=null,Ja=null,Ya=null;const Qa="quinoa-ui-panel-position",Za="quinoa-ui-panel-collapsed",es="qpm-toast-style";d.get("quinoa-ui-notifications-collapsed",!1),d.get("quinoa-ui-notifications-detail-expanded",!1);const ts={Rainbow:!0,Gold:!1,Frozen:!1,Wet:!1,Chilled:!1,Dawnlit:!1,Amberlit:!1,Amberbound:!1,Dawnbound:!1},ns=[{key:"seeds",label:"Seeds",icon:"üå±"},{key:"eggs",label:"Eggs",icon:"ü•ö"},{key:"tools",label:"Tools",icon:"üõ†Ô∏è"},{key:"decor",label:"Decor",icon:"ü™¥"}],os={plant:5,egg:10};function rs(e){if(!e)return{tileId:null,slotIndex:null};const[t,n]=e.split("::"),o=Number.parseInt(n??"",10);return t&&Number.isFinite(o)?{tileId:t,slotIndex:o}:{tileId:null,slotIndex:null}}function as(e){const t=Math.max(0,Math.floor(e/1e3)),n=Math.floor(t/3600),o=Math.floor(t%3600/60),r=t%60;return n>0?`${n}:${o.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`:`${o}:${r.toString().padStart(2,"0")}`}function ss(e){if(null==e||!Number.isFinite(e))return"‚Äî";if(e<=0)return"Ready";const t=Math.round(e/1e3);if(t<60)return`${t}s`;const n=Math.floor(t/60),o=t%60;if(n<60)return o>0?`${n}m ${o}s`:`${n}m`;const r=Math.floor(n/60),a=n%60;return a>0?`${r}h ${a.toString().padStart(2,"0")}m`:`${r}h`}function is(e){return null!=e&&Number.isFinite(e)?`${e.toFixed(2)}√ó`:"1.00√ó"}function ls(e){return null!=e&&Number.isFinite(e)?`${Math.round(e)}%`:"‚Äî"}function cs(e,t=0){return null!=e&&Number.isFinite(e)?`${e.toFixed(t)}%`:"0%"}function us(e,t=1){if(null==e||!Number.isFinite(e)||e<=0)return"0.0 feeds/hr";return`${(e/100).toFixed(t)} feeds/hr`}function ds(e){if(null==e||!Number.isFinite(e))return"‚Äî";if(e<1){return`${Math.max(1,Math.round(60*e))}s`}if(e>=60){const t=Math.floor(e/60),n=Math.round(e%60);return n>0?`${t}h ${n}m`:`${t}h`}return`${Math.round(e)}m`}function ps(e,t,n,o){const r=document.createElement("span");return r.style.cssText="cursor:pointer;text-decoration:underline dotted;",r.title=`Click to manually set ${t} value (leave empty to clear)`,r.textContent=o(n),r.addEventListener("click",o=>{o.stopPropagation();const a=document.createElement("input");a.type="number",a.style.cssText="width:60px;font-size:9px;padding:2px;border:1px solid #4CAF50;background:#1a1a1a;color:#fff;",a.value=null!=n?String(n):"",a.placeholder="xp"===t?"XP":"Scale",a.step="targetScale"===t?"0.01":"1";const s=()=>{const n=a.value.trim(),o={species:e.species,slotIndex:e.slotIndex,petId:e.petId??null};if(""===n)!function(e,t){const n=no(e);eo[n]&&(t?(delete eo[n][t],0===Object.keys(eo[n]).length&&delete eo[n]):delete eo[n],to(),Ro())}(o,t);else{const e=Number(n);Number.isFinite(e)&&e>=0&&function(e,t){const n=no(e);eo[n]||(eo[n]={}),Object.assign(eo[n],t),to(),Ro()}(o,{[t]:e})}a.remove(),r.style.display=""};a.addEventListener("blur",()=>setTimeout(s,100)),a.addEventListener("keydown",e=>{"Enter"===e.key?(e.preventDefault(),s()):"Escape"===e.key&&(r.style.display="",a.remove())}),r.style.display="none",r.parentElement?.insertBefore(a,r.nextSibling),a.focus(),a.select()}),r}function ms(e){if(null==e||!Number.isFinite(e)||0===e)return"0m per hour";const t=e>=0?"-":"+",n=Math.abs(e),o=Math.max(0,Math.round(n)),r=Math.floor(o/60),a=o%60,s=[];return r>0&&s.push(`${r}hr`),(a>0||0===s.length)&&s.push(`${a}m`),`${t}${s.join(" ")} per hour`}const fs=e=>{if("number"==typeof e&&Number.isFinite(e))return e;if("string"==typeof e){const t=e.replace(/[^0-9.+-]/g,"");if(!t)return null;const n=Number(t);return Number.isFinite(n)?n:null}return null},gs=(e,...t)=>{if(!e||"object"!=typeof e)return null;const n=e;for(const o of t){if(!(o in n))continue;const e=fs(n[o]);if(null!=e)return e}return null},hs=(e,t)=>{const n=[];return e.petId&&n.push(e.petId),e.slotId&&n.push(e.slotId),"number"==typeof e.slotIndex&&Number.isFinite(e.slotIndex)&&n.push(String(Math.max(0,Math.round(e.slotIndex)))),Zr(t,{petId:e.petId,slotId:e.slotId,slotIndex:"number"==typeof e.slotIndex&&Number.isFinite(e.slotIndex)?e.slotIndex:null,fallbackKeys:n})},bs=e=>{const t=Date.now()-144e5;return e.events.filter(e=>e.performedAt>=t)},ys=(e,t)=>{const n=t.data;switch(e.category){case"xp":return gs(n,"bonusXp","xp","value");case"plantGrowth":return gs(n,"plantGrowthReductionMinutes","reductionMinutes","minutes");case"eggGrowth":return gs(n,"eggGrowthTimeReductionMinutes","reductionMinutes","minutes");case"coins":return gs(n,"coinsFound","coins","coinsEarned","sellPrice","bonusCoins","value","valueEarned","coinsValue");default:return null}},xs=(e,t)=>{const n=bs(e);if(!n.length)return null;const o=n[n.length-1],r=n[0];let a=null;if(n.length>=2){const e=o.performedAt-r.performedAt;e>0&&(a=(n.length-1)/(e/36e5))}const s=[];for(const i of n){const e=ys(t,i);null!=e&&Number.isFinite(e)&&s.push(e)}return{procsPerHour:a,effectPerProc:s.length?s.reduce((e,t)=>e+t,0)/s.length:null,lastProcAt:o.performedAt,sampleCount:n.length}};function ws(e){return e.name&&e.name.trim().length>0?e.name:e.species&&e.species.trim().length>0?e.species:"number"==typeof e.slotIndex&&Number.isFinite(e.slotIndex)?`Pet ${e.slotIndex+1}`:"Unknown pet"}function vs(){const e=As.turtleTimer??{},t={enabled:e.enabled??!0,includeBoardwalk:e.includeBoardwalk??!1,focus:"earliest"===e.focus||"specific"===e.focus?e.focus:"latest",focusTargetTileId:"string"==typeof e.focusTargetTileId?e.focusTargetTileId:null,focusTargetSlotIndex:"number"==typeof e.focusTargetSlotIndex&&Number.isFinite(e.focusTargetSlotIndex)?Math.max(0,Math.round(e.focusTargetSlotIndex)):null,eggFocus:"earliest"===e.eggFocus||"specific"===e.eggFocus?e.eggFocus:"latest",eggFocusTargetTileId:"string"==typeof e.eggFocusTargetTileId?e.eggFocusTargetTileId:null,eggFocusTargetSlotIndex:"number"==typeof e.eggFocusTargetSlotIndex&&Number.isFinite(e.eggFocusTargetSlotIndex)?Math.max(0,Math.round(e.eggFocusTargetSlotIndex)):null};return As.turtleTimer=t,t}function Cs(e){if(null==e||!Number.isFinite(e))return"";const t=new Date(Date.now()+e),n=t.getHours(),o=n>=12?"PM":"AM";return` ‚Ä¢ ${n%12||12}:${t.getMinutes().toString().padStart(2,"0")} ${o}`}function Ss(e){if("estimating"!==e.status||null==e.naturalMsRemaining||null==e.adjustedMsRemaining||!Number.isFinite(e.adjustedMsRemaining))return{luckyMs:null,unluckyMs:null,stdMinutes:null};const t=Math.max(0,e.adjustedMsRemaining/6e4),n=Math.max(1,t);let o=0;for(const a of e.contributions){const e=a.ability,t=os[e];if(!Number.isFinite(t))continue;const r=t*(a.baseScore/100);if(!Number.isFinite(r)||r<=0)continue;const s=a.rateContribution;if(!Number.isFinite(s)||s<=0)continue;const i=Math.min(.99,Math.max(0,s/Math.max(r,1e-4)));if(i<=0)continue;o+=n*i*(1-i)*r*r}if(o<=0)return{luckyMs:e.adjustedMsRemaining,unluckyMs:e.adjustedMsRemaining,stdMinutes:0};const r=Math.sqrt(o);return{luckyMs:6e4*Math.max(0,t-r),unluckyMs:6e4*(t+r),stdMinutes:r}}function Ts(e){const t=e.plant,n=e.egg,o=e.support,r=t.contributions.reduce((e,t)=>e+(t.perHourReduction??0),0),a=null!=t.naturalMsRemaining?t.naturalMsRemaining/6e4:null;null!=t.adjustedMsRemaining&&t.adjustedMsRemaining;const s=t.minutesSaved??null,i=Ss(t),l=n.contributions.reduce((e,t)=>e+(t.perHourReduction??0),0),c=null!=n.naturalMsRemaining?n.naturalMsRemaining/6e4:null;null!=n.adjustedMsRemaining&&n.adjustedMsRemaining;const u=n.minutesSaved??null,d=Ss(n),p=o.restorePctActive;o.restorePctTotal;const m=o.restorePctPerHourActive,f=o.restorePctPerHourTotal,g=o.restoreTriggersPerHourActive;o.restoreTriggersPerHourTotal;const h=o.slowPctActive,b=o.slowPctTotal,y=e=>{const t=document.createElement("div");return t.textContent=e,t.style.cssText="font-size:10px;color:#90a4ae;font-style:italic;",t},x=Ha.turtleEnableButtons;0===x.length&&(Ha.turtleEnableButtons=x);for(const J of x)J&&(e.enabled?(J.textContent="Enabled",J.style.background="rgba(56, 142, 60, 0.28)",J.style.borderColor="rgba(56, 142, 60, 0.55)",J.style.color="#e8f5e9"):(J.textContent="Disabled",J.style.background="rgba(158, 158, 158, 0.22)",J.style.borderColor="rgba(158, 158, 158, 0.35)",J.style.color="#eceff1"));for(const J of Ha.turtleBoardwalkToggles)J&&(J.checked=e.includeBoardwalk);for(const J of Ha.turtleFocusSelects)J&&J.value!==e.focus&&(J.value=e.focus);for(const J of Ha.turtleEggFocusSelects)J&&J.value!==e.eggFocus&&(J.value=e.eggFocus);const w=e.focusTargetKey,v=e.plantTargets??[],C="specific"===e.focus,S=v.length>0;Ha.turtleFocusTargetSelects.forEach((t,n)=>{if(!t)return;const o=Ha.turtleFocusTargetContainers[n];o&&(o.style.display=C?"inline-flex":"none");const r=Array.from(t.options).map(e=>e.value),a=v.map(e=>e.key);if(r.length!==a.length+1||r.slice(1).some((e,t)=>e!==a[t])){t.textContent="";const e=document.createElement("option");e.value="",e.textContent=v.length?"Pick a plant...":"No plants detected yet",e.disabled=v.length>0,e.hidden=v.length>0,t.appendChild(e);for(const n of v){const e=document.createElement("option");e.value=n.key;const o=n.species??"Unknown plant",r=null!=n.remainingMs?ss(n.remainingMs):"Ready",a=n.boardwalk?" (boardwalk)":"";e.textContent=`${o} - ${r}${a}`,t.appendChild(e)}}const s=C&&e.focusTargetAvailable&&w?w:"";t.value!==s&&(t.value=s),t.disabled=!C||0===v.length});const T=e.eggFocusTargetKey,k=e.eggTargets??[],P="specific"===e.eggFocus,M=k.length>0;Ha.turtleEggFocusTargetSelects.forEach((t,n)=>{if(!t)return;const o=Ha.turtleEggFocusTargetContainers[n];o&&(o.style.display=P?"inline-flex":"none");const r=Array.from(t.options).map(e=>e.value),a=k.map(e=>e.key);if(r.length!==a.length+1||r.slice(1).some((e,t)=>e!==a[t])){t.textContent="";const e=document.createElement("option");e.value="",e.textContent=k.length?"Pick an egg...":"No eggs detected yet",e.disabled=k.length>0,e.hidden=k.length>0,t.appendChild(e);for(const n of k){const e=document.createElement("option");e.value=n.key;const o=n.species??"Unknown egg",r=null!=n.remainingMs?ss(n.remainingMs):"Ready",a=n.boardwalk?" (boardwalk)":"";e.textContent=`${o} - ${r}${a}`,t.appendChild(e)}}const s=P&&e.eggFocusTargetAvailable&&T?T:"";t.value!==s&&(t.value=s),t.disabled=!P||0===k.length});const E=[];e.hungerFilteredCount>0&&E.push(`${e.hungerFilteredCount} need feeding`),e.turtlesMissingStats>0&&E.push(`${e.turtlesMissingStats} missing stats`),e.includeBoardwalk;const $=Ha.turtleStatus,A=Ha.turtleDetail,I=Ha.turtleFooter,F=(e,t,n,o=!1)=>{$&&($.textContent=e),A&&(o?A.innerHTML=t:A.textContent=t),I&&(I.textContent=n)},q=Ha.turtlePlantNameText;if(e.enabled)if("no-data"===t.status)q&&(q.textContent="Waiting..."),F("Waiting for garden data‚Ä¶","Move camera or interact with garden","");else if("no-crops"===t.status)q&&(q.textContent="No Crops"),F("No crops growing","Plant seeds to start tracking","");else if("no-turtles"===t.status){const e=t.focusSlot?.species||"Crop";q&&(q.textContent=e);F(`${e} ‚Ä¢ ${t.naturalMsRemaining?ss(t.naturalMsRemaining):"‚Äî"}`,`No plant boost ‚Ä¢ ${`${t.growingSlots}/${t.trackedSlots} crops`}`,"")}else if("estimating"===t.status){const e=t.focusSlot?.species||"Crop";q&&(q.textContent=e);const r=ss(t.adjustedMsRemaining),a=Cs(t.adjustedMsRemaining),s=is(t.effectiveRate),i=Ss(t),l=null!=i.unluckyMs?ss(i.unluckyMs):"",c=[];if(t.contributions.length>0&&c.push(`üå± ${s} plant`),n.contributions.length>0&&"estimating"===n.status&&null!=n.effectiveRate){const e=is(n.effectiveRate);c.push(`ü•ö ${e} egg`)}else n.contributions.length>0&&c.push(`ü•ö ${n.contributions.length} egg`);const u=o.restoreCount+o.slowCount;u>0&&c.push(`üçΩÔ∏è ${u} food`);let d=`${c.length>0?c.join(" ‚Ä¢ "):"No turtles"} ‚Ä¢ ${`${t.growingSlots}/${t.trackedSlots} crops`}`;l&&(d+=` ‚Ä¢ <span style="color:#ff5252;font-size:9px;">(${l})</span>`),F(`${e} ‚Ä¢ ${r}${a}`,d,"",!0)}else q&&(q.textContent="Idle"),F("Turtle timer idle","","");else q&&(q.textContent="Timer Disabled"),F("Timer disabled","Enable to track crops and eggs","");const N=Ha.turtlePlantSummary;if(N)if(e.enabled)if("no-data"===t.status)N.textContent=C&&!e.focusTargetAvailable&&S?"Select a target plant with Focus to start tracking.":"Waiting for garden snapshot‚Ä¶";else if("no-crops"===t.status)N.textContent="No growing crops.";else{const e=t.focusSlot?.species||"Unknown crop",n=t.contributions.length;N.textContent=`${e} ‚Ä¢ ${n} turtle${1===n?"":"s"}`}else N.textContent="Timer disabled";const z=Ha.turtlePlantEta;if(z)if(e.enabled)if("estimating"===t.status){const e=Cs(t.adjustedMsRemaining);z.textContent=`${ss(t.adjustedMsRemaining)} (${is(t.effectiveRate)})${e}`}else if("no-turtles"===t.status)if(null!=t.naturalMsRemaining){const e=Cs(t.naturalMsRemaining);z.textContent=`${ss(t.naturalMsRemaining)} (no turtle boost)${e}`}else z.textContent="‚Äî";else z.textContent="‚Äî";else z.textContent="‚Äî";const L=Ha.turtlePlantTotals;if(L)if(e.enabled)if(C&&!e.focusTargetAvailable)L.textContent=S?"Total Growth Boost will appear once a target plant is selected.":"Waiting for a fresh garden snapshot...";else if("no-data"===t.status)L.textContent="Waiting for a fresh garden snapshot...";else if("no-crops"===t.status)L.textContent="No growing crops yet - plant something to see totals.";else if("no-turtles"===t.status){const e=null!=a?ds(a):"‚Äî";L.textContent=`No turtles active ‚Ä¢ ETA: ${e}`}else L.textContent=`Boost: ${ms(r)} ‚Ä¢ Base: ${null!=a?ds(a):"‚Äî"} ‚Ä¢ Saved: ${null!=s?ds(s):"‚Äî"}`;else L.textContent="Totals paused while the temple is disabled.";const R=Ha.turtlePlantSimple;if(R)if(e.enabled)if(C&&!e.focusTargetAvailable)R.textContent=S?"Select a plant to track.":"Waiting for garden data...";else if("no-data"===t.status)R.textContent="Waiting for garden data...";else if("no-crops"===t.status)R.textContent="No crops growing.";else if("no-turtles"===t.status){const e=null!=a?ds(a):"‚Äî";R.textContent=`Matures in ${ss(t.naturalMsRemaining)} (no boost) ‚Ä¢ Base ETA: ${e}`}else{const e=null!=a?ds(a):"‚Äî",n=null!=s?ds(s):"‚Äî";R.textContent=`Matures in ${ss(t.adjustedMsRemaining)} (Base: ${e}) ‚Ä¢ Saved: ${n}`}else R.textContent="Enable timer to track crop finish times.";const B=Ha.turtlePlantLuck;if(B)if(e.enabled&&"estimating"===t.status){const e=null!=i.luckyMs?ss(i.luckyMs):"‚Äî",t=null!=i.unluckyMs?ss(i.unluckyMs):"‚Äî",n=null!=i.stdMinutes?ds(i.stdMinutes):"‚Äî";B.textContent=`Lucky ‚âà ${e} ‚Ä¢ Unlucky ‚âà ${t} (¬±${n})`}else B.textContent="";const j=Ha.turtleEggSummary;j&&(e.enabled?"no-data"===n.status?j.textContent=P&&!e.eggFocusTargetAvailable&&M?"Select a target egg with Egg focus to track hatching.":"Waiting for garden snapshot‚Ä¶":"no-eggs"===n.status?j.textContent="No eggs incubating.":j.textContent=`${n.growingSlots}/${n.trackedSlots} eggs ‚Ä¢ ${n.contributions.length} turtle${1===n.contributions.length?"":"s"}`:j.textContent="Timer disabled");const D=Ha.turtleEggEta;if(D)if(e.enabled)if("estimating"===n.status){const e=Cs(n.adjustedMsRemaining);D.textContent=`${ss(n.adjustedMsRemaining)} (${is(n.effectiveRate)})${e}`}else if("no-turtles"===n.status)if(null!=n.naturalMsRemaining){const e=Cs(n.naturalMsRemaining);D.textContent=`${ss(n.naturalMsRemaining)} (no turtle boost)${e}`}else D.textContent="‚Äî";else D.textContent="‚Äî";else D.textContent="‚Äî";const H=Ha.turtleEggTotals;if(H)if(e.enabled)if(P&&!e.eggFocusTargetAvailable)H.textContent=M?"Total Hatch Boost will appear once a target egg is selected.":"Waiting for a fresh egg snapshot...";else if("no-eggs"===n.status)H.textContent="No eggs incubating.";else if("no-turtles"===n.status){const e=null!=c?ds(c):"‚Äî";H.textContent=`No turtles active ‚Ä¢ ETA: ${e}`}else"estimating"===n.status?H.textContent=`Boost: ${ms(l)} ‚Ä¢ Base: ${null!=c?ds(c):"‚Äî"} ‚Ä¢ Saved: ${null!=u?ds(u):"‚Äî"}`:H.textContent="Waiting for data‚Ä¶";else H.textContent="Totals paused while the temple is disabled.";const _=Ha.turtleEggSimple;if(_)if(e.enabled)if("no-eggs"===n.status)_.textContent="No eggs on the boardwalk or garden right now. Drop an egg to start tracking.";else if(P&&!e.eggFocusTargetAvailable)_.textContent=M?"Pick a target egg with Egg focus to show its hatch ETA and boost cut.":"Waiting on egg snapshots ‚Äì try moving the camera or drop an egg to refresh.";else if("no-data"===n.status)_.textContent="Waiting on egg snapshots ‚Äì try moving the camera or interacting with the garden.";else if("no-turtles"===n.status){const e=null!=c?ds(c):"‚Äî";_.textContent=`Focused egg hatches in ${ss(n.naturalMsRemaining)} (no turtle boost active). Normal ETA: ${e}.`}else if("estimating"===n.status){const e=null!=c?ds(c):"‚Äî",t=null!=u?ds(u):"‚Äî";_.textContent=`Focused egg hatches in ${ss(n.adjustedMsRemaining)} (Normal ETA: ${e}); Estimated Time Cut: ${t}.`}else _.textContent="";else _.textContent="Enable the temple to see egg hatching boosts too.";const W=Ha.turtleEggLuck;if(W)if(e.enabled)if("estimating"===n.status){const e=null!=d.luckyMs?ss(d.luckyMs):"‚Äî",t=null!=d.unluckyMs?ss(d.unluckyMs):"‚Äî",n=null!=d.stdMinutes?ds(d.stdMinutes):"‚Äî";W.textContent=`Lucky ‚âà ${e} ‚Ä¢ Unlucky ‚âà ${t} (¬±${n})`}else"no-turtles"===n.status?W.textContent="No turtle boosts active for eggs right now.":W.textContent="";else W.textContent="";const O=Ha.turtleSupportSummary,G=Ha.turtleSupportTotals,U=Ha.turtleSupportSimple,X=Ha.turtleSupportList;if(O&&(e.enabled?0===o.entries.length?O.textContent="No food turtles detected ‚Äì add Hunger Restore or Hunger Boost companions.":O.textContent=`Restore turtles active ${o.restoreActiveCount}/${o.restoreCount} ‚Ä¢ Slow drain turtles active ${o.slowActiveCount}/${o.slowCount}`:O.textContent="Food buffs paused while the temple is disabled."),G)if(e.enabled&&0!==o.entries.length){const e=m>0?us(m,1):"0.0 feeds/hr",t=f>0?us(f,1):"0.0 feeds/hr",n=o.restoreCount>0?`Restore: ~${e} (max ${t})`:"Restore: none yet",r=o.slowCount>0?`Slow drain: ${cs(h,0)} active (${cs(b,0)} possible)`:"Slow drain: none yet";G.textContent=`${n} ‚Ä¢ ${r}`}else G.textContent="";if(U)if(e.enabled)if(0===o.entries.length)U.textContent="Assign turtles with Hunger Restore (refills) or Hunger Boost (slow drain) abilities to see food support stats.";else{const e=o.restoreCount>0,t=p>0&&o.restoreActiveCount>0,n=o.slowActiveCount>0&&h>0;if(t&&g>0){const e=m/100;U.textContent=`Restore turtles are covering ~${e.toFixed(1)} feeds/hr and slow drain buffs are cutting hunger by ${cs(h,0)} while they stay fed.`}else e&&0===o.restoreActiveCount?U.textContent="Your restore turtles need food before their hourly refills kick back in.":U.textContent=n?`Slow drain buffs are active, trimming hunger by ${cs(h,0)} as long as the turtles stay full.`:e?"Restore turtles are present but idle‚Äîfeed them to start the hourly refills.":"Add food turtles with Hunger Restore or Hunger Boost abilities to see refills and slowdown buffs here."}else U.textContent="Enable the turtle temple and keep turtles fed to maintain hunger buffs.";if(X)if(X.textContent="",e.enabled)if(0===o.entries.length)X.appendChild(y("No food turtles detected."));else{for(const t of o.entries){const e=document.createElement("div");e.style.cssText="display:flex;flex-direction:column;gap:3px;padding:4px 0;border-bottom:1px solid rgba(255,255,255,0.05);font-size:10px;";const n=document.createElement("div");n.style.cssText="display:flex;justify-content:space-between;align-items:center;gap:12px;color:#ffe9a6;";const o=document.createElement("span");o.textContent=`${t.name??"Unknown"} ‚Ä¢ ${t.abilityNames.join(", ")}`;const r=document.createElement("span");r.textContent=t.active?"Active":"Needs feed",r.style.cssText=`padding:1px 6px;border-radius:12px;font-size:9px;background:${t.active?"rgba(129,199,132,0.25)":"rgba(255,138,128,0.25)"};color:${t.active?"#c8e6c9":"#ffab91"};`,n.append(o,r);const a=document.createElement("div");a.style.cssText="display:flex;flex-direction:column;gap:2px;color:#ffecb3;";const s=t.totalRestorePerHourPct>0?t.totalRestorePerHourPct/100:0;if(t.totalRestorePerHourPct>0){const e=document.createElement("div");e.textContent=`Restore: ${s.toFixed(1)} feeds/hr (${cs(t.totalRestorePerTriggerPct,0)} per proc, ~${t.totalTriggersPerHour.toFixed(1)} procs/hr)`,a.appendChild(e)}if(t.totalSlowPct>0){const e=document.createElement("div");e.textContent=`Slow drain: ${cs(t.totalSlowPct,0)} less hunger/hr while active`,a.appendChild(e)}if(s>0||t.totalSlowPct>0){const e=document.createElement("div");s>0&&t.totalSlowPct>0?e.textContent=`Feed relief: ~${s.toFixed(1)} fewer feeds/hr and pets eat ~${cs(t.totalSlowPct,0)} less often.`:e.textContent=s>0?`Feed relief: ~${s.toFixed(1)} fewer feeds/hr thanks to this turtle.`:`Feed relief: pets eat ~${cs(t.totalSlowPct,0)} less often.`,a.appendChild(e)}if(!a.hasChildNodes()){const e=document.createElement("div");e.textContent="No active food effects yet.",a.appendChild(e)}const i=document.createElement("div");i.style.cssText="font-size:9px;color:#ffdd99;display:flex;flex-wrap:wrap;gap:8px;";const l=`Hunger ${ls(t.hungerPct)}`,c=`Score ${Math.round(t.baseScore)}`,u=document.createElement("span");u.textContent="xp: ";const d=ps({species:t.species,slotIndex:t.slotIndex},"xp",t.xp,e=>null!=e?`${Math.round(e/1e3)}k`:"?"),p=document.createElement("span");p.textContent=" ‚Ä¢ Scale: ";const m=ps({species:t.species,slotIndex:t.slotIndex},"targetScale",t.targetScale,e=>null!=e&&Number.isFinite(e)?`${e.toFixed(2)}√ó`:"?");i.textContent=`${l} ‚Ä¢ ${c} ‚Ä¢ `,i.appendChild(u),i.appendChild(d),i.appendChild(p),i.appendChild(m),e.append(n,a,i),X.appendChild(e)}const e=X.querySelectorAll(":scope > div");e.length>0&&(e[e.length-1].style.borderBottom="none")}else X.appendChild(y("Timer disabled."));const V=Ha.turtlePlantTable;if(V)if(V.textContent="",e.enabled)if(0===t.contributions.length)V.appendChild(y("No turtles active."));else for(const J of t.contributions){const t=document.createElement("div");t.style.cssText="display:grid;grid-template-columns:1.4fr 0.7fr 0.6fr 0.8fr;gap:6px;font-size:10px;padding:2px 0;";const n=document.createElement("div");n.textContent=J.name??`Slot ${J.slotIndex+1}`,n.style.color=J.missingStats?"#ffcc80":"#e0f2f1";const o=document.createElement("div");o.textContent=ls(J.hungerPct),o.style.color=null!=J.hungerPct&&J.hungerPct<e.minActiveHungerPct?"#ff8a80":"#b2dfdb";const r=document.createElement("div");r.textContent=`${J.perHourReduction.toFixed(1)} min/hr`,r.style.color="#aed581";const a=document.createElement("div");a.style.color=J.missingStats?"#ffcc80":"#c5cae9";const s=ps({species:J.species,slotIndex:J.slotIndex},"xp",J.xp,e=>null!=e?`${Math.round(e/1e3)}k xp`:"‚Äî");a.appendChild(s),t.append(n,o,r,a),V.appendChild(t)}else V.appendChild(y("Timer disabled."));const K=Ha.turtleEggTable;if(K)if(K.textContent="",e.enabled)if(0===n.contributions.length)K.appendChild(y("No egg boosters active."));else for(const J of n.contributions){const t=document.createElement("div");t.style.cssText="display:grid;grid-template-columns:1.4fr 0.7fr 0.6fr 0.8fr;gap:6px;font-size:10px;padding:2px 0;";const n=document.createElement("div");n.textContent=J.name??`Slot ${J.slotIndex+1}`,n.style.color=J.missingStats?"#ffcc80":"#e0f2f1";const o=document.createElement("div");o.textContent=ls(J.hungerPct),o.style.color=null!=J.hungerPct&&J.hungerPct<e.minActiveHungerPct?"#ff8a80":"#b2dfdb";const r=document.createElement("div");r.textContent=`${J.perHourReduction.toFixed(1)} min/hr`,r.style.color="#aed581";const a=document.createElement("div");a.style.color=J.missingStats?"#ffcc80":"#c5cae9";const s=ps({species:J.species,slotIndex:J.slotIndex},"xp",J.xp,e=>null!=e?`${Math.round(e/1e3)}k xp`:"‚Äî");a.appendChild(s),t.append(n,o,r,a),K.appendChild(t)}else K.appendChild(y("Timer disabled."))}function ks(e){_a.push(e),null==Wa&&(Wa=window.setInterval(Ps,1e3)),Ps()}function Ps(){if(!_a.length)return;const e=!!As.autoShop?.enabled,t=Date.now();for(const n of _a){const o=[];n.summaryEl.style.color=e?"#ccc":"#777";for(const r of ns){const a=n.values[r.key];if(!a)continue;const s=a.parentElement;if(s&&(s.style.opacity=e?"1":"0.6"),!e){a.textContent="off",a.style.color="#777",o.push(`${r.icon} off`);continue}const i=Oa?.nextRestockAt?.[r.key]??null;if(!i){a.textContent="...",a.style.color="#aaa",o.push(`${r.icon} ...`);continue}const l=i-t;if(l<=1e3)a.textContent="now",a.style.color="#4CAF50",o.push(`${r.icon} now`);else{const e=as(l);a.textContent=e,a.style.color=l<=1e4?"#FFEB3B":"#ddd",o.push(`${r.icon} ${e}`)}}0===o.length?n.summaryEl.textContent=e?"No shops tracked":"Shop tracking disabled":n.summaryEl.textContent=o.join(" | ")}}function Ms(){const{root:e,body:t}=$s("üå¶Ô∏è Weather Tracking",{collapsible:!0,startCollapsed:!0});e.dataset.qpmSection="weather";const n=document.createElement("div");return n.className="qpm-section-muted",n.textContent="Weather tracking is available in the Mutation Tracker for identifying optimal harvesting times.",n.style.padding="8px 0",t.appendChild(n),e}let Es=!1;function $s(e,t={}){const n=document.createElement("div");n.className="qpm-card",n.style.display="flex",n.style.flexDirection="column",n.style.gap="10px";const o=document.createElement("div");o.className="qpm-card__header",t.collapsible&&(o.style.cursor="pointer");const r=document.createElement("div");r.className="qpm-card__title",r.textContent=e,o.appendChild(r);const a=[];let s=null;t.subtitleElement?(s=t.subtitleElement,a.push(s)):t.subtitle&&(s=document.createElement("span"),s.className="qpm-section-muted",s.textContent=t.subtitle,a.push(s)),Array.isArray(t.headerActions)&&t.headerActions.length>0&&a.push(...t.headerActions);let i=null;if(t.collapsible&&(i=document.createElement("span"),i.className="qpm-section-muted",i.textContent=t.startCollapsed?"‚ñ≤":"‚ñº",a.push(i)),a.length>0){const e=document.createElement("div");e.className="qpm-row",e.style.justifyContent="flex-end",e.style.gap="6px",e.style.flexWrap="nowrap";for(const t of a)e.appendChild(t);o.appendChild(e)}n.appendChild(o);const l=document.createElement("div");if(l.style.display=t.startCollapsed?"none":"flex",l.style.flexDirection="column",l.style.gap="10px",n.appendChild(l),t.collapsible){let e=!!t.startCollapsed;const n=t=>{e=t,l.style.display=e?"none":"flex",i&&(i.textContent=e?"‚ñ≤":"‚ñº")};n(e),o.addEventListener("click",()=>{n(!e)})}return{root:n,header:o,body:l,indicator:i,subtitleEl:s}}let As={};function Is(){if(function(){if(Es)return;const e=document.createElement("style");e.id="qpm-panel-styles",e.textContent=":root {\n    --qpm-surface-1: rgba(18, 21, 32, 0.95);\n    --qpm-surface-2: rgba(32, 36, 52, 0.9);\n    --qpm-surface-3: rgba(52, 58, 78, 0.85);\n    --qpm-border: rgba(120, 130, 170, 0.28);\n    --qpm-text: #eef0ff;\n    --qpm-text-muted: #97a0c0;\n    --qpm-accent: #8f82ff;\n    --qpm-accent-strong: #b39cff;\n    --qpm-positive: #4fd18b;\n    --qpm-danger: #ff6f91;\n    --qpm-warning: #ffb347;\n    --qpm-shadow: 0 14px 32px rgba(15, 17, 28, 0.55);\n    --qpm-divider: rgba(120, 130, 170, 0.2);\n    --qpm-font: 'Inter', 'Segoe UI', Arial, sans-serif;\n  }\n\n  .qpm-panel {\n    position: fixed;\n    right: 16px;\n    bottom: 16px;\n    z-index: 2147483647;\n    background: var(--qpm-surface-1);\n    color: var(--qpm-text);\n    padding: 0;\n    border-radius: 14px;\n    font: 12px/1.55 var(--qpm-font);\n    box-shadow: var(--qpm-shadow);\n    min-width: 360px;\n    max-width: 430px;\n    max-height: calc(100vh - 32px);\n    overflow: hidden;\n    backdrop-filter: blur(18px);\n    border: 1px solid var(--qpm-border);\n  }\n\n  .qpm-panel__titlebar {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 12px 16px;\n    font-size: 15px;\n    font-weight: 600;\n    background: linear-gradient(135deg, rgba(143, 130, 255, 0.28), rgba(32, 36, 52, 0.85));\n    cursor: move;\n    user-select: none;\n  }\n\n  .qpm-panel__titlebar button {\n    background: rgba(255, 255, 255, 0.08);\n    border: 1px solid rgba(255, 255, 255, 0.18);\n    color: var(--qpm-text-muted);\n    border-radius: 18px;\n    font-size: 11px;\n    padding: 4px 10px;\n    cursor: pointer;\n    transition: background 0.2s ease, color 0.2s ease;\n  }\n\n  .qpm-panel__titlebar button:hover {\n    background: rgba(255, 255, 255, 0.16);\n    color: var(--qpm-text);\n  }\n\n  .qpm-content {\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n    padding: 12px 16px 16px;\n    overflow-y: auto;\n    overflow-x: hidden;\n    max-height: calc(100vh - 120px);\n  }\n\n  .qpm-nav {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 8px;\n    margin-bottom: 6px;\n  }\n\n  .qpm-nav__button {\n    flex: 1 1 calc(33% - 8px);\n    min-width: 120px;\n    border: 1px solid var(--qpm-border);\n    background: rgba(255, 255, 255, 0.04);\n    color: var(--qpm-text-muted);\n    border-radius: 10px;\n    padding: 8px 10px;\n    font-size: 12px;\n    font-weight: 600;\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    cursor: pointer;\n    transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;\n  }\n\n  .qpm-nav__button:hover {\n    border-color: var(--qpm-accent-strong);\n    color: var(--qpm-text);\n  }\n\n  .qpm-nav__button--active {\n    background: rgba(143, 130, 255, 0.22);\n    border-color: var(--qpm-accent);\n    color: var(--qpm-text);\n    box-shadow: 0 6px 18px rgba(143, 130, 255, 0.24);\n  }\n\n  .qpm-tabs {\n    position: relative;\n  }\n\n  .qpm-tab {\n    display: none;\n    flex-direction: column;\n    gap: 12px;\n  }\n\n  .qpm-tab--active {\n    display: flex;\n  }\n\n  .qpm-card {\n    background: var(--qpm-surface-2);\n    border: 1px solid var(--qpm-border);\n    border-radius: 12px;\n    padding: 12px 14px;\n    box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.03);\n  }\n\n  .qpm-table {\n    width: 100%;\n    border-collapse: collapse;\n  }\n\n  .qpm-table thead {\n    background: rgba(255, 255, 255, 0.05);\n    text-transform: uppercase;\n    letter-spacing: 0.3px;\n    font-size: 9px;\n    color: var(--qpm-text-muted);\n  }\n\n  .qpm-table th,\n  .qpm-table td {\n    padding: 6px 8px;\n    text-align: left;\n    border-bottom: 1px solid rgba(255, 255, 255, 0.04);\n  }\n\n  .qpm-table tbody tr:nth-child(odd) {\n    background: rgba(255, 255, 255, 0.02);\n  }\n\n  .qpm-table--compact th,\n  .qpm-table--compact td {\n    font-size: 10px;\n  }\n\n  .qpm-ability-divider td {\n    border-top: 1px solid rgba(255, 255, 255, 0.08);\n  }\n\n  .qpm-ability-section td {\n    background: rgba(255, 255, 255, 0.04);\n    font-weight: 600;\n    font-size: 11px;\n    color: var(--qpm-text);\n    padding: 7px 8px;\n    border-top: 1px solid rgba(255, 255, 255, 0.08);\n  }\n\n  .qpm-ability-section__content {\n    display: flex;\n    align-items: baseline;\n    justify-content: space-between;\n    gap: 12px;\n    flex-wrap: wrap;\n  }\n\n  .qpm-ability-section__title {\n    font-weight: 600;\n  }\n\n  .qpm-ability-section__meta {\n    font-weight: 400;\n    font-size: 10px;\n    color: var(--qpm-text-muted);\n  }\n\n  .qpm-ability-total {\n    font-weight: 600;\n    background: rgba(255, 255, 255, 0.03);\n  }\n\n  .qpm-ability-total td {\n    border-top: 1px solid rgba(255, 255, 255, 0.08);\n  }\n\n  .qpm-tracker-summary {\n    font-size: 11px;\n    color: var(--qpm-text-muted);\n    line-height: 1.5;\n  }\n\n  .qpm-mutation-meta {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    gap: 8px;\n    flex-wrap: wrap;\n    font-size: 11px;\n  }\n\n  .qpm-mutation-meta__group {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    flex-wrap: wrap;\n  }\n\n  .qpm-mutation-source {\n    font-size: 10px;\n    color: var(--qpm-text-muted);\n    background: rgba(255, 255, 255, 0.06);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: 999px;\n    padding: 2px 8px;\n  }\n\n  .qpm-mutation-countdown {\n    font-size: 11px;\n    color: var(--qpm-text-muted);\n    margin-top: 4px;\n  }\n\n  .qpm-mutation-countdown[data-state='active'] {\n    color: #b3ffe0;\n  }\n\n  .qpm-mutation-countdown[data-state='expired'] {\n    color: #ffcc80;\n  }\n\n  .qpm-mutation-totals {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 6px;\n    margin-top: 8px;\n  }\n\n  .qpm-mutation-chip {\n    background: rgba(255, 255, 255, 0.05);\n    border: 1px solid rgba(255, 255, 255, 0.08);\n    border-radius: 10px;\n    padding: 6px 10px;\n    min-width: 130px;\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n  }\n\n  .qpm-mutation-chip--active {\n    border-color: rgba(143, 130, 255, 0.5);\n    box-shadow: 0 0 0 1px rgba(143, 130, 255, 0.3);\n  }\n\n  .qpm-mutation-chip__label {\n    font-size: 11px;\n    font-weight: 600;\n    color: var(--qpm-text);\n  }\n\n  .qpm-mutation-chip__meta {\n    font-size: 10px;\n    color: var(--qpm-text-muted);\n  }\n\n  .qpm-mutation-detail {\n    margin-top: 8px;\n  }\n\n  .qpm-tracker-note {\n    font-size: 10px;\n    color: #90caf9;\n    background: rgba(144, 202, 249, 0.08);\n    border: 1px dashed rgba(144, 202, 249, 0.4);\n    border-radius: 8px;\n    padding: 8px;\n  }\n\n  .qpm-card__header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    margin-bottom: 6px;\n  }\n\n  .qpm-card__title {\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--qpm-text);\n    display: flex;\n    align-items: center;\n    gap: 6px;\n  }\n\n  .qpm-section-muted {\n    color: var(--qpm-text-muted);\n    font-size: 11px;\n  }\n\n  .qpm-button {\n    padding: 6px 10px;\n    font-size: 12px;\n    cursor: pointer;\n    border: 1px solid var(--qpm-border);\n    border-radius: 10px;\n    background: rgba(255, 255, 255, 0.06);\n    color: var(--qpm-text);\n    transition: background 0.2s ease, border-color 0.2s ease;\n  }\n\n  .qpm-button:hover:not(:disabled) {\n    background: rgba(255, 255, 255, 0.12);\n    border-color: var(--qpm-accent);\n  }\n\n  .qpm-button:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n  }\n\n  .qpm-button--accent {\n    background: rgba(143, 130, 255, 0.24);\n    border-color: var(--qpm-accent);\n  }\n\n  .qpm-button--positive {\n    background: rgba(79, 209, 139, 0.28);\n    border-color: rgba(79, 209, 139, 0.6);\n  }\n\n  .qpm-grid {\n    display: grid;\n    gap: 10px;\n  }\n\n  .qpm-grid--two {\n    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\n  }\n\n  .qpm-row {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    flex-wrap: wrap;\n  }\n\n  .qpm-input,\n  .qpm-select {\n    padding: 4px 8px;\n    border: 1px solid var(--qpm-border);\n    border-radius: 8px;\n    background: rgba(20, 24, 36, 0.65);\n    color: var(--qpm-text);\n    font-size: 11px;\n    transition: border-color 0.2s ease, box-shadow 0.2s ease;\n  }\n\n  .qpm-input:focus,\n  .qpm-select:focus {\n    outline: none;\n    border-color: var(--qpm-accent);\n    box-shadow: 0 0 0 2px rgba(143, 130, 255, 0.18);\n  }\n\n  .qpm-checkbox {\n    accent-color: var(--qpm-accent);\n  }\n\n  .qpm-coming-grid {\n    display: grid;\n    gap: 10px;\n    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));\n  }\n\n  .qpm-coming-card {\n    background: var(--qpm-surface-3);\n    border: 1px dashed rgba(143, 130, 255, 0.35);\n    border-radius: 10px;\n    padding: 10px;\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n    color: var(--qpm-text-muted);\n  }\n\n  .qpm-coming-card strong {\n    color: var(--qpm-text);\n    font-size: 12px;\n  }\n\n  .qpm-coming-card span {\n    color: var(--qpm-accent-strong);\n    font-size: 11px;\n    font-weight: 600;\n  }\n\n  .qpm-chip {\n    display: inline-flex;\n    align-items: center;\n    gap: 4px;\n    padding: 2px 6px;\n    border-radius: 999px;\n    font-size: 10px;\n    background: rgba(143, 130, 255, 0.22);\n    color: var(--qpm-text);\n    border: 1px solid rgba(143, 130, 255, 0.35);\n  }\n\n  .qpm-toast {\n    position: fixed;\n    bottom: 24px;\n    right: 24px;\n    background: rgba(20, 26, 40, 0.92);\n    border: 1px solid rgba(143, 130, 255, 0.35);\n    color: var(--qpm-text);\n    padding: 10px 14px;\n    border-radius: 12px;\n    font-size: 12px;\n    z-index: 2147483647;\n    box-shadow: 0 10px 26px rgba(12, 16, 28, 0.55);\n    animation: qpm-toast-in 0.25s ease;\n  }\n\n  @keyframes qpm-toast-in {\n    from { opacity: 0; transform: translateY(12px); }\n    to { opacity: 1; transform: translateY(0); }\n  }\n\n  /* Custom scrollbar for main panel content */\n  .qpm-content::-webkit-scrollbar {\n    width: 8px;\n  }\n  .qpm-content::-webkit-scrollbar-track {\n    background: rgba(0, 0, 0, 0.2);\n    border-radius: 4px;\n  }\n  .qpm-content::-webkit-scrollbar-thumb {\n    background: rgba(143, 130, 255, 0.35);\n    border-radius: 4px;\n    transition: background 0.2s;\n  }\n  .qpm-content::-webkit-scrollbar-thumb:hover {\n    background: rgba(143, 130, 255, 0.55);\n  }\n  ",document.head.appendChild(e),Es=!0}(),Ha.panel)return Ha.panel;const e=document.createElement("div");e.className="qpm-panel";const t=document.createElement("div");t.className="qpm-panel__titlebar",t.title="Drag to move ‚Ä¢ Click to collapse";const n=document.createElement("span");n.textContent="üçñ Quinoa Pet Manager";const o=document.createElement("button");o.type="button",o.dataset.qpmCollapseButton="true",o.className="qpm-button",o.setAttribute("aria-label","Collapse panel");const r=document.createElement("span");r.textContent="‚ñº",o.appendChild(r),t.append(n,o);const a=document.createElement("div");a.className="qpm-content";const s=document.createElement("div");s.className="qpm-nav";const c=document.createElement("div");c.className="qpm-tabs",a.append(s,c),e.append(t,a);const u=ve(),p=!1!==u.syncModeEnabled,m=As.inventoryLocker?.syncMode,f="boolean"==typeof m?m:p;let g=!1;As.inventoryLocker?As.inventoryLocker.syncMode!==f&&(As.inventoryLocker.syncMode=f,g=!0):(As.inventoryLocker={syncMode:f},g=!0),g&&ri(),u.syncModeEnabled!==f&&Ce(f),function(){const e=document.createElement("div");e.className="qpm-card",e.dataset.qpmSection="header",e.style.cssText="background: linear-gradient(135deg, rgba(143,130,255,0.08), rgba(143,130,255,0.03)); border: 1px solid rgba(143,130,255,0.15);";const t=document.createElement("div");t.className="qpm-card__header";const n=document.createElement("div");n.className="qpm-card__title",n.textContent="Session Overview",n.style.cssText="font-size: 14px; font-weight: 700; letter-spacing: 0.3px;";const o=ti("‚ôª Reset Stats",Rs);o.classList.add("qpm-button--accent"),o.style.fontSize="11px",o.title="Reset header and detailed stats counters",t.append(n,o),e.appendChild(t);const r=document.createElement("div");r.className="qpm-grid qpm-grid--two",e.appendChild(r);const a=qs(r,"üçñ Auto Feed"),s=qs(r,"‚òÄÔ∏è Weather"),i=qs(r,"üõí Shop"),l=document.createElement("div");l.className="qpm-section-muted",l.style.cssText="margin-top: 8px; font-size: 10px; color: #a0a8c0;",e.appendChild(l),Ha.headerContainer=e,Ha.headerAutoFeed=a,Ha.headerWeather=s,Ha.headerShop=i,Ha.headerMeta=l,null!=Ha.headerTimer&&(window.clearInterval(Ha.headerTimer),Ha.headerTimer=null);Ns(),Ha.headerTimer=window.setInterval(Ns,1500);const c=document.createElement("div");c.style.cssText="height:1px;background:rgba(143,130,255,0.15);margin:12px 0;",e.appendChild(c);const u=document.createElement("div");u.style.cssText="display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:10px;margin-top:10px;",e.appendChild(u);const d=Fs("üçñ","Pet Hunger","rgba(255,152,0,0.15)"),p=document.createElement("div");p.style.cssText="display:flex;flex-direction:column;gap:3px;font-size:11px;color:#e0e0e0;",d.appendChild(p);const m=document.createElement("div");m.style.cssText="font-size:10px;color:#999;margin-top:2px;display:none;",d.appendChild(m);const f=document.createElement("div");f.style.cssText="font-size:10px;color:#81c784;margin-top:4px;font-family:monospace;",d.appendChild(f);const g=()=>{try{const e={uptime:"0s",feedsPerHour:"0.00",feedSampleCount:0,feedWindowMinutes:0,feedRateSource:"none",modelPetSamples:0},t=Number(e.feedsPerHour);if(!Number.isFinite(t)||t<=0)return void(f.style.display="none");let n;n="events"===e.feedRateSource?`${e.feedSampleCount} feeds/${e.feedWindowMinutes}m`:"model"===e.feedRateSource?`est. √ó${e.modelPetSamples}`:"est.",f.textContent=`${t.toFixed(1)} feeds/hr ‚Ä¢ ${n}`,f.style.display="block"}catch{f.style.display="none"}};setInterval(g,5e3),g(),Ha.dashboardFeedList=p,Ha.dashboardFeedMeta=m,function(){const e=Ha.dashboardFeedList,t=Ha.dashboardFeedMeta;if(!e||!t)return;const n="Waiting for feed data...".trim();if(e.textContent="",t.textContent="",t.style.display="none",!n){const t=document.createElement("div");return t.textContent="Waiting for feed data...",t.style.cssText="font-size:11px;color:var(--qpm-text-muted)",void e.appendChild(t)}const o=n.split("|").map(e=>e.trim()).filter(Boolean),r=o.filter(e=>!/^(Waiting|No pets|Feed tracking disabled)/i.test(e)),a=o.filter(e=>/^(Waiting|No pets|Feed tracking disabled)/i.test(e));if(0===r.length){const t=document.createElement("div");return t.textContent=n,t.style.cssText="font-size:11px;color:var(--qpm-text-muted)",void e.appendChild(t)}r.forEach(t=>{const n=t.match(/^(.+?)\s*:\s*(.+)$/),o=n?.[1]?n[1].trim():t.trim(),r=n?.[2]??"",a=document.createElement("div");a.style.cssText="display:flex;justify-content:space-between;align-items:center;font-size:10px;color:var(--qpm-text);";const s=document.createElement("span");s.textContent=o,s.style.cssText="font-size:10px;";const i=document.createElement("span"),l=r.trim();if(i.textContent=l||"‚Äî",i.style.cssText="font-family:monospace;color:var(--qpm-text);font-size:10px;",/skip/i.test(l))i.style.color="#ffb74d";else{const e=l.match(/(\d+(?:\.\d+)?)/);if(e){const t=Number(e[1]);Number.isFinite(t)&&(i.style.color=t<=40?"#ef5350":t<=70?"#ffca28":"#81c784")}}a.append(s,i),e.appendChild(a)}),a.length>0&&(t.textContent=a.join(" | "),t.style.display="block")}(),u.appendChild(d);const h=Fs("üõí","Restock","rgba(66,165,245,0.15)"),b=document.createElement("div");b.style.cssText="font-size:10px;color:#999;display:none;",h.appendChild(b);const y=document.createElement("div");y.style.cssText="display:flex;flex-direction:column;gap:3px;font-size:11px;color:#e0e0e0;",h.appendChild(y);const x={};for(const L of ns){const e=document.createElement("div");e.style.cssText="display:flex;justify-content:space-between;align-items:center;gap:8px;";const t=document.createElement("span");t.textContent=L.icon,t.style.cssText="font-size:11px;";const n=document.createElement("span");n.textContent="...",n.style.cssText="font-family:monospace;color:#999;font-size:10px;",e.append(t,n),y.appendChild(e),x[L.key]=n}Ha.dashboardRestockSummary=b,Ha.dashboardRestockValues={seeds:x.seeds??null,eggs:x.eggs??null,tools:x.tools??null,decor:x.decor??null},ks({summaryEl:b,values:x}),Ps(),u.appendChild(h);const w=vs(),v=Fs("üê¢","Bella's Turtle Temple","rgba(0,150,136,0.15)"),C=v.querySelector(".indicator-header"),S=document.createElement("button");S.type="button",S.className="qpm-chip",S.style.cssText="cursor:pointer;user-select:none;font-size:9px;padding:2px 6px;",C.appendChild(S);const T=document.createElement("div");T.style.cssText="display:flex;align-items:center;justify-content:space-between;gap:4px;cursor:pointer;padding:4px 6px;background:rgba(255,255,255,0.04);border-radius:4px;margin:4px 0;transition:background 0.2s;",T.title="Click to select a different plant";const k=document.createElement("div");k.style.cssText="font-size:12px;font-weight:600;color:#e0f2f1;flex:1;",k.textContent="Loading...",T.appendChild(k);const P=document.createElement("span");P.style.cssText="font-size:9px;color:#80cbc4;",P.textContent="‚ñº",T.appendChild(P),v.appendChild(T);const M=document.createElement("select");M.className="qpm-select",M.style.cssText="display:none;width:100%;padding:4px 6px;font-size:10px;background:rgba(0,0,0,0.3);border:1px solid rgba(0,150,136,0.3);border-radius:4px;color:#e0e0e0;margin-bottom:6px;",v.appendChild(M);const E=document.createElement("option");E.value="",E.textContent="Select a plant...",E.disabled=!0,M.appendChild(E),T.addEventListener("click",e=>{e.stopPropagation();const t="none"===M.style.display;M.style.display=t?"block":"none",P.textContent=t?"‚ñ≤":"‚ñº",t&&$()}),T.addEventListener("mouseenter",()=>{T.style.background="rgba(255,255,255,0.08)"}),T.addEventListener("mouseleave",()=>{T.style.background="rgba(255,255,255,0.04)"}),M.addEventListener("change",()=>{const e=M.value;if(e){const{tileId:t,slotIndex:n}=rs(e);As.turtleTimer={...vs(),focus:"specific",focusTargetTileId:t,focusTargetSlotIndex:n},ri(),zo({focus:"specific",focusTargetTileId:t,focusTargetSlotIndex:n}),M.style.display="none",P.textContent="‚ñº"}});const $=()=>{const e=Bo();for(;M.options.length>1;)M.remove(1);for(const t of e.plantTargets){const e=document.createElement("option");e.value=t.key;const n=t.species??"Unknown",o=null!=t.remainingMs?ss(t.remainingMs):"Ready";e.textContent=`${n} - ${o}`,M.appendChild(e)}},A=document.createElement("div");A.style.cssText="font-size:11px;color:#e0f2f1;font-weight:500;margin-bottom:2px;",v.appendChild(A);const I=document.createElement("div");I.style.cssText="font-size:10px;color:#b2dfdb;line-height:1.4;",v.appendChild(I);const F=document.createElement("div");F.style.cssText="font-size:9px;color:#80cbc4;margin-top:4px;",v.appendChild(F);const q=document.createElement("label");q.style.cssText="display:flex;align-items:center;gap:4px;font-size:9px;color:#80cbc4;cursor:pointer;margin-top:6px;";const N=document.createElement("input");N.type="checkbox",N.className="qpm-checkbox",N.checked=w.includeBoardwalk;const z=document.createElement("span");z.textContent="Include boardwalk tiles",q.append(N,z),v.appendChild(q),S.addEventListener("click",()=>{const e=!(As.turtleTimer?.enabled??1);As.turtleTimer={...vs(),enabled:e},ri(),Lo(e)}),N.addEventListener("change",()=>{const e=N.checked;As.turtleTimer={...vs(),includeBoardwalk:e},ri(),zo({includeBoardwalk:e})}),Ha.turtleStatus=A,Ha.turtleDetail=I,Ha.turtleFooter=F,Ha.turtleEnableButtons.push(S),Ha.turtleBoardwalkToggles.push(N),Ha.turtlePlantNameText=k,Ha.turtleUnsubscribe&&Ha.turtleUnsubscribe();Ha.turtleUnsubscribe=jo(e=>{Ts(e)}),u.appendChild(v)}(),function(){Ya&&(Ya(),Ya=null);const e=document.createElement("div");e.className="qpm-card",e.dataset.qpmSection="stats",e.style.cssText="background: linear-gradient(135deg, rgba(100,181,246,0.08), rgba(100,181,246,0.03)); border: 1px solid rgba(100,181,246,0.15);";const t=document.createElement("div");t.className="qpm-card__header",t.style.cssText="cursor: pointer; padding: 12px 14px; border-radius: 8px; transition: all 0.2s ease; user-select: none;";const n=document.createElement("div");n.className="qpm-card__title",n.textContent="üìä Detailed Stats",n.style.cssText="font-size: 14px; font-weight: 700; letter-spacing: 0.3px; color: #64b5f6;";const o=document.createElement("span");o.style.cssText="font-size: 14px; color: #64b5f6; transition: transform 0.2s ease;",o.textContent="‚ñº";const r=document.createElement("span");r.style.cssText="font-size: 10px; color: #90a4ae; margin-left: 8px; font-weight: 400;",r.textContent="(click to expand)",t.append(n,o,r);const a=document.createElement("div");a.style.cssText="display:block;margin-top:12px;font-size:11px;color:#dbe1ff;line-height:1.6;",t.addEventListener("click",()=>{const e="none"===a.style.display;a.style.display=e?"block":"none",o.textContent=e?"‚ñº":"‚ñ≤",o.style.transform=e?"rotate(0deg)":"rotate(180deg)",r.textContent=e?"(click to expand)":"(click to collapse)",t.style.background=e?"transparent":"rgba(100,181,246,0.08)"}),t.addEventListener("mouseenter",()=>{"none"===a.style.display&&(t.style.background="rgba(100,181,246,0.05)")}),t.addEventListener("mouseleave",()=>{"none"===a.style.display&&(t.style.background="transparent")});const s=document.createElement("div");s.textContent="üçñ Auto Feed",s.style.cssText="font-weight:700;color:#ffcc80;font-size:12px;margin-bottom:4px;text-transform:uppercase;letter-spacing:0.5px;margin-top:4px;";const i=document.createElement("div");i.style.cssText="color:#f0f0f0;margin-bottom:3px;font-size:11px;line-height:1.5;";const c=document.createElement("div");c.style.cssText="color:#c0c0c0;font-size:10px;margin-bottom:10px;line-height:1.5;";const u=document.createElement("div");u.textContent="‚òÄÔ∏è Weather",u.style.cssText="font-weight:700;color:#80deea;font-size:12px;margin-bottom:4px;text-transform:uppercase;letter-spacing:0.5px;";const d=document.createElement("div");d.style.cssText="color:#f0f0f0;margin-bottom:3px;font-size:11px;line-height:1.5;";const p=document.createElement("div");p.style.cssText="color:#c0c0c0;font-size:10px;margin-bottom:10px;line-height:1.5;";const m=document.createElement("div");m.textContent="üõí Auto Shop",m.style.cssText="font-weight:700;color:#ffab91;font-size:12px;margin-bottom:4px;text-transform:uppercase;letter-spacing:0.5px;";const f=document.createElement("div");f.style.cssText="color:#f0f0f0;margin-bottom:3px;font-size:11px;line-height:1.5;";const g=document.createElement("div");g.style.cssText="color:#c0c0c0;font-size:10px;margin-bottom:8px;line-height:1.5;";const h=document.createElement("div");h.textContent="Recent Purchases",h.style.cssText="font-weight:700;font-size:11px;color:#d0d0d0;margin-top:8px;margin-bottom:4px;letter-spacing:0.5px;text-transform:uppercase;";const b=document.createElement("div");b.style.cssText="display:flex;flex-direction:column;gap:3px;font-size:10px;color:#b0b0b0;line-height:1.5;";const y=document.createElement("div");y.style.cssText="margin-top:14px;display:flex;justify-content:flex-end;padding-top:10px;border-top:1px solid rgba(255,255,255,0.08);";const x=ti("‚ôª Reset Stats",Rs);x.classList.add("qpm-button--accent"),x.style.cssText="font-size:11px;font-weight:600;",y.append(x),a.append(s,i,c,u,d,p,m,f,g,h,b,y),e.append(t,a);Ya=Yr(e=>{const{feed:t,weather:n,shop:o}=e;const r=[];r.push(`${t.totalFeeds} total feeds`);if(t.lastFeedAt){r.push(`last ${l(t.lastFeedAt)}`)}i.textContent=r.join(" ‚Ä¢ ");const a=Object.entries(t.perPet).sort((e,t)=>(t[1]?.count??0)-(e[1]?.count??0)).slice(0,3);if(a.length===0){c.textContent="No feed history yet"}else{const e=a.map(([e,t])=>{const n=t.lastFeedAt?` (${l(t.lastFeedAt)})`:"";return`${e} √ó${t.count}${n}`});c.textContent=e.join(" ‚Ä¢ ")}const s=n.presetUsage.weather.primary+n.presetUsage.noweather.primary;const u=n.presetUsage.weather.alternate+n.presetUsage.noweather.alternate;const m=[];m.push(`Swaps ${n.totalSwaps}`);m.push(`Primary ${s}`);if(u>0)m.push(`Alternate ${u}`);if(n.cooldownBlocks>0)m.push(`Cooldown blocks ${n.cooldownBlocks}`);d.textContent=m.join(" ‚Ä¢ ");const h=Object.entries(n.timeByKind).filter(([,e])=>e>0).sort((e,t)=>(t[1]??0)-(e[1]??0)).slice(0,3).map(([e,t])=>`${zs(e)} ${Ls(t)}`);p.textContent=h.length>0?h.join(" ‚Ä¢ "):"No uptime recorded yet";const y=[];y.push(`Items ${o.totalPurchases}`);if(o.totalSpentCoins>0){y.push(`ü™ô ${ir(o.totalSpentCoins)}`)}if(o.totalSpentCredits>0){y.push(`üç© ${o.totalSpentCredits.toLocaleString()}`)}f.textContent=y.join(" ‚Ä¢ ");const x=Object.entries(o.purchasesByCategory).filter(([,e])=>e>0).sort((e,t)=>(t[1]??0)-(e[1]??0)).map(([e,t])=>`${e}: ${t}`);g.textContent=x.length>0?x.join(" ‚Ä¢ "):"No purchases yet";b.innerHTML="";const w=o.history.slice(-5).reverse();if(w.length===0){const e=document.createElement("div");e.textContent="No recent purchases";b.appendChild(e)}else{for(const e of w){const t=document.createElement("div");const n=[];if(e.coins>0)n.push(`ü™ô ${ir(e.coins)}`);if(e.credits>0)n.push(`üç© ${e.credits.toLocaleString()}`);const o=n.length?` (${n.join(" ‚Ä¢ ")})`:"";t.textContent=`${e.itemName} √ó${e.count}${o} ‚Äî ${l(e.timestamp)}`;b.appendChild(t)}}})}();const h=Bs(),b=function(){Ha.mutationTrackerUnsubscribe&&(Ha.mutationTrackerUnsubscribe(),Ha.mutationTrackerUnsubscribe=null);null!=Ha.mutationTrackerTicker&&(window.clearInterval(Ha.mutationTrackerTicker),Ha.mutationTrackerTicker=null);Ha.trackerAbilityHistoryUnsubscribe&&(Ha.trackerAbilityHistoryUnsubscribe(),Ha.trackerAbilityHistoryUnsubscribe=null);null!=Ha.trackerAbilityTicker&&(window.clearInterval(Ha.trackerAbilityTicker),Ha.trackerAbilityTicker=null);return[]}();!function(){const{root:e,body:t}=$s("üçñ Feed Tracking",{collapsible:!0,startCollapsed:!0});e.dataset.qpmSection="feed-tracking";const n=document.createElement("div");n.className="qpm-section-muted",n.textContent="Feed event tracking is available in the Statistics Dashboard.",n.style.padding="8px 0",t.appendChild(n)}(),Ms(),Ks(),Js();const y=Ys(f),x=Zs();!function(){const e=document.createElement("span");e.className="qpm-chip",e.textContent="Coming Soon!";const{root:t,body:n}=$s("üöß Roadmap & Preview",{subtitleElement:e});t.dataset.qpmSection="roadmap";const o=document.createElement("div");o.className="qpm-section-muted",o.textContent="Sneak peek at the features queued up next. These cards mirror the to-do list so you can track what is planned.",n.appendChild(o);const r=[{title:"Garden Intelligence",items:[{name:"Mutation Strategy Planner",description:"Inventory-aware mutation guidance for multi-harvest plants. Coming Soon!"},{name:"Lunar Event Tracker",description:"Amber/Dawnlit event timing + success history. Coming Soon!"},{name:"Weather Precision Alerts",description:"Correct rain, snow, amber, and dawn detection for reminders. Coming Soon!"},{name:"Garden Value + Decor",description:"Full garden appraisal including decor bonuses. Coming Soon!"},{name:"Mutation Forecast Fixes",description:"No more false moon-event alerts after weather clears. Coming Soon!"}]},{title:"Pet Management",items:[{name:"Advanced Feeding Rules",description:"Per-pet feed preferences and customizable feeding logic. Coming Soon!"},{name:"Pet Hutch Value Dashboard",description:"Surface value and stats from the Pet Hutch atom. Coming Soon!"},{name:"Aries Pet Log Sync",description:"Auto-load presets from Aries mod logs. Coming Soon!"},{name:"Smart Pet Manager",description:"Context-aware pet swapping for weather, crops, and abilities. Coming Soon!"},{name:"Pet Ability Tracker",description:"Proc chance estimates plus unlucky streak timestamps. Coming Soon!"},{name:"Pet Identity Enhancements",description:"Show pet names directly on each card. Coming Soon!"},{name:"Quick Hutch Transfer",description:"Pick-up/store-all controls with smart filters. Coming Soon!"},{name:"Pet Earnings Monitor",description:"Pet preset profit per hour simulations. Coming Soon!"},{name:"Pet Food Estimator",description:"Forecast food usage with turtle boosters. Coming Soon!"}]},{title:"Stats & Notifications",items:[{name:"Unified Notification Center",description:"Consistent styling and filtering across all alerts. Coming Soon!"},{name:"Detailed Performance Stats",description:"Expanded analytics leveraging atom data. Coming Soon!"},{name:"Feeds Per Hour Metrics",description:"Live feeds-per-hour tracking with history. Coming Soon!"},{name:"Shop Purchase Logbook",description:"Auto-buy and manual purchase history in stats. Coming Soon!"},{name:"Turtle Timer Revamp",description:"Rebuild of the turtle timer inspired by MGTools. Coming Soon!"}]},{title:"Advanced Tools",items:[{name:"Selective Crop Seller",description:"Sell the specific crop you are holding via one tap. Coming Soon!"},{name:"Pet Food Farmer",description:"Streamlined planting and harvesting for pet food crops. Coming Soon!"},{name:"Seed Harvester",description:"Tile-aware planting with mutation/size requirements. Coming Soon!"}]},{title:"Quality Assurance",items:[{name:"Respect Rules Reliability",description:"Ensure feed-from-inventory selects the correct food. Coming Soon!"},{name:"Weather Scan Improvements",description:"Reliably detect weather variants for reminders. Coming Soon!"}]}];for(const a of r){const e=document.createElement("div");e.textContent=a.title,e.style.fontWeight="600",e.style.fontSize="12px",e.style.color="var(--qpm-text)",n.appendChild(e);const t=document.createElement("div");t.className="qpm-coming-grid";for(const n of a.items){const e=document.createElement("div");e.className="qpm-coming-card";const o=document.createElement("strong");o.textContent=n.name,e.appendChild(o);const r=document.createElement("span");if(r.textContent="Coming Soon!",e.appendChild(r),n.description){const t=document.createElement("div");t.className="qpm-section-muted",t.textContent=n.description,e.appendChild(t)}t.appendChild(e)}n.appendChild(t)}}();const w=new Map,v=new Map;let C=null;const S=e=>{if(C!==e){C=e;for(const[t,n]of w)n.classList.toggle("qpm-tab--active",t===e);for(const[t,n]of v)n.classList.toggle("qpm-nav__button--active",t===e)}},T=(e,t,n,o)=>{const r=document.createElement("button");r.type="button",r.className="qpm-nav__button",r.innerHTML=`${n}<span>${t}</span>`,r.addEventListener("click",()=>S(e)),s.appendChild(r),v.set(e,r);const a=document.createElement("div");a.className="qpm-tab";for(const s of o)a.appendChild(s);c.appendChild(a),w.set(e,a)};T("dashboard","Dashboard","üìä",[...b]),T("turtle","Turtle Timer","üê¢",[h]),T("trackers","Trackers","üìà",[]),T("xp-tracker","XP Tracker","‚ú®",[]),T("mutation","Mutation Reminder","üß¨",[x]),T("inventory","Inventory Settings","üîí",[y]),T("guide","Guide","üìñ",[Qs()]);const k=v.get("trackers");if(k){const e=k.cloneNode(!0);e.addEventListener("click",()=>{$a("trackers-detail","üìä Ability & Mutation Trackers",Os)}),k.replaceWith(e),v.set("trackers",e)}const P=v.get("xp-tracker");if(P){const e=P.cloneNode(!0);e.addEventListener("click",async()=>{try{const{createXpTrackerWindow:e,showXpTrackerWindow:t,hideXpTrackerWindow:n}=await Promise.resolve().then(()=>zi);Ha.xpTrackerWindow||(Ha.xpTrackerWindow=e());"none"!==Ha.xpTrackerWindow.root.style.display?n(Ha.xpTrackerWindow):t(Ha.xpTrackerWindow)}catch(e){i("‚ö†Ô∏è Failed to toggle XP Tracker window",e)}}),P.replaceWith(e),v.set("xp-tracker",e)}const M=v.get("turtle");if(M){const e=M.cloneNode(!0);e.addEventListener("click",()=>{$a("turtle-timer","üê¢ Bella's Turtle Temple",Us)}),M.replaceWith(e),v.set("turtle",e)}const E=v.get("weather");if(E){const e=E.cloneNode(!0);e.addEventListener("click",()=>{$a("weather-events","üå¶Ô∏è Weather & Events",Xs,"650px","85vh")}),E.replaceWith(e),v.set("weather",e)}const $=v.get("shop");if($){const e=$.cloneNode(!0);e.addEventListener("click",()=>{$a("shop-locker","üõí Shop & Locker",Vs,"650px","85vh")}),$.replaceWith(e),v.set("shop",e)}S("dashboard");const A=(t,n)=>{e.style.left=`${t}px`,e.style.top=`${n}px`,e.style.right="auto",e.style.bottom="auto"},I=d.get(Qa,null);I&&Number.isFinite(I.left)&&Number.isFinite(I.top)&&A(I.left,I.top);const F=t=>{a.style.display=t?"none":"",r.textContent=t?"‚ñ≤":"‚ñº",o.setAttribute("aria-expanded",String(!t)),e.style.overflowY=t?"visible":"auto",d.set(Za,t)};o.addEventListener("pointerdown",e=>{e.stopPropagation()}),o.addEventListener("click",e=>{e.stopPropagation();const t="none"===a.style.display;F(!t)}),F(!!d.get(Za,!1));let q=!1,N=!1,z=null,L=0,R=0,B=!1;const j=(e,t,n)=>Math.min(Math.max(e,t),n),D=t=>{if(!q||z!==t.pointerId)return;const n=e.offsetWidth,o=e.offsetHeight,r=Math.max(8,window.innerWidth-n-8),a=Math.max(8,window.innerHeight-o-8),s=j(t.clientX-L,8,r),i=j(t.clientY-R,8,a),l=e.getBoundingClientRect();!N&&(Math.abs(s-l.left)>2||Math.abs(i-l.top)>2)&&(N=!0),A(s,i)},H=n=>{if(q&&z===n.pointerId){if(q=!1,window.removeEventListener("pointermove",D),window.removeEventListener("pointerup",H),window.removeEventListener("pointercancel",H),e.hasPointerCapture&&e.hasPointerCapture(n.pointerId))e.releasePointerCapture(n.pointerId);else try{e.releasePointerCapture(n.pointerId)}catch{}if(t.style.touchAction="",N){B=!0;const t=e.getBoundingClientRect();d.set(Qa,{left:Math.round(t.left),top:Math.round(t.top)})}z=null,N=!1}};return t.addEventListener("pointerdown",n=>{const o=n.target;if(o&&o.closest("[data-qpm-collapse-button]"))return;if(!n.isPrimary)return;if("mouse"===n.pointerType){if(0!==n.button)return;if(1&~n.buttons)return}window.addEventListener("pointermove",D),window.addEventListener("pointerup",H),window.addEventListener("pointercancel",H),q=!0,N=!1,B=!1,z=n.pointerId;const r=e.getBoundingClientRect();L=n.clientX-r.left,R=n.clientY-r.top,e.setPointerCapture&&e.setPointerCapture(n.pointerId),t.style.touchAction="none",n.preventDefault()}),t.addEventListener("click",()=>{if(B)return void(B=!1);const e="none"===a.style.display;F(!e)}),document.body.appendChild(e),Ha.panel=e,Ha.content=a,e}function Fs(e,t,n){const o=document.createElement("div");o.style.cssText=`padding:8px 10px;border-radius:6px;background:${n};border:1px solid ${n.replace("0.15","0.25")};display:flex;flex-direction:column;gap:4px;`;const r=document.createElement("div");r.className="indicator-header",r.style.cssText="display:flex;align-items:center;justify-content:space-between;gap:6px;margin-bottom:2px;";const a=document.createElement("div");return a.style.cssText="font-size:11px;font-weight:600;color:#b0b0b0;letter-spacing:0.3px;",a.textContent=`${e} ${t}`,r.appendChild(a),o.appendChild(r),o}function qs(e,t){const n=document.createElement("div");n.style.cssText="flex:1;min-width:120px;background:rgba(143,130,255,0.08);border:1px solid rgba(143,130,255,0.25);border-radius:10px;padding:8px 10px;display:flex;flex-direction:column;gap:4px";const o=document.createElement("div");o.style.cssText="font-size:10px;color:var(--qpm-text-muted);text-transform:uppercase;letter-spacing:0.4px",o.textContent=t;const r=document.createElement("div");return r.style.cssText="font-size:12px;color:var(--qpm-text);line-height:1.25;font-weight:600;word-break:break-word",r.textContent="‚Äî",n.append(o,r),e.appendChild(n),r}function Ns(){if(!Ha.headerAutoFeed||!Ha.headerWeather||!Ha.headerShop)return;let e=Ga,t=null;try{t={uptime:"0s",feedsPerHour:"0.00",feedSampleCount:0,feedWindowMinutes:0,feedRateSource:"none",modelPetSamples:0}}catch{}const n=[];if(n.push("Off"),n.push(`${e} feeds`),t){const e=Number(t.feedsPerHour);if(Number.isFinite(e)){const o="events"===t.feedRateSource?"events":"model"===t.feedRateSource?"est.":"est";n.push(`${e.toFixed(1)}/h ${o}`)}}Ha.headerAutoFeed.textContent=n.join(" ‚Ä¢ ");let o="Unknown",r="never";const a=[];try{o=zs(Fr().kind),a.push(o,r,"‚Äî")}catch{a.push(o,r,"‚Äî")}0===a.length&&a.push(o,r,"‚Äî"),Ha.headerWeather.textContent=a.join(" ‚Ä¢ ");let s=Ua,i=0;try{const e={totalPurchasedCount:0,totalSpent:0,purchasesByCategory:{seeds:0,eggs:0,tools:0,decor:0}};"number"==typeof e.totalPurchasedCount&&(s=e.totalPurchasedCount),"number"==typeof e.totalSpent&&(i=e.totalSpent)}catch{}const l=[`${s} items`,`ü™ô ${ir(Math.max(0,Math.round(i)))}`];if(Ha.headerShop.textContent=l.join(" ‚Ä¢ "),Ha.headerMeta){const e=[];t?.uptime&&e.push(`‚è±Ô∏è ${t.uptime}`);const n=(Va||Ha.harvestStatus?.textContent||"").trim();if(n)e.push(`üåæ ${n}`);else try{const t=Lr(),n=t?.readyCount??0;e.push(`üåæ Matches ready: ${n}`)}catch{e.push("üåæ Waiting for sunny weather...")}Ha.headerMeta.textContent=e.join(" ‚Ä¢ ")}}function zs(e){return e?e.split(/[_\s]+/).filter(Boolean).map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):"Unknown"}function Ls(e){const t=Math.max(0,Math.floor(e)),n=Math.floor(t/1e3),o=Math.floor(n/3600),r=Math.floor(n%3600/60),a=n%60;return o>0?`${o}h ${r}m`:r>0?`${r}m ${a.toString().padStart(2,"0")}s`:`${a}s`}function Rs(){!function(){Or();const e=Date.now();Br=Wr(e);const t=Fr();Br.weather.activeKind=t.kind??"unknown",Br.weather.lastSnapshotAt=t.timestamp,Hr=e,Gr(),Ur()}(),Ga=0,Ua=0,Va="",Ns(),ei("Stats reset")}function Bs(){const{root:e,body:t}=$s("üê¢ Bella's Turtle Temple",{subtitle:"Growth, eggs, and support breakdown"});e.dataset.qpmSection="turtle-timer";const n=vs(),o=document.createElement("div");o.style.cssText="display:flex;flex-wrap:wrap;gap:10px;align-items:center;";const r=document.createElement("button");r.type="button",r.className="qpm-chip",r.style.cssText="cursor:pointer;user-select:none;min-width:84px;text-align:center;",r.addEventListener("click",()=>{const e=!(As.turtleTimer?.enabled??1);As.turtleTimer={...vs(),enabled:e},ri(),Lo(e)}),o.appendChild(r),Ha.turtleEnableButtons.push(r);const a=document.createElement("label");a.style.cssText="display:inline-flex;align-items:center;gap:6px;font-size:11px;color:#b2dfdb;";const s=document.createElement("input");s.type="checkbox",s.className="qpm-checkbox",s.checked=n.includeBoardwalk,s.addEventListener("change",()=>{const e=s.checked;As.turtleTimer={...vs(),includeBoardwalk:e},ri(),zo({includeBoardwalk:e})});const i=document.createElement("span");i.textContent="Include boardwalk tiles",a.append(s,i),o.appendChild(a),Ha.turtleBoardwalkToggles.push(s);const l=document.createElement("label");l.style.cssText="display:inline-flex;align-items:center;gap:6px;font-size:11px;color:#b2dfdb;";const c=document.createElement("select");c.className="qpm-select",c.style.cssText="min-width:120px;padding:4px 8px;font-size:11px;",c.addEventListener("click",e=>e.stopPropagation());const u=document.createElement("option");u.value="latest",u.textContent="Latest finish";const d=document.createElement("option");d.value="earliest",d.textContent="Earliest finish";const p=document.createElement("option");p.value="specific",p.textContent="Specific plant",c.append(u,d,p),c.value=n.focus;const m=document.createElement("label");m.style.cssText="display:inline-flex;align-items:center;gap:6px;font-size:11px;color:#b2dfdb;",m.style.display="specific"===n.focus?"inline-flex":"none";const f=document.createElement("select");f.className="qpm-select",f.style.cssText="min-width:180px;padding:4px 8px;font-size:11px;",f.addEventListener("click",e=>e.stopPropagation()),c.addEventListener("change",()=>{const e=c.value,t="earliest"===e?"earliest":"specific"===e?"specific":"latest",n={...vs(),focus:t};As.turtleTimer=n,ri();const o={focus:t};"specific"===t&&(o.focusTargetTileId=n.focusTargetTileId,o.focusTargetSlotIndex=n.focusTargetSlotIndex),zo(o),m.style.display="specific"===t?"inline-flex":"none"});const g=document.createElement("span");g.textContent="Focus",l.append(g,c),o.appendChild(l),Ha.turtleFocusSelects.push(c);const h=document.createElement("span");h.textContent="Target plant",m.append(h,f),o.appendChild(m),Ha.turtleFocusTargetContainers.push(m),Ha.turtleFocusTargetSelects.push(f),f.addEventListener("change",()=>{const{tileId:e,slotIndex:t}=rs(f.value),n={...vs(),focus:"specific",focusTargetTileId:e,focusTargetSlotIndex:t};As.turtleTimer=n,ri(),zo({focus:"specific",focusTargetTileId:e,focusTargetSlotIndex:t})});const b=document.createElement("label");b.style.cssText="display:inline-flex;align-items:center;gap:6px;font-size:11px;color:#bda7f5;";const y=document.createElement("select");y.className="qpm-select",y.style.cssText="min-width:120px;padding:4px 8px;font-size:11px;",y.addEventListener("click",e=>e.stopPropagation());const x=document.createElement("option");x.value="latest",x.textContent="Latest hatch";const w=document.createElement("option");w.value="earliest",w.textContent="Earliest hatch";const v=document.createElement("option");v.value="specific",v.textContent="Specific egg",y.append(x,w,v),y.value=n.eggFocus;const C=document.createElement("label");C.style.cssText="display:inline-flex;align-items:center;gap:6px;font-size:11px;color:#bda7f5;",C.style.display="specific"===n.eggFocus?"inline-flex":"none";const S=document.createElement("select");S.className="qpm-select",S.style.cssText="min-width:180px;padding:4px 8px;font-size:11px;",S.addEventListener("click",e=>e.stopPropagation()),y.addEventListener("change",()=>{const e=y.value,t="earliest"===e?"earliest":"specific"===e?"specific":"latest",n={...vs(),eggFocus:t};As.turtleTimer=n,ri();const o={eggFocus:t};"specific"===t&&(o.eggFocusTargetTileId=n.eggFocusTargetTileId,o.eggFocusTargetSlotIndex=n.eggFocusTargetSlotIndex),zo(o),C.style.display="specific"===t?"inline-flex":"none"});const T=document.createElement("span");T.textContent="Egg focus",b.append(T,y),o.appendChild(b),Ha.turtleEggFocusSelects.push(y);const k=document.createElement("span");k.textContent="Target egg",C.append(k,S),o.appendChild(C),Ha.turtleEggFocusTargetContainers.push(C),Ha.turtleEggFocusTargetSelects.push(S),S.addEventListener("change",()=>{const{tileId:e,slotIndex:t}=rs(S.value),n={...vs(),eggFocus:"specific",eggFocusTargetTileId:e,eggFocusTargetSlotIndex:t};As.turtleTimer=n,ri(),zo({eggFocus:"specific",eggFocusTargetTileId:e,eggFocusTargetSlotIndex:t})}),t.appendChild(o);const P=document.createElement("div");P.style.cssText="font-size:10px;color:#9acccc;line-height:1.4;",P.textContent="Change your target plant's with Focus to display the estimated time to mature. The Egg Hatching section displays info on egg maturing. The Food Turtles section displays food drain and restore info.",t.appendChild(P);const M=(e,t)=>{const n=document.createElement("div");n.style.cssText=`padding:10px;border-radius:10px;border:1px solid ${t};background:rgba(10,20,20,0.35);display:flex;flex-direction:column;gap:6px;`;const o=document.createElement("div");o.style.cssText="display:flex;justify-content:space-between;align-items:center;gap:8px;";const r=document.createElement("div");r.style.cssText="font-weight:600;font-size:12px;color:#e0f7fa;",r.textContent=e;const a=document.createElement("div");a.style.cssText="font-size:11px;color:#c5e1a5;",o.append(r,a),n.appendChild(o);const s=document.createElement("div");s.style.cssText="font-size:11px;color:#dcedc8;",n.appendChild(s);const i=document.createElement("div");i.style.cssText="font-size:10px;color:#cfd8dc;",n.appendChild(i);const l=document.createElement("div");l.style.cssText="font-size:10px;color:#b2dfdb;line-height:1.4;",n.appendChild(l);const c=document.createElement("div");c.style.cssText="font-size:10px;color:#9acccc;",n.appendChild(c);const u=document.createElement("div");u.style.cssText="display:grid;grid-template-columns:1.4fr 0.7fr 0.6fr 0.8fr;gap:6px;font-size:10px;color:#80cbc4;text-transform:uppercase;letter-spacing:0.4px;",u.innerHTML="<span>Pet</span><span>Hunger</span><span>Boost</span><span>XP</span>",n.appendChild(u);const d=document.createElement("div");return d.style.cssText="display:flex;flex-direction:column;gap:2px;min-height:18px;",n.appendChild(d),{card:n,etaEl:a,summaryEl:s,totalsEl:i,simpleEl:l,luckEl:c,tableBody:d}},E=M("üå± Plant Growth","rgba(129,199,132,0.45)");t.appendChild(E.card),Ha.turtlePlantEta=E.etaEl,Ha.turtlePlantSummary=E.summaryEl,Ha.turtlePlantTotals=E.totalsEl,Ha.turtlePlantSimple=E.simpleEl,Ha.turtlePlantLuck=E.luckEl,Ha.turtlePlantTable=E.tableBody;const $=M("ü•ö Egg Hatching","rgba(179,157,219,0.45)");t.appendChild($.card),Ha.turtleEggEta=$.etaEl,Ha.turtleEggSummary=$.summaryEl,Ha.turtleEggTotals=$.totalsEl,Ha.turtleEggSimple=$.simpleEl,Ha.turtleEggLuck=$.luckEl,Ha.turtleEggTable=$.tableBody;const A=document.createElement("div");A.style.cssText="padding:10px;border-radius:10px;border:1px solid rgba(255,224,130,0.45);background:rgba(30,24,12,0.4);display:flex;flex-direction:column;gap:6px;";const I=document.createElement("div");I.style.cssText="font-weight:600;font-size:12px;color:#ffe082;display:flex;justify-content:space-between;align-items:center;",I.textContent="üçΩÔ∏è Food Turtles",A.appendChild(I);const F=document.createElement("div");F.style.cssText="font-size:11px;color:#ffe9a6;",A.appendChild(F);const q=document.createElement("div");q.style.cssText="font-size:10px;color:#f6e7b5;",A.appendChild(q);const N=document.createElement("div");N.style.cssText="font-size:10px;color:#ffecb3;line-height:1.4;",A.appendChild(N);const z=document.createElement("div");z.style.cssText="display:flex;flex-direction:column;gap:4px;",A.appendChild(z),t.appendChild(A),Ha.turtleSupportSummary=F,Ha.turtleSupportTotals=q,Ha.turtleSupportSimple=N,Ha.turtleSupportList=z;const L=document.createElement("div");L.style.cssText="padding:12px;border-radius:10px;border:1px solid rgba(100,181,246,0.45);background:linear-gradient(135deg, rgba(100,181,246,0.08), rgba(100,181,246,0.03));display:flex;flex-direction:column;gap:10px;";const R=document.createElement("div");R.style.cssText="font-weight:700;font-size:13px;color:#64b5f6;letter-spacing:0.3px;",R.textContent="‚è∞ Specified ETA Helper",L.appendChild(R);const B=document.createElement("div");B.style.cssText="font-size:10px;color:#90caf9;line-height:1.5;",B.textContent="Calculate how many watering cans you need to finish a plant by a specific time.",L.appendChild(B);const j=document.createElement("div");j.style.cssText="font-size:10px;color:#ffb74d;line-height:1.5;padding:6px;background:rgba(255,152,0,0.1);border-radius:4px;border-left:3px solid #ffb74d;margin-top:6px;",j.textContent="‚ö†Ô∏è Switch to your Plant Growth Turtles before you calculate!",j.title="Calculation uses your CURRENT turtle setup. Make sure you have Plant Growth boost turtles active if you want accurate watering can counts.",L.appendChild(j);const D=document.createElement("div");D.style.cssText="display:flex;flex-wrap:wrap;gap:10px;align-items:flex-end;",L.appendChild(D);const H=document.createElement("div");H.style.cssText="display:flex;flex-direction:column;gap:4px;";const _=document.createElement("label");_.style.cssText="font-size:10px;color:#b3e5fc;font-weight:600;",_.textContent="Target Date (DD/MM)";const W=document.createElement("input");W.type="text",W.className="qpm-input",W.placeholder="DD/MM",W.style.cssText="padding:6px 10px;font-size:11px;min-width:80px;max-width:80px;",W.addEventListener("keydown",e=>e.stopPropagation()),W.addEventListener("input",e=>{let t=W.value.replace(/\D/g,"");t.length>=2&&(t=t.slice(0,2)+"/"+t.slice(2,4)),W.value=t}),H.append(_,W),D.appendChild(H);const O=document.createElement("div");O.style.cssText="display:flex;flex-direction:column;gap:4px;";const G=document.createElement("label");G.style.cssText="font-size:10px;color:#b3e5fc;font-weight:600;",G.textContent="Target Time";const U=document.createElement("input");U.type="time",U.className="qpm-input",U.style.cssText="padding:6px 10px;font-size:11px;min-width:120px;",U.addEventListener("keydown",e=>e.stopPropagation()),O.append(G,U),D.appendChild(O);const X=document.createElement("div");X.style.cssText="display:flex;flex-direction:column;gap:4px;flex:1;min-width:180px;";const V=document.createElement("label");V.style.cssText="font-size:10px;color:#b3e5fc;font-weight:600;",V.textContent="Select Plant";const K=document.createElement("select");K.className="qpm-select",K.style.cssText="padding:6px 10px;font-size:11px;",K.addEventListener("click",e=>e.stopPropagation());const J=document.createElement("option");J.value="",J.textContent="Choose a growing plant...",J.disabled=!0,J.selected=!0,K.appendChild(J),X.append(V,K),D.appendChild(X);const Y=document.createElement("button");Y.type="button",Y.className="qpm-button qpm-button--accent",Y.textContent="Calculate",Y.style.cssText="padding:6px 16px;font-size:11px;font-weight:600;align-self:flex-end;",D.appendChild(Y);const Q=document.createElement("div");Q.style.cssText="display:none;flex-direction:column;gap:6px;padding:10px;background:rgba(10,20,30,0.5);border-radius:8px;border:1px solid rgba(100,181,246,0.2);",L.appendChild(Q);const Z=()=>{const e=Bo(),t=Date.now(),n=K.value;for(;K.options.length>1;)K.remove(1);let o=0;for(const r of e.plantTargets)if(r.endTime&&r.endTime>t){const e=document.createElement("option");e.value=r.key,e.textContent=`${r.species||"Unknown"} - ${ss(r.remainingMs||0)}`,e.dataset.endTime=String(r.endTime),e.dataset.species=r.species||"Unknown",K.appendChild(e),o++}if(0===o){const e=document.createElement("option");e.value="",e.textContent="No growing plants found",e.disabled=!0,K.appendChild(e)}if(n){Array.from(K.options).find(e=>e.value===n)&&(K.value=n)}};return Y.addEventListener("click",()=>{const e=K.selectedOptions[0];if(!e||!U.value||!W.value)return void(Q.style.display="none");const t=Number(e.dataset.endTime),n=e.dataset.species||"Unknown",o=Date.now(),r=W.value.split("/").map(Number),a=r[0],s=r[1];if(!a||!s||a<1||a>31||s<1||s>12)return Q.innerHTML='<div style="color:#ef5350;font-size:11px;">Invalid date! Use DD/MM format (e.g., 15/11)</div>',void(Q.style.display="flex");const i=U.value.split(":").map(Number),l=i[0]??0,c=i[1]??0,u=t-o,d=(new Date).getFullYear();let p=new Date(d,s-1,a,l,c,0,0);p.getTime()<o&&(p=new Date(d+1,s-1,a,l,c,0,0));const m=p.getTime(),f=Math.floor((m-o)/864e5),g=m-o;if(g<=0)return Q.innerHTML='<div style="color:#ef5350;font-size:11px;">Target time is in the past!</div>',void(Q.style.display="flex");const h=Bo(),b=h.plant.effectiveRate||0,y=h.plant.adjustedMsRemaining,x=b>0&&y?y:u,w=b>0&&!!y&&y>0,v=Math.max(0,x-g),C=Math.ceil(v/3e5);Q.innerHTML="";const S=document.createElement("div");S.style.cssText="font-weight:700;font-size:11px;color:#64b5f6;margin-bottom:4px;",S.textContent=`Results for ${n}`,Q.appendChild(S);const T=document.createElement("div");T.style.cssText="font-size:10px;color:#e0e0e0;line-height:1.6;padding:6px;background:rgba(255,255,255,0.05);border-radius:4px;margin-bottom:4px;",T.innerHTML=w?`<strong style="color:#81c784;">üê¢ Current State (With Turtles):</strong> ${ss(x)} ‚Ä¢ ${Cs(x)}`:`<strong style="color:#90caf9;">Current State (No Turtles):</strong> ${ss(x)} ‚Ä¢ ${Cs(x)}`,Q.appendChild(T);const k=document.createElement("div");k.style.cssText="font-size:10px;color:#e0e0e0;line-height:1.6;";const P=0===f?"today":1===f?"tomorrow":`in ${f} days`,M=`${W.value} ${U.value}`;k.innerHTML=`<strong style="color:#ffb74d;">Target:</strong> ${M} (${P}) ‚Ä¢ ${ss(g)} from now`,Q.appendChild(k);const E=document.createElement("div");if(E.style.cssText="font-size:11px;color:#fff;font-weight:700;padding:8px;background:rgba(100,181,246,0.15);border-radius:6px;margin-top:4px;",0===C)E.innerHTML=`‚úÖ <span style="color:#81c784;">No watering cans needed!</span><br><span style="font-size:10px;font-weight:400;color:#b0b0b0;">Plant will finish ${ss(Math.abs(v))} before target time.</span>`;else{const e=w?"(based on current turtle boost)":"(no turtle boost applied)";E.innerHTML=`üíß <span style="color:#64b5f6;">Watering Cans Needed: ${C}</span><br><span style="font-size:10px;font-weight:400;color:#b0b0b0;">Each can saves 5 minutes ${e}</span>`}Q.appendChild(E),Q.style.display="flex"}),jo(()=>{Z()}),Z(),t.appendChild(L),Ts(Bo()),e}let js={groups:[],totals:{xpPerHour:0,plantMinutesPerHour:0,eggMinutesPerHour:0,coinsPerHour:0},unknown:[]},Ds=[];const Hs={detailedView:!1,filterCoinOnly:!1,selectedAbilities:[]};let _s={...Hs};function Ws(e,t,n,o){const r=document.createElement("div");r.style.cssText="display: flex; align-items: center; gap: 10px; padding: 8px; background: rgba(0, 0, 0, 0.2); border-radius: 4px;";const a=document.createElement("div");a.style.cssText="flex: 1; display: flex; flex-direction: column; gap: 2px;";const s=document.createElement("div");s.textContent=e,s.style.cssText="font-size: 12px; color: rgba(255, 255, 255, 0.9); font-weight: 500;",a.appendChild(s);const i=document.createElement("div");i.textContent=t,i.style.cssText="font-size: 11px; color: rgba(255, 255, 255, 0.6);",a.appendChild(i),r.appendChild(a);const l=document.createElement("button");l.style.cssText=`\n    width: 48px;\n    height: 24px;\n    border-radius: 12px;\n    border: none;\n    cursor: pointer;\n    position: relative;\n    transition: background 0.2s;\n    background: ${n?"var(--qpm-accent)":"rgba(255, 255, 255, 0.2)"};\n  `;const c=document.createElement("div");c.style.cssText=`\n    width: 18px;\n    height: 18px;\n    border-radius: 50%;\n    background: white;\n    position: absolute;\n    top: 3px;\n    left: ${n?"27px":"3px"};\n    transition: left 0.2s;\n  `,l.appendChild(c);let u=n;return l.addEventListener("click",()=>{u=!u,l.style.background=u?"var(--qpm-accent)":"rgba(255, 255, 255, 0.2)",c.style.left=u?"27px":"3px",o(u)}),r.appendChild(l),r}function Os(e){const t=d.get("qpm-tracker-settings");t&&(_s={...Hs,...t}),e.style.cssText="display: flex; flex-direction: column; gap: 12px; min-width: 900px; max-width: 1200px;";const n=document.createElement("div");n.style.cssText="\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 12px 16px;\n    background: var(--qpm-surface-2);\n    border-radius: 6px;\n    border: 1px solid var(--qpm-border);\n  ";const o=document.createElement("div");o.className="tracker-summary",o.style.cssText="font-size: 13px; color: var(--qpm-text); font-weight: 500;",o.textContent="Loading pet data...",n.appendChild(o);const r=document.createElement("div");r.className="tracker-settings-panel",r.style.cssText="display: none;";const a=document.createElement("button");a.className="qpm-button qpm-button--secondary",a.textContent="‚öôÔ∏è Filters",a.style.cssText="padding: 6px 12px; font-size: 12px;",a.title="Show filter options",a.addEventListener("click",()=>{const e="none"===r.style.display;r.style.display=e?"":"none",a.textContent=e?"‚öôÔ∏è Hide Filters":"‚öôÔ∏è Filters"}),n.appendChild(a),e.appendChild(n),r.style.cssText="\n    display: none;\n    padding: 16px;\n    background: var(--qpm-surface-2);\n    border-radius: 6px;\n    border: 1px solid var(--qpm-border);\n    margin-bottom: 12px;\n    gap: 16px;\n  ";const s=document.createElement("div");s.textContent="‚öôÔ∏è Display Options",s.style.cssText="font-weight: 600; color: var(--qpm-accent); margin-bottom: 12px; font-size: 13px;",r.appendChild(s);const l=document.createElement("div");l.style.cssText="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;";const c=Ws("üìä Detailed View","Show additional statistics and context",_s.detailedView,e=>{_s.detailedView=e,d.set("qpm-tracker-settings",_s),Gs({summaryText:o,tbody:x,footer:w,abilityCheckboxGrid:f})});l.appendChild(c);const u=Ws("üí∞ Coin Abilities Only","Show only coin-generating abilities",_s.filterCoinOnly,e=>{_s.filterCoinOnly=e,d.set("qpm-tracker-settings",_s),Gs({summaryText:o,tbody:x,footer:w,abilityCheckboxGrid:f})});l.appendChild(u);const p=document.createElement("div");p.className="ability-filter-container",p.style.cssText="grid-column: 1 / -1; display: flex; flex-direction: column; gap: 8px;";const m=document.createElement("div");m.textContent="‚ú® Filter by Ability",m.style.cssText="font-size: 12px; color: rgba(255, 255, 255, 0.9); font-weight: 500;",p.appendChild(m);const f=document.createElement("div");f.className="ability-checkbox-grid",f.style.cssText="\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));\n    gap: 6px;\n    max-height: 200px;\n    overflow-y: auto;\n    padding: 8px;\n    background: rgba(0, 0, 0, 0.2);\n    border-radius: 4px;\n  ",p.appendChild(f),l.appendChild(p),r.appendChild(l),e.appendChild(r);const g=document.createElement("div");g.style.cssText="\n    overflow-x: auto;\n    background: var(--qpm-surface-1);\n    border-radius: 6px;\n    border: 1px solid var(--qpm-border);\n    max-height: 60vh;\n    overflow-y: auto;\n  ";const h=document.createElement("table");h.className="tracker-detail-table",h.style.cssText="\n    width: 100%;\n    border-collapse: collapse;\n    font-size: 12px;\n  ";const b=h.createTHead();b.style.cssText="position: sticky; top: 0; z-index: 10; background: var(--qpm-surface-1);";const y=b.insertRow();y.style.cssText="\n    background: var(--qpm-surface-2);\n    border-bottom: 2px solid var(--qpm-border);\n  ";[{text:"üêæ Pet",tooltip:"Pet name or species"},{text:"‚ú® Ability",tooltip:"Pet ability name"},{text:"üé≤ Chance %",tooltip:"Calculated proc chance per minute (baseProbability √ó STR)"},{text:"‚ö° Procs/Hr",tooltip:"Expected procs per hour"},{text:"üí∞ Per Proc",tooltip:"Coins earned per successful proc"},{text:"üí∏ Per Hour",tooltip:"Total coins per hour from this ability"},{text:"‚è±Ô∏è Next ETA",tooltip:"Live countdown to next expected proc"}].forEach(({text:e,tooltip:t})=>{const n=document.createElement("th");n.textContent=e,n.title=t,n.style.cssText="\n      padding: 10px 12px;\n      text-align: left;\n      font-weight: 600;\n      color: var(--qpm-accent);\n      white-space: nowrap;\n      border-bottom: 1px solid var(--qpm-border);\n      cursor: help;\n    ",y.appendChild(n)});const x=h.createTBody();x.className="tracker-tbody",g.appendChild(h),e.appendChild(g);const w=document.createElement("div");w.className="tracker-footer",w.style.cssText="\n    padding: 12px 16px;\n    background: var(--qpm-surface-2);\n    border-radius: 6px;\n    border: 1px solid var(--qpm-border);\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--qpm-accent);\n  ",w.textContent="Total: Loading...",e.appendChild(w);const v={root:e,summaryText:o,tbody:x,footer:w,abilityCheckboxGrid:f,updateInterval:null,lastPetCount:0};Wn(e=>{Ds=e,js=function(e){if(!e.length)return{groups:[],totals:{xpPerHour:0,plantMinutesPerHour:0,eggMinutesPerHour:0,coinsPerHour:0},unknown:[]};const t=ha(),n=new Map,o=new Map,r=[];if(e.forEach((e,a)=>{const s=Array.isArray(e.abilities)?e.abilities:[];for(const i of s){if(!i)continue;const s=oa(i);if(!s){r.push({abilityName:i,pet:e});continue}if("continuous"!==s.trigger)continue;const l=aa(s,e.strength),c=hs(e,s.id),u=c?xs(c,s):null,d="number"==typeof e.strength&&Number.isFinite(e.strength)?e.strength:null,p=`${s.id}::${null!=d?d.toFixed(2):"baseline"}`;let m=n.get(p);void 0===m&&(m=xa(s.id,t,d),n.set(p,m??null));const f=u?.procsPerHour??null,g=null!=f&&f>0?f:l.procsPerHour,h=null!=f&&f>0?"observed":"estimated",b=u?.effectPerProc??null,y=m?.effectPerProc??null,x=s.effectValuePerProc??null;let w=null,v="definition",C=m?.detail??null;null!=b&&b>0?(w=b,v="observed",C=u?.sampleCount?`Observed average from ${u.sampleCount} recent sample${1===u.sampleCount?"":"s"}.`:"Observed from ability log."):null!=y&&y>0?(w=y,v="computed"):null!=x&&x>0&&(w=x,v="definition",C=s.notes??null);const S=null!=w&&g>0?g*w:sa(s,l),T=u?.lastProcAt??c?.lastPerformedAt??null,k=u?.sampleCount??0,P={pet:e,petIndex:a,displayName:ws(e),abilityName:i,definition:s,procsPerHour:g,procsPerHourSource:h,chancePerMinute:g/60,expectedMinutesBetween:g>0?60/g:null,lastProcAt:T,sampleCount:k,effectPerProc:w,effectSource:v,effectDetail:C,effectPerHour:S},M=s.id,E=o.get(M);E?(E.entries.push(P),E.totalProcsPerHour+=g,E.effectPerHour+=S,E.totalSamples+=k,(null==E.lastProcAt||null!=T&&T>E.lastProcAt)&&(E.lastProcAt=T)):o.set(M,{definition:s,entries:[P],totalProcsPerHour:g,chancePerMinute:g/60,combinedEtaMinutes:g>0?60/g:null,effectPerHour:S,totalSamples:k,lastProcAt:T,averageEffectPerProc:w})}}),0===o.size&&0===r.length)return{groups:[],totals:{xpPerHour:0,plantMinutesPerHour:0,eggMinutesPerHour:0,coinsPerHour:0},unknown:[]};const a={xpPerHour:0,plantMinutesPerHour:0,eggMinutesPerHour:0,coinsPerHour:0};return{groups:Array.from(o.values()).map(e=>{switch(e.chancePerMinute=e.totalProcsPerHour/60,e.combinedEtaMinutes=e.totalProcsPerHour>0?60/e.totalProcsPerHour:null,e.averageEffectPerProc=e.totalProcsPerHour>0?e.effectPerHour/e.totalProcsPerHour:null,e.definition.category){case"xp":a.xpPerHour+=e.effectPerHour;break;case"plantGrowth":a.plantMinutesPerHour+=e.effectPerHour;break;case"eggGrowth":a.eggMinutesPerHour+=e.effectPerHour;break;case"coins":a.coinsPerHour+=e.effectPerHour}return e}).sort((e,t)=>t.totalProcsPerHour-e.totalProcsPerHour),totals:a,unknown:r}}(e),e.length!==v.lastPetCount&&(v.lastPetCount=e.length,Gs(v))}),Gs(v),v.lastPetCount=Ds.length,v.updateInterval=window.setInterval(()=>{const t=e.querySelectorAll(".eta-countdown"),n=Date.now();t.forEach(e=>{const t=parseInt(e.dataset.lastProc||"0",10),o=parseFloat(e.dataset.effectiveRate||"0");if(0===o)return;const r=o>0?60/o:null;if(0===t&&r){e.dataset.countdownStart||(e.dataset.countdownStart=String(n));const t=parseInt(e.dataset.countdownStart,10)+60*r*1e3-n;if(t>0){const n=Math.floor(t/1e3),o=Math.floor(n/3600),r=Math.floor(n%3600/60),a=n%60;e.textContent=o>0?`${o}h ${r}m ${a}s Est.`:r>0?`${r}m ${a}s Est.`:`${a}s Est.`,e.style.color="var(--qpm-positive)"}else e.dataset.countdownStart=String(n),e.textContent="Ready",e.style.color="var(--qpm-danger)"}else{const n=ja(t||null,r,o);e.textContent=n.text,e.style.color=n.isOverdue?"var(--qpm-danger)":"var(--qpm-positive)"}})},1e3);const C=new MutationObserver(()=>{document.body.contains(e)||(null!==v.updateInterval&&clearInterval(v.updateInterval),C.disconnect(),i("Tracker window cleanup: interval cleared"))});C.observe(document.body,{childList:!0,subtree:!0}),i("Trackers window rendered with live updates")}function Gs(e){const t=js,n=Ds;if(function(e,t){const n=t.groups.map(e=>({id:e.definition.id,name:e.definition.name,count:e.entries.length})),o=n.map(e=>e.id).sort().join(",");if(o===(e.dataset.abilityIds||"")&&e.children.length>0)return;if(e.dataset.abilityIds=o,e.innerHTML="",0===n.length){const t=document.createElement("div");return t.textContent="No abilities available",t.style.cssText="padding: 8px; color: rgba(255, 255, 255, 0.5); font-size: 11px;",void e.appendChild(t)}const r=document.createElement("div");r.style.cssText="display: flex; align-items: center; gap: 8px;";const a=document.createElement("span");a.textContent="Filter Ability:",a.style.cssText="font-size: 12px; color: var(--qpm-text-muted);",r.appendChild(a);const s=document.createElement("select");s.className="qpm-select",s.style.cssText="flex: 1; min-width: 200px; padding: 6px 8px; font-size: 12px;";const i=document.createElement("option");i.value="",i.textContent="All abilities",s.appendChild(i),n.forEach(({id:e,name:t,count:n})=>{const o=document.createElement("option");o.value=e,o.textContent=`${t} (${n})`,s.appendChild(o)}),1===_s.selectedAbilities.length?s.value=_s.selectedAbilities[0]||"":s.value="",s.addEventListener("change",()=>{""===s.value?_s.selectedAbilities=[]:_s.selectedAbilities=[s.value],d.set("qpm-tracker-settings",_s),Gs({summaryText:e.closest(".qpm-modal-window")?.querySelector(".tracker-summary"),tbody:e.closest(".qpm-modal-window")?.querySelector(".tracker-tbody"),footer:e.closest(".qpm-modal-window")?.querySelector(".tracker-footer"),abilityCheckboxGrid:e})}),r.appendChild(s),e.appendChild(r)}(e.abilityCheckboxGrid,t),e.tbody.innerHTML="",0===t.groups.length){const t=e.tbody.insertRow().insertCell();return t.colSpan=7,t.style.cssText="padding: 40px; text-align: center; color: rgba(255, 255, 255, 0.5);",t.innerHTML='\n      <div style="font-size: 48px; margin-bottom: 12px;">üê¢</div>\n      <div style="font-size: 14px; font-weight: 600; margin-bottom: 6px;">No Active Pet Abilities</div>\n      <div style="font-size: 12px; opacity: 0.7;">Make sure pets are active and assigned in your garden</div>\n    ',e.footer.textContent="üìä Total: No data",void(e.summaryText.textContent="üêæ No Active Pets")}let o=t.groups;_s.filterCoinOnly&&(o=o.filter(e=>"coins"===e.definition.effectUnit||"coins"===e.definition.category)),_s.selectedAbilities.length>0&&(o=o.filter(e=>_s.selectedAbilities.includes(e.definition.id)));const r=n.length,a=t.groups.length,s=o.length,i=o.filter(e=>"coins"===e.definition.effectUnit||"coins"===e.definition.category).length;let l=[`üêæ ${r} Active Pet${1!==r?"s":""}`];_s.filterCoinOnly||_s.selectedAbilities.length>0?l.push(`üìä ${s}/${a} Abilities (filtered)`):l.push(`üìä ${a} Abilit${1!==a?"ies":"y"}`),i>0&&l.push(`üí∞ ${i} Coin-Generating`),e.summaryText.textContent=l.join(" ‚Ä¢ ");let c=0,u=0,p=0;if(0===o.length){const t=e.tbody.insertRow().insertCell();return t.colSpan=7,t.style.cssText="padding: 40px; text-align: center; color: rgba(255, 255, 255, 0.5);",t.innerHTML='\n      <div style="font-size: 48px; margin-bottom: 12px;">üîç</div>\n      <div style="font-size: 14px; font-weight: 600; margin-bottom: 6px;">No Abilities Match Filter</div>\n      <div style="font-size: 12px; opacity: 0.7;">Try adjusting your filter settings above</div>\n    ',void(e.footer.innerHTML="<strong>üìä Total:</strong> 0 abilities (filtered)")}const m=o.filter(e=>"coins"===e.definition.effectUnit||"coins"===e.definition.category),f=o.filter(e=>"coins"!==e.definition.effectUnit&&"coins"!==e.definition.category);if([...m,...f].forEach(t=>{for(const n of t.entries){Da(n,t.definition.name,e.tbody,_s.detailedView);const{effective:o}=Ba(n.procsPerHour,n.definition.id),r=o*(n.effectPerProc??0);c+=o,("coins"===t.definition.effectUnit||"coins"===t.definition.category)&&n.effectPerProc&&n.effectPerProc>0&&(u+=r),p++}!function(e,t,n=!1){if(e.entries.length<2){const e=t.rows.length-1;return e>=0?t.rows[e]??null:null}const o=t.insertRow();o.style.cssText="\n    border-bottom: 2px solid var(--qpm-border);\n    background: var(--qpm-surface-2);\n    font-weight: 600;\n  ";const r=o.insertCell();r.textContent=`üìä Total (${e.entries.length})`,r.style.cssText="\n    padding: 10px 12px;\n    color: var(--qpm-accent);\n    font-weight: 600;\n    white-space: nowrap;\n  ";const a=o.insertCell();a.textContent=e.definition.name,a.style.cssText="\n    padding: 10px 12px;\n    color: var(--qpm-accent);\n    white-space: nowrap;\n  ";const s=o.insertCell();s.textContent=`${e.chancePerMinute.toFixed(2)}%`,s.style.cssText="\n    padding: 10px 12px;\n    text-align: right;\n    color: var(--qpm-accent);\n    font-family: monospace;\n    white-space: nowrap;\n    font-weight: 600;\n  ",s.title=`Combined chance from ${e.entries.length} pets`;const i=o.insertCell();i.textContent=e.totalProcsPerHour.toFixed(2),i.style.cssText="\n    padding: 10px 12px;\n    text-align: right;\n    color: var(--qpm-accent);\n    font-family: monospace;\n    font-weight: 600;\n  ",i.title=`Combined procs/hour from ${e.entries.length} pets`;const l=o.insertCell(),c=e.averageEffectPerProc??0,u=n?ir:lr;l.textContent=c>0?u(c):"‚Äî",l.style.cssText=`\n    padding: 10px 12px;\n    text-align: right;\n    color: ${c>0?"var(--qpm-warning)":"var(--qpm-text-muted)"};\n    font-family: monospace;\n    font-weight: 600;\n  `,c>0&&(l.title=n?"Average coins per proc":`Exact: ${ir(c)}`);const d=o.insertCell(),p=e.effectPerHour;d.textContent=p>0?u(p):"‚Äî",d.style.cssText=`\n    padding: 10px 12px;\n    text-align: right;\n    color: ${p>0?"var(--qpm-warning)":"var(--qpm-text-muted)"};\n    font-family: monospace;\n    font-weight: 600;\n  `,p>0&&(d.title=n?`Combined coins/hour from ${e.entries.length} pets`:`Exact: ${ir(p)}/hr`);const m=o.insertCell();m.className="eta-countdown",m.dataset.lastProc=String(e.lastProcAt??0),m.dataset.effectiveRate=String(e.totalProcsPerHour);const f=ja(e.lastProcAt,e.combinedEtaMinutes,e.totalProcsPerHour);m.textContent=f.text,m.style.cssText=`\n    padding: 10px 12px;\n    text-align: right;\n    color: ${f.isOverdue?"var(--qpm-danger)":"var(--qpm-accent)"};\n    font-family: monospace;\n    font-weight: 600;\n    white-space: nowrap;\n  `;const g=e.totalProcsPerHour>0?60/e.totalProcsPerHour:0;m.title=g>0?`Combined average: ${g.toFixed(1)} minutes between procs`:"No proc history yet"}(t,e.tbody,_s.detailedView)}),p>0){const t=e.tbody.insertRow();t.style.cssText="\n      background: var(--qpm-surface-2);\n      border-top: 2px solid var(--qpm-border);\n      font-weight: 600;\n      position: sticky;\n      bottom: 0;\n      z-index: 5;\n    ";const n=t.insertCell();n.textContent="üìä TOTAL",n.colSpan=2,n.style.cssText="padding: 12px; color: var(--qpm-accent); font-weight: 700; font-size: 13px; text-transform: uppercase;";const o=t.insertCell();o.textContent=(c/60).toFixed(3),o.style.cssText="padding: 12px; text-align: right; color: var(--qpm-accent); font-family: monospace;";const r=t.insertCell();r.textContent=c.toFixed(2),r.style.cssText="padding: 12px; text-align: right; color: var(--qpm-accent); font-family: monospace;";const a=t.insertCell();a.textContent="‚Äî",a.style.cssText="padding: 12px; text-align: right; color: rgba(255, 255, 255, 0.5);";const s=t.insertCell();s.textContent=ir(u),s.style.cssText="padding: 12px; text-align: right; color: #ffa500; font-family: monospace; font-weight: 700; font-size: 14px;";const i=t.insertCell();i.textContent="‚Äî",i.style.cssText="padding: 12px; text-align: right; color: rgba(255, 255, 255, 0.5);";const l=m.reduce((e,t)=>e+t.entries.length,0),d=[`<strong>üìä Total:</strong> ${p} abilit${1!==p?"ies":"y"}`];if(l>0){let e=0;for(const t of m)for(const n of t.entries){const o=Zr(t.definition.id,{petId:n.pet.petId,slotId:n.pet.slotId,slotIndex:"number"==typeof n.pet.slotIndex&&Number.isFinite(n.pet.slotIndex)?n.pet.slotIndex:null,fallbackKeys:[]});if(o){const n=bs(o);for(const o of n){const n=ys(t.definition,o);null!=n&&Number.isFinite(n)&&n>0&&(e+=n)}}}e>0?d.push(`<span style="color: #ffd700;">üí∞ ${ir(e)} earned</span>`):d.push(`<span style="color: #ffd700;">üí∞ ${l} coin</span>`)}u>0&&d.push(`<span style="color: #ffa500; font-size: 14px; font-weight: 700;">üí∏ ${ir(u)}/hr</span>`),c>0&&d.push(`<span style="color: var(--qpm-accent); font-size: 12px;">‚ö° ${c.toFixed(1)} procs/hr</span>`),e.footer.innerHTML=d.join(" ‚Ä¢ ")}}function Us(e){e.style.cssText="display: flex; flex-direction: column; gap: 16px; min-width: 600px;";const t=Bs();t.style.margin="0",e.appendChild(t)}function Xs(e){e.style.cssText="display: flex; flex-direction: column; gap: 16px; min-width: 600px;";const t=Ms();t.style.margin="0",e.appendChild(t);const n=Ks();n.style.margin="0",e.appendChild(n);const o=Zs();o.style.margin="0",e.appendChild(o)}function Vs(e){e.style.cssText="display: flex; flex-direction: column; gap: 16px; min-width: 600px;";const t=!1!==ve().syncModeEnabled,n=Js();n.style.margin="0",e.appendChild(n);const o=Ys(t);o.style.margin="0",e.appendChild(o)}function Ks(){As.harvestReminder={enabled:As.harvestReminder?.enabled??!1,highlightEnabled:As.harvestReminder?.highlightEnabled??!0,toastEnabled:As.harvestReminder?.toastEnabled??!0,minSize:"number"==typeof As.harvestReminder?.minSize?As.harvestReminder.minSize:80,selectedMutations:{...ts,...As.harvestReminder?.selectedMutations||{}}},Ka?.(),Ka=null,Ja?.(),Ja=null,Xa&&(window.clearTimeout(Xa),Xa=null);const e=document.createElement("span");e.className="qpm-chip",e.textContent=As.harvestReminder.enabled?"Enabled":"Disabled";const{root:t,body:n}=$s("üåæ Harvest Reminder",{collapsible:!0,startCollapsed:!0,subtitleElement:e});t.dataset.qpmSection="harvest-reminder";const o=document.createElement("div");o.className="qpm-section-muted",o.textContent=As.harvestReminder.enabled?"Waiting for sunny weather...":"Disabled",n.appendChild(o);const r=document.createElement("div");var a;return r.style.cssText="color:#bbb;font-size:11px;line-height:1.4",r.innerHTML="Matches: 0 ‚Ä¢ Value: 0<br>Waiting for sunny weather...",n.appendChild(r),Ha.harvestStatus=o,Ha.harvestSummary=r,Ka=function(e,t=!0){if(qr.add(e),t)try{e(zr)}catch(n){i("‚ö†Ô∏è Harvest summary listener error",n)}return()=>{qr.delete(e)}}(e=>{oi(e)}),a=e=>{!function(e){ni(e),Xa&&window.clearTimeout(Xa),Xa=window.setTimeout(()=>{if(Xa=null,!As.harvestReminder?.enabled)return void ni("Disabled");const e=Lr();ni(e.readyCount>0?`Matches ready: ${e.readyCount}`:"Waiting for sunny weather...")},5500)}(e)},Nr.add(a),Ja=()=>{Nr.delete(a)},oi(Lr()),As.harvestReminder.enabled&&ni(Ha.harvestStatus?.textContent??"Waiting for sunny weather..."),t}function Js(){const e=document.createElement("span");e.className="qpm-chip",e.textContent=As.autoShop?.enabled?"Enabled":"Disabled";const t=document.createElement("span");t.className="qpm-section-muted",t.style.cssText="font-size:11px;white-space:nowrap",t.textContent="";const{root:n,body:o}=$s("üõí Auto Shop",{collapsible:!0,startCollapsed:!0,subtitleElement:e,headerActions:[t]});n.dataset.qpmSection="shop-tracking";const r=document.createElement("div");r.textContent="Watching for shops...",r.className="qpm-section-muted",o.appendChild(r);const a=document.createElement("div");a.style.cssText="margin-bottom:8px;padding:6px;background:#2b1f12;border-radius:4px;border:1px solid rgba(255,152,0,0.25);display:flex;flex-direction:column;gap:4px";const s={};for(const i of ns){const e=document.createElement("div");e.style.cssText="display:flex;justify-content:space-between;align-items:center;font-size:11px;color:#ddd";const t=document.createElement("span");t.textContent=`${i.icon} ${i.label}`;const n=document.createElement("span");n.textContent="off",n.style.fontFamily="monospace",n.style.color="#777",e.append(t,n),a.appendChild(e),s[i.key]=n}return ks({summaryEl:t,values:s}),o.appendChild(a),Ha.shopStatus=r,Ha.shopItemToggles=null,Promise.resolve().then(()=>Vo).then(e=>{e.setShopStatusCallback(e=>{r.textContent=e}),e.setRestockInfoCallback(e=>{Oa=e,Ps()}),Oa=e.getRestockInfo(),Ps()}).catch(e=>i("‚ö†Ô∏è Failed to initialize shop callbacks",e)),n}function Ys(e){const t=document.createElement("span");t.className="qpm-chip",t.textContent=e?"Sync Mode":"Basic Mode";const{root:n,body:o}=$s("üîí Inventory Locker",{collapsible:!0,startCollapsed:!0,subtitleElement:t});n.dataset.qpmSection="inventory-locker";const r=document.createElement("div");r.className="qpm-section-muted",r.style.marginBottom="8px";const a=e=>{r.textContent=e?"Unlock keeps manual favorites; only locker-added favorites are removed.":"Unlock toggles every favorite for the selected crop species.",t.textContent=e?"Sync Mode":"Basic Mode"};a(e),o.appendChild(r);const s=document.createElement("div");s.innerHTML="üí° <strong>How it works:</strong><br>‚Ä¢ Open inventory to lock species<br>‚Ä¢ Locked species are favorited automatically<br>‚Ä¢ Sync mode preserves manual favorites<br>‚Ä¢ Basic mode toggles all favorites",s.style.cssText="background:#333;padding:8px;border-radius:4px;margin-bottom:8px;font-size:10px;line-height:1.5;border-left:3px solid #FFCA28",o.appendChild(s);const i=function(e,t,n){const o=document.createElement("label");o.style.cssText="display:flex;align-items:center;gap:8px;margin-bottom:6px;font-size:11px;color:#ddd";const r=document.createElement("input");r.type="checkbox",r.checked=t,r.style.cssText="width:14px;height:14px;cursor:pointer",r.addEventListener("click",e=>e.stopPropagation()),r.addEventListener("change",()=>{n(r.checked)});const a=document.createElement("span");return a.textContent=e,a.style.cssText="flex:1",o.append(r,a),o.addEventListener("click",e=>e.stopPropagation()),o}("Sync mode (preserve manual favorites)",e,e=>{As.inventoryLocker?As.inventoryLocker.syncMode=e:As.inventoryLocker={syncMode:e},Ce(e),ri(),a(e),ei(e?"Inventory locker sync mode enabled":"Inventory locker sync mode disabled")});o.appendChild(i);const l=document.createElement("div");return l.textContent="Tip: open inventory to lock species. Sync mode avoids unfavoriting crops you already starred.",l.style.cssText="font-size:10px;color:#A5D6A7;line-height:1.4;margin-top:8px;",o.appendChild(l),n}function Qs(){const{root:e,body:t}=$s("üìñ Magic Garden Guide",{subtitle:"Reference guide for game mechanics"});e.dataset.qpmSection="guide";const n=document.createElement("div");n.style.cssText="\n    width: 100%;\n    text-align: center;\n    padding: 12px;\n    background: var(--qpm-surface-1, #1a1a1a);\n    border-radius: 8px;\n    position: relative;\n  ";const o=document.createElement("div");o.textContent="(Click Me!)",o.style.cssText="\n    position: absolute;\n    top: 20px;\n    right: 20px;\n    color: rgba(150, 150, 150, 0.7);\n    font-size: 12px;\n    font-style: italic;\n    background: rgba(0, 0, 0, 0.5);\n    padding: 4px 8px;\n    border-radius: 4px;\n    pointer-events: none;\n    z-index: 10;\n  ";const r=document.createElement("img");return r.src="https://raw.githubusercontent.com/ryandt2305-cpu/QPM-GR/master/MGGuide.jpeg",r.alt="Magic Garden Guide",r.style.cssText="\n    width: 100%;\n    max-width: 100%;\n    height: auto;\n    border-radius: 8px;\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);\n    cursor: pointer;\n    transition: transform 0.2s;\n    display: block;\n  ",r.addEventListener("mouseenter",()=>{r.style.transform="scale(1.02)"}),r.addEventListener("mouseleave",()=>{r.style.transform="scale(1)"}),r.addEventListener("click",()=>{window.open(r.src,"_blank")}),r.onerror=()=>{n.innerHTML='\n      <div style="padding: 40px; color: var(--qpm-text-muted, #999); font-style: italic;">\n        üìñ Guide image not found. Please ensure MGGuide.jpeg is uploaded to the master branch of the repository.\n      </div>\n    '},n.appendChild(o),n.appendChild(r),t.appendChild(n),e}function Zs(){const e=document.createElement("span");e.className="qpm-chip",e.textContent=As.mutationReminder?.enabled?"Enabled":"Disabled";const{root:t,body:n}=$s("üß¨ Mutation Reminder",{collapsible:!0,startCollapsed:!0,subtitleElement:e});t.dataset.qpmSection="mutation-reminder";const o=document.createElement("div");o.textContent="Monitoring weather...",o.className="qpm-section-muted",n.appendChild(o);const r=document.createElement("div");r.innerHTML="üí° <strong>How it works:</strong><br>‚Ä¢ Detects weather events (Rain/Snow/Dawn/Amber)<br>‚Ä¢ Scans your plant inventory for mutations (F/W/C/D/A)<br>‚Ä¢ Notifies which plants to place for mutations<br>‚Ä¢ Example: Wet plant + Snow ‚Üí Frozen mutation!",r.style.cssText="background:#333;padding:8px;border-radius:4px;font-size:10px;line-height:1.5;border-left:3px solid #9C27B0",n.appendChild(r);const a=ti(As.mutationReminder?.enabled?"‚úì Reminders Enabled":"‚úó Reminders Disabled",async()=>{if(!As.mutationReminder)return;As.mutationReminder.enabled=!As.mutationReminder.enabled,a.textContent=As.mutationReminder.enabled?"‚úì Reminders Enabled":"‚úó Reminders Disabled",a.classList.toggle("qpm-button--positive",As.mutationReminder.enabled),a.classList.toggle("qpm-button--accent",As.mutationReminder.enabled),e.textContent=As.mutationReminder.enabled?"Enabled":"Disabled",ri();const{setMutationReminderEnabled:t}=await Promise.resolve().then(()=>Dt);t(As.mutationReminder.enabled)});a.style.width="100%",As.mutationReminder?.enabled&&a.classList.add("qpm-button--positive","qpm-button--accent"),n.appendChild(a);const s=ti("üîç Check Now",async()=>{s.disabled=!0,s.textContent="‚è≥ Checking...";try{const{checkForMutations:e}=await Promise.resolve().then(()=>Dt);await e(),s.textContent="‚úÖ Done!",setTimeout(()=>{s.textContent="üîç Check Now",s.disabled=!1},2e3)}catch(e){s.textContent="‚ùå Error",i("Error checking mutations:",e),setTimeout(()=>{s.textContent="üîç Check Now",s.disabled=!1},2e3)}});s.style.width="100%",s.style.background="#9C27B0",s.title="Manually check for mutation opportunities",n.appendChild(s);const l=document.createElement("div");l.style.cssText="margin-top:8px;padding:8px;background:#2a1a3a;border-radius:4px;border:1px dashed #9C27B0";const c=document.createElement("div");c.textContent="üß™ Debug: Simulate Weather",c.style.cssText="font-size:10px;color:#aaa;margin-bottom:6px;font-weight:bold";const u=document.createElement("div");u.style.cssText="display:grid;grid-template-columns:1fr 1fr;gap:4px";const d=[{emoji:"üåßÔ∏è",name:"Rain",type:"rain"},{emoji:"‚ùÑÔ∏è",name:"Snow",type:"snow"},{emoji:"üåÖ",name:"Dawn",type:"dawn"},{emoji:"üåÜ",name:"Amber",type:"amber"}];for(const p of d){const e=ti(`${p.emoji} ${p.name}`,async()=>{e.disabled=!0;try{const{simulateWeather:t}=await Promise.resolve().then(()=>Dt);await t(p.type),e.textContent=`‚úÖ ${p.name}`,setTimeout(()=>{e.textContent=`${p.emoji} ${p.name}`,e.disabled=!1},2e3)}catch(t){i("Error simulating weather:",t),e.textContent=`‚ùå ${p.name}`,setTimeout(()=>{e.textContent=`${p.emoji} ${p.name}`,e.disabled=!1},2e3)}});e.style.cssText="padding:4px 8px;font-size:10px;background:#333;border:1px solid #555",e.title=`Simulate ${p.name} weather for testing`,u.appendChild(e)}return l.append(c,u),n.appendChild(l),Ha.mutationStatus=o,t}function ei(e){!function(){if(document.getElementById(es))return;const e=document.createElement("style");e.id=es,e.textContent="@keyframes qpm-toast-in { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 0.95; } }",document.head.appendChild(e)}();const t=document.createElement("div");t.textContent=e,t.style.cssText="position:fixed;bottom:24px;right:24px;background:#2e7d32;color:#fff;padding:8px 12px;border-radius:6px;font-size:12px;z-index:2147483647;opacity:0.95;animation:qpm-toast-in 0.3s ease",document.body.appendChild(t),setTimeout(()=>t.remove(),2500)}function ti(e,t){const n=document.createElement("button");return n.textContent=e,n.style.cssText="padding:6px 10px;font-size:12px;cursor:pointer;border:none;border-radius:4px;background:#555;color:#fff;transition:background 0.2s",n.onmouseover=()=>{n.disabled||(n.style.background="#777")},n.onmouseout=()=>{n.disabled||(n.textContent?.includes("‚úì")?n.style.background="#4CAF50":n.style.background="#555")},n.onclick=t,n}function ni(e){Va=e,Ha.harvestStatus&&(Ha.harvestStatus.textContent=e),Ns()}function oi(e){if(!Ha.harvestSummary)return;const t=e.totalValue>0?`~${ir(e.totalValue)}`:"0";let n=`Matches: ${e.readyCount} ‚Ä¢ Value: ${t}`;if(e.highestValue){const{species:t,value:o,size:r,breakdownText:a,totalMultiplierText:s}=e.highestValue;n+=`<br>‚≠ê ${t} ‚Äî ${a?`${a} ‚Üí total x${s}`:`Total x${s}`} ‚Ä¢ size ${r} (~${ir(o)})`}else n+="<br>Waiting for sunny weather...";if(Ha.harvestSummary.innerHTML=n,!As.harvestReminder?.enabled)return;if(Xa)return;ni(e.readyCount>0?`Matches ready: ${e.readyCount}`:"Waiting for sunny weather..."),Ns()}function ri(){try{localStorage.setItem("quinoa-pet-manager",JSON.stringify(As))}catch{}}const ai="qpm.petXpObservations.v1",si=new Map,ii=new Map,li=new Map,ci=new Map;let ui=!1;const di=function(e,t=120){let n;return(...o)=>{clearTimeout(n),n=setTimeout(()=>e(...o),t)}}(()=>{try{d.set(ai,function(){const e=[];for(const[t,n]of ci){const o=Array.from(n.values()).sort((e,t)=>e.level-t.level).map(e=>({...e}));e.push({key:t,displayName:ii.get(t)??t,lastUpdated:li.get(t)??0,levels:o})}return{version:1,savedAt:Date.now(),species:e}}())}catch(e){i("‚ö†Ô∏è Failed to persist pet XP observations",e)}},2500);function pi(e,t,n,o,r,a){const s=c(e);if(!s)return;const i=Math.max(0,Math.round(t));if(!Number.isFinite(i))return;const l=Math.max(0,Math.round(n));if(!Number.isFinite(l))return;const u=(d=s,ci.has(d)||ci.set(d,new Map),ci.get(d));var d;const p=u.get(i);if(p){(l>p.xp||l===p.xp&&"level-up"===r&&"level-up"!==p.source)&&(p.xp=l,p.strength=o??p.strength??null,p.source=r),p.samples+=1,p.lastObservedAt=a}else u.set(i,{level:i,xp:l,strength:o??null,samples:1,lastObservedAt:a,source:r});ii.set(s,e),li.set(s,a),di()}function mi(e){const t=Date.now(),n=new Set;e.forEach((e,o)=>{const r=function(e,t){return e.slotId&&e.slotId.trim().length>0?`slot:${e.slotId}`:e.petId&&e.petId.trim().length>0?`pet:${e.petId}`:`index:${t}`}(e,o);n.add(r);const a=si.get(r),s=e.species??a?.species??null,i="number"==typeof e.level&&Number.isFinite(e.level)?e.level:null,l="number"==typeof e.xp&&Number.isFinite(e.xp)?e.xp:null,c="number"==typeof e.strength&&Number.isFinite(e.strength)?e.strength:null;if(a&&s&&a.species===s){const e=a.level,n=a.xp,o=a.strength;null!=e&&null!=i&&i>e&&null!=n&&n>0&&pi(s,e,n,o,"level-up",t)}if(s&&null!=i&&null!=l){const e=a?.xp,n=a?.level;(null==e||Math.round(e)!==Math.round(l)||(null==n||n!==i))&&pi(s,i,l,c,"snapshot",t)}si.set(r,{species:s,level:i,xp:l,strength:c})});for(const o of si.keys())n.has(o)||si.delete(o)}function fi(){if(!ui){ui=!0;try{const t=d.get(ai,null);(e=t??null)&&1===e.version&&(ci.clear(),ii.clear(),li.clear(),e.species.forEach(e=>{const t=new Map;e.levels.forEach(e=>{const n=Math.max(0,Math.round(e.level)),o=Number.isFinite(e.xp)?Math.max(0,Math.round(e.xp)):null;null!=o&&t.set(n,{level:n,xp:o,strength:e.strength??null,samples:Math.max(1,Math.round(e.samples??1)),lastObservedAt:e.lastObservedAt??0,source:"level-up"===e.source?"level-up":"snapshot"})}),0!==t.size&&(ci.set(e.key,t),ii.set(e.key,e.displayName??e.key),li.set(e.key,e.lastUpdated??Date.now()))}))}catch(t){i("‚ö†Ô∏è Failed to restore pet XP observations",t)}var e;Hn(),Wn(mi)}}const gi=[],hi={speciesXpPerLevel:{}};let bi=[];function yi(e,t,n,o,r){const a=e.strength??100,s=e.petId??"",i=e.species??"Unknown",l=Math.max(.25,a/100),c=o/60,u=o*l,d=c*l,p=Math.max(0,c/100),m=3600*Math.min(.95/60,p*l),f=r*l,g=m*f,h=gi.filter(e=>e.petId===s&&e.abilityId===t),b=h.length>0?h[h.length-1]:null;return{petId:s,petName:e.name??e.species??"Unknown",species:i,abilityId:t,abilityName:n,strength:a,baseXpPerProc:r,actualXpPerProc:f,baseChancePerMinute:o,actualChancePerMinute:u,baseChancePerSecond:c,actualChancePerSecond:d,expectedProcsPerHour:m,expectedXpPerHour:g,lastProcAt:b?.timestamp??null,procCount:h.length,level:e.level??null,currentXp:e.xp??null}}const xi={Worm:12,Snail:12,Bee:12,Chicken:24,Bunny:24,Dragonfly:24,Pig:72,Cow:72,Squirrel:100,Turtle:100,Goat:100,Butterfly:144,Peacock:144,Capybara:144};function wi(e){const t=xi[e];if(!t)return hi.speciesXpPerLevel[e]??null;return 3600*t/30}const vi={Peacock:2.5,Goat:2,Squirrel:2,Chicken:1.75,Pig:2.25,Cow:2.5,Sheep:2};function Ci(e,t){if(!e||e<1)return null;const n=function(e){return vi[e]??null}(t);if(!n||n<=1)return null;const o=20*((e-1)/(n-1))+80,r=Math.floor(o);return r<80||r>100?null:r}let Si=null,Ti=!1;function ki(e){if(!e||"object"!=typeof e)return null;const t=String(e.id??e.itemId??"");return t?{id:t,itemId:e.itemId,species:e.species??e.petSpecies??null,name:e.name??e.displayName??null,displayName:e.displayName??e.name??null,itemType:e.itemType??null,quantity:e.quantity??e.count??e.amount??e.stackSize,count:e.count,amount:e.amount,stackSize:e.stackSize,raw:e}:null}function Pi(e){const t=function(e){if(!e)return null;let t=[];if(Array.isArray(e))t=e;else if(Array.isArray(e.items))t=e.items;else if(Array.isArray(e.inventory))t=e.inventory;else if("object"==typeof e){const n=Object.values(e).find(e=>Array.isArray(e)&&e.length>0&&"object"==typeof e[0]);n&&(t=n)}const n=[];for(const r of t){const e=ki(r);e&&n.push(e)}let o=[];return Array.isArray(e?.favoritedItemIds)?o=e.favoritedItemIds.filter(e=>"string"==typeof e):Array.isArray(e?.favorites)&&(o=e.favorites.filter(e=>"string"==typeof e)),{items:n,favoritedItemIds:o}}(e);t&&(t.items,new Set(t.favoritedItemIds??[]))}h("QPM",{debugPets:()=>{const e=_n();return console.log("=== Active Pets Debug (v2024-11-13-DOM-STRENGTH) ==="),console.table(e.map(e=>({Slot:e.slotIndex,Name:e.name||e.species,Species:e.species,Level:e.level,Strength:e.strength,TargetScale:e.targetScale,Abilities:e.abilities.join(", "),Hunger:e.hungerPct?`${e.hungerPct.toFixed(1)}%`:"N/A"}))),console.log("Full normalized data:",e),console.log("\n=== Raw Data Inspection ==="),e.forEach((e,t)=>{if(console.log(`\nPet ${t} (${e.name}):`),console.log("Raw object:",e.raw),e.raw&&"object"==typeof e.raw){const t=e.raw;console.log("Available fields:",Object.keys(t)),t.slot&&"object"==typeof t.slot&&(console.log("slot fields:",Object.keys(t.slot)),console.log("slot.xp:",t.slot.xp)),t.pet&&"object"==typeof t.pet&&console.log("pet fields:",Object.keys(t.pet))}}),e},debugAllAtoms:()=>{try{const e=window.__qpmJotaiAtomCache__;if(!e||"function"!=typeof e.entries)return console.error("Jotai atom cache not available"),null;console.log("=== All Available Atoms ===");const t=[];for(const[o,r]of e.entries())if(r&&"object"==typeof r&&"debugLabel"in r){const n=r.debugLabel;"string"==typeof n&&t.push({label:n,hasValue:e.has(o)})}console.table(t),console.log("\n=== Pet-related Atoms ===");const n=t.filter(e=>e.label.toLowerCase().includes("pet"));return console.table(n),t}catch(e){return console.error("Failed to list atoms:",e),null}},checkTargetScale:()=>{const e=_n();return console.log("=== TargetScale Analysis ==="),console.log("Checking if targetScale might be strength-related...\n"),e.forEach((e,t)=>{const n=e.targetScale??0,o=e.xp??0,r=Math.round(50*n),a=Math.round(100*(n-1)),s=Math.round(45*n+5);console.log(`Pet ${t}: ${e.name}`),console.log(`  XP: ${o}`),console.log(`  TargetScale: ${n.toFixed(6)}`),console.log(`  Possible STR (√ó50): ${r}`),console.log(`  Possible STR ((x-1)√ó100): ${a}`),console.log(`  Possible STR (√ó45+5): ${s}\n`)}),e},debugSlotInfos:()=>{try{const e=window.__qpmJotaiAtomCache__,t=window.__qpmJotaiStore__;if(!e||!t)return console.error("Jotai cache/store not available"),null;console.log("=== myPetSlotInfosAtom Data ===");let n=null;for(const[r,a]of e.entries())if(a&&"object"==typeof a&&"debugLabel"in a){if("myPetSlotInfosAtom"===a.debugLabel){n=r;break}}if(!n)return console.error("myPetSlotInfosAtom not found in cache"),null;const o=t.get(n);return console.log("Raw value:",o),Array.isArray(o)&&(console.log(`\nFound ${o.length} entries:\n`),o.forEach((e,t)=>{console.log(`Entry ${t}:`,e),e&&"object"==typeof e&&(console.log("  Fields:",Object.keys(e)),"slot"in e&&e.slot&&"object"==typeof e.slot&&console.log("  slot fields:",Object.keys(e.slot)),"pet"in e&&e.pet&&"object"==typeof e.pet&&console.log("  pet fields:",Object.keys(e.pet)),"stats"in e&&e.stats&&"object"==typeof e.stats&&(console.log("  stats fields:",Object.keys(e.stats)),console.log("  stats content:",e.stats)))})),o}catch(e){return console.error("Failed to inspect myPetSlotInfosAtom:",e),null}},debugPetInventory:()=>{try{const t=window.__qpmJotaiAtomCache__,n=window.__qpmJotaiStore__;if(!t||!n)return console.error("Jotai cache/store not available"),null;console.log("=== Pet Inventory & Hutch Atoms ===\n");const o=["myPetInventoryAtom","myPetHutchPetItemsAtom","myPrimitivePetSlotsAtom","petInfosAtom"],r={};for(const a of o){console.log(`\n--- ${a} ---`);let o=null;for(const[e,n]of t.entries())if(n&&"object"==typeof n&&"debugLabel"in n){if(n.debugLabel===a){o=e;break}}if(o)try{const e=n.get(o);if(r[a]=e,console.log("Value:",e),Array.isArray(e)&&e.length>0){const t=e[0];t&&"object"==typeof t&&(console.log("First entry fields:",Object.keys(t)),"pet"in t&&t.pet&&"object"==typeof t.pet&&(console.log("  pet fields:",Object.keys(t.pet)),console.log("  pet sample:",t.pet)),"stats"in t&&t.stats&&"object"==typeof t.stats&&(console.log("  stats fields:",Object.keys(t.stats)),console.log("  stats sample:",t.stats)),"slot"in t&&t.slot&&"object"==typeof t.slot&&console.log("  slot fields:",Object.keys(t.slot)))}}catch(e){console.error(`Error reading ${a}:`,e)}else console.log(`${a} not found`)}return r}catch(e){return console.error("Failed to inspect pet atoms:",e),null}},searchPageWindow:()=>{try{const e=window.unsafeWindow||window;console.log("=== Searching Page Window for Pet Data ===\n");const t=["myData","myPets","activePets","petData","pets","UnifiedState","gameState","quinoaData"],n={};for(const r of t)if(r in e){console.log(`\nFound: ${r}`);const t=e[r];if(console.log("Type:",typeof t),t&&"object"==typeof t&&(console.log("Keys:",Object.keys(t).slice(0,20)),n[r]=t,"pets"in t&&console.log("  ‚Üí has pets property:",t.pets),"activePets"in t&&console.log("  ‚Üí has activePets property:",t.activePets),"inventory"in t&&t.inventory)){console.log("  ‚Üí has inventory property");const e=t.inventory;if(e&&"object"==typeof e&&"items"in e){const t=e.items;if(Array.isArray(t)){console.log(`  ‚Üí inventory has ${t.length} items`);const e=t.filter(e=>e&&"object"==typeof e&&("Pet"===e.itemType||"Pet"===e.type||"petSpecies"in e||"species"in e));e.length>0&&(console.log(`  ‚Üí Found ${e.length} pet items in inventory`),console.log("  ‚Üí First pet item:",e[0]),console.log("  ‚Üí First pet fields:",Object.keys(e[0])))}}}}console.log("\n=== Searching all window properties ===");const o=Object.keys(e).filter(e=>e.toLowerCase().includes("pet")||e.toLowerCase().includes("animal")||e.toLowerCase().includes("creature"));return console.log("Pet-related keys:",o),n}catch(e){return console.error("Failed to search page window:",e),null}},inspectPetCards:()=>{try{console.log("=== Inspecting Pet Card UI Elements ===\n");const e=["[data-pet-slot]","[data-pet-id]","[data-slot-index]",".pet-card",".pet-slot",'[class*="pet"]','[class*="Pet"]'],t=[];for(const n of e){const e=document.querySelectorAll(n);e.length>0&&(console.log(`Found ${e.length} elements with selector: ${n}`),e.forEach(e=>{e instanceof HTMLElement&&!t.includes(e)&&t.push(e)}))}return console.log(`\nTotal unique pet card elements found: ${t.length}\n`),t.slice(0,10).forEach((e,t)=>{console.log(`\n--- Element ${t} ---`),console.log("Tag:",e.tagName),console.log("Classes:",e.className),console.log("Text content:",e.textContent?.substring(0,200)),console.log("Data attributes:",Object.keys(e.dataset));const n=e.textContent||"",o=n.match(/(?:level|lvl|lv)[:\s]*(\d+)/i),r=n.match(/(?:str|strength)[:\s]*(\d+)/i),a=n.match(/(?:age)[:\s]*(\d+)/i);o&&console.log("  ‚Üí Found level:",o[1]),r&&console.log("  ‚Üí Found strength:",r[1]),a&&console.log("  ‚Üí Found age:",a[1])}),t}catch(e){return console.error("Failed to inspect pet cards:",e),null}},findPetDataInDOM:()=>{try{console.log("=== Searching DOM for Pet Level/Strength Data ===\n");const e=_n().map(e=>e.name).filter(Boolean);console.log("Looking for pets:",e);const t=document.querySelectorAll("*"),n=[];for(const o of t){const t=o.textContent?.toLowerCase()||"";if(!(t.length>500)){for(const r of e)if(r&&t.includes(r.toLowerCase())){n.push({el:o,reason:`Contains pet name: ${r}`});break}/\b(age|level|lvl|lv|str|strength|max str)\b/i.test(t)&&n.push({el:o,reason:"Contains level/strength keywords"})}}return console.log(`\nFound ${n.length} potentially relevant elements\n`),n.slice(0,15).forEach(({el:e,reason:t},n)=>{console.log(`\n--- Element ${n} ---`),console.log("Reason:",t),console.log("Tag:",e.tagName),console.log("Classes:",e.className),console.log("Text (first 300 chars):",e.textContent?.substring(0,300));const o=e.textContent||"",r=o.match(/age[:\s]*(\d+)/i),a=o.match(/(?:max\s+)?str[:\s]*(\d+)/i),s=o.match(/(?:level|lvl|lv)[:\s]*(\d+)/i);r&&console.log("  ‚úì Age:",r[1]),a&&console.log("  ‚úì Strength:",a[1]),s&&console.log("  ‚úì Level:",s[1])}),n}catch(e){return console.error("Failed to search DOM:",e),null}},extractStrengthFromUI:()=>{try{console.log("=== Extracting Strength from Pet Card UI ===\n");const e=_n(),t=[],n=Array.from(document.querySelectorAll("*"));for(const o of e){const e=o.name||o.species||`Pet ${o.slotIndex}`;let r=null,a=null;for(const t of n){const e=t.textContent||"";if(e.length>100)continue;const n=e.match(/\bSTR\s+(\d+)\b/i);if(n&&n[1]){const o=parseInt(n[1],10);console.log(`Found STR ${o} in element:`,t),console.log("  Tag:",t.tagName),console.log("  Classes:",t.className),console.log("  Text:",e.trim()),console.log("  Parent:",t.parentElement?.className),r||(r=o,a=t)}}t.push({pet:e,strength:r,element:a})}return console.log("\n=== Extracted Strength Values ==="),console.table(t.map(e=>({Pet:e.pet,Strength:e.strength??"Not found"}))),t}catch(e){return console.error("Failed to extract strength from UI:",e),null}},debugLevels:()=>{try{console.log("=== Pet Level Calculation Debug ===\n");const e=_n();return e.forEach((e,t)=>{if(console.log(`\n--- Pet ${t}: ${e.name} (${e.species}) ---`),console.log(`XP: ${e.xp??"N/A"}`),console.log(`Strength: ${e.strength??"N/A"}`),console.log(`Level (Jotai): ${e.level??"null"}`),e.petId){const t=(n=e.petId,bn.get(n)??[]);if(console.log(`XP History: ${t.length} samples`),t.length>=2){const e=t[0],n=t[t.length-1],o=n.xp-e.xp,r=(n.timestamp-e.timestamp)/1e3,a=o/r;console.log(`  First sample: ${e.xp} XP at ${new Date(e.timestamp).toLocaleTimeString()}`),console.log(`  Last sample: ${n.xp} XP at ${new Date(n.timestamp).toLocaleTimeString()}`),console.log(`  XP gained: ${o.toFixed(0)} over ${r.toFixed(0)}s`),console.log(`  XP rate: ${a.toFixed(2)} XP/sec`)}const o=xn(e);if(console.log("\nLevel Estimate:"),console.log(`  Current Level: ${o.currentLevel??"N/A"} / ${o.maxLevel}`),console.log(`  Confidence: ${o.confidence}`),console.log(`  Total XP Needed: ${o.totalXPNeeded?.toFixed(0)??"N/A"}`),console.log(`  XP Rate: ${o.xpGainRate?.toFixed(2)??"N/A"} XP/sec`),o.totalXPNeeded&&e.xp){const t=e.xp/o.totalXPNeeded*100;console.log(`  Progress: ${t.toFixed(1)}%`)}}var n}),e}catch(e){return console.error("Failed to debug levels:",e),null}}}),i("‚úÖ QPM debug API registered (use QPM.debugPets() in console)");const Mi={logs:!0,ui:{preventScrollClicks:!0},inventoryLocker:{syncMode:!0},mutationReminder:{enabled:!0,showNotifications:!0,highlightPlants:!0},turtleTimer:{enabled:!0,includeBoardwalk:!1,minActiveHungerPct:2,fallbackTargetScale:1.5,focus:"latest"}};const Ei=function(){try{return JSON.parse(localStorage.getItem("quinoa-pet-manager")||"{}")}catch{return{}}}(),$i={...Mi,...Ei,ui:{...Mi.ui,...Ei.ui||{}},inventoryLocker:{...Mi.inventoryLocker,...Ei.inventoryLocker||{}},mutationReminder:{...Mi.mutationReminder,...Ei.mutationReminder||{}},turtleTimer:{...Mi.turtleTimer,...Ei.turtleTimer||{}}};window.addEventListener("error",e=>{try{if(String(e?.message||"").includes("Failed to execute 'contains' on 'Node'"))return e.stopImmediatePropagation?.(),e.preventDefault?.(),!1}catch{}return!0},!0),async function(){i("üöÄ Quinoa Pet Manager initializing..."),await async function(){i("‚è≥ Waiting for game to load..."),await t,await e(100);const n=Date.now()+3e4;for(;Date.now()<n;){const t=s();if(t&&t.querySelector("canvas, button, [data-tm-main-interface], [data-tm-hud-root], [data-tm-player-id]"))return void i("‚úÖ Game UI detected");if(document.querySelector("#App canvas"))return void i("‚úÖ Game UI detected");await e(500)}i("‚ö†Ô∏è Game UI not detected within timeout, proceeding anyway")}(),Jr(),fi(),function(){try{const e=d.get("qpm.xpTrackerProcs.v1",null);e?.procs&&gi.splice(0,gi.length,...e.procs);const t=d.get("qpm.xpTrackerConfig.v1",null);t?.speciesXpPerLevel&&Object.assign(hi.speciesXpPerLevel,t.speciesXpPerLevel)}catch(e){i("‚ö†Ô∏è Failed to restore XP tracker data",e)}}(),await async function(){if(!Si&&!Ti){Ti=!0;try{let e=E("myInventoryAtom");if(e||(i("‚ö†Ô∏è myInventoryAtom not found, trying myCropInventoryAtom"),e=E("myCropInventoryAtom")),!e)return i("‚ö†Ô∏è Inventory atom not found"),void(Ti=!1);Si=await A(e,e=>{Pi(e)}),i("‚úÖ Inventory store initialized")}catch(e){i("‚ùå Failed to initialize inventory store",e)}finally{Ti=!1}}}(),se(),await Jt(),No($i.turtleTimer),ot(),Zt||(Zt=!0,i("üåø Garden mutation tracker starting..."),on=ke(),on&&(tn=mn(on.kind)),en=Yt(),Pe(e=>{const t=on;on=e;const n=mn(e.kind),o=n!==tn,r=!t||t.startedAt!==e.startedAt||t.expectedEndAt!==e.expectedEndAt||t.hash!==e.hash;o?(tn=n,an()):r&&"unknown"!==n&&an()}),Qt(e=>{en=e,an()},!0),an(),i("üåø Garden mutation tracker ready")),zo($i.turtleTimer),As=$i,Is(),i("‚úÖ Quinoa Pet Manager initialized successfully")}().catch(e=>{console.error("[QuinoaPetMgr] Initialization failed:",e)});const Ai=["PetXpBoost","PetXpBoostII"];function Ii(e){const t=[];if(!e.abilities||0===e.abilities.length)return t;for(const n of e.abilities){if(!n)continue;const e=oa(n);e&&("continuous"===e.trigger&&Ai.includes(e.id)&&t.push({ability:e,rawName:n}))}return t}function Fi(e,t,n=!0){const o=document.createElement("div");o.style.cssText="\n    border-bottom: 1px solid var(--qpm-border, #444);\n  ";const r=document.createElement("div");r.style.cssText="\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 10px 16px;\n    background: var(--qpm-surface-2, #222);\n    cursor: pointer;\n    user-select: none;\n  ";const a=document.createElement("div");a.textContent=e,a.style.cssText="\n    color: var(--qpm-text, #fff);\n    font-size: 13px;\n    font-weight: 600;\n  ";const s=document.createElement("span");s.textContent=n?"‚ñº":"‚ñ≤",s.style.cssText="\n    color: var(--qpm-text-muted, #aaa);\n    font-size: 10px;\n  ",r.appendChild(a),r.appendChild(s);const i=document.createElement("div");i.style.cssText=`\n    display: ${n?"block":"none"};\n    padding: 0;\n  `;const l=()=>{const e="block"===i.style.display;i.style.display=e?"none":"block",s.textContent=e?"‚ñ≤":"‚ñº"};return r.onclick=l,o.appendChild(r),o.appendChild(i),{root:o,content:i,toggle:l}}function qi(e){e.petLevelTbody.innerHTML="",e.tbody.innerHTML="";const t=[];console.log("üîç XP Tracker Debug - Active Pets:",e.latestPets.length),e.latestPets.forEach((e,t)=>{console.log(`Pet ${t+1}: ${e.name||e.species}`,{species:e.species,abilities:e.abilities,level:e.level,levelRaw:e.levelRaw,xp:e.xp,strength:e.strength,slotIndex:e.slotIndex,petId:e.petId,rawData:e.raw})});for(const a of e.latestPets){const e=Ii(a);console.log(`Found ${e.length} XP abilities for ${a.name||a.species}:`,e.map(e=>e.ability.name));for(const{ability:n,rawName:o}of e){const e=yi(a,n.id,o,n.baseProbability??0,n.effectValuePerProc??0);t.push(e)}}e.latestStats=t;const n=t.length>0?function(e){const t=e.reduce((e,t)=>e+t.expectedXpPerHour,0),n=e.reduce((e,t)=>e+t.expectedProcsPerHour,0),o=100*(1-e.map(e=>e.actualChancePerSecond/100).reduce((e,t)=>e*(1-t),1)),r=60*o,a=e.map(e=>e.lastProcAt).filter(e=>null!==e);return{totalXpPerHour:t,totalProcsPerHour:n,combinedChancePerSecond:o,combinedChancePerMinute:r,lastProcAt:a.length>0?Math.max(...a):null,totalProcCount:e.reduce((e,t)=>e+t.procCount,0)}}(t):null;if(e.totalTeamXpPerHour=n?n.totalXpPerHour:0,0===t.length)e.tbody.innerHTML='\n      <div style="color: var(--qpm-warning, #FF9800); font-style: italic;">\n        ‚ö†Ô∏è No pets with XP Boost abilities detected. Equip pets with XP Boost I or XP Boost II to generate team-wide XP.\n      </div>\n    ';else{const o=t.map(e=>`${e.petName} (${e.abilityName}, ${e.actualChancePerMinute.toFixed(2)}%/min)`).join(", ");e.tbody.innerHTML=`\n      <div style="margin-bottom: 8px;">\n        <strong style="color: var(--qpm-accent, #4CAF50);">Total XP Generation:</strong>\n        <span style="color: var(--qpm-warning, #FF9800); font-weight: 600; font-family: monospace;">${ir(e.totalTeamXpPerHour)} XP/Hour</span>\n        <span style="color: var(--qpm-text-muted, #aaa); font-size: 11px; margin-left: 8px;">(~${n.totalProcsPerHour.toFixed(1)} procs/hour)</span>\n      </div>\n      <div style="margin-bottom: 8px;">\n        <strong style="color: var(--qpm-accent, #4CAF50);">Combined Chance:</strong>\n        <span style="color: var(--qpm-accent, #4CAF50); font-weight: 600; font-family: monospace;">${n.combinedChancePerMinute.toFixed(2)}%/min</span>\n        <span style="color: var(--qpm-text-muted, #aaa); font-size: 11px; margin-left: 8px;">(~${n.totalProcsPerHour.toFixed(1)} procs/hr)</span>\n      </div>\n      <div style="margin-bottom: 6px; color: var(--qpm-text-muted, #aaa); font-size: 11px; font-style: italic;">\n        Note: Combined chance is statistical (‚â•1 proc/sec). Each ability rolls independently.\n      </div>\n      <div>\n        <strong style="color: var(--qpm-accent, #4CAF50);">XP Boost Pets:</strong>\n        <span style="color: var(--qpm-text, #fff);">${o}</span>\n      </div>\n    `}0===t.length?e.summaryText.textContent="‚ö†Ô∏è No pets with XP Boost abilities detected. Equip pets with XP Boost I or XP Boost II.":e.summaryText.innerHTML=`\n      <strong>Total XP/Hour:</strong> ${ir(e.totalTeamXpPerHour)} XP ‚Ä¢\n      <strong>Combined Chance:</strong> ${n.combinedChancePerMinute.toFixed(2)}%/min ‚Ä¢\n      <strong>Active Pets:</strong> ${e.latestPets.length} (${t.length} with XP Boost)\n    `;for(const a of e.latestPets)Ni(e.petLevelTbody,a,e.totalTeamXpPerHour);const o=new Set;for(const a of e.latestPets)a.species&&o.add(a.species);const r={...hi.speciesXpPerLevel};for(const a of Object.keys(r))o.add(a);e.lastKnownSpecies=o}function Ni(e,t,n){const o=e.insertRow();o.style.cssText="border-bottom: 1px solid var(--qpm-border, #444);";const r=o.insertCell(),a=t.species&&t.targetScale?Ci(t.targetScale,t.species):null,s=t.name||t.species||"Unknown";a?r.innerHTML=`\n      <div style="font-weight: 500; color: var(--qpm-text, #fff);">${s}</div>\n      <div style="font-size: 10px; color: var(--qpm-text-muted, #888); margin-top: 2px;">MAX STR ${a}</div>\n    `:r.textContent=s,r.style.cssText="\n    padding: 10px 12px;\n    color: var(--qpm-text, #fff);\n  ",r.title=`Slot: ${t.slotIndex}\nPet ID: ${t.petId||"N/A"}\nStrength: ${t.strength??"N/A"}${a?`\nMAX STR: ${a}`:""}${t.targetScale?`\nTarget Scale: ${t.targetScale.toFixed(2)}`:""}`;const i=o.insertCell();i.textContent=t.species||"‚Äî",i.style.cssText="\n    padding: 10px 12px;\n    color: var(--qpm-text-muted, #aaa);\n  ";const l=o.insertCell(),c=Ii(t);if(c.length>0){const e=c.map(e=>e.rawName).join(", ");l.textContent=e,l.style.cssText="\n      padding: 10px 12px;\n      color: var(--qpm-accent, #4CAF50);\n      font-size: 11px;\n    ",l.title="This pet generates XP for the team"}else l.textContent="‚Äî",l.style.cssText="\n      padding: 10px 12px;\n      color: var(--qpm-text-muted, #666);\n      font-size: 11px;\n    ";const u=o.insertCell();null!==t.strength&&void 0!==t.strength?(u.textContent=String(t.strength),u.style.cssText="\n      padding: 10px 12px;\n      text-align: right;\n      color: var(--qpm-accent, #4CAF50);\n      font-family: monospace;\n      font-weight: 600;\n    ",u.title=`Current Strength: ${t.strength}\n(Strength increases by 1 each time XP threshold is reached)`):(u.textContent="‚ö†Ô∏è ‚Äî",u.style.cssText="\n      padding: 10px 12px;\n      text-align: right;\n      color: var(--qpm-warning, #FF9800);\n      font-family: monospace;\n      font-weight: 600;\n    ",u.title="Strength data not available");const d=o.insertCell();d.textContent=null!==t.xp?ir(t.xp):"‚Äî",d.style.cssText="\n    padding: 10px 12px;\n    text-align: right;\n    color: var(--qpm-warning, #FF9800);\n    font-family: monospace;\n  ";const p=o.insertCell();if(p.style.cssText="\n    padding: 10px 12px;\n    text-align: right;\n    color: var(--qpm-text, #fff);\n    min-width: 200px;\n  ",t.species&&null!==t.xp&&null!==t.strength){const e=wi(t.species);if(e){const n=Ci(t.targetScale,t.species),o=t.xp%e,r=o/e*100,a=Math.floor(t.xp/e);n&&t.strength>=n?(p.innerHTML=`\n          <div style="color: var(--qpm-accent, #4CAF50); font-weight: 600; font-size: 12px;">üåü MAX STR ${n}</div>\n          <div style="font-size: 10px; color: var(--qpm-text-muted, #aaa); margin-top: 2px;">No further STR gains</div>\n        `,p.title=`Pet is at MAX Strength (${n})\nTotal XP: ${ir(t.xp)}\nLevels gained from hatch: ${a}${t.targetScale?`\nTarget Scale: ${t.targetScale.toFixed(2)}`:""}`):(p.innerHTML=`\n          <div style="font-size: 11px; margin-bottom: 4px;">${ir(o)} / ${ir(e)} (${Math.min(100,r).toFixed(1)}%)</div>\n          <div style="width: 100%; height: 8px; background: #333; border-radius: 4px; overflow: hidden;">\n            <div style="width: ${Math.min(100,r).toFixed(1)}%; height: 100%; background: linear-gradient(90deg, #4CAF50, #8BC34A);"></div>\n          </div>\n        `,p.title=`Total XP: ${ir(t.xp)}\nLevels gained from hatch: ${a}${n?`\nMAX STR: ${n}`:""}${t.targetScale?`\nTarget Scale: ${t.targetScale.toFixed(2)}`:""}`)}else p.innerHTML='<span style="color: var(--qpm-text-muted, #aaa); font-size: 11px;">Configure XP/level</span>'}else p.textContent="‚Äî";const m=o.insertCell();if(m.style.cssText="\n    padding: 10px 12px;\n    text-align: right;\n    color: var(--qpm-text, #fff);\n    font-family: monospace;\n    font-weight: 500;\n  ",t.species&&null!==t.xp&&null!==t.strength){const e=wi(t.species);if(e){const o=Ci(t.targetScale,t.species);if(o&&t.strength>=o)m.innerHTML='<span style="color: var(--qpm-accent, #4CAF50); font-weight: 600;">‚Äî</span>',m.title="Pet is at MAX Strength - no further STR gains possible";else if(n>0){const o=t.xp%e,r=function(e,t,n){if(n<=0||e>=t)return null;const o=(t-e)/n,r=60*o,a=Math.floor(o);return{hours:a,minutes:Math.round(60*(o-a)),totalMinutes:r}}(o,e,n);r?m.innerHTML=`\n            <div style="color: var(--qpm-positive, #4CAF50);">${r.hours}h ${r.minutes}m</div>\n            <div style="font-size: 10px; color: var(--qpm-text-muted, #aaa); margin-top: 2px;">${ir(n)} XP/hr</div>\n          `:o>=e?m.innerHTML='<span style="color: var(--qpm-accent, #4CAF50); font-weight: 600;">Ready!</span>':m.textContent="‚Äî"}else 0===n?m.innerHTML='<span style="color: var(--qpm-text-muted, #aaa); font-size: 11px;">No XP boost</span>':m.textContent="‚Äî"}else m.innerHTML='<span style="color: var(--qpm-text-muted, #aaa); font-size: 11px;">‚Äî</span>'}else m.textContent="‚Äî"}const zi=Object.freeze(Object.defineProperty({__proto__:null,createXpTrackerWindow:function(){const e=document.createElement("div");e.style.cssText="\n    position: fixed;\n    top: 80px;\n    right: 20px;\n    width: 850px;\n    max-height: 80vh;\n    overflow-y: auto;\n    background: var(--qpm-background, rgba(0, 0, 0, 0.92));\n    border: 2px solid var(--qpm-border, #555);\n    border-radius: 8px;\n    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);\n    z-index: 10002;\n    font-family: Arial, sans-serif;\n    display: none;\n  ";const t=document.createElement("div");t.style.cssText="\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 12px 16px;\n    background: var(--qpm-surface-1, #1a1a1a);\n    border-bottom: 2px solid var(--qpm-border, #555);\n    cursor: move;\n  ";const n=document.createElement("h3");n.textContent="‚ú® XP Tracker",n.style.cssText="\n    margin: 0;\n    color: var(--qpm-text, #fff);\n    font-size: 16px;\n    font-weight: 600;\n  ";const o=document.createElement("button");o.textContent="‚úï",o.style.cssText="\n    background: transparent;\n    border: none;\n    color: var(--qpm-text, #fff);\n    font-size: 20px;\n    cursor: pointer;\n    padding: 0 8px;\n    line-height: 1;\n  ",o.onclick=()=>{e.style.display="none"},t.appendChild(n),t.appendChild(o),e.appendChild(t);const r=document.createElement("div");r.style.cssText="\n    padding: 12px 16px;\n    background: var(--qpm-surface-1, #1a1a1a);\n    border-bottom: 1px solid var(--qpm-border, #444);\n  ";const a=document.createElement("div");a.style.cssText="\n    color: var(--qpm-text, #fff);\n    font-size: 13px;\n    line-height: 1.6;\n  ",a.textContent="Loading XP data...",r.appendChild(a),e.appendChild(r);const s=Fi("üêæ All Active Pets"),i=function(){const e=document.createElement("table");e.style.cssText="\n    width: 100%;\n    border-collapse: collapse;\n    font-size: 12px;\n  ";const t=document.createElement("thead");t.innerHTML='\n    <tr style="background: var(--qpm-surface-2, #222); border-bottom: 2px solid var(--qpm-border, #555);">\n      <th style="padding: 10px 12px; text-align: left; color: var(--qpm-text, #fff); font-weight: 600;">Pet</th>\n      <th style="padding: 10px 12px; text-align: left; color: var(--qpm-text, #fff); font-weight: 600;">Species</th>\n      <th style="padding: 10px 12px; text-align: left; color: var(--qpm-text, #fff); font-weight: 600;">XP Ability</th>\n      <th style="padding: 10px 12px; text-align: right; color: var(--qpm-text, #fff); font-weight: 600;">Strength</th>\n      <th style="padding: 10px 12px; text-align: right; color: var(--qpm-text, #fff); font-weight: 600;">Current XP</th>\n      <th style="padding: 10px 12px; text-align: right; color: var(--qpm-text, #fff); font-weight: 600;">Progress to Next STR</th>\n      <th style="padding: 10px 12px; text-align: right; color: var(--qpm-text, #fff); font-weight: 600;">Time to Next STR</th>\n    </tr>\n  ';const n=document.createElement("tbody");return e.appendChild(t),e.appendChild(n),e}(),l=i.querySelector("tbody");s.content.appendChild(i),e.appendChild(s.root);const c=Fi("‚ú® XP Generation Summary"),u=document.createElement("div");u.style.cssText="\n    padding: 12px 16px;\n    color: var(--qpm-text, #fff);\n    font-size: 12px;\n    line-height: 1.6;\n  ",c.content.appendChild(u),e.appendChild(c.root);const d=u,p=document.createElement("tbody");document.body.appendChild(e),function(e,t){let n=0,o=0,r=0,a=0;function s(e){e.preventDefault(),r=e.clientX,a=e.clientY,document.onmouseup=l,document.onmousemove=i}function i(t){t.preventDefault(),n=r-t.clientX,o=a-t.clientY,r=t.clientX,a=t.clientY,e.style.top=e.offsetTop-o+"px",e.style.left=e.offsetLeft-n+"px"}function l(){document.onmouseup=null,document.onmousemove=null}t.onmousedown=s}(e,t);const m={root:e,summaryText:a,petLevelTbody:l,tbody:d,combinedTbody:p,updateInterval:null,latestPets:[],latestStats:[],totalTeamXpPerHour:0,lastKnownSpecies:new Set,unsubscribePets:null,unsubscribeXpTracker:null};var f;return m.unsubscribePets=Wn(e=>{m.latestPets=e,qi(m)}),m.unsubscribeXpTracker=(f=()=>{!function(e){e.petLevelTbody.innerHTML="";for(const t of e.latestPets)Ni(e.petLevelTbody,t,e.totalTeamXpPerHour)}(m)},bi.push(f),()=>{bi=bi.filter(e=>e!==f)}),m.updateInterval=window.setInterval(()=>{!function(e){const t=e.root.querySelectorAll(".eta-countdown");t.forEach(e=>{const t=parseInt(e.dataset.lastProc??"0",10),n=parseFloat(e.dataset.effectiveRate??"0");if(!n||n<=0)return;const o=ja(t||null,60/n,n);e.textContent=o.text,e.style.color=o.isOverdue?"var(--qpm-danger, #f44336)":e.classList.contains("combined")?"var(--qpm-accent, #4CAF50)":"var(--qpm-positive, #4CAF50)"})}(m)},1e3),m},hideXpTrackerWindow:function(e){e.root.style.display="none"},showXpTrackerWindow:function(e){e.root.style.display="block",qi(e)}},Symbol.toStringTag,{value:"Module"}))}();

})();