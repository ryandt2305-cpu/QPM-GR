// ==UserScript==
// @name         QPM (ALPHA)
// @namespace    Quinoa
// @version      3.0.57
// @description  Quality-of-life enhancements for Magic Garden: crop type locking, mutation tracking, value calculator, harvest reminders, journal species checker, and persistent feed statistics.
// @author       TOKYO.#6464
// @match        https://1227719606223765687.discordsays.com/*
// @match        https://magiccircle.gg/r/*
// @match        https://magicgarden.gg/r/*
// @match        https://starweaver.org/r/*
// @connect      magicgarden.gg
// @connect      magiccircle.gg
// @connect      starweaver.org
// @connect      1227719606223765687.discordsays.com
// @connect      ariesmod-api.ariedam.fr
// @updateURL    https://raw.githubusercontent.com/ryandt2305-cpu/QPM-GR/master/dist/QPM.user.js
// @downloadURL  https://raw.githubusercontent.com/ryandt2305-cpu/QPM-GR/master/dist/QPM.user.js
// @run-at       document-start
// @inject-into  page
// @grant        GM_xmlhttpRequest
// @grant        GM_registerMenuCommand
// @grant        GM_setValue
// @grant        GM_getValue
// @grant        GM_deleteValue
// @grant        GM_listValues
// @connect      raw.githubusercontent.com
// @grant        GM_openInTab
// @grant        unsafeWindow
// ==/UserScript==

(function() {

!function(){"use strict";const e=e=>new Promise(t=>setTimeout(t,e)),t=new Promise(e=>{"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>e(),{once:!0}):e()});function n(e,t,{root:n=document,callForExisting:o=!0}={}){const r=n=>{for(const o of n){if(o.nodeType!==Node.ELEMENT_NODE)continue;const n=o;if(("string"==typeof e?n.matches(e):e(n))&&t(n),"string"==typeof e){n.querySelectorAll(e).forEach(t)}else{Array.from(n.querySelectorAll("*")).filter(e).forEach(t)}}};if(o){("string"==typeof e?Array.from(n.querySelectorAll(e)):Array.from(n.querySelectorAll("*")).filter(e)).forEach(t)}const i=new MutationObserver(e=>{for(const t of e)r(t.addedNodes)});return i.observe(n,{childList:!0,subtree:!0}),{disconnect:()=>i.disconnect()}}function o(e,t,{root:n=document}={}){const o=new MutationObserver(n=>{for(const o of n)for(const n of o.removedNodes){if(n.nodeType!==Node.ELEMENT_NODE)continue;const o=n;o.matches(e)&&t(o)}});return o.observe(n,{childList:!0,subtree:!0}),{disconnect:()=>o.disconnect()}}function r(e,t,n={}){const o=new MutationObserver(()=>t(e));return o.observe(e,{attributes:!0,childList:!0,subtree:!0,...n}),{disconnect:()=>o.disconnect()}}const i=["#App .QuinoaUI","#App [data-tm-main-interface]","#App [data-tm-hud-root]","#App [data-mc-app-shell]","#App > div.McFlex.css-neeqas","#App > div.McFlex.css-1k630i1","#App > div.McFlex"];function a(){for(const n of i){const e=document.querySelector(n);if(e instanceof HTMLElement)return e}const e=document.getElementById("App");if(!e)return null;const t=e.querySelector("div.McFlex");return t instanceof HTMLElement?t:e instanceof HTMLElement?e:null}const s=function(e,t=!0){const n=(...t)=>{n.enabled&&console.log(`[${e}]`,...t)};return n.enabled=t,n}("QuinoaPetMgr");function l(){return new Promise(e=>{setTimeout(e,0)})}function c(e){return new Promise(t=>setTimeout(t,e))}class d{constructor(e=16,t=100){this.lastYield=0,this.workCount=0,this.yieldInterval=e,this.workThreshold=t,this.lastYield=performance.now()}async yieldIfNeeded(){this.workCount++;(performance.now()-this.lastYield>=this.yieldInterval||this.workCount>=this.workThreshold)&&(await l(),this.lastYield=performance.now(),this.workCount=0)}async forceYield(){await l(),this.lastYield=performance.now(),this.workCount=0}reset(){this.lastYield=performance.now(),this.workCount=0}}function p(e,t){let n=0,o=null,r=null;return(...i)=>{const a=Date.now(),s=a-n;s>=t?(n=a,e(...i)):(o=i,r||(r=setTimeout(()=>{r=null,o&&(n=Date.now(),e(...o),o=null)},t-s)))}}const u=["qpm.shopRestocks.v1","qpm.shopRestockConfig.v1","qpm.shopRestocks.migration","qpm.xpTrackerProcs.v1","qpm.xpTrackerConfig.v1","qpm.petXpObservations.v1","qpm.autoFavorite.v1","qpm.petHatchingTracker.knownPetIds.v1","quinoa:stats:v1","qpm.mutationValueTracking.v1","qpm.weatherMutationTracking.v1","quinoa-pet-food-rules","quinoa-ui-panel-position","quinoa-ui-panel-collapsed","quinoa-ui-notifications-collapsed","quinoa-ui-notifications-detail-expanded","quinoa-ui-tracker-target-mode","quinoa-ui-tracker-target-pet","quinoa-ui-tracker-ability-filter","quinoa-ui-mutation-tracker-source","quinoa-ui-mutation-tracker-detail","qpm-tracker-settings","quinoa-pet-manager","quinoaData"],g={get(e,t=null){try{if("function"==typeof GM_getValue){const n=GM_getValue(e);if(null==n)return t;try{return JSON.parse(n)}catch{return n}}}catch{}try{const n=localStorage.getItem(e);return null==n?t:JSON.parse(n)}catch{return t}},set(e,t){try{if("function"==typeof GM_setValue)return void GM_setValue(e,JSON.stringify(t))}catch{}try{localStorage.setItem(e,JSON.stringify(t))}catch{}},clear(){let e=0;try{if("function"==typeof GM_deleteValue&&"function"==typeof GM_listValues){const t=GM_listValues();for(const n of t)(u.includes(n)||n.startsWith("qpm.")||n.startsWith("quinoa"))&&(GM_deleteValue(n),e++)}}catch(t){console.error("[QPM Storage] Error clearing GM storage:",t)}try{for(const n of u)null!==localStorage.getItem(n)&&(localStorage.removeItem(n),e++);const t=Object.keys(localStorage);for(const n of t)(n.startsWith("qpm.")||n.startsWith("quinoa"))&&(localStorage.removeItem(n),e++)}catch(t){console.error("[QPM Storage] Error clearing localStorage:",t)}console.log(`[QPM Storage] Cleared ${e} storage keys`)}},m=["#App > div.McFlex.css-1k630i1 > div.McFlex.css-neeqas > div.McFlex.css-1mq3gde > div.McGrid.css-9guy2q > div.McFlex.css-13izacw > div.css-79elbk","#App > div.McFlex.css-neeqas div.css-79elbk","#App [data-tm-hud-root] div.css-79elbk","#App .QuinoaUI .css-79elbk","#App .css-79elbk","#App > div.McFlex.css-1k630i1 > div.McFlex.css-neeqas > div.McFlex.css-1mq3gde > div.McGrid.css-9guy2q > div.McFlex.css-13izacw > div.css-vmnhaw","#App > div.McFlex.css-neeqas div.css-vmnhaw","#App [data-tm-hud-root] div.css-vmnhaw","#App .QuinoaUI .css-vmnhaw","#App .css-vmnhaw"],f=[{id:"Weather:Sunny",label:"Sunny",normalized:"sunny",kind:"sunny",category:"base",durationMs:null,rawState:"noweather",aliases:[]},{id:"Weather:Rain",label:"Rain",normalized:"rain",kind:"rain",category:"weather",durationMs:3e5,rawState:"weather",aliases:[]},{id:"Weather:Frost",label:"Frost",normalized:"frost",kind:"snow",category:"weather",durationMs:3e5,rawState:"weather",aliases:["snow"]},{id:"Weather:Dawn",label:"Dawn",normalized:"dawn",kind:"dawn",category:"lunar",durationMs:6e5,rawState:"weather",aliases:["sunrise"]},{id:"Weather:AmberMoon",label:"Amber Moon",normalized:"ambermoon",kind:"amber",category:"lunar",durationMs:6e5,rawState:"weather",aliases:["harvestmoon","amber_moon"]}],h=new Map;for(const $C of f){new Set([$C.label,$C.normalized,...$C.aliases]).forEach(e=>{const t=b(e);t&&h.set(t,$C)})}function b(e){return String(e??"").trim().toLowerCase().replace(/\s+/g,"")}function y(e){if(null==e)return h.get("sunny")??null;const t=b(e);return t?h.get(t)??null:h.get("sunny")??null}function x(e){return Array.from(e.querySelectorAll("canvas")).find(e=>{const t=e.getBoundingClientRect();return t.width>=16&&t.width<=256&&t.top>=0&&t.top<=220})||null}function v(e){try{const t=e.getContext("2d",{willReadFrequently:!0});if(!t)return"noweather";const n=e.width,o=e.height,{data:r}=t.getImageData(0,0,n,o);let i=0,a=0,s=0,l=0,c=0;for(let e=0;e<r.length;e+=4){const t=r[e],n=r[e+1],o=r[e+2];if(r[e+3]<50)continue;c++,o>120&&o>t+20&&o>n+10&&i++;Math.abs(t-n)<20&&Math.abs(n-o)<20&&Math.abs(t-o)<20&&t>=60&&t<=140&&a++,t>200&&n>150&&o<120&&s++,t>200&&n>200&&o>200&&l++}if(0===c)return"noweather";if(i/c>=.05||a/c>=.1)return"weather";if(s/c>=.01||l/c>=.3)return"noweather";return(80*i+100*a+220*s+255*l)/c<120?"weather":"noweather"}catch{return"noweather"}}const w=window,C="undefined"!=typeof unsafeWindow&&unsafeWindow?unsafeWindow:w,T=C,S=C!==w;function P(e,t){try{C[e]=t}catch{}if(S)try{w[e]=t}catch{}}function k(e){if(S){const t=w[e];if(void 0!==t)return t}return C[e]}const A="__qpmJotaiStore__",E="__qpmJotaiAtomCache__",$=["__jotaiStore","jotaiStore","__MG_SHARED_JOTAI__","__MGTOOLS_JOTAI_STORE__","__QPM_SHARED_JOTAI__","__QPM_JOTAI_STORE__"];let M=null,I=null,F=!1,z=null;const L=e=>new Promise(t=>setTimeout(t,e));function R(e){return!!e&&"function"==typeof e.get&&"function"==typeof e.values}function q(e){return!!e&&"function"==typeof e.get&&"function"==typeof e.set&&"function"==typeof e.sub}function N(){if(M)return M;const e=k(E);if(e&&R(e))return M=e,e;const t=T.jotaiAtomCache,n=t&&"cache"in t?t.cache:t;return R(n)?(M=n,n):void 0}function B(){try{const e=T?.AriesMod?.services?.jotaiStore;if(q(e)&&!e.__polyfill)return{...e,__source:"aries"}}catch{}for(const t of $)try{const e=T[t];if(q(e)&&!e.__polyfill)return e}catch{}const e=k(A);return q(e)&&!e.__polyfill?e:null}async function D(e=5e3){const t=await async function(e=5e3){const t=Date.now();let n=N();for(;!n&&Date.now()-t<e;)await L(100),n=N();if(n){M=n;try{P(E,n)}catch{}}return n}(e);if(!t)return null;let n=null,o=null;const r=[],i=()=>{for(const e of r)try{e.__origWrite&&(e.write=e.__origWrite,delete e.__origWrite,delete e.__qpmPatched)}catch{}};let a=!1;for(const s of t.values()){if(!s||"function"!=typeof s.write)continue;const e=s;if(e.__origWrite||e.__qpmPatched){a=!0;continue}const t=e.write.bind(e);e.__origWrite=e.write,e.__qpmPatched=!0,e.write=function(e,r,...a){return o||(n=e,o=r,i()),t(e,r,...a)},r.push(e)}if(a&&!r.length){const t=Date.now()+e;for(;Date.now()<t;){const e=B();if(e)return e;await L(100)}return null}try{const t=Date.now()+e;for(;!o&&Date.now()<t;)await L(50)}finally{i()}return o&&n?{get:e=>n(e),async set(e,t){await o(e,t)},sub:(e,t)=>H.subscribe(e,t,()=>{try{return n(e)}catch{return}}),__source:"write"}:null}const H=new class{constructor(){this.subscriptions=new Map,this.rafId=null,this.isRunning=!1,this.lastPollTime=0,this.POLL_INTERVAL_MS=500,this.tick=()=>{if(!this.isRunning)return;const e=performance.now();e-this.lastPollTime>=this.POLL_INTERVAL_MS&&(this.lastPollTime=e,this.pollAllSubscriptions()),this.rafId=requestAnimationFrame(this.tick)}}subscribe(e,t,n){let o=this.subscriptions.get(e);if(!o){o={atom:e,callbacks:new Set,getValue:n,lastValue:void 0};try{o.lastValue=n()}catch{}this.subscriptions.set(e,o)}return o.callbacks.add(t),!this.isRunning&&this.subscriptions.size>0&&this.start(),()=>{o?.callbacks.delete(t),0===o?.callbacks.size&&(this.subscriptions.delete(e),0===this.subscriptions.size&&this.stop())}}start(){this.isRunning||(this.isRunning=!0,this.lastPollTime=performance.now(),this.tick())}stop(){null!==this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.isRunning=!1}pollAllSubscriptions(){if(!document.hidden)for(const e of this.subscriptions.values())try{const t=e.getValue();if(t!==e.lastValue){e.lastValue=t;for(const t of e.callbacks)try{t()}catch{}}}catch{}}getStats(){return{count:this.subscriptions.size,atoms:Array.from(this.subscriptions.keys()).map(e=>String(e))}}};function j(e){try{P(A,e)}catch{}try{T.__QPM_JOTAI_STORE__||(T.__QPM_JOTAI_STORE__=e)}catch{}try{T.__jotaiStore||e.__polyfill||(T.__jotaiStore=e)}catch{}}async function _(){if(I&&!I.__polyfill)return I;let e=B();if(e)return I=e,z="aries"===e.__source?"aries":"shared",j(I),I;if(!!T?.AriesMod){const t=3e3,n=Date.now();for(;Date.now()-n<t;)if(await L(200),e=B(),e)return I=e,z="aries"===e.__source?"aries":"shared",j(I),I}if(F){const e=6e3,t=Date.now();for(;F&&Date.now()-t<e;)await L(50);if(I&&!I.__polyfill)return I}F=!0;try{const e=function(){const e=T.__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!e?.renderers?.size)return null;for(const[t]of e.renderers){const n=e.getFiberRoots?.(t);if(n)for(const e of n){const t=new Set,n=[],o=e.current??e;for(o&&n.push(o);n.length;){const e=n.pop();if(!e||t.has(e))continue;t.add(e);const o=e.pendingProps?.value;if(q(o))return{...o,__source:"fiber"};e.child&&n.push(e.child),e.sibling&&n.push(e.sibling),e.alternate&&n.push(e.alternate)}}}return null}();if(e)return I=e,z="fiber",j(I),I;const t=await D(5e3);if(t)return I=t,z="write",j(I),I;return N()?(I={get(e){const t=N();if(!t)throw new Error("Jotai atom cache not available");const n=t.get(e);if(n&&Object.prototype.hasOwnProperty.call(n,"v"))return n.v;throw new Error("Atom value not found in cache")},set(){throw new Error("QPM cache-read store cannot write. Use Aries Mod for writes.")},sub:(e,t)=>H.subscribe(e,t,()=>{const t=N();if(!t)return;const n=t.get(e);return n&&Object.prototype.hasOwnProperty.call(n,"v")?n.v:void 0}),__polyfill:!0,__source:"cache-read"},z="cache-read",j(I),s("[jotaiBridge] Using cache-read fallback store"),I):(s("[jotaiBridge] ‚ö†Ô∏è No Jotai store available - functionality limited"),I={get(){throw new Error("Jotai store unavailable")},set(){throw new Error("Jotai store unavailable")},sub:()=>()=>{},__polyfill:!0,__source:"none"},I)}finally{F=!1}}function O(e){const t=N();if(!t)return[];const n=[];for(const o of t.values()){if(!o)continue;const t=String(o.debugLabel??o.label??"");e.test(t)&&n.push(o)}return n}function G(e){const t=N();if(!t)return null;for(const n of t.values())if(n)try{const o=t.get(n);if(o&&Object.prototype.hasOwnProperty.call(o,"v")&&e(o.v))return n}catch{}return null}function V(e){const t=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),n=O(new RegExp(`^${t}$`))[0]??null;if(!n){if("myDataAtom"===e)return G(e=>!!(e&&"object"==typeof e&&"garden"in e&&e.garden&&"object"==typeof e.garden&&"tileObjects"in e.garden));if("mapAtom"===e)return G(e=>!!(e&&"object"==typeof e&&"cols"in e&&"rows"in e&&"globalTileIdxToDirtTile"in e&&"object"==typeof e.globalTileIdxToDirtTile))}return n}async function W(e){try{const t=await _();if(!t.__polyfill)return t.get(e)}catch{}const t=N();if(t)try{const n=t.get(e);if(n&&Object.prototype.hasOwnProperty.call(n,"v"))return n.v}catch{}throw new Error("Unable to read atom value")}async function U(e,t){const n=await _();let o=!1;const r=()=>{if(!o)try{const o=n.get(e);t(o)}catch{}},i=n.sub(e,r),a="function"==typeof i?i:await i;return r(),()=>{o=!0;try{a?.()}catch{}}}const X=Object.freeze(Object.defineProperty({__proto__:null,ensureJotaiStore:_,findAtomsByLabel:O,getAtomByLabel:V,readAtomValue:W,subscribeAtom:U},Symbol.toStringTag,{value:"Module"})),Q={weather:{label:"weatherAtom"},shops:{label:"shopsAtom",transform:e=>e&&"object"==typeof e?e:null},seedShop:{label:"shopsAtom",path:"seed"},eggShop:{label:"shopsAtom",path:"egg"},toolShop:{label:"shopsAtom",path:"tool"},decorShop:{label:"shopsAtom",path:"decor"},shopPurchases:{label:"myShopPurchasesAtom"}},J=new Set;function K(e,t){if(!t)return e;const n=function(e){return e?Array.isArray(e)?e.slice():String(e).split(".").map(e=>e.trim()).filter(Boolean):[]}(t);let o=e;for(const r of n){if(null==o)return;o="number"==typeof r?Array.isArray(o)?o[r]:void 0:o[r]}return o}async function Y(e){const t=V(e);if(!t)throw J.has(e)||(s("‚ö†Ô∏è AtomRegistry missing atom",e),J.add(e)),new Error(`Atom ${e} not found in jotaiAtomCache`);return J.delete(e),t}function Z(e){return t=>{try{const n=K(t,e.path);return e.transform?e.transform(n):n??e.fallback??null}catch(n){return s("‚ö†Ô∏è AtomRegistry transform error",e.label,n),e.fallback??null}}}function ee(e){return Q[e]}async function te(e){const t=ee(e),n=await Y(t.label).catch(()=>null);if(!n){return t.fallback??null??null}return Z(t)(await W(n).catch(e=>(s("‚ö†Ô∏è AtomRegistry read error",t.label,e),null)))??null}async function ne(e,t){const n=ee(e),o=await Y(n.label),r=Z(n),i=await U(o,e=>{const n=r(e);t(n??null)});return()=>{try{i()}catch(e){s("‚ö†Ô∏è AtomRegistry unsubscribe error",n.label,e)}}}const oe=new class{constructor(){this.timers=new Map,this.rafId=null,this.isRunning=!1,this.isPageVisible=!0,this.lastFrameTime=0,this.handleVisibilityChange=()=>{this.isPageVisible=!document.hidden,this.isPageVisible&&this.timers.size>0&&this.start()},this.tick=()=>{if(!this.isRunning)return;const e=performance.now();this.lastFrameTime,this.lastFrameTime=e;if(!(this.isPageVisible||Array.from(this.timers.values()).some(e=>e.runWhenHidden&&!e.paused)))return void(this.rafId=requestAnimationFrame(this.tick));const t=["critical","normal","low"];for(const o of t)for(const t of this.timers.values()){if(t.priority!==o)continue;if(t.paused)continue;if(!this.isPageVisible&&!t.runWhenHidden)continue;if(e-t.lastRun>=t.intervalMs){try{t.callback()}catch(n){console.error(`[TimerManager] Timer "${t.id}" error:`,n)}t.lastRun=e}}this.rafId=requestAnimationFrame(this.tick)},"undefined"!=typeof document&&document.addEventListener("visibilitychange",this.handleVisibilityChange)}register(e,t,n,o={}){const{priority:r="normal",runWhenHidden:i=!1,immediate:a=!1}=o;this.timers.delete(e);const s={id:e,callback:t,intervalMs:n,lastRun:a?0:performance.now(),priority:r,runWhenHidden:i,paused:!1};return this.timers.set(e,s),this.isRunning||this.start(),()=>this.unregister(e)}unregister(e){this.timers.delete(e),0===this.timers.size&&this.stop()}pause(e){const t=this.timers.get(e);t&&(t.paused=!0)}resume(e){const t=this.timers.get(e);t&&(t.paused=!1,t.lastRun=performance.now())}has(e){return this.timers.has(e)}get count(){return this.timers.size}start(){this.isRunning||(this.isRunning=!0,this.lastFrameTime=performance.now(),this.tick())}stop(){null!==this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.isRunning=!1}destroy(){this.stop(),this.timers.clear(),"undefined"!=typeof document&&document.removeEventListener("visibilitychange",this.handleVisibilityChange)}getDebugInfo(){return Array.from(this.timers.values()).map(e=>({id:e.id,intervalMs:e.intervalMs,priority:e.priority,paused:e.paused}))}};function re(e,t,n){return oe.register(e,t,n,{runWhenHidden:!1,priority:"normal"})}function ie(e,t,n){return oe.register(e,t,n,{runWhenHidden:!0,priority:"critical"})}const ae=new Set;let se={kind:"unknown",raw:"noweather",hash:null,canvasPresent:!1,timestamp:Date.now(),source:"unknown",label:null,startedAt:null,expectedEndAt:null},le=null,ce=null;let de=null,pe=!1,ue=!1,ge=null,me=null,fe=null,he=null,be=null;function ye(e){if(se.kind!==e.kind||se.raw!==e.raw||se.hash!==e.hash||se.canvasPresent!==e.canvasPresent||se.source!==e.source||se.label!==e.label||se.startedAt!==e.startedAt||se.expectedEndAt!==e.expectedEndAt){se=e;for(const e of ae)try{e(se)}catch(t){s("‚ö†Ô∏è Weather hub listener failed",t)}}}function xe(e){const t=Date.now();if(!e)return{kind:"unknown",raw:"noweather",hash:null,canvasPresent:!1,timestamp:t,source:"canvas",label:null,startedAt:null,expectedEndAt:null};if(!function(e){try{const t=e.getContext("2d",{willReadFrequently:!0});if(!t)return!1;const n=Math.min(e.width,128),o=Math.min(e.height,128);if(0===n||0===o)return!1;const r=t.getImageData(0,0,n,o);for(let e=3;e<r.data.length;e+=4)if(r.data[e]>0)return!0;return!1}catch{return!1}}(e))return{kind:"unknown",raw:"noweather",hash:null,canvasPresent:!0,timestamp:t,source:"canvas",label:null,startedAt:null,expectedEndAt:null};const n=v(e),o=function(e){if("noweather"===v(e))return"sunny";try{const t=e.getContext("2d",{willReadFrequently:!0});if(!t)return"unknown";const n=Math.min(e.width,120),o=Math.min(e.height,120),{data:r}=t.getImageData(0,0,n,o);let i=0,a=0,s=0,l=0;for(let e=0;e<r.length;e+=4)r[e+3]<40||(i+=r[e],a+=r[e+1],s+=r[e+2],l++);if(0===l)return"unknown";const c=i/l,d=a/l,p=s/l;return p>c+20&&p>d+10?"rain":p>150&&c>150&&d>150?"snow":c>120&&p>100&&d<c-10?"dawn":c>150&&d>100&&p<100?"amber":"rain"}catch{return"unknown"}}(e),r=function(e){try{const t=e.getContext("2d",{willReadFrequently:!0});if(!t)return"no-context";const{width:n,height:o}=e,r=t.getImageData(0,0,n,o),i=[[.25*n,.25*o],[.5*n,.5*o],[.75*n,.75*o],[.2*n,.65*o],[.8*n,.35*o]];let a=0;for(const[e,s]of i){const t=Math.min(n-1,Math.max(0,Math.round(e))),i=4*(Math.min(o-1,Math.max(0,Math.round(s)))*n+t);a=(a<<5)-a+r.data[i],a|=0}return a.toString(16)}catch{return"error"}}(e);return{kind:o,raw:n,hash:r,canvasPresent:!0,timestamp:t,source:"canvas",label:"unknown"===o?null:o,startedAt:t,expectedEndAt:null}}function ve(e=!1){if(pe&&ue)return void(e&&we(ge));const t=Date.now();if(ce&&t<ce.expiresAt){const n="sunny"===ce.kind?"noweather":"weather",o={kind:ce.kind,raw:n,hash:"override",canvasPresent:!0,timestamp:t,source:"unknown",label:ce.kind,startedAt:t,expectedEndAt:ce.expiresAt};return void((e||o.hash!==se.hash||o.kind!==se.kind)&&ye(o))}ce&&t>=ce.expiresAt&&(ce=null);const n=xe(function(){for(const o of m){const e=document.querySelector(o);if(!e)continue;if(e instanceof HTMLCanvasElement)return e;const t=e.querySelector("canvas");if(t instanceof HTMLCanvasElement)return t}const e=[],t=a();t&&e.push(t);const n=document.getElementById("App");n instanceof HTMLElement&&!e.includes(n)&&e.push(n);for(const o of e){const e=x(o);if(e)return e}return x(document)}());ye(n)}function we(e){ue=!0;const t="string"==typeof e&&e.trim().length>0?e.trim():null,n=y(t),o=n?.kind??function(e){const t=y(e);return t?.kind??(e?"unknown":"sunny")}(t),r=n?.rawState??("sunny"===o||"unknown"===o?"noweather":"weather"),i=`atom:${b(t??n?.label??"sunny")||"sunny"}`,a=Date.now(),s=n?.id??"Weather:Sunny";fe!==s&&(fe=s,he=a,be=n?.durationMs?a+n.durationMs:null);ye({kind:o,raw:r,hash:i,canvasPresent:!0,timestamp:a,source:"atom",label:t??n?.label??null,startedAt:he,expectedEndAt:be})}function Ce(){null==le&&(!async function(){if(!de&&!me){me=(async()=>{try{const e=await ne("weather",e=>{pe=!0,ge="string"==typeof e?e:null,we(ge)});de=e;const t=await te("weather").catch(()=>ge);"string"!=typeof t&&null!=t||(ge=t),pe=!0,we(ge)}catch(e){pe=!1,ue=!1,s("‚ö†Ô∏è Weather hub atom bridge error",e),de=null}finally{me=null}})();try{await me}catch{}}}(),ve(!0),le=re("weather-hub-poll",()=>ve(!1),2e3))}function Te(){pe&&ue?we(ge):ve(!0)}function Se(e,t=!0){if(ae.add(e),t)try{e(se)}catch(n){s("‚ö†Ô∏è Weather hub immediate listener failed",n)}return()=>{ae.delete(e)}}function Pe(){return se}const ke=new Set,Ae={},Ee={};function $e(e){return e.map(e=>({...e}))}function Me(e){const t={source:e.source,generatedAt:e.generatedAt,summary:e.summary,perWeather:{rain:$e(e.perWeather.rain??[]),snow:$e(e.perWeather.snow??[]),dawn:$e(e.perWeather.dawn??[]),amber:$e(e.perWeather.amber??[])}};return e.metadata&&(t.metadata={...e.metadata}),t}function Ie(e){const t={...e,perWeather:{rain:$e(e.perWeather.rain??[]),snow:$e(e.perWeather.snow??[]),dawn:$e(e.perWeather.dawn??[]),amber:$e(e.perWeather.amber??[])}};e.metadata&&(t.metadata={...e.metadata}),Ee[e.source]=t}function Fe(e,t={}){const n=Math.max(0,e.overallTrackedPlantCount-e.overallEligiblePlantCount),o=Math.max(0,n-e.lunar.mutatedPlantCount);return{...t,lunarTrackedPlantCount:e.lunar.trackedPlantCount,lunarPendingPlantCount:e.lunar.pendingPlantCount,lunarMutatedPlantCount:e.lunar.mutatedPlantCount,nonLunarMutatedPlantCount:o,dawnPendingFruitCount:e.totals.dawn.pendingFruitCount,amberPendingFruitCount:e.totals.amber.pendingFruitCount}}function ze(e){return e?Ee[e]??null:Ee.garden??Ee.inventory??null}function Le(e,t){Ae[e]=t;const n={source:e,summary:t};for(const r of ke)try{r(n)}catch(o){s("‚ö†Ô∏è Mutation summary listener error",o)}}P("__qpmMutationDebug",{get:e=>function(e){const t=ze(e);return t?Me(t):null}(e),getAll(){const e={};return Object.keys(Ee).forEach(t=>{const n=Ee[t];n&&(e[t]=Me(n))}),e},list(e){const t=ze(e);return t?function(e){return{source:e.source,generatedAt:e.generatedAt,activeWeather:e.summary.activeWeather,perWeather:{rain:e.perWeather.rain.map(e=>e.name),snow:e.perWeather.snow.map(e=>e.name),dawn:e.perWeather.dawn.map(e=>e.name),amber:e.perWeather.amber.map(e=>e.name)},metadata:e.metadata?{...e.metadata}:void 0}}(t):null},print(e){const t=ze(e);if(!t)return null;const n=[];["rain","snow","dawn","amber"].forEach(e=>{(t.perWeather[e]??[]).forEach(t=>{const o={weather:e,name:t.name,pending:t.pendingFruit,needsSnow:t.needsSnowFruit,fruit:t.fruitCount,source:t.source};t.tag&&(o.tag=t.tag),n.push(o)})});const o=globalThis.console;return 0===n.length?(o?.info?.("[QPM] No mutation plants recorded for current snapshot."),[]):(o?.table?o.table(n):o?.log?.(n),n)}});const Re="userSlotsAtom";let qe=!1,Ne=!1,Be=!1;function De(e){if(!Array.isArray(e)||0===e.length)return null;const t=e.find(e=>e&&"object"==typeof e);if(!t)return null;return"itemType"in t||"species"in t||"slots"in t||"plant"in t||"item"in t?e:null}function He(e,t,n){if(!e||0===e.length)return null;const o=n&&"object"==typeof n?(r=n.favoritedItemIds,Array.isArray(r)?r.filter(e=>"string"==typeof e):[]):[];var r;const i=e.some(e=>function(e){if(!e||"object"!=typeof e)return[];const t=[e.slots,e.plant?.slots,e.item?.slots,e.data?.slots,e.slots?.slots,e.growSlots];for(const n of t)if(Array.isArray(n)&&n.length>0)return n;return[]}(e).length>0);return{items:e,favoritedItemIds:o,source:t,hasSlotData:i}}function je(e,t){const n=He(De(e),t,e);if(n)return n;if(!e||"object"!=typeof e)return null;const o=e;if("inventory"in o){const e=o.inventory,n=He(De(e?.items??e),`${t}.inventory`,e);if(n)return n}if("data"in o){const e=o.data;if(e&&"inventory"in e){const n=e.inventory,o=He(De(n?.items??n),`${t}.data.inventory`,n);if(o)return o}}return null}async function _e(){try{await _(),qe=!1}catch(r){return qe||(s("‚ö†Ô∏è Unable to capture jotai store for userSlotsAtom",r),qe=!0),null}const e=await async function(){let e=V(Re);e||(e=O(/userSlotsAtom/i)[0]??null);return e||Ne||(s("‚ö†Ô∏è Could not locate userSlotsAtom in jotai cache"),Ne=!0),e&&(Ne=!1),e}();if(!e)return null;let t;try{t=await W(e),Be=!1}catch(r){return Be||(s("‚ö†Ô∏è Failed reading userSlotsAtom",r),Be=!0),null}const n=new WeakSet,o=[{node:t,label:Re}];for(;o.length>0;){const{node:e,label:t}=o.shift(),r=je(e,t);if(r)return r;if(!e||"object"!=typeof e)continue;const i=Array.isArray(e);!i&&n.has(e)||(i||n.add(e),Array.isArray(e)?e.forEach((e,n)=>{o.push({node:e,label:`${t}[${n}]`})}):Object.entries(e).forEach(([e,n])=>{o.push({node:n,label:`${t}.${e}`})}))}return null}const Oe=["F","W","C","D","A","R","G"],Ge="quinoa-mutation-reminder-config",Ve=".McFlex.css-zo8r2v",We="div.css-79elbk",Ue="myCropInventoryAtom";let Xe={enabled:!0,showNotifications:!0,highlightPlants:!0},Qe="unknown",Je="unknown",Ke=null,Ye=null,Ze=null,et=!1,tt=new Set,nt=!1,ot=!1,rt=!1,it=0,at=!1;let st=0;const lt=["rain","snow","dawn","amber"];function ct(e){let t=e.toLowerCase().replace(/\+\d+$/,"").trim();return t.endsWith(" plant")&&(t=t.slice(0,-6).trim()),t}function dt(){Xe={...Xe,...g.get(Ge,{})},s("üå± Plant Mutation Reminder starting..."),Xe.enabled&&(ut(),pt()),s("üå± Plant Mutation Reminder started")}function pt(){nt||(nt=!0,n(Ve,e=>{if(Xe.enabled&&(tt.size>0&&(s(`üîÑ Inventory reopened, reapplying ${tt.size} plant highlights...`),setTimeout(()=>{!async function(){if(0===tt.size)return void s("‚è≠Ô∏è No highlights to reapply");s(`üîç Reapplying highlights for ${tt.size} tracked plants...`);const e=await xt();if(0===e.length)return void s("‚ö†Ô∏è No plants found in inventory for reapply");const t=e.filter(e=>{const t=bt(e);return tt.has(t)});t.length>0?(s(`‚ú® Reapplying ${t.length} highlights`),_t(t)):s("‚ö†Ô∏è None of the tracked plants found in current inventory")}()},300)),Ze)){const{weather:e}=Ze;s(`üì¶ Inventory opened with pending ${e} notification`),Xe.showNotifications&&Gt(`${Wt(e)} ${e.toUpperCase()} Weather Active`,"Checking your plants for mutation opportunities...","info");const t=(e=0)=>{const n=document.querySelector(Ve);if(!n)return void s("‚ö†Ô∏è Inventory container disappeared");const o=Array.from(n.querySelectorAll(We)).filter(e=>{const t=e.querySelector("p.chakra-text");return(t?.textContent?.trim()||"").toLowerCase().includes("plant")});o.length>0||e>=5?(o.length>0?s(`‚úÖ Found ${o.length} plant items after ${300*e}ms`):s(`‚è∞ Timeout waiting for plants after ${300*e}ms`),ht()):(s(`‚è≥ No plants found yet, waiting... (attempt ${e+1}/5)`),setTimeout(()=>t(e+1),300))};t()}}))}function ut(){Ce(),Ke||(Ke=Se(gt,!0))}function gt(e){Ye=e;const t=function(e){switch(e.kind){case"rain":return"rain";case"snow":return"snow";case"dawn":return"dawn";case"amber":return"amber";case"sunny":return"sunny";default:return"weather"===e.raw?"rain":"sunny"}}(e);if(!Xe.enabled&&!et)return Je=Qe,void(Qe=t);t!==Qe&&(Je=Qe,Qe=t,s(`üå§Ô∏è Weather changed: ${Je} ‚Üí ${Qe}`),Ot(),"sunny"===Qe||"unknown"===Qe?(Ze=null,s("üå§Ô∏è Weather cleared - no mutations available")):ht())}function mt(e){switch(e){case"rain":case"snow":return 3e5;case"dawn":case"amber":return 6e5;default:return null}}function ft(e,t){if("sunny"===e||"unknown"===e)return null;const n=mt(e),o=t?.startedAt??t?.timestamp??null,r=t?.expectedEndAt??(null!=o&&null!=n?o+n:null)??(null!=n?Date.now()+n:null),i=null!=r?Math.max(0,r-Date.now()):null;return{weather:e,startedAt:o,expectedEndAt:r,durationMs:null!=r&&null!=o?Math.max(0,r-o):n,remainingMs:i}}async function ht(){if(!Xe.enabled)return;s(`üîç Checking inventory for mutation opportunities (${Qe})...`);const e=await xt(),t=ft(Qe,Ye),n={rain:[],snow:[],dawn:[],amber:[]},o=(e,t,o)=>{const r={name:t.name,pendingFruit:o.pendingFruit,needsSnowFruit:o.needsSnowFruit,fruitCount:t.fruitCount,source:t.slotSource};o.tag&&(r.tag=o.tag),n[e].push(r)};if(0===e.length){const e=jt([],Qe,t,o);return Le("inventory",e),Ie({source:"inventory",generatedAt:e.timestamp,summary:e,perWeather:n,metadata:Fe(e,{scannedPlantCount:0,highlightedPlantCount:0,notes:"Inventory empty"})}),s("üì¶ No plants found in inventory"),void("sunny"!==Qe&&"unknown"!==Qe&&(Ze={weather:Qe,plantCount:0},Xe.showNotifications&&Gt(`${Wt(Qe)} ${Qe.toUpperCase()} Weather!`,"Open your inventory (press E) to check which plants to place","info")))}Ze=null;const r=function(e,t){const n=[];for(const o of e){Dt(o,t,!0).decision&&n.push(o)}return n}(e,Qe),i=jt(e,Qe,t,o);Le("inventory",i),Ie({source:"inventory",generatedAt:i.timestamp,summary:i,perWeather:n,metadata:Fe(i,{scannedPlantCount:e.length,highlightedPlantCount:r.length})}),r.length>0?(s(`üå± Found ${r.length} plants to place for ${Qe}!`),Xe.highlightPlants&&(r.forEach(e=>{const t=bt(e);tt.add(t)}),_t(r)),Xe.showNotifications&&function(e,t){(function(e,t){const n=Wt(t),o=e.length,r=Vt(t);t.toUpperCase()})(e,t),Gt(`${Wt(t)} ${t.toUpperCase()} Weather!`,`Place ${e.length} plant${e.length>1?"s":""} ${Vt(t)}`,"success")}(r,Qe),r.length):s(`‚úì No mutation opportunities for ${Qe}`)}function bt(e){const t=function(e){if(!e.length)return"no-slots";return e.map(e=>{const t=e.letters.join(""),n=`${e.hasDawnbound?"d":""}${e.hasAmberbound?"a":""}`,o=t||"_";return n?`${o}+${n}`:o}).join(",")}(e.slotStates);return`${e.name}|${e.mutations}|${e.fruitCount}|${t}`}function yt(e,t,n,o){const r=e.slotStates.map((e,t)=>({index:t,letters:e.letters.join(""),wet:e.hasWet,frozen:e.hasFrozen,chilled:e.hasChilled,dawn:e.hasDawnlit,amber:e.hasAmberlit,dawnbound:e.hasDawnbound,amberbound:e.hasAmberbound,rainbow:e.hasRainbow,gold:e.hasGold,progress:e.progress}));s(`[Mutations] ${n?"‚úÖ highlight":"‚è≠Ô∏è skip"} ${e.name} for ${t}`,{slotSource:e.slotSource,fruitCount:e.fruitCount,domCounts:e.domMutationCounts,domBold:e.domBoldCounts,slotSummary:r,detail:o})}async function xt(){const e=((e,t=document)=>t.querySelector(e))(Ve);if(!e||!function(e){if(!e)return!1;const t=e.getBoundingClientRect();if(t.width<=0||t.height<=0)return!1;const n=getComputedStyle(e);return"hidden"!==n.visibility&&"none"!==n.display&&parseFloat(n.opacity||"1")>0}(e))return s("‚ùå Inventory not open"),[];const t=Array.from(e.querySelectorAll(We)),n=await async function(){rt=!1,it=0,st=0;const e=await async function(){const e=async()=>{const e=await async function(){if("undefined"==typeof window)return null;const e=window,t=[{source:"MGTools.Core.Atoms.inventory.myCropInventory",atom:e?.MGTools?.Core?.Atoms?.inventory?.myCropInventory},{source:"MGTOOLS.Core.Atoms.inventory.myCropInventory",atom:e?.MGTOOLS?.Core?.Atoms?.inventory?.myCropInventory},{source:"Atoms.inventory.myCropInventory",atom:e?.Atoms?.inventory?.myCropInventory},{source:"__tmAtoms.inventory.myCropInventory",atom:e?.__tmAtoms?.inventory?.myCropInventory}];for(const o of t){const e=o.atom;if(!e)continue;const t=e=>{const t=vt(e);if(t&&t.length>0)return t;if(e&&"object"==typeof e){const t=[e.items,e.value,e.current,e.state];for(const e of t){const t=vt(e);if(t&&t.length>0)return t}}return null};try{if("function"==typeof e.get){const n=t(await e.get());if(n&&n.length>0)return{items:n,source:`${o.source}.get()`,hasSlotData:n.some(e=>At(e).length>0)}}const n=t(e);if(n&&n.length>0)return{items:n,source:`${o.source}`,hasSlotData:n.some(e=>At(e).length>0)}}catch(n){at||(s("‚ö†Ô∏è Unable to read shared atoms inventory source",{source:o.source,error:n}),at=!0)}}return null}();if(e)return rt||(s("[Mutations] Using shared atoms inventory source",{source:e.source,items:e.items.length,hasSlotData:e.hasSlotData}),rt=!0),e.items;const t=function(){if("undefined"==typeof window)return null;const e=window,t=[{source:"UnifiedState.atoms.inventory.items",value:e?.UnifiedState?.atoms?.inventory?.items},{source:"UnifiedState.atoms.inventory",value:e?.UnifiedState?.atoms?.inventory},{source:"myData.inventory.items",value:e?.myData?.inventory?.items},{source:"__mga_cachedInventory",value:e?.__mga_cachedInventory},{source:"MGTOOLS.UnifiedState.atoms.inventory.items",value:e?.MGTOOLS?.UnifiedState?.atoms?.inventory?.items}];let n=null;for(const o of t){let e=vt(o.value),t=o.source;if((!e||0===e.length)&&o.value&&"object"==typeof o.value){const n=[{key:"myCropInventory",label:`${o.source}.myCropInventory`},{key:"cropInventory",label:`${o.source}.cropInventory`},{key:"inventory",label:`${o.source}.inventory`},{key:"items",label:`${o.source}.items`}];for(const r of n){const n=vt(o.value[r.key]);if(n&&n.length>0){e=n,t=r.label;break}}}if(!e||0===e.length)continue;const r=e.some(e=>At(e).length>0),i={items:e,source:t,hasSlotData:r};if(r)return i;n||(n=i)}return n}();return t?(rt||(s("[Mutations] Using global inventory source",{source:t.source,items:t.items.length,hasSlotData:t.hasSlotData}),rt=!0),t.items):[]},t=async(t,n)=>{if(!t||0===t.length)return await e();if(t.some(e=>At(e).length>0))return rt||(s(`[Mutations] Read crop inventory atom (${n})`,{count:t.length,hasSlotData:!0}),rt=!0),t;if(!rt){const e=t.slice(0,3).map((e,t)=>({index:t,summary:wt(e)}));s("[Mutations] Crop inventory atom lacks slot data, trying fallback",{source:n,count:t.length,samples:e})}const o=await e();return o.length>0?o:(rt||(s("[Mutations] Crop inventory atom fallback unavailable, proceeding without slot data",{source:n,count:t.length}),rt=!0),t)};try{await _()}catch(r){return ot||(s("‚ö†Ô∏è Unable to capture jotai store for crop inventory",r),ot=!0),await e()}const n=await _e();if(n&&n.items.length>0)return rt||(s("[Mutations] Using userSlotsAtom inventory source",{source:n.source,items:n.items.length,hasSlotData:n.hasSlotData}),rt=!0),n.hasSlotData?n.items:await t(n.items,n.source);const o=V(Ue);if(!o)return ot||(s("‚ö†Ô∏è Could not locate myCropInventoryAtom in jotai cache"),ot=!0),await e();try{const n=await W(o);return ot=!1,Array.isArray(n)?await t(n,"array"):n&&Array.isArray(n.items)?await t(n.items,"items array"):(rt||s("[Mutations] Crop inventory atom value not array-like",{sample:n}),await e())}catch(r){return ot||(s("‚ö†Ô∏è Failed reading myCropInventoryAtom",r),ot=!0),await e()}return[]}();if(0===e.length)return rt||(s("[Mutations] Inventory lookup unavailable (no items)"),rt=!0),null;const t=new Map,n=new Map,o=new Map;if(e.forEach((e,r)=>{const i=function(e,t){if(!e||"object"!=typeof e)return null;const n=function(e){if(!e||"object"!=typeof e)return"other";if(At(e).length>0)return"plant";const t=[e?.itemType,e?.type,e?.category,e?.kind,e?.item?.itemType,e?.item?.type,e?.plant?.itemType,e?.plant?.type];for(const n of t){if("string"!=typeof n)continue;const e=n.toLowerCase();if("plant"===e||"crop"===e||e.endsWith("plant")||e.includes("plant"))return"plant"}return"other"}(e);if("plant"!==n)return it<5&&(s("[Mutations] Inventory item skipped (type mismatch)",{index:t,itemType:n,keys:Object.keys(e).slice(0,10),sample:wt(e)}),it+=1),null;const o=At(e),r=o.map(Et),i="string"==typeof e.id?e.id:null,a="string"==typeof e.species?e.species:null,l="string"==typeof e.itemName?e.itemName:null,c="string"==typeof e.displayName?e.displayName:null;let d="string"==typeof e.name?e.name:null;d||(d=l||c);!d&&a&&(d=a.toLowerCase().includes("plant")?a:`${a} Plant`);const p=d?ct(d):null;return{baseIndex:t,id:i,slotStates:r,raw:e,name:d,normalizedName:p,used:!1}}(e,r);if(i&&(t.set(i.baseIndex,i),i.id&&n.set(i.id,i),i.normalizedName)){const e=o.get(i.normalizedName)??[];e.push(i),o.set(i.normalizedName,e)}}),0===t.size)return rt||(s("[Mutations] Inventory lookup construction produced zero entries"),rt=!0),null;rt||(s("[Mutations] Inventory lookup ready",{items:e.length,byIndex:t.size,byId:n.size,byName:o.size}),rt=!0);return{byIndex:t,byId:n,byName:o}}(),o=[];return t.forEach((e,t)=>{const r=function(e,t,n){try{const r=["p.chakra-text.css-8xfasz",".McFlex.css-1gd1uup p.chakra-text","p.chakra-text.css-rbbzu5","p.chakra-text"],i=[];let a="";for(const t of r){const n=Array.from(e.querySelectorAll(t));for(const e of n){const t=e.textContent?.trim();t&&(i.push(t),!a&&/plant/i.test(t)&&(a=t))}if(a)break}if(!a&&i.length){a=i.find(e=>/[a-z]/i.test(e))??""}if(!a||!function(e){e.toLowerCase().trim();const t=/\+\d+$/.test(e),n=e.match(/^(.+?)(?:\+\d+)?$/),o=(n?.[1]||e).toLowerCase().trim(),r=["seed","spore","cutting","pod","kernel","pit","shovel","pot","watering can","tool","fertilizer","egg","decor","furniture","planter"];for(const i of r)if(o.includes(i))return!1;if(o.includes("plant"))return!0;if(t)return!0;return!1}(a))return null;const l=function(e){const t=[],n=e.querySelectorAll("span, div, p");for(const o of n){const e=o.textContent?.trim();if(!e||1!==e.length)continue;const n=e.toUpperCase();if(!zt(n))continue;let r=!1;if(o instanceof HTMLElement){const e=window.getComputedStyle(o).fontWeight,t=Number.parseInt(e,10);r="bold"===e||Number.isFinite(t)&&t>=700}t.push({letter:n,isBold:r})}return t}(e),c=function(e){const t=It();for(const n of e)t[n.letter]+=1;return t}(l),d={D:(o=l).filter(e=>"D"===e.letter&&e.isBold).length,A:o.filter(e=>"A"===e.letter&&e.isBold).length},p=a.match(/\+(\d+)/),u=p?parseInt(p[1]||"1",10):0;let g=[],m="fallback";if(t){const o=function(e,t){const n=qt(e,Lt),o=Bt(n);if(null!=o)return o;const r=Nt(e,e=>e.toLowerCase().includes("inventorybaseindex")),i=Bt(r);if(null!=i)return i;const a=e.querySelector("[data-tm-inventory-base-index]");if(a){const e=Bt(qt(a,Lt));if(null!=e)return e;const t=Bt(Nt(a,e=>e.toLowerCase().includes("inventorybaseindex")));if(null!=t)return t}return t}(e,n);let r=t.byIndex.get(o)??null;if(!r||r.used){const n=function(e){const t=["[data-tm-inventory-id]","[data-inventory-id]","[data-item-id]","[data-itemid]","[data-item-uuid]","[data-uuid]","[data-guid]","[data-entity-id]","[data-record-id]","[data-row-id]"],n=e=>{const t=e.toLowerCase();return t.includes("inventoryid")||t.includes("itemid")||/(?:uuid|guid)$/.test(t)},o=[];let r=e;for(let i=0;r&&i<5;i++)o.push(r),r=r.parentElement;for(const i of o){const e=qt(i,Rt);if(e)return e;const t=Nt(i,n);if(t)return t}for(const i of o)for(const e of t){const t=i.querySelector(e);if(!t)continue;const o=qt(t,Rt);if(o)return o;const r=Nt(t,n);if(r)return r}return null}(e);if(n){const e=t.byId.get(n)??null;e&&!e.used&&(r=e)}}if(!r||r.used){const e=ct(a),n=t.byName.get(e);if(n){for(;n.length>0&&n[0]&&n[0].used;)n.shift();if(n.length>0){const e=n.shift();e&&(r=e)}}}r&&!r.used&&(r.used=!0,g=r.slotStates.map(Mt),m="inventory")}const f=Ft(g,c,d),h=u>0?u:g.length;return 0===h?(s(`‚è≠Ô∏è Skipping ungrown plant: ${a} (${"inventory"===m?"no slots yet":"no fruit count"})`),null):{name:a,mutations:f,element:e,fruitCount:h,slotStates:g,slotSource:m,domMutationCounts:c,domBoldCounts:d}}catch(r){return s("‚ùå Error extracting plant data:",r),null}var o}(e,n,t);r&&o.push(r)}),s(`üì¶ Scanned ${o.length} plants from inventory`),o}function vt(e){if(Array.isArray(e))return e;if(e&&"object"==typeof e){const t=e.items;if(Array.isArray(t))return t}return null}function wt(e){const t={},n=["id","name","species","itemType","type","category","kind"];for(const o of n)e&&"object"==typeof e&&o in e&&(t[o]=e[o]);if(e?.item&&"object"==typeof e.item){t.item={};for(const o of n)o in e.item&&(t.item[o]=e.item[o])}if(e?.plant&&"object"==typeof e.plant){t.plant={};for(const o of n)o in e.plant&&(t.plant[o]=e.plant[o])}return e?.itemName&&(t.itemName=e.itemName),t.hasSlots=!!At(e).length,t}function Ct(e){if("string"==typeof e){const t=e.trim();return t.length>0?t:null}return"number"==typeof e&&Number.isFinite(e)?e.toString():null}function Tt(e){if("number"==typeof e&&Number.isFinite(e))return e;if("string"==typeof e){const t=Number.parseInt(e,10);return Number.isNaN(t)?null:t}return null}function St(e,t){if(!e||"object"!=typeof e)return null;if(t.has(e))return null;if(t.add(e),Array.isArray(e)){for(const n of e){const e=St(n,t);if(e)return e}return null}const n=e,o=[[n.complete,n.total],[n.completed,n.total],[n.completed,n.goal],[n.count,n.total],[n.count,n.required],[n.current,n.max],[n.value,n.max]];for(const[i,a]of o){const e=Tt(i),t=Tt(a);if(null!=e&&null!=t&&t>0&&e>=0)return{complete:e,total:t}}const r=["progress","state","status","data","info","details","counts"];for(const i of r){const e=n[i];if(!e)continue;const o=St(e,t);if(o)return o}return null}function Pt(e,t=new WeakSet){if("string"==typeof e)return e;if("number"==typeof e&&Number.isFinite(e))return e.toString();if(!e||"object"!=typeof e)return null;if(t.has(e))return null;t.add(e);const n=e,o=["name","displayName","display_name","mutationName","mutation","label","title","text","type","kind","state","status","key"];let r=null;for(const a of o){const e=Ct(n[a]);if(e){r=e;break}}if(!r){const e=["mutation","mut","data","info","details","entry","node","item"];for(const o of e){const e=n[o];if(!e)continue;const i=Pt(e,t);if(i){r=i;break}}}const i=St(n,t);return i&&(r?/\d+\s*\/\s*\d+/.test(r)||(r=`${r} ${i.complete}/${i.total}`):r=`${i.complete}/${i.total}`),r}function kt(e){if(!e||"object"!=typeof e)return{};const t=e,n={},o=Object.keys(t).slice(0,10);for(const r of o){const e=t[r];if(null!=e)if("string"!=typeof e&&"number"!=typeof e&&"boolean"!=typeof e){if(Array.isArray(e))n[r]=e.slice(0,3).map(e=>{if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return e;if(e&&"object"==typeof e){const t=e,n=Object.keys(t).find(e=>{const n=t[e];return"string"==typeof n||"number"==typeof n});return n?t[n]:Object.keys(t).slice(0,3)}return typeof e});else if("object"==typeof e){const t=e,o={};for(const e of Object.keys(t).slice(0,5)){const n=t[e];"string"!=typeof n&&"number"!=typeof n&&"boolean"!=typeof n||(o[e]=n)}Object.keys(o).length>0&&(n[r]=o)}}else n[r]=e}return n}function At(e){if(!e||"object"!=typeof e)return[];const t=[e.slots,e.plant?.slots,e.item?.slots,e.data?.slots,e.slots?.slots,e.growSlots];for(const n of t)if(Array.isArray(n)&&n.length>0)return n;return[]}function Et(e){const t=function(e){if(!e||"object"!=typeof e)return[];const t=e,n=[],o=new Set,r=e=>{if(!e)return;const t=e.trim();t&&!o.has(t)&&(o.add(t),n.push(t))},i=[t.mutations,t.mutationStates,t.mutation_states,t.mutationHistory,t.appliedMutations,t.pendingMutations,t.mutationsList];for(const s of i)if(s)if(Array.isArray(s))for(const e of s)r(Pt(e));else if("object"==typeof s)for(const e of Object.values(s))r(Pt(e));const a=["mutation","mutationName","mutationType","currentMutation","activeMutation","latestMutation"];for(const s of a)r(Pt(t[s]));if(0===n.length){const e=[["wet","wet"],["water","wet"],["rain","wet"],["freeze","wet"],["frozen","wet"],["chill","wet"],["dawn","dawn"],["amber","amber"]];for(const[n,o]of Object.entries(t)){const t=n.toLowerCase(),i=e.find(([e])=>t.includes(e));if(!i)continue;const[,a]=i,s=St(o,new WeakSet);s&&r(`${a} ${s.complete}/${s.total}`)}}return n}(e);if(0===t.length&&st<5){const t=e&&"object"==typeof e?Object.keys(e).slice(0,10):[];s("[Mutations] Inventory slot missing mutation text",{keys:t,sample:kt(e)}),st+=1}return $t(t)}function $t(e){const t=new Set;let n=!1,o=!1,r=!1,i=!1,a=!1,s=!1,l=!1,c=!1,d=!1;const p={};let u=0,g=0,m=0;const f=(e,t,n)=>{if(!Number.isFinite(t)||!Number.isFinite(n))return;if(n<=0||t<0)return;const o=p[e];(!o||n>o.total||n===o.total&&t>o.complete)&&(p[e]={complete:t,total:n})};for(const b of e){const e=String(b??"").toLowerCase(),p=e.includes("frozen")||e.includes("freeze");p&&(n=!0,t.add("F"));const h=e.includes("wet");h&&(o=!0,t.add("W"));const y=e.includes("chill");y&&(r=!0,t.add("C")),(p||h||y)&&(u+=1);const x=e.includes("dawnbound");x&&(s=!0,t.add("D"));const v=e.includes("amberbound");v&&(l=!0,t.add("A"));const w=(e.includes("dawnlit")||e.includes("dawnlight")||e.includes("dawn"))&&!x;w&&(i=!0,t.add("D")),(w||x)&&(g+=1);const C=(e.includes("amberlit")||e.includes("amberlight")||e.includes("amber"))&&!v;C&&(a=!0,t.add("A")),(C||v)&&(m+=1);e.includes("rainbow")&&(c=!0,t.add("R"));e.includes("gold")&&(d=!0,t.add("G"));const T=e.match(/(\d+)\s*\/\s*(\d+)/);if(T){const e=Number.parseInt(T[1]??"0",10),t=Number.parseInt(T[2]??"0",10);(p||h||y)&&f("wet",e,t),(w||x)&&f("dawn",e,t),(C||v)&&f("amber",e,t)}}const h=Array.from(t).sort();return!p.wet&&u>0&&(p.wet={complete:u,total:u}),!p.dawn&&g>0&&(p.dawn={complete:g,total:g}),!p.amber&&m>0&&(p.amber={complete:m,total:m}),{letters:h,hasFrozen:n,hasWet:o,hasChilled:r,hasDawnlit:i,hasAmberlit:a,hasDawnbound:s,hasAmberbound:l,hasRainbow:c,hasGold:d,progress:p}}function Mt(e){return{letters:[...e.letters],hasFrozen:e.hasFrozen,hasWet:e.hasWet,hasChilled:e.hasChilled,hasDawnlit:e.hasDawnlit,hasAmberlit:e.hasAmberlit,hasDawnbound:e.hasDawnbound,hasAmberbound:e.hasAmberbound,hasRainbow:e.hasRainbow,hasGold:e.hasGold,progress:{...e.progress??{}}}}function It(e=0){return{F:e,W:e,C:e,D:e,A:e,R:e,G:e}}function Ft(e,t,n){const o=new Set;for(const r of e)r.letters.forEach(e=>o.add(e)),r.hasDawnbound&&o.add("D"),r.hasAmberbound&&o.add("A");for(const r of Oe)t[r]>0&&o.add(r);return n.D>0&&o.add("D"),n.A>0&&o.add("A"),Array.from(o).sort().join("")}function zt(e){return"F"===e||"W"===e||"C"===e||"D"===e||"A"===e||"R"===e||"G"===e}const Lt=["data-tm-inventory-base-index","data-tm-inventory-baseindex","data-tm-base-index","data-base-index"],Rt=["data-tm-inventory-id","data-inventory-id","data-item-id","data-itemid","data-itemId","data-item-uuid","data-itemuuid","data-item-guid","data-uuid","data-guid","data-entity-id","data-entityid","data-record-id","data-recordid","data-row-id","data-rowid","data-tm-item-id","data-tm-itemid","data-id"];function qt(e,t){for(const o of t){const t=e.getAttribute(o);if(null!=t)return t}const n=t.map(e=>e.toLowerCase());for(const{name:o,value:r}of Array.from(e.attributes))if(n.includes(o.toLowerCase())&&null!=r)return r;return null}function Nt(e,t){const n=e.dataset;if(!n)return null;for(const[o,r]of Object.entries(n))if(t(o)&&null!=r&&""!==r)return r;return null}function Bt(e){if(null==e)return null;const t=Number.parseInt(e,10);return Number.isFinite(t)?t:null}function Dt(e,t,n=!0){if("sunny"===t||"unknown"===t){const o={strategy:"fallback",fruitCount:Math.max(e.fruitCount,0),frozenCount:0,wetCount:0,chilledCount:0,dawnCount:0,amberCount:0,dawnBoundCount:0,amberBoundCount:0,rainbowCount:0,goldCount:0};return n&&yt(e,t,!1,o),{decision:!1,pendingFruits:0,totalFruits:Math.max(e.fruitCount,0),needsSnow:0,detail:o}}return e.slotStates.length>0&&("inventory"===e.slotSource||"garden"===e.slotSource)?function(e,t,n){const{slotStates:o}=e,r=o.some(e=>e.hasAmberlit||e.hasAmberbound),i=o.some(e=>e.hasDawnlit||e.hasDawnbound),a=o.some(e=>e.hasRainbow),l=o.some(e=>e.hasGold);if(!o.some(e=>e.letters.length>0||e.hasWet||e.hasFrozen||e.hasChilled||e.hasDawnlit||e.hasAmberlit||e.hasDawnbound||e.hasAmberbound||e.hasRainbow||e.hasGold))return Ht(e,t,n);const c=o.filter(e=>{const t=(e.hasAmberlit||e.hasAmberbound)&&(e.hasDawnlit||e.hasDawnbound),n=e.hasRainbow&&e.hasGold;return t||n});c.length>0&&s(`‚ö†Ô∏è ${e.name} has ${c.length} fruit(s) with conflicting mutations (same fruit cannot be both amber+dawn or rainbow+gold)`);let d=0,p=0,u=0,g=0,m=0,f=Math.max(e.fruitCount,1),h=0,b=0,y=0,x=0,v=0,w=0;for(const s of o){(s.hasWet||s.hasFrozen)&&(d+=1),s.hasWet&&!s.hasFrozen&&(p+=1);(s.hasChilled||s.hasFrozen)&&(u+=1),s.hasChilled&&s.hasFrozen,(s.hasDawnlit||s.hasDawnbound)&&(g+=1),(s.hasAmberlit||s.hasAmberbound)&&(m+=1);const e=s.progress?.wet;e&&(h=Math.max(h,e.total),b=Math.max(b,e.complete));const t=s.progress?.dawn;t&&(y=Math.max(y,t.total),x=Math.max(x,t.complete));const n=s.progress?.amber;n&&(v=Math.max(v,n.total),w=Math.max(w,n.complete))}f=Math.max(f,d,u,g,m);const C=e=>Math.max(0,Math.min(f,e)),T=C(e.domMutationCounts.F),S=C(e.domMutationCounts.W),P=C(T+S),k=C(Math.max(0,P-T)),A=C(e.domMutationCounts.C),E=C(T+A),$=C(e.domMutationCounts.D+e.domBoldCounts.D),M=C(e.domMutationCounts.A+e.domBoldCounts.A);d=Math.max(d,P),p=Math.max(p,k),u=Math.max(u,E),g=Math.max(g,$),m=Math.max(m,M),h>0&&(f=Math.max(f,h),d=Math.max(d,b));y>0&&(f=Math.max(f,y),g=Math.max(g,x));v>0&&(f=Math.max(f,v),m=Math.max(m,w));const I=Math.max(0,f-d),F=Math.max(0,f-u),z=Math.max(0,f-g),L=Math.max(0,f-m),R={strategy:"inventory",totalFruits:f,wetPending:I,wetFinished:d,wetNeedsSnow:p,wetProgressComplete:b,wetProgressTotal:h,domWetProgress:P,domWetNeedsSnow:k,dawnPending:z,dawnProgressComplete:x,dawnProgressTotal:y,domDawnComplete:$,amberPending:L,amberProgressComplete:w,amberProgressTotal:v,domAmberComplete:M,hasAnyDawn:i,hasAnyAmber:r,hasAnyRainbow:a,hasAnyGold:l};let q=!1,N=0,B=p;switch(t){case"rain":q=I>0,N=I;break;case"snow":F>0?(q=!0,N=F):(q=p>0,N=p);break;case"dawn":q=z>0,N=z,B=0;break;case"amber":q=L>0,N=L,B=0;break;default:q=!1,N=0,B=0}const D={decision:q,pendingFruits:Math.max(0,N),totalFruits:Math.max(1,f),needsSnow:Math.max(0,B),detail:{...R}};n&&yt(e,t,D.decision,D.detail);return D}(e,t,n):Ht(e,t,n)}function Ht(e,t,n){const{fruitCount:o,domMutationCounts:r,domBoldCounts:i}=e,a=Math.max(o,0);if(a<=0){const o={strategy:"fallback",fruitCount:a,frozenCount:0,wetCount:0,chilledCount:0,dawnCount:0,amberCount:0,dawnBoundCount:0,amberBoundCount:0,rainbowCount:0,goldCount:0};return n&&yt(e,t,!1,o),{decision:!1,pendingFruits:0,totalFruits:a,needsSnow:0,detail:o}}const s=e=>Math.max(0,Math.min(e,a)),l=s(r.F),c=s(r.W),d=s(r.C),p=s(r.D),u=s(r.A),g=s(r.R),m=s(r.G),f=s(i.D),h=s(i.A),b={strategy:"fallback",fruitCount:a,frozenCount:l,wetCount:c,chilledCount:d,dawnCount:p,amberCount:u,dawnBoundCount:f,amberBoundCount:h,rainbowCount:g,goldCount:m};let y=!1,x=0,v=Math.max(0,c-l);switch(t){case"rain":{const e=c+l;if(e<a)y=!0,x=Math.max(0,a-e);else{const e=d-l;y=e>0,x=Math.max(0,e)}break}case"snow":{const e=d+l;if(e<a)y=!0,x=Math.max(0,a-e);else{const e=c-l;y=e>0,x=Math.max(0,e)}v=Math.max(0,c-l);break}case"dawn":{if(u+h>0){y=!1,x=0;break}const e=p+f;x=Math.max(0,a-e),y=x>0,v=0;break}case"amber":{if(p+f>0){y=!1,x=0;break}const e=u+h;x=Math.max(0,a-e),y=x>0,v=0;break}default:y=!1,x=0,v=0}const w={decision:y,pendingFruits:Math.max(0,x),totalFruits:a,needsSnow:Math.max(0,v),detail:b};return n&&yt(e,t,w.decision,w.detail),w}function jt(e,t,n=null,o){const r={rain:{weather:"rain",plantCount:0,pendingFruitCount:0},snow:{weather:"snow",plantCount:0,pendingFruitCount:0,needsSnowFruitCount:0},dawn:{weather:"dawn",plantCount:0,pendingFruitCount:0},amber:{weather:"amber",plantCount:0,pendingFruitCount:0}},i=new Set,a=new Set,s=new Set,l=new Set;let c=0,d=0;const p=[];for(const x of e){const e={rain:Dt(x,"rain",!1),snow:Dt(x,"snow",!1),dawn:Dt(x,"dawn",!1),amber:Dt(x,"amber",!1)};let t=null;const n=e.dawn,o=e.amber;n.decision&&o.decision&&(t="amber-preferred"),p.push({plant:x,evaluations:e,lunarTag:t})}for(const{plant:x,evaluations:v,lunarTag:w}of p){const e=bt(x);a.add(e);const t=v.amber,n=v.dawn,p=Math.max(0,Math.round(t.pendingFruits)),u=Math.max(0,Math.round(n.pendingFruits)),g=Math.max(0,Math.round(t.totalFruits??0)),m=Math.max(0,Math.round(n.totalFruits??0));(g>0||m>0)&&s.add(e);let f=null;if(g>0||p>0?f=t:(m>0||u>0)&&(f=n),f){const t=Math.max(0,Math.round(f.totalFruits??0)),n=Math.max(0,Math.round(f.pendingFruits));t>0&&(c+=t,d+=n,n>0&&l.add(e))}for(const a of lt){const t=v[a];if(!t.decision)continue;const n=Math.max(0,Math.round(t.pendingFruits)),s="snow"===a?Math.max(0,Math.round(t.needsSnow)):0,l="amber"===a&&"amber-preferred"===w?"lunar-any":void 0;r[a].plantCount+=1,r[a].pendingFruitCount+=n,"snow"===a&&(r[a].needsSnowFruitCount=(r[a].needsSnowFruitCount??0)+s);const c={pendingFruit:n,needsSnowFruit:s};l&&(c.tag=l),o?.(a,x,c),i.add(e)}}const u=lt.reduce((e,t)=>e+r[t].pendingFruitCount,0),g=a.size,m=s.size,f=l.size,h=Math.max(0,m-f),b=Math.max(0,c-d),y=n?{...n,remainingMs:null!=n.expectedEndAt?Math.max(0,n.expectedEndAt-Date.now()):n.remainingMs??null}:null;return{timestamp:Date.now(),activeWeather:t,totals:r,overallEligiblePlantCount:i.size,overallPendingFruitCount:u,overallTrackedPlantCount:g,lunar:{trackedPlantCount:m,pendingPlantCount:f,mutatedPlantCount:h,totalFruitCount:c,pendingFruitCount:d,mutatedFruitCount:b},weatherWindow:y}}function _t(e){for(const t of e){const e=bt(t);if(!tt.has(e))continue;const n=t.element.parentElement;if(!n)continue;if(n.querySelector(".quinoa-mutation-highlight"))continue;const o=document.createElement("div");o.className="quinoa-mutation-highlight",o.style.cssText="\n      position: absolute;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      border: 3px solid #4CAF50;\n      border-radius: 8px;\n      pointer-events: auto;\n      z-index: 10;\n      animation: quinoa-pulse 1.5s infinite;\n      box-shadow: 0 0 15px rgba(76, 175, 80, 0.8);\n      cursor: pointer;\n    ",o.__plantId=e,o.addEventListener("click",e=>{e.stopPropagation();const n=o.__plantId;n&&(tt.delete(n),s(`‚úÖ Manually removed highlight from ${t.name}`)),o.remove()}),n.style.position="relative",n.appendChild(o)}if(!document.getElementById("quinoa-mutation-styles")){const e=document.createElement("style");e.id="quinoa-mutation-styles",e.textContent="\n      @keyframes quinoa-pulse {\n        0%, 100% { opacity: 1; }\n        50% { opacity: 0.5; }\n      }\n    ",document.head.appendChild(e)}}function Ot(){((e,t=document)=>Array.from(t.querySelectorAll(e)))(".quinoa-mutation-highlight").forEach(e=>e.remove()),tt.clear(),s("‚ú® Cleared plant highlights")}function Gt(e,t,n="info"){const o=document.querySelectorAll(".quinoa-notification");let r=20;o.forEach(e=>{const t=e.getBoundingClientRect();r=Math.max(r,t.bottom-document.documentElement.getBoundingClientRect().top+10)});const i=document.createElement("div");if(i.classList.add("quinoa-notification"),i.style.cssText=`\n    position: fixed;\n    top: ${r}px;\n    right: 20px;\n    background: ${{success:"rgba(76, 175, 80, 0.95)",info:"rgba(33, 150, 243, 0.95)",warning:"rgba(255, 152, 0, 0.95)"}[n]};\n    color: white;\n    padding: 16px 20px;\n    border-radius: 12px;\n    font-family: Arial, sans-serif;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n    z-index: 999999;\n    max-width: 320px;\n    animation: slideInRight 0.3s ease-out;\n    transition: top 0.3s ease-out;\n  `,i.innerHTML=`\n    <div style="font-size: 16px; font-weight: bold; margin-bottom: 4px;">${e}</div>\n    <div style="font-size: 13px; opacity: 0.95;">${t}</div>\n  `,!document.getElementById("quinoa-notification-styles")){const e=document.createElement("style");e.id="quinoa-notification-styles",e.textContent="\n      @keyframes slideInRight {\n        from {\n          transform: translateX(400px);\n          opacity: 0;\n        }\n        to {\n          transform: translateX(0);\n          opacity: 1;\n        }\n      }\n      @keyframes slideOutRight {\n        from {\n          transform: translateX(0);\n          opacity: 1;\n        }\n        to {\n          transform: translateX(400px);\n          opacity: 0;\n        }\n      }\n    ",document.head.appendChild(e)}document.body.appendChild(i),setTimeout(()=>{i.style.animation="slideOutRight 0.3s ease-in",setTimeout(()=>{i.remove(),function(){const e=document.querySelectorAll(".quinoa-notification");let t=20;e.forEach(e=>{e.style.top=`${t}px`;const n=e.getBoundingClientRect();t=n.bottom-document.documentElement.getBoundingClientRect().top+10})}()},300)},6e3)}function Vt(e){switch(e){case"rain":return"to freeze (C‚ÜíF)";case"snow":return"to freeze (W‚ÜíF)";case"dawn":return"to get Dawnlit";case"amber":return"to get Amberlit";default:return"for mutations"}}function Wt(e){switch(e){case"rain":return"üåßÔ∏è";case"snow":return"‚ùÑÔ∏è";case"dawn":return"üåÖ";case"amber":return"üåÜ";case"sunny":return"‚òÄÔ∏è";default:return"‚ùì"}}const Ut=Object.freeze(Object.defineProperty({__proto__:null,buildMutationSummary:jt,checkForMutations:async function(){ut(),Te(),Xe.enabled&&"sunny"!==Qe&&"unknown"!==Qe?await ht():Xe.enabled&&s("üå§Ô∏è Current weather is sunny or unknown - no mutations available")},combineMutationSources:Ft,computeSlotStateFromMutationNames:$t,createMutationCountMap:It,deriveWeatherWindowFromSnapshot:ft,resolveWeatherDurationMs:mt,setMutationReminderEnabled:function(e){Xe.enabled=e,g.set(Ge,Xe),e?(ut(),pt()):(Ke?.(),Ke=null)},simulateWeather:async function(e){s(`üß™ [DEBUG] Simulating weather: ${e}`),et=!0,ut();const t=function(e){switch(e){case"rain":return"rain";case"snow":return"snow";case"dawn":return"dawn";case"amber":return"amber";case"sunny":return"sunny";default:return null}}(e);t&&(!function(e,t=3e4){const n=Date.now()+Math.max(1e3,t);ce={kind:e,expiresAt:n},ve(!0)}(t,3e4),Te()),Je=Qe,Qe=e,Ot(),Xe.enabled&&"sunny"!==e&&"unknown"!==e?await ht():s("üå§Ô∏è Simulated weather is sunny or unknown - no mutations available"),setTimeout(()=>{et=!1,s("üß™ [DEBUG] Simulation mode ended, auto-detection resuming")},3e4)},startMutationReminder:dt},Symbol.toStringTag,{value:"Module"})),Xt="myDataAtom",Qt="__qpmGardenSnapshot__",Jt="__qpmMapSnapshot__";let Kt=!1,Yt=k(Qt)??null,Zt=k(Jt)??null,en=null;const tn=new Set;let nn=null;const on=1500;function rn(e){Yt!==e&&(Yt=e,function(){P(Qt,Yt);for(const t of tn)try{t(Yt)}catch(e){s("‚ö†Ô∏è Garden listener error",e)}}())}function an(e){if(!e||"object"!=typeof e)return null;return e.garden??null}async function sn(){if(Kt)return;Kt=!0,nn&&(clearTimeout(nn),nn=null);try{await _()}catch(t){return s("‚ö†Ô∏è Jotai store unavailable, garden bridge deferred",t),Kt=!1,void(nn||(nn=window.setTimeout(()=>{nn=null,sn()},on)))}try{const e=await async function(){const e=V(Xt);if(!e)throw s("‚ö†Ô∏è [GardenBridge] myDataAtom not found (labels may be unavailable, trying structure-based fallback)"),new Error("Unable to locate myDataAtom in jotaiAtomCache");s("[GardenBridge] ‚úÖ Found myDataAtom");const t=an(await W(e).catch(e=>(s("‚ö†Ô∏è [GardenBridge] Failed to read myDataAtom",e),null))??void 0);return s(t?.tileObjects?`[GardenBridge] ‚úÖ Garden data loaded (${Object.keys(t.tileObjects).length} tiles)`:"[GardenBridge] ‚ö†Ô∏è Garden data empty or invalid"),t}();rn(e);const t=await async function(){const e=V("mapAtom");if(!e)return s("‚ö†Ô∏è [GardenBridge] mapAtom not found"),null;s("[GardenBridge] ‚úÖ Found mapAtom");const t=await W(e).catch(e=>(s("‚ö†Ô∏è [GardenBridge] Failed to read mapAtom",e),null));return t&&t.cols&&t.rows?s(`[GardenBridge] ‚úÖ Map data loaded (${t.cols}x${t.rows} grid)`):s("[GardenBridge] ‚ö†Ô∏è Map data empty or invalid"),t}();t&&(Zt=t,P(Jt,Zt))}catch(t){s("‚ö†Ô∏è Unable to prime garden snapshot",t),nn||(nn=window.setTimeout(()=>{nn=null,Kt=!1,sn()},on))}const e=V(Xt);if(!e)return s("‚ö†Ô∏è myDataAtom missing after initialization"),Kt=!1,void(nn||(nn=window.setTimeout(()=>{nn=null,sn()},on)));en=await U(e,e=>{rn(an(e??void 0))}),s("‚úÖ [GardenBridge] Garden bridge started successfully")}function ln(){return Yt}function cn(){return Zt}function dn(e,t=!0){if(tn.add(e),t)try{e(Yt)}catch(n){s("‚ö†Ô∏è Garden listener immediate call failed",n)}return()=>{tn.delete(e)}}const pn=Object.freeze(Object.defineProperty({__proto__:null,getGardenSnapshot:ln,getMapSnapshot:cn,isGardenBridgeReady:function(){return Kt&&!!en},onGardenSnapshot:dn,startGardenBridge:sn},Symbol.toStringTag,{value:"Module"}));let un=!1,gn=null,mn="unknown",fn=null,hn=null;const bn=["wet","dawn","amber"];function yn(){un&&null===fn&&(fn=window.setTimeout(()=>{fn=null,function(){if(!un)return;const e=function(e){const t=[];if(!e)return t;const n=[{label:"garden",tiles:e.tileObjects},{label:"boardwalk",tiles:e.boardwalkTileObjects}];for(const{label:o,tiles:r}of n)if(r&&"object"==typeof r)for(const[e,n]of Object.entries(r)){if(!n||"object"!=typeof n)continue;const r=n;if("plant"!==r.objectType)continue;const{slotStates:i,inferredSpecies:a}=xn(r),s=i.length;if(0===s)continue;const l=Cn(i),c=Tn(i),d=Ft(i,l,c),p=`${Sn(r,a)} [${o}:${e}]`;t.push({name:p,mutations:d,element:document.createElement("div"),fruitCount:s,slotStates:i,slotSource:"garden",domMutationCounts:l,domBoldCounts:c})}return t}(gn),t={rain:[],snow:[],dawn:[],amber:[]},n=jt(e,mn,ft(mn,hn),(e,n,o)=>{const r={name:n.name,pendingFruit:o.pendingFruit,needsSnowFruit:o.needsSnowFruit,fruitCount:n.fruitCount,source:n.slotSource};o.tag&&(r.tag=o.tag),t[e].push(r)});Le("garden",n),Ie({source:"garden",generatedAt:n.timestamp,summary:n,perWeather:t,metadata:Fe(n,{scannedPlantCount:e.length})})}()},75))}function xn(e){const t=Array.isArray(e.slots)?e.slots:[],n=[];let o=null;for(const r of t){if(!r||"object"!=typeof r)continue;const e=r,t=vn(e);t&&!o&&(o=t);const i=$t((Array.isArray(e.mutations)?e.mutations:[]).map(e=>"string"==typeof e?e:null).filter(e=>!!e));wn(i,e),n.push(i)}return{slotStates:n,inferredSpecies:o}}function vn(e){const t=[e.species,e.seedSpecies,e.plantSpecies,e.cropSpecies,e.name];for(const n of t)if("string"==typeof n){const e=n.trim();if(e.length>0)return e}return null}function wn(e,t){const n=[t.progress,t.mutationProgress];for(const o of n){if(!o||"object"!=typeof o)continue;const t=o;for(const n of bn){const o=t[n];if(!o||"object"!=typeof o)continue;const r=o,i=Number(r.complete),a=Number(r.total);if(!Number.isFinite(a)||a<=0)continue;if(!Number.isFinite(i)||i<0)continue;const s=e.progress[n];(!s||a>s.total||a===s.total&&i>s.complete)&&(e.progress[n]={complete:i,total:a})}}}function Cn(e){const t=It(0);for(const n of e)n.hasFrozen&&(t.F+=1),n.hasWet&&(t.W+=1),n.hasChilled&&(t.C+=1),(n.hasDawnlit||n.hasDawnbound)&&(t.D+=1),(n.hasAmberlit||n.hasAmberbound)&&(t.A+=1),n.hasRainbow&&(t.R+=1),n.hasGold&&(t.G+=1);return t}function Tn(e){return{D:e.filter(e=>e.hasDawnbound).length,A:e.filter(e=>e.hasAmberbound).length}}function Sn(e,t){const n=[e.name,e.displayName,e.plantName,e.label],o=e.plant;if(o&&"object"==typeof o){const e=o;n.push(e.name),n.push(e.displayName)}for(const r of n)if("string"==typeof r){const e=r.trim();if(e.length>0)return e}return t&&t.length>0?t.toLowerCase().includes("plant")?t:`${t} Plant`:"Unknown Plant"}function Pn(e){switch(e){case"rain":case"snow":case"dawn":case"amber":return e;case"sunny":return"sunny";default:return"unknown"}}const kn=[{name:"Wet",category:"weather",multiplier:2,aliases:["Rainy"]},{name:"Chilled",category:"weather",multiplier:2},{name:"Frozen",category:"weather",multiplier:10}],An=[{name:"Dawnlit",category:"time",multiplier:2,aliases:["Dawn-lit"]},{name:"Dawnbound",category:"time",multiplier:3,aliases:["Dawn bound"]},{name:"Dawncharged",category:"time",multiplier:3,aliases:["Dawn charged"]},{name:"Amberlit",category:"time",multiplier:5,aliases:["Amber lit"]},{name:"Ambershine",category:"time",multiplier:5,aliases:["Amber shine"]},{name:"Amberbound",category:"time",multiplier:6,aliases:["Amber Radiant","Amberradiant","Amber-radiant","Amber radiant"]},{name:"Ambercharged",category:"time",multiplier:6,aliases:["Amber charged"]}],En=[{name:"Gold",category:"color",multiplier:25,aliases:["Golden"]},{name:"Rainbow",category:"color",multiplier:50},...kn,...An],$n=[In("Wet","Dawnlit",3),In("Chilled","Dawnlit",3),In("Wet","Amberlit",6),In("Chilled","Amberlit",6),In("Wet","Ambershine",6),In("Chilled","Ambershine",6),In("Frozen","Dawnlit",11),In("Frozen","Dawnbound",12),In("Frozen","Dawncharged",12),In("Frozen","Amberlit",14),In("Frozen","Ambershine",14),In("Frozen","Amberbound",15),In("Frozen","Ambercharged",15)],Mn=function(e){const t=new Map;for(const n of e)if(t.set(zn(n.name),n),n.aliases)for(const e of n.aliases)t.set(zn(e),n);return t}(En);function In(e,t,n){return{weather:Fn(kn,e),time:Fn(An,t),multiplier:n}}function Fn(e,t){const n=e.find(e=>e.name===t);if(!n)throw new Error(`Missing canonical mutation definition for ${t}`);return n}function zn(e){return e.trim().toLowerCase().replace(/[^a-z0-9]/g,"")}function Ln(e){const t=Rn(e);return t?t.name:null}function Rn(e){if(!e)return null;const t=zn(e);return t?Mn.get(t)??null:null}function qn(e){if(!e||0===e.length)return{color:null,weather:null,time:null,combo:null,totalMultiplier:1};const{colors:t,weathers:n,times:o}=function(e){const t=[],n=[],o=[],r=[];if(!e||0===e.length)return{colors:t,weathers:n,times:o,unknown:r};for(const i of e){const e=Rn(i);if(!e){r.push(i);continue}const a={definition:e,sourceName:i};"color"===e.category?t.push(a):"weather"===e.category?n.push(a):o.push(a)}return{colors:t,weathers:n,times:o,unknown:r}}(e),r=Nn(t),i=Nn(n),a=Nn(o),s=i&&a?function(e,t){for(const n of $n)if(n.weather===e&&n.time===t)return n;return null}(i.definition,a.definition):null,l=r?.definition.multiplier??1;let c=1;return s?c=s.multiplier:i&&a?c=Math.max(i.definition.multiplier,a.definition.multiplier):i?c=i.definition.multiplier:a&&(c=a.definition.multiplier),{color:r,weather:i,time:a,combo:s,totalMultiplier:l*c}}function Nn(e){return e.length?e.reduce((e,t)=>e?t.definition.multiplier>e.definition.multiplier?t:e:t,null):null}const Bn={Sunflower:75e4,Starweaver:1e7,DawnCelestial:11e6,MoonCelestial:11e6,Lychee:5e4,DragonFruit:24500,PassionFruit:24500,Lemon:1e4,Pepper:7220,Grape:7085,Bamboo:5e5,Cactus:287e3,Mushroom:16e4,BurrosTail:6e3,Lily:20123,Banana:1750,Coconut:302,Echeveria:5520,Pumpkin:3700,Watermelon:2708,Corn:36,Daffodil:1090,Tomato:27,OrangeTulip:767,Apple:73,Blueberry:23,Aloe:310,Strawberry:14,Carrot:20};function Dn(e){return(new Intl.NumberFormat).format(Math.round(e))}function Hn(e){const t=Math.abs(e),n=e<0?"-":"";return t>=1e12?`${n}${(t/1e12).toFixed(1)}T`:t>=1e9?`${n}${(t/1e9).toFixed(1)}B`:t>=1e6?`${n}${(t/1e6).toFixed(1)}M`:t>=1e3?`${n}${(t/1e3).toFixed(1)}K`:`${n}${Math.round(t)}`}function jn(e,t=1,n,o=1){const r=Bn[e];if(!r)return 0;const i=function(e){return e&&0!==e.length?qn(e).totalMultiplier:1}(n??[]);return Math.round(r*i*t*o)}const _n={carrot:3,strawberry:2,aloe:2.5,delphinium:3,blueberry:2,apple:2,appletree:2,tulip:3,orangetulip:3,tomato:2,daffodil:3,corn:2,cornkernel:2,watermelon:3,pumpkin:3,echeveria:2.75,echeveriacutting:2.75,coconut:3,coconuttree:3,banana:1.7,lily:2.75,camellia:2.5,squash:2.5,burrostail:2.5,burrostailcutting:2.5,mushroom:3.5,mushroomspore:3.5,cactus:1.8,bamboo:2,bambooshoot:2,chrysanthemum:2.75,grape:2,pepper:2,lemon:3,lemontree:3,passionfruit:2,passion:2,dragonfruit:2.024,dragon:2.024,lychee:2,lycheepit:2,sunflower:2.5,starweaver:2,starweaverpod:2,starweaverfruit:2,dawnbinder:2.5,dawncelestial:2.5,dawnbinderpod:2.5,dawnbinderbulb:2.5,moonbinder:2,mooncelestial:2,moonbinderpod:2,moonbinderbulb:2,favabean:3,favabeanpod:3,cacaofruit:2.5};function On(e){const t=_n[e];return"number"==typeof t&&Number.isFinite(t)?t:null}function Gn(e){if(!e)return"‚Äî";const t=Math.max(1,Math.floor((Date.now()-e)/1e3));if(t<60)return`${t}s ago`;const n=Math.floor(t/60);if(n<60)return`${n}m ago`;const o=Math.floor(n/60);if(o<24)return`${o}h ago`;return`${Math.floor(o/24)}d ago`}function Vn(e){return e.toLowerCase().replace(/[''`]/g,"").replace(/\s+/g,"").replace(/-/g,"").replace(/(seed|plant|baby|fruit|crop)$/i,"")}function Wn(e,t=120){let n;return(...o)=>{clearTimeout(n),n=setTimeout(()=>e(...o),t)}}const Un={Rainbow:{label:"Rainbow",highlightNames:["Rainbow"],canonicalNames:["Rainbow"]},Gold:{label:"Gold",highlightNames:["Gold"],canonicalNames:["Gold"]},Frozen:{label:"Frozen",highlightNames:["Frozen"],canonicalNames:["Frozen"]},Wet:{label:"Wet",highlightNames:["Wet"],canonicalNames:["Wet"]},Chilled:{label:"Chilled",highlightNames:["Chilled"],canonicalNames:["Chilled"]},Dawnlit:{label:"Dawnlit",highlightNames:["Dawnlit"],canonicalNames:["Dawnlit"]},Amberlit:{label:"Amberlit",highlightNames:["Amberlit","Ambershine"],canonicalNames:["Amberlit","Ambershine"]},Amberbound:{label:"Amberbound",highlightNames:["Amberbound","Ambercharged","Amber Radiant","Amberradiant","Amber-radiant"],canonicalNames:["Amberbound","Ambercharged"]},Dawnbound:{label:"Dawnbound (charged)",highlightNames:["Dawnbound","Dawncharged"],canonicalNames:["Dawnbound","Dawncharged"]}},Xn=1.5,Qn=new Set,Jn=new Set,Kn={enabled:!1,highlightEnabled:!0,toastEnabled:!0,minSize:80,selectedMutations:{Rainbow:!0,Gold:!1,Frozen:!1,Wet:!1,Chilled:!1,Dawnlit:!1,Amberlit:!1,Amberbound:!1,Dawnbound:!1}};let Yn=!1,Zn=null,eo={readyCount:0,mutatedCount:0,totalValue:0,highestValue:null,friendBonus:Xn},to=null,no="unknown",oo=[],ro=new Set,io=null;function ao(e){if("boolean"==typeof e.enabled&&(Kn.enabled=e.enabled),"boolean"==typeof e.highlightEnabled&&(Kn.highlightEnabled=e.highlightEnabled,Kn.highlightEnabled?oo.length>0&&ho(oo):yo()),"boolean"==typeof e.toastEnabled&&(Kn.toastEnabled=e.toastEnabled),"number"==typeof e.minSize&&(Kn.minSize=Math.min(100,Math.max(50,Math.round(e.minSize)))),e.selectedMutations)for(const t of Object.keys(Un)){const n=e.selectedMutations[t];"boolean"==typeof n&&(Kn.selectedMutations[t]=n)}Kn.enabled&&lo(),Kn.enabled?po():(oo=[],ro.clear(),eo={readyCount:0,mutatedCount:0,totalValue:0,highestValue:null,friendBonus:Xn},so(),bo())}function so(){for(const t of Qn)try{t(eo)}catch(e){s("‚ö†Ô∏è Harvest summary listener error",e)}}function lo(){Ce(),to||(to=Se(co,!0))}function co(e){const t=function(e){return"weather"===e.raw?"weather":"noweather"===e.raw?"noweather":"unknown"}(e);t!==no&&(no=t,"noweather"===no&&ro.clear(),Kn.enabled?po():"noweather"!==no&&yo())}function po(){if(!Kn.enabled)return;const e=Zn??ln();if(!e||!e.tileObjects)return fo([]),void bo();const t=function(e,t,n){const o=[];if(!e||!e.tileObjects)return o;for(const[r,i]of Object.entries(e.tileObjects)){if(!i||"object"!=typeof i)continue;const e=i;if("plant"!==e.objectType)continue;(Array.isArray(e.slots)?e.slots:[]).forEach((e,i)=>{const a="string"==typeof e?.species?e.species:null;if(!a)return;const s=e?.endTime??e?.readyAt??e?.harvestReadyAt,l="number"==typeof s?s:Number(s);if(!Number.isFinite(l)||l>n)return;const c=(Array.isArray(e?.mutations)?e.mutations:[]).filter(e=>"string"==typeof e);if(!go(c,t))return;const d=e?.targetScale,p="number"==typeof d&&Number.isFinite(d)?d:1,u=mo(p,a,e);if(u<Kn.minSize)return;const g=qn(c),m=c.filter(e=>!Ln(e)),f=jn(a,p,c,Xn),h=`${r}:${i}`;o.push({key:h,tileId:r,slotIndex:i,species:a,mutations:c,size:u,value:f,multiplier:g,unknownMutations:m})})}return o.sort((e,t)=>t.value-e.value),o}(e,uo(),Date.now());fo(t),ho(t),function(e){if(!Kn.toastEnabled)return;if(0===e.length)return;const t=e.filter(e=>!ro.has(e.key));if(0===t.length)return;for(const r of t)ro.add(r.key);const n=function(e){const{species:t,size:n,value:o,multiplier:r,mutations:i,unknownMutations:a}=e,s=xo(r,a),l=vo(r.totalMultiplier),c=i.length?s:"No bonus mutations";return`üåæ ${t} ‚Äî ${c} ‚Üí total x${l} ‚Ä¢ size ${n} (~${Dn(o)} coins)`}(t[0]);for(const r of Jn)try{r(n)}catch(o){s("‚ö†Ô∏è Harvest toast listener error",o)}try{window.queueNotification?.(n,!1)}catch(o){s("‚ö†Ô∏è Failed to queue harvest notification",o)}}(t)}function uo(){return Object.keys(Un).filter(e=>Kn.selectedMutations[e])}function go(e,t){if(0===t.length)return!0;if(!e||0===e.length)return!1;const n=new Set;for(const o of e){const e=Ln(o);e&&n.add(e)}return 0!==n.size&&t.some(e=>Un[e].canonicalNames.some(e=>n.has(e)))}function mo(e,t,n){const o=Number.isFinite(e)&&e>0?e:1;let r=null;if(n&&"object"==typeof n){const e=Number(n.maxScale);Number.isFinite(e)&&e>1&&(r=e)}if("number"!=typeof r||!Number.isFinite(r)||r<=1){const e=Vn(t);r=(e?On(e):null)??2}const i=Math.max(1.01,r),a=Math.min(i,Math.max(1,o)),s=50+50*(i>1?(a-1)/(i-1):0);return Math.round(s)}function fo(e){if(oo=e,0===e.length)eo={readyCount:0,mutatedCount:0,totalValue:0,highestValue:null,friendBonus:Xn};else{const t=e[0];eo={readyCount:e.length,mutatedCount:e.filter(e=>e.mutations.length>0).length,totalValue:e.reduce((e,t)=>e+t.value,0),highestValue:{species:t.species,value:t.value,mutations:t.mutations,size:t.size,multiplier:t.multiplier,breakdownText:xo(t.multiplier,t.unknownMutations),totalMultiplierText:vo(t.multiplier.totalMultiplier),unknownMutations:t.unknownMutations},friendBonus:Xn}}so()}function ho(e){if(!Kn.highlightEnabled)return void bo();const t=e.map(e=>e.key).join("|");if(t!==io)if(io=t,0!==e.length)try{const t=T.highlightTilesByMutation;if("function"!=typeof t)return;try{const e=T.removeAllTileOverrides;"function"==typeof e&&e.call(T)}catch(n){s("‚ö†Ô∏è Failed to clear previous highlights",n)}const o=Array.from(new Set(e.map(e=>e.species))),r=function(){const e=[];for(const t of uo())e.push(...Un[t].highlightNames);return Array.from(new Set(e))}(),i=o.map(()=>r.length>0?r[0]:null),a={highlightSpecies:o,highlightMutations:i,slotIndex:0,highlightScale:null,hiddenSpecies:"Carrot",hiddenScale:.1};P("__qpmHarvestDebugConfig",{...a,attemptedMutations:r}),t.call(T,a);const l=T.setTimeout;l?.call(T,()=>{try{T.dispatchEvent?.(new Event("visibilitychange"))}catch(n){s("‚ö†Ô∏è Failed to nudge render after highlight",n)}},120)}catch(n){s("‚ö†Ô∏è Failed to apply harvest highlight",n)}else bo()}function bo(){io=null,yo()}function yo(){try{const e=T.removeAllTileOverrides;"function"==typeof e&&e.call(T)}catch(e){s("‚ö†Ô∏è Unable to clear harvest highlights",e)}}function xo(e,t){const n=[];if(e.color&&n.push(`${e.color.definition.name} x${vo(e.color.definition.multiplier)}`),e.combo?n.push(`${e.combo.weather.name} + ${e.combo.time.name} combo x${vo(e.combo.multiplier)}`):(e.weather&&n.push(`${e.weather.definition.name} x${vo(e.weather.definition.multiplier)}`),e.time&&n.push(`${e.time.definition.name} x${vo(e.time.definition.multiplier)}`)),n.length||1!==e.totalMultiplier||n.push("No bonus mutations"),t.length){const e=1===t.length?"1 unrecognized mutation":`${t.length} unrecognized mutations`;n.push(e)}return n.join(" + ")}function vo(e){return Number.isInteger(e)?e.toString():e.toFixed(2)}function wo(...e){console.log("[QPM Catalog]",...e)}const Co={itemCatalog:null,decorCatalog:null,mutationCatalog:null,eggCatalog:null,petCatalog:null,petAbilities:null,plantCatalog:null,weatherCatalog:null},To=new WeakSet;let So=!1;const Po=[],ko=[],Ao=Object,Eo=Ao.keys,$o=Ao.values,Mo=Ao.entries;function Io(e,t){if(!e||"object"!=typeof e)return;if(To.has(e))return;To.add(e);let n=[];try{n=Eo.call(Ao,e)}catch{return}if(0===n.length)return;const o=e;try{!Co.itemCatalog&&function(e,t){if(!["WateringCan","PlanterPot","Shovel","RainbowPotion"].every(e=>t.includes(e)))return!1;const n=e.WateringCan;return null!==n&&"object"==typeof n&&"coinPrice"in n&&"creditPrice"in n}(o,n)&&(Co.itemCatalog=o,wo("Captured itemCatalog")),!Co.decorCatalog&&function(e,t){if(!["SmallRock","MediumRock","LargeRock"].every(e=>t.includes(e)))return!1;const n=e.SmallRock;return null!==n&&"object"==typeof n&&"coinPrice"in n&&"creditPrice"in n}(o,n)&&(Co.decorCatalog=o,wo("Captured decorCatalog")),!Co.mutationCatalog&&function(e,t){if(!["Gold","Rainbow","Wet","Chilled","Frozen"].every(e=>t.includes(e)))return!1;const n=e.Gold;return null!==n&&"object"==typeof n&&"baseChance"in n&&"coinMultiplier"in n}(o,n)&&(Co.mutationCatalog=o,wo("Captured mutationCatalog")),!Co.eggCatalog&&function(e,t){if(!["CommonEgg","UncommonEgg","RareEgg","LegendaryEgg"].every(e=>t.includes(e)))return!1;const n=e.CommonEgg;return null!==n&&"object"==typeof n&&"faunaSpawnWeights"in n&&"secondsToHatch"in n}(o,n)&&(Co.eggCatalog=o,wo("Captured eggCatalog")),!Co.petCatalog&&function(e,t){const n=["Worm","Snail","Bee","Chicken","Bunny","Turkey","Goat"];if(n.filter(e=>t.includes(e)).length<3)return!1;const o=n.find(e=>t.includes(e));if(!o)return!1;const r=e[o];return null!==r&&"object"==typeof r&&"coinsToFullyReplenishHunger"in r&&"diet"in r&&Array.isArray(r.diet)}(o,n)&&(Co.petCatalog=o,wo(`‚úÖ Captured petCatalog with ${n.length} species:`,n.slice(0,10).join(", "),"...")),!Co.petAbilities&&function(e,t){if(!["ProduceScaleBoost","DoubleHarvest","SeedFinderI","CoinFinderI"].every(e=>t.includes(e)))return!1;const n=e.ProduceScaleBoost;return null!==n&&"object"==typeof n&&"trigger"in n&&"baseParameters"in n}(o,n)&&(Co.petAbilities=o,wo("Captured petAbilities")),!Co.plantCatalog&&function(e,t){const n=["Carrot","Strawberry","Aloe","Blueberry","Apple","Tomato","Corn"];if(n.filter(e=>t.includes(e)).length<3)return!1;const o=n.find(e=>t.includes(e));if(!o)return!1;const r=e[o];return null!==r&&"object"==typeof r&&"seed"in r&&"plant"in r&&"crop"in r}(o,n)&&(Co.plantCatalog=o,wo(`‚úÖ Captured plantCatalog with ${n.length} species:`,n.slice(0,10).join(", "),"...")),function(){if(So)return;if(null!==Co.petCatalog){So=!0,wo("Essential catalogs ready");try{"undefined"!=typeof window&&(window.__QPM_CATALOGS=Co),void 0!==globalThis.unsafeWindow&&(globalThis.unsafeWindow.__QPM_CATALOGS=Co)}catch(e){wo("Failed to expose __QPM_CATALOGS to window:",e)}for(const e of Po)try{e(Co)}catch(t){console.error("[Catalog] Ready callback error:",t)}Po.length=0}}()}catch(r){}if(!(t>=3))for(const i of n)try{const e=o[i];e&&"object"==typeof e&&Io(e,t+1)}catch{}}function Fo(e){try{Io(e,0)}catch{}}function zo(){return Co}function Lo(){return So}function Ro(e=15e3){return new Promise((t,n)=>{if(So)return void t(Co);const o=setTimeout(()=>{const t=Po.indexOf(r);-1!==t&&Po.splice(t,1);const o=ko.indexOf(i);-1!==o&&ko.splice(o,1),n(new Error(`Catalogs not ready within ${e}ms`))},e),r=e=>{clearTimeout(o),t(e)},i=e=>{clearTimeout(o),n(e)};Po.push(r),ko.push(i)})}function qo(e){if(So){try{e(Co)}catch(t){console.error("[Catalog] onCatalogsReady callback error:",t)}return()=>{}}return Po.push(e),()=>{const t=Po.indexOf(e);-1!==t&&Po.splice(t,1)}}function No(){wo("Initializing catalog loader..."),function(){try{Ao.keys=function(e){return Fo(e),Eo.call(Ao,e)},$o&&(Ao.values=function(e){return Fo(e),$o.call(Ao,e)}),Mo&&(Ao.entries=function(e){return Fo(e),Mo.call(Ao,e)}),wo("Object.* hooks installed")}catch(e){console.error("[Catalog] Failed to install hooks:",e)}}(),qo(()=>{setTimeout(()=>{Co.petCatalog&&Co.plantCatalog&&Co.eggCatalog&&(wo("Removing hooks after successful capture"),function(){try{Ao.keys=Eo,$o&&(Ao.values=$o),Mo&&(Ao.entries=Mo),wo("Object.* hooks removed")}catch{}}())},3e4)})}function Bo(){console.log("[QPM Catalog Diagnostics]"),console.log("Catalogs Ready:",So),console.log("Hooks Active:",Ao.keys!==Eo);const e=Co;console.log("\nPlant Catalog:",e.plantCatalog?`‚úÖ ${Object.keys(e.plantCatalog).length} species`:"‚ùå Not captured"),e.plantCatalog&&console.log("  Species:",Object.keys(e.plantCatalog).join(", ")),console.log("\nPet Catalog:",e.petCatalog?`‚úÖ ${Object.keys(e.petCatalog).length} species`:"‚ùå Not captured"),e.petCatalog&&console.log("  Species:",Object.keys(e.petCatalog).join(", ")),console.log("\nPet Abilities:",e.petAbilities?`‚úÖ ${Object.keys(e.petAbilities).length} abilities`:"‚ùå Not captured"),e.petAbilities&&console.log("  Abilities:",Object.keys(e.petAbilities).slice(0,20).join(", "),"..."),console.log("\nMutation Catalog:",e.mutationCatalog?`‚úÖ ${Object.keys(e.mutationCatalog).length} mutations`:"‚ùå Not captured"),console.log("\nüí° Tip: Access catalogs directly via window.__QPM_CATALOGS"),console.log("üí° To check if specific species exist:"),console.log('   window.__QPM_CATALOGS.plantCatalog["PineTree"]'),console.log("   Object.keys(window.__QPM_CATALOGS.plantCatalog)")}function Do(){return zo().petCatalog}function Ho(){const e=Do();return e?Object.keys(e):[]}function jo(){return zo().plantCatalog}function _o(e){const t=jo();return t?t[e]??null:null}function Oo(){const e=jo();return e?Object.keys(e):[]}function Go(e){const t=zo().eggCatalog;return t?t[e]??null:null}function Vo(){return zo().mutationCatalog}function Wo(){const e=Vo();return e?Object.keys(e):[]}function Uo(e){const t=function(e){const t=Vo();return t?t[e]??null:null}(e);return t?.coinMultiplier??1}function Xo(){return zo().petAbilities}function Qo(e){const t=Xo();return t?t[e]??null:null}function Jo(){const e=function(){const e=zo();return{petCatalog:{loaded:null!==e.petCatalog,count:e.petCatalog?Object.keys(e.petCatalog).length:0},plantCatalog:{loaded:null!==e.plantCatalog,count:e.plantCatalog?Object.keys(e.plantCatalog).length:0},eggCatalog:{loaded:null!==e.eggCatalog,count:e.eggCatalog?Object.keys(e.eggCatalog).length:0},itemCatalog:{loaded:null!==e.itemCatalog,count:e.itemCatalog?Object.keys(e.itemCatalog).length:0},decorCatalog:{loaded:null!==e.decorCatalog,count:e.decorCatalog?Object.keys(e.decorCatalog).length:0},mutationCatalog:{loaded:null!==e.mutationCatalog,count:e.mutationCatalog?Object.keys(e.mutationCatalog).length:0},petAbilities:{loaded:null!==e.petAbilities,count:e.petAbilities?Object.keys(e.petAbilities).length:0}}}();console.log("[QPM Catalogs] Load Status:");for(const[t,n]of Object.entries(e))console.log(`  ${t}: ${n.loaded?`‚úÖ (${n.count} entries)`:"‚ùå not loaded"}`)}"undefined"!=typeof window&&(window.__QPM_DiagnoseCatalogs=Bo);const Ko={worm:500,snail:1e3,bee:1500,chicken:3e3,bunny:750,dragonfly:250,pig:5e4,cow:25e3,turkey:500,squirrel:15e3,turtle:1e5,goat:2e4,snowfox:14e3,stoat:1e4,whitecaribou:3e4,caribou:3e4,butterfly:25e3,capybara:15e4,peacock:1e5},Yo=3e3;function Zo(e){if(!e)return null;try{const t=function(e){const t=Do();return t?t[e]??null:null}(e);if(null!=t?.coinsToFullyReplenishHunger&&t.coinsToFullyReplenishHunger>0)return t.coinsToFullyReplenishHunger}catch(n){}const t=function(e){return e.replace(/[^a-z0-9]/gi,"").toLowerCase()}(e);return t?Ko[t]??null:null}function er(e){return Zo(e)??Yo}const tr={Worm:12,Snail:12,Bee:12,Chicken:24,Bunny:24,Dragonfly:24,Pig:72,Cow:72,Turkey:72,Squirrel:100,Turtle:100,Goat:100,Butterfly:144,Peacock:144,Capybara:144};function nr(e){if(!e)return null;const t=e.toLowerCase().trim();for(const[n,o]of Object.entries(tr))if(n.toLowerCase()===t)return o;for(const[n,o]of Object.entries(tr))if(t.includes(n.toLowerCase())||n.toLowerCase().includes(t))return o;return null}const or=new Map,rr=new Set;function ir(e){const t={currentLevel:null,maxLevel:30,confidence:"none",totalXPNeeded:null,xpGainRate:null};if(!e.petId||null==e.xp)return t;const n=or.get(e.petId);if(!n||n.length<2)return t;const o=function(e){if(e.length<2)return null;const t=e[0],n=e[e.length-1],o=n.xp-t.xp,r=(n.timestamp-t.timestamp)/1e3;return r<=0||o<=0?null:o/r}(n);if(!o)return t;const r=function(e){const t=nr(e);return t?3600*t:null}(e.species);if(!r)return e.species&&!rr.has(e.species)&&(rr.add(e.species),s(`‚ö†Ô∏è No time-to-mature data for species: ${e.species}`)),{...t,xpGainRate:o};const i=o*r;let a=e.xp/i*30;a=Math.max(0,Math.min(30,a));const l=(n[n.length-1].timestamp-n[0].timestamp)/1e3;let c="low";return n.length>=5&&l>=300?c="high":n.length>=3&&l>=120&&(c="medium"),{currentLevel:Math.round(a),maxLevel:30,confidence:c,totalXPNeeded:i,xpGainRate:o}}let ar=[],sr=null,lr=!1;const cr=new Set;let dr=null;function pr(e){if(null==e)return null;if("number"==typeof e)return Number.isFinite(e)?e:null;if("string"==typeof e){const t=e.match(/-?\d+(?:\.\d+)?/);if(!t)return null;const n=Number(t[0]);return Number.isFinite(n)?n:null}return"object"==typeof e?pr(e?.valueOf?.()):null}function ur(e){return Number.isFinite(e)?e<0?0:e>100?100:e:0}function gr(e,t=!1){if(!Number.isFinite(e))return null;if(e<0)return 0;if(e>0&&e<=1)return 100*e;if(e>=0&&e<=100)return e;if(t&&e>100&&e<=1e4){const t=e/100;if(t<=100)return t}return null}function mr(e){const t=e.slot??{},n=[e.name,e.displayName,t.name,t.displayName];for(const o of n)if("string"==typeof o&&o.trim().length>0)return o.trim();return null}function fr(e){if(!e)return[];if(Array.isArray(e))return e.filter(e=>!!e&&"object"==typeof e);if(e instanceof Map)return Array.from(e.values()).filter(e=>!!e&&"object"==typeof e);if(e instanceof Set)return Array.from(e.values()).filter(e=>!!e&&"object"==typeof e);if("object"==typeof e){const t=e,n=[];for(const[e,o]of Object.entries(t))/^\d+$/.test(e)&&o&&"object"==typeof o&&n.push(o);if(n.length)return n}return[]}function hr(e){const t=e.slot;return t&&"object"==typeof t?t:e}function br(e){if(null==e)return null;if("string"==typeof e){const t=e.trim();return t.length>0?t:null}return"number"==typeof e&&Number.isFinite(e)?String(e):null}function yr(e){const t=new Set,n=[];for(const o of e){const e=o.toLowerCase();t.has(e)||(t.add(e),n.push(o))}return n}function xr(e){if(!e)return[];if("string"==typeof e){const t=br(e);return t?[t]:[]}if(Array.isArray(e)){const t=[];for(const n of e){const e=br(n);e&&t.push(e)}return t}return e instanceof Set?xr(Array.from(e.values())):[]}function vr(e){const t=hr(e),n=t.pet??e.pet??null,o=[e.slotId,t.slotId,t.slotID,t.id,n?.slotId,n?.id,e.id];for(const r of o){const e=br(r);if(e)return e}return null}function wr(e){const t=hr(e),n=t.pet??e.pet??null,o=[e.petId,t.petId,n?.petId,n?.id,t.id,e.entityId];for(const r of o){const e=br(r);if(e)return e}return vr(e)}function Cr(e){const t=hr(e),n=t.pet??e.pet??null;return yr([...xr(e.mutations),...xr(t.mutations),...xr(n?.mutations)])}function Tr(e){const t=hr(e),n=t.pet??e.pet??null;return yr([...xr(e.abilities),...xr(t.abilities),...xr(t.ability),...xr(n?.abilities)])}function Sr(e){const t=hr(e),n=[e.position,e.pos,t.position,t.pos];for(const o of n){if(!o||"object"!=typeof o)continue;const e=o,t=pr(e.x??e.X??e.left??e.posX??e.longitude),n=pr(e.y??e.Y??e.top??e.posY??e.latitude);if(null!=t||null!=n)return{x:t??null,y:n??null}}return null}function Pr(e){const t=function(e){const t=[e],n=new Set;for(;t.length;){const e=t.shift();if(null==e)continue;const o=fr(e);if(o.length)return o;if("object"==typeof e){if(n.has(e))continue;if(n.add(e),e instanceof Map){for(const n of e.values())t.push(n);continue}if(e instanceof Set){for(const n of e.values())t.push(n);continue}const o=e;for(const e of Object.values(o))t.push(e)}}return[]}(e);if(!t.length)return[];const n=Date.now(),o=[],r=function(){const e=[];try{const t=document.querySelectorAll("p.chakra-text.css-1jrst1o");for(const n of t){const t=(n.textContent||"").match(/\bSTR\s+(\d+)\b/i);if(t&&t[1]){const n=parseInt(t[1],10);e.includes(n)||e.push(n)}}}catch(t){}return e}();return t.forEach((e,t)=>{if(!e||"object"!=typeof e)return;const i=e,a=hr(i),s=a.stats??void 0,l=a.pet??i.pet??void 0,c=function(e,t){const n=[e.slotIndex,e.slot?.slotIndex,e.order,e.index,e.slot?.index,e.slot?.originalIndex,e.slot?.orderedIndex,t];for(const o of n){const e=pr(o);if(null!=e&&Number.isFinite(e))return Math.max(0,Math.round(e))}return t}(i,t),d=function(e){const t=e.slot??{},n=[e.species,t.species,t.petSpecies,e.petSpecies];for(const o of n)if("string"==typeof o&&o.trim().length>0)return o.trim();return null}(i),p=function(e,t,n,o){const r=t.pet??e.pet??null,i=[{value:e.hungerPct,hint:"entry.hungerPct"},{value:e.hunger_percentage,hint:"entry.hunger_percentage"},{value:e.hunger,hint:"entry.hunger"},{value:t.hungerPct,hint:"slot.hungerPct"},{value:t.hunger_percentage,hint:"slot.hunger_percentage"},{value:t.hunger,hint:"slot.hunger"},{value:n?.hungerPct,hint:"stats.hungerPct"},{value:n?.hunger,hint:"stats.hunger"},{value:r?.hungerPct,hint:"nested.hungerPct"},{value:r?.hunger,hint:"nested.hunger"}];let a=null;const s=[],l=[];for(const{value:p,hint:u}of i){if(null==p)continue;null==a&&(a=String(p));const e=pr(p);if(null==e)continue;const t=/pct|percent/i.test(u),n=gr(e,t);null!=n&&(t||e<=100)?s.push(n):l.push(e)}const c=l.length>0?l[0]:null,d=o?Zo(o):null;if(s.length)return{pct:ur(s[0]),value:c,max:d,raw:a};if(null!=c)return null!=d&&d>0?{pct:ur(c/d*100),value:c,max:d,raw:a}:c>0?{pct:ur(c/Yo*100),value:c,max:Yo,raw:a}:{pct:0,value:c,max:d,raw:a};return{pct:null,value:null,max:d,raw:a}}(i,a,s,d),u=[a.xp,s?.xp,i.xp];let g=null;for(const n of u){const e=pr(n);if(null!=e){g=e;break}}const m=[a.level,s?.level,i.level,l?.level];let f=null,h=null;for(const n of m){null!=n&&null==h&&(h="string"==typeof n?n:String(n));const e=pr(n);if(null!=e){f=Math.max(0,Math.round(e));break}}const b=[a.strength,s?.strength,i.strength];let y=null;for(const n of b){const e=pr(n);if(null!=e){y=e;break}}null==y&&c<r.length&&(y=r[c]??null);const x=[a.targetScale,s?.targetScale,i.targetScale,l?.targetScale];let v=null;for(const n of x){const e=pr(n);if(null!=e){v=e;break}}const w={slotIndex:c,slotId:vr(i),petId:wr(i),hungerPct:p.pct,hungerValue:p.value,hungerMax:p.max,hungerRaw:p.raw,name:mr(i),species:d,targetScale:v,mutations:Cr(i),abilities:Tr(i),xp:g,level:f,levelRaw:h,strength:y,position:Sr(i),updatedAt:n,raw:e};if(null==w.level&&null!=w.xp&&w.petId){!function(e){if(!e.petId||null==e.xp)return;const t=Date.now();let n=or.get(e.petId);n||(n=[],or.set(e.petId,n)),n.push({xp:e.xp,timestamp:t}),n.length>10&&n.shift()}(w);const e=ir(w);null!=e.currentLevel&&(w.level=e.currentLevel)}o.push(w)}),o.sort((e,t)=>e.slotIndex-t.slotIndex)}async function kr(){if(!sr&&!lr){lr=!0;try{const e=V("myPetInfosAtom");if(!e)throw new Error("myPetInfosAtom not found in jotai cache");sr=await U(e,e=>{ar=Pr(e),function(){for(const t of cr)try{t(ar)}catch(e){s("‚ö†Ô∏è Pet info listener threw",e)}}()}),null!=dr&&(window.clearTimeout(dr),dr=null)}catch(e){s("‚ö†Ô∏è Failed to start pet info store",e),null==dr&&(dr=window.setTimeout(()=>{dr=null,sr||kr()},1500))}finally{lr=!1}}}function Ar(){return ar}function Er(){return ar}function $r(e,t=!0){if(cr.add(e),t)try{e(ar)}catch(n){s("‚ö†Ô∏è Pet info immediate callback failed",n)}return()=>{cr.delete(e)}}const Mr=/myCurrentGrowSlotIndex/i;let Ir=!1,Fr=!1,zr=null,Lr=null;const Rr=new Set;function qr(e){const t="number"==typeof(n=e)&&Number.isFinite(n)?Math.max(0,Math.trunc(n)):null;var n;if(zr!==t){zr=t;try{T.__qpmCurrentGrowSlotIndex=t,"undefined"!=typeof window&&(window.__qpmCurrentGrowSlotIndex=t)}catch{}!function(e){for(const n of Rr)try{n(e)}catch(t){s("‚ö†Ô∏è Grow slot index listener error",t)}}(zr)}}async function Nr(){try{await _()}catch(t){throw s("‚ö†Ô∏è Grow slot index tracker: jotai store unavailable",t),t}const e=await async function(){let e=V("myCurrentGrowSlotIndexAtom");return e||(O(Mr)[0]??null)}();if(!e)throw new Error("myCurrentGrowSlotIndexAtom not found");try{qr(await W(e).catch(()=>null))}catch(t){s("‚ö†Ô∏è Grow slot index tracker: failed to read initial value",t)}await U(e,e=>{qr(e)})}async function Br(){if(!Ir&&!Fr){Fr=!0;try{await Nr(),Ir=!0}catch(e){return s("‚ö†Ô∏è Grow slot index tracker initialization failed",e),void(null==Lr&&"undefined"!=typeof window&&(Lr=window.setTimeout(()=>{Lr=null,Fr=!1,Br()},2500)))}finally{Fr=!1}}}const Dr="qpm-turtle-manual-overrides";let Hr={};function jr(){try{g.set(Dr,Hr)}catch(e){s("‚ö†Ô∏è Failed to save manual pet overrides",e)}}function _r(e){return e.petId?`pet:${e.petId}`:e.species?`${e.species}:${e.slotIndex}`:`slot:${e.slotIndex}`}const Or=[{kind:"plant",patterns:["plantgrowthboost"],minutesPerBase:5,procOdds:.27},{kind:"egg",patterns:["egggrowthboost"],minutesPerBase:9,procOdds:.24}],Gr={restore:["hungerrestore"],slow:["hungerboost"]},Vr=[0,30,35,40,45],Wr=[0,.12,.14,.16,.18],Ur=[0,12,16,20,24];function Xr(e,t,n){const o=function(e,t){const n=e.match(/\b(IV|III|II|I)\b/i);if(n)switch(n[1].toUpperCase()){case"I":return 1;case"II":return 2;case"III":return 3;case"IV":return 4}const o=e.match(/\b(\d+)\b/);if(o){const e=Number.parseInt(o[1],10);if(Number.isFinite(e)&&e>0)return e}return t.endsWith("iv")?4:t.endsWith("iii")?3:t.endsWith("ii")?2:1}(t,n);if("restore"===e){return{effectPct:Vr[Math.min(o,Vr.length-1)]??Vr[1],procOdds:Wr[Math.min(o,Wr.length-1)]??Wr[1]}}if("slow"===e){return{effectPct:Ur[Math.min(o,Ur.length-1)]??Ur[1],procOdds:null}}return null}function Qr(e,t){if(!t||t<=0||e<=0)return 0;const n=Math.min(.95,Math.max(0,t*(e/100)));return 60*(1-Math.pow(1-n,1/60))}function Jr(e){if(!e)return!1;const t=e.toLowerCase();return!t.includes("eggplant")&&t.includes("egg")}function Kr(e){if(!e)return!1;const t=e.toLowerCase();return t.includes("plant")||t.includes("crop")}function Yr(e){return!!Jr(e.objectType)||(!!Jr(e.slotType)||(!!Jr(e.slotCategory)||(!!Jr(e.slotKind)||(!!Jr(e.tileObjectType)||(!!Jr(e.tileCategory)||(!!Jr(e.seedSpecies)||(!!Jr(e.plantSpecies)||(!!Jr(e.eggId)||(!!Jr(e.eggSpecies)||function(e){if(!e)return!1;const t=e.toLowerCase();return!t.includes("eggplant")&&/\begg\b/.test(t)}(e.species))))))))))}const Zr="::";let ei={enabled:!0,includeBoardwalk:!0,minActiveHungerPct:2,fallbackTargetScale:1.5,focus:"latest",maxTargetScale:2.5,focusTargetTileId:null,focusTargetSlotIndex:null,eggFocus:"latest",eggFocusTargetTileId:null,eggFocusTargetSlotIndex:null},ti=!1,ni=ln(),oi=Er();const ri=new Set;function ii(e){return e.toLowerCase().replace(/[^a-z0-9]/g,"")}function ai(e="no-data"){return{status:e,trackedSlots:0,growingSlots:0,maturedSlots:0,contributions:[],expectedMinutesRemoved:null,effectiveRate:null,naturalMsRemaining:null,adjustedMsRemaining:null,minutesSaved:null,focusSlot:null}}function si(){return{enabled:ei.enabled,now:Date.now(),includeBoardwalk:ei.includeBoardwalk,focus:ei.focus,focusTargetKey:null,focusTargetAvailable:!1,eggFocus:ei.eggFocus,eggFocusTargetKey:null,eggFocusTargetAvailable:!1,minActiveHungerPct:ei.minActiveHungerPct,fallbackTargetScale:ei.fallbackTargetScale,availableTurtles:0,hungerFilteredCount:0,turtlesMissingStats:0,plant:ai(),plantTargets:[],egg:ai(),eggTargets:[],support:{restoreCount:0,restoreActiveCount:0,slowCount:0,slowActiveCount:0,restorePctTotal:0,restorePctActive:0,restorePctPerHourTotal:0,restorePctPerHourActive:0,restoreTriggersPerHourTotal:0,restoreTriggersPerHourActive:0,slowPctTotal:0,slowPctActive:0,entries:[]}}}function li(e,t){return e&&null!=t?`${e}${Zr}${t}`:null}let ci=si();function di(e){if("number"==typeof e&&Number.isFinite(e))return e;if("string"==typeof e){const t=Number(e);if(Number.isFinite(t))return t}return null}function pi(e,t){const n=[];if(!e)return n;const o=(e,t)=>{for(const n of t){const t=e[n];if("string"==typeof t&&t.trim().length>0)return t}return null},r=(e,t)=>{if("number"==typeof e&&Number.isFinite(e))return e;if("string"==typeof e){const t=Number(e);if(Number.isFinite(t))return t}return t},i=(e,t,n,i,a)=>{const s=r(n.slotIndex,r(a.slotIndex,i)),l=di(n.endTime??n.maturedAt??n.readyAt??n.harvestReadyAt??n.finishAt??a.endTime??a.maturedAt??a.readyAt??a.harvestReadyAt??a.finishAt),c=di(n.readyAt??n.maturedAt??n.harvestReadyAt??n.endTime??a.readyAt??a.maturedAt??a.harvestReadyAt??a.endTime),d=di(n.plantedAt??n.startTime??n.startedAt??a.plantedAt??a.startTime??a.startedAt),p=o(a,["objectType","object_type"]),u=o(a,["slotCategory","category","slot_category"]),g=o(n,["objectType","object_type"])??p,m=o(n,["type","slotType","slot_type"]),f=o(n,["category","slotCategory","slot_category"]),h=o(n,["kind"]),b={tileId:e,slotIndex:s,species:o(n,["species","seedSpecies","plantSpecies","petSpecies"])??o(a,["species","seedSpecies","plantSpecies","petSpecies"]),seedSpecies:o(n,["seedSpecies"])??o(a,["seedSpecies"]),plantSpecies:o(n,["plantSpecies"])??o(a,["plantSpecies"]),eggId:o(n,["eggId","eggID"])??o(a,["eggId","eggID"]),eggSpecies:o(n,["eggSpecies","eggType"])??o(a,["eggSpecies","eggType"]),boardwalk:t,endTime:l,readyAt:c,plantedAt:d,slotType:m,slotCategory:f,objectType:g,tileObjectType:p,tileCategory:u,slotKind:h};return(e=>!!(Kr(e.objectType)||Kr(e.tileObjectType)||Kr(e.slotType)||Kr(e.slotCategory)||Kr(e.tileCategory)||Jr(e.objectType)||Jr(e.slotType)||Jr(e.slotCategory)||Jr(e.slotKind)||Jr(e.tileObjectType)||Jr(e.tileCategory)||Jr(e.species)||Jr(e.seedSpecies)||Jr(e.plantSpecies)||Jr(e.eggId)||Jr(e.eggSpecies)||e.species||e.seedSpecies||e.plantSpecies||null!=e.endTime||null!=e.readyAt||null!=e.plantedAt))(b)?b:null},a=(e,t)=>{if(!e||"object"!=typeof e)return;const o=Object.entries(e);for(const[r,a]of o){if(!a||"object"!=typeof a)continue;const e=a,o=Array.isArray(e.slots)?e.slots:[];let s=!1;if(o.forEach((o,a)=>{if(!o||"object"!=typeof o)return;const l=i(r,t,o,a,e);l&&(n.push(l),s=!0)}),!s){const o=i(r,t,e,0,e);o&&n.push(o)}}};return a(e.tileObjects??null,!1),t&&a(e.boardwalkTileObjects??null,!0),n}function ui(e){const t=function(e){const t=_r(e);return Hr[t]??null}(e);let n="number"==typeof e.xp&&Number.isFinite(e.xp)?e.xp:null;null==n&&null!=t?.xp&&(n=t.xp);let o=e.targetScale;null==o&&null!=t?.targetScale&&(o=t.targetScale);const r="number"==typeof(i=o)&&Number.isFinite(i)?i<1?1:i>ei.maxTargetScale?ei.maxTargetScale:i:ei.fallbackTargetScale;var i;let a="number"==typeof e.strength&&Number.isFinite(e.strength)?e.strength:null;null==a&&null!=t?.strength&&(a=t.strength);const s=null==e.xp||null==e.targetScale,l=t&&(null!=t.xp||null!=t.targetScale||null!=t.strength);let c;if(null!=a)c=Math.max(0,a);else{const e=Math.min(Math.floor((n??0)/36e4*30),30),t=Math.floor((r-1)/(ei.maxTargetScale-1)*20+80)-30;c=Math.max(0,e+t)}return{xp:n,targetScale:r,baseScore:c,missingStats:s&&!l}}function gi(e,t,n){const o=ui(e),{xp:r,targetScale:i,baseScore:a,missingStats:s}=o,l=a>0?a/100*t.minutesPerBase*60*(1-Math.pow(1-t.procOdds*a/100,1/60)):0,c=60*l;return{ability:t.kind,abilityNames:n,slotIndex:e.slotIndex,name:e.name,species:e.species,hungerPct:e.hungerPct,xp:r,targetScale:i,baseScore:a,rateContribution:l,perHourReduction:c,missingStats:s}}function mi(e,t,n,o,r,i,a,s){const l=t.filter(e=>null!=e.endTime).length,c=t.filter(e=>null!=e.endTime&&e.endTime>o).length,d=t.filter(e=>null!=e.endTime&&e.endTime<=o).length,p={status:"no-data",trackedSlots:l,growingSlots:c,maturedSlots:d,contributions:n.slice().sort((e,t)=>t.rateContribution-e.rateContribution),expectedMinutesRemoved:null,effectiveRate:null,naturalMsRemaining:null,adjustedMsRemaining:null,minutesSaved:null,focusSlot:null};if(0===t.length||0===l)return p;if(0===c)return{...p,status:"egg"===e?"no-eggs":"no-crops"};const u=function(e,t,n,o,r){const i=e.filter(e=>null!=e.endTime&&e.endTime>r);if(!i.length)return null;if("specific"===t){if(n&&null!=o){const e=i.find(e=>e.tileId===n&&e.slotIndex===o);if(e)return e}return null}return"earliest"===t?i.reduce((e,t)=>e?(t.endTime??1/0)<(e.endTime??1/0)?t:e:t,i[0]):i.reduce((e,t)=>e?(t.endTime??-1/0)>(e.endTime??-1/0)?t:e:t,i[0])}(t,i,a,s,o);if(!u||null==u.endTime)return{...p,status:"no-data"};const g=Math.max(0,u.endTime-o),m=g/6e4,f=n.reduce((e,t)=>e+t.rateContribution,0),h=Number.isFinite(f)&&f>0,b=h?f:0,y=h?Math.max(.01,1+b):1,x=m/Math.max(.01,y),v=6e4*x,w=h?Math.max(0,m-x):null;return{status:h?"estimating":"no-turtles",trackedSlots:l,growingSlots:c,maturedSlots:d,contributions:p.contributions,expectedMinutesRemoved:h?b:null,effectiveRate:h?y:null,naturalMsRemaining:g,adjustedMsRemaining:h?v:g,minutesSaved:w,focusSlot:{...u,remainingMs:g}}}function fi(e){return e.petId??e.slotId??`${e.slotIndex}-${e.name??"pet"}`}function hi(e){ci=e;for(const n of ri)try{n(ci)}catch(t){s("‚ö†Ô∏è Turtle timer listener error",t)}}function bi(){const e=Date.now(),t=si();if(t.now=e,!ei.enabled)return t.enabled=!1,t.plant.status="disabled",t.egg.status="disabled",void hi(t);const n=pi(ni,ei.includeBoardwalk),o=n.filter(e=>Yr(e)),r=n.filter(e=>!Yr(e)),i=[],a=[],s=[],l=new Set,c=new Set,d=new Set;for(const I of oi){if(!I||"object"!=typeof I)continue;const e=Array.isArray(I.abilities)?I.abilities.filter(e=>"string"==typeof e&&e.trim().length>0).map(e=>({raw:e,normalized:ii(e)})):[];if(0===e.length)continue;const t=fi(I),n=I.hungerPct,o=null==n||n>ei.minActiveHungerPct;let r=!1;for(const s of Or){const n=e.filter(({normalized:e})=>s.patterns.some(t=>e.includes(t))).map(({raw:e})=>e);if(0===n.length)continue;if(r=!0,l.add(t),!o){c.add(t);continue}const p=gi(I,s,n);p.missingStats&&d.add(t),p.rateContribution<=0||("plant"===s.kind?i.push(p):a.push(p))}const p=ui(I);for(const i of Object.keys(Gr)){const t=e.filter(({normalized:e})=>Gr[i].some(t=>e.includes(t))).map(({raw:e})=>e);if(0===t.length)continue;const r=[];let a=0,l=0,c=0,d=0;for(const e of t){const t=ii(e),n=Xr(i,e,t);if(n)if("restore"===i){const o=Qr(p.baseScore,n.procOdds),i=60*o,s=i*n.effectPct;a+=n.effectPct,l+=s,c+=i,r.push({abilityName:e,normalizedName:t,perTriggerPct:n.effectPct,slowdownPct:null,triggersPerHour:i,pctPerHour:s,probabilityPerMinute:o})}else d+=n.effectPct,r.push({abilityName:e,normalizedName:t,perTriggerPct:null,slowdownPct:n.effectPct,triggersPerHour:null,pctPerHour:null,probabilityPerMinute:null})}0!==r.length&&s.push({type:i,abilityNames:t,slotIndex:I.slotIndex,name:I.name,species:I.species,hungerPct:n,active:o,xp:p.xp,targetScale:p.targetScale,baseScore:p.baseScore,missingStats:p.missingStats,abilityDetails:r,totalRestorePerTriggerPct:a,totalRestorePerHourPct:l,totalTriggersPerHour:c,totalSlowPct:d})}r||o||c.add(t)}const p=ei.focusTargetTileId,u=ei.focusTargetSlotIndex,g=mi("plant",r,i,e,0,ei.focus,p,u),m=ei.eggFocusTargetTileId,f=ei.eggFocusTargetSlotIndex,h=mi("egg",o,a,e,0,ei.eggFocus,m,f);let b=0,y=0,x=0,v=0,w=0,C=0,T=0,S=0,P=0,k=0,A=0,E=0;s.sort((e,t)=>e.type===t.type?e.active===t.active?(e.name??"").localeCompare(t.name??""):e.active?-1:1:"restore"===e.type?-1:1);for(const I of s)"restore"===I.type?(b+=1,w+=I.totalRestorePerTriggerPct,T+=I.totalRestorePerHourPct,P+=I.totalTriggersPerHour,I.active&&(y+=1,C+=I.totalRestorePerTriggerPct,S+=I.totalRestorePerHourPct,k+=I.totalTriggersPerHour)):(x+=1,A+=I.totalSlowPct,I.active&&(v+=1,E+=I.totalSlowPct));t.enabled=!0,t.includeBoardwalk=ei.includeBoardwalk,t.focus=ei.focus,t.eggFocus=ei.eggFocus;const $=r.filter(t=>null!=t.endTime&&t.endTime>e).map(t=>({key:li(t.tileId,t.slotIndex)??`${t.tileId}${Zr}${t.slotIndex}`,tileId:t.tileId,slotIndex:t.slotIndex,species:t.species??t.seedSpecies??t.plantSpecies,boardwalk:t.boardwalk,endTime:t.endTime??null,remainingMs:null!=t.endTime?Math.max(0,t.endTime-e):null}));t.plantTargets=$,t.focusTargetKey=li(p,u),t.focusTargetAvailable=null!=t.focusTargetKey&&$.some(e=>e.key===t.focusTargetKey);const M=o.filter(t=>null!=t.endTime&&t.endTime>e).map(t=>({key:li(t.tileId,t.slotIndex)??`${t.tileId}${Zr}${t.slotIndex}`,tileId:t.tileId,slotIndex:t.slotIndex,species:t.eggSpecies??t.eggId??t.species,boardwalk:t.boardwalk,endTime:t.endTime??null,remainingMs:null!=t.endTime?Math.max(0,t.endTime-e):null}));t.eggTargets=M,t.eggFocusTargetKey=li(m,f),t.eggFocusTargetAvailable=null!=t.eggFocusTargetKey&&M.some(e=>e.key===t.eggFocusTargetKey),t.minActiveHungerPct=ei.minActiveHungerPct,t.fallbackTargetScale=ei.fallbackTargetScale,t.availableTurtles=l.size,t.hungerFilteredCount=c.size,t.turtlesMissingStats=d.size,t.plant=g,t.egg=h,t.support={restoreCount:b,restoreActiveCount:y,slowCount:x,slowActiveCount:v,restorePctTotal:w,restorePctActive:C,restorePctPerHourTotal:T,restorePctPerHourActive:S,restoreTriggersPerHourTotal:P,restoreTriggersPerHourActive:k,slowPctTotal:A,slowPctActive:E,entries:s},hi(t)}function yi(e){if(e){if("boolean"==typeof e.enabled&&(ei.enabled=e.enabled),"boolean"==typeof e.includeBoardwalk&&(ei.includeBoardwalk=e.includeBoardwalk),"number"==typeof e.minActiveHungerPct&&Number.isFinite(e.minActiveHungerPct)){const t=Math.max(0,Math.min(100,Math.round(e.minActiveHungerPct)));ei.minActiveHungerPct=t}if("number"==typeof e.fallbackTargetScale&&Number.isFinite(e.fallbackTargetScale)){const t=Math.max(1,Math.min(ei.maxTargetScale,e.fallbackTargetScale));ei.fallbackTargetScale=t}"latest"!==e.focus&&"earliest"!==e.focus&&"specific"!==e.focus||(ei.focus=e.focus),"string"!=typeof e.focusTargetTileId&&null!==e.focusTargetTileId||(ei.focusTargetTileId=e.focusTargetTileId??null),"number"==typeof e.focusTargetSlotIndex&&Number.isFinite(e.focusTargetSlotIndex)?ei.focusTargetSlotIndex=Math.max(0,Math.round(e.focusTargetSlotIndex)):null===e.focusTargetSlotIndex&&(ei.focusTargetSlotIndex=null),"latest"!==e.eggFocus&&"earliest"!==e.eggFocus&&"specific"!==e.eggFocus||(ei.eggFocus=e.eggFocus),"string"!=typeof e.eggFocusTargetTileId&&null!==e.eggFocusTargetTileId||(ei.eggFocusTargetTileId=e.eggFocusTargetTileId??null),"number"==typeof e.eggFocusTargetSlotIndex&&Number.isFinite(e.eggFocusTargetSlotIndex)?ei.eggFocusTargetSlotIndex=Math.max(0,Math.round(e.eggFocusTargetSlotIndex)):null===e.eggFocusTargetSlotIndex&&(ei.eggFocusTargetSlotIndex=null)}}function xi(e){if(ti)e&&vi(e);else{ti=!0,function(){try{const e=g.get(Dr,null);e&&"object"==typeof e&&(Hr=e)}catch(e){s("‚ö†Ô∏è Failed to load manual pet overrides",e)}}(),yi(e);try{const e=e=>function(e){const t=ei.includeBoardwalk,n=e?.focusTileId??null,o=Math.max(1,Math.floor(e?.limit??10)),r=pi(ni??null,t).filter(e=>!n||e.tileId===n).map(e=>({tileId:e.tileId,slotIndex:e.slotIndex,boardwalk:e.boardwalk,species:e.species,seedSpecies:e.seedSpecies,plantSpecies:e.plantSpecies,eggId:e.eggId,eggSpecies:e.eggSpecies,slotType:e.slotType,slotCategory:e.slotCategory,objectType:e.objectType,tileObjectType:e.tileObjectType,tileCategory:e.tileCategory,slotKind:e.slotKind,endTime:e.endTime,readyAt:e.readyAt,plantedAt:e.plantedAt,isEgg:Yr(e)})),i=r.filter(e=>e.isEgg);if(console.log("[TurtleTimer] Egg detection snapshot",{totalSlots:r.length,eggSlots:i.length,includeBoardwalk:t,focusTileId:n}),"function"==typeof console.table?console.table(r):r.forEach(e=>console.log(e)),e?.includeRaw&&i.length>0){const e=ni??null,t=(t,n)=>{if(!e||"object"!=typeof e)return null;const o=n?e.boardwalkTileObjects:e.tileObjects;if(!o||"object"!=typeof o)return null;const r=o[t];return r&&"object"==typeof r?r:null},n=(e,t)=>{if(!e)return null;const n=e.slots;if(Array.isArray(n)){return n[t]??null}return e};i.slice(0,o).forEach((e,r)=>{const a=t(e.tileId,e.boardwalk),s=n(a,e.slotIndex);console.log(`[TurtleTimer] Raw egg ${r+1}/${Math.min(o,i.length)}`,{tileId:e.tileId,boardwalk:e.boardwalk,rawTile:a,rawSlot:s})})}}(e);T.debugEggDetection=e,"undefined"!=typeof window&&window!==T&&(window.debugEggDetection=e)}catch(t){s("‚ö†Ô∏è Unable to attach debugEggDetection helper",t)}Br().catch(e=>{s("‚ö†Ô∏è Failed to start grow slot index tracker",e)}),kr(),dn(e=>{ni=e,bi()}),$r(e=>{oi=e,bi()}),bi(),s("üê¢ Turtle timer ready")}}function vi(e){yi(e),bi()}function wi(e){vi({enabled:e})}function Ci(){bi()}function Ti(){return ci}function Si(e,t=!0){if(ri.add(e),t)try{e(ci)}catch(n){s("‚ö†Ô∏è Turtle timer immediate listener error",n)}return()=>{ri.delete(e)}}const Pi=[],ki=new Set;let Ai=0;function Ei(){const e=Pi.slice();for(const n of ki)try{n(e)}catch(t){console.error("[notifications] subscriber error",t)}}function $i(e){const t={...e,id:`notif-${Date.now()}-${++Ai}`,timestamp:Date.now()};return Pi.push(t),Pi.length>100&&Pi.splice(0,Pi.length-100),Ei(),t}function Mi(e){ki.add(e);try{e(Pi.slice())}catch(t){console.error("[notifications] initial subscriber error",t)}return()=>{ki.delete(e)}}const Ii=new WeakMap;function Fi(e){if(!e)return"";const t=Ii.get(e);if(t)return t;try{const t=e.toDataURL("image/png");return Ii.set(e,t),t}catch(n){return console.error("[Canvas Helpers] Failed to convert canvas to data URL",n),""}}let zi=null,Li=null;const Ri=new Promise(e=>{Li=e}),qi=[];let Ni=!1;function Bi(e){if(Ni){try{e()}catch(t){console.error("[Sprite Compat] onSpritesReady callback error:",t)}return()=>{}}return qi.push(e),()=>{const t=qi.indexOf(e);-1!==t&&qi.splice(t,1)}}const Di=["plant","tallplant","crop","item","decor","seed","pet"],Hi=new Map;function ji(e,t,n=[]){return`${e}:${t}:${n.length>0?n.join(","):""}`}function _i(e,t){if(!t)return"";if(Hi.has(e))return Hi.get(e);if(Hi.size>=500){const e=Hi.keys().next().value;void 0!==e&&Hi.delete(e)}return Hi.set(e,t),t}function Oi(e){zi=e,Li?.(zi),function(){Ni=!0;for(const t of qi)try{t()}catch(e){console.error("[Sprite Compat] onSpritesReady callback error:",e)}qi.length=0}()}function Gi(e){const t=String(e).trim(),n=t.toLowerCase();if("dawnbinder"===n||"dawncelestial"===n||"dawnbiner"===n)return"DawnCelestial";if("moonbinder"===n||"mooncelestial"===n||"moobinder"===n)return"MoonCelestial";if("uncommon egg"===n||"uncommon eggs"===n||"uncommonegg"===n)return"UncommonEgg";if("rare egg"===n||"rare eggs"===n||"rareegg"===n)return"RareEgg";if("legendary egg"===n||"legendary eggs"===n||"legendaryegg"===n)return"LegendaryEgg";if("mythical egg"===n||"mythical eggs"===n||"mythicalegg"===n)return"MythicalEgg";if("orange tulip"===n||"orangetulip"===n)return"OrangeTulip";if("red tulip"===n||"redtulip"===n)return"RedTulip";if("yellow tulip"===n||"yellowtulip"===n)return"YellowTulip";if("pink tulip"===n||"pinktulip"===n)return"PinkTulip";if("purple tulip"===n||"purpletulip"===n)return"PurpleTulip";if("cacaobean"===n||"cacaobeans"===n||"cacaofruit"===n||"cacao"===n||"cacao bean"===n||"cocoa bean"===n||"cocoabean"===n||"cacao plant"===n||"cacao fruit"===n)return"Cacao";if("starweaver"===n)return"Starweaver";if(t.includes(" ")){return t.split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join("").replace(/'/g,"")}return t.charAt(0)===t.charAt(0).toUpperCase()?t:t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()}function Vi(e=[]){return(e??[]).map(e=>String(e??"").trim()).filter(Boolean).map(e=>{const t=e.toLowerCase();return"rainbow"===t?"Rainbow":"gold"===t||"golden"===t?"Gold":e.charAt(0).toUpperCase()+e.slice(1)})}function Wi(e,t){const n=[t];"DawnCelestial"!==t&&"MoonCelestial"!==t||("plant"===e&&n.push(t+"Crop"),"tallplant"===e&&n.push(t+"Plant"));const o=t.match(/^(Orange|Red|Yellow|Pink|Purple|White)(.+)$/);return o&&o[2]&&n.push(o[2]),n}function Ui(e,t,n=[]){if(!zi)return console.warn("[Sprite Compat] Service not initialized yet"),null;try{return zi.renderToCanvas({category:e,id:t,mutations:n})}catch(o){return console.error(`[Sprite Compat] render failed for ${e}:${t}`,o),null}}function Xi(e,t,n=[],o=!1){const r=o?Wi(e[0]??"",t):[t];for(const i of e){const e=o?Wi(i,t):r;for(const t of e){const e=Ui(i,t,n);if(e)return e}}return null}function Qi(e){if(null==e)return null;const t=Gi(e);return Xi(Di,t,[],!0)}function Ji(e,t=[]){if(null==e)return null;const n=Gi(e),o=Vi(t);return Xi(Di,n,o,!0)}function Ki(e){const t=ji("crop",null==e?"":String(e));return Hi.has(t)?Hi.get(t):_i(t,Fi(Qi(e)))}function Yi(e){if(!e)return null;return Ui("pet",Gi(e),[])}function Zi(e,t=[]){if(!e)return null;return Ui("pet",Gi(e),Vi(t))}function ea(e){const t=ji("pet",e);return Hi.has(t)?Hi.get(t):_i(t,Fi(Yi(e)))}const ta={getTile:(e,t)=>{if(!zi)return null;try{return zi.renderToCanvas({category:"any",id:`${e}/${t}`,mutations:[]})}catch(n){return null}},getCropSprite:e=>Qi(e),getCropSpriteByTileId:function(e){return null==e?null:Xi(["plant","tallplant"],Gi(e),[],!0)},getSeedSprite:e=>{if(!zi)return null;try{return zi.renderToCanvas({category:"seed",id:e,mutations:[]})}catch(t){return null}},getPetSprite:Yi,renderPlantWithMutations:function(e,t){if("string"==typeof e){return Ui("plant",Gi(e),Vi(t))}return console.warn("[Sprite Compat] renderPlantWithMutations called with canvas - cannot apply mutations without species ID"),e},loadSheetFromUrl:async(e,t,n)=>(console.log("[Sprite Compat] loadSheetFromUrl is deprecated - sprites auto-loaded from manifest"),!0),init:()=>{console.log("[Sprite Compat] init() is deprecated - sprite system initializes automatically")}};async function na(){if(!zi)return void console.error("[Sprite Compat] Service not initialized");const e=zi.list("pet");console.log("üêæ Pet sprites loaded:",e.length),console.table(e.slice(0,20).map(e=>({key:e.key,isAnim:e.isAnim,frames:e.count})))}const oa=["pet","plant","crop","item"];let ra=!1,ia=!1,aa={total:0,done:0,completed:!1};const sa=new Set;function la(e){Object.assign(aa,e);for(const t of sa)try{t(aa)}catch{}}async function ca(){if(ra||ia)return;if(!zi&&(await Ri,!zi))return void s("‚ö†Ô∏è Sprite warmup: service not available");ra=!0,s("üî• Starting sprite cache warmup...");const e=[],t=new Set;for(const i of oa)try{const n=zi.list(i);for(const o of n){const n=o.key;if(!n||t.has(n))continue;t.add(n);const r=n.split("/").filter(Boolean),a=r[r.length-1]||n;e.push({category:i,id:a})}}catch{}const n=e.length;let o=0;la({total:n,done:0,completed:!1}),s(`üî• Warming ${n} sprites in batches of 3...`);const r=async t=>{const n=e.slice(t,t+3);await Promise.all(n.map(async({category:e,id:t})=>{try{await function(e,t=50){return new Promise((n,o)=>{const r=()=>{Promise.resolve().then(e).then(n).catch(o)};"function"==typeof window.requestIdleCallback?window.requestIdleCallback(r,{timeout:t}):"function"==typeof requestAnimationFrame?requestAnimationFrame(r):setTimeout(r,0)})}(()=>{"pet"===e?Yi(t):Qi(t)}),o++,la({done:o})}catch{o++,la({done:o})}}));const i=t+3;i<e.length&&(await c(8),await r(i))};e.length>0&&await r(0),ia=!0,la({completed:!0}),s(`‚úÖ Sprite warmup complete: ${o} sprites cached`)}const da={carrot:{name:"Carrot",seedPrice:10,baseSellPrice:20,cropGrowTime:4,regrow:"No",baseWeight:.1,maxWeight:.3},strawberry:{name:"Strawberry",seedPrice:50,baseSellPrice:14,cropGrowTime:10,regrow:"5 Slots",matureTime:70,baseWeight:.05,maxWeight:.1},aloe:{name:"Aloe",seedPrice:135,baseSellPrice:310,cropGrowTime:45,regrow:"No",baseWeight:1.5,maxWeight:3.75},delphinium:{name:"Delphinium",seedPrice:0,baseSellPrice:530,cropGrowTime:25,regrow:"No",baseWeight:.02,maxWeight:.06,exclusive:"Carnival Stand"},blueberry:{name:"Blueberry",seedPrice:400,baseSellPrice:23,cropGrowTime:22,regrow:"5 Slots",matureTime:105,baseWeight:.01,maxWeight:.02},apple:{name:"Apple",seedPrice:500,baseSellPrice:73,cropGrowTime:5400,regrow:"7 Slots",matureTime:21600,baseWeight:.18,maxWeight:.36},tulip:{name:"Tulip",seedPrice:600,baseSellPrice:767,cropGrowTime:8,regrow:"No",baseWeight:.01,maxWeight:.03},tomato:{name:"Tomato",seedPrice:800,baseSellPrice:27,cropGrowTime:40,regrow:"2 Slots",matureTime:1100,baseWeight:.3,maxWeight:.6},daffodil:{name:"Daffodil",seedPrice:1e3,baseSellPrice:1090,cropGrowTime:50,regrow:"No",baseWeight:.01,maxWeight:.03},corn:{name:"Corn",seedPrice:1300,baseSellPrice:36,cropGrowTime:30,regrow:"1 Slot",matureTime:130,baseWeight:1.2,maxWeight:2.4},watermelon:{name:"Watermelon",seedPrice:2500,baseSellPrice:2708,cropGrowTime:720,regrow:"No",baseWeight:4.5,maxWeight:13.5},pumpkin:{name:"Pumpkin",seedPrice:3e3,baseSellPrice:3700,cropGrowTime:2100,regrow:"No",baseWeight:6,maxWeight:18},echeveria:{name:"Echeveria",seedPrice:4200,baseSellPrice:5520,cropGrowTime:120,regrow:"No",baseWeight:.8,maxWeight:2.2},coconut:{name:"Coconut",seedPrice:6e3,baseSellPrice:302,cropGrowTime:3600,regrow:"7 Slots",matureTime:43200,baseWeight:5,maxWeight:15},banana:{name:"Banana",seedPrice:7500,baseSellPrice:1750,cropGrowTime:4500,regrow:"5 Slots",matureTime:14400,baseWeight:.12,maxWeight:.204,exclusive:"Discord Server with even ID"},lily:{name:"Lily",seedPrice:2e4,baseSellPrice:20123,cropGrowTime:240,regrow:"No",baseWeight:.02,maxWeight:.055},camellia:{name:"Camellia",seedPrice:55e3,baseSellPrice:4875,cropGrowTime:10800,regrow:"8 Slots",matureTime:86400,baseWeight:.3,maxWeight:.75},squash:{name:"Squash",seedPrice:0,baseSellPrice:3500,cropGrowTime:200,regrow:"3 Slots",matureTime:1500,baseWeight:.3,maxWeight:.75,exclusive:"Carnival Stand"},burrostail:{name:"Burro's Tail",seedPrice:93e3,baseSellPrice:6e3,cropGrowTime:100,regrow:"2 Slots",matureTime:1800,baseWeight:.4,maxWeight:1},mushroom:{name:"Mushroom",seedPrice:15e4,baseSellPrice:16e4,cropGrowTime:86400,regrow:"No",baseWeight:25,maxWeight:87.5},cactus:{name:"Cactus",seedPrice:25e4,baseSellPrice:261e3,cropGrowTime:9e3,regrow:"No",baseWeight:1500,maxWeight:2700},bamboo:{name:"Bamboo",seedPrice:4e5,baseSellPrice:5e5,cropGrowTime:43200,regrow:"No",baseWeight:1,maxWeight:2},chrysanthemum:{name:"Chrysanthemum",seedPrice:67e4,baseSellPrice:18e3,cropGrowTime:10800,regrow:"7 Slots",matureTime:86400,baseWeight:.01,maxWeight:.0275},grape:{name:"Grape",seedPrice:85e4,baseSellPrice:12500,cropGrowTime:900,regrow:"1 Slot",matureTime:86400,baseWeight:3,maxWeight:6,exclusive:"Discord Server ID ending in 1"},pepper:{name:"Pepper",seedPrice:1e6,baseSellPrice:7220,cropGrowTime:600,regrow:"9 Slots",matureTime:560,baseWeight:.5,maxWeight:1},lemon:{name:"Lemon",seedPrice:2e6,baseSellPrice:1e4,cropGrowTime:3600,regrow:"6 Slots",matureTime:43200,baseWeight:.5,maxWeight:1.5,exclusive:"Discord Server ID ending in 2"},passionfruit:{name:"Passion Fruit",seedPrice:275e4,baseSellPrice:24500,cropGrowTime:2700,regrow:"2 Slots",matureTime:86400,baseWeight:9.5,maxWeight:19},dragonfruit:{name:"Dragon Fruit",seedPrice:5e6,baseSellPrice:24500,cropGrowTime:900,regrow:"7 Slots",matureTime:600,baseWeight:8.4,maxWeight:17},lychee:{name:"Lychee",seedPrice:25e6,baseSellPrice:5e4,cropGrowTime:1800,regrow:"6 Slots",matureTime:86400,baseWeight:9,maxWeight:18,exclusive:"Discord Server ID ending in 2"},sunflower:{name:"Sunflower",seedPrice:1e8,baseSellPrice:75e4,cropGrowTime:18e3,regrow:"1 Slot",matureTime:86400,baseWeight:10,maxWeight:25},starweaver:{name:"Starweaver",seedPrice:1e9,baseSellPrice:1e7,cropGrowTime:86400,regrow:"1 Slot",matureTime:216e3,baseWeight:10,maxWeight:20},dawnbinder:{name:"Dawnbinder",seedPrice:1e10,baseSellPrice:11e6,cropGrowTime:86400,regrow:"1 Slot",matureTime:86400,baseWeight:6,maxWeight:15},moonbinder:{name:"Moonbinder",seedPrice:5e10,baseSellPrice:11e6,cropGrowTime:86400,regrow:"3 Slots",matureTime:86400,baseWeight:2,maxWeight:4},favabean:{name:"Fava Bean",seedPrice:0,baseSellPrice:0,cropGrowTime:0,regrow:"No",baseWeight:0,maxWeight:0,rarity:0},cacaobean:{name:"Cacao Bean",seedPrice:0,baseSellPrice:0,cropGrowTime:0,regrow:"No",baseWeight:0,maxWeight:0,exclusive:"Divine"}};function pa(e){const t=e.toLowerCase().replace(/[^a-z]/g,"");return da[t]||null}function ua(){const e=["Carrot","Strawberry","Aloe","Blueberry","Apple","Tulip","Tomato","Daffodil","Corn","Watermelon","Pumpkin","Coconut","Banana","Lily","Chrysanthemum","Echeveria","Squash","Camellia","Grape","Pepper","Lemon","Mushroom","Cactus","Bamboo","Passion Fruit","Dragon Fruit","Lychee","Sunflower","Delphinium","Starweaver","Dawnbinder","Moonbinder","Fava Bean","Cacao Bean"];return Object.values(da).map(e=>e.name).sort((t,n)=>{const o=e.indexOf(t),r=e.indexOf(n);return-1!==o&&-1!==r?o-r:-1!==o?-1:-1!==r?1:t.localeCompare(n)})}const ga=Object.freeze(Object.defineProperty({__proto__:null,CROP_BASE_STATS:da,getAllCropNames:ua,getCropStats:pa},Symbol.toStringTag,{value:"Module"})),ma=e=>(e??"").toLowerCase().replace(/[^a-z0-9]/g,""),fa={cacaobean:["cacao","cacao bean","cacao fruit","cacaofruit","cocoa","cocoabean"],favabean:["fava bean","fava bean pod","favabeanpod","fava pod","favapod"],passionfruit:["passion fruit"],dragonfruit:["dragon fruit"],burrostail:["burro's tail","burros tail"]},ha=e=>{const t=ma(e);for(const[n,o]of Object.entries(fa)){if(t===n)return n;if(o.some(e=>ma(e)===t))return n}return t};let ba=null,ya=0;async function xa(){try{const e=V("stateAtom");if(!e)return s("‚ö†Ô∏è stateAtom not found"),null;const t=await W(e);if(!t)return s("‚ö†Ô∏è State is null"),null;const n=V("playerAtom");if(!n)return s("‚ö†Ô∏è playerAtom not found"),null;const o=await W(n),r=o?.id;if(!r)return s("‚ö†Ô∏è Player ID not found"),null;const i=t?.child?.data?.userSlots||[];Array.isArray(i)?i.length:Object.keys(i||{}).length,Array.isArray(i);let a=null;if(Array.isArray(i))a=i.find(e=>String(e?.playerId)===String(r));else if(i&&"object"==typeof i)for(const s of Object.values(i))if(String(s?.playerId)===String(r)){a=s;break}if(!a)return s("‚ö†Ô∏è Player slot not found"),Array.isArray(i)?i.map(e=>e?.playerId).join(", "):Object.values(i||{}).map(e=>e?.playerId).join(", "),null;const l=a?.data?.journal||a?.journal;return l&&"object"==typeof l?(JSON.stringify(Object.keys(l)),l.produce&&JSON.stringify(Object.keys(l.produce)),l.pets&&JSON.stringify(Object.keys(l.pets)),function(e){const t={};e.produce&&"object"==typeof e.produce&&(t.produce=Object.fromEntries(Object.entries(e.produce).map(([e,t])=>[e,{variantsLogged:(()=>{const e=t;return Array.isArray(e?.variantsLogged)?e.variantsLogged:Array.isArray(e?.variants)?e.variants.map(e=>"string"==typeof e?{variant:e}:e):[]})()}])));e.pets&&"object"==typeof e.pets&&(t.pets=Object.fromEntries(Object.entries(e.pets).map(([e,t])=>[e,{variantsLogged:(()=>{const e=t;return Array.isArray(e?.variantsLogged)?e.variantsLogged:Array.isArray(e?.variants)?e.variants.map(e=>"string"==typeof e?{variant:e}:e):[]})(),abilitiesLogged:(()=>{const e=t;return Array.isArray(e?.abilitiesLogged)?e.abilitiesLogged:Array.isArray(e?.abilities)?e.abilities.map(e=>"string"==typeof e?{ability:e}:e):[]})()}])));return t}(l)):(s("‚ÑπÔ∏è No journal data found for player"),JSON.stringify(Object.keys(a||{})),JSON.stringify(Object.keys(a?.data||{})),{produce:{},pets:{}})}catch(e){return s("‚ùå Error fetching journal:",e),null}}async function va(){const e=Date.now();if(ba&&e-ya<5e3)return ba;const t=await xa();return t&&(ba=t,ya=e),t}async function wa(){const e=await va();if(!e)return null;const t={produce:[],pets:[]},n=new Map;Object.entries(e.produce??{}).forEach(([e,t])=>{n.set(ha(e),t)});const o=new Map;Object.entries(e.pets??{}).forEach(([e,t])=>{o.set(ma(e),t)});const r=function(){const e={};if(!Lo())return e;const t=["Normal"],n=Wo();for(const r of n)"string"==typeof r&&(r.toLowerCase().includes("maxweight")||t.push(r));t.push("Max Weight");const o=Oo();for(const r of o)e[r]=t.slice();return e}();for(const[a,s]of Object.entries(r)){const e=n.get(ha(a)),o=new Map;if(e?.variantsLogged)for(const t of e.variantsLogged)o.set(ma(t.variant),t.createdAt||0);Array.isArray(s)&&t.produce.push({species:a,variants:s.map(e=>({variant:String(e),collected:o.has(ma(String(e))),collectedAt:o.get(ma(String(e)))}))})}const i=function(){const e={};if(!Lo())return e;const t=["Normal"],n=Wo();for(const r of n)"Rainbow"!==r&&"Gold"!==r||t.push(r);t.push("Max Weight");const o=Ho();for(const r of o)e[r]=t.slice();return e}();for(const[a,s]of Object.entries(i)){const e=o.get(ma(a)),n=new Map;if(e?.variantsLogged)for(const t of e.variantsLogged)n.set(ma(t.variant),t.createdAt||0);Array.isArray(s)&&t.pets.push({species:a,variants:s.map(e=>({variant:String(e),collected:n.has(ma(String(e))),collectedAt:n.get(ma(String(e)))}))})}return t}async function Ca(){const e=await wa();if(!e)return null;let t=0,n=0,o=0,r=0,i=0;const a=e.produce.length;for(const c of e.produce){let e=!1;for(const o of c.variants)n++,o.collected&&(t++,e=!0);e&&i++}for(const c of e.pets)for(const e of c.variants)r++,e.collected&&o++;const s=t+o,l=n+r;return{produce:{collected:t,total:n,percentage:n>0?t/n*100:0,typesCollected:i,typesTotal:a},petVariants:{collected:o,total:r,percentage:r>0?o/r*100:0},overall:{collected:s,total:l,percentage:l>0?s/l*100:0}}}const Ta=Object.freeze(Object.defineProperty({__proto__:null,getJournal:va,getJournalStats:Ca,getJournalSummary:wa,refreshJournalCache:function(){ba=null,ya=0}},Symbol.toStringTag,{value:"Module"})),Sa=[{matches:["Normal"],label:"N",color:"#FFFFFF",bold:!0},{matches:["Rainbow"],label:"R",gradient:"linear-gradient(120deg, #ff8a80, #ffd180, #80d8ff, #b388ff)",bold:!0},{matches:["Gold","Golden"],label:"G",color:"#FFB300",bold:!0},{matches:["Wet"],label:"W",color:"#4DBEFA"},{matches:["Chilled"],label:"C",color:"#96F6FF"},{matches:["Frozen"],label:"F",color:"#00BCD4"},{matches:["Dawnlit"],label:"D",color:"#a463ff"},{matches:["Dawncharged","Dawnbound"],label:"D",color:"#7e00fc",bold:!0},{matches:["Amberlit","Ambershine"],label:"A",color:"#FFA726"},{matches:["Ambercharged","Amberbound"],label:"A",color:"#FFA726",bold:!0},{matches:["Max Weight","Max"],label:"S",color:"#BDBDBD",bold:!0}],Pa={normal:"#111111",rainbow:"#111111",gold:"#ffffff",golden:"#ffffff",wet:"#04233A",chilled:"#05323D",frozen:"#ffffff",dawnlit:"#ffffff",dawncharged:"#ffffff",dawnbound:"#ffffff",amberlit:"#ffffff",ambershine:"#ffffff",ambercharged:"#ffffff",amberbound:"#ffffff",max:"#ffffff","max weight":"#ffffff"};function ka(e){return e.trim().toLowerCase()}function Aa(e,t){const n=function(e){const t=ka(e);return Sa.find(e=>e.matches.some(e=>ka(e)===t))}(e);if(!n)return{bg:t?"#4CAF50":"#333",text:t?"#fff":"#777",weight:t?600:400};const o=ka(e),r=Pa[o]||"#111111";return t?{bg:n.gradient||n.color||"#4CAF50",text:n.gradient?"#111111":r,weight:600}:{bg:"#333",text:"#777",weight:400}}const Ea={enabled:!0,showForGrowing:!0,showForMature:!0,showJournalIndicators:!0};let $a={...Ea},Ma=null,Ia=null,Fa=null,za=null;const La=e=>(e??"").toLowerCase().replace(/[^a-z0-9]/g,""),Ra={cacaobean:["cacao","cacao bean","cacao fruit","cocoabean","cocoa bean"],dragonfruit:["dragon fruit"],favabean:["fava bean","fava-bean","fava","fava bean pod","fava pod"],burrostail:["burro's tail","burros tail","burro tail"],passionfruit:["passion fruit","passion-fruit","passionfruit"],dawncelestial:["dawnbinder","dawn binder"],mooncelestial:["moonbinder","moon binder"],bamboo:["bamboo shoot","bambooshoot"]},qa=e=>{const t=La(e);for(const[n,o]of Object.entries(Ra)){if(t===n)return n;if(o.some(e=>La(e)===t))return n}return t};function Na(e){$a={...$a,...e},g.set("cropSizeIndicator:config",$a),$a.enabled?ps():function(){Ma&&(Ma(),Ma=null);Ia&&(Ia.disconnect(),Ia=null),function(){cs&&(cs(),cs=null);ls=null}(),s("üìê Crop Size Indicator: Stopped")}()}function Ba(e){let t=e.species;if(!t)return null;const n=t.toLowerCase(),o={mooncelestial:"moonbinder",dawncelestial:"dawnbinder"}[n];o&&(t=o);const r=function(e){if(!Lo())return pa(e);let t=_o(e);if(!t){const n=[La(e),e.replace(/\s+/g,""),e.split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(""),e.charAt(0).toUpperCase()+e.slice(1).replace(/\s+/g,""),e.toLowerCase()];for(const e of n)if(t=_o(e),t?.crop)break}if(!t?.crop)return pa(e);const n="number"==typeof t.crop.baseSellPrice?t.crop.baseSellPrice:0,o="number"==typeof t.crop.baseWeight?t.crop.baseWeight:1,r="number"==typeof t.crop.maxScale?t.crop.maxScale:2.5,i="number"==typeof t.plant?.secondsToMature?t.plant.secondsToMature:0,a={name:t.crop.name||e,seedPrice:t.seed?.coinPrice??0,baseSellPrice:n,cropGrowTime:i,regrow:"Multiple"===t.plant?.harvestType?"Multiple":"No",baseWeight:o,maxWeight:o*r};return"number"==typeof t.seed?.creditPrice&&(a.rarity=t.seed.creditPrice),a}(t);if(!r)return null;const i=e.weight??0;let a;a=i>0&&r.baseWeight>0?i/r.baseWeight:e.scale??e.targetScale??e.plantScale??1;const s=function(e,t){if(Lo()){const n=[e,t,e.replace(/\s+/g,""),e.split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(""),e.charAt(0).toUpperCase()+e.slice(1).replace(/\s+/g,"")];for(const e of n){const t=_o(e);if(t?.crop?.maxScale&&"number"==typeof t.crop.maxScale)return t.crop.maxScale}}const n=On(t);return null!==n?n:2}(t,n);return{sizePercent:50+50*Math.max(0,Math.min(1,(a-1)/(s-1))),scale:a,weight:i,value:r.baseSellPrice*a}}const Da="data-qpm-crop-size-injected",Ha="qpm-crop-size-tooltip-style",ja="data-qpm-tooltip-row",_a="data-qpm-journal-badge",Oa="#B5BCAF",Ga="qpm-crop-size",Va="data-qpm-aries-icon",Wa="data-aries-value-row",Ua="data-aries-coin-value",Xa="data-qpm-size-value",Qa="data-qpm-badge-container",Ja="data-qpm-size-divider";function Ka(){if(document.getElementById(Ha))return;const e=document.createElement("style");e.id=Ha,e.textContent=`\n    [${ja}] {\n      display: block;\n      width: 100%;\n      pointer-events: none;\n    }\n\n    [${ja}="size"] {\n      margin-top: -2px;\n      font-size: 15px;\n      font-weight: 600;\n      letter-spacing: 0.01em;\n      line-height: 16px;\n      color: ${Oa};\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      gap: 8px;\n    }\n\n    [${_a}] {\n      font-weight: 600;\n      letter-spacing: 0.04em;\n      display: inline-block;\n      margin: 0 1px;\n      min-width: 10px;\n      text-align: center;\n    }\n  `.trim(),document.head.appendChild(e)}function Ya(e,t){if(!e)return;const n=`:scope > [${ja}="${t}"]`,o=e.querySelector(n);o?.remove()}function Za(e,t,n,o){Ka();const r=function(e){const t=e.querySelector(`[${Va}]`);if(t){const e=t.parentElement;if(e)return e.setAttribute(Wa,"true"),ts(e),e}const n=e.querySelector(`[${Wa}]`);if(n)return ts(n),n;const o=e.querySelector(`[${Ua}]`)?.parentElement;if(o)return o.setAttribute(Wa,"true"),ts(o),o;return null}(e),i=function(e,t){Ka();const n=`:scope > [${ja}="${t}"]`;let o=e.querySelector(n);return o||(o=document.createElement("span"),o.setAttribute(ja,t),o.setAttribute("data-qpm-injected","true"),e.appendChild(o)),o}(e,"size");i.classList.add(Ga),i.style.color=o,i.style.marginTop=r?"2px":"0px";let a=i.querySelector(`:scope > span[${Xa}]`);a||(a=document.createElement("span"),a.setAttribute(Xa,"true"),i.appendChild(a)),a.textContent=`${t}`,a.style.flex="0 1 auto",a.style.textAlign="left";let s=i.querySelector(`:scope > span[${Qa}]`);s||(s=document.createElement("span"),s.setAttribute(Qa,"true"),s.style.display="inline-flex",s.style.gap="4px",s.style.textAlign="right",i.appendChild(s));let l=i.querySelector(`:scope > span[${Ja}]`);if(l||(l=document.createElement("span"),l.setAttribute(Ja,"true"),l.textContent="|",l.style.opacity="0.6",l.style.margin="0 6px",l.style.flex="0 0 auto",i.appendChild(l)),i.append(a,l,s),n.length>0){const e=n.map(e=>function(e){const t=document.createElement("span");return t.setAttribute(_a,"true"),t.textContent=e.label,e.gradient?(t.style.backgroundImage=e.gradient,t.style.color="transparent",t.style.backgroundClip="text",t.style.setProperty("-webkit-background-clip","text"),t.style.setProperty("-webkit-text-fill-color","transparent")):e.color?t.style.color=e.color:t.style.color="#FFFFFF",t.style.textShadow="0 1px 2px rgba(0, 0, 0, 0.35)",t.style.setProperty("color",t.style.color||"#FFFFFF","important"),t.style.fontWeight=e.bold?"800":"600",t.title=e.matches.join(" / "),t}(e));s.replaceChildren(...e),s.style.visibility="visible",l.style.display="inline-block";const t=n.length>8;i.style.flexWrap=t?"wrap":"nowrap",i.style.rowGap=t?"2px":"0",s.style.flexWrap=t?"wrap":"nowrap",s.style.maxWidth=t?"220px":"",s.style.justifyContent=t?"center":"",s.style.alignItems="center",s.style.width=t?"100%":"auto",s.style.textAlign=t?"center":"right"}else s.replaceChildren(),s.style.visibility="hidden",l.style.display="none",i.style.justifyContent="center",i.style.flexWrap="nowrap",i.style.rowGap="0",s.style.flexWrap="nowrap",s.style.maxWidth="",s.style.justifyContent="",s.style.alignItems="",s.style.width="auto",s.style.textAlign="right";es(e,i,r)}function es(e,t,n){n&&n.parentElement===e?t.previousElementSibling!==n&&n.insertAdjacentElement("afterend",t):t.parentElement!==e&&e.appendChild(t)}function ts(e){e.style.marginTop="2px",e.style.marginBottom="0",e.style.paddingTop="0";const t=e.querySelector("span, strong");if(t){const e=t;e.style.display="inline-flex",e.style.alignItems="center",e.setAttribute(Ua,"true")}}function ns(e){Ya(e,"size"),Ya(e,"journal")}async function os(e){if(!$a.enabled||e.classList.contains("qpm-window")||e.closest(".qpm-window"))return;let t=e.querySelector("p.chakra-text.css-1jc0opy")||e.querySelector("p.chakra-text")||Array.from(e.querySelectorAll("p")).find(e=>{const t=e.textContent?.trim();return t&&t.length>0&&t.length<50})||null;if(!t)return void ns(e);const n=t.closest(".chakra-stack")??t.parentElement??e,o=t.textContent?.trim();if(!o)return void ns(n);let r=o.toLowerCase().trim();const i={"dawnbinder bulb":"dawnbinder","moonbinder bulb":"moonbinder","starweaver fruit":"starweaver","dragon fruit":"dragonfruit","burro's tail":"burrostail","burros tail":"burrostail","fava bean":"favabean",passionfruit:"passionfruit","fava bean pod":"favabean","fava pod":"favabean","passion fruit":"passionfruit","cacao bean":"cacaobean",cacao:"cacaobean","cocoa bean":"cacaobean","bamboo shoot":"bamboo","lychee fruit":"lychee",strawberry:"strawberry",grape:"grape",pepper:"pepper",blueberry:"blueberry",eggplant:"eggplant","coffee bean":"coffee",cherry:"cherry"}[r];i&&(r=i);let a=Object.keys(da).some(e=>e.toLowerCase()===r);if(!a&&Lo()){const e=[r,La(r),r.replace(/\s+/g,""),r.split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(""),r.charAt(0).toUpperCase()+r.slice(1).replace(/\s+/g,"")];for(const t of e){const e=_o(t);if(e?.crop){a=!0;break}}}if(!a)return void ns(n);const l=Fa||ln();if(!l)return;const c=(e,t=!1)=>{const n=l?.cols||l?.map?.cols||20;return{x:e%n,y:Math.floor(e/n)}},d=[],p=e=>{if(e)for(const[t,n]of Object.entries(e))if("plant"===n.objectType&&n.slots&&Array.isArray(n.slots))for(let e=0;e<n.slots.length;e++){const o=n.slots[e];if(!o||!o.species)continue;let i=o.species;const a=["Rainbow","Gold","Golden","Frozen","Amber","Wet","Chilled","Dawnlit","Dawnbound","Amberbound"];for(const e of a)if(i.startsWith(e+" ")){i=i.substring(e.length+1);break}const s={dawncelestial:"dawnbinder",mooncelestial:"moonbinder"}[i.toLowerCase()];s&&(i=s);if(La(i)===La(r)){const r=parseInt(t,10),i=c(r);d.push({slot:o,tileKey:t,slotIndex:e,coords:i,tile:n})}}};if(p(l.tileObjects),p(l.boardwalkTileObjects),0===d.length){const e=new Set,t=t=>{if(t)for(const n of Object.values(t))if("plant"===n.objectType&&n.slots)for(const t of n.slots)t?.species&&e.add(t.species)};return t(l.tileObjects),t(l.boardwalkTileObjects),s(`üìê ‚ö†Ô∏è No match for "${r}" (original: "${o}")`),void s(`üìê Available species: ${Array.from(e).sort().join(", ")}`)}const u=zr;let g=d[0];if(ls){const e=d.filter(e=>e.tileKey===String(ls.tileIndex));if(e.length>0)if(e.length>1&&null!=u){g=e.find(e=>e.slotIndex===u)||e[0]}else g=e[0]}const{slot:m,tileKey:f,slotIndex:h,tile:b}=g,y=m.scale??m.targetScale??1,x=`${r}-${f}-${h}-${y.toFixed(3)}`,v=e.getAttribute(Da);if(v===x)return;v&&ns(n);const w=m.endTime??0,C=w>0&&Date.now()>=w;if(C&&!$a.showForMature||!C&&!$a.showForGrowing)return;const T=Ba(m);if(!T)return;e.setAttribute(Da,x);const S=Math.floor(T.sizePercent),P=$a.showJournalIndicators?await async function(e){try{if(za||(za=await va()),!za||!za.produce)return[];const t=new Map;for(const[e,s]of Object.entries(za.produce))t.set(qa(e),s);let n=qa(e);const o={moonbinder:"mooncelestial",dawnbinder:"dawncelestial"}[n];o&&(n=qa(o));const r=t.get(n);if(!r)return Sa.map(e=>({...e}));const i=new Set((r.variantsLogged||[]).map(e=>{const t="string"==typeof e?e:e?.variant;return"string"==typeof t?t.toLowerCase():""}).filter(Boolean)),a=[];for(const e of Sa)e.matches.some(e=>i.has(e.toLowerCase()))||a.push({...e});return a}catch(t){return s("‚ö†Ô∏è Error checking journal for crop variants:",t),[]}}(r):[],k=function(e){if(!e)return Oa;const t=e.trim().toLowerCase();if(!t)return Oa;if("#fff"===t||"#ffffff"===t)return Oa;if(t.startsWith("rgb")){const e=t.match(/rgb[a]?\(([^)]+)\)/);if(e){const t=e[1];if(!t)return Oa;const n=t.split(",").map(e=>parseFloat(e.trim())),[o,r,i]=n;if(255===o&&255===r&&255===i)return Oa}}return e}(function(e){const t=e.querySelectorAll("span, p, div, strong");for(const n of Array.from(t)){if(!(n instanceof HTMLElement))continue;if("true"===n.getAttribute("data-qpm-injected"))continue;const e=n.textContent?.trim();if(e&&!(e.length>24)&&/\bkg\b/i.test(e))try{const e=window.getComputedStyle(n).color;if(e)return e}catch{}}return null}(e));Za(n,S,P,k),function(e){const t=Array.from(e.querySelectorAll("img"));for(const n of t){if(!n||"true"===n.dataset.qpmAriesNormalized)continue;const{width:t,height:o,pointerEvents:r,userSelect:i}=n.style;if("18px"!==t||"18px"!==o)continue;if("none"!==r||"none"!==i)continue;const a=document.createElement("span");a.className=n.className,a.setAttribute("aria-hidden",n.getAttribute("aria-hidden")??"true"),a.setAttribute(Va,"true"),a.setAttribute("style",n.getAttribute("style")??""),a.style.backgroundSize="contain",a.style.backgroundRepeat="no-repeat",a.style.backgroundPosition="center",a.style.backgroundImage=`url("${n.src}")`;const s=n.parentElement;if(n.dataset.qpmAriesNormalized="true",n.replaceWith(a),s){s.setAttribute(Wa,"true"),ts(s);const e=s.querySelector("span, strong");e&&e.setAttribute(Ua,"true")}const l=e.querySelector(`:scope > [${ja}="size"]`);l&&es(e,l,s)}}(n)}const rs=".McFlex.css-fsggty",is=new Map;function as(e){if(is.has(e))return;let t=null;const n=()=>{t=null,os(e).catch(e=>{s("‚ö†Ô∏è Error injecting crop size info:",e)})};n();const o=r(e,()=>{null===t&&(t=window.requestAnimationFrame(n))});is.set(e,{disconnect:()=>{o.disconnect(),null!==t&&(window.cancelAnimationFrame(t),t=null)}})}function ss(e){const t=is.get(e);t&&(t.disconnect(),is.delete(e))}let ls=null,cs=null;async function ds(){try{const e=V("myCurrentGardenTileAtom");if(!e)return;const t=await W(e);if(!t)return void(ls=null);const n=V("myOwnCurrentGardenObjectAtom");if(!n)return;const o=await W(n);if(!o)return void(ls=null);ls={objectType:o.objectType,species:o.species,tileIndex:t.localTileIndex,tileType:t.tileType}}catch(e){}}function ps(){Ma||(s("üìê Crop Size Indicator: Starting"),Br(),function(){if(cs)return;s("üìê Starting current tile tracking");const e=V("myCurrentGardenTileAtom");e?(U(e,()=>{ds()}).then(e=>{cs=e}).catch(e=>{s("üìê ‚ö†Ô∏è Error subscribing to tile info:",e)}),ds()):s("üìê ‚ö†Ô∏è myCurrentGardenTileAtom not found")}(),Ma=dn(e=>{Fa=e}),Fa=ln(),function(){if(Ia)return;s("üìê Crop Size Indicator: Watching for crop tooltips");const e=n(rs,as),t=o(rs,ss);Ia={disconnect:()=>{e.disconnect(),t.disconnect(),is.forEach(e=>e.disconnect()),is.clear()}}}())}function us(){!function(){const e=g.get("cropSizeIndicator:config",Ea);$a={...Ea,...e}}(),$a.enabled&&ps()}const gs={orangetulip:"Tulip",tulip:"Tulip",dawncelestial:"Dawnbinder",dawnbinder:"Dawnbinder",mooncelestial:"Moonbinder",moonbinder:"Moonbinder",starweaver:"Starweaver",mythicalegg:"Mythical",mythical:"Mythical"};function ms(e){const t=e.toLowerCase().replace(/[^a-z0-9]/g,"");return gs[t]||e}function fs(e){return Ki(e)}function hs(e){return ea(e)}const bs=new Map(["Carrot","Strawberry","Aloe","Fava Bean","Delphinium","Blueberry","Apple","Orange Tulip","Tomato","Daffodil","Corn","Watermelon","Pumpkin","Echeveria","Coconut","Banana","Lily","Camellia","Burro's Tail","Mushroom","Cactus","Bamboo","Chrysanthemum","Grape","Pepper","Lemon","Passion Fruit","Dragon Fruit","Squash","Cacao Bean","Lychee","Sunflower","Starweaver","Dawnbinder","Moonbinder"].map((e,t)=>[e.toLowerCase().replace(/[^a-z0-9]/g,""),t])),ys=new Set(["cactus","bamboo"]);function xs(e){return g.get("journal:notes",{})[e]||""}function vs(e,t){const n=g.get("journal:notes",{});n[e]=t,g.set("journal:notes",n)}function ws(){const e=document.createElement("div");e.dataset.qpmSection="journal-checker",e.style.cssText="\n    background: rgba(0, 0, 0, 0.85);\n    border-radius: 8px;\n    padding: 16px;\n    color: #fff;\n  ";const t=document.createElement("style");t.textContent="\n    @keyframes qpm-rainbow-border {\n      0% { background-position: 0% 50%, 0% 50%; }\n      50% { background-position: 0% 50%, 100% 50%; }\n      100% { background-position: 0% 50%, 200% 50%; }\n    }\n    @keyframes qpm-rainbow-progress {\n      0% { background-position: 0% 50%; }\n      50% { background-position: 100% 50%; }\n      100% { background-position: 200% 50%; }\n    }\n  ",e.appendChild(t);const n=document.createElement("div");n.style.cssText="\n    margin-bottom: 20px;\n    border-bottom: 2px solid #333;\n    padding-bottom: 12px;\n  ",n.innerHTML='\n    <div style="display: flex; align-items: center; justify-content: space-between;">\n      <div>\n        <div style="font-size: 18px; font-weight: bold; color: #fff; margin-bottom: 4px;">\n          üìî Journal Checker\n        </div>\n        <div style="font-size: 12px; color: #aaa;">\n          Track your collection progress across all categories\n        </div>\n      </div>\n    </div>\n  ',e.appendChild(n);const o=document.createElement("div");o.style.cssText="\n    display: grid;\n    grid-template-columns: repeat(2, 1fr);\n    gap: 12px;\n    margin-bottom: 24px;\n  ";const r=(e,t,n,o,r)=>{const i=document.createElement("div");i.style.cssText=`\n      background: linear-gradient(135deg, ${r});\n      border-radius: 12px;\n      padding: 18px;\n      text-align: center;\n      border: 2px solid ${o}22;\n      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n      cursor: pointer;\n      position: relative;\n      overflow: hidden;\n    `;const a=document.createElement("div");return a.style.cssText="position: relative; z-index: 1;",a.innerHTML=`\n      <div style="font-size: 32px; margin-bottom: 8px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));">${e}</div>\n      <div class="stat-value" style="color: ${o}; font-size: 26px; font-weight: bold; margin-bottom: 6px; font-family: 'Segoe UI', Arial, sans-serif; text-shadow: 0 2px 8px rgba(0,0,0,0.4);">${n}</div>\n      <div style="color: #bbb; font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px;">${t}</div>\n    `,i.appendChild(a),i.addEventListener("mouseenter",()=>{i.style.transform="translateY(-4px)",i.style.borderColor=`${o}55`,i.style.boxShadow=`0 8px 16px ${o}22`}),i.addEventListener("mouseleave",()=>{i.style.transform="translateY(0)",i.style.borderColor=`${o}22`,i.style.boxShadow="none"}),i},i=r("üåæ","Produce","...","#8BC34A","#1e2a1e, #1a1a1a"),a=r("üêæ","Pet Variants","...","#42A5F5","#1a212a, #1a1a1a"),s=r("‚ú®","Overall","...","#9C27B0","#241a2a, #1a1a1a");o.appendChild(i),o.appendChild(a),o.appendChild(s),e.appendChild(o);const l=document.createElement("div");l.style.cssText="\n    display: flex;\n    gap: 10px;\n    margin-bottom: 20px;\n    flex-wrap: wrap;\n  ";const c=[{key:"produce",label:"Produce",icon:"üåæ",color:"#8BC34A"},{key:"pets",label:"Pets",icon:"üêæ",color:"#42A5F5"},{key:"recommendations",label:"Smart Tips",icon:"üí°",color:"#9C27B0"},{key:"missing",label:"Missing",icon:"üìã",color:"#FF9800"}];let d="produce",p=!1;const u=async()=>{const e=await Promise.resolve().then(()=>Ta).then(e=>e.getJournalSummary()),t=await Promise.resolve().then(()=>Ta).then(e=>e.getJournalStats());if(!e||!t)return void(y.innerHTML='<div style="color: #999; text-align: center; padding: 40px; font-size: 14px;">‚ö†Ô∏è Unable to load journal data<br><span style="font-size: 12px; color: #666;">Try refreshing or check console for errors</span></div>');const n=(e,t)=>{const n=e.querySelector(".stat-value");n&&(n.textContent=t,n.animate([{transform:"scale(1.2)",opacity:.5},{transform:"scale(1)",opacity:1}],{duration:300,easing:"ease-out"}))};if(n(i,`${t.produce.collected}/${t.produce.total}`),n(a,`${t.petVariants.collected}/${t.petVariants.total}`),n(s,`${Math.round(t.overall.percentage)}%`),y.innerHTML="","produce"===d){const t=e.produce.slice().sort((e,t)=>{const n=e.species.toLowerCase().replace(/[^a-z0-9]/g,""),o=t.species.toLowerCase().replace(/[^a-z0-9]/g,""),r=bs.has(n)?bs.get(n):Number.MAX_SAFE_INTEGER,i=bs.has(o)?bs.get(o):Number.MAX_SAFE_INTEGER;return r!==i?r-i:e.species.localeCompare(t.species)});for(const e of t){const t=p?e.variants.filter(e=>!e.collected):e.variants;if(0===t.length)continue;const n=e.variants.filter(e=>e.collected).length,o=e.variants.length,r=n/o*100,i=100===r,a=document.createElement("div");i?(a.classList.add("qpm-rainbow-complete"),a.style.cssText="\n            border-radius: 10px;\n            padding: 16px;\n            margin-bottom: 10px;\n            border: 1px solid #333;\n            transition: all 0.2s;\n          "):a.style.cssText="\n            background: linear-gradient(135deg, #1f1f1f, #1a1a1a);\n            border-radius: 10px;\n            padding: 16px;\n            margin-bottom: 10px;\n            border: 1px solid #333;\n            transition: all 0.2s;\n          ",a.addEventListener("mouseenter",()=>{i||(a.style.borderColor="#8BC34A44"),a.style.transform="translateX(4px)"}),a.addEventListener("mouseleave",()=>{100!==r&&(a.style.borderColor="#333"),a.style.transform="translateX(0)"});const s=e.species.toLowerCase().replace(/\s+/g,""),l=ms(e.species);let c=null;if(i){c=[Fi(Ji(l,["Rainbow"])),Fi(Ji(s,["Rainbow"])),Fi(Ji(e.species,["Rainbow"]))].find(Boolean)||Fi(Qi(l))}else c=Fi(Qi(l))||Fi(Qi(s))||Fi(Qi(e.species.toLowerCase()));const d=ys.has(s.replace(/[^a-z0-9]/g,""));a.innerHTML=`\n          <div style="display: flex; gap: 12px; margin-bottom: 12px;">\n            ${c?`\n              <div style="\n                width: 64px;\n                height: ${d?"92px":"64px"};\n                background-image: url(${c});\n                background-size: ${d?"auto 96%":"contain"};\n                background-repeat: no-repeat;\n                background-position: center bottom;\n                border-radius: 8px;\n                border: 2px solid ${i?"#8BC34A":"#444"};\n                flex-shrink: 0;\n                image-rendering: pixelated;\n                ${i?"box-shadow: 0 0 20px rgba(255, 23, 68, 0.5);":""}\n              "></div>\n            `:""}\n            <div style="flex: 1;">\n              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">\n                <div style="display: flex; align-items: center; gap: 8px;">\n                  <strong style="color: #fff; font-size: 14px;">${e.species}</strong>\n                  ${i?'<span style="font-size: 16px;">‚ú®</span>':""}\n                </div>\n                <div style="display: flex; align-items: center; gap: 8px;">\n                  <span style="color: #8BC34A; font-size: 13px; font-weight: bold;">${n}/${o}</span>\n                  <span style="\n                    background: ${i?"#8BC34A":"#555"};\n                    color: ${i?"#000":"#fff"};\n                    padding: 2px 8px;\n                    border-radius: 12px;\n                    font-size: 11px;\n                    font-weight: bold;\n                  ">${Math.round(r)}%</span>\n                </div>\n              </div>\n            </div>\n          </div>\n          <div style="\n            background: #111;\n            border-radius: 8px;\n            height: 6px;\n            margin-bottom: 12px;\n            overflow: hidden;\n          ">\n            <div style="\n              background: ${i?"linear-gradient(90deg, #FF1744, #FF9100, #FFEA00, #00E676, #2979FF, #D500F9, #FF1744)":"linear-gradient(90deg, #8BC34A, #66BB6A)"};\n              ${i?"background-size: 200% 100%; animation: qpm-rainbow-progress 3s linear infinite;":""}\n              height: 100%;\n              width: ${r}%;\n              transition: width 0.5s ease;\n              box-shadow: 0 0 10px ${i?"rgba(255, 23, 68, 0.5)":"#8BC34A77"};\n            "></div>\n          </div>\n          <div style="display: flex; gap: 8px; flex-wrap: wrap;">\n            ${t.map(e=>{const t=Aa(e.variant,e.collected);return`\n                <span style="\n                  padding: 6px 12px;\n                  border-radius: 6px;\n                  font-size: 12px;\n                  background: ${t.bg};\n                  color: ${t.text};\n                  font-weight: ${t.weight};\n                  transition: all 0.2s;\n                  ${e.collected?"box-shadow: 0 2px 4px rgba(0,0,0,0.2);":""}\n                ">${e.collected?"‚úì ":""}${e.variant}</span>\n              `}).join("")}\n          </div>\n        `;const u=document.createElement("div");u.style.cssText="margin-top: 12px; padding-top: 12px; border-top: 1px solid #333;";const g=document.createElement("div");g.style.cssText="font-size: 11px; color: #aaa; margin-bottom: 6px; font-weight: 500;",g.textContent="üìù Notes",u.appendChild(g);const m=document.createElement("textarea");m.value=xs(e.species),m.placeholder="Add your notes here...",m.style.cssText="\n          width: 100%;\n          min-height: 60px;\n          padding: 8px;\n          background: rgba(0, 0, 0, 0.3);\n          border: 1px solid #444;\n          border-radius: 4px;\n          color: #fff;\n          font-size: 12px;\n          font-family: inherit;\n          resize: vertical;\n        ",m.addEventListener("blur",()=>{vs(e.species,m.value)}),u.appendChild(m),a.appendChild(u),y.appendChild(a)}}else if("pets"===d)for(const o of e.pets){const e=p?o.variants.filter(e=>!e.collected):o.variants;if(0===e.length)continue;const t=o.variants.filter(e=>e.collected).length,n=o.variants.length,r=t/n*100,i=document.createElement("div");100===r?(i.classList.add("qpm-rainbow-complete"),i.style.cssText="\n            border-radius: 10px;\n            padding: 16px;\n            margin-bottom: 10px;\n            border: 1px solid #333;\n            transition: all 0.2s;\n          "):i.style.cssText="\n            background: linear-gradient(135deg, #1f1f1f, #1a1a1a);\n            border-radius: 10px;\n            padding: 16px;\n            margin-bottom: 10px;\n            border: 1px solid #333;\n            transition: all 0.2s;\n          ",i.addEventListener("mouseenter",()=>{100!==r&&(i.style.borderColor="#42A5F544"),i.style.transform="translateX(4px)"}),i.addEventListener("mouseleave",()=>{100!==r&&(i.style.borderColor="#333"),i.style.transform="translateX(0)"});const a=100===r,s=ms(o.species);let l=null;if(a){l=Fi(Zi(s,["Rainbow"]))||Fi(Zi(o.species,["Rainbow"]))||Fi(Yi(s))||Fi(Yi(o.species.toLowerCase()))}else l=Fi(Yi(s))||Fi(Yi(o.species.toLowerCase()));let c=`\n          <div style="display: flex; gap: 12px; margin-bottom: 12px;">\n            ${l?`<div style="\n                width: 64px;\n                height: 64px;\n                background-image: url(${l});\n                background-size: contain;\n                background-repeat: no-repeat;\n                background-position: center;\n                border-radius: 8px;\n                border: 2px solid ${a?"#42A5F5":"#444"};\n                flex-shrink: 0;\n                image-rendering: pixelated;\n                ${a?"box-shadow: 0 0 20px rgba(66, 165, 245, 0.5);":""}\n              "></div>`:`<div style="\n                width: 64px;\n                height: 64px;\n                background: linear-gradient(135deg, ${a?"#42A5F5":"#333"}, ${a?"#64B5F6":"#222"});\n                border-radius: 8px;\n                border: 2px solid ${a?"#42A5F5":"#444"};\n                flex-shrink: 0;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                font-size: 32px;\n                ${a?"box-shadow: 0 0 20px #42A5F566;":""}\n              ">??</div>`}\n            <div style="flex: 1;">\n              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">\n                <div style="display: flex; align-items: center; gap: 8px;">\n                  <strong style="color: #fff; font-size: 14px;">${o.species}</strong>\n                  ${a?'<span style="font-size: 16px;">‚ú®</span>':""}\n                </div>\n                <span style="\n                  background: ${a?"#42A5F5":"#555"};\n                  color: ${a?"#000":"#fff"};\n                  padding: 2px 8px;\n                  border-radius: 12px;\n                  font-size: 11px;\n                  font-weight: bold;\n                ">${Math.round(r)}%</span>\n              </div>\n            </div>\n          </div>\n          <div style="\n            background: #111;\n            border-radius: 8px;\n            height: 6px;\n            margin-bottom: 12px;\n            overflow: hidden;\n          ">\n            <div style="\n              background: ${a?"linear-gradient(90deg, #FF1744, #FF9100, #FFEA00, #00E676, #2979FF, #D500F9, #FF1744)":"linear-gradient(90deg, #42A5F5, #64B5F6)"};\n              ${a?"background-size: 200% 100%; animation: qpm-rainbow-progress 3s linear infinite;":""}\n              height: 100%;\n              width: ${r}%;\n              transition: width 0.5s ease;\n              box-shadow: 0 0 10px ${a?"rgba(66, 165, 245, 0.5)":"#42A5F577"};\n            "></div>\n          </div>\n        `;e.length>0&&(c+=`\n            <div style="margin-bottom: 12px;">\n              <div style="color: #42A5F5; font-size: 11px; font-weight: 600; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px;">\n                Variants (${t}/${n})\n              </div>\n              <div style="display: flex; gap: 8px; flex-wrap: wrap;">\n                ${e.map(e=>{const t=Aa(e.variant,e.collected);return`\n                    <span style="\n                      padding: 6px 12px;\n                      border-radius: 6px;\n                      font-size: 12px;\n                      background: ${t.bg};\n                      color: ${t.text};\n                      font-weight: ${t.weight};\n                      ${e.collected?"box-shadow: 0 2px 4px rgba(0,0,0,0.2);":""}\n                    ">${e.collected?"‚úì ":""}${e.variant}</span>\n                  `}).join("")}\n              </div>\n            </div>\n          `),i.innerHTML=c;const d=document.createElement("div");d.style.cssText="margin-top: 12px; padding-top: 12px; border-top: 1px solid #333;";const u=document.createElement("div");u.style.cssText="font-size: 11px; color: #aaa; margin-bottom: 6px; font-weight: 500;",u.textContent="üìù Notes",d.appendChild(u);const g=document.createElement("textarea");g.value=xs(`pet:${o.species}`),g.placeholder="Add your notes here...",g.style.cssText="\n          width: 100%;\n          min-height: 60px;\n          padding: 8px;\n          background: rgba(0, 0, 0, 0.3);\n          border: 1px solid #444;\n          border-radius: 4px;\n          color: #fff;\n          font-size: 12px;\n          font-family: inherit;\n          resize: vertical;\n        ",g.addEventListener("blur",()=>{vs(`pet:${o.species}`,g.value)}),d.appendChild(g),i.appendChild(d),y.appendChild(i)}else if("recommendations"===d){const{generateJournalStrategy:e,getDifficultyEmoji:t,getPriorityEmoji:n,getDifficultyDescription:o}=await Promise.resolve().then(()=>tx),r=await e();if(!r)return void(y.innerHTML='<div style="color: #999; text-align: center; padding: 40px; font-size: 14px;">‚ö†Ô∏è Unable to generate recommendations<br><span style="font-size: 12px; color: #666;">Try refreshing or check console for errors</span></div>');if(r.recommendedFocus.length>0){const e=document.createElement("div");e.style.cssText="\n          margin-bottom: 24px;\n        ",e.innerHTML=`\n          <div style="\n            font-size: 16px;\n            font-weight: bold;\n            color: #9C27B0;\n            margin-bottom: 12px;\n            padding-bottom: 8px;\n            border-bottom: 2px solid #9C27B033;\n          ">\n            üéØ Recommended Focus (Top ${Math.min(10,r.recommendedFocus.length)})\n          </div>\n        `,r.recommendedFocus.slice(0,10).forEach(n=>{const r=document.createElement("div");r.style.cssText=`\n            background: linear-gradient(135deg, #1f1f1f, #1a1a1a);\n            border-left: 4px solid ${"high"===n.priority?"#f44336":"medium"===n.priority?"#ff9800":"#666"};\n            border-radius: 8px;\n            padding: 14px;\n            margin-bottom: 10px;\n            transition: all 0.2s;\n          `,r.addEventListener("mouseenter",()=>{r.style.transform="translateX(4px)",r.style.boxShadow="0 4px 12px rgba(0,0,0,0.3)"}),r.addEventListener("mouseleave",()=>{r.style.transform="translateX(0)",r.style.boxShadow="none"});const i="high"===n.priority?"HIGH":"medium"===n.priority?"MED":"LOW",a="high"===n.priority?"#f44336":"medium"===n.priority?"#ff9800":"#666",s=ms(n.species),l="produce"===n.type?fs(s)||fs(n.species.toLowerCase()):hs(s)||hs(n.species.toLowerCase()),c=l?`<img src="${l}" alt="${n.species}" style="width: 32px; height: 32px; image-rendering: pixelated;">`:`<span style="font-size: 18px;">${"produce"===n.type?"üåø":"üêæ"}</span>`;r.innerHTML=`\n            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">\n              <div style="display: flex; align-items: center; gap: 8px;">\n                ${c}\n                <strong style="color: #fff; font-size: 14px;">${n.species}</strong>\n              </div>\n              <div style="display: flex; gap: 6px;">\n                <span style="\n                  background: ${a}33;\n                  color: ${a};\n                  padding: 2px 8px;\n                  border-radius: 4px;\n                  font-size: 10px;\n                  font-weight: bold;\n                ">${i}</span>\n                <span style="\n                  background: #555;\n                  color: #fff;\n                  padding: 2px 8px;\n                  border-radius: 4px;\n                  font-size: 10px;\n                  font-weight: bold;\n                ">${t(n.difficulty)} ${o(n.difficulty)}</span>\n              </div>\n            </div>\n            <div style="\n              background: #111;\n              border-radius: 8px;\n              height: 4px;\n              margin-bottom: 8px;\n              overflow: hidden;\n            ">\n              <div style="\n                background: linear-gradient(90deg, #9C27B0, #BA68C8);\n                height: 100%;\n                width: ${n.completionPct}%;\n                box-shadow: 0 0 8px #9C27B077;\n              "></div>\n            </div>\n            <div style="color: #aaa; font-size: 11px; margin-bottom: 6px;">\n              <strong style="color: #9C27B0;">${n.completionPct.toFixed(0)}% complete</strong> ‚Ä¢ ${n.missingVariants.length} variant${1!==n.missingVariants.length?"s":""} remaining ‚Ä¢ Est. ${n.estimatedTime}\n            </div>\n            <div style="color: #ccc; font-size: 12px; margin-bottom: 8px; line-height: 1.4;">\n              ${n.strategy}\n            </div>\n            <div style="display: flex; gap: 6px; flex-wrap: wrap; margin-top: 8px;">\n              ${n.missingVariants.map(e=>`\n                <span style="\n                  padding: 4px 8px;\n                  border-radius: 4px;\n                  font-size: 10px;\n                  background: #333;\n                  color: #999;\n                ">${e}</span>\n              `).join("")}\n            </div>\n          `,e.appendChild(r)}),y.appendChild(e)}if(r.lowHangingFruit.length>0){const e=document.createElement("div");e.style.cssText="\n          margin-bottom: 24px;\n        ",e.innerHTML='\n          <div style="\n            font-size: 16px;\n            font-weight: bold;\n            color: #4CAF50;\n            margin-bottom: 12px;\n            padding-bottom: 8px;\n            border-bottom: 2px solid #4CAF5033;\n          ">\n            üçí Quick Wins (Easy Completions)\n          </div>\n        ',r.lowHangingFruit.slice(0,5).forEach(n=>{const r=document.createElement("div");r.style.cssText="\n            background: #1a1a1a;\n            border: 1px solid #4CAF5033;\n            border-radius: 6px;\n            padding: 10px;\n            margin-bottom: 8px;\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            transition: all 0.2s;\n          ",r.addEventListener("mouseenter",()=>{r.style.background="#1f1f1f",r.style.borderColor="#4CAF5055"}),r.addEventListener("mouseleave",()=>{r.style.background="#1a1a1a",r.style.borderColor="#4CAF5033"});const i="produce"===n.type?fs(n.species):hs(n.species);r.innerHTML=`\n            <div style="display: flex; align-items: center; gap: 10px;">\n              <img src="${i}" style="width: 32px; height: 32px; image-rendering: pixelated;" alt="${n.species}" />\n              <div>\n                <div style="font-size: 13px; font-weight: 600; color: #fff;">${n.species}</div>\n                <div style="font-size: 10px; color: #999;">${n.missingVariants.join(", ")}</div>\n              </div>\n            </div>\n            <div style="text-align: right;">\n              <div style="font-size: 11px; color: #4CAF50; font-weight: bold;">${n.estimatedTime}</div>\n              <div style="font-size: 10px; color: #666;">${t(n.difficulty)} ${o(n.difficulty)}</div>\n            </div>\n          `,e.appendChild(r)}),y.appendChild(e)}if(r.fastestPath.steps.length>0){const e=document.createElement("div");e.style.cssText="\n          margin-bottom: 24px;\n        ",e.innerHTML=`\n          <div style="\n            font-size: 16px;\n            font-weight: bold;\n            color: #FF9800;\n            margin-bottom: 12px;\n            padding-bottom: 8px;\n            border-bottom: 2px solid #FF980033;\n          ">\n            üöÄ Fastest Path to ${r.fastestPath.expectedCompletion} More Variants\n          </div>\n          <div style="\n            background: #FF980022;\n            border-left: 3px solid #FF9800;\n            border-radius: 6px;\n            padding: 12px;\n            margin-bottom: 12px;\n          ">\n            <div style="font-size: 12px; color: #FF9800; font-weight: 600; margin-bottom: 4px;">\n              ‚è±Ô∏è Estimated Time: ${r.fastestPath.estimatedTime}\n            </div>\n            <div style="font-size: 11px; color: #aaa;">\n              Complete these ${r.fastestPath.steps.length} species for maximum journal progress\n            </div>\n          </div>\n        `,r.fastestPath.steps.slice(0,8).forEach((n,r)=>{const i=document.createElement("div");i.style.cssText="\n            background: #1a1a1a;\n            border-left: 3px solid #FF9800;\n            border-radius: 4px;\n            padding: 10px;\n            margin-bottom: 6px;\n            display: flex;\n            align-items: center;\n            gap: 10px;\n          ";const a="produce"===n.type?fs(n.species):hs(n.species);i.innerHTML=`\n            <div style="\n              background: #FF9800;\n              color: #000;\n              width: 24px;\n              height: 24px;\n              border-radius: 50%;\n              display: flex;\n              const variantColors = {\n                'Normal': { bg: v.collected ? '#FFFFFF' : '#333', text: v.collected ? '#111' : '#777' },\n                'Rainbow': { bg: v.collected ? 'linear-gradient(120deg, #ff8a80, #ffd180, #80d8ff, #b388ff)' : '#333', text: v.collected ? '#111' : '#777' },\n              font-weight: bold;\n              flex-shrink: 0;\n            ">${r+1}</div>\n            <img src="${a}" style="width: 28px; height: 28px; image-rendering: pixelated; flex-shrink: 0;" alt="${n.species}" />\n                  'Dawnlit': { bg: v.collected ? '#a463ff' : '#333', text: v.collected ? '#fff' : '#777' },\n                  'Dawncharged': { bg: v.collected ? '#7e00fc' : '#333', text: v.collected ? '#fff' : '#777' },\n              <div style="font-size: 12px; font-weight: 600; color: #fff; margin-bottom: 2px;">\n                ${n.species} (${n.missingVariants.join(", ")})\n              </div>\n              <div style="font-size: 10px; color: #999;">${n.estimatedTime} ‚Ä¢ ${t(n.difficulty)} ${o(n.difficulty)}</div>\n            </div>\n          `,e.appendChild(i)}),y.appendChild(e)}if(r.longTermGoals.length>0){const e=document.createElement("div");e.style.cssText="\n          margin-bottom: 24px;\n        ",e.innerHTML='\n          <div style="\n            font-size: 16px;\n            font-weight: bold;\n            color: #f44336;\n            margin-bottom: 12px;\n            padding-bottom: 8px;\n            border-bottom: 2px solid #f4433633;\n          ">\n            üéñÔ∏è Long-Term Challenges\n          </div>\n          <div style="\n            background: #f4433622;\n            border-left: 3px solid #f44336;\n            border-radius: 6px;\n            padding: 10px;\n            margin-bottom: 12px;\n            font-size: 11px;\n            color: #f44336;\n          ">\n            ‚ö†Ô∏è These variants are very difficult or require rare conditions\n          </div>\n        ',r.longTermGoals.slice(0,5).forEach(n=>{const o=document.createElement("div");o.style.cssText="\n            background: #1a1a1a;\n            border: 1px solid #f4433633;\n            border-radius: 6px;\n            padding: 10px;\n            margin-bottom: 8px;\n          ";const r="produce"===n.type?fs(n.species):hs(n.species);o.innerHTML=`\n            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 6px;">\n              <div style="display: flex; align-items: center; gap: 8px;">\n                <img src="${r}" style="width: 32px; height: 32px; image-rendering: pixelated;" alt="${n.species}" />\n                <strong style="color: #fff; font-size: 13px;">${n.species}</strong>\n              </div>\n              <span style="font-size: 20px;">${t(n.difficulty)}</span>\n            </div>\n            <div style="font-size: 11px; color: #aaa; margin-bottom: 6px;">\n              ${n.missingVariants.join(", ")}\n            </div>\n            <div style="font-size: 10px; color: #999; line-height: 1.4;">\n              ${n.strategy}\n            </div>\n          `,e.appendChild(o)}),y.appendChild(e)}}};c.forEach(e=>{const t=d===e.key||"missing"===e.key&&p,n=document.createElement("button");n.textContent=`${e.icon} ${e.label}`,n.style.cssText=`\n      flex: 1;\n      padding: 10px 18px;\n      border-radius: 8px;\n      border: 2px solid ${t?e.color:"#333"};\n      background: ${t?`${e.color}22`:"#222"};\n      color: ${t?e.color:"#999"};\n      cursor: pointer;\n      font-size: 13px;\n      font-weight: 600;\n      transition: all 0.2s;\n      min-width: 110px;\n    `,n.addEventListener("mouseenter",()=>{t||(n.style.background="#2a2a2a",n.style.borderColor="#444",n.style.color="#ccc")}),n.addEventListener("mouseleave",()=>{t||(n.style.background="#222",n.style.borderColor="#333",n.style.color="#999")}),n.addEventListener("click",()=>{"missing"===e.key?p=!p:(d=e.key,p=!1),l.querySelectorAll("button").forEach((e,t)=>{const n=c[t];if(!n)return;const o=d===n.key||"missing"===n.key&&p;e.style.background=o?`${n.color}22`:"#222",e.style.borderColor=o?n.color:"#333",e.style.color=o?n.color:"#999"}),u()}),l.appendChild(n)}),e.appendChild(l);const g=document.createElement("div");g.style.cssText="\n    margin: -6px 0 16px;\n    padding: 12px 14px;\n    border-radius: 10px;\n    border: 1px solid #2a2a2a;\n    background: rgba(255, 255, 255, 0.03);\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    gap: 12px;\n    flex-wrap: wrap;\n  ";const m=document.createElement("div");m.innerHTML='\n    <div style="font-size: 13px; font-weight: 600; color: #fff;">Tooltip Helper</div>\n    <div style="font-size: 11px; color: #bbb;">Show journal letters inside crop tooltips</div>\n  ',g.appendChild(m);const f=document.createElement("button");f.type="button",f.style.cssText="\n    border-radius: 999px;\n    border: 2px solid #333;\n    padding: 6px 18px;\n    font-size: 12px;\n    font-weight: 700;\n    letter-spacing: 0.06em;\n    text-transform: uppercase;\n    cursor: pointer;\n    transition: all 0.2s;\n    min-width: 72px;\n  ";const h=e=>{f.textContent=e?"ON":"OFF",f.style.background=e?"linear-gradient(135deg, #5ad1ff, #35a8f7)":"rgba(0, 0, 0, 0.3)",f.style.borderColor=e?"#5ad1ff":"#333",f.style.color=e?"#00223b":"#777",f.setAttribute("aria-pressed",e?"true":"false")};let b=!1!=={...$a}.showJournalIndicators;h(b),f.addEventListener("click",()=>{b=!b,h(b),Na({showJournalIndicators:b})}),g.appendChild(f),e.appendChild(g);const y=document.createElement("div");y.style.cssText="\n    max-height: 550px;\n    overflow-y: auto;\n    padding-right: 4px;\n  ";const x=document.createElement("style");x.textContent='\n    div[data-qpm-section="journal-checker"] ::-webkit-scrollbar {\n      width: 8px;\n    }\n    div[data-qpm-section="journal-checker"] ::-webkit-scrollbar-track {\n      background: #1a1a1a;\n      border-radius: 4px;\n    }\n    div[data-qpm-section="journal-checker"] ::-webkit-scrollbar-thumb {\n      background: #444;\n      border-radius: 4px;\n    }\n    div[data-qpm-section="journal-checker"] ::-webkit-scrollbar-thumb:hover {\n      background: #555;\n    }\n\n    /* Rainbow animation for completed items */\n    @keyframes qpm-rainbow-border {\n      0% { border-color: #ff0000; box-shadow: 0 0 20px #ff000044, inset 0 0 20px #ff000011; }\n      16.67% { border-color: #ff8800; box-shadow: 0 0 20px #ff880044, inset 0 0 20px #ff880011; }\n      33.33% { border-color: #ffff00; box-shadow: 0 0 20px #ffff0044, inset 0 0 20px #ffff0011; }\n      50% { border-color: #00ff00; box-shadow: 0 0 20px #00ff0044, inset 0 0 20px #00ff0011; }\n      66.67% { border-color: #0088ff; box-shadow: 0 0 20px #0088ff44, inset 0 0 20px #0088ff11; }\n      83.33% { border-color: #8800ff; box-shadow: 0 0 20px #8800ff44, inset 0 0 20px #8800ff11; }\n      100% { border-color: #ff0000; box-shadow: 0 0 20px #ff000044, inset 0 0 20px #ff000011; }\n    }\n\n    @keyframes qpm-rainbow-gradient {\n      0% { background-position: 0% 50%; }\n      50% { background-position: 100% 50%; }\n      100% { background-position: 0% 50%; }\n    }\n\n    .qpm-rainbow-complete {\n      animation: qpm-rainbow-border 3s linear infinite, qpm-rainbow-gradient 8s ease infinite;\n      border-width: 2px !important;\n      background: linear-gradient(\n        135deg,\n        #ff0000 0%,\n        #ff8800 16.67%,\n        #ffff00 33.33%,\n        #00ff00 50%,\n        #0088ff 66.67%,\n        #8800ff 83.33%,\n        #ff0000 100%\n      );\n      background-size: 400% 400%;\n    }\n\n    .qpm-rainbow-complete strong {\n      color: #000 !important;\n      text-shadow: 0 0 2px rgba(255, 255, 255, 0.5);\n    }\n\n    .qpm-rainbow-complete span[style*="color"] {\n      color: #000 !important;\n    }\n  ',document.head.appendChild(x),e.appendChild(y);const v=document.createElement("button");return v.textContent="üîÑ Refresh Journal Data",v.style.cssText="\n    width: 100%;\n    padding: 12px;\n    margin-top: 16px;\n    border-radius: 8px;\n    border: 2px solid #333;\n    background: linear-gradient(135deg, #2a2a2a, #222);\n    color: #fff;\n    cursor: pointer;\n    font-size: 13px;\n    font-weight: 600;\n    transition: all 0.2s;\n  ",v.addEventListener("mouseenter",()=>{v.style.background="linear-gradient(135deg, #333, #2a2a2a)",v.style.borderColor="#444",v.style.transform="translateY(-2px)",v.style.boxShadow="0 4px 8px rgba(0,0,0,0.3)"}),v.addEventListener("mouseleave",()=>{v.style.background="linear-gradient(135deg, #2a2a2a, #222)",v.style.borderColor="#333",v.style.transform="translateY(0)",v.style.boxShadow="none"}),v.addEventListener("click",()=>{v.textContent="‚è≥ Loading...",v.style.opacity="0.6",Promise.resolve().then(()=>Ta).then(e=>{e.refreshJournalCache(),u().then(()=>{v.textContent="üîÑ Refresh Journal Data",v.style.opacity="1"})})}),e.appendChild(v),u(),e}const Cs="myInventoryAtom",Ts="myCropInventoryAtom";let Ss=[],Ps=new Set,ks=null,As=!1;function Es(e){if(!e||"object"!=typeof e)return null;const t=e.species??e.name??e.displayName??e.itemId??e.id,n=String(t??"").trim();return n?{id:n,itemId:e.itemId,species:e.species??e.petSpecies??null,name:e.name??e.displayName??null,displayName:e.displayName??e.name??null,itemType:e.itemType??null,quantity:e.quantity??e.count??e.amount??e.stackSize,count:e.count,amount:e.amount,stackSize:e.stackSize,abilities:e.abilities??e.pet?.abilities,strength:e.strength??e.pet?.strength,raw:e}:null}function $s(e){if(!e)return null;let t=[];if(Array.isArray(e))t=e;else if(Array.isArray(e.items))t=e.items;else if(Array.isArray(e.inventory))t=e.inventory;else if("object"==typeof e){const n=Object.values(e).find(e=>Array.isArray(e)&&e.length>0&&"object"==typeof e[0]);n&&(t=n)}const n=[];for(const r of t){const e=Es(r);e&&n.push(e)}let o=[];return Array.isArray(e?.favoritedItemIds)?o=e.favoritedItemIds.filter(e=>"string"==typeof e):Array.isArray(e?.favorites)&&(o=e.favorites.filter(e=>"string"==typeof e)),{items:n,favoritedItemIds:o}}async function Ms(){if(!ks&&!As){As=!0;try{let e=V(Cs);if(e||(s("‚ö†Ô∏è myInventoryAtom not found, trying myCropInventoryAtom"),e=V(Ts)),!e)return s("‚ö†Ô∏è Inventory atom not found"),void(As=!1);ks=await U(e,e=>{!function(e){const t=$s(e);t?(Ss=t.items,Ps=new Set(t.favoritedItemIds??[])):(Ss=[],Ps=new Set)}(e)}),s("‚úÖ Inventory store initialized")}catch(e){s("‚ùå Failed to initialize inventory store",e)}finally{As=!1}}}function Is(){return[...Ss]}function Fs(){return new Set(Ps)}async function zs(){try{let e=V(Cs);if(e||(e=V(Ts)),!e)return s("‚ö†Ô∏è Inventory atom not found"),null;return $s(await W(e))}catch(e){return s("‚ùå Failed to read inventory atom",e),null}}let Ls=null,Rs=null,qs=null,Ns=null,Bs=!1;const Ds="qpm-bulk-favorite-styles",Hs="qpm-bulk-favorite-sidebar",js='[data-tm-inventory-base-index="0"]',_s=`\n  #${Hs} {\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n    pointer-events: auto;\n    padding: 4px;\n    background: rgba(0, 0, 0, 0.6);\n    border-radius: 8px;\n    backdrop-filter: blur(4px);\n  }\n\n  #${Hs}::-webkit-scrollbar {\n    width: 4px;\n  }\n\n  #${Hs}::-webkit-scrollbar-track {\n    background: rgba(0, 0, 0, 0.2);\n    border-radius: 2px;\n  }\n\n  #${Hs}::-webkit-scrollbar-thumb {\n    background: rgba(255, 255, 255, 0.3);\n    border-radius: 2px;\n  }\n\n  .qpm-bulk-fav-btn {\n    position: relative;\n    width: 62px;\n    height: 62px;\n    background: rgba(0, 0, 0, 0.85);\n    border-radius: 6px;\n    border: none;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    transition: transform 0.15s ease, box-shadow 0.15s ease;\n    padding: 4px;\n    gap: 2px;\n  }\n\n  .qpm-bulk-fav-btn:hover {\n    transform: scale(1.08);\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);\n  }\n\n  .qpm-bulk-fav-btn:active {\n    transform: scale(0.96);\n  }\n\n  .qpm-bulk-fav-sprite {\n    width: 36px;\n    height: 36px;\n    object-fit: contain;\n    image-rendering: pixelated;\n  }\n\n  .qpm-bulk-fav-heart {\n    position: absolute;\n    top: 3px;\n    right: 3px;\n    width: 14px;\n    height: 14px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 10px;\n    line-height: 1;\n  }\n\n  .qpm-bulk-fav-heart.filled {\n    color: #ff4d4d;\n  }\n\n  .qpm-bulk-fav-heart.outline {\n    color: #ffffff;\n    opacity: 0.85;\n  }\n\n  .qpm-bulk-fav-label {\n    color: #ffffff;\n    font-size: 9px;\n    font-weight: 600;\n    text-align: center;\n    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.9);\n    max-width: 100%;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    line-height: 1.1;\n  }\n`;function Os(e){return new Promise(t=>setTimeout(t,e))}function Gs(){if(Bs)return;if(document.getElementById(Ds))return void(Bs=!0);(function(e){const t=document.createElement("style");return t.textContent=e,document.head.appendChild(t),t}(_s)).id=Ds,Bs=!0}function Vs(e){const t=e.raw,n=t?.id??e.itemId??null;return"string"==typeof n&&n.length>0?n:null}function Ws(e){if(!Lo())return!0;return Oo().includes(e)}function Us(e){try{const t=T?.MagicCircle_RoomConnection;if(t&&"function"==typeof t.sendMessage)return t.sendMessage({scopePath:["Room","Quinoa"],type:"ToggleFavoriteItem",itemId:e}),!0}catch(t){s("‚ö†Ô∏è [BulkFavorite] Failed to send favorite toggle",t)}return!1}function Xs(e){const{species:t,itemIds:n,allFavorited:o}=e,r=document.createElement("button");r.className="qpm-bulk-fav-btn",r.title=`Click to ${o?"Unfavorite":"Favorite"} all ${n.length} ${t}`,r.dataset.species=t;const i=document.createElement("img");i.className="qpm-bulk-fav-sprite",i.alt=t;const a=Ki(t);if(a&&a.startsWith("data:image"))i.src=a;else{const e=document.createElement("div");e.className="qpm-bulk-fav-sprite",e.style.cssText="display:flex;align-items:center;justify-content:center;font-size:18px;color:#fff;background:rgba(255,255,255,0.15);border-radius:4px;",e.textContent=t.charAt(0).toUpperCase(),r.appendChild(e)}const l=document.createElement("span");l.className="qpm-bulk-fav-heart "+(o?"filled":"outline"),l.innerHTML=o?'<svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>':'<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>';const c=document.createElement("span");return c.className="qpm-bulk-fav-label",c.textContent=t,a&&a.startsWith("data:image")&&r.appendChild(i),r.appendChild(l),r.appendChild(c),r.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),async function(e){const t=Is(),n=Fs(),o=[];for(const s of t){const t=s.raw,n=t?.itemType??s.itemType,r=t?.species??s.species;if("Produce"===n&&r===e){const e=Vs(s);e&&o.push(e)}}if(0===o.length)return void s(`‚ö†Ô∏è [BulkFavorite] No items found for species: ${e}`);const r=o.filter(e=>n.has(e)).length,i=o.length-r===0;let a,l;i?(a=o.filter(e=>n.has(e)),l="Unfavoriting"):(a=o.filter(e=>!n.has(e)),l="Favoriting");s(`üîÑ [BulkFavorite] ${l} ${a.length}/${o.length} ${e} items (${r} already favorited)`);let c=0;for(const s of a)Us(s)&&(c++,await Os(40));s(`‚úÖ [BulkFavorite] Toggled ${c}/${a.length} ${e} items`),setTimeout(()=>Qs(),250)}(t)}),r}function Qs(){if(!Rs||!qs)return;Rs.innerHTML="";const e=function(){const e=Is(),t=Fs(),n=new Map;for(const r of e){const e=r.raw,t=e?.itemType??r.itemType,o=e?.species??r.species,i=Vs(r);if("Produce"!==t||!o||!i)continue;Ws(o)||s(`‚ö†Ô∏è Unknown species in bulk favorite: ${o}`);const a=n.get(o);a?a.push(i):n.set(o,[i])}const o=[];for(const[r,i]of n){const e=i.length>0&&i.every(e=>t.has(e));o.push({species:r,itemIds:i,allFavorited:e})}return o.sort((e,t)=>e.species.localeCompare(t.species)),o}();if(0!==e.length){Rs.style.display="flex";for(const t of e){const e=Xs(t);Rs.appendChild(e)}s(`üéØ [BulkFavorite] Rendered ${e.length} produce types`)}else Rs.style.display="none"}function Js(){const e=document.querySelector(js);if(!e)return null;let t=e;for(let n=0;n<5;n++){const e=t.parentElement;if(!e)break;if(e.classList.contains("McFlex")&&e.querySelectorAll("[data-tm-inventory-base-index]").length>1)return e;t=e}return t}function Ks(){const e=document.querySelector(js)?.closest('[role="dialog"]');if(!e)return!0;const t=e.textContent?.toLowerCase()||"";return!(t.includes("seeds in stock")||t.includes("buy for")||t.includes("shop")&&!t.includes("workshop"))}function Ys(e){Rs&&Zs(),Gs(),qs=e,Rs=function(e){const t=document.createElement("div");t.id=Hs;const n=e.getBoundingClientRect(),o=n.right,r=n.top,i=n.bottom,a=o+8,s=r,l=Math.min(i-r,window.innerHeight-s-20);return t.style.cssText=`\n    position: fixed;\n    top: ${s}px;\n    left: ${a}px;\n    max-height: ${Math.max(l,200)}px;\n    overflow-y: auto;\n    z-index: 2147483646;\n    pointer-events: auto;\n  `,t}(e),document.body.appendChild(Rs),Qs(),s("üéí [BulkFavorite] Sidebar shown")}function Zs(){Rs&&(Rs.remove(),Rs=null),qs=null,s("üóëÔ∏è [BulkFavorite] Sidebar hidden")}function el(){const e=null!==document.querySelector(js);if(e&&!Rs){if(!Ks())return;const e=Js();e&&Ys(e)}else if(!e&&Rs)Zs();else if(e&&Rs){const e=Js();e&&e!==qs&&(Zs(),Ys(e))}}function tl(){Ns&&clearTimeout(Ns),Ns=setTimeout(el,100)}const nl="quinoa:stats:v1";let ol,rl=!1,il=null,al=Date.now();const sl=new Set;function ll(e){return{feed:{totalFeeds:0,manualFeeds:0,perPet:{},lastFeedAt:null,sessionStart:e},weather:{totalSwaps:0,swapsByState:{weather:0,noweather:0},presetUsage:{weather:{primary:0,alternate:0},noweather:{primary:0,alternate:0}},cooldownBlocks:0,timeByKind:{},activeKind:"unknown",lastSwapAt:null,lastSnapshotAt:e},shop:{totalPurchases:0,totalSpentCoins:0,totalSpentCredits:0,purchasesByCategory:{seeds:0,eggs:0,tools:0,decor:0},items:{},history:[],lastPurchase:null,totalFailures:0,failuresByCategory:{seeds:0,eggs:0,tools:0,decor:0}},garden:{totalPlanted:0,totalHarvested:0,totalDestroyed:0,totalWateringCans:0,lastPlantedAt:null,lastHarvestedAt:null,lastDestroyedAt:null,lastWateredAt:null},pets:{totalHatched:0,hatchedByRarity:{normal:0,gold:0,rainbow:0},lastHatchedAt:null,lastHatchedRarity:null},abilities:{totalProcs:0,totalEstimatedValue:0,procsByAbility:{},valueByAbility:{},lastProcAt:null,lastProcAbility:null},meta:{initializedAt:e,updatedAt:e,version:1}}}function cl(){rl||ml()}function dl(){const e={feed:{totalFeeds:ol.feed.totalFeeds,manualFeeds:ol.feed.manualFeeds,perPet:Object.fromEntries(Object.entries(ol.feed.perPet).map(([e,t])=>[e,{...t}])),lastFeedAt:ol.feed.lastFeedAt,sessionStart:ol.feed.sessionStart},weather:{totalSwaps:ol.weather.totalSwaps,swapsByState:{...ol.weather.swapsByState},presetUsage:{weather:{...ol.weather.presetUsage.weather},noweather:{...ol.weather.presetUsage.noweather}},cooldownBlocks:ol.weather.cooldownBlocks,timeByKind:{...ol.weather.timeByKind},activeKind:ol.weather.activeKind,lastSwapAt:ol.weather.lastSwapAt},shop:{totalPurchases:ol.shop.totalPurchases,totalSpentCoins:ol.shop.totalSpentCoins,totalSpentCredits:ol.shop.totalSpentCredits,purchasesByCategory:{...ol.shop.purchasesByCategory},items:Object.fromEntries(Object.entries(ol.shop.items).map(([e,t])=>[e,{...t}])),history:ol.shop.history.map(e=>({...e})),lastPurchase:ol.shop.lastPurchase?{...ol.shop.lastPurchase}:null,totalFailures:ol.shop.totalFailures,failuresByCategory:{...ol.shop.failuresByCategory}},garden:{totalPlanted:ol.garden.totalPlanted,totalHarvested:ol.garden.totalHarvested,totalDestroyed:ol.garden.totalDestroyed,totalWateringCans:ol.garden.totalWateringCans,lastPlantedAt:ol.garden.lastPlantedAt,lastHarvestedAt:ol.garden.lastHarvestedAt,lastDestroyedAt:ol.garden.lastDestroyedAt,lastWateredAt:ol.garden.lastWateredAt},pets:{totalHatched:ol.pets.totalHatched,hatchedByRarity:{...ol.pets.hatchedByRarity},lastHatchedAt:ol.pets.lastHatchedAt,lastHatchedRarity:ol.pets.lastHatchedRarity},abilities:{totalProcs:ol.abilities.totalProcs,totalEstimatedValue:ol.abilities.totalEstimatedValue,procsByAbility:{...ol.abilities.procsByAbility},valueByAbility:{...ol.abilities.valueByAbility},lastProcAt:ol.abilities.lastProcAt,lastProcAbility:ol.abilities.lastProcAbility},meta:{...ol.meta}};for(const n of sl)try{n(e)}catch(t){console.error("[stats] subscriber error",t)}}function pl(){null!=il&&window.clearTimeout(il),il=window.setTimeout(()=>{il=null;try{g.set(nl,ol)}catch(e){console.error("[stats] save error",e)}},1200)}function ul(){ol.meta.updatedAt=Date.now(),pl(),dl()}function gl(e){const t=e,n=Math.max(0,t-al);if(n<1e3)return al=t,ol.weather.lastSnapshotAt=t,!1;const o=ol.weather.activeKind||"unknown";return ol.weather.timeByKind[o]=(ol.weather.timeByKind[o]??0)+n,al=t,ol.weather.lastSnapshotAt=t,!0}function ml(){rl||(ol=function(){const e=Date.now(),t=g.get(nl,null);if(!t||"object"!=typeof t)return ll(e);const n=ll(t.meta?.initializedAt??e);if(t.feed&&(n.feed.totalFeeds=Number(t.feed.totalFeeds??n.feed.totalFeeds),n.feed.lastFeedAt=t.feed.lastFeedAt??null,n.feed.sessionStart=t.feed.sessionStart??n.feed.sessionStart,t.feed.perPet&&"object"==typeof t.feed.perPet))for(const[o,r]of Object.entries(t.feed.perPet)){const e=r;e&&(n.feed.perPet[o]={count:Number(e.count??0),lastFeedAt:e.lastFeedAt??null})}if(t.weather){if(n.weather.totalSwaps=Number(t.weather.totalSwaps??0),n.weather.cooldownBlocks=Number(t.weather.cooldownBlocks??0),n.weather.activeKind=t.weather.activeKind??n.weather.activeKind,n.weather.lastSwapAt=t.weather.lastSwapAt??null,n.weather.lastSnapshotAt=t.weather.lastSnapshotAt??e,t.weather.swapsByState&&(n.weather.swapsByState.weather=Number(t.weather.swapsByState.weather??0),n.weather.swapsByState.noweather=Number(t.weather.swapsByState.noweather??0)),t.weather.presetUsage)for(const e of["weather","noweather"]){const o=t.weather.presetUsage[e];o&&(n.weather.presetUsage[e].primary=Number(o.primary??0),n.weather.presetUsage[e].alternate=Number(o.alternate??0))}if(t.weather.timeByKind&&"object"==typeof t.weather.timeByKind)for(const[e,o]of Object.entries(t.weather.timeByKind))n.weather.timeByKind[e]=Number(o??0)}if(t.shop){if(n.shop.totalPurchases=Number(t.shop.totalPurchases??0),n.shop.totalSpentCoins=Number(t.shop.totalSpentCoins??0),n.shop.totalSpentCredits=Number(t.shop.totalSpentCredits??0),t.shop.purchasesByCategory)for(const e of["seeds","eggs","tools","decor"]){const o=t.shop.purchasesByCategory[e];n.shop.purchasesByCategory[e]=Number(o??0)}if(t.shop.items&&"object"==typeof t.shop.items)for(const[o,r]of Object.entries(t.shop.items)){const t=r;t&&(n.shop.items[o]={count:Number(t.count??0),coins:Number(t.coins??0),credits:Number(t.credits??0),lastPurchasedAt:t.lastPurchasedAt??e})}Array.isArray(t.shop.history)&&(n.shop.history=t.shop.history.map(t=>({itemName:t.itemName,category:t.category??"seeds",count:Number(t.count??0),coins:Number(t.coins??0),credits:Number(t.credits??0),timestamp:t.timestamp??e,success:t.success??!0,failureReason:t.failureReason})).slice(-1e3)),"number"==typeof t.shop.totalFailures&&(n.shop.totalFailures=t.shop.totalFailures),t.shop.failuresByCategory&&"object"==typeof t.shop.failuresByCategory&&(n.shop.failuresByCategory={seeds:Number(t.shop.failuresByCategory.seeds??0),eggs:Number(t.shop.failuresByCategory.eggs??0),tools:Number(t.shop.failuresByCategory.tools??0),decor:Number(t.shop.failuresByCategory.decor??0)}),t.shop.lastPurchase&&(n.shop.lastPurchase={itemName:t.shop.lastPurchase.itemName,category:t.shop.lastPurchase.category??"seeds",count:Number(t.shop.lastPurchase.count??0),coins:Number(t.shop.lastPurchase.coins??0),credits:Number(t.shop.lastPurchase.credits??0),timestamp:t.shop.lastPurchase.timestamp??e})}if(t.garden&&(n.garden.totalPlanted=Number(t.garden.totalPlanted??0),n.garden.totalHarvested=Number(t.garden.totalHarvested??0),n.garden.totalDestroyed=Number(t.garden.totalDestroyed??0),n.garden.totalWateringCans=Number(t.garden.totalWateringCans??0),n.garden.lastPlantedAt=t.garden.lastPlantedAt??null,n.garden.lastHarvestedAt=t.garden.lastHarvestedAt??null,n.garden.lastDestroyedAt=t.garden.lastDestroyedAt??null,n.garden.lastWateredAt=t.garden.lastWateredAt??null),t.pets&&(n.pets.totalHatched=Number(t.pets.totalHatched??0),t.pets.hatchedByRarity&&(n.pets.hatchedByRarity.normal=Number(t.pets.hatchedByRarity.normal??0),n.pets.hatchedByRarity.gold=Number(t.pets.hatchedByRarity.gold??0),n.pets.hatchedByRarity.rainbow=Number(t.pets.hatchedByRarity.rainbow??0)),n.pets.lastHatchedAt=t.pets.lastHatchedAt??null,n.pets.lastHatchedRarity=t.pets.lastHatchedRarity??null),t.abilities){if(n.abilities.totalProcs=Number(t.abilities.totalProcs??0),n.abilities.totalEstimatedValue=Number(t.abilities.totalEstimatedValue??0),t.abilities.procsByAbility&&"object"==typeof t.abilities.procsByAbility)for(const[e,o]of Object.entries(t.abilities.procsByAbility))n.abilities.procsByAbility[e]=Number(o??0);if(t.abilities.valueByAbility&&"object"==typeof t.abilities.valueByAbility)for(const[e,o]of Object.entries(t.abilities.valueByAbility))n.abilities.valueByAbility[e]=Number(o??0);n.abilities.lastProcAt=t.abilities.lastProcAt??null,n.abilities.lastProcAbility=t.abilities.lastProcAbility??null}return t.meta&&(n.meta.initializedAt=t.meta.initializedAt??n.meta.initializedAt,n.meta.updatedAt=t.meta.updatedAt??n.meta.updatedAt,n.meta.version=t.meta.version??n.meta.version),n}(),rl=!0,function(){Ce();const e=Pe();ol.weather.activeKind=e.kind??"unknown",ol.weather.lastSnapshotAt=e.timestamp,al=Date.now(),Se(e=>{gl(e.timestamp),ol.weather.activeKind=e.kind??"unknown",ul()},!0),re("stats-weather-tick",()=>{gl(Date.now())&&ul()},5e3)}(),dl())}function fl(e){cl(),sl.add(e);try{e(hl())}catch(t){console.error("[stats] immediate subscriber error",t)}return()=>{sl.delete(e)}}function hl(){return cl(),{feed:{totalFeeds:ol.feed.totalFeeds,manualFeeds:ol.feed.manualFeeds,perPet:Object.fromEntries(Object.entries(ol.feed.perPet).map(([e,t])=>[e,{...t}])),lastFeedAt:ol.feed.lastFeedAt,sessionStart:ol.feed.sessionStart},weather:{totalSwaps:ol.weather.totalSwaps,swapsByState:{...ol.weather.swapsByState},presetUsage:{weather:{...ol.weather.presetUsage.weather},noweather:{...ol.weather.presetUsage.noweather}},cooldownBlocks:ol.weather.cooldownBlocks,timeByKind:{...ol.weather.timeByKind},activeKind:ol.weather.activeKind,lastSwapAt:ol.weather.lastSwapAt},shop:{totalPurchases:ol.shop.totalPurchases,totalSpentCoins:ol.shop.totalSpentCoins,totalSpentCredits:ol.shop.totalSpentCredits,purchasesByCategory:{...ol.shop.purchasesByCategory},items:Object.fromEntries(Object.entries(ol.shop.items).map(([e,t])=>[e,{...t}])),history:ol.shop.history.map(e=>({...e})),lastPurchase:ol.shop.lastPurchase?{...ol.shop.lastPurchase}:null,totalFailures:ol.shop.totalFailures,failuresByCategory:{...ol.shop.failuresByCategory}},garden:{totalPlanted:ol.garden.totalPlanted,totalHarvested:ol.garden.totalHarvested,totalDestroyed:ol.garden.totalDestroyed,totalWateringCans:ol.garden.totalWateringCans,lastPlantedAt:ol.garden.lastPlantedAt,lastHarvestedAt:ol.garden.lastHarvestedAt,lastDestroyedAt:ol.garden.lastDestroyedAt,lastWateredAt:ol.garden.lastWateredAt},pets:{totalHatched:ol.pets.totalHatched,hatchedByRarity:{...ol.pets.hatchedByRarity},lastHatchedAt:ol.pets.lastHatchedAt,lastHatchedRarity:ol.pets.lastHatchedRarity},abilities:{totalProcs:ol.abilities.totalProcs,totalEstimatedValue:ol.abilities.totalEstimatedValue,procsByAbility:{...ol.abilities.procsByAbility},valueByAbility:{...ol.abilities.valueByAbility},lastProcAt:ol.abilities.lastProcAt,lastProcAbility:ol.abilities.lastProcAbility},meta:{...ol.meta}}}function bl(){cl();const e=Date.now();ol=ll(e);const t=Pe();ol.weather.activeKind=t.kind??"unknown",ol.weather.lastSnapshotAt=t.timestamp,al=e,dl(),pl()}const yl=new Map,xl=new Map,vl=new Set;let wl=!1,Cl=null;const Tl=e=>{if(null==e)return null;if("string"==typeof e){const t=e.trim();return t.length?t:null}return"number"==typeof e&&Number.isFinite(e)?String(e):null},Sl=e=>{if(null==e)return null;if("number"==typeof e&&Number.isFinite(e))return e;if("string"==typeof e){const t=Number(e);return Number.isFinite(t)?t:null}return null},Pl=e=>e&&"object"==typeof e?e:null,kl=(e,t)=>{if(!t||"object"!=typeof t)return null;const n=t,o=Pl(n.lastAbilityTrigger);if(!o)return null;const r=Tl(o.abilityId);if(!r)return null;const i=Sl(o.performedAt);if(null==i||i<=0)return null;const a=Pl(n.slot)??Pl(n.pet?.slot),s=Pl(n.pet),l=Tl(n.petId??s?.id??n.slotId??e),c=Tl(n.slotId??a?.id??s?.slotId),d=((...e)=>{for(const t of e){const e=Sl(t);if(null!=e&&Number.isFinite(e))return Math.max(0,Math.round(e))}return null})(n.slotIndex,a?.slotIndex,a?.index,n.index,o.slotIndex),p=Pl(n.position)??Pl(o.position)??null;return{sourceKey:e,abilityId:r,performedAt:i,data:o.data??null,petId:l,slotId:c,slotIndex:d,position:p}},Al=e=>{const t=`source:${e.sourceKey}::${e.abilityId}`;let n=yl.get(t);if(n||(n={abilityId:e.abilityId,petId:e.petId,slotId:e.slotId,slotIndex:e.slotIndex,events:[],lastPerformedAt:0,lookupKeys:new Set},yl.set(t,n)),e.performedAt<=n.lastPerformedAt)return!1;n.petId=n.petId??e.petId,n.slotId=n.slotId??e.slotId,n.slotIndex=n.slotIndex??e.slotIndex;const o={abilityId:e.abilityId,performedAt:e.performedAt,data:e.data,position:e.position};n.events.push(o),n.lastPerformedAt=e.performedAt,(e=>{const t=Date.now()-216e5;(e.events.length>30||(e.events[0]?.performedAt??0)<t)&&(e.events=e.events.filter(e=>e.performedAt>=t).slice(-30))})(n);const r=(e=>{const t=[];return e.petId&&t.push(`petId:${e.petId}`),e.slotId&&t.push(`slotId:${e.slotId}`),null!=e.slotIndex&&t.push(`slotIndex:${e.slotIndex}`),t.push(`source:${e.sourceKey}`),Array.from(new Set(t)).map(t=>`${t}::${e.abilityId}`)})(e);for(const i of r)n.lookupKeys.add(i),xl.set(i,n);return!0},El=e=>{if(!e||"object"!=typeof e)return;const t=e;let n=!1;for(const[o,r]of Object.entries(t)){const e=kl(o,r);if(!e)continue;Al(e)&&(n=!0)}n&&(()=>{if(!vl.size)return;const e=new Map(xl);for(const n of vl)try{n(e)}catch(t){s("‚ö†Ô∏è Ability history listener failed",t)}})()};function $l(e,t){const n=new Set,{petId:o,slotId:r,slotIndex:i,fallbackKeys:a=[]}=t;((e,t)=>{const n=[];for(const o of t){if(!o)continue;const t=o.trim();t&&(n.push(`petId:${t}::${e}`),n.push(`slotId:${t}::${e}`),n.push(`source:${t}::${e}`))}return n})(e,[o,r,...a]).forEach(e=>n.add(e)),((e,t)=>null!=t&&Number.isFinite(t)?[`slotIndex:${Math.max(0,Math.round(t))}::${e}`]:[])(e,i).forEach(e=>n.add(e));for(const s of n){const e=xl.get(s);if(e)return e}return null}function Ml(){return new Map(xl)}const Il=[{id:"ProduceScaleBoost",name:"Crop Size Boost I",aliases:["Crop Size Boost 1"],category:"misc",trigger:"continuous",baseProbability:.3,rollPeriodMinutes:1,effectUnit:"coins",effectLabel:"Scale increase",effectBaseValue:6,effectSuffix:"%",notes:"Chance: 0.30% √ó STR. Effect: 6% size increase √ó STR, capped at max scale."},{id:"ProduceScaleBoostII",name:"Crop Size Boost II",aliases:["Crop Size Boost 2"],category:"misc",trigger:"continuous",baseProbability:.4,rollPeriodMinutes:1,effectUnit:"coins",effectLabel:"Scale increase",effectBaseValue:10,effectSuffix:"%",notes:"Chance: 0.40% √ó STR. Effect: 10% size increase √ó STR, capped at max scale."},{id:"DoubleHarvest",name:"Double Harvest",category:"misc",trigger:"harvest",baseProbability:5},{id:"ProduceEater",name:"Crop Eater",category:"coins",trigger:"continuous",baseProbability:60,rollPeriodMinutes:1,notes:"Cannot estimate coin value without live crop data."},{id:"SellBoostI",name:"Sell Boost I",aliases:["Sell Boost 1"],category:"misc",trigger:"sellAllCrops",baseProbability:10},{id:"SellBoostII",name:"Sell Boost II",aliases:["Sell Boost 2"],category:"misc",trigger:"sellAllCrops",baseProbability:12},{id:"SellBoostIII",name:"Sell Boost III",aliases:["Sell Boost 3"],category:"misc",trigger:"sellAllCrops",baseProbability:14},{id:"SellBoostIV",name:"Sell Boost IV",aliases:["Sell Boost 4"],category:"misc",trigger:"sellAllCrops",baseProbability:16},{id:"ProduceRefund",name:"Crop Refund",category:"misc",trigger:"sellAllCrops",baseProbability:20},{id:"PlantGrowthBoost",name:"Plant Growth Boost I",aliases:["Plant Growth Boost 1"],category:"plantGrowth",trigger:"continuous",baseProbability:24,rollPeriodMinutes:1,effectValuePerProc:3,effectUnit:"minutes",effectLabel:"Growth time reduction",effectBaseValue:3,effectSuffix:"m"},{id:"PlantGrowthBoostII",name:"Plant Growth Boost II",aliases:["Plant Growth Boost 2"],category:"plantGrowth",trigger:"continuous",baseProbability:27,rollPeriodMinutes:1,effectValuePerProc:5,effectUnit:"minutes",effectLabel:"Growth time reduction",effectBaseValue:5,effectSuffix:"m"},{id:"ProduceMutationBoost",name:"Crop Mutation Boost I",aliases:["Crop Mutation Boost 1"],category:"misc",trigger:"continuous",baseProbability:.1,rollPeriodMinutes:1,effectUnit:"coins",effectLabel:"Chance increase",effectBaseValue:10,effectSuffix:"%",notes:"Increases the base weather mutation chance (0.1% √ó STR) by 10% √ó STR during active weather/lunar events. Only works when weather/lunar event is active. Grants: Wet (Rain), Frozen (Snow), Dawnlit (Dawn), Amberlit (Dusk)."},{id:"ProduceMutationBoostII",name:"Crop Mutation Boost II",aliases:["Crop Mutation Boost 2"],category:"misc",trigger:"continuous",baseProbability:.1,rollPeriodMinutes:1,effectUnit:"coins",effectLabel:"Chance increase",effectBaseValue:15,effectSuffix:"%",notes:"Increases the base weather mutation chance (0.1% √ó STR) by 15% √ó STR during active weather/lunar events. Only works when weather/lunar event is active. Grants: Wet (Rain), Frozen (Snow), Dawnlit (Dawn), Amberlit (Dusk)."},{id:"PetMutationBoost",name:"Pet Mutation Boost I",aliases:["Pet Mutation Boost 1"],category:"misc",trigger:"hatchEgg"},{id:"PetMutationBoostII",name:"Pet Mutation Boost II",aliases:["Pet Mutation Boost 2"],category:"misc",trigger:"hatchEgg"},{id:"GoldGranter",name:"Gold Granter",category:"misc",trigger:"continuous",baseProbability:.72,rollPeriodMinutes:1,effectUnit:"coins",notes:"Converts a random uncolored crop to Gold using live garden snapshot."},{id:"RainbowGranter",name:"Rainbow Granter",category:"misc",trigger:"continuous",baseProbability:.72,rollPeriodMinutes:1,effectUnit:"coins",notes:"Converts a random uncolored crop to Rainbow using live garden snapshot."},{id:"RainDance",name:"Rain Dance",category:"misc",trigger:"continuous",baseProbability:10,rollPeriodMinutes:1,effectUnit:"coins",notes:"Grants Wet mutation to crops. Turkey innate ability."},{id:"EggGrowthBoost",name:"Egg Growth Boost I",aliases:["Egg Growth Boost 1"],category:"eggGrowth",trigger:"continuous",baseProbability:21,rollPeriodMinutes:1,effectValuePerProc:7,effectUnit:"minutes"},{id:"EggGrowthBoostII_NEW",name:"Egg Growth Boost II",aliases:["Egg Growth Boost 2"],category:"eggGrowth",trigger:"continuous",baseProbability:24,rollPeriodMinutes:1,effectValuePerProc:9,effectUnit:"minutes"},{id:"EggGrowthBoostII",name:"Egg Growth Boost III",aliases:["Egg Growth Boost 3"],category:"eggGrowth",trigger:"continuous",baseProbability:27,rollPeriodMinutes:1,effectValuePerProc:11,effectUnit:"minutes"},{id:"PetAgeBoost",name:"Hatch XP Boost I",aliases:["Hatch XP Boost 1"],category:"xp",trigger:"hatchEgg",baseProbability:50,effectValuePerProc:8e3,effectUnit:"xp"},{id:"PetAgeBoostII",name:"Hatch XP Boost II",aliases:["Hatch XP Boost 2"],category:"xp",trigger:"hatchEgg",baseProbability:60,effectValuePerProc:12e3,effectUnit:"xp"},{id:"PetHatchSizeBoost",name:"Max Strength Boost I",aliases:["Max Strength Boost 1"],category:"misc",trigger:"hatchEgg",baseProbability:12},{id:"PetHatchSizeBoostII",name:"Max Strength Boost II",aliases:["Max Strength Boost 2"],category:"misc",trigger:"hatchEgg",baseProbability:14},{id:"PetXpBoost",name:"XP Boost I",aliases:["Pet XP Boost I","Pet XP Boost 1","XP Boost 1"],category:"xp",trigger:"continuous",baseProbability:30,rollPeriodMinutes:1,effectValuePerProc:300,effectUnit:"xp"},{id:"PetXpBoostII",name:"XP Boost II",aliases:["Pet XP Boost II","Pet XP Boost 2","XP Boost 2"],category:"xp",trigger:"continuous",baseProbability:35,rollPeriodMinutes:1,effectValuePerProc:400,effectUnit:"xp"},{id:"HungerRestore",name:"Hunger Restore I",aliases:["Hunger Restore 1"],category:"misc",trigger:"continuous",baseProbability:12,rollPeriodMinutes:1},{id:"HungerRestoreII",name:"Hunger Restore II",aliases:["Hunger Restore 2"],category:"misc",trigger:"continuous",baseProbability:14,rollPeriodMinutes:1},{id:"HungerBoost",name:"Hunger Boost I",aliases:["Hunger Boost 1"],category:"misc",trigger:"continuous",baseProbability:0,rollPeriodMinutes:1},{id:"HungerBoostII",name:"Hunger Boost II",aliases:["Hunger Boost 2"],category:"misc",trigger:"continuous",baseProbability:0,rollPeriodMinutes:1},{id:"PetRefund",name:"Pet Refund I",aliases:["Pet Refund 1"],category:"misc",trigger:"sellPet",baseProbability:5},{id:"PetRefundII",name:"Pet Refund II",aliases:["Pet Refund 2"],category:"misc",trigger:"sellPet",baseProbability:7},{id:"Copycat",name:"Copycat",category:"misc",trigger:"continuous",baseProbability:1,rollPeriodMinutes:1},{id:"CoinFinderI",name:"Coin Finder I",aliases:["Coin Finder 1","CoinFinder I","CoinFinder 1"],category:"coins",trigger:"continuous",baseProbability:35,rollPeriodMinutes:1,effectValuePerProc:12e4,effectUnit:"coins",effectLabel:"Coin range",effectBaseValue:12e4,effectSuffix:""},{id:"CoinFinderII",name:"Coin Finder II",aliases:["Coin Finder 2","CoinFinder II","CoinFinder 2"],category:"coins",trigger:"continuous",baseProbability:13,rollPeriodMinutes:1,effectValuePerProc:12e5,effectUnit:"coins",effectLabel:"Coin range",effectBaseValue:12e5,effectSuffix:""},{id:"CoinFinderIII",name:"Coin Finder III",aliases:["Coin Finder 3","CoinFinder III","CoinFinder 3"],category:"coins",trigger:"continuous",baseProbability:6,rollPeriodMinutes:1,effectValuePerProc:1e7,effectUnit:"coins",effectLabel:"Coin range",effectBaseValue:1e7,effectSuffix:""},{id:"SeedFinderI",name:"Seed Finder I",aliases:["Seed Finder 1","SeedFinder I","SeedFinder 1"],category:"misc",trigger:"continuous",baseProbability:40,rollPeriodMinutes:1},{id:"SeedFinderII",name:"Seed Finder II",aliases:["Seed Finder 2","SeedFinder II","SeedFinder 2"],category:"misc",trigger:"continuous",baseProbability:20,rollPeriodMinutes:1},{id:"SeedFinderIII",name:"Seed Finder III",aliases:["Seed Finder 3","SeedFinder III","SeedFinder 3"],category:"misc",trigger:"continuous",baseProbability:10,rollPeriodMinutes:1},{id:"SeedFinderIV",name:"Seed Finder IV",aliases:["Seed Finder 4","SeedFinder IV","SeedFinder 4"],category:"misc",trigger:"continuous",baseProbability:.01,rollPeriodMinutes:1},{id:"RainDance",name:"Rain Dance",category:"misc",trigger:"continuous",baseProbability:10,rollPeriodMinutes:1,effectUnit:"coins",effectLabel:"Mutation chance",effectBaseValue:10,effectSuffix:"%",notes:"Chance: 10% √ó STR per minute. Grants Wet mutation to a random crop."},{id:"DoubleHatch",name:"Double Hatch",category:"misc",trigger:"hatchEgg",baseProbability:3,notes:"Chance: 3.0% √ó STR to hatch an extra pet from the same egg."}],Fl=new Map,zl=e=>e.trim().toLowerCase();for(const $C of Il)if(Fl.set(zl($C.id),$C),Fl.set(zl($C.name),$C),Array.isArray($C.aliases))for(const e of $C.aliases)Fl.set(zl(e),$C);function Ll(e){if(!e)return null;const t=zl(e),n=Fl.get(t);if(n)return n;if(Lo()){const t=Qo(e);if(t){const n="hatchEgg"===t.trigger?"eggGrowth":(t.trigger,"misc"),o={id:e,name:t.name||e,category:n,trigger:t.trigger,rollPeriodMinutes:1,notes:"Auto-discovered from game catalog"};return void 0!==t.baseProbability&&(o.baseProbability=t.baseProbability),o}}return null}function Rl(){const e=[...Il];if(Lo()){const t=function(){const e=Xo();return e?Object.keys(e):[]}(),n=new Set(Il.map(e=>zl(e.id)));for(const o of t)if(!n.has(zl(o))){const t=Qo(o);if(t){const n="hatchEgg"===t.trigger?"eggGrowth":(t.trigger,"misc"),r={id:o,name:t.name||o,category:n,trigger:t.trigger,rollPeriodMinutes:1,notes:"Auto-discovered from game catalog"};void 0!==t.baseProbability&&(r.baseProbability=t.baseProbability),e.push(r)}}}return e}const ql=.95/60;function Nl(e,t){const n=Number.isFinite(t)?t:100,o=Math.max(.25,n/100),r=Math.max(0,e.baseProbability??0)/60,i=Math.max(0,r/100),a=Math.min(ql,i*o),s=3600*a,l=100*a,c=60*l;return{multiplier:o,chancePerRoll:a,rollPeriodMinutes:e.rollPeriodMinutes??1,procsPerHour:s,chancePerSecond:l,chancePerMinute:c}}function Bl(e,t){const n=e.effectValuePerProc??0;return Number.isFinite(n)&&0!==n?t.procsPerHour*n:0}const Dl=Object.freeze(Object.defineProperty({__proto__:null,computeAbilityStats:Nl,computeEffectPerHour:Bl,getAbilityDefinition:Ll,getAllAbilityDefinitions:Rl},Symbol.toStringTag,{value:"Module"}));function Hl(){const e=ln(),t=Pe();if(!e||!t)return{weather:null,eligibleCrops:[],eligibleFruits:0,averageValueGain:0,projectedMutationsPerEvent:0,baseMutationChance:0};const n=function(e){if(!e)return null;const t=e.toLowerCase();return t.includes("rain")?"rain":t.includes("snow")?"snow":t.includes("dawn")?"dawn":t.includes("amber")?"amber":null}("string"==typeof t?t:t.type||t.name);if(!n)return{weather:null,eligibleCrops:[],eligibleFruits:0,averageValueGain:0,projectedMutationsPerEvent:0,baseMutationChance:0};const o=[];let r=0,i=0;const a=e.tileObjects||{};Object.entries(a).forEach(([e,t])=>{if(!t||"plant"!==t.objectType)return;const a=t.species||t.plantSpecies||t.seedSpecies;if(!a)return;if(!(!0===t.fullyMature||!0===t.isMature))return;const s="number"==typeof t.scale?t.scale:1,l=Array.isArray(t.mutations)?[...t.mutations]:[],c=function(e,t){const n=e.some(e=>"Wet"===e||"Frozen"===e),o=e.some(e=>"Dawnlit"===e||"Dawnbound"===e),r=e.some(e=>"Amberlit"===e||"Amberbound"===e),i=e.includes("Gold"),a=e.includes("Rainbow");if("dawn"===t&&(r||i)||"amber"===t&&(o||i)||a)return!1;if(("rain"===t||"snow"===t)&&n)return!1;if("dawn"===t&&o)return!1;if("amber"===t&&r)return!1;return!0}(l,n);if(!c)return;const d=function(e){if("number"==typeof e.fruitCount&&e.fruitCount>0)return e.fruitCount;if(Array.isArray(e.slotStates)&&e.slotStates.length>0)return e.slotStates.length;const t=e.displayName||e.name;if("string"==typeof t){const e=t.match(/\+(\d+)/);if(e&&e[1])return parseInt(e[1],10)}return 1}(t);if(d<=0)return;const p=Vn(a),u=jn(p,s,l,1.5),g=jn(p,s,[...l,jl(n)],1.5)-u;g>0&&(o.push({species:a,scale:s,mutations:l,currentValue:u,fruitCount:d,index:parseInt(e,10)}),r+=d,i+=g*d)});const s=o.length>0?i/r:0,l=function(e){switch(e){case"rain":return 22.8;case"snow":return 7.6;case"dawn":return 6.37;case"amber":return 3.19}}(n),c=o.length*(l/100);return{weather:n,eligibleCrops:o,eligibleFruits:r,averageValueGain:s,projectedMutationsPerEvent:c,baseMutationChance:l}}function jl(e){switch(e){case"rain":return"Wet";case"snow":return"Frozen";case"dawn":return"Dawnlit";case"amber":return"Amberlit"}}const _l=50,Ol=100;function Gl(e){return!!e&&"object"==typeof e&&!Array.isArray(e)}function Vl(e){const t="number"==typeof e?e:"string"==typeof e?Number.parseFloat(e):Number.NaN;if(!Number.isFinite(t))return null;const n=Math.floor(t);return n>0?n:null}function Wl(e,t){if(!t)return 1;const n=["fruitCount","remainingFruitCount","remainingFruits","totalFruitCount","totalFruits","totalFruit"];for(const i of n)if(i in e){const t=Vl(e[i]);if(null!=t)return Math.min(t,64)}const o=e.slotStates;if(Array.isArray(o)){const e=o.filter(e=>null!=e);if(e.length>0)return Math.min(e.length,64)}const r="string"==typeof e.displayName?e.displayName:"string"==typeof e.name?e.name:null;if(r){const e=r.match(/\+(\d+)/);if(e){const t=Vl(e[1]);if(null!=t)return Math.min(t,64)}}return 1}function Ul(e,t,n){const o=Number.isFinite(e)&&e>0?e:1,r=[n.maxScale,n.targetMaxScale,n.maxTargetScale,n.maximumScale,n.max],i="string"==typeof t?Vn(t):null;let a=null;for(const d of r){const e=Number(d);if(Number.isFinite(e)&&e>1){a=e;break}}if((null==a||a<=1)&&i){const e=On(i);null!=e&&Number.isFinite(e)&&e>1&&(a=e)}(null==a||!Number.isFinite(a)||a<=1)&&(a=2);const s=Math.max(1.01,a),l=Math.min(s,Math.max(1,o)),c=_l+50*(s>1?(l-1)/(s-1):0);return{maxScale:s,sizePercent:Math.min(Ol,Math.max(_l,Math.round(100*c)/100))}}function Xl(e,t){return 1+(Math.min(Ol,Math.max(_l,e))-_l)/50*(Math.max(1.01,Number.isFinite(t)&&t>1?t:2)-1)}function Ql(e=ln()){const t=function(e){if(!e)return[];const t=[{tiles:e.tileObjects,allowMultiHarvest:!0},{tiles:e.boardwalkTileObjects,allowMultiHarvest:!0}],n=[],o=Date.now();for(const{tiles:r,allowMultiHarvest:i}of t)if(r&&"object"==typeof r)for(const e of Object.values(r)){if(!Gl(e))continue;if("plant"!==e.objectType)continue;const t=e.slots;if(Array.isArray(t))for(const e of t){if(!Gl(e))continue;const t="string"==typeof e.species?e.species:null;if(!t)continue;const r=e.endTime,a="number"==typeof r?r:Number(r),s=!!Number.isFinite(a)&&a<=o,l=e.targetScale??e.scale??e.plantScale,c="number"==typeof l&&Number.isFinite(l)?Math.max(1,l):1,d=(Array.isArray(e.mutations)?e.mutations:[]).map(e=>"string"==typeof e?e:null).filter(e=>!!e),p=jn(t,c,d,1.5);if(!Number.isFinite(p)||p<=0)continue;const u=qn(d),g="Gold"===u.color?.definition?.name||"Rainbow"===u.color?.definition?.name,{maxScale:m,sizePercent:f}=Ul(c,t,e),h=Wl(e,i);n.push({species:t,scale:c,maxScale:m,sizePercent:f,mutations:d,currentValue:p,hasColorMutation:g,fruitCount:h,isMature:s})}}return n}(e),n=t.reduce((e,t)=>t.isMature?e+t.currentValue*Math.max(1,t.fruitCount):e,0),o=t.filter(e=>{const t=e.mutations.includes("Gold"),n=e.mutations.includes("Rainbow");return!t&&!n}),r=o.reduce((e,t)=>e+Math.max(1,t.fruitCount),0);return{crops:t,uncoloredCrops:o,uncoloredFruitSlots:r,totalMatureValue:n,friendBonus:1.5}}function Jl(e,t,n){const o=n*("number"==typeof t&&Number.isFinite(t)?Math.max(0,t):100)/100;if(!e.crops.length||o<=0)return null;const r=e.crops.filter(e=>e.isMature&&e.sizePercent<99.99&&Math.max(1,e.fruitCount)>0);if(!r.length)return null;let i=0,a=0,s=0;for(const l of r){const e=Math.max(1,Math.floor(l.fruitCount)),t=Math.max(0,Ol-l.sizePercent);if(t<=0)continue;const n=Math.min(o,t);if(n<=0)continue;const r=Xl(l.sizePercent+n,l.maxScale),c=l.scale>0?l.scale:1,d=Math.max(0,r-c);if(d<=0)continue;const p=c>0?l.currentValue/c:0;if(!Number.isFinite(p)||p<=0)continue;const u=p*d;!Number.isFinite(u)||u<=0||(s+=e,i+=u*e,a+=n*e)}if(i<=0||0===s)return null;return{effectPerProc:i/s,detail:`Boosts ${s} mature fruit${1===s?"":"s"} by ~${(a/s).toFixed(2)}% size (50% friend bonus assumed, weighted by fruit count).`}}function Kl(e,t){if(!e.uncoloredCrops.length)return null;let n=0,o=0;for(const r of e.uncoloredCrops){const e=Math.max(1,Math.floor(r.fruitCount)),i=[...r.mutations,t],a=jn(r.species,r.scale,i,1.5)-r.currentValue;Number.isFinite(a)&&a>0&&(o+=e,n+=a*e)}if(0===o||n<=0)return null;return{effectPerProc:n/o,detail:`Converts 1 random uncolored crop to ${t}. ${e.uncoloredFruitSlots} eligible fruit slot${1===e.uncoloredFruitSlots?"":"s"} across ${e.uncoloredCrops.length} plant${1===e.uncoloredCrops.length?"":"s"} (50% friend bonus, weighted by fruit count).`}}function Yl(e,t,n){switch(e){case"ProduceScaleBoost":return Jl(t,n,6);case"ProduceScaleBoostII":return Jl(t,n,10);case"GoldGranter":return Kl(t,"Gold");case"RainbowGranter":return Kl(t,"Rainbow");case"ProduceMutationBoost":case"ProduceMutationBoostII":return function(){const e=Hl();if(!e.weather||0===e.eligibleCrops.length)return{effectPerProc:0,detail:"No active weather/lunar event or no eligible crops. Mutations only proc during Rain, Snow, Dawn, or Amber Moon."};const t="rain"===e.weather?"Rain":"snow"===e.weather?"Snow":"dawn"===e.weather?"Dawn":"Amber",n="rain"===e.weather?"Wet":"snow"===e.weather?"Frozen":"dawn"===e.weather?"Dawnlit":"Amberlit";return{effectPerProc:e.projectedMutationsPerEvent*e.averageValueGain,detail:`${t} active (${e.baseMutationChance.toFixed(1)}% chance/crop). ${e.eligibleCrops.length} eligible plant${1===e.eligibleCrops.length?"":"s"} (${e.eligibleFruits} fruit${1===e.eligibleFruits?"":"s"}). Expected: ${e.projectedMutationsPerEvent.toFixed(2)} ${n} mutation${1===e.projectedMutationsPerEvent?"":"s"}/event, avg ${Zl(e.averageValueGain)}/mutation.`}}();default:return null}}function Zl(e){return e>=1e6?`${(e/1e6).toFixed(2)}M`:e>=1e3?`${(e/1e3).toFixed(2)}K`:e.toFixed(0)}P("__qpmAbilityDebug",{getContext:()=>Ql(),listUncolored:()=>Ql().uncoloredCrops.map(e=>({species:e.species,fruitCount:Math.max(1,e.fruitCount),sizePercent:e.sizePercent,mutations:[...e.mutations],hasColorMutation:e.hasColorMutation,isMature:e.isMature,valuePerScale:e.scale>0?e.currentValue/e.scale:e.currentValue})),listAll:()=>Ql().crops.map(e=>({species:e.species,fruitCount:Math.max(1,e.fruitCount),sizePercent:e.sizePercent,mutations:[...e.mutations],hasColorMutation:e.hasColorMutation,isMature:e.isMature,currentValue:e.currentValue,maxScale:e.maxScale}))});const ec="qpm-window-pos-",tc=new Map;let nc=1e4,oc=!1;function rc(e){const t=e.getBoundingClientRect(),n=window.innerWidth,o=window.innerHeight;let r=parseFloat(e.style.right)||n-t.right,i=parseFloat(e.style.top)||t.top;const a=Math.max(8,n-t.width-8),s=Math.max(8,o-t.height-8);r=Math.min(Math.max(r,8),a),i=Math.min(Math.max(i,8),s),e.style.right=`${r}px`,e.style.top=`${i}px`,e.style.left="auto",e.style.bottom="auto"}function ic(){tc.forEach(e=>{e.isMinimized||rc(e.el)})}function ac(e,t,n,o,r){if(tc.has(e)){const t=tc.get(e);return t.el.style.display="",t.isMinimized=!1,dc(t.el),void gc(e,!0,!1)}const i=o||"90vw",a=r||"90vh",l=document.createElement("div");l.className="qpm-window",l.id=`qpm-window-${e}`,l.style.cssText=`\n    position: fixed;\n    min-width: 260px;\n    max-width: ${i};\n    max-height: ${a};\n    background: rgba(18, 20, 26, 0.96);\n    border: 1px solid rgba(143, 130, 255, 0.5);\n    border-radius: 8px;\n    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.8), 0 0 0 1px rgba(255, 255, 255, 0.05);\n    backdrop-filter: blur(12px);\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n    font-size: 13px;\n    color: #e0e0e0;\n    z-index: ${nc++};\n    box-sizing: border-box;\n    overflow: auto;\n  `;const c=document.createElement("div");c.className="qpm-window-head",c.style.cssText="\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 12px 16px;\n    background: linear-gradient(135deg, rgba(143, 130, 255, 0.12) 0%, rgba(143, 130, 255, 0.04) 100%);\n    border-bottom: 1px solid rgba(143, 130, 255, 0.25);\n    cursor: move;\n    user-select: none;\n  ";const d=document.createElement("div");d.className="qpm-window-title",d.textContent=t,d.style.cssText="\n    font-size: 15px;\n    font-weight: 600;\n    color: #8f82ff;\n    flex: 1;\n    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);\n  ";const p=document.createElement("div");p.style.cssText="display: flex; gap: 6px;";const u=pc("‚àí","Minimize"),m=pc("√ó","Close");p.appendChild(u),p.appendChild(m),c.appendChild(d),c.appendChild(p);const f=document.createElement("div");f.className="qpm-window-body",f.style.cssText="\n    padding: 16px;\n    background: rgba(0, 0, 0, 0.25);\n    box-sizing: border-box;\n  ",function(e){const t=`qpm-window-scrollbar-${e}`;if(document.getElementById(t))return;const n=document.createElement("style");n.id=t,n.textContent=`\n    /* Scrollbar on the window itself (Aries mod pattern) */\n    #qpm-window-${e}::-webkit-scrollbar {\n      width: 8px;\n    }\n    #qpm-window-${e}::-webkit-scrollbar-track {\n      background: rgba(0, 0, 0, 0.2);\n      border-radius: 4px;\n    }\n    #qpm-window-${e}::-webkit-scrollbar-thumb {\n      background: rgba(143, 130, 255, 0.35);\n      border-radius: 4px;\n      transition: background 0.2s;\n    }\n    #qpm-window-${e}::-webkit-scrollbar-thumb:hover {\n      background: rgba(143, 130, 255, 0.55);\n    }\n\n    /* Constrain all content within window - prevent horizontal overflow */\n    #qpm-window-${e} *,\n    #qpm-window-${e} *::before,\n    #qpm-window-${e} *::after {\n      box-sizing: border-box;\n      max-width: 100%;\n      word-wrap: break-word;\n      overflow-wrap: break-word;\n    }\n\n    #qpm-window-${e} .qpm-card,\n    #qpm-window-${e} .qpm-card__body,\n    #qpm-window-${e} .qpm-card__header,\n    #qpm-window-${e} .qpm-section-muted,\n    #qpm-window-${e} input,\n    #qpm-window-${e} button,\n    #qpm-window-${e} select,\n    #qpm-window-${e} div {\n      max-width: 100%;\n      min-width: 0;\n    }\n\n    /* Prevent pre/code from breaking layout */\n    #qpm-window-${e} pre,\n    #qpm-window-${e} code {\n      white-space: pre-wrap;\n      word-break: break-all;\n    }\n  `,document.head.appendChild(n)}(e),l.appendChild(c),l.appendChild(f),document.body.appendChild(l),n(f),function(e,t){const n=g.get(ec+e);n?(t.style.right=`${n.right}px`,t.style.top=`${n.top}px`,t.style.left="auto",t.style.bottom="auto"):(t.style.left="50%",t.style.top="50%",t.style.transform="translate(-50%, -50%)",t.style.right="auto",t.style.bottom="auto",requestAnimationFrame(()=>{const n=t.getBoundingClientRect();t.style.transform="",t.style.left="auto",t.style.right=window.innerWidth-n.right+"px",t.style.top=`${n.top}px`,uc(e,t)}))}(e,l),requestAnimationFrame(()=>{rc(l)}),oc||(window.addEventListener("resize",ic),oc=!0,s("Window resize listener added")),function(e,t,n){let o=!1,r=0,i=0,a=0,s=0;const l=t=>{if(!o)return;t.preventDefault();const n=t.clientX-r,l=t.clientY-i,c=a-n,d=s+l,p=window.innerWidth-8,u=window.innerHeight-8,g=e.getBoundingClientRect(),m=Math.max(8-g.width,Math.min(p-g.width,c)),f=Math.max(8,Math.min(u-g.height,d));e.style.right=`${m}px`,e.style.top=`${f}px`,e.style.left="auto",e.style.bottom="auto"},c=()=>{o&&(o=!1,t.style.cursor="move",document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",c),uc(n,e))};t.addEventListener("mousedown",n=>{if(n.target.closest(".qpm-window-btn"))return;o=!0,t.style.cursor="grabbing",r=n.clientX,i=n.clientY;const d=e.getBoundingClientRect();a=parseFloat(e.style.right)||window.innerWidth-d.right,s=parseFloat(e.style.top)||d.top,document.addEventListener("mousemove",l),document.addEventListener("mouseup",c),dc(e)})}(l,c,e),l.addEventListener("wheel",e=>{e.stopPropagation()},{passive:!1}),u.addEventListener("click",t=>{t.stopPropagation(),function(e){const t=tc.get(e);if(!t)return;t.isMinimized=!t.isMinimized,t.isMinimized?(t.body.style.display="none",t.el.style.maxHeight="auto",t.minimizeBtn.textContent="‚ñ°",t.minimizeBtn.title="Restore"):(t.body.style.display="",t.el.style.maxHeight=t.maxHeight,t.minimizeBtn.textContent="‚àí",t.minimizeBtn.title="Minimize");gc(e,!0,t.isMinimized)}(e)}),m.addEventListener("click",t=>{t.stopPropagation(),sc(e)}),l.addEventListener("mousedown",()=>dc(l));const h={id:e,el:l,head:c,body:f,titleEl:d,minimizeBtn:u,closeBtn:m,isMinimized:!1,maxHeight:a};tc.set(e,h),gc(e,!0,!1),s(`Window ${e} opened`)}function sc(e){const t=tc.get(e);t&&(t.el.style.display="none",gc(e,!1,t.isMinimized),s(`Window ${e} closed`))}function lc(e,t,n,o,r){const i=tc.get(e);return i?cc(i.el)?(sc(e),!1):(i.el.style.display="",i.isMinimized=!1,dc(i.el),gc(e,!0,!1),!0):(ac(e,t,n,o,r),!0)}function cc(e){return"none"!==e.style.display}function dc(e){e.style.zIndex=String(nc++)}function pc(e,t){const n=document.createElement("button");return n.className="qpm-window-btn",n.textContent=e,n.title=t,n.style.cssText=`\n    width: 26px;\n    height: 26px;\n    border: none;\n    background: rgba(255, 255, 255, 0.08);\n    color: #e0e0e0;\n    font-size: ${"√ó"===e?"20px":"18px"};\n    font-weight: 300;\n    line-height: 1;\n    cursor: pointer;\n    border-radius: 4px;\n    transition: all 0.15s ease;\n    padding: 0;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  `,n.addEventListener("mouseenter",()=>{n.style.background="√ó"===e?"rgba(244, 67, 54, 0.8)":"rgba(143, 130, 255, 0.5)",n.style.color="#fff"}),n.addEventListener("mouseleave",()=>{n.style.background="rgba(255, 255, 255, 0.08)",n.style.color="#e0e0e0"}),n}function uc(e,t){const n=t.getBoundingClientRect(),o={right:parseFloat(t.style.right)||window.innerWidth-n.right,top:parseFloat(t.style.top)||n.top};g.set(ec+e,o)}function gc(e,t,n){g.set("qpm-window-state-"+e,{isOpen:t,isMinimized:n})}function mc(e){const t=tc.get(e);return!!t&&cc(t.el)}const fc={none:1,golden:25,rainbow:50,wet:2,chilled:2,frozen:10,dawnlit:2,dawnbound:3,amberlit:5,amberbound:6},hc={"wet+dawnlit":3,"chilled+dawnlit":3,"wet+amberlit":6,"chilled+amberlit":6,"frozen+dawnlit":11,"frozen+dawnbound":12,"frozen+amberlit":14,"frozen+amberbound":15,"golden+wet":50,"golden+chilled":50,"golden+frozen":250,"golden+dawnlit":50,"golden+dawnbound":75,"golden+amberlit":125,"golden+amberbound":150,"golden+wet+dawnlit":75,"golden+chilled+dawnlit":75,"golden+wet+amberlit":150,"golden+chilled+amberlit":150,"golden+frozen+dawnlit":275,"golden+frozen+dawnbound":300,"golden+frozen+amberlit":350,"golden+frozen+amberbound":375,"rainbow+wet":100,"rainbow+chilled":100,"rainbow+frozen":500,"rainbow+dawnlit":100,"rainbow+dawnbound":150,"rainbow+amberlit":250,"rainbow+amberbound":300,"rainbow+wet+dawnlit":150,"rainbow+chilled+dawnlit":150,"rainbow+wet+amberlit":300,"rainbow+chilled+amberlit":300,"rainbow+frozen+dawnlit":550,"rainbow+frozen+dawnbound":600,"rainbow+frozen+amberlit":700,"rainbow+frozen+amberbound":750};function bc(e,t){if(!e&&0===t.length)return fc.none;const n=[];e&&n.push(e),t.sort().forEach(e=>n.push(e));const o=n.join("+");if(hc[o])return hc[o];let r=fc.none;return e&&(r*=fc[e]),t.forEach(e=>{r*=fc[e]}),r}function yc(){const e=Ql();if(0===e.crops.length)return null;const t=e.crops.filter(e=>e.isMature);if(0===t.length)return null;let n=null;return t.forEach((e,t)=>{const{mutation:o,weather:r}=function(e){let t=null;const n=[];for(const o of e){const e=o.toLowerCase();"golden"===e||"gold"===e?t="golden":"rainbow"===e?t="rainbow":"wet"===e?n.push("wet"):"chilled"===e?n.push("chilled"):"frozen"===e?n.push("frozen"):"dawnlit"===e?n.push("dawnlit"):"dawnbound"===e?n.push("dawnbound"):"amberlit"===e?n.push("amberlit"):"amberbound"===e&&n.push("amberbound")}return{mutation:t,weather:n}}(e.mutations),i=function(e,t){const n=[{weather:"wet",event:"Rain"},{weather:"chilled",event:"Frost"},{weather:"frozen",event:"Rain+Frost"},{weather:"dawnlit",event:"Dawn"},{weather:"amberlit",event:"Amber Moon"}];let o=null;for(const{weather:r,event:i}of n){if(t.includes(r))continue;if("dawnlit"===r&&t.some(e=>"amberlit"===e||"amberbound"===e))continue;if("amberlit"===r&&t.some(e=>"dawnlit"===e||"dawnbound"===e))continue;if("wet"===r&&t.includes("chilled"))continue;if("chilled"===r&&t.includes("wet"))continue;const n=bc(e,[...t,r]);(!o||n>o.multiplier)&&(o={weather:r,multiplier:n,weatherEventName:i})}return o}(o,r);if(!i)return;const a=bc(o,r),s=e.currentValue*Math.max(1,e.fruitCount),l=s/a*i.multiplier,c=l-s;(!n||c>n.valueDifference)&&(n={cropSpecies:e.species,cropIndex:t,currentMutations:[...e.mutations],currentMultiplier:a,currentValue:s,targetWeather:i.weather,targetMultiplier:i.multiplier,targetValue:l,valueDifference:c,weatherEventName:i.weatherEventName})}),n}const xc=new Map;function vc(e){return"rainbow"===e?"Rainbow":"Gold"}function wc(e,t){const n=(e??"").toLowerCase();const o=function(e){const t=String(e??"").toLowerCase();return"rainbow"===t?"rainbow":"gold"===t||"golden"===t?"gold":null}(t);if(!n||!o)return null;const r=`${n}:${o}`,i=xc.get(r);if(i)return i;const a=Zi(n,[vc(o)]);if(!a)return null;const s=Fi(a);return s?(function(e,t){if(xc.size>=200&&!xc.has(e)){const e=xc.keys().next().value;void 0!==e&&xc.delete(e)}xc.set(e,t)}(r,s),s):null}function Cc(e){if(!Lo())return null;const t=Do();if(!t)return null;const n=t[e];if(!n)return null;const o=n.hoursToMature;if("number"!=typeof o||o<=0)return null;const r=3600*o/30;return Math.floor(r)}const Tc="qpm.xpTrackerConfig.v1",Sc=[],Pc={speciesXpPerLevel:{}};let kc=[];const Ac=Wn(()=>{try{g.set(Tc,Pc)}catch(e){s("‚ö†Ô∏è Failed to persist XP tracker config",e)}},2500);function Ec(e,t,n,o,r){const i=e.strength??100,a=e.petId??"",s=e.species??"Unknown",l=Math.max(.25,i/100),c=o/60,d=o*l,p=c*l,u=Math.max(0,c/100),g=3600*Math.min(.95/60,u*l),m=r*l,f=g*m,h=Sc.filter(e=>e.petId===a&&e.abilityId===t),b=h.length>0?h[h.length-1]:null;return{petId:a,petName:e.name??e.species??"Unknown",species:s,abilityId:t,abilityName:n,strength:i,baseXpPerProc:r,actualXpPerProc:m,baseChancePerMinute:o,actualChancePerMinute:d,baseChancePerSecond:c,actualChancePerSecond:p,expectedProcsPerHour:g,expectedXpPerHour:f,lastProcAt:b?.timestamp??null,procCount:h.length,level:e.level??null,currentXp:e.xp??null}}function $c(e){const t=Cc(e);return null!==t?t:void 0!==Pc.speciesXpPerLevel[e]?Pc.speciesXpPerLevel[e]:null}const Mc={Worm:2,Snail:2,Bee:2.5,Chicken:2,Bunny:2,Dragonfly:2.5,Pig:2.5,Cow:2.5,Turkey:2.5,Squirrel:2,Turtle:2.5,Goat:2,Butterfly:2.5,Peacock:2.5,Capybara:2.5,Sheep:2};function Ic(e){return Mc[e]??null}function Fc(e,t){if(!e||e<1)return null;const n=Ic(t);if(!n||n<=1)return null;const o=20*((e-1)/(n-1))+80,r=Math.floor(o);return r<80||r>100?null:r}function zc(e,t,n){if(n<=0||e>=t)return null;const o=(t-e)/n,r=60*o,i=Math.floor(o);return{hours:i,minutes:Math.round(60*(o-i)),totalMinutes:r}}function Lc(){const e=function(){const e={};if(!Lo())return e;const t=Do();if(!t)return e;for(const n of Object.keys(t)){const t=Cc(n);null!==t&&(e[n]=t)}return e}();for(const[t,n]of Object.entries(e))t in Pc.speciesXpPerLevel||(Pc.speciesXpPerLevel[t]=n);Ac()}function Rc(e){if(!e)return"";return e.replace(/([a-z])([A-Z])/g,"$1 $2").replace(/([A-Z])([A-Z][a-z])/g,"$1 $2").replace(/([a-z])(\d)/g,"$1 $2").replace(/(\d)([A-Z])/g,"$1 $2").replace(/\bII\b/g,"II").replace(/\bIII\b/g,"III").replace(/\bIV\b/g,"IV").replace(/\bXp\b/gi,"XP").replace(/_NEW\b/g,"").trim()}function qc(e){const t=(e||"").toLowerCase().replace(/\s+/g,"");return t.includes("rainbowgranter")||t.includes("rainbow")?{base:"linear-gradient(135deg, #FF0000 0%, #FF7F00 16.67%, #FFFF00 33.33%, #00FF00 50%, #0000FF 66.67%, #4B0082 83.33%, #9400D3 100%)",glow:"rgba(124,77,255,0.7)",text:"#FFF"}:t.includes("goldgranter")||t.includes("golden")||"gold"===t?{base:"linear-gradient(135deg, #FFD700 0%, #FFA500 50%, #FFD700 100%)",glow:"rgba(255,215,0,0.75)",text:"#000"}:t.includes("coinfinder")?{base:"#FFD700",glow:"rgba(255,215,0,0.65)",text:"#000"}:t.includes("produceeater")||t.includes("cropeater")||t.includes("producerefund")||t.includes("croprefund")?{base:"#FF5722",glow:"rgba(255,87,34,0.6)",text:"#FFF"}:t.includes("producescaleboost")||t.includes("cropsize")?{base:"#4CAF50",glow:"rgba(76,175,80,0.6)",text:"#FFF"}:t.includes("producemutation")||t.includes("cropmutation")?{base:"#E91E63",glow:"rgba(233,30,99,0.6)",text:"#FFF"}:t.includes("seedfinder")?{base:"#FF9800",glow:"rgba(255,152,0,0.6)",text:"#FFF"}:t.includes("egggrowth")?{base:"#9C27B0",glow:"rgba(156,39,176,0.6)",text:"#FFF"}:t.includes("petrefund")?{base:"#00BCD4",glow:"rgba(0,188,212,0.6)",text:"#FFF"}:t.includes("petmutation")?{base:"#E91E63",glow:"rgba(233,30,99,0.6)",text:"#FFF"}:t.includes("petageboost")||t.includes("maxstrength")||t.includes("strengthboost")?{base:"#673AB7",glow:"rgba(103,58,183,0.6)",text:"#FFF"}:t.includes("pethatchsizeboost")||t.includes("hatchxp")?{base:"#7C4DFF",glow:"rgba(124,77,255,0.65)",text:"#FFF"}:t.includes("sellboost")?{base:"#F44336",glow:"rgba(244,67,54,0.6)",text:"#FFF"}:t.includes("hunger")?{base:"#EC407A",glow:"rgba(236,64,122,0.6)",text:"#FFF"}:t.includes("xpboost")?{base:"#2196F3",glow:"rgba(33,150,243,0.6)",text:"#FFF"}:t.includes("plantgrowth")||t.includes("producegrowth")?{base:"#26A69A",glow:"rgba(38,166,154,0.6)",text:"#FFF"}:t.includes("raindance")?{base:"#2196F3",glow:"rgba(33,150,243,0.6)",text:"#FFF"}:t.includes("doublehatch")?{base:"#5C6BC0",glow:"rgba(92,107,192,0.6)",text:"#FFF"}:t.includes("doubleharvest")?{base:"#1976D2",glow:"rgba(25,118,210,0.6)",text:"#FFF"}:{base:"#90A4AE",glow:"rgba(144,164,174,0.6)",text:"#FFF"}}function Nc(e){const{species:t,name:n,xp:o=0,targetScale:r=1,abilities:i=[],mutations:a=[]}=e,s=String(t).trim();if(!s)return'<div style="font-size: 16px;">üêæ</div>';const l=o>0?function(e,t,n){const o=Fc(n,e),r=$c(e);if(!r||r<=0||!o)return 0;const i=Math.min(30,Math.floor(t/r)),a=(o-50)/30;return Math.min(o,Math.round(50+i*a))}(s,o,r):0;let c;a.includes("rainbow")||a.includes("Rainbow")?c=wc(s,"rainbow"):(a.includes("gold")||a.includes("Gold"))&&(c=wc(s,"gold")),c||(c=Fi(Yi(s)));const d=function(e,t=14){return e&&0!==e.length?e.slice(0,4).map(e=>{const n=qc(e);return`<div class="pet-card-ability-square" title="${e}" style="background:${n.base};border:1px solid rgba(255,255,255,0.3);box-shadow:0 0 6px ${n.glow};width:${t}px;height:${t}px;border-radius:3px;"></div>`}).join(""):""}(i,10),p=n||s;return`\n    <div class="qpm-compact-pet" style="display: inline-flex; align-items: center; gap: 8px; padding: 6px 10px; border-radius: 6px; background: rgba(30,20,45,0.7); border: 1px solid rgba(168,139,250,0.2);">\n      <div style="position: relative;">\n        ${d?`<div style="position: absolute; left: -14px; top: 50%; transform: translateY(-50%); display: flex; flex-direction: column; gap: 2px;">${d}</div>`:""}\n        ${c?`<img src="${c}" alt="${p}" style="width: 32px; height: 32px; object-fit: contain; image-rendering: pixelated;" />`:'<div style="font-size: 16px;">üêæ</div>'}\n      </div>\n      <div style="display: flex; flex-direction: column; gap: 2px;">\n        <span style="font-size: 12px; font-weight: 700; color: #e2e8f0;">${p}</span>\n        <span style="font-size: 10px; font-weight: 700; color: #a78bfa;">STR: ${l}</span>\n      </div>\n    </div>\n  `}function Bc(e,t,n){const o=n?n>0?60/n:null:t;if(!o||o<=0)return{text:"‚Äî",isOverdue:!1};const r=e+60*o*1e3-Date.now();if(r<0){const e=Math.abs(r),t=Math.floor(e/36e5),n=Math.floor(e%36e5/6e4),o=Math.floor(e%6e4/1e3);return t>0?{text:`-${t}h ${n}m ${o}s`,isOverdue:!0}:n>0?{text:`-${n}m ${o}s`,isOverdue:!0}:{text:`-${o}s`,isOverdue:!0}}const i=Math.floor(r/36e5),a=Math.floor(r%36e5/6e4),s=Math.floor(r%6e4/1e3);return i>0?{text:`${i}h ${a}m ${s}s`,isOverdue:!1}:a>0?{text:`${a}m ${s}s`,isOverdue:!1}:{text:`${s}s`,isOverdue:!1}}function Dc(e,t,n,o=!1,r){const i=n.insertRow();i.style.cssText="border-bottom: 1px solid var(--qpm-border, #444);",i.dataset.petIndex=String(e.petIndex),i.dataset.abilityId=e.definition.id;const a=e.procsPerHour,l=i.insertCell(),c=e.pet.strength,d=null!=c?` (STR ${c})`:"",p=e.pet.species?ea(e.pet.species):null,u=(e.pet.abilities||[]).slice(0,4).map((e,t)=>{const n=qc(e);return`<div style="width:8px;height:8px;border-radius:2px;background:${n.base};border:1px solid rgba(255,255,255,0.4);box-shadow:0 0 3px ${n.glow};" title="${e}"></div>`}).join(""),g=p?`<div style="position:relative;display:inline-flex;align-items:center;margin-right:6px;">\n        ${u?`<div style="display:flex;flex-direction:column;gap:2px;margin-right:4px;">${u}</div>`:""}\n        <img data-qpm-sprite="pet:${e.pet.species}" src="${p}" style="width:20px;height:20px;object-fit:contain;image-rendering:pixelated;" alt="${e.pet.species}" />\n      </div>`:"";l.innerHTML=`<div style="display:flex;align-items:center;">${g}<span>${e.displayName}${d}</span></div>`,l.style.cssText="\n    padding: 10px 12px;\n    color: var(--qpm-text, #fff);\n    font-weight: 500;\n    white-space: nowrap;\n  ",l.title=`Pet: ${e.displayName}${null!=c?`\nStrength: ${c}`:"\nStrength: Unknown"}`;const m=i.insertCell();m.textContent=t,m.style.cssText="\n    padding: 10px 12px;\n    color: var(--qpm-text, #fff);\n    white-space: nowrap;\n  ";const f=i.insertCell(),h=e.pet.strength??100,b=e.definition.baseProbability??0,y=b/60*h/100,x=60*y,v=`${x.toFixed(2)}%/min`;f.textContent=v,f.style.cssText="\n    padding: 10px 12px;\n    text-align: right;\n    color: var(--qpm-text, #fff);\n    font-family: monospace;\n    white-space: nowrap;\n  ",f.title=`Base Chance: ${b.toFixed(2)}%/min\nWith STR ${h}: ${x.toFixed(2)}%/min\nPer Second: ${y.toFixed(3)}%/sec (game checks every second)`;const w=i.insertCell();w.textContent=a.toFixed(2),w.style.cssText="\n    padding: 10px 12px;\n    text-align: right;\n    color: var(--qpm-text, #fff);\n    font-family: monospace;\n  ",w.title=`${e.procsPerHour.toFixed(2)} procs/hour`;const C=i.insertCell(),T=e.effectPerProc??0,S=o?Dn:Hn;C.textContent=T>0?S(T):"‚Äî",C.style.cssText=`\n    padding: 10px 12px;\n    text-align: right;\n    color: ${T>0?"var(--qpm-warning, #ffa500)":"var(--qpm-text-muted, #aaa)"};\n    font-family: monospace;\n    font-weight: 500;\n  `,e.effectDetail&&(C.title=e.effectDetail),!o&&T>0&&(C.title=`Exact: ${Dn(T)}`);const P=i.insertCell(),k=a*(T>0?T:0);P.textContent=k>0?S(k):"‚Äî",P.style.cssText=`\n    padding: 10px 12px;\n    text-align: right;\n    color: ${k>0?"var(--qpm-warning, #ffa500)":"var(--qpm-text-muted, #aaa)"};\n    font-family: monospace;\n    font-weight: 600;\n  `,!o&&k>0&&(P.title=`Exact: ${Dn(k)}/hr`);const A=i.insertCell();A.className="eta-countdown";const E=a>0?60/a:0;if(a>0){let t,n;if(e.lastProcAt&&e.lastProcAt>0)t=e.lastProcAt,n=!1;else{const o=`${e.petIndex}:${e.definition.id}`,i=r?.get(o);t=i||Date.now(),n=!0}A.dataset.lastProc=String(t),A.dataset.effectiveRate=String(a),A.dataset.normalColor="var(--qpm-positive, #4CAF50)",A.dataset.isEstimate=n?"true":"false";const o=Bc(t,e.expectedMinutesBetween,a);A.textContent=o.text,A.style.cssText=`\n      padding: 10px 12px;\n      text-align: right;\n      color: ${o.isOverdue?"var(--qpm-danger, #ef5350)":"var(--qpm-positive, #4CAF50)"};\n      font-family: monospace;\n      font-weight: 500;\n      white-space: nowrap;\n    `,A.title=n?`Estimated ${E.toFixed(1)} minutes between procs\nNo proc history yet`:`Average ${E.toFixed(1)} minutes between procs\nLast proc: ${new Date(e.lastProcAt).toLocaleTimeString()}`}else A.textContent="‚Äî",A.style.cssText="\n      padding: 10px 12px;\n      text-align: right;\n      color: var(--qpm-text-muted, #aaa);\n      font-family: monospace;\n      font-weight: 500;\n      white-space: nowrap;\n    ",A.title="No proc rate available";if(o){const t=n.insertRow();t.style.cssText="\n      background: var(--qpm-surface-2, #222);\n      border-bottom: 1px solid var(--qpm-border, #444);\n    ";const o=t.insertCell();o.colSpan=7,o.style.cssText="\n      padding: 8px 12px;\n      font-size: 11px;\n      color: var(--qpm-text-muted, #aaa);\n      line-height: 1.6;\n    ";const r=e.pet.strength??100,i=e.definition.baseProbability??0,a=r/100,l=i*a,c=[];if(i>0&&c.push(`<strong>Chance Per Minute:</strong> ${i.toFixed(2)}% √ó ${r} = ${l.toFixed(2)}%`),e.definition.effectLabel&&null!=e.definition.effectBaseValue){const t=e.definition.effectBaseValue*a,n=e.definition.effectSuffix??"";c.push(`<strong>${e.definition.effectLabel}:</strong> ${e.definition.effectBaseValue}${n} √ó ${r} = ${t.toFixed(1)}${n}`)}if("ProduceMutationBoost"===e.definition.id||"ProduceMutationBoostII"===e.definition.id)try{const e=yc();if(e){const t=function(e,t){if(!e)return"No mutation opportunities found";const n=(e.weatherEventName.includes("Dawn")||e.weatherEventName.includes("Amber")?1:7)*(t/100);return`Best: ${e.cropSpecies} ‚Üí ${e.weatherEventName} (${n.toFixed(2)}% chance, +${(e.targetMultiplier/e.currentMultiplier).toFixed(1)}√ó value)`}(e,r);c.push(`<strong>üåü Opportunity:</strong> ${t}`)}}catch($){s("‚ö†Ô∏è Failed to calculate mutation opportunity",$)}if("observed"===e.procsPerHourSource?c.push(`<strong>Data Source:</strong> Observed (${e.sampleCount} sample${1!==e.sampleCount?"s":""})`):c.push("<strong>Data Source:</strong> Estimated from ability definition"),e.lastProcAt){const t=new Date(e.lastProcAt),n=Date.now()-e.lastProcAt,o=Math.floor(n/6e4),r=Math.floor(o/60),i=r>0?`${r}h ${o%60}m ago`:`${o}m ago`;c.push(`<strong>Last Proc:</strong> ${t.toLocaleTimeString()} (${i})`)}o.innerHTML=c.join(" ‚Ä¢ ")}return i}let Hc={stats:{wetCount:0,wetPerHour:0,wetTotalValue:0,wetLastAt:null,chilledCount:0,chilledPerHour:0,chilledTotalValue:0,chilledLastAt:null,frozenCount:0,frozenPerHour:0,frozenTotalValue:0,frozenLastAt:null,dawnlitCount:0,dawnlitPerHour:0,dawnlitTotalValue:0,dawnlitLastAt:null,dawnboundCount:0,dawnboundPerHour:0,dawnboundTotalValue:0,dawnboundLastAt:null,amberlitCount:0,amberlitPerHour:0,amberlitTotalValue:0,amberlitLastAt:null,amberboundCount:0,amberboundPerHour:0,amberboundTotalValue:0,amberboundLastAt:null,sessionValue:0,sessionStart:Date.now(),bestHourValue:0,bestHourTime:null,bestSessionValue:0,bestSessionTime:null},updatedAt:Date.now()},jc=new Map;const _c=new Set;function Oc(e){const t=[e.species,e.seedSpecies,e.plantSpecies,e.cropSpecies,e.name];for(const n of t)if("string"==typeof n){const e=n.trim();if(e.length>0)return e}return null}function Gc(){return{stats:{...Hc.stats},updatedAt:Hc.updatedAt}}function Vc(e){return _c.add(e),e(Gc()),()=>_c.delete(e)}function Wc(){Hc={stats:{wetCount:0,wetPerHour:0,wetTotalValue:0,wetLastAt:null,chilledCount:0,chilledPerHour:0,chilledTotalValue:0,chilledLastAt:null,frozenCount:0,frozenPerHour:0,frozenTotalValue:0,frozenLastAt:null,dawnlitCount:0,dawnlitPerHour:0,dawnlitTotalValue:0,dawnlitLastAt:null,dawnboundCount:0,dawnboundPerHour:0,dawnboundTotalValue:0,dawnboundLastAt:null,amberlitCount:0,amberlitPerHour:0,amberlitTotalValue:0,amberlitLastAt:null,amberboundCount:0,amberboundPerHour:0,amberboundTotalValue:0,amberboundLastAt:null,sessionValue:0,sessionStart:Date.now(),bestHourValue:Hc.stats.bestHourValue,bestHourTime:Hc.stats.bestHourTime,bestSessionValue:Hc.stats.bestSessionValue,bestSessionTime:Hc.stats.bestSessionTime},updatedAt:Date.now()},jc=new Map;const e=function(e){const t=[];if(!e)return t;const n=[{tiles:e.tileObjects},{tiles:e.boardwalkTileObjects}];for(const{tiles:o}of n)if(o&&"object"==typeof o)for(const[e,n]of Object.entries(o)){if(!n||"object"!=typeof n)continue;const o=n;"plant"===o.objectType&&(Array.isArray(o.slots)?o.slots:[]).forEach((n,o)=>{if(!n||"object"!=typeof n)return;const r=n,i=(Array.isArray(r.mutations)?r.mutations:[]).map(e=>"string"==typeof e?e:null).filter(e=>!!e);if(0===i.length)return;const a=Oc(r),s=$t(i);t.push({tileId:e,slotIndex:o,cropName:a,mutations:i,slotState:s})})}return t}(ln());for(const n of e){const e=`${n.tileId}-${n.slotIndex}`,t=new Set;n.slotState.hasWet&&t.add("wet"),n.slotState.hasChilled&&t.add("chilled"),n.slotState.hasFrozen&&t.add("frozen"),n.slotState.hasDawnlit&&t.add("dawnlit"),n.slotState.hasDawnbound&&t.add("dawnbound"),n.slotState.hasAmberlit&&t.add("amberlit"),n.slotState.hasAmberbound&&t.add("amberbound"),t.size>0&&jc.set(e,t)}try{g.set("qpm.weatherMutationTracking.v1",function(){const e=[];for(const[t,n]of jc.entries())e.push([t,Array.from(n)]);return{version:2,stats:{...Hc.stats},updatedAt:Hc.updatedAt,trackedSlots:e}}())}catch(t){console.error("[weatherMutationTracking] Failed to save after reset:",t)}!function(){for(const e of _c)try{e(Hc)}catch(t){console.error("[weatherMutationTracking] Listener error:",t)}}(),console.log(`[QPM] üîÑ Weather mutation tracking reset - ${jc.size} existing slots marked as seen`)}const Uc="qpm.mutationValueTracking.v1",Xc=36e5;function Qc(e){const t=function(e){if(!Lo())return null;const t=Uo(e);if(t<=1)return null;const n=jo();if(!n)return null;const o=[];for(const[i,a]of Object.entries(n))a.crop?.baseSellPrice&&"number"==typeof a.crop.baseSellPrice&&o.push(a.crop.baseSellPrice);if(0===o.length)return null;const r=o.reduce((e,t)=>e+t,0)/o.length;return Math.floor(r*t)}(e);if(null!==t)return t;const n=Uo(e);return Math.floor(5e3*n)}let Jc={stats:{goldProcs:0,goldPerHour:0,goldTotalValue:0,goldLastProcAt:null,rainbowProcs:0,rainbowPerHour:0,rainbowTotalValue:0,rainbowLastProcAt:null,cropBoostProcs:0,cropBoostPerHour:0,cropBoostTotalValue:0,cropBoostLastProcAt:null,sessionValue:0,sessionStart:Date.now(),bestHourValue:0,bestHourTime:null,bestSessionValue:0,bestSessionTime:null},sessions:[],hourlyBreakdown:new Map,updatedAt:Date.now()},Kc=!1;const Yc=new Set;function Zc(e,t){const n=Ml();let o=0,r=null;for(const i of n.values())if(i.abilityId===e){const e=i.events.filter(e=>e.performedAt>=t);if(o+=e.length,e.length>0){const t=Math.max(...e.map(e=>e.performedAt));(null===r||t>r)&&(r=t)}}return{count:o,lastProcAt:r}}function ed(){const e=Date.now(),t=Jc.stats.sessionStart,n=Math.max(1,e-t)/Xc,o=Ql(),r=Yl("GoldGranter",o,null),i=Yl("RainbowGranter",o,null),a=Yl("ProduceScaleBoost",o,null),s=Yl("ProduceScaleBoostII",o,null),l=r?.effectPerProc||Qc("Gold"),c=i?.effectPerProc||Qc("Rainbow"),d=a?.effectPerProc||Qc("Rainbow"),p=s?.effectPerProc||Qc("Rainbow"),u=Zc("GoldGranter",t);Jc.stats.goldProcs=u.count,Jc.stats.goldLastProcAt=u.lastProcAt,Jc.stats.goldTotalValue=u.count*l,Jc.stats.goldPerHour=n>0?u.count/n:0;const g=Zc("RainbowGranter",t);Jc.stats.rainbowProcs=g.count,Jc.stats.rainbowLastProcAt=g.lastProcAt,Jc.stats.rainbowTotalValue=g.count*c,Jc.stats.rainbowPerHour=n>0?g.count/n:0;const m=Zc("ProduceScaleBoost",t),f=Zc("ProduceScaleBoostII",t),h=m.count+f.count,b=m.lastProcAt&&f.lastProcAt?Math.max(m.lastProcAt,f.lastProcAt):m.lastProcAt||f.lastProcAt,y=m.count*d+f.count*p;Jc.stats.cropBoostProcs=h,Jc.stats.cropBoostLastProcAt=b,Jc.stats.cropBoostTotalValue=y,Jc.stats.cropBoostPerHour=n>0?h/n:0,Jc.stats.sessionValue=Jc.stats.goldTotalValue+Jc.stats.rainbowTotalValue+Jc.stats.cropBoostTotalValue,function(e){const t=new Map,n=Yl("GoldGranter",e,null),o=Yl("RainbowGranter",e,null),r=Yl("ProduceScaleBoost",e,null),i=Yl("ProduceScaleBoostII",e,null),a=n?.effectPerProc||Qc("Gold"),s=o?.effectPerProc||Qc("Rainbow"),l=r?.effectPerProc||Qc("Rainbow"),c=i?.effectPerProc||Qc("Rainbow"),d=Ml();for(const p of d.values())for(const e of p.events){const n=new Date(e.performedAt).getHours();let o=0;if("GoldGranter"===p.abilityId?o=a:"RainbowGranter"===p.abilityId?o=s:"ProduceScaleBoost"===p.abilityId?o=l:"ProduceScaleBoostII"===p.abilityId&&(o=c),o>0){const e=t.get(n)||{value:0,count:0};e.value+=o,e.count+=1,t.set(n,e)}}Jc.hourlyBreakdown=new Map;for(const[p,u]of t)Jc.hourlyBreakdown.set(p,u.value/Math.max(1,u.count))}(o);const x=function(e,t){const n=e-Xc,o=Zc("GoldGranter",n),r=Zc("RainbowGranter",n),i=Zc("ProduceScaleBoost",n),a=Zc("ProduceScaleBoostII",n),s=Yl("GoldGranter",t,null),l=Yl("RainbowGranter",t,null),c=Yl("ProduceScaleBoost",t,null),d=Yl("ProduceScaleBoostII",t,null),p=s?.effectPerProc||Qc("Gold"),u=l?.effectPerProc||Qc("Rainbow"),g=c?.effectPerProc||Qc("Rainbow"),m=d?.effectPerProc||Qc("Rainbow");return o.count*p+r.count*u+i.count*g+a.count*m}(e,o);x>Jc.stats.bestHourValue&&(Jc.stats.bestHourValue=x,Jc.stats.bestHourTime=e),Jc.stats.sessionValue>Jc.stats.bestSessionValue&&(Jc.stats.bestSessionValue=Jc.stats.sessionValue,Jc.stats.bestSessionTime=e),Jc.updatedAt=e,td(),od()}const td=Wn(()=>{try{g.set(Uc,nd())}catch(e){console.error("[mutationValueTracking] Failed to save:",e)}},3e3);function nd(){return{version:1,stats:{goldProcs:Jc.stats.goldProcs,goldPerHour:Jc.stats.goldPerHour,goldTotalValue:Jc.stats.goldTotalValue,goldLastProcAt:Jc.stats.goldLastProcAt,rainbowProcs:Jc.stats.rainbowProcs,rainbowPerHour:Jc.stats.rainbowPerHour,rainbowTotalValue:Jc.stats.rainbowTotalValue,rainbowLastProcAt:Jc.stats.rainbowLastProcAt,cropBoostProcs:Jc.stats.cropBoostProcs,cropBoostPerHour:Jc.stats.cropBoostPerHour,cropBoostTotalValue:Jc.stats.cropBoostTotalValue,cropBoostLastProcAt:Jc.stats.cropBoostLastProcAt,sessionValue:Jc.stats.sessionValue,sessionStart:Jc.stats.sessionStart,bestHourValue:Jc.stats.bestHourValue,bestHourTime:Jc.stats.bestHourTime,bestSessionValue:Jc.stats.bestSessionValue,bestSessionTime:Jc.stats.bestSessionTime},sessions:Jc.sessions,updatedAt:Jc.updatedAt}}function od(){for(const t of Yc)try{t(Jc)}catch(e){console.error("[mutationValueTracking] Listener error:",e)}}function rd(){if(!Kc){Kc=!0;try{!function(e){e&&1===e.version&&(Jc.stats.bestHourValue=e.stats.bestHourValue||0,Jc.stats.bestHourTime=e.stats.bestHourTime||null,Jc.stats.bestSessionValue=e.stats.bestSessionValue||0,Jc.stats.bestSessionTime=e.stats.bestSessionTime||null,Jc.sessions=e.sessions||[],Jc.stats.sessionStart=Date.now(),Jc.updatedAt=Date.now())}(g.get(Uc,null)),s("üîÑ Mutation value tracking initialized - session data reset, tracking only current session")}catch(e){console.error("[mutationValueTracking] Failed to restore:",e)}ed(),re("mutation-value-recalc",()=>{ed()},1e4)}}function id(){return{stats:{...Jc.stats},sessions:[...Jc.sessions],hourlyBreakdown:new Map(Jc.hourlyBreakdown),updatedAt:Jc.updatedAt}}function ad(e){return Yc.add(e),e(id()),()=>Yc.delete(e)}function sd(){!function(){const e=Date.now(),t=new Date(e).toISOString().split("T")[0];(Jc.stats.sessionValue>0||Jc.stats.goldProcs+Jc.stats.rainbowProcs+Jc.stats.cropBoostProcs>0)&&(Jc.sessions.push({date:t,value:Jc.stats.sessionValue,goldProcs:Jc.stats.goldProcs,rainbowProcs:Jc.stats.rainbowProcs,cropBoostProcs:Jc.stats.cropBoostProcs,duration:e-Jc.stats.sessionStart}),Jc.sessions.length>30&&(Jc.sessions=Jc.sessions.slice(-30)))}(),Wc();const e=Date.now();Jc={stats:{goldProcs:0,goldPerHour:0,goldTotalValue:0,goldLastProcAt:null,rainbowProcs:0,rainbowPerHour:0,rainbowTotalValue:0,rainbowLastProcAt:null,cropBoostProcs:0,cropBoostPerHour:0,cropBoostTotalValue:0,cropBoostLastProcAt:null,sessionValue:0,sessionStart:e,bestHourValue:Jc.stats.bestHourValue,bestHourTime:Jc.stats.bestHourTime,bestSessionValue:Jc.stats.bestSessionValue,bestSessionTime:Jc.stats.bestSessionTime},sessions:Jc.sessions,hourlyBreakdown:new Map,updatedAt:Date.now()};try{g.set(Uc,nd())}catch(t){console.error("[mutationValueTracking] Failed to save after reset:",t)}od(),s("‚úÖ [MUTATION-VALUE] Reset complete - session stats cleared")}const ld="qpm.autoFavorite.v1";function cd(e){return"string"==typeof e?e:e?.type||e?.abilityType||e?.id||""}function dd(e){return e.toLowerCase().replace(/\s+/g,"")}function pd(e,t,n){const o="gold"===n?"Gold":"Rainbow";return!!t.includes(o)||e.some(e=>{const t=dd(cd(e)),o=`${n}granter`;return t===o||t.includes(o)})}function ud(e,t){const n=dd(t);return e.some(e=>dd(cd(e))===n)}let gd={enabled:!1,species:[],mutations:[],petAbilities:[],filterByAbilities:[],filterByAbilityCount:null,filterBySpecies:[],filterByCropTypes:[]};const md=new Set;let fd=null,hd=new Set;function bd(){try{g.set(ld,gd),function(){for(const t of md)try{t({...gd})}catch(e){s("‚ö†Ô∏è Auto-favorite listener error",e)}}()}catch(e){s("‚ö†Ô∏è Failed to save auto-favorite config",e)}}function yd(e){const t=T;if(!t?.myData?.inventory?.items)return void s("üåü [AUTO-FAVORITE] No myData available yet - waiting for game to load");const n=t.myData.inventory.items,o=new Set(t.myData.inventory.favoritedItemIds||[]);let r=0;for(const i of n)"Produce"===i.itemType&&"Pet"!==i.itemType&&"Egg"!==i.itemType&&"Tool"!==i.itemType&&"Pet"!==i.category&&"Egg"!==i.category&&"Tool"!==i.category&&(i.species&&(i.species.includes("Pet")||i.species.includes("Egg"))||i.species!==e||o.has(i.id)||Pd(i.id)&&r++);s(r>0?`‚úÖ [AUTO-FAVORITE] Favorited ${r} ${e} crops`:`‚ÑπÔ∏è [AUTO-FAVORITE] No ${e} crops to favorite (already favorited or none in inventory)`)}function xd(e){s(`üîí [AUTO-FAVORITE] Checkbox unchecked for ${e} - Auto-favorite disabled, but existing favorites are preserved (script never removes favorites)`)}function vd(e){const t=T;if(!t?.myData?.inventory?.items)return void s("üåü [AUTO-FAVORITE] No myData available yet - waiting for game to load");const n=t.myData.inventory.items,o=new Set(t.myData.inventory.favoritedItemIds||[]);let r=0;for(const i of n){if("Produce"!==i.itemType)continue;if("Pet"===i.itemType||"Egg"===i.itemType||"Tool"===i.itemType)continue;if("Pet"===i.category||"Egg"===i.category||"Tool"===i.category)continue;if(i.species&&(i.species.includes("Pet")||i.species.includes("Egg")))continue;(i.mutations||[]).includes(e)&&!o.has(i.id)&&Pd(i.id)&&r++}s(r>0?`‚úÖ [AUTO-FAVORITE] Favorited ${r} crops with ${e} mutation`:`‚ÑπÔ∏è [AUTO-FAVORITE] No crops with ${e} mutation to favorite (already favorited or none in inventory)`)}function wd(e){s(`üîí [AUTO-FAVORITE] Checkbox unchecked for ${e} mutation - Auto-favorite disabled, but existing favorites are preserved (script never removes favorites)`)}function Cd(e){const t=T;if(!t?.myData?.inventory?.items)return void s("üåü [AUTO-FAVORITE-PET] No myData available yet - waiting for game to load");s(`üîç [AUTO-FAVORITE-PET] Searching for pets with ${e}...`);const n=t.myData.inventory.items,o=new Set(t.myData.inventory.favoritedItemIds||[]);let r=0,i=0;const a=n.find(e=>"Pet"===e.itemType);a&&s("üêæ [AUTO-FAVORITE-PET-DEBUG] Sample pet structure:",{species:a.petSpecies,mutations:a.mutations,abilities:a.abilities,hasAbilitiesArray:Array.isArray(a.abilities),hasMutationsArray:Array.isArray(a.mutations)});for(const l of n){if("Pet"!==l.itemType)continue;if(i++,o.has(l.id))continue;const t=l.mutations||[],n=l.abilities||[];("Gold Granter"===e&&pd(n,t,"gold")||"Rainbow Granter"===e&&pd(n,t,"rainbow"))&&(s(`‚ú® [AUTO-FAVORITE-PET] Found matching pet: ${l.petSpecies||l.species} (${l.id}) - mutations: [${t.join(", ")}], abilities: ${n.length}`),Pd(l.id)&&r++)}s(`‚úÖ [AUTO-FAVORITE-PET] Scanned ${i} pets, favorited ${r} with ${e}`)}function Td(e){s(`üîí [AUTO-FAVORITE-PET] Checkbox unchecked for ${e} - Auto-favorite disabled, but existing favorites are preserved (script never removes favorites)`)}function Sd(){try{const e=T;return e?.__mga_lastScopePath?.slice()??["Room","Quinoa"]}catch{return["Room","Quinoa"]}}function Pd(e){try{const t=T,n=t?.MagicCircle_RoomConnection;return!(!n||"function"!=typeof n.sendMessage)&&(n.sendMessage({scopePath:Sd(),type:"ToggleFavoriteItem",itemId:e}),!0)}catch(t){return s(`‚ö†Ô∏è Failed to favorite item ${e}`,t),!1}}function kd(){null===fd&&(fd=ie("auto-favorite-poll",()=>{if(!gd.enabled)return;const e=gd.species||[],t=gd.mutations||[],n=gd.petAbilities||[];if(0===e.length&&0===t.length&&0===n.length)return;if(null===ks)return;const o=Is(),r=Fs(),i=new Set;for(const s of o)s?.id&&i.add(s.id);const a=new Set;for(const s of i)hd.has(s)||a.add(s);if(a.size>0){const i=o.filter(e=>e.id&&a.has(e.id));for(const o of i){if(r.has(o.id))continue;const i=o.raw,a=Array.isArray(i?.mutations)?i.mutations:[],l=Array.isArray(o.abilities)?o.abilities:Array.isArray(i?.abilities)?i.abilities:[],c=i?.itemType||o.itemType;let d=!1,p="";if("Pet"===c){if(gd.filterByAbilities&&gd.filterByAbilities.length>0&&s("[AUTO-FAVORITE-DEBUG] Pet detected:",{species:o.species,abilitiesFromItem:o.abilities,abilitiesFromRaw:i?.abilities,abilitiesUsed:l,filterByAbilities:gd.filterByAbilities}),gd.filterBySpecies&&gd.filterBySpecies.length>0){const e=i?.petSpecies||i?.species||o.species||"";if(!gd.filterBySpecies.includes(e))continue;d=!0,p="filtered species"}if(gd.filterByAbilities&&gd.filterByAbilities.length>0){if(!gd.filterByAbilities.some(e=>ud(l,e)))continue;d=!0,p="filtered ability"}if(null!=gd.filterByAbilityCount){if(l.length!==gd.filterByAbilityCount)continue;d||(d=!0,p=`${gd.filterByAbilityCount} abilities`)}if(gd.filterByAbilities&&gd.filterByAbilities.length>0){const e=gd.filterByAbilities.some(e=>"goldgranter"===dd(e)||"goldgranter"===dd(e)),t=gd.filterByAbilities.some(e=>"rainbowgranter"===dd(e)||"rainbowgranter"===dd(e));e&&pd(l,a,"gold")&&(d=!0,p="Gold Granter"),t&&pd(l,a,"rainbow")&&(d=!0,p="Rainbow Granter")}if(n.length>0&&l.length>0){const e=l.find(e=>n.some(t=>t.toLowerCase()===String(e).toLowerCase()));e&&(d=!0,p=`ability: ${e}`)}}else if("Produce"===c){if(gd.filterByCropTypes&&gd.filterByCropTypes.length>0){const e=i?.species||o.species||"";if(!gd.filterByCropTypes.includes(e))continue;d=!0,p="filtered crop"}if(t.length>0&&a.length>0){const e=a.find(e=>t.some(t=>t.toLowerCase()===String(e).toLowerCase()));e&&(d=!0,p=`mutation: ${e}`)}if(e.length>0&&o.species){e.some(e=>e.toLowerCase()===o.species.toLowerCase())&&(d=!0,p=`species: ${o.species}`)}}d&&(s(`[AUTO-FAVORITE] Favoriting ${o.species||"item"} (${p})`),Pd(o.id))}}hd=i},2e3),s("‚úÖ Auto-favorite polling started (2 second interval, visibility-aware)"))}function Ad(){!function(){try{const e=g.get(ld,null);if(e&&"object"==typeof e){const t=e=>Array.isArray(e)?e:e&&"string"==typeof e?[e]:[];gd={enabled:e.enabled??gd.enabled,species:e.species??gd.species,mutations:e.mutations??gd.mutations,petAbilities:e.petAbilities??gd.petAbilities,filterByAbilities:t(e.filterByAbilities||e.filterByAbility),filterByAbilityCount:void 0!==e.filterByAbilityCount?e.filterByAbilityCount:gd.filterByAbilityCount,filterBySpecies:t(e.filterBySpecies),filterByCropTypes:t(e.filterByCropTypes||e.filterByCropType)}}}catch(e){s("‚ö†Ô∏è Failed to load auto-favorite config",e)}}(),kd();const e=T;e.qpm_favoriteSpecies=yd,e.qpm_unfavoriteSpecies=xd,e.qpm_favoriteMutation=vd,e.qpm_unfavoriteMutation=wd,e.qpm_favoritePetAbility=Cd,e.qpm_unfavoritePetAbility=Td,s("‚úÖ [AUTO-FAVORITE] System initialized - monitoring inventory changes",gd)}function Ed(){return{...gd}}function $d(e){gd={...gd,...e},bd(),gd.enabled&&kd()}const Md="qpm.gardenFilters.v1",Id={Carrot:"Carrot Plant View",Strawberry:"Strawberry Plant View",Aloe:"Aloe Vera Plant View",FavaBean:"Fava Bean Plant View",Delphinium:"Delphinium Plant View",Blueberry:"Blueberry Plant View",Apple:"Apple Tree View",OrangeTulip:"Tulip Plant View",Tomato:"Tomato Plant View",Daffodil:"Daffodil Plant View",Mushroom:"Mushroom Plant View",Sunflower:"Sunflower Plant View",Corn:"Corn Plant View",Pepper:"Pepper Plant View",Watermelon:"Watermelon Plant View",Squash:"Squash Plant View",Pumpkin:"Pumpkin Plant View",Lemon:"Lemon Tree View",Grape:"Grape Plant View",Coconut:"Coconut Tree View",Banana:"Banana Plant View",PassionFruit:"Passion Fruit Plant View",Lychee:"Lychee Plant View",DragonFruit:"Dragon Fruit Plant View",Cacao:"Cacao Plant View",Lily:"Lily Plant View",Chrysanthemum:"Chrysanthemum Bush View",PineTree:"Pine Tree View",Poinsettia:"Poinsettia Bush View",Cactus:"Cactus Plant View",BurrosTail:"Burro's Tail Plant View",Echeveria:"Echeveria Plant View",Bamboo:"Bamboo Plant View",Camellia:"Camellia Hedge View",MoonCelestial:"Moonbinder View",DawnCelestial:"Dawnbinder View",Starweaver:"Starweaver Plant View"};let Fd={enabled:!1,mutations:[],cropSpecies:[],eggTypes:[],growthStates:[]};const zd=new Set;let Ld=null;function Rd(){try{const e=("undefined"!=typeof unsafeWindow&&unsafeWindow?unsafeWindow:globalThis).__QPM_PIXI_CAPTURED__;return e&&e.app?e.app:null}catch(e){return s("‚ö†Ô∏è [GARDEN-FILTERS] Error accessing PIXI app",e),null}}function qd(e,t){const n=ln(),o=cn();if(!n||!o)return null;const r=e+t*o.cols,i=o.globalTileIdxToDirtTile?.[r];if(i){const e=i.dirtTileIdx,t=n.tileObjects?.[e];if(t)return t}const a=o.globalTileIdxToBoardwalk?.[r];if(a){const e=a.boardwalkTileIdx,t=n.boardwalkTileObjects?.[e];if(t)return t}return null}function Nd(e,t,n,o,r,i,a=0,l=10){if(e&&!(a>l)){if(e.label&&/^Tile \((\d+), (\d+)\)$/.test(e.label)){const a=e.label.match(/^Tile \((\d+), (\d+)\)$/),l=e.children?.[0]?.label;if(a&&l&&"Sprite"!==l){const c=parseInt(a[1]),d=parseInt(a[2]);let p=!0,u=!0;if("Egg"===l){if(o.size>0){const e=qd(c,d);if(e){const t=e.eggType||e.species;u=o.has(t)}else u=!0}}else t.size>0&&(p=t.has(l));let g=!0,m=!0;if(n.size>0||r.size>0){const e=qd(c,d);if(e){if(i.withData++,n.size>0){const t=function(e){if(!e?.slots||!Array.isArray(e.slots))return[];const t=new Set;for(const n of e.slots)n.mutations&&Array.isArray(n.mutations)&&n.mutations.forEach(e=>t.add(e));return Array.from(t)}(e);g=t.some(e=>n.has(e)),1===i.withData&&s(`[GARDEN-FILTERS-DEBUG] First tile with data (${c}, ${d}): species=${e.species}, mutations=${JSON.stringify(t)}, mutationMatches=${g}`)}if(r.size>0){const t=function(e){if(!e)return null;if("plant"!==e.objectType)return null;const t=Date.now(),n=e.maturedAt;return n?t<n?"growing":"mature":null}(e);m=null!==t&&r.has(t)}}else i.withoutData++,g=!1,m=!1}else i.withoutData++;p&&u&&g&&m?(e.alpha=1,i.visible++):(e.alpha=.1,i.dimmed++)}}if(e.children&&Array.isArray(e.children))for(const s of e.children)Nd(s,t,n,o,r,i,a+1,l)}}function Bd(e,t=0,n=10){if(e&&!(t>n)&&(e.label&&/^Tile \(\d+, \d+\)$/.test(e.label)&&(e.alpha=1),e.children&&Array.isArray(e.children)))for(const o of e.children)Bd(o,t+1,n)}function Dd(){if(Fd.enabled)try{const e=Rd();if(!e||!e.stage)return void s("‚ö†Ô∏è [GARDEN-FILTERS] PIXI app/stage not available");const t=new Set;for(const a of Fd.cropSpecies){const e=Id[a];e&&t.add(e)}const n=new Set(Fd.mutations),o=new Set(Fd.eggTypes),r=new Set(Fd.growthStates),i={visible:0,dimmed:0,withData:0,withoutData:0};if(Nd(e.stage,t,n,o,r,i),i.visible+i.dimmed>0){const e=[];t.size>0&&e.push(`${t.size} species`),n.size>0&&(e.push(`${n.size} mutations`),e.push(`${i.withData} mapped, ${i.withoutData} unmapped`)),r.size>0&&e.push(`${r.size} growth states`);const o=e.length>0?` (${e.join(", ")})`:"";s(`üîç [GARDEN-FILTERS] Applied${o}: ${i.visible} visible, ${i.dimmed} dimmed`)}else s("üîç [GARDEN-FILTERS] No tiles found")}catch(e){s("‚ö†Ô∏è [GARDEN-FILTERS] Error applying filters",e)}else Hd()}function Hd(){try{const e=Rd();if(!e||!e.stage)return;Bd(e.stage),s("üîç [GARDEN-FILTERS] All tiles visible")}catch(e){s("‚ö†Ô∏è [GARDEN-FILTERS] Error resetting filters",e)}}function jd(){try{g.set(Md,Fd),function(){for(const t of zd)try{t({...Fd})}catch(e){s("‚ö†Ô∏è Garden filters listener error",e)}}()}catch(e){s("‚ö†Ô∏è Failed to save garden filters config",e)}}function _d(){!function(){try{const e=g.get(Md,null);e&&"object"==typeof e&&(Fd={enabled:e.enabled??Fd.enabled,mutations:e.mutations??Fd.mutations,cropSpecies:e.cropSpecies??Fd.cropSpecies,eggTypes:e.eggTypes??Fd.eggTypes,growthStates:e.growthStates??Fd.growthStates})}catch(e){s("‚ö†Ô∏è Failed to load garden filters config",e)}}(),null===Ld&&(Ld=ie("garden-filters-poll",()=>{Fd.enabled&&Dd()},2e3),s("‚úÖ [GARDEN-FILTERS] Polling started (2s interval, visibility-aware)")),s("‚úÖ [GARDEN-FILTERS] System initialized",Fd)}function Od(){return{...Fd}}function Gd(e){Fd={...Fd,...e},jd(),Fd.enabled?Dd():Hd()}function Vd(){Dd()}function Wd(){Hd()}function Ud(){return Object.keys(Id)}function Xd(){try{const e=("undefined"!=typeof window&&window.__QPM_CATALOGS||{}).eggCatalog||{};return Object.keys(e)}catch(e){return s("‚ö†Ô∏è Failed to load egg types from catalog",e),[]}}const Qd=Object.freeze(Object.defineProperty({__proto__:null,applyGardenFiltersNow:Vd,getAllEggTypes:Xd,getAllPlantSpecies:Ud,getGardenFiltersConfig:Od,initializeGardenFilters:_d,resetGardenFiltersNow:Wd,updateGardenFiltersConfig:Gd},Symbol.toStringTag,{value:"Module"})),Jd={Starweaver:{hardCooldownHours:9.08,practicalMinimumHours:190,allowedHours:[0,1,2,4,11,12,13,14],correlationItems:[{itemName:"Sunflower",windowHours:1,probability:.235}]},Dawnbinder:{hardCooldownHours:24,practicalMinimumHours:220,allowedHours:[7,12,18,21,22]},Moonbinder:{hardCooldownHours:24,practicalMinimumHours:200,allowedHours:[0,6,7,8,16],correlationItems:[{itemName:"Sunflower",windowHours:1,probability:.8}]},Sunflower:{hardCooldownHours:0,practicalMinimumHours:3,allowedHours:null,burstBehavior:{windowHours:3,probability:.411}},"Mythical Eggs":{hardCooldownHours:.25,practicalMinimumHours:18,allowedHours:null,correlationItems:[{itemName:"Sunflower",windowHours:1,probability:.409}]}};function Kd(e,t,n){const o=n.filter(t=>t.items.some(t=>t.name===e)).map(e=>e.timestamp).sort((e,t)=>e-t);if(o.length<2)return null;const r=[];for(let g=1;g<o.length;g++)r.push(o[g]-o[g-1]);const i=r.reduce((e,t)=>e+t,0)/r.length,a=r.reduce((e,t)=>e+Math.pow(t-i,2),0)/r.length,s=Math.sqrt(a);var l;const c=t+((l=i)<100?10*Math.round(l/10):l<1e3?50*Math.round(l/50):l<1e4?100*Math.round(l/100):1e3*Math.round(l/1e3)),d=1.5*s,p=s/i;let u;return u=p<.3?"high":p<.6?"medium":"low",{estimatedTime:c,certaintyRange:{earliest:c-d,latest:c+d},confidence:u}}function Yd(e,t,n,o){const r=Jd[e];if(!r)return{itemName:e,nextWindows:[],tooEarly:!0,cooldownActive:!1,lastSeenTime:null,timeSinceLastSeen:null,hardCooldownRemaining:null,practicalMinimumRemaining:null};if(!t)return{itemName:e,nextWindows:[],tooEarly:!0,cooldownActive:!1,lastSeenTime:null,timeSinceLastSeen:null,hardCooldownRemaining:null,practicalMinimumRemaining:null,monitoringSchedule:{message:"No historical data - monitor optimal hours",optimalHours:r.allowedHours||Array.from({length:24},(e,t)=>t)}};const i=Date.now(),a=(i-t)/36e5,s=a<r.hardCooldownHours,l=s?r.hardCooldownHours-a:0,c=a<r.practicalMinimumHours,d=c?r.practicalMinimumHours-a:0,p=s||c?[]:function(e,t,n){const o=Jd[e];if(!o?.correlationItems)return[];const r=[];for(const i of o.correlationItems){const e=t.filter(e=>e.items.some(e=>e.name===i.itemName)).sort((e,t)=>t.timestamp-e.timestamp);if(e.length>0){const t=e[0],o=(n-t.timestamp)/36e5;o<=i.windowHours&&r.push({itemName:i.itemName,detectedAt:t.timestamp,probability:i.probability,message:`${i.itemName} detected ${o.toFixed(1)}h ago (${(100*i.probability).toFixed(0)}% correlation)`})}}return r}(e,n,i),u=function(e,t,n){const o=Jd[e];if(!o)return[];const r=[];if((n-t)/36e5<o.practicalMinimumHours)return[];if(!o.allowedHours){const e=n,t=n+864e5;return r.push({startTime:e,endTime:t,hour:new Date(e).getHours(),confidence:"medium",reason:"No time restrictions - can appear any hour"}),r}const i=new Date(n),a=i.getHours();for(let s=0;s<3;s++){for(const t of o.allowedHours){if(0===s&&t<=a)continue;const n=new Date(i);n.setDate(n.getDate()+s),n.setHours(t,0,0,0);const o=n.getTime(),l=o+36e5;let c="medium";if(("Starweaver"===e&&[0,1,2,12].includes(t)||"Dawnbinder"===e&&[7,12].includes(t)||"Moonbinder"===e&&[6,7,8].includes(t))&&(c="high"),r.push({startTime:o,endTime:l,hour:t,confidence:c,reason:`${t}:00 is an allowed window (${c} confidence)`}),r.length>=5)break}if(r.length>=5)break}return r}(e,t,i),g=Kd(e,t,o),m=r.allowedHours?{message:"Optimal monitoring hours (all times local)",optimalHours:r.allowedHours}:void 0;return{itemName:e,nextWindows:u,tooEarly:c,cooldownActive:s,lastSeenTime:t,timeSinceLastSeen:a,hardCooldownRemaining:l,practicalMinimumRemaining:d,statisticalPrediction:g||void 0,correlationSignals:p.length>0?p:void 0,monitoringSchedule:m}}function Zd(e){const t=new Date(e.startTime),n=new Date(e.endTime),o=t.toLocaleDateString(void 0,{month:"short",day:"numeric",year:t.getFullYear()!==(new Date).getFullYear()?"numeric":void 0}),r=t.toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit",hour12:!0}),i=n.toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit",hour12:!0});if(t.toDateString()===n.toDateString())return`${o}, ${r} - ${i}`;return`${o} ${r} - ${n.toLocaleDateString(void 0,{month:"short",day:"numeric"})} ${i}`}const ep="qpm.shopRestocks.v1",tp="qpm.shopRestockConfig.v1",np="qpm.shopRestocks.migration",op="qpm.shopRestocks.predictions.v1",rp="qpm.shopRestocks.activePredictions.v1",ip=["Mythical Eggs","Sunflower","Starweaver","Dawnbinder","Moonbinder"];let ap=null,sp="",lp=0;const cp=9e5;let dp=null,pp="",up=0,gp=null,mp="",fp=0,hp=null,bp="",yp=0;const xp={Starweaver:"celestial",Dawnbinder:"celestial",Moonbinder:"celestial",Sunflower:"divine",Lychee:"divine","Dragon Fruit":"divine","Passion Fruit":"divine",Lemon:"divine",Pepper:"divine","Cacao Bean":"divine","Mythical Eggs":"mythic",Grape:"mythic",Chrysanthemum:"mythic",Bamboo:"mythic",Cactus:"mythic",Mushroom:"mythic",Lily:"rare","Burro's Tail":"rare",Echeveria:"rare","Legendary Eggs":"rare","Rare Eggs":"rare",Watermelon:"uncommon",Pumpkin:"uncommon","Uncommon Eggs":"uncommon",Carrot:"common",Strawberry:"common",Aloe:"common",Delphinium:"common",Blueberry:"common",Apple:"common",Tulip:"common",Tomato:"common",Daffodil:"common",Corn:"common",Coconut:"common",Banana:"common",Camellia:"common",Squash:"common","Fava Bean":"common"};function vp(e){return xp[e]||"common"}let wp=[],Cp={importedFiles:[],watchedItems:[]},Tp=!0,Sp=0;let Pp=new Map,kp=new Map,Ap=[],Ep=!1;function $p(){if(Ep)s("üìä Restock tracker already initialized, skipping reload");else try{const e=g.get(ep,[]);wp=e,wp.length>1&&(wp.sort((e,t)=>e.timestamp-t.timestamp),Tp=!0);const t=g.get(tp,{importedFiles:[],watchedItems:[]});Cp=t;const n=g.get(op,{});Pp=new Map(Object.entries(n));const o=g.get(rp,{});kp=new Map(Object.entries(o)),s(`üìä Loaded ${kp.size} active predictions from storage`);const r=function(){if(g.get(np,0)>=1)return 0;if(0===wp.length)return g.set(np,1),0;s("üîÑ Migrating restock data to fix timezone interpretation...");const e=60*-(new Date).getTimezoneOffset()*1e3-36e6;let t=0;for(const n of wp)n.timestamp+=e,t++;return t>0&&(g.set(ep,wp),s(`‚úÖ Migrated ${t} restock events (adjusted by ${(e/36e5).toFixed(1)} hours)`)),g.set(np,1),t}();!function(){if(0===wp.length)return;let e=0;for(const t of ip){const n=Pp.get(t);if(n&&n.length>0)continue;const o=wp.filter(e=>e.items.some(e=>e.name===t)).sort((e,t)=>t.timestamp-e.timestamp).slice(0,3);if(o.length>0){const n=o.map(e=>({itemName:t,predictedTime:null,predictionMadeAt:null,actualTime:e.timestamp,differenceMinutes:null,differenceMs:null}));Pp.set(t,n),e+=o.length,s(`üìä Backfilled ${o.length} restock(s) for ${t}`)}}e>0&&(Bp(),s(`‚úÖ Backfilled ${e} total restock records into prediction history`))}(),Ep=!0,Dp(),r>0?(s(`üìä Loaded ${wp.length} restock events from storage (${r} migrated to correct timezone)`),setTimeout(()=>{$i({feature:"shop-restock-tracker",level:"success",message:`‚úÖ Updated ${r} restock times to correct timezone`})},2e3)):s(`üìä Loaded ${wp.length} restock events from storage`)}catch(e){s("‚ö†Ô∏è Failed to load restock data",e)}}function Mp(e=!1){try{const t=Date.now();if(e||t-Sp>15e3){const e=g.get(ep,[]),n=new Set(wp.map(e=>e.id));let o=0;for(const t of e)n.has(t.id)||(wp.push(t),n.add(t.id),o++,Tp=!1);o>0&&s(`dY", Merged ${o} events from storage (multi-tab sync)`),Sp=t}Tp||(wp.sort((e,t)=>e.timestamp-t.timestamp),Tp=!0),g.set(ep,wp),g.set(tp,Cp)}catch(t){s("?s??,? Failed to save restock data",t)}}function Ip(e){if(wp.some(t=>t.id===e.id))return void s("?s??,? Duplicate restock event skipped");const t=wp[wp.length-1]?.timestamp??null;wp.push(e),null!=t&&e.timestamp<t&&(Tp=!1),s(`?o. Saved restock event (${e.source}): Total ${wp.length} events`),function(e){for(const t of e.items){if(!ip.includes(t.name))continue;const n=kp.get(t.name),o={itemName:t.name,predictedTime:n||null,predictionMadeAt:n?Date.now():null,actualTime:e.timestamp,differenceMinutes:n?Math.round((e.timestamp-n)/6e4):null,differenceMs:n?e.timestamp-n:null};let r=Pp.get(t.name)||[];r.unshift(o),r.length>3&&(r=r.slice(0,3)),Pp.set(t.name,r),n?(kp.delete(t.name),Hp(),s(`üìä Prediction accuracy for ${t.name}: ${o.differenceMinutes>0?`${o.differenceMinutes} min late`:`${Math.abs(o.differenceMinutes)} min early`}`)):s(`üìä Recorded restock for ${t.name} (no active prediction)`)}Bp(),Dp()}(e),Mp(),Gp()}function Fp(){return[...wp]}function zp(){const e=wp.length>0?`${wp.length}-${wp[0]?.timestamp??0}-${wp[wp.length-1]?.timestamp??0}`:"",t=Date.now();if(dp&&pp===e&&t-up<cp)return new Map(dp);const n=new Map,o=wp.length;if(0===o)return n;for(const r of wp)for(const e of r.items){const t=n.get(e.name);t?(t.totalRestocks++,t.totalQuantity+=e.quantity,t.lastSeen=Math.max(t.lastSeen,r.timestamp),t.firstSeen=Math.min(t.firstSeen,r.timestamp)):n.set(e.name,{name:e.name,type:e.type,totalRestocks:1,totalQuantity:e.quantity,avgQuantity:0,lastSeen:r.timestamp,firstSeen:r.timestamp,appearanceRate:0,rarity:vp(e.name)})}for(const r of n.values())r.avgQuantity=r.totalQuantity/r.totalRestocks,r.appearanceRate=r.totalRestocks/o*100,r.rarity=vp(r.name);return dp=n,pp=e,up=t,new Map(n)}function Lp(){if(0===wp.length)return{totalRestocks:0,totalItems:0,dateRange:null,avgRestockInterval:0,uniqueItems:0};const e=wp.reduce((e,t)=>e+t.items.length,0),t=wp.map(e=>e.timestamp).sort((e,t)=>e-t),n={start:t[0],end:t[t.length-1]};let o=0;for(let a=1;a<t.length;a++){const e=t[a],n=t[a-1];void 0!==e&&void 0!==n&&(o+=e-n)}const r=t.length>1?o/(t.length-1)/1e3/60:0,i=new Set(wp.flatMap(e=>e.items.map(e=>e.name))).size;return{totalRestocks:wp.length,totalItems:e,dateRange:t.length>0?n:null,avgRestockInterval:r,uniqueItems:i}}function Rp(e,t){if(0===e.length)return 0;const n=[...e].sort((e,t)=>e-t),o=t/100*(n.length-1),r=Math.floor(o),i=Math.ceil(o),a=o-r;return n[r]*(1-a)+n[i]*a}function qp(e){return function(){const e=wp.length>0?`${wp.length}-${wp[0]?.timestamp??0}-${wp[wp.length-1]?.timestamp??0}`:"",t=Date.now();if(ap&&sp===e&&t-lp<cp)return;ap=new Map,sp=e,lp=t;const n=new Map;for(const o of wp)for(const e of o.items){let t=n.get(e.name);t||(t=[],n.set(e.name,t)),t.push(o.timestamp)}for(const[o,r]of n.entries()){if(r.sort((e,t)=>e-t),r.length<2){ap.set(o,[]);continue}let e;e="Starweaver"===o||"Dawnbinder"===o||"Moonbinder"===o?432e6:"Sunflower"===o||"Mythical Eggs"===o?432e5:18e5;const t=[r[0]];for(let o=1;o<r.length;o++)r[o]-r[o-1]>e&&t.push(r[o]);const n=[];for(let o=1;o<t.length;o++)n.push(t[o]-t[o-1]);ap.set(o,n)}}(),ap?.get(e)??[]}function Np(e){if(wp.length<2)return null;const t=zp().get(e);if(!t||0===t.appearanceRate)return null;const n=qp(e);if(0===n.length){const e=60*Lp().avgRestockInterval*1e3;if(0===e)return null;const n=1/(t.appearanceRate/100);let o=t.lastSeen+e*n;const r=Date.now();if(o<r){const t=r-o;o+=e*n*Math.ceil(t/(e*n))}return o}const o=Rp(n,50),r=n.reduce((e,t)=>e+t,0)/n.length;n.reduce((e,t)=>e+Math.pow(t-r,2),0),n.length;let i=o;i=Rp(n,"Sunflower"===e?55:"Mythical Eggs"===e?65:"Starweaver"===e||"Dawnbinder"===e||"Moonbinder"===e?80:65);let a=t.lastSeen+i;const s=Date.now();if(a<s){const e=s-t.lastSeen,n=Math.ceil(e/i);a=t.lastSeen+i*n}return a}function Bp(){try{const e={};Pp.forEach((t,n)=>{e[n]=t}),g.set(op,e)}catch(e){s("‚ö†Ô∏è Failed to save prediction history",e)}}function Dp(){const e=Date.now();for(const t of ip){if(kp.has(t))continue;const n=Np(t);n&&n>e&&(kp.set(t,n),s(`üìä Generated prediction for ${t}: ${new Date(n).toLocaleString()}`))}Hp()}function Hp(){try{const e={};kp.forEach((t,n)=>{e[n]=t}),g.set(rp,e)}catch(e){s("‚ö†Ô∏è Failed to save active predictions",e)}}function jp(e){return Pp.get(e)||[]}function _p(){wp=[],Tp=!0,Sp=Date.now(),Cp.importedFiles=[],Cp.watchedItems=[],Pp.clear(),kp.clear(),ap=null,sp="",lp=0,dp=null,pp="",up=0,gp=null,mp="",fp=0,hp=null,bp="",yp=0,g.set(ep,[]),g.set(tp,{importedFiles:[],watchedItems:[]}),g.set(np,0),g.set(op,{}),g.set(rp,{}),Gp(),s("üìä Cleared shop restock history and prediction data")}function Op(e){return Ap.push(e),()=>{Ap=Ap.filter(t=>t!==e)}}function Gp(){Ap.forEach(e=>{try{e()}catch(t){s("‚ö†Ô∏è Restock callback error",t)}})}function Vp(){const e=wp.length>0?`${wp.length}-${wp[wp.length-1]?.timestamp??0}`:"empty",t=Date.now(),n=t-fp;let o=!1;if(gp&&gp.size>0){let e=!1;for(const n of gp.values()){if(n.nextWindows.some(e=>e.endTime>=t)||n.cooldownActive||n.tooEarly){e=!0;break}}o=!e}if(gp&&mp===e&&n<cp&&!o)return new Map(gp);const r=new Map;for(const i of ip){const e=zp().get(i),n=t-6048e5,o=Yd(i,e?.lastSeen??null,wp.filter(e=>e.timestamp>=n),wp);r.set(i,o)}return gp=r,mp=e,fp=t,new Map(r)}function Wp(){const e=Date.now(),t=Math.floor(e/36e5),n=mp+`-${t}`;if(hp&&bp===n&&e-yp<cp)return[...hp];const o=function(e){const t=[],n=Date.now();new Date(n).getHours();for(const[o,r]of e.entries()){if(r.tooEarly||r.cooldownActive)continue;const e=r.nextWindows.find(e=>n>=e.startTime&&n<=e.endTime);e&&t.push({itemName:o,message:`ACTIVE WINDOW: ${o} possible now (${e.confidence} confidence)`,urgency:"high"===e.confidence?"high":"medium"});const i=r.nextWindows.find(e=>{const t=(e.startTime-n)/6e4;return t>0&&t<=30});if(i){const e=Math.round((i.startTime-n)/6e4);t.push({itemName:o,message:`UPCOMING: ${o} window in ${e} minutes (${i.confidence} confidence)`,urgency:"medium"})}if(r.correlationSignals)for(const n of r.correlationSignals)n.probability>=.5&&t.push({itemName:o,message:`CORRELATION: ${n.message}`,urgency:n.probability>=.8?"high":"medium"})}return t.sort((e,t)=>{const n={high:0,medium:1,low:2};return n[e.urgency]-n[t.urgency]})}(Vp());return hp=o,bp=n,yp=e,[...o]}const Up=["seeds","eggs","tools","decor"],Xp={seeds:"seed",eggs:"egg",tools:"tool",decor:"decor"},Qp=new Set;let Jp=null,Kp=null,Yp=function(){const e=Object.create(null),t=Date.now();for(const n of Up)e[n]={category:n,secondsUntilRestock:null,nextRestockAt:null,restockIntervalMs:null,items:[],availableCount:0,signature:"",updatedAt:t,raw:null};return{updatedAt:t,categories:e}}(),Zp=null,eu=null,tu=null;function nu(e){const t=function(e){if("number"==typeof e&&Number.isFinite(e))return e;if("string"==typeof e){const t=e.match(/-?\d+(?:\.\d+)?/);if(t){const e=Number(t[0]);if(Number.isFinite(e))return e}}return null}(e);if(null==t)return null;const n=Math.round(t);return n>0?n:null}function ou(e,t,n,o){if(!t||"object"!=typeof t)return null;const r=function(e,t){switch(e){case"seeds":return null!=t.species?String(t.species):null!=t.id?String(t.id):null;case"eggs":return null!=t.eggId?String(t.eggId):null!=t.id?String(t.id):null;case"tools":return null!=t.toolId?String(t.toolId):null!=t.id?String(t.id):null;case"decor":return null!=t.decorId?String(t.decorId):null!=t.id?String(t.id):null;default:return null!=t.id?String(t.id):null}}(e,t);if(!r)return null;const i=function(e){const t=e.name??e.displayName??e.species??e.petSpecies??e.toolId??e.decorId??e.eggId??e.id??"Item";return String(t).trim()}(t),a=function(e){const t=[e.initialStock,e.stock,e.availableStock,e.quantity,e.count,e.amount];for(const n of t){const e=nu(n);if(null!=e)return e}return 0===e.initialStock?0:null}(t),s=nu(t.stock??t.availableStock??t.remaining),l=function(e){const t=[e.quantityPerPurchase,e.bundleSize,e.quantityPerClick,e.quantity];for(const n of t){const e=nu(n);if(null!=e)return e}return 1}(t),{coins:c,credits:d}=function(e){const t=[e.priceCoins,e.coins,e.price,e.cost],n=[e.priceCredits,e.credits,e.creditCost];let o=null,r=null;for(const i of t){const e=nu(i);if(null!=e){o=e;break}}for(const i of n){const e=nu(i);if(null!=e){r=e;break}}return{coins:o,credits:r}}(t),p=!1!==t.canSpawnHere,u=function(e,t,n){const o=Xp[e],r=n?.[o]?.purchases;if(!r||"object"!=typeof r)return 0;const i=r[t];if(null!=i&&Number.isFinite(Number(i)))return Number(i);const a=Number(t);return Number.isFinite(a)&&null!=r[a]&&Number.isFinite(Number(r[a]))?Number(r[a]):0}(e,String(r),n);let g=function(e,t,n){if(null==e)return n?null:0;const o=Number.isFinite(t)?Math.max(0,Math.round(t)):0,r=Math.max(0,e-o);return n?r:0}(a,u,p);null!=s&&(g=s);let m=!1;return m=!!p&&(null!=s?s>0:null==g||g>0),{category:e,id:String(r),label:i,orderIndex:o,initialStock:a,currentStock:s,remaining:g,purchased:u,canSpawn:p,isAvailable:m,priceCoins:c,priceCredits:d,quantityPerPurchase:l,raw:t}}function ru(e,t,n){const o=Date.now(),r=Array.isArray(t?.inventory)?t.inventory:[],i=[];r.forEach((t,o)=>{const r=ou(e,t,n,o);r&&i.push(r)});const a=i.filter(e=>e.isAvailable).length,s=i.map(e=>`${e.id}:${e.remaining??"x"}:${e.currentStock??"x"}:${e.purchased}`).join("|"),l="number"==typeof t?.secondsUntilRestock?t.secondsUntilRestock:null,c="number"==typeof t?.nextRestockAt?t.nextRestockAt:null,d="number"==typeof t?.restockIntervalMs?t.restockIntervalMs:null;return{category:e,secondsUntilRestock:l,nextRestockAt:c,restockIntervalMs:d,items:i,availableCount:a,signature:s,updatedAt:o,raw:t??null}}function iu(){const e=Date.now(),t=Object.create(null);for(const n of Up){const e=Xp[n],o=Jp?.[e]??null;t[n]=ru(n,o,Kp)}Yp={updatedAt:e,categories:t},function(){for(const t of Qp)try{t(Yp)}catch(e){s("‚ö†Ô∏è ShopStock listener error",e)}}()}let au=null,su=null,lu=!1,cu=!0,du="",pu=0;const uu=["Carrot","Strawberry","Aloe","Delphinium","Blueberry","Apple","Tulip","Tomato","Daffodil","Corn","Watermelon","Pumpkin","Echeveria","Coconut","Banana","Lily","Camellia","Squash","Burro's Tail","Mushroom","Cactus","Bamboo","Chrysanthemum","Grape","Pepper","Lemon","Passion Fruit","Dragon Fruit","Lychee","Sunflower","Starweaver","Dawnbinder","Moonbinder","Starweaver Pod","Dawnbinder Pod","Moonbinder Pod","Uncommon Eggs","Uncommon Egg","Rare Eggs","Rare Egg","Mythical Eggs","Mythical Egg","Legendary Eggs","Legendary Egg"],gu=[/!!!/,/omg/i,/ping/i,/spam/i,/^\d+/,/\d+\s+[A-Z]/,/stock!!!/i,/vegetables/i,/named/i];function mu(e){return!!function(e){return!(gu.some(t=>t.test(e))||e.length>50)}(e)&&uu.some(t=>e.includes(t))}function fu(e){return e.includes("Eggs")||e.includes("Egg")||e.includes("egg")?"egg":uu.some(t=>e.includes(t))?"seed":"unknown"}function hu(e,t){const n=t.map(e=>`${e.name}:${e.quantity}`).join(",");return`${e}-${btoa(n).substring(0,8)}`}async function bu(){if(cu)if(lu)s("‚ö†Ô∏è Shop tracking already active");else try{s("üìä Starting live shop restock tracking..."),await async function(){return Zp||(Zp=(async()=>{try{Jp=await te("shops")}catch(e){s("‚ö†Ô∏è Failed to read shops atom initially",e),Jp=null}try{Kp=await te("shopPurchases")}catch(e){s("‚ö†Ô∏è Failed to read shop purchases atom initially",e),Kp=null}iu();try{eu=await ne("shops",e=>{Jp=e,iu()})}catch(e){s("‚ö†Ô∏è Failed to subscribe to shops atom",e)}try{tu=await ne("shopPurchases",e=>{Kp=e,iu()})}catch(e){s("‚ö†Ô∏è Failed to subscribe to shop purchases atom",e)}})().catch(e=>{s("‚ö†Ô∏è startShopStockStore error",e),Zp=null}),Zp)}().catch(e=>{s("‚ö†Ô∏è Failed to start shop stock store",e)});const e=function(e,t=!0){if(Qp.add(e),t)try{e(Yp)}catch(n){s("‚ö†Ô∏è ShopStock immediate listener error",n)}return()=>{Qp.delete(e)}}(e=>{try{const t=Object.values(e.categories||{}).map(e=>e.signature).join("|"),n=Date.now();if(t&&t===du&&n-pu<1200)return;if(n-pu<600)return;du=t,pu=n;const o=function(e){const t=new Map;try{for(const[n,o]of Object.entries(e.categories))if(o&&o.items)for(const e of o.items){const n=e.label||e.id,o=e.initialStock||e.currentStock||e.remaining||0;n&&mu(n)&&o>0&&t.set(n,o)}}catch(n){s("‚ö†Ô∏è Failed to extract shop inventory:",n)}return t}(e),r=function(e,t){const n=[];if(!t)return n;for(const[o,r]of e.entries())r>(t.get(o)||0)&&n.push({name:o,quantity:r,type:fu(o)});return n}(o,su);if(r.length>0){s(`üè™ RESTOCK DETECTED! Items: ${r.map(e=>`${e.name} (${e.quantity})`).join(", ")}`);const e=Date.now();Ip({id:hu(e,r),timestamp:e,dateString:new Date(e).toLocaleString(),items:r,source:"live"})}su=o}catch(t){s("‚ö†Ô∏è Error processing shop update:",t)}},!1);au=e,lu=!0,s("‚úÖ Live shop tracking active")}catch(e){s("‚ùå Failed to start live shop tracking:",e)}else s("‚ö†Ô∏è Live tracking is disabled")}function yu(){cu=!1,lu&&(au&&(au(),au=null),lu=!1,su=null,du="",pu=0,s("üõë Live shop tracking stopped")),du="",pu=0}function xu(){return cu}const vu="3.0.57",wu="https://raw.githubusercontent.com/ryandt2305-cpu/QPM-GR/master/dist/QPM.user.js",Cu=async e=>{const t=(()=>{const e=globalThis;return e.GM_xmlhttpRequest||e.GM?.xmlHttpRequest})();if(t)return new Promise((n,o)=>{t({method:"GET",url:e,headers:{"Cache-Control":"no-cache"},onload:e=>{e.status>=200&&e.status<300?n(e.responseText):o(new Error(`GM request failed with status ${e.status}`))},onerror:e=>o(e)})});const n=await fetch(e,{cache:"no-cache"});if(!n.ok)throw new Error(`HTTP ${n.status}`);return n.text()};let Tu={current:vu,latest:null,status:"checking",updateUrl:wu,checkedAt:null};const Su=new Set;let Pu=!1;function ku(){Su.forEach(e=>{try{e(Tu)}catch(t){console.error("[QPM] Version listener error",t)}})}function Au(){return{...Tu}}function Eu(){Pu||(Pu=!0,$u(!0),re("version-checker",()=>{$u(!1)},18e5))}async function $u(e=!1){Tu={...Tu,status:"checking"},ku();const t=await async function(){try{const e=await Cu(wu),t=e.match(/@version\s+([0-9]+(?:\.[0-9]+)*)/);if(t?.[1])return t[1];const n=e.match(/const\s+CURRENT_VERSION\s*=\s*['"]([0-9.]+)['"]/);if(n?.[1])return n[1]}catch(e){console.error("[QPM] Version fetch failed",e)}return null}(),n=Date.now();if(!t)return Tu={...Tu,latest:Tu.latest,status:"error",checkedAt:n},ku(),Au();const o=function(e,t){const n=e=>e.split(".").map(e=>Number.parseInt(e,10)||0),o=n(e),r=n(t),i=Math.max(o.length,r.length);for(let a=0;a<i;a+=1){const e=o[a]??0,t=r[a]??0;if(e>t)return 1;if(e<t)return-1}return 0}(t,vu);return Tu={current:vu,latest:t,status:o>0?"outdated":"current",updateUrl:wu,checkedAt:n},ku(),Au()}function Mu(e,t){const n=String(e||"").trim().toLowerCase();if(!n)return"";const o=Fi(Ji(n,t));return o||Fi(Qi(n))}let Iu={panel:null,content:null,status:null,toggle:null,weatherStatus:null,shopStatus:null,shopItemToggles:null,mutationStatus:null,headerContainer:null,headerWeather:null,headerMeta:null,headerTimer:null,dashboardRestockSummary:null,dashboardRestockValues:{seeds:null,eggs:null,tools:null,decor:null},turtleStatus:null,turtleDetail:null,turtleFooter:null,turtleEnableButtons:[],turtleFocusSelects:[],turtleFocusTargetSelects:[],turtleFocusTargetContainers:[],turtleEggFocusSelects:[],turtleEggFocusTargetSelects:[],turtleEggFocusTargetContainers:[],turtlePlantSummary:null,turtlePlantEta:null,turtlePlantTable:null,turtlePlantTotals:null,turtlePlantSimple:null,turtlePlantLuck:null,turtleEggSummary:null,turtleEggEta:null,turtleEggTable:null,turtleEggTotals:null,turtleEggSimple:null,turtleEggLuck:null,turtleSupportSummary:null,turtleSupportTotals:null,turtleSupportSimple:null,turtleSupportList:null,trackerAbilitySummary:null,trackerAbilityFilterSelect:null,trackerAbilityTable:null,trackerAbilityUnknown:null,trackerXpSummary:null,trackerXpAbilityTable:null,trackerXpPerPetTable:null,trackerXpTargetModeSelect:null,trackerXpTargetPetSelect:null,mutationTrackerCard:null,mutationTrackerSummary:null,mutationTrackerTotals:null,mutationTrackerRatios:null,mutationTrackerCountdown:null,mutationTrackerDetail:null,mutationTrackerTable:null,mutationTrackerSourceSelect:null,mutationTrackerDetailToggle:null,mutationTrackerSourceBadge:null,mutationTrackerEmpty:null,trackerAbilityHistoryUnsubscribe:null,trackerAbilityTicker:null,xpTrackerWindow:null,shopRestockWindow:null,mutationTrackerUnsubscribe:null,mutationTrackerTicker:null,turtleUnsubscribe:null,notificationsSection:null,notificationsListWrapper:null,notificationsList:null,notificationsFilterBar:null,notificationsEmpty:null,notificationsUnsubscribe:null,notificationsDetail:null,notificationsDetailHeader:null,notificationsDetailTitle:null,notificationsDetailTimestamp:null,notificationsDetailMeta:null,notificationsDetailMessage:null,notificationsDetailActions:null,notificationsDetailRaw:null,notificationsDetailPlaceholder:null,notificationsDetailToggle:null},Fu=null;const zu={info:"#64b5f6",success:"var(--qpm-accent)",warn:"#ffb74d",error:"#ef5350"},Lu={info:"‚ÑπÔ∏è",success:"‚úÖ",warn:"‚ö†Ô∏è",error:"‚õî"},Ru="quinoa-ui-panel-position",qu="quinoa-ui-panel-collapsed",Nu="quinoa-ui-notifications-collapsed",Bu="quinoa-ui-notifications-detail-expanded",Du="qpm-toast-style",Hu=new Set;let ju=[],_u=null;const Ou=new Map,Gu=new Map;let Vu=null,Wu=g.get(Nu,!1)??!1,Uu=g.get(Bu,!1)??!1,Xu=0;const Qu={plant:5,egg:10};function Ju(e){if(!e)return{tileId:null,slotIndex:null};const[t,n]=e.split("::"),o=Number.parseInt(n??"",10);return t&&Number.isFinite(o)?{tileId:t,slotIndex:o}:{tileId:null,slotIndex:null}}function Ku(e){if(null==e||!Number.isFinite(e))return"‚Äî";if(e<=0)return"Ready";const t=Math.round(e/1e3);if(t<60)return`${t}s`;const n=Math.floor(t/60),o=t%60;if(n<60)return o>0?`${n}m ${o}s`:`${n}m`;const r=Math.floor(n/60),i=n%60;return i>0?`${r}h ${i.toString().padStart(2,"0")}m`:`${r}h`}function Yu(e){return null!=e&&Number.isFinite(e)?`${e.toFixed(2)}√ó`:"1.00√ó"}function Zu(e){return null!=e&&Number.isFinite(e)?`${Math.round(e)}%`:"‚Äî"}function eg(e,t=0){return null!=e&&Number.isFinite(e)?`${e.toFixed(t)}%`:"0%"}function tg(e,t=1){if(null==e||!Number.isFinite(e)||e<=0)return"0.0 feeds/hr";return`${(e/100).toFixed(t)} feeds/hr`}function ng(e){if(null==e||!Number.isFinite(e))return"‚Äî";if(e<1){return`${Math.max(1,Math.round(60*e))}s`}if(e>=60){const t=Math.floor(e/60),n=Math.round(e%60);return n>0?`${t}h ${n}m`:`${t}h`}return`${Math.round(e)}m`}function og(e,t,n,o){const r=document.createElement("span");return r.style.cssText="cursor:pointer;text-decoration:underline dotted;",r.title=`Click to manually set ${t} value (leave empty to clear)`,r.textContent=o(n),r.addEventListener("click",o=>{o.stopPropagation();const i=document.createElement("input");i.type="number",i.style.cssText="width:60px;font-size:9px;padding:2px;border:1px solid #4CAF50;background:#1a1a1a;color:#fff;",i.value=null!=n?String(n):"",i.placeholder="xp"===t?"XP":"Scale",i.step="targetScale"===t?"0.01":"1";const a=()=>{const n=i.value.trim(),o={species:e.species,slotIndex:e.slotIndex,petId:e.petId??null};if(""===n)!function(e,t){const n=_r(e);Hr[n]&&(t?(delete Hr[n][t],0===Object.keys(Hr[n]).length&&delete Hr[n]):delete Hr[n],jr(),Ci())}(o,t);else{const e=Number(n);Number.isFinite(e)&&e>=0&&function(e,t){const n=_r(e);Hr[n]||(Hr[n]={}),Object.assign(Hr[n],t),jr(),Ci()}(o,{[t]:e})}i.remove(),r.style.display=""};i.addEventListener("blur",()=>setTimeout(a,100)),i.addEventListener("keydown",e=>{"Enter"===e.key?(e.preventDefault(),a()):"Escape"===e.key&&(r.style.display="",i.remove())}),r.style.display="none",r.parentElement?.insertBefore(i,r.nextSibling),i.focus(),i.select()}),r}function rg(e){if(null==e||!Number.isFinite(e)||0===e)return"0m per hour";const t=e>=0?"-":"+",n=Math.abs(e),o=Math.max(0,Math.round(n)),r=Math.floor(o/60),i=o%60,a=[];return r>0&&a.push(`${r}hr`),(i>0||0===a.length)&&a.push(`${i}m`),`${t}${a.join(" ")} per hour`}const ig=e=>{if("number"==typeof e&&Number.isFinite(e))return e;if("string"==typeof e){const t=e.replace(/[^0-9.+-]/g,"");if(!t)return null;const n=Number(t);return Number.isFinite(n)?n:null}return null},ag=(e,...t)=>{if(!e||"object"!=typeof e)return null;const n=e;for(const o of t){if(!(o in n))continue;const e=ig(n[o]);if(null!=e)return e}return null},sg=(e,t)=>{const n=[];return e.petId&&n.push(e.petId),e.slotId&&n.push(e.slotId),"number"==typeof e.slotIndex&&Number.isFinite(e.slotIndex)&&n.push(String(Math.max(0,Math.round(e.slotIndex)))),$l(t,{petId:e.petId,slotId:e.slotId,slotIndex:"number"==typeof e.slotIndex&&Number.isFinite(e.slotIndex)?e.slotIndex:null,fallbackKeys:n})},lg=e=>{const t=Date.now()-144e5;return e.events.filter(e=>e.performedAt>=t)},cg=(e,t)=>{const n=t.data;switch(e.category){case"xp":return ag(n,"bonusXp","xp","value");case"plantGrowth":return ag(n,"plantGrowthReductionMinutes","reductionMinutes","minutes");case"eggGrowth":return ag(n,"eggGrowthTimeReductionMinutes","reductionMinutes","minutes");case"coins":return ag(n,"coinsFound","coins","coinsEarned","sellPrice","bonusCoins","value","valueEarned","coinsValue");default:return null}},dg=(e,t)=>{const n=lg(e);if(!n.length)return null;const o=n[n.length-1],r=n[0];let i=null;if(n.length>=2){const e=o.performedAt-r.performedAt;e>0&&(i=(n.length-1)/(e/36e5))}const a=[];for(const s of n){const e=cg(t,s);null!=e&&Number.isFinite(e)&&a.push(e)}return{procsPerHour:i,effectPerProc:a.length?a.reduce((e,t)=>e+t,0)/a.length:null,lastProcAt:o.performedAt,sampleCount:n.length}};function pg(e){return e.name&&e.name.trim().length>0?e.name:e.species&&e.species.trim().length>0?e.species:"number"==typeof e.slotIndex&&Number.isFinite(e.slotIndex)?`Pet ${e.slotIndex+1}`:"Unknown pet"}function ug(){const e=yg.turtleTimer??{},t={enabled:e.enabled??!0,includeBoardwalk:e.includeBoardwalk??!1,focus:"earliest"===e.focus||"specific"===e.focus?e.focus:"latest",focusTargetTileId:"string"==typeof e.focusTargetTileId?e.focusTargetTileId:null,focusTargetSlotIndex:"number"==typeof e.focusTargetSlotIndex&&Number.isFinite(e.focusTargetSlotIndex)?Math.max(0,Math.round(e.focusTargetSlotIndex)):null,eggFocus:"earliest"===e.eggFocus||"specific"===e.eggFocus?e.eggFocus:"latest",eggFocusTargetTileId:"string"==typeof e.eggFocusTargetTileId?e.eggFocusTargetTileId:null,eggFocusTargetSlotIndex:"number"==typeof e.eggFocusTargetSlotIndex&&Number.isFinite(e.eggFocusTargetSlotIndex)?Math.max(0,Math.round(e.eggFocusTargetSlotIndex)):null};return yg.turtleTimer=t,t}function gg(e){if(null==e||!Number.isFinite(e))return"";const t=new Date(Date.now()+e),n=t.getHours(),o=n>=12?"PM":"AM";return` ‚Ä¢ ${n%12||12}:${t.getMinutes().toString().padStart(2,"0")} ${o}`}function mg(e){if("estimating"!==e.status||null==e.naturalMsRemaining||null==e.adjustedMsRemaining||!Number.isFinite(e.adjustedMsRemaining))return{luckyMs:null,unluckyMs:null,stdMinutes:null};const t=Math.max(0,e.adjustedMsRemaining/6e4),n=Math.max(1,t);let o=0;for(const i of e.contributions){const e=i.ability,t=Qu[e];if(!Number.isFinite(t))continue;const r=t*(i.baseScore/100);if(!Number.isFinite(r)||r<=0)continue;const a=i.rateContribution;if(!Number.isFinite(a)||a<=0)continue;const s=Math.min(.99,Math.max(0,a/Math.max(r,1e-4)));if(s<=0)continue;o+=n*s*(1-s)*r*r}if(o<=0)return{luckyMs:e.adjustedMsRemaining,unluckyMs:e.adjustedMsRemaining,stdMinutes:0};const r=Math.sqrt(o);return{luckyMs:6e4*Math.max(0,t-r),unluckyMs:6e4*(t+r),stdMinutes:r}}function fg(e){const t=e.plant,n=e.egg,o=e.support,r=t.contributions.reduce((e,t)=>e+(t.perHourReduction??0),0),i=null!=t.naturalMsRemaining?t.naturalMsRemaining/6e4:null;null!=t.adjustedMsRemaining&&t.adjustedMsRemaining;const a=t.minutesSaved??null,s=mg(t),l=n.contributions.reduce((e,t)=>e+(t.perHourReduction??0),0),c=null!=n.naturalMsRemaining?n.naturalMsRemaining/6e4:null;null!=n.adjustedMsRemaining&&n.adjustedMsRemaining;const d=n.minutesSaved??null,p=mg(n),u=o.restorePctActive;o.restorePctTotal;const g=o.restorePctPerHourActive,m=o.restorePctPerHourTotal,f=o.restoreTriggersPerHourActive;o.restoreTriggersPerHourTotal;const h=o.slowPctActive,b=o.slowPctTotal,y=e=>{const t=document.createElement("div");return t.textContent=e,t.style.cssText="font-size:10px;color:#90a4ae;font-style:italic;",t},x=Iu.turtleEnableButtons;0===x.length&&(Iu.turtleEnableButtons=x);for(const J of x)J&&(e.enabled?(J.textContent="Enabled",J.style.background="rgba(56, 142, 60, 0.28)",J.style.borderColor="rgba(56, 142, 60, 0.55)",J.style.color="#e8f5e9"):(J.textContent="Disabled",J.style.background="rgba(158, 158, 158, 0.22)",J.style.borderColor="rgba(158, 158, 158, 0.35)",J.style.color="#eceff1"));for(const J of Iu.turtleFocusSelects)J&&J.value!==e.focus&&(J.value=e.focus);for(const J of Iu.turtleEggFocusSelects)J&&J.value!==e.eggFocus&&(J.value=e.eggFocus);const v=e.focusTargetKey,w=e.plantTargets??[],C="specific"===e.focus,T=w.length>0;Iu.turtleFocusTargetSelects.forEach((t,n)=>{if(!t)return;const o=Iu.turtleFocusTargetContainers[n];o&&(o.style.display=C?"inline-flex":"none");const r=Array.from(t.options).map(e=>e.value),i=w.map(e=>e.key);if(r.length!==i.length+1||r.slice(1).some((e,t)=>e!==i[t])){t.textContent="";const e=document.createElement("option");e.value="",e.textContent=w.length?"Pick a plant...":"No plants detected yet",e.disabled=w.length>0,e.hidden=w.length>0,t.appendChild(e);for(const n of w){const e=document.createElement("option");e.value=n.key;const o=n.species??"Unknown plant",r=null!=n.remainingMs?Ku(n.remainingMs):"Ready",i=n.boardwalk?" (boardwalk)":"";e.textContent=`${o} - ${r}${i}`,t.appendChild(e)}}const a=C&&e.focusTargetAvailable&&v?v:"";t.value!==a&&(t.value=a),t.disabled=!C||0===w.length});const S=e.eggFocusTargetKey,P=e.eggTargets??[],k="specific"===e.eggFocus,A=P.length>0;Iu.turtleEggFocusTargetSelects.forEach((t,n)=>{if(!t)return;const o=Iu.turtleEggFocusTargetContainers[n];o&&(o.style.display=k?"inline-flex":"none");const r=Array.from(t.options).map(e=>e.value),i=P.map(e=>e.key);if(r.length!==i.length+1||r.slice(1).some((e,t)=>e!==i[t])){t.textContent="";const e=document.createElement("option");e.value="",e.textContent=P.length?"Pick an egg...":"No eggs detected yet",e.disabled=P.length>0,e.hidden=P.length>0,t.appendChild(e);for(const n of P){const e=document.createElement("option");e.value=n.key;const o=n.species??"Unknown egg",r=null!=n.remainingMs?Ku(n.remainingMs):"Ready",i=n.boardwalk?" (boardwalk)":"";e.textContent=`${o} - ${r}${i}`,t.appendChild(e)}}const a=k&&e.eggFocusTargetAvailable&&S?S:"";t.value!==a&&(t.value=a),t.disabled=!k||0===P.length});const E=[];e.hungerFilteredCount>0&&E.push(`${e.hungerFilteredCount} need feeding`),e.turtlesMissingStats>0&&E.push(`${e.turtlesMissingStats} missing stats`),e.includeBoardwalk;const $=Iu.turtleStatus,M=Iu.turtleDetail,I=Iu.turtleFooter,F=(e,t,n,o=!1)=>{$&&($.textContent=e),M&&(o?M.innerHTML=t:M.textContent=t),I&&(I.textContent=n)},z=Iu.turtlePlantNameText;if(e.enabled)if("no-data"===t.status)z&&(z.textContent="Waiting..."),F("Waiting for garden data‚Ä¶","Move camera or interact with garden","");else if("no-crops"===t.status)z&&(z.textContent="No Crops"),F("No crops growing","Plant seeds to start tracking","");else if("no-turtles"===t.status){const e=t.focusSlot?.species||"Crop";z&&(z.textContent=e);F(`${e} ‚Ä¢ ${t.naturalMsRemaining?Ku(t.naturalMsRemaining):"‚Äî"}`,`No plant boost ‚Ä¢ ${`${t.growingSlots}/${t.trackedSlots} crops`}`,"")}else if("estimating"===t.status){const e=t.focusSlot?.species||"Crop";z&&(z.textContent=e);const r=Ku(t.adjustedMsRemaining),i=gg(t.adjustedMsRemaining),a=Yu(t.effectiveRate),s=mg(t),l=null!=s.unluckyMs?Ku(s.unluckyMs):"",c=[];if(t.contributions.length>0&&c.push(`üå± ${a} plant`),n.contributions.length>0&&"estimating"===n.status&&null!=n.effectiveRate){const e=Yu(n.effectiveRate);c.push(`ü•ö ${e} egg`)}else n.contributions.length>0&&c.push(`ü•ö ${n.contributions.length} egg`);const d=o.restoreCount+o.slowCount;d>0&&c.push(`üçΩÔ∏è ${d} food`);let p=`${c.length>0?c.join(" ‚Ä¢ "):"No turtles"} ‚Ä¢ ${`${t.growingSlots}/${t.trackedSlots} crops`}`;l&&(p+=` ‚Ä¢ <span style="color:#ff5252;font-size:9px;">(${l})</span>`),F(`${e} ‚Ä¢ ${r}${i}`,p,"",!0)}else z&&(z.textContent="Idle"),F("Turtle timer idle","","");else z&&(z.textContent="Timer Disabled"),F("Timer disabled","Enable to track crops and eggs","");const L=Iu.turtlePlantSummary;if(L)if(e.enabled)if("no-data"===t.status)L.innerHTML=C&&!e.focusTargetAvailable&&T?'<div style="font-size:11px;color:#FFB74D;">üéØ Select target plant</div>':'<div style="font-size:11px;color:#9E9E9E;">‚è≥ Waiting...</div>';else if("no-crops"===t.status)L.innerHTML='<div style="font-size:11px;color:#9E9E9E;">üåæ No crops</div>';else{const e=t.focusSlot?.species||"Unknown",n=t.contributions.length;L.innerHTML=`<div style="font-size:11px;font-weight:600;color:#4CAF50;">üå± ${e}</div><div style="font-size:10px;color:#81C784;">‚ö° ${n} booster${1===n?"":"s"}</div>`}else L.innerHTML='<div style="font-size:11px;color:#ef5350;">‚è∏Ô∏è Timer disabled</div>';const R=Iu.turtlePlantEta;if(R)if(e.enabled)if("estimating"===t.status){const e=gg(t.adjustedMsRemaining);R.innerHTML=`‚è±Ô∏è ${Ku(t.adjustedMsRemaining)}<span style="font-size:10px;color:#81C784;margin-left:6px;">${e}</span>`}else"no-turtles"===t.status&&null!=t.naturalMsRemaining?(gg(t.naturalMsRemaining),R.innerHTML=`‚è±Ô∏è ${Ku(t.naturalMsRemaining)}<span style="font-size:10px;color:#9E9E9E;margin-left:6px;">(no boost)</span>`):R.textContent="‚Äî";else R.textContent="‚Äî";const q=Iu.turtlePlantTotals;if(q)if(e.enabled)if(C&&!e.focusTargetAvailable)q.innerHTML=T?'<div style="font-size:10px;color:#9E9E9E;">üéØ Select focus plant</div>':'<div style="font-size:10px;color:#9E9E9E;">‚è≥ Loading...</div>';else if("no-data"===t.status)q.innerHTML='<div style="font-size:10px;color:#9E9E9E;">‚è≥ Loading...</div>';else if("no-crops"===t.status)q.innerHTML='<div style="font-size:10px;color:#9E9E9E;">üåæ No crops</div>';else if("no-turtles"===t.status){const e=null!=i?ng(i):"‚Äî";q.innerHTML=`<div style="font-size:10px;font-weight:600;color:#FFB74D;">‚ö†Ô∏è No boost</div><div style="font-size:9px;color:#BDBDBD;">Normal: ${e}</div>`}else{const e=null!=i?ng(i):"‚Äî",t=null!=a?ng(a):"‚Äî";q.innerHTML=`<div style="font-size:10px;font-weight:600;color:#4CAF50;">‚ö° Boost: ${rg(r)}</div><div style="font-size:9px;color:#81C784;">‚úÇÔ∏è Cut: ${t}</div><div style="font-size:9px;color:#BDBDBD;">üìÖ Normal: ${e}</div>`}else q.innerHTML='<div style="font-size:10px;color:#9E9E9E;">‚è∏Ô∏è Paused</div>';const N=Iu.turtlePlantSimple;if(N)if(e.enabled)if(C&&!e.focusTargetAvailable)N.innerHTML=T?'<span style="font-size:16px;">üéØ</span><span>Select a focus plant</span>':'<span style="font-size:16px;">‚è≥</span><span>Loading garden data...</span>';else if("no-data"===t.status)N.innerHTML='<span style="font-size:16px;">‚è≥</span><span>Loading garden data...</span>';else if("no-crops"===t.status)N.innerHTML='<span style="font-size:16px;">üåæ</span><span>No crops growing</span>';else if("no-turtles"===t.status)N.innerHTML=`<span style="font-size:16px;">‚è±Ô∏è</span><span>Matures in ${Ku(t.naturalMsRemaining)} <span style="color:#9E9E9E;">(no boost)</span></span>`;else{const e=null!=a?ng(a):"‚Äî";N.innerHTML=`<span style="font-size:16px;">‚ú®</span><span>Matures in <strong>${Ku(t.adjustedMsRemaining)}</strong> ‚Ä¢ <span style="color:#4CAF50;font-weight:600;">‚úÇÔ∏è ${e} saved</span></span>`}else N.innerHTML='<span style="font-size:16px;">‚è∏Ô∏è</span><span>Enable temple to track</span>';const B=Iu.turtlePlantLuck;if(B)if(e.enabled&&"estimating"===t.status){const e=null!=s.luckyMs?Ku(s.luckyMs):"‚Äî",t=null!=s.unluckyMs?Ku(s.unluckyMs):"‚Äî",n=null!=s.stdMinutes?ng(s.stdMinutes):"‚Äî";B.innerHTML=`<span style="font-size:14px;">üé≤</span><span>üçÄ ${e} ‚Ä¢ üòê ${t} <span style="color:#80CBC4;">(¬±${n})</span></span>`}else B.textContent="";const D=Iu.turtleEggSummary;D&&(e.enabled?"no-data"===n.status?D.textContent=k&&!e.eggFocusTargetAvailable&&A?"Select a target egg with Egg focus to track hatching.":"Waiting for garden snapshot‚Ä¶":"no-eggs"===n.status?D.textContent="No eggs incubating.":D.textContent=`${n.growingSlots}/${n.trackedSlots} growing eggs ‚Ä¢ ${n.contributions.length} booster${1===n.contributions.length?"":"s"}`:D.textContent="Timer disabled");const H=Iu.turtleEggEta;if(H)if(e.enabled)if("estimating"===n.status){const e=gg(n.adjustedMsRemaining);H.textContent=`${Ku(n.adjustedMsRemaining)} (${Yu(n.effectiveRate)})${e}`}else if("no-turtles"===n.status)if(null!=n.naturalMsRemaining){const e=gg(n.naturalMsRemaining);H.textContent=`${Ku(n.naturalMsRemaining)} (no turtle boost)${e}`}else H.textContent="‚Äî";else H.textContent="‚Äî";else H.textContent="‚Äî";const j=Iu.turtleEggTotals;if(j)if(e.enabled)if(k&&!e.eggFocusTargetAvailable)j.textContent=A?"Total Hatch Boost will appear once a target egg is selected.":"Waiting for a fresh egg snapshot...";else if("no-eggs"===n.status)j.textContent="No incubating eggs detected yet ‚Äì hatchery estimates will appear here.";else if("no-turtles"===n.status){const e=null!=c?ng(c):"‚Äî";j.textContent=`No hatch turtles boosting yet. Normal ETA: ${e}. Assign turtles to speed this up.`}else"estimating"===n.status?j.textContent=`Total Growth Boost: ${rg(l)} ‚Ä¢ Normal ETA: ${null!=c?ng(c):"‚Äî"} ‚Ä¢ Estimated Time Cut: ${null!=d?ng(d):"‚Äî"}`:j.textContent="Waiting for an egg snapshot‚Ä¶";else j.textContent="Totals paused while the temple is disabled.";const _=Iu.turtleEggSimple;if(_)if(e.enabled)if("no-eggs"===n.status)_.textContent="No eggs on the boardwalk or garden right now. Drop an egg to start tracking.";else if(k&&!e.eggFocusTargetAvailable)_.textContent=A?"Pick a target egg with Egg focus to show its hatch ETA and boost cut.":"Waiting on egg snapshots ‚Äì try moving the camera or drop an egg to refresh.";else if("no-data"===n.status)_.textContent="Waiting on egg snapshots ‚Äì try moving the camera or interacting with the garden.";else if("no-turtles"===n.status){const e=null!=c?ng(c):"‚Äî";_.textContent=`Focused egg hatches in ${Ku(n.naturalMsRemaining)} (no turtle boost active). Normal ETA: ${e}.`}else if("estimating"===n.status){const e=null!=c?ng(c):"‚Äî",t=null!=d?ng(d):"‚Äî";_.textContent=`Focused egg hatches in ${Ku(n.adjustedMsRemaining)} (Normal ETA: ${e}); Estimated Time Cut: ${t}.`}else _.textContent="";else _.textContent="Enable the temple to see egg hatching boosts too.";const O=Iu.turtleEggLuck;if(O)if(e.enabled)if("estimating"===n.status){const e=null!=p.luckyMs?Ku(p.luckyMs):"‚Äî",t=null!=p.unluckyMs?Ku(p.unluckyMs):"‚Äî",n=null!=p.stdMinutes?ng(p.stdMinutes):"‚Äî";O.textContent=`Lucky ‚âà ${e} ‚Ä¢ Unlucky ‚âà ${t} (¬±${n})`}else"no-turtles"===n.status?O.textContent="No turtle boosts active for eggs right now.":O.textContent="";else O.textContent="";const G=Iu.turtleSupportSummary,V=Iu.turtleSupportTotals,W=Iu.turtleSupportSimple,U=Iu.turtleSupportList;if(G&&(e.enabled?0===o.entries.length?G.textContent="No food turtles detected ‚Äì add Hunger Restore or Hunger Boost companions.":G.textContent=`Restore turtles active ${o.restoreActiveCount}/${o.restoreCount} ‚Ä¢ Slow drain turtles active ${o.slowActiveCount}/${o.slowCount}`:G.textContent="Food buffs paused while the temple is disabled."),V)if(e.enabled&&0!==o.entries.length){const e=g>0?tg(g,1):"0.0 feeds/hr",t=m>0?tg(m,1):"0.0 feeds/hr",n=o.restoreCount>0?`Restore: ~${e} (max ${t})`:"Restore: none yet",r=o.slowCount>0?`Slow drain: ${eg(h,0)} active (${eg(b,0)} possible)`:"Slow drain: none yet";V.textContent=`${n} ‚Ä¢ ${r}`}else V.textContent="";if(W)if(e.enabled)if(0===o.entries.length)W.textContent="Assign turtles with Hunger Restore (refills) or Hunger Boost (slow drain) abilities to see food support stats.";else{const e=o.restoreCount>0,t=u>0&&o.restoreActiveCount>0,n=o.slowActiveCount>0&&h>0;if(t&&f>0){const e=g/100;W.textContent=`Restore turtles are covering ~${e.toFixed(1)} feeds/hr and slow drain buffs are cutting hunger by ${eg(h,0)} while they stay fed.`}else e&&0===o.restoreActiveCount?W.textContent="Your restore turtles need food before their hourly refills kick back in.":W.textContent=n?`Slow drain buffs are active, trimming hunger by ${eg(h,0)} as long as the turtles stay full.`:e?"Restore turtles are present but idle‚Äîfeed them to start the hourly refills.":"Add food turtles with Hunger Restore or Hunger Boost abilities to see refills and slowdown buffs here."}else W.textContent="Enable the turtle temple and keep turtles fed to maintain hunger buffs.";if(U)if(U.textContent="",e.enabled)if(0===o.entries.length)U.appendChild(y("No food turtles detected."));else{for(const t of o.entries){const e=document.createElement("div");e.style.cssText="display:flex;flex-direction:column;gap:3px;padding:4px 0;border-bottom:1px solid rgba(255,255,255,0.05);font-size:10px;";const n=document.createElement("div");n.style.cssText="display:flex;justify-content:space-between;align-items:center;gap:12px;color:#ffe9a6;";const o=document.createElement("span");o.style.cssText="display:flex;align-items:center;gap:6px;";const r=Nc({species:"Turtle"});o.innerHTML=`${r}<span>${t.name??"Unknown"} ‚Ä¢ ${t.abilityNames.join(", ")}</span>`;const i=document.createElement("span");i.textContent=t.active?"Active":"Needs feed",i.style.cssText=`padding:1px 6px;border-radius:12px;font-size:9px;background:${t.active?"rgba(129,199,132,0.25)":"rgba(255,138,128,0.25)"};color:${t.active?"#c8e6c9":"#ffab91"};`,n.append(o,i);const a=document.createElement("div");a.style.cssText="display:flex;flex-direction:column;gap:2px;color:#ffecb3;";const s=t.totalRestorePerHourPct>0?t.totalRestorePerHourPct/100:0;if(t.totalRestorePerHourPct>0){const e=document.createElement("div");e.textContent=`Restore: ${s.toFixed(1)} feeds/hr (${eg(t.totalRestorePerTriggerPct,0)} per proc, ~${t.totalTriggersPerHour.toFixed(1)} procs/hr)`,a.appendChild(e)}if(t.totalSlowPct>0){const e=document.createElement("div");e.textContent=`Slow drain: ${eg(t.totalSlowPct,0)} less hunger/hr while active`,a.appendChild(e)}if(s>0||t.totalSlowPct>0){const e=document.createElement("div");s>0&&t.totalSlowPct>0?e.textContent=`Turtle effect: ~${s.toFixed(1)} fewer feeds/hr and pets eat ~${eg(t.totalSlowPct,0)} less often.`:e.textContent=s>0?`Turtle effect: ~${s.toFixed(1)} fewer feeds/hr thanks to this turtle.`:`Turtle effect: pets eat ~${eg(t.totalSlowPct,0)} less often.`,a.appendChild(e)}if(!a.hasChildNodes()){const e=document.createElement("div");e.textContent="No active food effects yet.",a.appendChild(e)}const l=document.createElement("div");l.style.cssText="font-size:9px;color:#ffdd99;display:flex;flex-wrap:wrap;gap:8px;";const c=`Hunger ${Zu(t.hungerPct)}`,d=`Score ${Math.round(t.baseScore)}`,p=document.createElement("span");p.textContent="xp: ";const u=og({species:t.species,slotIndex:t.slotIndex},"xp",t.xp,e=>null!=e?`${Math.round(e/1e3)}k`:"?"),g=document.createElement("span");g.textContent=" ‚Ä¢ Scale: ";const m=og({species:t.species,slotIndex:t.slotIndex},"targetScale",t.targetScale,e=>null!=e&&Number.isFinite(e)?`${e.toFixed(2)}√ó`:"?");l.textContent=`${c} ‚Ä¢ ${d} ‚Ä¢ `,l.appendChild(p),l.appendChild(u),l.appendChild(g),l.appendChild(m),e.append(n,a,l),U.appendChild(e)}const e=U.querySelectorAll(":scope > div");e.length>0&&(e[e.length-1].style.borderBottom="none")}else U.appendChild(y("Timer disabled."));const X=Iu.turtlePlantTable;if(X)if(X.textContent="",e.enabled)if(0===t.contributions.length)X.appendChild(y("No growth turtles contributing yet."));else for(const J of t.contributions){const t=document.createElement("div");t.style.cssText="display:grid;grid-template-columns:1.4fr 0.7fr 0.6fr 0.8fr;gap:6px;font-size:10px;padding:2px 0;";const n=document.createElement("div");n.textContent=J.name&&J.name.trim()||J.species||`Slot ${J.slotIndex+1}`,n.style.color=J.missingStats?"#ffcc80":"#e0f2f1";const o=document.createElement("div");o.textContent=Zu(J.hungerPct),o.style.color=null!=J.hungerPct&&J.hungerPct<e.minActiveHungerPct?"#ff8a80":"#b2dfdb";const r=document.createElement("div");r.textContent=`${J.perHourReduction.toFixed(1)} min/hr`,r.style.color="#aed581";const i=document.createElement("div");i.style.color=J.missingStats?"#ffcc80":"#c5cae9";const a=og({species:J.species,slotIndex:J.slotIndex},"xp",J.xp,e=>null!=e?`${Math.round(e/1e3)}k xp`:"‚Äî");i.appendChild(a),t.append(n,o,r,i),X.appendChild(t)}else X.appendChild(y("Timer disabled."));const Q=Iu.turtleEggTable;if(Q)if(Q.textContent="",e.enabled)if(0===n.contributions.length)Q.appendChild(y("No egg boosters contributing yet."));else for(const J of n.contributions){const t=document.createElement("div");t.style.cssText="display:grid;grid-template-columns:1.4fr 0.7fr 0.6fr 0.8fr;gap:6px;font-size:10px;padding:2px 0;";const n=document.createElement("div");n.textContent=J.name&&J.name.trim()||J.species||`Slot ${J.slotIndex+1}`,n.style.color=J.missingStats?"#ffcc80":"#e0f2f1";const o=document.createElement("div");o.textContent=Zu(J.hungerPct),o.style.color=null!=J.hungerPct&&J.hungerPct<e.minActiveHungerPct?"#ff8a80":"#b2dfdb";const r=document.createElement("div");r.textContent=`${J.perHourReduction.toFixed(1)} min/hr`,r.style.color="#aed581";const i=document.createElement("div");i.style.color=J.missingStats?"#ffcc80":"#c5cae9";const a=og({species:J.species,slotIndex:J.slotIndex},"xp",J.xp,e=>null!=e?`${Math.round(e/1e3)}k xp`:"‚Äî");i.appendChild(a),t.append(n,o,r,i),Q.appendChild(t)}else Q.appendChild(y("Timer disabled."))}let hg=!1;function bg(e,t={}){const n=document.createElement("div");n.className="qpm-card",n.style.display="flex",n.style.flexDirection="column",n.style.gap="10px";const o=document.createElement("div");o.className="qpm-card__header",t.collapsible&&(o.style.cursor="pointer");const r=document.createElement("div");r.className="qpm-card__title",r.textContent=e,o.appendChild(r);const i=[];let a=null;t.subtitleElement?(a=t.subtitleElement,i.push(a)):t.subtitle&&(a=document.createElement("span"),a.className="qpm-section-muted",a.textContent=t.subtitle,i.push(a)),Array.isArray(t.headerActions)&&t.headerActions.length>0&&i.push(...t.headerActions);let s=null;if(t.collapsible&&(s=document.createElement("span"),s.className="qpm-section-muted",s.textContent=t.startCollapsed?"‚ñ≤":"‚ñº",i.push(s)),i.length>0){const e=document.createElement("div");e.className="qpm-row",e.style.justifyContent="flex-end",e.style.gap="6px",e.style.flexWrap="nowrap";for(const t of i)e.appendChild(t);o.appendChild(e)}n.appendChild(o);const l=document.createElement("div");if(l.style.display=t.startCollapsed?"none":"flex",l.style.flexDirection="column",l.style.gap="10px",n.appendChild(l),t.collapsible){let e=!!t.startCollapsed;const n=t=>{e=t,l.style.display=e?"none":"flex",s&&(s.textContent=e?"‚ñ≤":"‚ñº")};n(e),o.addEventListener("click",()=>{n(!e)})}return{root:n,header:o,body:l,indicator:s,subtitleEl:a}}let yg={};function xg(){const{root:e,body:t}=bg("üíé Mutation Value & Reminders",{subtitle:"Gold/Rainbow generation and mutation alerts",collapsible:!0});e.dataset.qpmSection="mutation-value";const n=document.createElement("div");n.style.cssText="padding:10px;background:#1a1a2a;border-radius:6px;font-size:11px;line-height:1.5;margin-bottom:12px;",n.innerHTML="\n    <strong>üí∞ Value generation tracking:</strong> Gold/Rainbow proc rates, session value, and best records.\n  ",t.appendChild(n);const o=document.createElement("div");o.style.cssText="margin-bottom:16px;padding:12px;background:#2a1a3a;border-radius:6px;border-left:3px solid #9C27B0;";const r=document.createElement("div");r.style.cssText="font-weight:bold;font-size:12px;margin-bottom:8px;color:#9C27B0;",r.textContent="üß¨ Mutation Reminder",o.appendChild(r);const i=document.createElement("div");i.innerHTML="üí° Detects weather events (Rain/Snow/Dawn/Amber) and notifies which plants to place for mutations.",i.style.cssText="font-size:10px;line-height:1.5;color:#aaa;margin-bottom:8px;",o.appendChild(i);const a=Kg(yg.mutationReminder?.enabled?"‚úì Reminders Enabled":"‚úó Reminders Disabled",async()=>{if(!yg.mutationReminder)return;yg.mutationReminder.enabled=!yg.mutationReminder.enabled,a.textContent=yg.mutationReminder.enabled?"‚úì Reminders Enabled":"‚úó Reminders Disabled",a.classList.toggle("qpm-button--positive",yg.mutationReminder.enabled),a.classList.toggle("qpm-button--accent",yg.mutationReminder.enabled),Yg();const{setMutationReminderEnabled:e}=await Promise.resolve().then(()=>Ut);e(yg.mutationReminder.enabled)});a.style.cssText="width:100%;margin-bottom:6px;",yg.mutationReminder?.enabled&&a.classList.add("qpm-button--positive","qpm-button--accent"),o.appendChild(a);const l=Kg("üîç Check Now",async()=>{l.disabled=!0,l.textContent="‚è≥ Checking...";try{const{checkForMutations:e}=await Promise.resolve().then(()=>Ut);await e(),l.textContent="‚úÖ Done!",setTimeout(()=>{l.textContent="üîç Check Now",l.disabled=!1},2e3)}catch(e){l.textContent="‚ùå Error",s("Error checking mutations:",e),setTimeout(()=>{l.textContent="üîç Check Now",l.disabled=!1},2e3)}});l.style.cssText="width:100%;background:#9C27B0;",l.title="Manually check for mutation opportunities",o.appendChild(l),t.appendChild(o);const c=document.createElement("button");c.textContent="üóëÔ∏è Clear Restock Data",c.style.cssText="width:100%;padding:8px;background:#2a1a1a;color:#FF6B6B;border:1px solid #FF6B6B;border-radius:4px;cursor:pointer;font-size:11px;font-weight:bold;margin-bottom:12px;transition:all 0.2s;",c.onmouseenter=()=>{c.style.background="#3a2020",c.style.borderColor="#FF8888"},c.onmouseleave=()=>{c.style.background="#2a1a1a",c.style.borderColor="#FF6B6B"},c.onclick=()=>{confirm("‚ö†Ô∏è This will clear all Shop Restock history and prediction data.\n\nYour other QPM settings (XP tracking, etc.) will NOT be affected.\n\nThis cannot be undone. Are you sure?")&&(_p(),s("üóëÔ∏è Shop restock data cleared"),alert("‚úÖ Shop restock history and prediction data has been cleared."))},t.appendChild(c);const d=document.createElement("div");d.style.cssText="display:flex;flex-direction:column;gap:12px;",t.appendChild(d);const p=e=>e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString(),u=()=>{const e=id(),t=Gc();d.innerHTML="";const n=e.stats,o=t.stats,r=o.wetCount+o.chilledCount+o.frozenCount+o.dawnlitCount+o.dawnboundCount+o.amberlitCount+o.amberboundCount,i=o.wetPerHour+o.chilledPerHour+o.frozenPerHour+o.dawnlitPerHour+o.dawnboundPerHour+o.amberlitPerHour+o.amberboundPerHour,a=document.createElement("div");a.style.cssText="padding:12px;background:linear-gradient(135deg,rgba(255,215,0,0.1),rgba(139,69,19,0.1));border-radius:6px;border-left:3px solid #FFD700;",a.innerHTML=`\n      <div style="font-weight:bold;font-size:12px;margin-bottom:8px;">üí∞ Current Session Value</div>\n      <div style="font-size:20px;font-weight:bold;color:#FFD700;">${p(n.sessionValue)}</div>\n      <div style="font-size:10px;color:#888;margin-top:4px;">Session started ${(e=>{const t=Date.now()-e,n=Math.floor(t/6e4),o=Math.floor(n/60);return o>0?`${o}h ${n%60}m ago`:`${n}m ago`})(n.sessionStart)}</div>\n    `,d.appendChild(a);const s=document.createElement("div");if(s.style.cssText="display:grid;grid-template-columns:1fr 1fr;gap:8px;",s.innerHTML=`\n      <div style="padding:10px;background:#1a1a2a;border-radius:6px;text-align:center;">\n        <div style="font-size:18px;margin-bottom:4px;">üü°</div>\n        <div style="font-size:14px;font-weight:bold;color:#FFD700;">${n.goldProcs}</div>\n        <div style="font-size:9px;color:#888;margin-top:2px;">Gold Procs</div>\n        <div style="font-size:10px;color:#4CAF50;margin-top:4px;">${n.goldPerHour.toFixed(1)}/hr</div>\n      </div>\n      <div style="padding:10px;background:#1a1a2a;border-radius:6px;text-align:center;">\n        <div style="font-size:18px;margin-bottom:4px;">üåà</div>\n        <div style="font-size:14px;font-weight:bold;color:#FFD700;">${n.rainbowProcs}</div>\n        <div style="font-size:9px;color:#888;margin-top:2px;">Rainbow Procs</div>\n        <div style="font-size:10px;color:#4CAF50;margin-top:4px;">${n.rainbowPerHour.toFixed(1)}/hr</div>\n      </div>\n      <div style="padding:10px;background:#1a1a2a;border-radius:6px;text-align:center;">\n        <div style="font-size:18px;margin-bottom:4px;">üìà</div>\n        <div style="font-size:14px;font-weight:bold;color:#FFD700;">${n.cropBoostProcs}</div>\n        <div style="font-size:9px;color:#888;margin-top:2px;">Crop Boosts</div>\n        <div style="font-size:10px;color:#4CAF50;margin-top:4px;">${n.cropBoostPerHour.toFixed(1)}/hr</div>\n      </div>\n      <div style="padding:10px;background:#1a1a2a;border-radius:6px;text-align:center;">\n        <div style="font-size:18px;margin-bottom:4px;">‚òÅÔ∏è</div>\n        <div style="font-size:14px;font-weight:bold;color:#FFD700;">${r}</div>\n        <div style="font-size:9px;color:#888;margin-top:2px;">Weather Procs</div>\n        <div style="font-size:10px;color:#4CAF50;margin-top:4px;">${i.toFixed(1)}/hr</div>\n      </div>\n    `,d.appendChild(s),n.bestSessionValue>0||n.bestHourValue>0){const e=document.createElement("div");e.style.cssText="padding:10px;background:#1a1a2a;border-radius:6px;",e.innerHTML=`\n        <div style="font-weight:bold;font-size:11px;margin-bottom:8px;">üèÜ Best Records</div>\n        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;font-size:10px;">\n          <div><span style="color:#888;">Best Hour:</span> <strong style="color:#FFD700;">${p(n.bestHourValue)}</strong></div>\n          <div><span style="color:#888;">Best Session:</span> <strong style="color:#FFD700;">${p(n.bestSessionValue)}</strong></div>\n        </div>\n      `,d.appendChild(e)}};u();const g=ad(u),m=Vc(u),f=new MutationObserver(t=>{t.forEach(t=>{t.removedNodes.forEach(t=>{(t===e||t.contains?.(e))&&(g(),m(),f.disconnect())})})});return e.parentElement&&f.observe(e.parentElement,{childList:!0,subtree:!0}),e}function vg(){const{root:e,body:t}=bg("üìä Statistics Overview",{subtitle:"Session performance and value tracking"});e.dataset.qpmSection="stats-overview";const n=e=>e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString(),o=(e,t,n="‚Ä¢")=>{const o=document.createElement("div");return o.style.cssText="display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid #2a2a2a;font-size:11px;",o.innerHTML=`\n      <span style="color:#888;">${n} ${e}</span>\n      <span style="color:#FFD700;font-weight:bold;">${t}</span>\n    `,o},r=(e,t)=>{const n=document.createElement("div");return n.style.cssText="font-weight:bold;font-size:13px;color:#FFD700;margin:16px 0 8px 0;padding-bottom:4px;border-bottom:2px solid #FFD700;",n.textContent=`${t} ${e}`,n},i=new Set(["GoldGranter","RainbowGranter","ProduceScaleBoost","ProduceScaleBoostII","ProduceRefund","DoubleHarvest","SellBoostI","SellBoostII","SellBoostIII","SellBoostIV","CoinFinderI","CoinFinderII","CoinFinderIII","PetRefund","PetRefundII"]),a=()=>{t.innerHTML="";const e=id(),l=hl(),c=Gc();t.appendChild(r("Current Session","‚è±Ô∏è"));const d=Date.now()-e.stats.sessionStart;t.appendChild(o("Session Duration",(e=>{const t=Math.floor(e/36e5),n=Math.floor(e%36e5/6e4);return t>0?`${t}h ${n}m`:`${n}m`})(d),"‚è±Ô∏è")),t.appendChild(o("Session Value",n(e.stats.sessionValue)+" coins","üí∞"));const p=d>0?Math.round(e.stats.sessionValue/d*36e5):0;if(t.appendChild(o("Value per Hour",n(p)+" coins/hr","üìä")),t.appendChild(r("Mutation Value","üíé")),t.appendChild(o("Gold Procs",e.stats.goldProcs+" ("+e.stats.goldPerHour.toFixed(1)+"/hr)","üü°")),t.appendChild(o("Gold Value",n(e.stats.goldTotalValue)+" coins","üí∞")),t.appendChild(o("Rainbow Procs",e.stats.rainbowProcs+" ("+e.stats.rainbowPerHour.toFixed(1)+"/hr)","üåà")),t.appendChild(o("Rainbow Value",n(e.stats.rainbowTotalValue)+" coins","üí∞")),t.appendChild(o("Crop Boost Procs",e.stats.cropBoostProcs+" ("+e.stats.cropBoostPerHour.toFixed(1)+"/hr)","üìà")),t.appendChild(o("Boost Value",n(e.stats.cropBoostTotalValue)+" coins","üí∞")),t.appendChild(r("Personal Records","üèÜ")),e.stats.bestHourValue>0&&(t.appendChild(o("Best Hour",n(e.stats.bestHourValue)+" coins","‚≠ê")),e.stats.bestHourTime)){const n=new Date(e.stats.bestHourTime);t.appendChild(o("Best Hour Date",n.toLocaleDateString(),"üìÖ"))}if(e.stats.bestSessionValue>0&&(t.appendChild(o("Best Session",n(e.stats.bestSessionValue)+" coins","üåü")),e.stats.bestSessionTime)){const n=new Date(e.stats.bestSessionTime);t.appendChild(o("Best Session Date",n.toLocaleDateString(),"üìÖ"))}if(0===e.stats.bestHourValue&&0===e.stats.bestSessionValue){const e=document.createElement("div");e.style.cssText="padding:8px;background:rgba(139,195,74,0.1);border-radius:4px;font-size:10px;color:#8BC34A;margin-top:4px;",e.innerHTML="‚ÑπÔ∏è Personal records will be tracked as you play.",t.appendChild(e)}const u=c.stats.wetCount+c.stats.chilledCount+c.stats.frozenCount+c.stats.dawnlitCount+c.stats.dawnboundCount+c.stats.amberlitCount+c.stats.amberboundCount,g=c.stats.wetPerHour+c.stats.chilledPerHour+c.stats.frozenPerHour+c.stats.dawnlitPerHour+c.stats.dawnboundPerHour+c.stats.amberlitPerHour+c.stats.amberboundPerHour,m=c.stats.wetTotalValue+c.stats.chilledTotalValue+c.stats.frozenTotalValue+c.stats.dawnlitTotalValue+c.stats.dawnboundTotalValue+c.stats.amberlitTotalValue+c.stats.amberboundTotalValue;u>0&&(t.appendChild(r("Weather Mutations","üå§Ô∏è")),t.appendChild(o("Total Weather Procs",n(u),"üå§Ô∏è")),t.appendChild(o("Procs per Hour",g.toFixed(1),"‚ö°")),t.appendChild(o("Total Value",n(m)+" coins","üí∞"))),t.appendChild(r("Top Abilities by Value","‚ö°"));const f=Object.entries(l.abilities.valueByAbility).filter(([e])=>i.has(e)).sort(([,e],[,t])=>t-e).slice(0,5);if(f.length>0)f.forEach(([e,r])=>{const i=Ll(e),a=i?.name||e,s=l.abilities.procsByAbility[e]||0,c=a+" ("+String(s)+"x)",d=n(r)+" coins";t.appendChild(o(c,d,"‚ñ∏"))});else{const e=document.createElement("div");e.style.cssText="padding:8px;background:rgba(139,195,74,0.1);border-radius:4px;font-size:10px;color:#8BC34A;margin-top:4px;",e.innerHTML="‚ÑπÔ∏è Ability stats will appear as your pets proc abilities.",t.appendChild(e)}if(e.sessions&&e.sessions.length>0){t.appendChild(r("Session History","üìà"));const i=e.sessions.slice(-7),a=i.reduce((e,t)=>e+t.value,0)/i.length;t.appendChild(o("Sessions Logged",e.sessions.length.toString(),"üìù"));const s=n(Math.round(a))+" coins/session";if(t.appendChild(o("Last 7 Days Avg",s,"üìä")),i.length>=2){const e=i.slice(-3).reduce((e,t)=>e+t.value,0)/Math.min(3,i.length),n=i.slice(0,-3).reduce((e,t)=>e+t.value,0)/Math.max(1,i.length-3),r=e>n?"üìà Improving":e<n?"üìâ Declining":"‚û°Ô∏è Stable";t.appendChild(o("Trend",r,"üìâ"))}}if(l.garden.totalHarvested>0){t.appendChild(r("Garden Insights","üå±")),t.appendChild(o("Total Harvested",n(l.garden.totalHarvested),"üåæ"));const e=d>0?Math.round(l.garden.totalHarvested/d*36e5):0;t.appendChild(o("Harvest Rate",e+"/hr","‚ö°")),l.garden.totalWateringCans>0&&t.appendChild(o("Watering Cans Used",n(l.garden.totalWateringCans),"üíß"))}const h=Kg("üóëÔ∏è Reset All Stats",async()=>{if(confirm("‚ö†Ô∏è This will reset ALL statistics including:\n\n‚Ä¢ Session value tracking\n‚Ä¢ Mutation records\n‚Ä¢ Ability performance\n‚Ä¢ Garden metrics\n\nThis action cannot be undone. Continue?")){h.disabled=!0,h.textContent="‚è≥ Resetting...";try{const{resetPetHatchingTracker:e}=await Promise.resolve().then(()=>ox);bl(),e(),sd(),h.textContent="‚úÖ Reset Complete!",setTimeout(()=>{h.textContent="üóëÔ∏è Reset All Stats",h.disabled=!1,a()},2e3)}catch(e){s("Error resetting stats:",e),h.textContent="‚ùå Error",setTimeout(()=>{h.textContent="üóëÔ∏è Reset All Stats",h.disabled=!1},2e3)}}});h.style.cssText="width:100%;margin-top:16px;background:#d32f2f;",h.title="Reset all QPM statistics",t.appendChild(h)};a();const l=fl(()=>a()),c=ad(()=>a()),d=Vc(()=>a()),p=new MutationObserver(()=>{document.contains(e)||(l(),c(),d(),p.disconnect())});return e.parentElement&&p.observe(e.parentElement,{childList:!0,subtree:!0}),e}async function wg(){const{root:e,body:t}=bg("‚≠ê Auto-Favorite",{subtitle:"Automatically favorite crops and pets"});e.dataset.qpmSection="auto-favorite";const n=Ed(),o=document.createElement("label");o.style.cssText="\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 12px;\n    background: var(--qpm-surface-1, #1a1a1a);\n    border-radius: 8px;\n    cursor: pointer;\n    margin-bottom: 16px;\n  ";const r=document.createElement("input");r.type="checkbox",r.checked=n.enabled,r.style.cssText="\n    width: 20px;\n    height: 20px;\n    cursor: pointer;\n  ";const i=document.createElement("span");i.textContent="Enable Auto-Favorite",i.style.cssText="\n    font-weight: 600;\n    font-size: 14px;\n    color: var(--qpm-text, #fff);\n  ",r.addEventListener("change",()=>{$d({enabled:r.checked})}),o.appendChild(r),o.appendChild(i),t.appendChild(o);const a=document.createElement("div");a.style.cssText="\n    padding: 12px;\n    background: rgba(76, 175, 80, 0.1);\n    border-left: 3px solid var(--qpm-accent, #4CAF50);\n    border-radius: 4px;\n    margin-bottom: 16px;\n    font-size: 12px;\n    line-height: 1.6;\n    color: var(--qpm-text-muted, #aaa);\n  ",a.innerHTML="\n    üí° <strong>How it works:</strong><br>\n    ‚Ä¢ Monitors inventory in background (no need to open inventory)<br>\n    ‚Ä¢ Automatically favorites matching items when detected<br>\n    ‚Ä¢ Never unfavorites items (safe for manual favorites)<br>\n    ‚Ä¢ Works via WebSocket (instant, no lag)\n  ",t.appendChild(a);const s=document.createElement("div");s.style.cssText="\n    margin-bottom: 16px;\n  ";const l=document.createElement("h4");l.textContent="üêæ Pet Abilities",l.style.cssText="\n    margin: 0 0 8px 0;\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--qpm-accent, #4CAF50);\n  ",s.appendChild(l);[{id:"Gold Granter",label:"Gold Granter"},{id:"Rainbow Granter",label:"Rainbow Granter"}].forEach(e=>{const t=document.createElement("label");t.style.cssText="\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      padding: 8px;\n      cursor: pointer;\n      border-radius: 4px;\n      transition: background 0.2s;\n    ",t.addEventListener("mouseenter",()=>{t.style.background="rgba(255, 255, 255, 0.05)"}),t.addEventListener("mouseleave",()=>{t.style.background="transparent"});const o=document.createElement("input");o.type="checkbox",o.checked=n.petAbilities?.includes(e.id)??!1,o.style.cssText="width: 16px; height: 16px; cursor: pointer;",o.addEventListener("change",()=>{const t=Ed().petAbilities||[];$d({petAbilities:o.checked?[...t,e.id]:t.filter(t=>t!==e.id)}),o.checked&&window.qpm_favoritePetAbility?.(e.id)});const r=qc(e.id),i=document.createElement("div");i.style.cssText=`\n      width: 14px;\n      height: 14px;\n      background: ${r.base};\n      border-radius: 2px;\n      box-shadow: 0 0 6px ${r.glow}, 0 1px 3px rgba(0,0,0,0.3);\n    `,i.title=e.label;const a=document.createElement("span");a.textContent=e.label,a.style.cssText="font-size: 13px; color: var(--qpm-text, #fff);",t.appendChild(o),t.appendChild(i),t.appendChild(a),s.appendChild(t)}),t.appendChild(s);const c=document.createElement("div");c.style.cssText="\n    margin-bottom: 16px;\n  ";const d=document.createElement("h4");d.textContent="‚ú® Crop Mutations",d.style.cssText="\n    margin: 0 0 8px 0;\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--qpm-accent, #4CAF50);\n  ",c.appendChild(d);[{id:"Rainbow",label:"Rainbow",color:"#9C27B0"},{id:"Gold",label:"Golden",color:"#FFD700"},{id:"Frozen",label:"Frozen",color:"#2196F3"},{id:"Wet",label:"Wet",color:"#03A9F4"},{id:"Chilled",label:"Chilled",color:"#00BCD4"},{id:"Dawnlit",label:"Dawnlit",color:"#FF9800"},{id:"Dawncharged",label:"Dawncharged",color:"#FF5722"},{id:"Ambershine",label:"Ambershine",color:"#FFC107"},{id:"Ambercharged",label:"Ambercharged",color:"#FF6F00"}].forEach(e=>{const t=document.createElement("label");t.style.cssText="\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      padding: 8px;\n      cursor: pointer;\n      border-radius: 4px;\n      transition: background 0.2s;\n    ",t.addEventListener("mouseenter",()=>{t.style.background="rgba(255, 255, 255, 0.05)"}),t.addEventListener("mouseleave",()=>{t.style.background="transparent"});const o=document.createElement("input");o.type="checkbox",o.checked=n.mutations.includes(e.id),o.style.cssText="width: 16px; height: 16px; cursor: pointer;",o.addEventListener("change",()=>{const t=Ed().mutations;$d({mutations:o.checked?[...t,e.id]:t.filter(t=>t!==e.id)}),o.checked&&window.qpm_favoriteMutation?.(e.id)});const r=Mu("Sunflower",[e.id]),i=document.createElement("img");i.dataset.qpmSprite=`crop:Sunflower:${e.id}`,i.title=e.label,i.style.cssText="\n      width: 24px;\n      height: 24px;\n      object-fit: contain;\n      image-rendering: pixelated;\n      flex-shrink: 0;\n    ",r&&(i.src=r);const a=document.createElement("span");a.textContent=e.label,a.style.cssText="font-size: 13px; color: var(--qpm-text, #fff);",t.appendChild(o),t.appendChild(i),t.appendChild(a),c.appendChild(t)}),t.appendChild(c);const p=document.createElement("div");p.style.cssText="\n    margin-top: 16px;\n    padding-top: 16px;\n    border-top: 1px solid rgba(255, 255, 255, 0.1);\n  ";const u=document.createElement("h4");u.textContent="‚öôÔ∏è Advanced Filters",u.style.cssText="\n    margin: 0 0 12px 0;\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--qpm-accent, #4CAF50);\n  ",p.appendChild(u);const g=document.createElement("div");g.style.cssText="\n    font-size: 11px;\n    color: rgba(255, 255, 255, 0.5);\n    margin-bottom: 12px;\n    padding: 8px;\n    background: rgba(255, 152, 0, 0.1);\n    border-left: 2px solid #FF9800;\n    border-radius: 4px;\n  ",g.textContent="üí° Select multiple options to filter which items get auto-favorited.",p.appendChild(g);const m=document.createElement("div");m.style.cssText="margin-bottom: 16px;";const f=document.createElement("h5");f.textContent="Filter by Abilities:",f.style.cssText="margin: 0 0 8px 0; font-size: 12px; font-weight: 600; color: rgba(255, 255, 255, 0.8);",m.appendChild(f);const h=document.createElement("div");h.style.cssText="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px;";const{getAllAbilityDefinitions:b}=await Promise.resolve().then(()=>Dl),y=b(),x=new Map;y.forEach(e=>{const t=e.name.replace(/\s+(I{1,4}|\d+)$/,"");x.has(t)||x.set(t,[]),x.get(t).push({id:e.id,name:e.name})});const v=[];Array.from(x.entries()).sort(([e],[t])=>e.localeCompare(t)).forEach(([e,t])=>{const n=t.map(e=>e.id);v.push({value:n,label:e})}),v.forEach(e=>{const t=document.createElement("label");t.style.cssText="display: flex; align-items: center; gap: 8px; padding: 6px 8px; cursor: pointer; border-radius: 4px; transition: background 0.2s; font-size: 12px;",t.addEventListener("mouseenter",()=>t.style.background="rgba(255, 255, 255, 0.05)"),t.addEventListener("mouseleave",()=>t.style.background="transparent");const o=document.createElement("input");o.type="checkbox";const r=n.filterByAbilities||[];o.checked=e.value.some(e=>r.includes(e)),o.style.cssText="width: 16px; height: 16px; cursor: pointer; flex-shrink: 0;",o.addEventListener("change",()=>{const t=Ed().filterByAbilities||[];if(o.checked){const n=e.value.filter(e=>!t.includes(e));$d({filterByAbilities:[...t,...n]})}else{$d({filterByAbilities:t.filter(t=>!e.value.includes(t))})}});const i=document.createElement("span");i.textContent=e.label,i.style.cssText="color: var(--qpm-text, #fff); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;",i.title=e.label,t.appendChild(o),t.appendChild(i),h.appendChild(t)}),m.appendChild(h),p.appendChild(m);const w=document.createElement("div");w.style.cssText="margin-bottom: 12px;";const C=document.createElement("label");C.textContent="Filter by Ability Count:",C.style.cssText="display: block; font-size: 12px; color: rgba(255, 255, 255, 0.7); margin-bottom: 4px;",w.appendChild(C);const T=document.createElement("select");T.style.cssText="\n    width: 100%;\n    padding: 8px;\n    background: rgba(0, 0, 0, 0.3);\n    border: 1px solid rgba(255, 255, 255, 0.2);\n    border-radius: 4px;\n    color: #fff;\n    font-size: 13px;\n    cursor: pointer;\n  ",[{value:"",label:"Any Count"},{value:"1",label:"1 Ability"},{value:"2",label:"2 Abilities"},{value:"3",label:"3 Abilities"},{value:"4",label:"4 Abilities"}].forEach(e=>{const t=document.createElement("option");t.value=e.value,t.textContent=e.label,T.appendChild(t)}),T.value=null!=n.filterByAbilityCount?String(n.filterByAbilityCount):"",T.addEventListener("change",()=>{$d({filterByAbilityCount:T.value?parseInt(T.value):null})}),w.appendChild(T),p.appendChild(w);const S=document.createElement("div");S.style.cssText="margin-bottom: 16px;";const P=document.createElement("h5");P.textContent="Filter by Pet Species:",P.style.cssText="margin: 0 0 8px 0; font-size: 12px; font-weight: 600; color: rgba(255, 255, 255, 0.8);",S.appendChild(P);const k=document.createElement("div");k.style.cssText="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px;";const A=Lo()?Ho():["Worm","Snail","Bee","Chicken","Bunny","Dragonfly","Pig","Cow","Turkey","Squirrel","Turtle","Goat","Butterfly","Peacock","Capybara"];A.forEach(e=>{const t=document.createElement("label");t.style.cssText="display: flex; align-items: center; gap: 8px; padding: 6px 8px; cursor: pointer; border-radius: 4px; transition: background 0.2s; font-size: 12px;",t.addEventListener("mouseenter",()=>t.style.background="rgba(255, 255, 255, 0.05)"),t.addEventListener("mouseleave",()=>t.style.background="transparent");const o=document.createElement("input");o.type="checkbox",o.checked=(n.filterBySpecies||[]).includes(e),o.style.cssText="width: 16px; height: 16px; cursor: pointer; flex-shrink: 0;",o.addEventListener("change",()=>{const t=Ed().filterBySpecies||[];$d({filterBySpecies:o.checked?[...t,e]:t.filter(t=>t!==e)})});const r=function(e){const t=String(e||"").trim();if(!t)return'<div style="font-size: 16px;">üêæ</div>';const n=Fi(Yi(t));return`\n    <div class="qpm-pet-species-icon" style="display: inline-flex; align-items: center; gap: 6px;">\n      ${n?`<img src="${n}" alt="${t}" style="width: 24px; height: 24px; object-fit: contain; image-rendering: pixelated; border-radius: 4px; border: 1px solid rgba(168,139,250,0.2);" />`:'<div style="font-size: 16px;">üêæ</div>'}\n      <span style="font-size: 12px; font-weight: 600; color: #e2e8f0;">${t}</span>\n    </div>\n  `}(e),i=document.createElement("div");i.innerHTML=r,i.style.cssText="flex-shrink: 0;",t.appendChild(o),t.appendChild(i),k.appendChild(t)}),S.appendChild(k),p.appendChild(S);const E=document.createElement("div");E.style.cssText="margin-bottom: 16px;";const $=document.createElement("h5");$.textContent="Filter by Crop Name:",$.style.cssText="margin: 0 0 8px 0; font-size: 12px; font-weight: 600; color: rgba(255, 255, 255, 0.8);",E.appendChild($);const M=document.createElement("div");let I;if(M.style.cssText="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px;",Lo())I=Ud();else{const{getAllCropNames:e}=await Promise.resolve().then(()=>ga);I=e()}var F;return I.forEach(e=>{const t=document.createElement("label");t.style.cssText="display: flex; align-items: center; gap: 8px; padding: 6px 8px; cursor: pointer; border-radius: 4px; transition: background 0.2s; font-size: 12px;",t.addEventListener("mouseenter",()=>t.style.background="rgba(255, 255, 255, 0.05)"),t.addEventListener("mouseleave",()=>t.style.background="transparent");const o=document.createElement("input");o.type="checkbox",o.checked=(n.filterByCropTypes||[]).includes(e),o.style.cssText="width: 16px; height: 16px; cursor: pointer; flex-shrink: 0;",o.addEventListener("change",()=>{const t=Ed().filterByCropTypes||[];$d({filterByCropTypes:o.checked?[...t,e]:t.filter(t=>t!==e)})});const r=Mu(e,[]),i=document.createElement("img");i.dataset.qpmSprite=`crop:${e}`,i.alt=e,i.style.cssText="width: 24px; height: 24px; object-fit: contain; image-rendering: pixelated; flex-shrink: 0;",r&&(i.src=r);const a=document.createElement("span");a.textContent=e,a.style.cssText="color: var(--qpm-text, #fff); font-size: 11px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 120px;",a.title=e,t.appendChild(o),t.appendChild(i),t.appendChild(a),M.appendChild(t)}),E.appendChild(M),p.appendChild(E),t.appendChild(p),F=e=>{r.checked=e.enabled,T.value=null!=e.filterByAbilityCount?String(e.filterByAbilityCount):"",h.querySelectorAll('input[type="checkbox"]').forEach((t,n)=>{const o=v[n];o&&(t.checked=o.value.some(t=>(e.filterByAbilities||[]).includes(t)))}),k.querySelectorAll('input[type="checkbox"]').forEach((t,n)=>{t.checked=(e.filterBySpecies||[]).includes(A[n]||"")}),M.querySelectorAll('input[type="checkbox"]').forEach((t,n)=>{t.checked=(e.filterByCropTypes||[]).includes(I[n]||"")})},md.add(F),F({...gd}),e}async function Cg(){if(function(){if(hg)return;const e=document.createElement("style");e.id="qpm-panel-styles",e.textContent=':root {\n    --qpm-surface-1: rgba(18, 21, 32, 0.95);\n    --qpm-surface-2: rgba(32, 36, 52, 0.9);\n    --qpm-surface-3: rgba(52, 58, 78, 0.85);\n    --qpm-border: rgba(120, 130, 170, 0.28);\n    --qpm-text: #eef0ff;\n    --qpm-text-muted: #97a0c0;\n    --qpm-accent: #8f82ff;\n    --qpm-accent-strong: #b39cff;\n    --qpm-positive: #4fd18b;\n    --qpm-danger: #ff6f91;\n    --qpm-warning: #ffb347;\n    --qpm-shadow: 0 14px 32px rgba(15, 17, 28, 0.55);\n    --qpm-divider: rgba(120, 130, 170, 0.2);\n    --qpm-font: \'Inter\', \'Segoe UI\', Arial, sans-serif;\n  }\n\n  .qpm-panel {\n    position: fixed;\n    right: 16px;\n    bottom: 16px;\n    z-index: 2147483647;\n    background: var(--qpm-surface-1);\n    color: var(--qpm-text);\n    padding: 0;\n    border-radius: 14px;\n    font: 12px/1.55 var(--qpm-font);\n    box-shadow: var(--qpm-shadow);\n    min-width: 360px;\n    max-width: 430px;\n    max-height: calc(100vh - 32px);\n    overflow: hidden;\n    backdrop-filter: blur(18px);\n    border: 1px solid var(--qpm-border);\n  }\n\n  .qpm-panel__titlebar {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 12px 16px;\n    font-size: 15px;\n    font-weight: 600;\n    background: linear-gradient(135deg, rgba(143, 130, 255, 0.28), rgba(32, 36, 52, 0.85));\n    cursor: move;\n    user-select: none;\n  }\n\n  .qpm-panel__titlebar button {\n    background: rgba(255, 255, 255, 0.08);\n    border: 1px solid rgba(255, 255, 255, 0.18);\n    color: var(--qpm-text-muted);\n    border-radius: 18px;\n    font-size: 11px;\n    padding: 4px 10px;\n    cursor: pointer;\n    transition: background 0.2s ease, color 0.2s ease;\n  }\n\n  .qpm-panel__titlebar button:hover {\n    background: rgba(255, 255, 255, 0.16);\n    color: var(--qpm-text);\n  }\n\n  .qpm-version-bubble {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    padding: 4px 10px;\n    border-radius: 4px;\n    font-size: 11px;\n    font-weight: 600;\n    letter-spacing: 0.3px;\n    transition: all 0.2s ease;\n    margin-left: auto;\n    margin-right: 8px;\n  }\n\n  .qpm-version-bubble[data-status="up-to-date"] {\n    background: rgba(76, 175, 80, 0.2);\n    color: #4CAF50;\n    border: 1px solid rgba(76, 175, 80, 0.4);\n  }\n\n  .qpm-version-bubble[data-status="outdated"] {\n    background: rgba(244, 67, 54, 0.18);\n    color: #F44336;\n    border: 1px solid rgba(244, 67, 54, 0.55);\n    animation: pulse-warning 2s ease-in-out infinite;\n  }\n\n  .qpm-version-bubble[data-status="checking"] {\n    background: rgba(158, 158, 158, 0.2);\n    color: #9E9E9E;\n    border: 1px solid rgba(158, 158, 158, 0.4);\n  }\n\n  .qpm-version-bubble[data-status="error"] {\n    background: rgba(244, 67, 54, 0.2);\n    color: #F44336;\n    border: 1px solid rgba(244, 67, 54, 0.4);\n  }\n\n  .qpm-version-bubble:hover[data-status="outdated"] {\n    transform: scale(1.05);\n    background: rgba(255, 193, 7, 0.3);\n  }\n\n  @keyframes pulse-warning {\n    0%, 100% {\n      opacity: 1;\n    }\n    50% {\n      opacity: 0.7;\n    }\n  }\n\n  .qpm-content {\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n    padding: 12px 16px 16px;\n    overflow-y: auto;\n    overflow-x: hidden;\n    max-height: calc(100vh - 120px);\n  }\n\n  .qpm-nav {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 8px;\n    margin-bottom: 6px;\n  }\n\n  .qpm-nav__button {\n    flex: 1 1 calc(33% - 8px);\n    min-width: 120px;\n    border: 1px solid var(--qpm-border);\n    background: rgba(255, 255, 255, 0.04);\n    color: var(--qpm-text-muted);\n    border-radius: 10px;\n    padding: 8px 10px;\n    font-size: 12px;\n    font-weight: 600;\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    cursor: pointer;\n    transition: all 0.25s ease;\n  }\n\n  .qpm-nav__button:hover {\n    border-color: var(--qpm-accent-strong);\n    color: var(--qpm-text);\n    transform: translateY(-1px);\n  }\n\n  .qpm-nav__button--active {\n    border-color: var(--qpm-accent);\n    color: var(--qpm-text);\n    /* Background, box-shadow, and glow set by JavaScript based on tab color */\n  }\n\n  .qpm-tabs {\n    position: relative;\n  }\n\n  .qpm-tab {\n    display: none;\n    flex-direction: column;\n    gap: 12px;\n  }\n\n  .qpm-tab--active {\n    display: flex;\n  }\n\n  .qpm-card {\n    background: var(--qpm-surface-2);\n    border: 1px solid var(--qpm-border);\n    border-radius: 12px;\n    padding: 12px 14px;\n    box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.03);\n  }\n\n  .qpm-table {\n    width: 100%;\n    border-collapse: collapse;\n  }\n\n  .qpm-table thead {\n    background: rgba(255, 255, 255, 0.05);\n    text-transform: uppercase;\n    letter-spacing: 0.3px;\n    font-size: 9px;\n    color: var(--qpm-text-muted);\n  }\n\n  .qpm-table th,\n  .qpm-table td {\n    padding: 6px 8px;\n    text-align: left;\n    border-bottom: 1px solid rgba(255, 255, 255, 0.04);\n  }\n\n  .qpm-table tbody tr:nth-child(odd) {\n    background: rgba(255, 255, 255, 0.02);\n  }\n\n  .qpm-table--compact th,\n  .qpm-table--compact td {\n    font-size: 10px;\n  }\n\n  .qpm-ability-divider td {\n    border-top: 1px solid rgba(255, 255, 255, 0.08);\n  }\n\n  .qpm-ability-section td {\n    background: rgba(255, 255, 255, 0.04);\n    font-weight: 600;\n    font-size: 11px;\n    color: var(--qpm-text);\n    padding: 7px 8px;\n    border-top: 1px solid rgba(255, 255, 255, 0.08);\n  }\n\n  .qpm-ability-section__content {\n    display: flex;\n    align-items: baseline;\n    justify-content: space-between;\n    gap: 12px;\n    flex-wrap: wrap;\n  }\n\n  .qpm-ability-section__title {\n    font-weight: 600;\n  }\n\n  .qpm-ability-section__meta {\n    font-weight: 400;\n    font-size: 10px;\n    color: var(--qpm-text-muted);\n  }\n\n  .qpm-ability-total {\n    font-weight: 600;\n    background: rgba(255, 255, 255, 0.03);\n  }\n\n  .qpm-ability-total td {\n    border-top: 1px solid rgba(255, 255, 255, 0.08);\n  }\n\n  .qpm-tracker-summary {\n    font-size: 11px;\n    color: var(--qpm-text-muted);\n    line-height: 1.5;\n  }\n\n  .qpm-mutation-meta {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    gap: 8px;\n    flex-wrap: wrap;\n    font-size: 11px;\n  }\n\n  .qpm-mutation-meta__group {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    flex-wrap: wrap;\n  }\n\n  .qpm-mutation-source {\n    font-size: 10px;\n    color: var(--qpm-text-muted);\n    background: rgba(255, 255, 255, 0.06);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: 999px;\n    padding: 2px 8px;\n  }\n\n  .qpm-mutation-countdown {\n    font-size: 11px;\n    color: var(--qpm-text-muted);\n    margin-top: 4px;\n  }\n\n  .qpm-mutation-countdown[data-state=\'active\'] {\n    color: #b3ffe0;\n  }\n\n  .qpm-mutation-countdown[data-state=\'expired\'] {\n    color: #ffcc80;\n  }\n\n  .qpm-mutation-totals {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 6px;\n    margin-top: 8px;\n  }\n\n  .qpm-mutation-chip {\n    background: rgba(255, 255, 255, 0.05);\n    border: 1px solid rgba(255, 255, 255, 0.08);\n    border-radius: 10px;\n    padding: 6px 10px;\n    min-width: 130px;\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n  }\n\n  .qpm-mutation-chip--active {\n    border-color: rgba(143, 130, 255, 0.5);\n    box-shadow: 0 0 0 1px rgba(143, 130, 255, 0.3);\n  }\n\n  .qpm-mutation-chip__label {\n    font-size: 11px;\n    font-weight: 600;\n    color: var(--qpm-text);\n  }\n\n  .qpm-mutation-chip__meta {\n    font-size: 10px;\n    color: var(--qpm-text-muted);\n  }\n\n  .qpm-mutation-detail {\n    margin-top: 8px;\n  }\n\n  .qpm-tracker-note {\n    font-size: 10px;\n    color: #90caf9;\n    background: rgba(144, 202, 249, 0.08);\n    border: 1px dashed rgba(144, 202, 249, 0.4);\n    border-radius: 8px;\n    padding: 8px;\n  }\n\n  .qpm-card__header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    margin-bottom: 6px;\n  }\n\n  .qpm-card__title {\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--qpm-text);\n    display: flex;\n    align-items: center;\n    gap: 6px;\n  }\n\n  .qpm-section-muted {\n    color: var(--qpm-text-muted);\n    font-size: 11px;\n  }\n\n  .qpm-button {\n    padding: 6px 10px;\n    font-size: 12px;\n    cursor: pointer;\n    border: 1px solid var(--qpm-border);\n    border-radius: 10px;\n    background: rgba(255, 255, 255, 0.06);\n    color: var(--qpm-text);\n    transition: background 0.2s ease, border-color 0.2s ease;\n  }\n\n  .qpm-button:hover:not(:disabled) {\n    background: rgba(255, 255, 255, 0.12);\n    border-color: var(--qpm-accent);\n  }\n\n  .qpm-button:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n  }\n\n  .qpm-button--accent {\n    background: rgba(143, 130, 255, 0.24);\n    border-color: var(--qpm-accent);\n  }\n\n  .qpm-button--positive {\n    background: rgba(79, 209, 139, 0.28);\n    border-color: rgba(79, 209, 139, 0.6);\n  }\n\n  .qpm-grid {\n    display: grid;\n    gap: 10px;\n  }\n\n  .qpm-grid--two {\n    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\n  }\n\n  .qpm-row {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    flex-wrap: wrap;\n  }\n\n  .qpm-input,\n  .qpm-select {\n    padding: 4px 8px;\n    border: 1px solid var(--qpm-border);\n    border-radius: 8px;\n    background: rgba(20, 24, 36, 0.65);\n    color: var(--qpm-text);\n    font-size: 11px;\n    transition: border-color 0.2s ease, box-shadow 0.2s ease;\n  }\n\n  .qpm-input:focus,\n  .qpm-select:focus {\n    outline: none;\n    border-color: var(--qpm-accent);\n    box-shadow: 0 0 0 2px rgba(143, 130, 255, 0.18);\n  }\n\n  .qpm-checkbox {\n    accent-color: var(--qpm-accent);\n  }\n\n  .qpm-coming-grid {\n    display: grid;\n    gap: 10px;\n    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));\n  }\n\n  .qpm-coming-card {\n    background: var(--qpm-surface-3);\n    border: 1px dashed rgba(143, 130, 255, 0.35);\n    border-radius: 10px;\n    padding: 10px;\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n    color: var(--qpm-text-muted);\n  }\n\n  .qpm-coming-card strong {\n    color: var(--qpm-text);\n    font-size: 12px;\n  }\n\n  .qpm-coming-card span {\n    color: var(--qpm-accent-strong);\n    font-size: 11px;\n    font-weight: 600;\n  }\n\n  .qpm-chip {\n    display: inline-flex;\n    align-items: center;\n    gap: 4px;\n    padding: 2px 6px;\n    border-radius: 999px;\n    font-size: 10px;\n    background: rgba(143, 130, 255, 0.22);\n    color: var(--qpm-text);\n    border: 1px solid rgba(143, 130, 255, 0.35);\n  }\n\n  .qpm-toast {\n    position: fixed;\n    bottom: 24px;\n    right: 24px;\n    background: rgba(20, 26, 40, 0.92);\n    border: 1px solid rgba(143, 130, 255, 0.35);\n    color: var(--qpm-text);\n    padding: 10px 14px;\n    border-radius: 12px;\n    font-size: 12px;\n    z-index: 2147483647;\n    box-shadow: 0 10px 26px rgba(12, 16, 28, 0.55);\n    animation: qpm-toast-in 0.25s ease;\n  }\n\n  @keyframes qpm-toast-in {\n    from { opacity: 0; transform: translateY(12px); }\n    to { opacity: 1; transform: translateY(0); }\n  }\n\n  /* Custom scrollbar for main panel content */\n  .qpm-content::-webkit-scrollbar {\n    width: 8px;\n  }\n  .qpm-content::-webkit-scrollbar-track {\n    background: rgba(0, 0, 0, 0.2);\n    border-radius: 4px;\n  }\n  .qpm-content::-webkit-scrollbar-thumb {\n    background: rgba(143, 130, 255, 0.35);\n    border-radius: 4px;\n    transition: background 0.2s;\n  }\n  .qpm-content::-webkit-scrollbar-thumb:hover {\n    background: rgba(143, 130, 255, 0.55);\n  }\n  ',document.head.appendChild(e),hg=!0}(),Iu.panel)return Iu.panel;const e=document.createElement("div");e.className="qpm-panel";const t=document.createElement("div");t.className="qpm-panel__titlebar",t.title="Drag to move ‚Ä¢ Click to collapse";const n=document.createElement("span");n.textContent="üçñ Quinoa Pet Manager";const o=document.createElement("a");o.className="qpm-version-bubble",o.dataset.status="checking",o.textContent=`v${vu}`,o.title="Checking for updates...",o.style.cursor="pointer",o.target="_blank",o.rel="noopener noreferrer";const r="https://raw.githubusercontent.com/ryandt2305-cpu/QPM-GR/master/dist/QPM.user.js";o.href=r;var i;o.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),(()=>{const e=globalThis.GM_openInTab||globalThis.GM?.openInTab;if("function"==typeof e)try{return void e(r,{active:!0,insert:!0,setParent:!0})}catch(t){console.warn("[QPM] GM_openInTab failed, falling back",t)}window.open(r,"_blank","noopener,noreferrer")||(window.location.href=r)})()}),i=e=>{o.dataset.status={current:"up-to-date",outdated:"outdated",checking:"checking",error:"error"}[e.status],"outdated"===e.status&&e.latest?(o.textContent=`v${e.current} ‚Üí v${e.latest}`,o.title=`Update available! Current: v${e.current}\nLatest: v${e.latest}\nClick to open the latest userscript.`):"error"===e.status?(o.textContent=`v${e.current}`,o.title="Version check failed. Click to open the repo."):"checking"===e.status?(o.textContent=`v${e.current}`,o.title="Checking for updates..."):(o.textContent=`v${e.current}`,o.title=`QPM v${e.current}\nUp to date.`)},Su.add(i),i(Au()),Eu();const a=document.createElement("button");a.type="button",a.dataset.qpmCollapseButton="true",a.className="qpm-button",a.setAttribute("aria-label","Collapse panel");const c=document.createElement("span");c.textContent="‚ñº",a.appendChild(c),t.append(n,o,a);const d=document.createElement("div");d.className="qpm-content";const p=document.createElement("div");p.className="qpm-nav";const u=document.createElement("div");u.className="qpm-tabs",d.append(p,u),e.append(t,d);const m=function(){const e=document.createElement("div");e.className="qpm-card",e.dataset.qpmSection="header",e.style.cssText="background: linear-gradient(135deg, rgba(143,130,255,0.08), rgba(143,130,255,0.03)); border: 1px solid rgba(143,130,255,0.15);";const t=document.createElement("div");t.className="qpm-card__header";const n=document.createElement("div");n.className="qpm-card__title",n.textContent="Session Overview",n.style.cssText="font-size: 14px; font-weight: 700; letter-spacing: 0.3px;";const o=Kg("‚ôª Reset Stats",Dg);o.classList.add("qpm-button--accent"),o.style.fontSize="11px",o.title="Reset header and detailed stats counters",t.append(n,o),e.appendChild(t);const r=document.createElement("div");r.style.cssText="display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:10px;margin-top:10px;",e.appendChild(r),ug();const i=function(e,t,n){const o=document.createElement("div");o.style.cssText=`padding:8px 10px;border-radius:6px;background:${n};border:1px solid ${n.replace("0.15","0.25")};display:flex;flex-direction:column;gap:4px;`;const r=document.createElement("div");r.className="indicator-header",r.style.cssText="display:flex;align-items:center;justify-content:space-between;gap:6px;margin-bottom:2px;";const i=document.createElement("div");return i.style.cssText="font-size:11px;font-weight:600;color:#b0b0b0;letter-spacing:0.3px;",i.textContent=`${e} ${t}`,r.appendChild(i),o.appendChild(r),o}("üê¢","Bella's Turtle Temple","rgba(0,150,136,0.15)"),a=i.querySelector(".indicator-header"),l=document.createElement("button");l.type="button",l.className="qpm-chip",l.style.cssText="cursor:pointer;user-select:none;font-size:9px;padding:2px 6px;",a.appendChild(l);const c=document.createElement("div");c.style.cssText="display:flex;align-items:center;justify-content:space-between;gap:4px;cursor:pointer;padding:4px 6px;background:rgba(255,255,255,0.04);border-radius:4px;margin:4px 0;transition:background 0.2s;",c.title="Click to select a different plant";const d=document.createElement("div");d.style.cssText="font-size:12px;font-weight:600;color:#e0f2f1;flex:1;",d.textContent="Loading...",c.appendChild(d);const p=document.createElement("span");p.style.cssText="font-size:9px;color:#80cbc4;",p.textContent="‚ñº",c.appendChild(p),i.appendChild(c);const u=document.createElement("select");u.className="qpm-select",u.style.cssText="display:none;width:100%;padding:4px 6px;font-size:10px;background:rgba(0,0,0,0.3);border:1px solid rgba(0,150,136,0.3);border-radius:4px;color:#e0e0e0;margin-bottom:6px;",i.appendChild(u);const g=document.createElement("option");g.value="",g.textContent="Select a plant...",g.disabled=!0,u.appendChild(g),c.addEventListener("click",e=>{e.stopPropagation();const t="none"===u.style.display;u.style.display=t?"block":"none",p.textContent=t?"‚ñ≤":"‚ñº",t&&m()}),c.addEventListener("mouseenter",()=>{c.style.background="rgba(255,255,255,0.08)"}),c.addEventListener("mouseleave",()=>{c.style.background="rgba(255,255,255,0.04)"}),u.addEventListener("change",()=>{const e=u.value;if(e){const{tileId:t,slotIndex:n}=Ju(e);yg.turtleTimer={...ug(),focus:"specific",focusTargetTileId:t,focusTargetSlotIndex:n},Yg(),vi({focus:"specific",focusTargetTileId:t,focusTargetSlotIndex:n}),u.style.display="none",p.textContent="‚ñº"}});const m=()=>{const e=Ti();for(;u.options.length>1;)u.remove(1);for(const t of e.plantTargets){const e=document.createElement("option");e.value=t.key;const n=t.species??"Unknown",o=null!=t.remainingMs?Ku(t.remainingMs):"Ready";e.textContent=`${n} - ${o}`,u.appendChild(e)}},f=document.createElement("div");f.style.cssText="font-size:11px;color:#e0f2f1;font-weight:500;margin-bottom:2px;",i.appendChild(f);const h=document.createElement("div");h.style.cssText="font-size:10px;color:#b2dfdb;line-height:1.4;",i.appendChild(h);const b=document.createElement("div");b.style.cssText="font-size:9px;color:#80cbc4;margin-top:4px;",i.appendChild(b),l.addEventListener("click",()=>{const e=!(yg.turtleTimer?.enabled??1);yg.turtleTimer={...ug(),enabled:e},Yg(),wi(e)}),Iu.turtleStatus=f,Iu.turtleDetail=h,Iu.turtleFooter=b,Iu.turtleEnableButtons.push(l),Iu.turtlePlantNameText=d,Iu.turtleUnsubscribe&&Iu.turtleUnsubscribe();Iu.turtleUnsubscribe=Si(e=>{fg(e)}),r.appendChild(i);const y=document.createElement("div");y.style.cssText="font-size:12px;font-weight:600;color:#64b5f6;margin-top:16px;margin-bottom:8px;text-transform:uppercase;letter-spacing:0.5px;",y.textContent="üè™ Shop Restock Tracker",e.appendChild(y);const x=document.createElement("div");x.style.cssText="display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:10px;",e.appendChild(x);const v=[{name:"Starweaver",emoji:"‚≠ê",color:"rgba(255,215,0,0.2)",textColor:"#FFD700"},{name:"Dawnbinder",emoji:"üåÖ",color:"rgba(255,152,0,0.2)",textColor:"#FF9800"},{name:"Moonbinder",emoji:"üåô",color:"rgba(156,39,176,0.2)",textColor:"#CE93D8"},{name:"Mythical Eggs",emoji:"ü•ö",color:"rgba(66,165,245,0.2)",textColor:"#42A5F5"}],w=e=>{const t=Date.now()-e,n=Math.floor(t/864e5),o=Math.floor(t/36e5),r=Math.floor(t/6e4);return n>0?1===n?"1 day ago":`${n} days ago`:o>0?1===o?"1 hour ago":`${o} hours ago`:r>0?1===r?"1 min ago":`${r} mins ago`:"Just now"},C=()=>{x.innerHTML="";const e=zp();v.forEach(t=>{let n=e.get(t.name);if(!n)for(const[p,u]of e.entries())if(p.includes(t.name)||t.name.includes(p)){n=u;break}const o=document.createElement("div");o.style.cssText=`\n        padding:12px;\n        background:${t.color};\n        border-radius:8px;\n        border:2px solid ${t.textColor}40;\n        box-shadow:0 2px 8px rgba(0,0,0,0.2);\n        transition:all 0.2s ease;\n        cursor:default;\n      `,o.addEventListener("mouseenter",()=>{o.style.transform="translateY(-2px)",o.style.boxShadow="0 4px 12px rgba(0,0,0,0.3)"}),o.addEventListener("mouseleave",()=>{o.style.transform="translateY(0)",o.style.boxShadow="0 2px 8px rgba(0,0,0,0.2)"});const r=document.createElement("div");r.style.cssText="display:flex;align-items:center;gap:6px;margin-bottom:8px;";let i=null,a="crop",s=t.name;"Mythical Eggs"===t.name?(a="pet",s="MythicalEgg",i=Fi(Yi("MythicalEgg"))):i=Fi(Qi(t.name));const l=document.createElement("div");l.style.cssText="width:24px;height:24px;display:flex;align-items:center;justify-content:center;flex-shrink:0;";const c=document.createElement("img");if(c.dataset.qpmSprite=`${a}:${s}`,c.alt=t.name,c.style.cssText="width:100%;height:100%;object-fit:contain;image-rendering:pixelated;",i)c.src=i,l.appendChild(c);else{c.style.display="none",l.appendChild(c);const e=document.createElement("span");e.textContent=t.emoji,e.style.fontSize="18px",e.className="qpm-sprite-fallback",l.appendChild(e)}const d=document.createElement("div");if(d.style.cssText=`font-size:11px;font-weight:700;color:${t.textColor};text-transform:uppercase;letter-spacing:0.5px;`,d.textContent=t.name,r.appendChild(l),r.appendChild(d),o.appendChild(r),n&&n.lastSeen){const e=new Date(n.lastSeen),r=e.toLocaleTimeString([],{hour:"numeric",minute:"2-digit",hour12:!0}),i=e.toLocaleDateString([],{month:"short",day:"numeric"}),a=w(n.lastSeen),s=document.createElement("div");s.style.cssText="margin-bottom:4px;";const l=document.createElement("div");l.style.cssText="font-size:13px;color:#fff;font-weight:600;",l.textContent=`${i} ${r}`,s.appendChild(l),o.appendChild(s);const c=document.createElement("div");c.style.cssText=`font-size:10px;color:${t.textColor};font-weight:600;background:rgba(0,0,0,0.2);padding:3px 8px;border-radius:4px;display:inline-block;`,c.textContent=a,o.appendChild(c)}else{const e=document.createElement("div");e.style.cssText="font-size:11px;color:#999;font-style:italic;text-align:center;padding:12px 0;",e.textContent="No data yet",o.appendChild(e)}x.appendChild(o)})};$p(),bu().catch(e=>{s("‚ö†Ô∏è Failed to start live shop tracking",e)});let T=null;return Op(()=>{null!==T&&clearTimeout(T),T=window.setTimeout(()=>{T=null,C()},500)}),C(),Bi(()=>{C()}),e}();await l(),function(){Fu&&(Fu(),Fu=null);const e=document.createElement("div");e.className="qpm-card",e.dataset.qpmSection="stats",e.style.cssText="background: linear-gradient(135deg, rgba(100,181,246,0.08), rgba(100,181,246,0.03)); border: 1px solid rgba(100,181,246,0.15);";const t=document.createElement("div");t.className="qpm-card__header",t.style.cssText="cursor: pointer; padding: 12px 14px; border-radius: 8px; transition: all 0.2s ease; user-select: none;";const n=document.createElement("div");n.className="qpm-card__title",n.textContent="üìä Detailed Stats",n.style.cssText="font-size: 14px; font-weight: 700; letter-spacing: 0.3px; color: #64b5f6;";const o=document.createElement("span");o.style.cssText="font-size: 14px; color: #64b5f6; transition: transform 0.2s ease;",o.textContent="‚ñº";const r=document.createElement("span");r.style.cssText="font-size: 10px; color: #90a4ae; margin-left: 8px; font-weight: 400;",r.textContent="(click to expand)",t.append(n,o,r);const i=document.createElement("div");i.style.cssText="display:block;margin-top:12px;font-size:11px;color:#dbe1ff;line-height:1.6;",t.addEventListener("click",()=>{const e="none"===i.style.display;i.style.display=e?"block":"none",o.textContent=e?"‚ñº":"‚ñ≤",o.style.transform=e?"rotate(0deg)":"rotate(180deg)",r.textContent=e?"(click to expand)":"(click to collapse)",t.style.background=e?"transparent":"rgba(100,181,246,0.08)"}),t.addEventListener("mouseenter",()=>{"none"===i.style.display&&(t.style.background="rgba(100,181,246,0.05)")}),t.addEventListener("mouseleave",()=>{"none"===i.style.display&&(t.style.background="transparent")});const a=document.createElement("div");a.textContent="‚òÄÔ∏è Weather Uptime",a.style.cssText="font-weight:700;color:#80deea;font-size:12px;margin-bottom:4px;text-transform:uppercase;letter-spacing:0.5px;margin-top:4px;";const s=document.createElement("div");s.style.cssText="color:#c0c0c0;font-size:10px;margin-bottom:10px;line-height:1.5;";const l=document.createElement("div");l.textContent="üõí Shop Stats",l.style.cssText="font-weight:700;color:#ffab91;font-size:12px;margin-bottom:4px;text-transform:uppercase;letter-spacing:0.5px;";const c=document.createElement("div");c.style.cssText="color:#f0f0f0;margin-bottom:3px;font-size:11px;line-height:1.5;";const d=document.createElement("div");d.style.cssText="color:#c0c0c0;font-size:10px;margin-bottom:8px;line-height:1.5;";const p=document.createElement("div");p.textContent="Recent Purchases",p.style.cssText="font-weight:700;font-size:11px;color:#d0d0d0;margin-top:8px;margin-bottom:4px;letter-spacing:0.5px;text-transform:uppercase;";const u=document.createElement("div");u.style.cssText="display:flex;flex-direction:column;gap:3px;font-size:10px;color:#b0b0b0;line-height:1.5;";const g=document.createElement("div");g.style.cssText="margin-top:14px;display:flex;justify-content:flex-end;padding-top:10px;border-top:1px solid rgba(255,255,255,0.08);";const m=Kg("‚ôª Reset Stats",Dg);m.classList.add("qpm-button--accent"),m.style.cssText="font-size:11px;font-weight:600;",g.append(m),i.append(a,s,l,c,d,p,u,g),e.append(t,i);Fu=fl(e=>{const{weather:t,shop:n}=e;const o=Object.entries(t.timeByKind).filter(([,e])=>e>0).sort((e,t)=>(t[1]??0)-(e[1]??0)).slice(0,3).map(([e,t])=>`${Ng(e)} ${Bg(t)}`);s.textContent=o.length>0?o.join(" ‚Ä¢ "):"No uptime recorded yet";const r=[];r.push(`Items ${n.totalPurchases}`);if(n.totalSpentCoins>0){r.push(`ü™ô ${Dn(n.totalSpentCoins)}`)}if(n.totalSpentCredits>0){r.push(`üç© ${n.totalSpentCredits.toLocaleString()}`)}c.textContent=r.join(" ‚Ä¢ ");const i=Object.entries(n.purchasesByCategory).filter(([,e])=>e>0).sort((e,t)=>(t[1]??0)-(e[1]??0)).map(([e,t])=>`${e}: ${t}`);d.textContent=i.length>0?i.join(" ‚Ä¢ "):"No purchases yet";u.innerHTML="";const a=n.history.slice(-5).reverse();if(a.length===0){const e=document.createElement("div");e.textContent="No recent purchases";u.appendChild(e)}else{for(const e of a){const t=document.createElement("div");const n=[];if(e.coins>0)n.push(`ü™ô ${Dn(e.coins)}`);if(e.credits>0)n.push(`üç© ${e.credits.toLocaleString()}`);const o=n.length?` (${n.join(" ‚Ä¢ ")})`:"";t.textContent=`${e.itemName} √ó${e.count}${o} ‚Äî ${Gn(e.timestamp)}`;u.appendChild(t)}}})}(),await l(),function(){if(Iu.notificationsSection)return Iu.notificationsSection;const e=document.createElement("div");e.className="qpm-card",e.dataset.qpmSection="notifications";const t=document.createElement("div");t.className="qpm-card__header";const n=document.createElement("div");n.className="qpm-card__title",n.textContent="üîî Notifications";const o=document.createElement("div");o.style.cssText="display:flex;gap:6px;flex-wrap:wrap";const r=Kg("",()=>{Pg(!Wu),C()});r.style.fontSize="10px";const i=Kg("",()=>{Uu=!Uu,g.set(Bu,Uu),kg();Ag(Vu?ju.find(e=>e.id===Vu)??null:null),Eg()});i.style.fontSize="10px";const a=Kg("Clear",()=>{Pi.length=0,Ei(),Sg(),Vu=null,Gu.clear(),Fg(null),$g([]),Eg()});a.style.fontSize="10px",o.append(r,i,a),t.append(n,o),e.appendChild(t);const s=document.createElement("div");s.style.cssText="display:flex;flex-direction:column;gap:8px;margin-top:8px;",e.appendChild(s);const l=document.createElement("div");l.style.cssText="display:flex;flex-wrap:wrap;gap:6px",s.appendChild(l);const c=document.createElement("div");c.style.cssText="max-height:240px;overflow-y:auto;padding-right:4px;",s.appendChild(c);const d=document.createElement("div");d.style.cssText="display:flex;flex-direction:column;gap:8px",c.appendChild(d);const p=document.createElement("div");p.textContent="No notifications yet.",p.style.cssText="font-size:11px;color:var(--qpm-text-muted);padding:12px;border:1px dashed rgba(255,255,255,0.1);border-radius:6px;text-align:center;",s.appendChild(p);const u=document.createElement("div");u.style.cssText="border:1px solid rgba(255,255,255,0.08);background:rgba(10,12,20,0.72);border-radius:8px;padding:12px;display:flex;flex-direction:column;gap:10px;min-height:120px",s.appendChild(u);const m=document.createElement("div");m.textContent="Select a notification to see full details.",m.style.cssText="font-size:11px;color:var(--qpm-text-muted);text-align:center;",u.appendChild(m);const f=document.createElement("div");f.style.cssText="display:none;justify-content:space-between;align-items:flex-start;gap:12px;",u.appendChild(f);const h=document.createElement("div");h.style.cssText="font-weight:600;font-size:12px;color:#fff;flex:1 1 auto;overflow:hidden;text-overflow:ellipsis;",f.appendChild(h);const b=document.createElement("div");b.style.cssText="font-size:10px;color:#ccc;white-space:nowrap;",f.appendChild(b);const y=document.createElement("div");y.style.cssText="display:none;flex-wrap:wrap;gap:6px;font-size:10px;color:#d7e3ff;",u.appendChild(y);const x=document.createElement("div");x.style.cssText="display:none;font-size:11px;line-height:1.5;color:#f5f7ff;white-space:pre-wrap;word-break:break-word;",u.appendChild(x);const v=document.createElement("div");v.style.cssText="display:none;flex-wrap:wrap;gap:6px;",u.appendChild(v);const w=document.createElement("pre");w.style.cssText="display:none;font-size:10px;color:#9cd2ff;background:rgba(255,255,255,0.05);padding:8px;border-radius:4px;margin:0;max-height:140px;overflow:auto;",u.appendChild(w),Iu.notificationsSection=e,Iu.notificationsFilterBar=l,Iu.notificationsListWrapper=c,Iu.notificationsList=d,Iu.notificationsEmpty=p,Iu.notificationsDetail=u,Iu.notificationsDetailHeader=f,Iu.notificationsDetailTitle=h,Iu.notificationsDetailTimestamp=b,Iu.notificationsDetailMeta=y,Iu.notificationsDetailMessage=x,Iu.notificationsDetailActions=v,Iu.notificationsDetailRaw=w,Iu.notificationsDetailPlaceholder=m,Iu.notificationsDetailToggle=i,Hu.clear(),Ou.clear(),_u=null,Gu.clear(),Vu=null,Fg(null),Iu.notificationsUnsubscribe?.(),Iu.notificationsUnsubscribe=Mi(e=>{if(ju=e,function(e){const t=Iu.notificationsFilterBar;if(!t)return;const n=Array.from(new Set(e.map(e=>e.feature))).sort();for(const o of Array.from(Hu))n.includes(o)||Hu.delete(o);t.textContent="",_u=Lg("All",()=>{Sg(),$g(ju)}),Rg(_u,0===Hu.size),t.appendChild(_u),Ou.clear();for(const o of n){const e=Lg(qg(o),()=>{Tg(o)});Rg(e,Hu.has(o)),t.appendChild(e),Ou.set(o,e)}}(e),$g(e),Vu){(e.find(e=>e.id===Vu)??null)||Fg(null)}});const C=()=>{r.textContent=Wu?"Expand":"Collapse",r.classList.toggle("qpm-button--accent",Wu)};C(),kg(),Pg(Wu),Ag(null),Eg()}(),await l(),Hg(),await l(),function(){Iu.mutationTrackerUnsubscribe&&(Iu.mutationTrackerUnsubscribe(),Iu.mutationTrackerUnsubscribe=null);null!=Iu.mutationTrackerTicker&&(Iu.mutationTrackerTicker(),Iu.mutationTrackerTicker=null);Iu.trackerAbilityHistoryUnsubscribe&&(Iu.trackerAbilityHistoryUnsubscribe(),Iu.trackerAbilityHistoryUnsubscribe=null);null!=Iu.trackerAbilityTicker&&(Iu.trackerAbilityTicker(),Iu.trackerAbilityTicker=null)}(),await l();const f=function(){const e=document.createElement("span");e.className="qpm-chip",e.textContent=null!==Ls?"Active":"Inactive";const{root:t,body:n}=bg("‚ù§Ô∏è Bulk Favorite",{collapsible:!0,startCollapsed:!0,subtitleElement:e});t.dataset.qpmSection="bulk-favorite";const o=document.createElement("div");o.className="qpm-section-muted",o.style.marginBottom="8px",o.textContent="Quickly favorite or unfavorite all produce of a species at once.",n.appendChild(o);const r=document.createElement("div");r.innerHTML="üí° <strong>How it works:</strong><br>‚Ä¢ Open your inventory<br>‚Ä¢ Buttons appear next to the inventory for each produce type<br>‚Ä¢ Click a button to favorite/unfavorite ALL items of that species<br>‚Ä¢ Heart indicator shows if all items are favorited",r.style.cssText="background:#333;padding:8px;border-radius:4px;margin-bottom:8px;font-size:10px;line-height:1.5;border-left:3px solid #FFCA28",n.appendChild(r);const i=document.createElement("div");return i.textContent="Tip: Open inventory to see the bulk favorite buttons on the right side of the modal.",i.style.cssText="font-size:10px;color:#A5D6A7;line-height:1.4;margin-top:8px;",n.appendChild(i),t}();await l();const h=Jg();await l(),xg(),await l(),vg();const b=new Map,y=new Map;let x=null;const v=e=>{if(x!==e){x=e;for(const[t,n]of b)n.classList.toggle("qpm-tab--active",t===e);for(const[t,n]of y){const o=t===e;if(n.classList.toggle("qpm-nav__button--active",o),n.dataset.tabColor){const e=n.dataset.tabColor,t=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/),r=t?`rgba(${t[1]}, ${t[2]}, ${t[3]}, 0.4)`:e,i=n.dataset.windowId,a=i&&mc(i);o||a?(n.style.background=e,n.style.boxShadow=`0 4px 14px ${r}, inset 0 1px 0 rgba(255,255,255,0.1)`,n.style.borderColor=e.replace("0.28","0.6")):(n.style.background=e.replace("0.28","0.12"),n.style.boxShadow=`0 2px 8px ${r.replace("0.4","0.15")}`,n.style.borderColor=e.replace("0.28","0.3"))}}}},w=(e,t,n,o)=>{const r=document.createElement("button");r.type="button",r.className="qpm-nav__button",r.innerHTML=`${n}<span>${t}</span>`,o.length>0&&r.addEventListener("click",()=>v(e));const i={dashboard:"rgba(76, 175, 80, 0.28)",turtle:"rgba(33, 150, 243, 0.28)",trackers:"rgba(156, 39, 176, 0.28)","xp-tracker":"rgba(255, 152, 0, 0.28)","shop-restock":"rgba(0, 188, 212, 0.28)","pet-hub":"rgba(103, 58, 183, 0.28)","pet-optimizer":"rgba(244, 67, 54, 0.28)","public-rooms":"rgba(233, 30, 99, 0.28)","crop-boost":"rgba(139, 195, 74, 0.28)",achievements:"rgba(255, 215, 64, 0.28)","auto-favorite":"rgba(255, 235, 59, 0.28)","garden-filters":"rgba(63, 81, 181, 0.28)","journal-checker":"rgba(121, 85, 72, 0.28)",guide:"rgba(96, 125, 139, 0.28)",weather:"rgba(156, 39, 176, 0.28)","bulk-favorite":"rgba(244, 143, 177, 0.28)"};if(i[e]){const t=i[e];r.dataset.tabColor=t;const n=t.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/),o=n?`rgba(${n[1]}, ${n[2]}, ${n[3]}, 0.15)`:t;r.style.background=t.replace("0.28","0.12"),r.style.boxShadow=`0 2px 8px ${o}`,r.style.borderColor=t.replace("0.28","0.3")}p.appendChild(r),y.set(e,r);const a=document.createElement("div");a.className="qpm-tab";for(const s of o)a.appendChild(s);u.appendChild(a),b.set(e,a)},C=await wg(),T=await async function(){const{root:e,body:t}=bg("Garden Filters",{subtitle:"Filter visible crops and eggs in your garden"});e.dataset.qpmSection="garden-filters";const n=Od(),o=document.createElement("label");o.style.cssText="\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 12px;\n    background: var(--qpm-surface-1, #1a1a1a);\n    border-radius: 8px;\n    cursor: pointer;\n    margin-bottom: 16px;\n  ";const r=document.createElement("input");r.type="checkbox",r.checked=n.enabled,r.style.cssText="width: 20px; height: 20px; cursor: pointer;",r.addEventListener("change",()=>{Gd({enabled:r.checked})});const i=document.createElement("span");i.textContent="Enable Garden Filters",i.style.cssText="font-weight: 600; font-size: 14px; color: var(--qpm-text, #fff);",o.appendChild(r),o.appendChild(i),t.appendChild(o);const a=document.createElement("div");a.style.cssText="\n    padding: 12px;\n    background: rgba(63, 81, 181, 0.1);\n    border-left: 3px solid rgba(63, 81, 181, 0.6);\n    border-radius: 4px;\n    margin-bottom: 16px;\n    font-size: 12px;\n    line-height: 1.6;\n    color: var(--qpm-text-muted, #aaa);\n  ",a.innerHTML='\n    <strong>How it works:</strong><br>\n    ‚Ä¢ Dims non-matching crops to alpha 0.1 (barely visible)<br>\n    ‚Ä¢ Uses "ANY" logic: shows crops with ANY selected filter<br>\n    ‚Ä¢ Example: Rainbow filter shows Rainbow, Rainbow+Frozen, etc.<br>\n    ‚Ä¢ Future-proof: Uses catalog data (auto-updates with game)\n  ',t.appendChild(a);const s=document.createElement("div");s.style.cssText="margin-bottom: 16px;";const l=document.createElement("h4");l.textContent="Mutation Filters",l.style.cssText="\n    margin: 0 0 8px 0;\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--qpm-accent, #4CAF50);\n  ",s.appendChild(l);const c=window.__QPM_CATALOGS?.mutationCatalog||{};for(const[C,T]of Object.entries(c)){const e=document.createElement("label");e.style.cssText="\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      padding: 8px;\n      cursor: pointer;\n      border-radius: 4px;\n      transition: background 0.2s;\n    ",e.addEventListener("mouseenter",()=>{e.style.background="rgba(255, 255, 255, 0.05)"}),e.addEventListener("mouseleave",()=>{e.style.background="transparent"});const t=document.createElement("input");t.type="checkbox",t.checked=n.mutations.includes(C),t.style.cssText="width: 16px; height: 16px; cursor: pointer;",t.addEventListener("change",()=>{const e=Od().mutations;Gd({mutations:t.checked?[...e,C]:e.filter(e=>e!==C)})});const o=Ji("Sunflower",[C]),r=document.createElement("img");r.dataset.qpmSprite=`crop:Sunflower:${C}`,r.title=T.name||C,r.style.cssText="\n      width: 24px;\n      height: 24px;\n      object-fit: contain;\n      image-rendering: pixelated;\n      flex-shrink: 0;\n    ",o&&(r.src=Fi(o));const i=document.createElement("span");i.textContent=T.name||C,i.style.cssText="font-size: 13px; color: var(--qpm-text, #fff);",e.appendChild(t),e.appendChild(r),e.appendChild(i),s.appendChild(e)}t.appendChild(s);const d=document.createElement("div");d.style.cssText="margin-bottom: 16px;";const p=document.createElement("h4");p.textContent="Crop Species Filters",p.style.cssText="\n    margin: 0 0 8px 0;\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--qpm-accent, #4CAF50);\n  ",d.appendChild(p);const u=Ud();for(const C of u){const e=document.createElement("label");e.style.cssText="\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      padding: 8px;\n      cursor: pointer;\n      border-radius: 4px;\n      transition: background 0.2s;\n    ",e.addEventListener("mouseenter",()=>{e.style.background="rgba(255, 255, 255, 0.05)"}),e.addEventListener("mouseleave",()=>{e.style.background="transparent"});const t=document.createElement("input");t.type="checkbox",t.checked=n.cropSpecies.includes(C),t.style.cssText="width: 16px; height: 16px; cursor: pointer;",t.addEventListener("change",()=>{const e=Od().cropSpecies;Gd({cropSpecies:t.checked?[...e,C]:e.filter(e=>e!==C)})});const o=window.QPM?.spriteExtractor?.getCropSprite(C),r=document.createElement("img");r.dataset.qpmSprite=`crop:${C}`,r.title=C,r.style.cssText="\n      width: 24px;\n      height: 24px;\n      object-fit: contain;\n      image-rendering: pixelated;\n      flex-shrink: 0;\n    ",o&&(r.src=Fi(o));const i=document.createElement("span");i.textContent=C,i.style.cssText="font-size: 13px; color: var(--qpm-text, #fff);",e.appendChild(t),e.appendChild(r),e.appendChild(i),d.appendChild(e)}t.appendChild(d);const g=document.createElement("div");g.style.cssText="margin-bottom: 16px;";const m=document.createElement("h4");m.textContent="Egg Type Filters",m.style.cssText="\n    margin: 0 0 8px 0;\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--qpm-accent, #4CAF50);\n  ",g.appendChild(m);const f=Xd();for(const C of f){const e=document.createElement("label");e.style.cssText="\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      padding: 8px;\n      cursor: pointer;\n      border-radius: 4px;\n      transition: background 0.2s;\n    ",e.addEventListener("mouseenter",()=>{e.style.background="rgba(255, 255, 255, 0.05)"}),e.addEventListener("mouseleave",()=>{e.style.background="transparent"});const t=document.createElement("input");t.type="checkbox",t.checked=n.eggTypes.includes(C),t.style.cssText="width: 16px; height: 16px; cursor: pointer;",t.addEventListener("change",()=>{const e=Od().eggTypes;Gd({eggTypes:t.checked?[...e,C]:e.filter(e=>e!==C)})});const o=(window.__QPM_CATALOGS?.eggCatalog||{})[C],r=o?.name||C,i=document.createElement("span");i.textContent=r,i.style.cssText="font-size: 13px; color: var(--qpm-text, #fff);",e.appendChild(t),e.appendChild(i),g.appendChild(e)}t.appendChild(g);const h=document.createElement("div");h.style.cssText="margin-bottom: 16px;";const b=document.createElement("h4");b.textContent="Growth State Filters",b.style.cssText="\n    margin: 0 0 8px 0;\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--qpm-accent, #4CAF50);\n  ",h.appendChild(b);const y=[{id:"mature",label:"Mature Only"},{id:"growing",label:"Growing Only"}];for(const C of y){const e=document.createElement("label");e.style.cssText="\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      padding: 8px;\n      cursor: pointer;\n      border-radius: 4px;\n      transition: background 0.2s;\n    ",e.addEventListener("mouseenter",()=>{e.style.background="rgba(255, 255, 255, 0.05)"}),e.addEventListener("mouseleave",()=>{e.style.background="transparent"});const t=document.createElement("input");t.type="checkbox",t.checked=n.growthStates.includes(C.id),t.style.cssText="width: 16px; height: 16px; cursor: pointer;",t.addEventListener("change",()=>{const e=Od().growthStates;Gd({growthStates:t.checked?[...e,C.id]:e.filter(e=>e!==C.id)})});const o=document.createElement("span");o.textContent=C.label,o.style.cssText="font-size: 13px; color: var(--qpm-text, #fff);",e.appendChild(t),e.appendChild(o),h.appendChild(e)}t.appendChild(h);const x=document.createElement("div");x.style.cssText="display: flex; gap: 8px; margin-top: 16px;";const v=document.createElement("button");v.textContent="Apply Filters",v.className="qpm-button qpm-button--positive",v.addEventListener("click",()=>{Vd()});const w=document.createElement("button");return w.textContent="Reset All",w.className="qpm-button",w.addEventListener("click",()=>{Wd()}),x.appendChild(v),x.appendChild(w),t.appendChild(x),e}(),S=ws(),P=function(){const{root:e,body:t}=bg("üìñ Magic Garden Guide",{subtitle:"Reference guide for game mechanics"});e.dataset.qpmSection="guide";const n=document.createElement("div");n.style.cssText="\n    width: 100%;\n    text-align: center;\n    padding: 12px;\n    background: var(--qpm-surface-1, #1a1a1a);\n    border-radius: 8px;\n    position: relative;\n  ";const o=document.createElement("div");o.textContent="(Click to open full size!)",o.style.cssText="\n    position: absolute;\n    top: 20px;\n    right: 20px;\n    color: rgba(150, 150, 150, 0.7);\n    font-size: 12px;\n    font-style: italic;\n    background: rgba(0, 0, 0, 0.5);\n    padding: 4px 8px;\n    border-radius: 4px;\n    pointer-events: none;\n    z-index: 10;\n  ";const r=document.createElement("img");return r.src="https://raw.githubusercontent.com/ryandt2305-cpu/QPM-GR/master/docs/product/MGGuide.jpeg",r.alt="Magic Garden Guide",r.style.cssText="\n    width: 100%;\n    max-width: 100%;\n    height: auto;\n    border-radius: 8px;\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);\n    cursor: pointer;\n    transition: transform 0.2s;\n    display: block;\n  ",r.addEventListener("mouseenter",()=>{r.style.transform="scale(1.02)"}),r.addEventListener("mouseleave",()=>{r.style.transform="scale(1)"}),r.addEventListener("click",()=>{window.open(r.src,"_blank")}),r.onerror=()=>{n.innerHTML='\n      <div style="padding: 40px; color: var(--qpm-text-muted, #999); font-style: italic;">\n        üìñ Guide image not found. Please ensure MGGuide.jpeg is uploaded to the master branch of the repository.\n      </div>\n    '},n.appendChild(o),n.appendChild(r),t.appendChild(n),e}();w("dashboard","Dashboard","üìä",[m]),w("turtle","Turtle Timer","üê¢",[]),w("trackers","Trackers","üìà",[]),w("xp-tracker","XP Tracker","‚ú®",[]),w("shop-restock","Shop Restock","üè™",[]),w("pet-hub","Pet Hub","üêæ",[]),w("pet-optimizer","Pet Optimizer","üéØ",[]),w("public-rooms","Public Rooms","üåê",[]),w("crop-boost","Crop Boosts","üå±",[]),w("achievements","Achievements","üèÜ",[]),w("auto-favorite","Auto-Favorite","‚≠ê",[C]),w("garden-filters","Garden Filters","üîç",[T]),w("journal-checker","Journal","üìî",[S]),w("guide","Guide","üìñ",[P]),w("weather","Reminders","üîî",[h]),w("bulk-favorite","Bulk Favorite","‚ù§Ô∏è",[f]);const k=y.get("trackers");if(k){const e=k.cloneNode(!0);e.dataset.windowId="trackers-detail",e.addEventListener("click",()=>{lc("trackers-detail","üìä Ability & Mutation Trackers",Wg)}),k.replaceWith(e),y.set("trackers",e)}const A=y.get("xp-tracker");if(A){const e=A.cloneNode(!0);e.addEventListener("click",async()=>{try{const{createXpTrackerWindow:e,showXpTrackerWindow:t,hideXpTrackerWindow:n,setGlobalXpTrackerState:o}=await Promise.resolve().then(()=>hx);Iu.xpTrackerWindow||(Iu.xpTrackerWindow=e(),o(Iu.xpTrackerWindow));"none"!==Iu.xpTrackerWindow.root.style.display?n(Iu.xpTrackerWindow):t(Iu.xpTrackerWindow)}catch(e){s("‚ö†Ô∏è Failed to toggle XP Tracker window",e)}}),A.replaceWith(e),y.set("xp-tracker",e)}const E=y.get("shop-restock");if(E){const e=E.cloneNode(!0);e.addEventListener("click",async()=>{try{const{createShopRestockWindow:e,showShopRestockWindow:t,hideShopRestockWindow:n}=await Promise.resolve().then(()=>qx);Iu.shopRestockWindow||(Iu.shopRestockWindow=e());"none"!==Iu.shopRestockWindow.root.style.display?n(Iu.shopRestockWindow):t(Iu.shopRestockWindow)}catch(e){s("‚ö†Ô∏è Failed to toggle Shop Restock window",e)}}),E.replaceWith(e),y.set("shop-restock",e)}const $=y.get("public-rooms");if($){const e=$.cloneNode(!0);e.dataset.windowId="public-rooms",e.addEventListener("click",()=>{lc("public-rooms","üåê Public Rooms",e=>{Promise.resolve().then(()=>Hy).then(({renderPublicRoomsWindow:t})=>{t(e)}).catch(e=>{s("‚ö†Ô∏è Failed to load Public Rooms window",e)})},"950px","85vh")}),$.replaceWith(e),y.set("public-rooms",e)}const M=y.get("crop-boost");if(M){const e=M.cloneNode(!0);e.addEventListener("click",async()=>{try{const{openCropBoostTrackerWindow:e}=await Promise.resolve().then(()=>Ox);e()}catch(e){s("‚ö†Ô∏è Failed to open Crop Boost Tracker window",e)}}),M.replaceWith(e),y.set("crop-boost",e)}const I=y.get("achievements");if(I){const e=I.cloneNode(!0);e.dataset.windowId="achievements",e.addEventListener("click",()=>{lc("achievements","üèÜ Achievements",async e=>{e.innerHTML='<div style="display:flex;align-items:center;justify-content:center;min-height:200px;color:var(--qpm-text-dim);"><span>‚è≥ Loading Achievements...</span></div>',await new Promise(e=>requestAnimationFrame(e));try{const{createAchievementsWindow:t}=await Promise.resolve().then(()=>Fv);e.innerHTML="";const n=t();n.root.dataset.achievementsRoot="true",e.appendChild(n.root)}catch(t){s("‚ö†Ô∏è Failed to load Achievements window",t),e.innerHTML='<div style="color:#ff6b6b;padding:20px;text-align:center;">Failed to load Achievements</div>'}},void 0,"90vh")}),I.replaceWith(e),y.set("achievements",e)}const F=y.get("turtle");if(F){const e=F.cloneNode(!0);e.dataset.windowId="turtle-timer",e.addEventListener("click",()=>{lc("turtle-timer","üê¢ Bella's Turtle Temple",Xg)}),F.replaceWith(e),y.set("turtle",e)}const z=y.get("weather");if(z){const e=z.cloneNode(!0);e.addEventListener("click",()=>{lc("reminders","üîî Reminders",Qg,"650px","85vh")}),z.replaceWith(e),y.set("weather",e)}const L=y.get("pet-hub");if(L){const e=L.cloneNode(!0);e.dataset.windowId="pet-hub",e.addEventListener("click",()=>{lc("pet-hub","üêæ Pet Hub",async e=>{e.innerHTML='<div style="display:flex;align-items:center;justify-content:center;min-height:200px;color:var(--qpm-text-dim);"><span>‚è≥ Loading Pet Hub...</span></div>',await new Promise(e=>requestAnimationFrame(e));try{const{renderPetHubWindow:t}=await Promise.resolve().then(()=>Ww);e.innerHTML="",t(e)}catch(t){s("‚ö†Ô∏è Failed to load Pet Hub window",t),e.innerHTML='<div style="color:#ff6b6b;padding:20px;text-align:center;">Failed to load Pet Hub</div>'}},"1600px","92vh")}),L.replaceWith(e),y.set("pet-hub",e)}const R=y.get("pet-optimizer");if(R){const e=R.cloneNode(!0);e.dataset.windowId="pet-optimizer",e.addEventListener("click",async()=>{try{const{openPetOptimizerWindow:e}=await Promise.resolve().then(()=>TC);e()}catch(e){s("‚ö†Ô∏è Failed to load Pet Optimizer window",e)}}),R.replaceWith(e),y.set("pet-optimizer",e)}v("dashboard");const q=(t,n)=>{e.style.left=`${t}px`,e.style.top=`${n}px`,e.style.right="auto",e.style.bottom="auto"},N=g.get(Ru,null);N&&Number.isFinite(N.left)&&Number.isFinite(N.top)&&q(N.left,N.top);const B=t=>{d.style.display=t?"none":"",c.textContent=t?"‚ñ≤":"‚ñº",a.setAttribute("aria-expanded",String(!t)),e.style.overflowY=t?"visible":"auto",g.set(qu,t)};a.addEventListener("pointerdown",e=>{e.stopPropagation()}),a.addEventListener("click",e=>{e.stopPropagation();const t="none"===d.style.display;B(!t)}),B(!!g.get(qu,!1));let D=!1,H=!1,j=null,_=0,O=0,G=!1;const V=(e,t,n)=>Math.min(Math.max(e,t),n),W=t=>{if(!D||j!==t.pointerId)return;const n=e.offsetWidth,o=e.offsetHeight,r=Math.max(8,window.innerWidth-n-8),i=Math.max(8,window.innerHeight-o-8),a=V(t.clientX-_,8,r),s=V(t.clientY-O,8,i),l=e.getBoundingClientRect();!H&&(Math.abs(a-l.left)>2||Math.abs(s-l.top)>2)&&(H=!0),q(a,s)},U=n=>{if(D&&j===n.pointerId){if(D=!1,window.removeEventListener("pointermove",W),window.removeEventListener("pointerup",U),window.removeEventListener("pointercancel",U),e.hasPointerCapture&&e.hasPointerCapture(n.pointerId))e.releasePointerCapture(n.pointerId);else try{e.releasePointerCapture(n.pointerId)}catch{}if(t.style.touchAction="",H){G=!0;const t=e.getBoundingClientRect();g.set(Ru,{left:Math.round(t.left),top:Math.round(t.top)})}j=null,H=!1}};return t.addEventListener("pointerdown",n=>{const o=n.target;if(o&&o.closest("[data-qpm-collapse-button]"))return;if(o&&o.closest(".qpm-version-bubble"))return;if(!n.isPrimary)return;if("mouse"===n.pointerType){if(0!==n.button)return;if(1&~n.buttons)return}window.addEventListener("pointermove",W),window.addEventListener("pointerup",U),window.addEventListener("pointercancel",U),D=!0,H=!1,G=!1,j=n.pointerId;const r=e.getBoundingClientRect();_=n.clientX-r.left,O=n.clientY-r.top,e.setPointerCapture&&e.setPointerCapture(n.pointerId),t.style.touchAction="none",n.preventDefault()}),t.addEventListener("click",()=>{if(G)return void(G=!1);const e="none"===d.style.display;B(!e)}),window.addEventListener("resize",()=>{const t=e.getBoundingClientRect(),n=e.offsetWidth,o=e.offsetHeight,r=Math.max(8,window.innerWidth-n-8),i=Math.max(8,window.innerHeight-o-8),a=V(t.left,8,r),s=V(t.top,8,i);(Math.abs(a-t.left)>1||Math.abs(s-t.top)>1)&&(q(a,s),g.set(Ru,{left:Math.round(a),top:Math.round(s)}))}),document.body.appendChild(e),Iu.panel=e,Iu.content=d,e}function Tg(e){Hu.has(e)?Hu.delete(e):Hu.add(e),0===Hu.size?Rg(_u,!0):Rg(_u,!1);for(const[t,n]of Ou)Rg(n,Hu.has(t));$g(ju)}function Sg(){Hu.clear(),Rg(_u,!0);for(const e of Ou.values())Rg(e,!1);Eg()}function Pg(e){Wu=e;try{g.set(Nu,e)}catch(t){console.warn("[qpm] failed to persist notification collapse state",t)}Eg()}function kg(){const e=Iu.notificationsDetailToggle;e&&(e.textContent=Uu?"Hide extra info":"Show extra info",e.classList.toggle("qpm-button--positive",Uu))}function Ag(e){const t=Iu.notificationsDetailMeta,n=Iu.notificationsDetailActions,o=Iu.notificationsDetailRaw;if(t&&n&&o)return e?void(Uu?(t.style.display="flex",n.style.display=n.childElementCount>0?"flex":"none",o.style.display="block"):(t.style.display="none",n.style.display="none",o.style.display="none")):(t.style.display="none",n.style.display="none",void(o.style.display="none"))}function Eg(){const e=Iu.notificationsFilterBar,t=Iu.notificationsListWrapper,n=Iu.notificationsEmpty,o=Iu.notificationsDetail,r=Iu.notificationsDetailToggle,i=Iu.notificationsSection;i&&(i.dataset.collapsed=Wu?"true":"false");const a=Xu>0;e&&(e.style.display=Wu?"none":"flex"),t&&(t.style.display=Wu?"none":a?"block":"none"),n&&(n.style.display=Wu||a?"none":"block"),o&&(o.style.display=Wu?"none":Uu?"flex":"none"),r&&(r.style.display=Wu?"none":"inline-flex",r.disabled=!Vu,r.style.opacity=r.disabled?"0.6":"1")}function $g(e){ju=e;const t=Iu.notificationsList,n=Iu.notificationsEmpty;if(!t||!n)return;const o=Hu.size>0?e.filter(e=>Hu.has(e.feature)):e;Vu&&!o.some(e=>e.id===Vu)&&(Vu=null);const r=o.slice().reverse();if(Xu=r.length,r.length>0&&!Vu&&(Vu=r[0]?.id??null),t.textContent="",Gu.clear(),0===r.length)return t.style.display="none",n.style.display="block",Fg(null),void Eg();t.style.display="flex",n.style.display="none";for(const i of r){const e=Mg(i);Gu.set(i.id,e),t.appendChild(e)}Ig();Fg(r.find(e=>e.id===Vu)??null),Eg()}function Mg(e){const t=zu[e.level]||zu.info,n=Lu[e.level]||Lu.info,o=document.createElement("button");o.type="button",o.dataset.notificationId=e.id,o.dataset.accent=t,o.setAttribute("aria-pressed","false"),o.style.cssText=`\n    text-align: left;\n    background: linear-gradient(135deg, rgba(255,255,255,0.04), rgba(255,255,255,0.01));\n    border: 1px solid rgba(255,255,255,0.1);\n    border-left: 4px solid ${t};\n    border-radius: 8px;\n    padding: 12px 14px;\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    color: #f8f8f8;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    backdrop-filter: blur(8px);\n  `,o.addEventListener("click",()=>function(e){Vu=e.id,Ig(),Fg(e)}(e)),o.addEventListener("mouseenter",()=>{o.dataset.notificationId!==Vu&&(o.style.background="linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03))",o.style.borderColor="rgba(255,255,255,0.16)",o.style.transform="translateX(2px)")}),o.addEventListener("mouseleave",()=>{o.dataset.notificationId!==Vu&&(o.style.background="linear-gradient(135deg, rgba(255,255,255,0.04), rgba(255,255,255,0.01))",o.style.borderColor="rgba(255,255,255,0.1)",o.style.transform="none")});const r=document.createElement("div");r.style.cssText="display:flex;justify-content:space-between;align-items:center;gap:10px;";const i=document.createElement("div");i.style.cssText="display:flex;align-items:center;gap:8px;flex-wrap:wrap;flex:1;";const a=document.createElement("span");a.textContent=n,a.style.cssText=`\n    font-size: 16px;\n    line-height: 1;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    background: ${t}14;\n    border-radius: 6px;\n    flex-shrink: 0;\n  `,i.appendChild(a);const s=document.createElement("span");if(s.textContent=qg(e.feature),s.style.cssText="\n    background: rgba(143,130,255,0.12);\n    padding: 3px 8px;\n    border-radius: 6px;\n    font-size: 11px;\n    color: #c7b8ff;\n    font-weight: 600;\n    letter-spacing: 0.3px;\n  ",i.appendChild(s),"warn"===e.level||"error"===e.level){const n=document.createElement("span");n.textContent=e.level.toUpperCase(),n.style.cssText=`\n      padding: 3px 8px;\n      border-radius: 6px;\n      background: ${t}20;\n      color: ${t};\n      font-size: 10px;\n      font-weight: 700;\n      letter-spacing: 0.5px;\n    `,i.appendChild(n)}const l=document.createElement("span");l.textContent=Gn(e.timestamp),l.title=new Date(e.timestamp).toLocaleString(),l.style.cssText="\n    font-size: 11px;\n    color: rgba(255,255,255,0.4);\n    white-space: nowrap;\n    flex-shrink: 0;\n    font-weight: 500;\n  ",r.append(i,l),o.appendChild(r);const c=e.message.length>160?`${e.message.slice(0,160)}‚Ä¶`:e.message,d=document.createElement("div");if(d.textContent=c,d.style.cssText="\n    font-size: 12px;\n    color: rgba(255,255,255,0.85);\n    line-height: 1.6;\n    margin-left: 36px;\n  ",o.appendChild(d),Array.isArray(e.actions)&&e.actions.length>0){const t=document.createElement("div");t.textContent=`‚ö° ${e.actions.length} quick action${e.actions.length>1?"s":""} available`,t.style.cssText="\n      font-size: 11px;\n      color: #90caf9;\n      margin-left: 36px;\n      font-weight: 500;\n    ",o.appendChild(t)}return o}function Ig(){for(const[e,t]of Gu){const n=t.dataset.accent??zu.info;e===Vu?(t.style.background=`linear-gradient(135deg, ${n}14, ${n}08)`,t.style.borderColor=`${n}`,t.style.borderLeftWidth="4px",t.style.boxShadow=`0 4px 12px ${n}30, inset 0 0 0 1px ${n}20`,t.style.transform="translateX(4px)",t.setAttribute("aria-pressed","true")):(t.style.background="linear-gradient(135deg, rgba(255,255,255,0.04), rgba(255,255,255,0.01))",t.style.borderColor="rgba(255,255,255,0.1)",t.style.borderLeftWidth="4px",t.style.boxShadow="none",t.style.transform="none",t.setAttribute("aria-pressed","false"))}}function Fg(e){const t=Iu.notificationsDetailPlaceholder,n=Iu.notificationsDetailHeader,o=Iu.notificationsDetailTitle,r=Iu.notificationsDetailTimestamp,i=Iu.notificationsDetailMeta,a=Iu.notificationsDetailMessage,s=Iu.notificationsDetailActions,l=Iu.notificationsDetailRaw;if(!(t&&n&&o&&r&&i&&a&&s&&l))return;if(!e)return t.style.display="block",n.style.display="none",a.style.display="none",i.style.display="none",s.style.display="none",l.style.display="none",l.textContent="",kg(),void Eg();t.style.display="none",n.style.display="flex",a.style.display="block";const c=new Date(e.timestamp);if(o.textContent=`${qg(e.feature)} ‚Äî ${e.level.toUpperCase()}`,o.title=e.message,r.textContent=`${Gn(e.timestamp)} ‚Ä¢ ${c.toLocaleString()}`,i.textContent="",i.appendChild(zg("ID",e.id)),i.appendChild(zg("Feature",qg(e.feature))),i.appendChild(zg("Level",e.level.toUpperCase())),a.textContent=e.message,s.textContent="",Array.isArray(e.actions)&&e.actions.length>0)for(const u of e.actions){const e=document.createElement("button");e.type="button",e.textContent=u.label,e.className="qpm-button",e.style.fontSize="10px",e.addEventListener("click",()=>{try{u.onClick()}catch(e){console.error("[qpm] notification action error",e)}}),s.appendChild(e)}const d=Array.isArray(e.actions)?e.actions.map(({label:e})=>({label:e})):void 0,p={...e,actions:d};l.textContent=JSON.stringify(p,null,2),l.scrollTop=0,Ag(e),kg(),Eg()}function zg(e,t){const n=document.createElement("span");n.style.cssText="padding:2px 6px;border-radius:4px;background:rgba(255,255,255,0.08);color:#d7e3ff;display:inline-flex;gap:4px;align-items:center;";const o=document.createElement("span");o.textContent=`${e}:`,o.style.cssText="font-weight:600;color:#ffffff;",n.appendChild(o);const r=document.createElement("span");return r.textContent=t,n.appendChild(r),n}function Lg(e,t){const n=document.createElement("button");return n.type="button",n.textContent=e,n.className="qpm-button",n.style.fontSize="10px",n.addEventListener("click",t),n}function Rg(e,t){e&&(e.dataset.active=t?"true":"false",t?e.classList.add("qpm-button--positive"):e.classList.remove("qpm-button--positive"))}function qg(e){return e?e.split(/[^a-zA-Z0-9]+/g).filter(Boolean).map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):"General"}function Ng(e){return e?e.split(/[_\s]+/).filter(Boolean).map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):"Unknown"}function Bg(e){const t=Math.max(0,Math.floor(e)),n=Math.floor(t/1e3),o=Math.floor(n/3600),r=Math.floor(n%3600/60),i=n%60;return o>0?`${o}h ${r}m`:r>0?`${r}m ${i.toString().padStart(2,"0")}s`:`${i}s`}function Dg(){bl(),function(){if(!Iu.headerWeather)return;let e="Unknown";const t=[];try{e=Ng(Pe().kind),t.push(e)}catch{t.push(e)}0===t.length&&t.push(e),Iu.headerWeather.textContent=t.join(" ‚Ä¢ ")}(),function(e){!function(){if(document.getElementById(Du))return;const e=document.createElement("style");e.id=Du,e.textContent="@keyframes qpm-toast-in { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 0.95; } }",document.head.appendChild(e)}();const t=document.createElement("div");t.textContent=e,t.style.cssText="position:fixed;bottom:24px;right:24px;background:#2e7d32;color:#fff;padding:8px 12px;border-radius:6px;font-size:12px;z-index:2147483647;opacity:0.95;animation:qpm-toast-in 0.3s ease",document.body.appendChild(t),setTimeout(()=>t.remove(),2500)}("Stats reset")}function Hg(){const{root:e,body:t}=bg("üê¢ Bella's Turtle Temple",{subtitle:"Growth, eggs, and support breakdown"});e.dataset.qpmSection="turtle-timer";const n=ug(),o=document.createElement("div");o.style.cssText="display:flex;flex-wrap:wrap;gap:10px;align-items:center;";const r=document.createElement("button");r.type="button",r.className="qpm-chip",r.style.cssText="cursor:pointer;user-select:none;min-width:84px;text-align:center;",r.addEventListener("click",()=>{const e=!(yg.turtleTimer?.enabled??1);yg.turtleTimer={...ug(),enabled:e},Yg(),wi(e)}),o.appendChild(r),Iu.turtleEnableButtons.push(r);const i=document.createElement("label");i.style.cssText="display:inline-flex;align-items:center;gap:6px;font-size:11px;color:#b2dfdb;";const a=document.createElement("select");a.className="qpm-select",a.style.cssText="min-width:120px;padding:4px 8px;font-size:11px;",a.addEventListener("click",e=>e.stopPropagation());const s=document.createElement("option");s.value="latest",s.textContent="Latest finish";const l=document.createElement("option");l.value="earliest",l.textContent="Earliest finish";const c=document.createElement("option");c.value="specific",c.textContent="Specific plant",a.append(s,l,c),a.value=n.focus;const d=document.createElement("label");d.style.cssText="display:inline-flex;align-items:center;gap:6px;font-size:11px;color:#b2dfdb;",d.style.display="specific"===n.focus?"inline-flex":"none";const p=document.createElement("select");p.className="qpm-select",p.style.cssText="min-width:180px;padding:4px 8px;font-size:11px;",p.addEventListener("click",e=>e.stopPropagation()),a.addEventListener("change",()=>{const e=a.value,t="earliest"===e?"earliest":"specific"===e?"specific":"latest",n={...ug(),focus:t};yg.turtleTimer=n,Yg();const o={focus:t};"specific"===t&&(o.focusTargetTileId=n.focusTargetTileId,o.focusTargetSlotIndex=n.focusTargetSlotIndex),vi(o),d.style.display="specific"===t?"inline-flex":"none"});const u=document.createElement("span");u.textContent="Focus",i.append(u,a),o.appendChild(i),Iu.turtleFocusSelects.push(a);const g=document.createElement("span");g.textContent="Target plant",d.append(g,p),o.appendChild(d),Iu.turtleFocusTargetContainers.push(d),Iu.turtleFocusTargetSelects.push(p),p.addEventListener("change",()=>{const{tileId:e,slotIndex:t}=Ju(p.value),n={...ug(),focus:"specific",focusTargetTileId:e,focusTargetSlotIndex:t};yg.turtleTimer=n,Yg(),vi({focus:"specific",focusTargetTileId:e,focusTargetSlotIndex:t})});const m=document.createElement("label");m.style.cssText="display:inline-flex;align-items:center;gap:6px;font-size:11px;color:#bda7f5;";const f=document.createElement("select");f.className="qpm-select",f.style.cssText="min-width:120px;padding:4px 8px;font-size:11px;",f.addEventListener("click",e=>e.stopPropagation());const h=document.createElement("option");h.value="latest",h.textContent="Latest hatch";const b=document.createElement("option");b.value="earliest",b.textContent="Earliest hatch";const y=document.createElement("option");y.value="specific",y.textContent="Specific egg",f.append(h,b,y),f.value=n.eggFocus;const x=document.createElement("label");x.style.cssText="display:inline-flex;align-items:center;gap:6px;font-size:11px;color:#bda7f5;",x.style.display="specific"===n.eggFocus?"inline-flex":"none";const v=document.createElement("select");v.className="qpm-select",v.style.cssText="min-width:180px;padding:4px 8px;font-size:11px;",v.addEventListener("click",e=>e.stopPropagation()),f.addEventListener("change",()=>{const e=f.value,t="earliest"===e?"earliest":"specific"===e?"specific":"latest",n={...ug(),eggFocus:t};yg.turtleTimer=n,Yg();const o={eggFocus:t};"specific"===t&&(o.eggFocusTargetTileId=n.eggFocusTargetTileId,o.eggFocusTargetSlotIndex=n.eggFocusTargetSlotIndex),vi(o),x.style.display="specific"===t?"inline-flex":"none"});const w=document.createElement("span");w.textContent="Egg focus",m.append(w,f),o.appendChild(m),Iu.turtleEggFocusSelects.push(f);const C=document.createElement("span");C.textContent="Target egg",x.append(C,v),o.appendChild(x),Iu.turtleEggFocusTargetContainers.push(x),Iu.turtleEggFocusTargetSelects.push(v),v.addEventListener("change",()=>{const{tileId:e,slotIndex:t}=Ju(v.value),n={...ug(),eggFocus:"specific",eggFocusTargetTileId:e,eggFocusTargetSlotIndex:t};yg.turtleTimer=n,Yg(),vi({eggFocus:"specific",eggFocusTargetTileId:e,eggFocusTargetSlotIndex:t})}),t.appendChild(o);const T=document.createElement("div");T.style.cssText="font-size:10px;color:#9acccc;line-height:1.4;",T.textContent="Change your target plant's with Focus to display the estimated time to mature. The Egg Hatching section displays info on egg maturing. The Food Turtles section displays food drain and restore info.",t.appendChild(T);const S=(e,t,n)=>{const o=document.createElement("div");o.style.cssText=`padding:14px;border-radius:12px;border:2px solid ${t};background:linear-gradient(135deg, rgba(10,20,20,0.6), rgba(10,20,20,0.3));display:flex;flex-direction:column;gap:10px;box-shadow: 0 4px 12px rgba(0,0,0,0.3);`;const r=document.createElement("div");r.style.cssText="display:flex;justify-content:space-between;align-items:center;gap:12px;";const i=document.createElement("div");i.style.cssText="display:flex;align-items:center;gap:10px;";const a=document.createElement("span");a.style.cssText="font-size:24px;",a.textContent=n;const s=document.createElement("div");s.style.cssText="font-weight:700;font-size:14px;color:#e0f7fa;letter-spacing:0.3px;",s.textContent=e,i.append(a,s);const l=document.createElement("div");l.style.cssText="font-size:14px;font-weight:700;color:#4CAF50;background:rgba(76,175,80,0.15);padding:6px 12px;border-radius:8px;border:1px solid rgba(76,175,80,0.3);",r.append(i,l),o.appendChild(r);const c=document.createElement("div");c.style.cssText="display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:8px;";const d=document.createElement("div");d.style.cssText="display:flex;flex-direction:column;gap:4px;padding:8px;background:rgba(255,255,255,0.05);border-radius:6px;",c.appendChild(d);const p=document.createElement("div");p.style.cssText="display:flex;flex-direction:column;gap:4px;padding:8px;background:rgba(255,255,255,0.05);border-radius:6px;",c.appendChild(p),o.appendChild(c);const u=document.createElement("div");u.style.cssText="font-size:12px;color:#b2dfdb;line-height:1.6;padding:8px;background:rgba(178,223,219,0.1);border-radius:6px;border-left:3px solid #4CAF50;display:flex;align-items:center;gap:8px;",o.appendChild(u);const g=document.createElement("div");g.style.cssText="font-size:11px;color:#80CBC4;padding:6px 10px;background:rgba(128,203,196,0.08);border-radius:6px;display:flex;align-items:center;gap:6px;",o.appendChild(g);const m=document.createElement("div");m.style.cssText="display:grid;grid-template-columns:1.4fr 0.7fr 0.6fr 0.8fr;gap:8px;font-size:11px;color:#4CAF50;text-transform:uppercase;letter-spacing:0.6px;font-weight:700;padding:6px 8px;background:rgba(76,175,80,0.1);border-radius:6px;",m.innerHTML="<span>üêæ Pet</span><span>üçñ Hunger</span><span>‚ö° Boost</span><span>‚ú® XP</span>",o.appendChild(m);const f=document.createElement("div");return f.style.cssText="display:flex;flex-direction:column;gap:3px;min-height:18px;max-height:200px;overflow-y:auto;",o.appendChild(f),{card:o,etaEl:l,summaryEl:d,totalsEl:p,simpleEl:u,luckEl:g,tableBody:f}},P=S("Plant Growth","rgba(76,175,80,0.6)","üå±");t.appendChild(P.card),Iu.turtlePlantEta=P.etaEl,Iu.turtlePlantSummary=P.summaryEl,Iu.turtlePlantTotals=P.totalsEl,Iu.turtlePlantSimple=P.simpleEl,Iu.turtlePlantLuck=P.luckEl,Iu.turtlePlantTable=P.tableBody;const k=S("Egg Hatching","rgba(156,39,176,0.6)","ü•ö");t.appendChild(k.card),Iu.turtleEggEta=k.etaEl,Iu.turtleEggSummary=k.summaryEl,Iu.turtleEggTotals=k.totalsEl,Iu.turtleEggSimple=k.simpleEl,Iu.turtleEggLuck=k.luckEl,Iu.turtleEggTable=k.tableBody;const A=document.createElement("div");A.style.cssText="padding:14px;border-radius:12px;border:2px solid rgba(255,152,0,0.6);background:linear-gradient(135deg, rgba(30,24,12,0.6), rgba(30,24,12,0.3));display:flex;flex-direction:column;gap:10px;box-shadow: 0 4px 12px rgba(0,0,0,0.3);";const E=document.createElement("div");E.style.cssText="display:flex;align-items:center;gap:10px;";const $=document.createElement("span");$.style.cssText="font-size:24px;",$.textContent="üçΩÔ∏è";const M=document.createElement("div");M.style.cssText="font-weight:700;font-size:14px;color:#FFB74D;letter-spacing:0.3px;",M.textContent="Food Turtles",E.append($,M),A.appendChild(E);const I=document.createElement("div");I.style.cssText="display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:8px;";const F=document.createElement("div");F.style.cssText="padding:8px;background:rgba(255,255,255,0.05);border-radius:6px;font-size:11px;color:#FFE082;",I.appendChild(F);const z=document.createElement("div");z.style.cssText="padding:8px;background:rgba(255,255,255,0.05);border-radius:6px;font-size:11px;color:#FFE082;",I.appendChild(z),A.appendChild(I);const L=document.createElement("div");L.style.cssText="font-size:12px;color:#FFECB3;line-height:1.6;padding:8px;background:rgba(255,236,179,0.1);border-radius:6px;border-left:3px solid #FFB74D;",A.appendChild(L);const R=document.createElement("div");R.style.cssText="display:flex;flex-direction:column;gap:4px;max-height:180px;overflow-y:auto;",A.appendChild(R),t.appendChild(A),Iu.turtleSupportSummary=F,Iu.turtleSupportTotals=z,Iu.turtleSupportSimple=L,Iu.turtleSupportList=R;const q=document.createElement("div");q.style.cssText="padding:12px;border-radius:10px;border:1px solid rgba(100,181,246,0.45);background:linear-gradient(135deg, rgba(100,181,246,0.08), rgba(100,181,246,0.03));display:flex;flex-direction:column;gap:10px;";const N=document.createElement("div");N.style.cssText="font-weight:700;font-size:13px;color:#64b5f6;letter-spacing:0.3px;",N.textContent="‚è∞ Specified ETA Helper",q.appendChild(N);const B=document.createElement("div");B.style.cssText="font-size:10px;color:#90caf9;line-height:1.5;",B.textContent="Calculate how many watering cans you need to finish a plant by a specific time.",q.appendChild(B);const D=document.createElement("div");D.style.cssText="font-size:10px;color:#ffb74d;line-height:1.5;padding:6px;background:rgba(255,152,0,0.1);border-radius:4px;border-left:3px solid #ffb74d;margin-top:6px;",D.textContent="‚ö†Ô∏è Switch to your Plant Growth Turtles before you calculate!",D.title="Calculation uses your CURRENT turtle setup. Make sure you have Plant Growth boost turtles active if you want accurate watering can counts.",q.appendChild(D);const H=document.createElement("div");H.style.cssText="display:flex;flex-wrap:wrap;gap:10px;align-items:flex-end;",q.appendChild(H);const j=document.createElement("div");j.style.cssText="display:flex;flex-direction:column;gap:4px;";const _=document.createElement("label");_.style.cssText="font-size:10px;color:#b3e5fc;font-weight:600;",_.textContent="Target Date (DD/MM)";const O=document.createElement("input");O.type="text",O.className="qpm-input",O.placeholder="DD/MM",O.style.cssText="padding:6px 10px;font-size:11px;min-width:80px;max-width:80px;",O.addEventListener("keydown",e=>e.stopPropagation()),O.addEventListener("input",e=>{let t=O.value.replace(/\D/g,"");t.length>=2&&(t=t.slice(0,2)+"/"+t.slice(2,4)),O.value=t}),j.append(_,O),H.appendChild(j);const G=document.createElement("div");G.style.cssText="display:flex;flex-direction:column;gap:4px;";const V=document.createElement("label");V.style.cssText="font-size:10px;color:#b3e5fc;font-weight:600;",V.textContent="Target Time";const W=document.createElement("input");W.type="time",W.className="qpm-input",W.style.cssText="padding:6px 10px;font-size:11px;min-width:120px;",W.addEventListener("keydown",e=>e.stopPropagation()),G.append(V,W),H.appendChild(G);const U=document.createElement("div");U.style.cssText="display:flex;flex-direction:column;gap:4px;flex:1;min-width:180px;";const X=document.createElement("label");X.style.cssText="font-size:10px;color:#b3e5fc;font-weight:600;",X.textContent="Select Plant";const Q=document.createElement("select");Q.className="qpm-select",Q.style.cssText="padding:6px 10px;font-size:11px;",Q.addEventListener("click",e=>e.stopPropagation());const J=document.createElement("option");J.value="",J.textContent="Choose a growing plant...",J.disabled=!0,J.selected=!0,Q.appendChild(J),U.append(X,Q),H.appendChild(U);const K=document.createElement("button");K.type="button",K.className="qpm-button qpm-button--accent",K.textContent="Calculate",K.style.cssText="padding:6px 16px;font-size:11px;font-weight:600;align-self:flex-end;",H.appendChild(K);const Y=document.createElement("div");Y.style.cssText="display:none;flex-direction:column;gap:6px;padding:10px;background:rgba(10,20,30,0.5);border-radius:8px;border:1px solid rgba(100,181,246,0.2);",q.appendChild(Y);const Z=()=>{const e=Ti(),t=Date.now(),n=Q.value;for(;Q.options.length>1;)Q.remove(1);let o=0;for(const r of e.plantTargets)if(r.endTime&&r.endTime>t){const e=document.createElement("option");e.value=r.key,e.textContent=`${r.species||"Unknown"} - ${Ku(r.remainingMs||0)}`,e.dataset.endTime=String(r.endTime),e.dataset.species=r.species||"Unknown",Q.appendChild(e),o++}if(0===o){const e=document.createElement("option");e.value="",e.textContent="No growing plants found",e.disabled=!0,Q.appendChild(e)}if(n){Array.from(Q.options).find(e=>e.value===n)&&(Q.value=n)}};return K.addEventListener("click",()=>{const e=Q.selectedOptions[0];if(!e||!W.value||!O.value)return void(Y.style.display="none");const t=Number(e.dataset.endTime),n=e.dataset.species||"Unknown",o=Date.now(),r=O.value.split("/").map(Number),i=r[0],a=r[1];if(!i||!a||i<1||i>31||a<1||a>12)return Y.innerHTML='<div style="color:#ef5350;font-size:11px;">Invalid date! Use DD/MM format (e.g., 15/11)</div>',void(Y.style.display="flex");const s=W.value.split(":").map(Number),l=s[0]??0,c=s[1]??0,d=t-o,p=(new Date).getFullYear();let u=new Date(p,a-1,i,l,c,0,0);u.getTime()<o&&(u=new Date(p+1,a-1,i,l,c,0,0));const g=u.getTime(),m=Math.floor((g-o)/864e5),f=g-o;if(f<=0)return Y.innerHTML='<div style="color:#ef5350;font-size:11px;">Target time is in the past!</div>',void(Y.style.display="flex");const h=Ti(),b=h.plant.effectiveRate||0,y=h.plant.adjustedMsRemaining,x=b>0&&y?y:d,v=b>0&&!!y&&y>0,w=Math.max(0,x-f),C=Math.ceil(w/3e5);Y.innerHTML="";const T=document.createElement("div");T.style.cssText="font-weight:700;font-size:11px;color:#64b5f6;margin-bottom:4px;",T.textContent=`Results for ${n}`,Y.appendChild(T);const S=document.createElement("div");S.style.cssText="font-size:10px;color:#e0e0e0;line-height:1.6;padding:6px;background:rgba(255,255,255,0.05);border-radius:4px;margin-bottom:4px;",S.innerHTML=v?`<strong style="color:#81c784;">üê¢ Current State (With Turtles):</strong> ${Ku(x)} ‚Ä¢ ${gg(x)}`:`<strong style="color:#90caf9;">Current State (No Turtles):</strong> ${Ku(x)} ‚Ä¢ ${gg(x)}`,Y.appendChild(S);const P=document.createElement("div");P.style.cssText="font-size:10px;color:#e0e0e0;line-height:1.6;";const k=0===m?"today":1===m?"tomorrow":`in ${m} days`,A=`${O.value} ${W.value}`;P.innerHTML=`<strong style="color:#ffb74d;">Target:</strong> ${A} (${k}) ‚Ä¢ ${Ku(f)} from now`,Y.appendChild(P);const E=document.createElement("div");if(E.style.cssText="font-size:11px;color:#fff;font-weight:700;padding:8px;background:rgba(100,181,246,0.15);border-radius:6px;margin-top:4px;",0===C)E.innerHTML=`‚úÖ <span style="color:#81c784;">No watering cans needed!</span><br><span style="font-size:10px;font-weight:400;color:#b0b0b0;">Plant will finish ${Ku(Math.abs(w))} before target time.</span>`;else{const e=v?"(based on current turtle boost)":"(no turtle boost applied)";E.innerHTML=`üíß <span style="color:#64b5f6;">Watering Cans Needed: ${C}</span><br><span style="font-size:10px;font-weight:400;color:#b0b0b0;">Each can saves 5 minutes ${e}</span>`}Y.appendChild(E),Y.style.display="flex"}),Si(()=>{Z()}),Z(),t.appendChild(q),fg(Ti()),e}let jg={groups:[],totals:{xpPerHour:0,plantMinutesPerHour:0,eggMinutesPerHour:0,coinsPerHour:0},unknown:[]},_g=[];const Og={detailedView:!1,filterCoinOnly:!1,selectedAbilities:[]};let Gg={...Og};function Vg(e,t,n,o){const r=document.createElement("div");r.style.cssText="display: flex; align-items: center; gap: 10px; padding: 8px; background: rgba(0, 0, 0, 0.2); border-radius: 4px;";const i=document.createElement("div");i.style.cssText="flex: 1; display: flex; flex-direction: column; gap: 2px;";const a=document.createElement("div");a.textContent=e,a.style.cssText="font-size: 12px; color: rgba(255, 255, 255, 0.9); font-weight: 500;",i.appendChild(a);const s=document.createElement("div");s.textContent=t,s.style.cssText="font-size: 11px; color: rgba(255, 255, 255, 0.6);",i.appendChild(s),r.appendChild(i);const l=document.createElement("button");l.style.cssText=`\n    width: 48px;\n    height: 24px;\n    border-radius: 12px;\n    border: none;\n    cursor: pointer;\n    position: relative;\n    transition: background 0.2s;\n    background: ${n?"var(--qpm-accent)":"rgba(255, 255, 255, 0.2)"};\n  `;const c=document.createElement("div");c.style.cssText=`\n    width: 18px;\n    height: 18px;\n    border-radius: 50%;\n    background: white;\n    position: absolute;\n    top: 3px;\n    left: ${n?"27px":"3px"};\n    transition: left 0.2s;\n  `,l.appendChild(c);let d=n;return l.addEventListener("click",()=>{d=!d,l.style.background=d?"var(--qpm-accent)":"rgba(255, 255, 255, 0.2)",c.style.left=d?"27px":"3px",o(d)}),r.appendChild(l),r}function Wg(e){const t=g.get("qpm-tracker-settings");t&&(Gg={...Og,...t}),e.style.cssText="display: flex; flex-direction: column; gap: 12px; min-width: 900px; max-width: 1200px;";const n=document.createElement("div");n.style.cssText="\n    padding: 12px 16px;\n    background: var(--qpm-surface-1, #1a1a1a);\n    border-bottom: 1px solid var(--qpm-border, #444);\n    border-radius: 6px 6px 0 0;\n  ";const o=document.createElement("div");o.className="tracker-summary",o.style.cssText="\n    color: var(--qpm-text, #fff);\n    font-size: 13px;\n    line-height: 1.6;\n    font-weight: 500;\n  ",o.textContent="Loading pet data...",n.appendChild(o),e.appendChild(n);const r=document.createElement("div");r.style.cssText="border-bottom: 1px solid var(--qpm-border, #444);";const i=document.createElement("div");i.style.cssText="\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 10px 16px;\n    background: var(--qpm-surface-2, #222);\n    cursor: pointer;\n    user-select: none;\n  ";const a=document.createElement("div");a.textContent="‚öôÔ∏è Filters & Settings",a.style.cssText="\n    color: var(--qpm-text, #fff);\n    font-size: 13px;\n    font-weight: 600;\n  ";const l=document.createElement("span");l.textContent="‚ñ≤",l.style.cssText="\n    color: var(--qpm-text-muted, #aaa);\n    font-size: 10px;\n  ",i.appendChild(a),i.appendChild(l);const c=document.createElement("div");c.className="tracker-settings-panel",c.style.cssText="display: none; padding: 0;",i.addEventListener("click",()=>{const e="block"===c.style.display;c.style.display=e?"none":"block",l.textContent=e?"‚ñ≤":"‚ñº"}),r.appendChild(i),r.appendChild(c),e.appendChild(r);const d=document.createElement("div");d.style.cssText="\n    padding: 16px;\n    background: var(--qpm-surface-1, #1a1a1a);\n  ";const u=document.createElement("div");u.style.cssText="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;";const m=Vg("üìä Detailed View","Show additional statistics and context",Gg.detailedView,e=>{Gg.detailedView=e,g.set("qpm-tracker-settings",Gg),Ug({summaryText:o,tbody:T,footer:S,abilityCheckboxGrid:y})});u.appendChild(m);const f=Vg("üí∞ Coin Abilities Only","Show only coin-generating abilities",Gg.filterCoinOnly,e=>{Gg.filterCoinOnly=e,g.set("qpm-tracker-settings",Gg),Ug({summaryText:o,tbody:T,footer:S,abilityCheckboxGrid:y})});u.appendChild(f);const h=document.createElement("div");h.className="ability-filter-container",h.style.cssText="grid-column: 1 / -1; display: flex; flex-direction: column; gap: 8px;";const b=document.createElement("div");b.textContent="‚ú® Filter by Ability",b.style.cssText="font-size: 12px; color: rgba(255, 255, 255, 0.9); font-weight: 500;",h.appendChild(b);const y=document.createElement("div");y.className="ability-checkbox-grid",y.style.cssText="\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));\n    gap: 6px;\n    max-height: 200px;\n    overflow-y: auto;\n    padding: 8px;\n    background: rgba(0, 0, 0, 0.2);\n    border-radius: 4px;\n  ",h.appendChild(y),u.appendChild(h),d.appendChild(u),c.appendChild(d);const x=document.createElement("div");x.style.cssText="\n    overflow-x: auto;\n    background: var(--qpm-surface-1, #1a1a1a);\n    max-height: 60vh;\n    overflow-y: auto;\n  ";const v=document.createElement("table");v.className="tracker-detail-table",v.style.cssText="\n    width: 100%;\n    border-collapse: collapse;\n    font-size: 12px;\n  ";const w=v.createTHead();w.style.cssText="position: sticky; top: 0; z-index: 10;";const C=w.insertRow();C.style.cssText="\n    background: var(--qpm-surface-2, #222);\n    border-bottom: 2px solid var(--qpm-border, #555);\n  ";[{text:"Pet",tooltip:"Pet name or species"},{text:"Ability",tooltip:"Pet ability name"},{text:"Chance %",tooltip:"Calculated proc chance per minute (baseProbability √ó STR)"},{text:"Procs/Hr",tooltip:"Expected procs per hour"},{text:"Per Proc",tooltip:"Coins earned per successful proc"},{text:"Per Hour",tooltip:"Total coins per hour from this ability"},{text:"Next ETA",tooltip:"Live countdown to next expected proc"}].forEach(({text:e,tooltip:t})=>{const n=document.createElement("th");n.textContent=e,n.title=t,n.style.cssText="\n      padding: 10px 12px;\n      text-align: left;\n      font-weight: 600;\n      color: var(--qpm-text, #fff);\n      white-space: nowrap;\n      cursor: help;\n    ",C.appendChild(n)});const T=v.createTBody();T.className="tracker-tbody",x.appendChild(v),e.appendChild(x);const S=document.createElement("div");S.className="tracker-footer",S.style.cssText="\n    padding: 12px 16px;\n    background: var(--qpm-surface-2, #222);\n    border-top: 1px solid var(--qpm-border, #444);\n    border-radius: 0 0 6px 6px;\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--qpm-text, #fff);\n  ",S.textContent="Total: Loading...",e.appendChild(S);const P={root:e,summaryText:o,tbody:T,footer:S,abilityCheckboxGrid:y,updateInterval:null};$r(p(e=>{_g=e,jg=function(e){if(!e.length)return{groups:[],totals:{xpPerHour:0,plantMinutesPerHour:0,eggMinutesPerHour:0,coinsPerHour:0},unknown:[]};const t=Ql(),n=new Map,o=new Map,r=[];if(e.forEach((e,i)=>{const a=Array.isArray(e.abilities)?e.abilities:[];for(const s of a){if(!s)continue;const a=Ll(s);if(!a){r.push({abilityName:s,pet:e});continue}if("continuous"!==a.trigger)continue;const l=Nl(a,e.strength),c=sg(e,a.id),d=c?dg(c,a):null,p="number"==typeof e.strength&&Number.isFinite(e.strength)?e.strength:null,u=`${a.id}::${null!=p?p.toFixed(2):"baseline"}`;let g=n.get(u);void 0===g&&(g=Yl(a.id,t,p),n.set(u,g??null));const m=d?.procsPerHour??null,f=null!=m&&m>0?m:l.procsPerHour,h=null!=m&&m>0?"observed":"estimated",b=d?.effectPerProc??null,y=g?.effectPerProc??null,x=a.effectValuePerProc??null;let v=null,w="definition",C=g?.detail??null;null!=b&&b>0?(v=b,w="observed",C=d?.sampleCount?`Observed average from ${d.sampleCount} recent sample${1===d.sampleCount?"":"s"}.`:"Observed from ability log."):null!=y&&y>0?(v=y,w="computed"):null!=x&&x>0&&(v=x,w="definition",C=a.notes??null);const T=null!=v&&f>0?f*v:Bl(a,l),S=d?.lastProcAt??c?.lastPerformedAt??null,P=d?.sampleCount??0,k={pet:e,petIndex:i,displayName:pg(e),abilityName:s,definition:a,procsPerHour:f,procsPerHourSource:h,chancePerMinute:l.chancePerMinute,expectedMinutesBetween:f>0?60/f:null,lastProcAt:S,sampleCount:P,effectPerProc:v,effectSource:w,effectDetail:C,effectPerHour:T},A=a.id,E=o.get(A);E?(E.entries.push(k),E.totalProcsPerHour+=f,E.effectPerHour+=T,E.totalSamples+=P,(null==E.lastProcAt||null!=S&&S>E.lastProcAt)&&(E.lastProcAt=S)):o.set(A,{definition:a,entries:[k],totalProcsPerHour:f,chancePerMinute:f/60,combinedEtaMinutes:f>0?60/f:null,effectPerHour:T,totalSamples:P,lastProcAt:S,averageEffectPerProc:v})}}),0===o.size&&0===r.length)return{groups:[],totals:{xpPerHour:0,plantMinutesPerHour:0,eggMinutesPerHour:0,coinsPerHour:0},unknown:[]};const i={xpPerHour:0,plantMinutesPerHour:0,eggMinutesPerHour:0,coinsPerHour:0};return{groups:Array.from(o.values()).map(e=>{switch(e.chancePerMinute=e.entries.reduce((e,t)=>e+t.chancePerMinute,0),e.combinedEtaMinutes=e.totalProcsPerHour>0?60/e.totalProcsPerHour:null,e.averageEffectPerProc=e.totalProcsPerHour>0?e.effectPerHour/e.totalProcsPerHour:null,e.definition.category){case"xp":i.xpPerHour+=e.effectPerHour;break;case"plantGrowth":i.plantMinutesPerHour+=e.effectPerHour;break;case"eggGrowth":i.eggMinutesPerHour+=e.effectPerHour;break;case"coins":i.coinsPerHour+=e.effectPerHour}return e}).sort((e,t)=>t.totalProcsPerHour-e.totalProcsPerHour),totals:i,unknown:r}}(e),Ug(P)},500)),Ug(P),P.updateInterval=ie("tracker-window-countdown",()=>{!function(e){const t=e.querySelectorAll(".eta-countdown");t.forEach(e=>{if(!(e instanceof HTMLElement))return;const t=parseInt(e.dataset.lastProc||"0",10),n=parseFloat(e.dataset.effectiveRate||"0"),o=e.dataset.normalColor||"var(--qpm-positive)";if(!t||!n||0===t||0===n)return;const r=Bc(t,n>0?60/n:null,n);e.textContent=r.text,e.style.color=r.isOverdue?"var(--qpm-danger)":o})}(P.tbody)},1e3);const k=new MutationObserver(()=>{document.body.contains(e)||(null!==P.updateInterval&&P.updateInterval(),k.disconnect(),s("Tracker window cleanup: interval cleared"))});k.observe(document.body,{childList:!0,subtree:!0}),s("Trackers window rendered with live updates")}function Ug(e){const t=jg,n=_g;!function(e,t){const n=t.groups.map(e=>({id:e.definition.id,name:e.definition.name,count:e.entries.length})),o=n.map(e=>e.id).sort().join(",");if(o===(e.dataset.abilityIds||"")&&e.children.length>0)return;if(e.dataset.abilityIds=o,e.innerHTML="",0===n.length){const t=document.createElement("div");return t.textContent="No abilities available",t.style.cssText="padding: 8px; color: rgba(255, 255, 255, 0.5); font-size: 11px;",void e.appendChild(t)}const r=document.createElement("div");r.style.cssText="display: flex; align-items: center; gap: 8px;";const i=document.createElement("span");i.textContent="Filter Ability:",i.style.cssText="font-size: 12px; color: var(--qpm-text-muted);",r.appendChild(i);const a=document.createElement("select");a.className="qpm-select",a.style.cssText="flex: 1; min-width: 200px; padding: 6px 8px; font-size: 12px;";const s=document.createElement("option");s.value="",s.textContent="All abilities",a.appendChild(s),n.forEach(({id:e,name:t,count:n})=>{const o=document.createElement("option");o.value=e,o.textContent=`${t} (${n})`,a.appendChild(o)}),1===Gg.selectedAbilities.length?a.value=Gg.selectedAbilities[0]||"":a.value="",a.addEventListener("change",()=>{""===a.value?Gg.selectedAbilities=[]:Gg.selectedAbilities=[a.value],g.set("qpm-tracker-settings",Gg),Ug({summaryText:e.closest(".qpm-modal-window")?.querySelector(".tracker-summary"),tbody:e.closest(".qpm-modal-window")?.querySelector(".tracker-tbody"),footer:e.closest(".qpm-modal-window")?.querySelector(".tracker-footer"),abilityCheckboxGrid:e})}),r.appendChild(a),e.appendChild(r)}(e.abilityCheckboxGrid,t);const o=new Map,r=new Map;if(e.tbody.querySelectorAll('.eta-countdown[data-is-estimate="true"]').forEach(e=>{if(!(e instanceof HTMLElement))return;const t=e.dataset.lastProc,n=e.closest("tr"),i=n?.dataset.petIndex,a=n?.dataset.abilityId,s="true"===n?.dataset.isGroupRow;if(t&&a)if(s){const e=`group:${a}`;r.set(e,parseInt(t,10))}else if(void 0!==i){const e=`${i}:${a}`;o.set(e,parseInt(t,10))}}),e.tbody.innerHTML="",0===t.groups.length){const t=e.tbody.insertRow().insertCell();return t.colSpan=7,t.style.cssText="padding: 40px; text-align: center; color: rgba(255, 255, 255, 0.5);",t.innerHTML='\n      <div style="font-size: 48px; margin-bottom: 12px;">üê¢</div>\n      <div style="font-size: 14px; font-weight: 600; margin-bottom: 6px;">No Active Pet Abilities</div>\n      <div style="font-size: 12px; opacity: 0.7;">Make sure pets are active and assigned in your garden</div>\n    ',e.footer.textContent="üìä Total: No data",void(e.summaryText.textContent="üêæ No Active Pets")}let i=t.groups;Gg.filterCoinOnly&&(i=i.filter(e=>"coins"===e.definition.effectUnit||"coins"===e.definition.category)),Gg.selectedAbilities.length>0&&(i=i.filter(e=>Gg.selectedAbilities.includes(e.definition.id)));const a=n.length,s=t.groups.length,l=i.length,c=i.filter(e=>"coins"===e.definition.effectUnit||"coins"===e.definition.category).length;let d=[`üêæ ${a} Active Pet${1!==a?"s":""}`];Gg.filterCoinOnly||Gg.selectedAbilities.length>0?d.push(`üìä ${l}/${s} Abilities (filtered)`):d.push(`üìä ${s} Abilit${1!==s?"ies":"y"}`),c>0&&d.push(`üí∞ ${c} Coin-Generating`),e.summaryText.textContent=d.join(" ‚Ä¢ ");let p=0,u=0,m=0,f=0;if(0===i.length){const t=e.tbody.insertRow().insertCell();return t.colSpan=7,t.style.cssText="padding: 40px; text-align: center; color: rgba(255, 255, 255, 0.5);",t.innerHTML='\n      <div style="font-size: 48px; margin-bottom: 12px;">üîç</div>\n      <div style="font-size: 14px; font-weight: 600; margin-bottom: 6px;">No Abilities Match Filter</div>\n      <div style="font-size: 12px; opacity: 0.7;">Try adjusting your filter settings above</div>\n    ',void(e.footer.innerHTML="<strong>üìä Total:</strong> 0 abilities (filtered)")}const h=i.filter(e=>"coins"===e.definition.effectUnit||"coins"===e.definition.category),b=i.filter(e=>"coins"!==e.definition.effectUnit&&"coins"!==e.definition.category);if([...h,...b].forEach(t=>{for(const n of t.entries){Dc(n,t.definition.name,e.tbody,Gg.detailedView,o);const r=n.procsPerHour*(n.effectPerProc??0);p+=n.procsPerHour,u+=n.chancePerMinute,("coins"===t.definition.effectUnit||"coins"===t.definition.category)&&n.effectPerProc&&n.effectPerProc>0&&(m+=r),f++}!function(e,t,n=!1,o){if(e.entries.length<2){const e=t.rows.length-1;return e>=0?t.rows[e]??null:null}const r=t.insertRow();r.style.cssText="\n    border-bottom: 2px solid var(--qpm-border, #555);\n    background: var(--qpm-surface-2, #222);\n    font-weight: 600;\n  ",r.dataset.isGroupRow="true",r.dataset.abilityId=e.definition.id;const i=r.insertCell();i.textContent=`üìä Total (${e.entries.length})`,i.style.cssText="\n    padding: 10px 12px;\n    color: var(--qpm-accent, #4CAF50);\n    font-weight: 600;\n    white-space: nowrap;\n  ";const a=r.insertCell();a.textContent=e.definition.name,a.style.cssText="\n    padding: 10px 12px;\n    color: var(--qpm-accent, #4CAF50);\n    white-space: nowrap;\n  ";const s=r.insertCell();s.textContent=`${e.chancePerMinute.toFixed(2)}%/min`,s.style.cssText="\n    padding: 10px 12px;\n    text-align: right;\n    color: var(--qpm-accent, #4CAF50);\n    font-family: monospace;\n    white-space: nowrap;\n    font-weight: 600;\n  ",s.title=`Combined chance from ${e.entries.length} pets`;const l=r.insertCell();l.textContent=e.totalProcsPerHour.toFixed(2),l.style.cssText="\n    padding: 10px 12px;\n    text-align: right;\n    color: var(--qpm-accent, #4CAF50);\n    font-family: monospace;\n    font-weight: 600;\n  ",l.title=`Combined procs/hour from ${e.entries.length} pets`;const c=r.insertCell(),d=e.averageEffectPerProc??0,p=n?Dn:Hn;c.textContent=d>0?p(d):"‚Äî",c.style.cssText=`\n    padding: 10px 12px;\n    text-align: right;\n    color: ${d>0?"var(--qpm-warning, #ffa500)":"var(--qpm-text-muted, #aaa)"};\n    font-family: monospace;\n    font-weight: 600;\n  `,d>0&&(c.title=n?"Average coins per proc":`Exact: ${Dn(d)}`);const u=r.insertCell(),g=e.effectPerHour;u.textContent=g>0?p(g):"‚Äî",u.style.cssText=`\n    padding: 10px 12px;\n    text-align: right;\n    color: ${g>0?"var(--qpm-warning, #ffa500)":"var(--qpm-text-muted, #aaa)"};\n    font-family: monospace;\n    font-weight: 600;\n  `,g>0&&(u.title=n?`Combined coins/hour from ${e.entries.length} pets`:`Exact: ${Dn(g)}/hr`);const m=r.insertCell();m.className="eta-countdown";const f=e.totalProcsPerHour>0?60/e.totalProcsPerHour:0;if(e.totalProcsPerHour>0){let t,n;if(e.lastProcAt&&e.lastProcAt>0)t=e.lastProcAt,n=!1;else{const r=`group:${e.definition.id}`,i=o?.get(r);t=i||Date.now(),n=!0}m.dataset.lastProc=String(t),m.dataset.effectiveRate=String(e.totalProcsPerHour),m.dataset.normalColor="var(--qpm-accent, #4CAF50)",m.dataset.isEstimate=n?"true":"false";const r=Bc(t,e.combinedEtaMinutes,e.totalProcsPerHour);m.textContent=r.text,m.style.cssText=`\n      padding: 10px 12px;\n      text-align: right;\n      color: ${r.isOverdue?"var(--qpm-danger, #ef5350)":"var(--qpm-accent, #4CAF50)"};\n      font-family: monospace;\n      font-weight: 600;\n      white-space: nowrap;\n    `,m.title=n?`Estimated ${f.toFixed(1)} minutes between procs\nNo proc history yet`:`Combined average: ${f.toFixed(1)} minutes between procs\nLast proc: ${new Date(e.lastProcAt).toLocaleTimeString()}`}else m.textContent="‚Äî",m.style.cssText="\n      padding: 10px 12px;\n      text-align: right;\n      color: var(--qpm-text-muted, #aaa);\n      font-family: monospace;\n      font-weight: 600;\n      white-space: nowrap;\n    ",m.title="No proc rate available"}(t,e.tbody,Gg.detailedView,r)}),f>0){const t=e.tbody.insertRow();t.style.cssText="\n      background: var(--qpm-surface-2);\n      border-top: 2px solid var(--qpm-border);\n      font-weight: 600;\n      position: sticky;\n      bottom: 0;\n      z-index: 5;\n    ";const n=t.insertCell();n.textContent="üìä TOTAL",n.colSpan=2,n.style.cssText="padding: 12px; color: var(--qpm-accent); font-weight: 700; font-size: 13px; text-transform: uppercase;";const o=t.insertCell();o.textContent=`${u.toFixed(2)}%/min`,o.style.cssText="padding: 12px; text-align: right; color: var(--qpm-accent); font-family: monospace;";const r=t.insertCell();r.textContent=p.toFixed(2),r.style.cssText="padding: 12px; text-align: right; color: var(--qpm-accent); font-family: monospace;";const i=t.insertCell();i.textContent="‚Äî",i.style.cssText="padding: 12px; text-align: right; color: rgba(255, 255, 255, 0.5);";const a=t.insertCell();a.textContent=Dn(m),a.style.cssText="padding: 12px; text-align: right; color: #ffa500; font-family: monospace; font-weight: 700; font-size: 14px;";const s=t.insertCell();s.textContent="‚Äî",s.style.cssText="padding: 12px; text-align: right; color: rgba(255, 255, 255, 0.5);";const l=h.reduce((e,t)=>e+t.entries.length,0),c=[`<strong>üìä Total:</strong> ${f} abilit${1!==f?"ies":"y"}`];if(l>0){let e=0;for(const t of h)for(const n of t.entries){const o=$l(t.definition.id,{petId:n.pet.petId,slotId:n.pet.slotId,slotIndex:"number"==typeof n.pet.slotIndex&&Number.isFinite(n.pet.slotIndex)?n.pet.slotIndex:null,fallbackKeys:[]});if(o){const n=lg(o);for(const o of n){const n=cg(t.definition,o);null!=n&&Number.isFinite(n)&&n>0&&(e+=n)}}}e>0?c.push(`<span style="color: #ffd700;">üí∞ ${Dn(e)} earned</span>`):c.push(`<span style="color: #ffd700;">üí∞ ${l} coin</span>`)}m>0&&c.push(`<span style="color: #ffa500; font-size: 14px; font-weight: 700;">üí∏ ${Dn(m)}/hr</span>`),p>0&&c.push(`<span style="color: var(--qpm-accent); font-size: 12px;">‚ö° ${p.toFixed(1)} procs/hr</span>`),e.footer.innerHTML=c.join(" ‚Ä¢ ")}}function Xg(e){e.style.cssText="display: flex; flex-direction: column; gap: 16px; min-width: 600px;";const t=Hg();t.style.margin="0",e.appendChild(t)}function Qg(e){e.style.cssText="display: flex; flex-direction: column; gap: 16px; min-width: 600px;";const t=Jg();t.style.margin="0",e.appendChild(t)}function Jg(){const e=document.createElement("span");e.className="qpm-chip",e.textContent=yg.mutationReminder?.enabled?"Enabled":"Disabled";const{root:t,body:n}=bg("üß¨ Mutation Reminder",{collapsible:!0,startCollapsed:!0,subtitleElement:e});t.dataset.qpmSection="mutation-reminder";const o=document.createElement("div");o.textContent="Monitoring weather...",o.className="qpm-section-muted",n.appendChild(o);const r=document.createElement("div");r.innerHTML="üí° <strong>How it works:</strong><br>‚Ä¢ Detects weather events (Rain/Snow/Dawn/Amber)<br>‚Ä¢ Scans your plant inventory for mutations (F/W/C/D/A)<br>‚Ä¢ Notifies which plants to place for mutations<br>‚Ä¢ Example: Wet plant + Snow ‚Üí Frozen mutation!",r.style.cssText="background:#333;padding:8px;border-radius:4px;font-size:10px;line-height:1.5;border-left:3px solid #9C27B0",n.appendChild(r);const i=Kg(yg.mutationReminder?.enabled?"‚úì Reminders Enabled":"‚úó Reminders Disabled",async()=>{if(!yg.mutationReminder)return;yg.mutationReminder.enabled=!yg.mutationReminder.enabled,i.textContent=yg.mutationReminder.enabled?"‚úì Reminders Enabled":"‚úó Reminders Disabled",i.classList.toggle("qpm-button--positive",yg.mutationReminder.enabled),i.classList.toggle("qpm-button--accent",yg.mutationReminder.enabled),e.textContent=yg.mutationReminder.enabled?"Enabled":"Disabled",Yg();const{setMutationReminderEnabled:t}=await Promise.resolve().then(()=>Ut);t(yg.mutationReminder.enabled)});i.style.width="100%",yg.mutationReminder?.enabled&&i.classList.add("qpm-button--positive","qpm-button--accent"),n.appendChild(i);const a=Kg("üîç Check Now",async()=>{a.disabled=!0,a.textContent="‚è≥ Checking...";try{const{checkForMutations:e}=await Promise.resolve().then(()=>Ut);await e(),a.textContent="‚úÖ Done!",setTimeout(()=>{a.textContent="üîç Check Now",a.disabled=!1},2e3)}catch(e){a.textContent="‚ùå Error",s("Error checking mutations:",e),setTimeout(()=>{a.textContent="üîç Check Now",a.disabled=!1},2e3)}});a.style.width="100%",a.style.background="#9C27B0",a.title="Manually check for mutation opportunities",n.appendChild(a);const l=document.createElement("div");l.style.cssText="margin-top:8px;padding:8px;background:#2a1a3a;border-radius:4px;border:1px dashed #9C27B0";const c=document.createElement("div");c.textContent="üß™ Debug: Simulate Weather",c.style.cssText="font-size:10px;color:#aaa;margin-bottom:6px;font-weight:bold";const d=document.createElement("div");d.style.cssText="display:grid;grid-template-columns:1fr 1fr;gap:4px";const p=[{emoji:"üåßÔ∏è",name:"Rain",type:"rain"},{emoji:"‚ùÑÔ∏è",name:"Snow",type:"snow"},{emoji:"üåÖ",name:"Dawn",type:"dawn"},{emoji:"üåÜ",name:"Amber",type:"amber"}];for(const u of p){const e=Kg(`${u.emoji} ${u.name}`,async()=>{e.disabled=!0;try{const{simulateWeather:t}=await Promise.resolve().then(()=>Ut);await t(u.type),e.textContent=`‚úÖ ${u.name}`,setTimeout(()=>{e.textContent=`${u.emoji} ${u.name}`,e.disabled=!1},2e3)}catch(t){s("Error simulating weather:",t),e.textContent=`‚ùå ${u.name}`,setTimeout(()=>{e.textContent=`${u.emoji} ${u.name}`,e.disabled=!1},2e3)}});e.style.cssText="padding:4px 8px;font-size:10px;background:#333;border:1px solid #555",e.title=`Simulate ${u.name} weather for testing`,d.appendChild(e)}return l.append(c,d),n.appendChild(l),Iu.mutationStatus=o,t}function Kg(e,t){const n=document.createElement("button");return n.textContent=e,n.style.cssText="padding:6px 10px;font-size:12px;cursor:pointer;border:none;border-radius:4px;background:#555;color:#fff;transition:background 0.2s",n.onmouseover=()=>{n.disabled||(n.style.background="#777")},n.onmouseout=()=>{n.disabled||(n.textContent?.includes("‚úì")?n.style.background="#4CAF50":n.style.background="#555")},n.onclick=t,n}function Yg(){try{localStorage.setItem("quinoa-pet-manager",JSON.stringify(yg))}catch{}}const Zg="qpm.petXpObservations.v1",em=new Map,tm=new Map,nm=new Map,om=new Map;let rm=!1;const im=Wn(()=>{try{g.set(Zg,function(){const e=[];for(const[t,n]of om){const o=Array.from(n.values()).sort((e,t)=>e.level-t.level).map(e=>({...e}));e.push({key:t,displayName:tm.get(t)??t,lastUpdated:nm.get(t)??0,levels:o})}return{version:1,savedAt:Date.now(),species:e}}())}catch(e){s("‚ö†Ô∏è Failed to persist pet XP observations",e)}},2500);function am(e,t,n,o,r,i){const a=Vn(e);if(!a)return;const s=Math.max(0,Math.round(t));if(!Number.isFinite(s))return;const l=Math.max(0,Math.round(n));if(!Number.isFinite(l))return;const c=(d=a,om.has(d)||om.set(d,new Map),om.get(d));var d;const p=c.get(s);if(p){(l>p.xp||l===p.xp&&"level-up"===r&&"level-up"!==p.source)&&(p.xp=l,p.strength=o??p.strength??null,p.source=r),p.samples+=1,p.lastObservedAt=i}else c.set(s,{level:s,xp:l,strength:o??null,samples:1,lastObservedAt:i,source:r});tm.set(a,e),nm.set(a,i),im()}function sm(e){const t=Date.now(),n=new Set;e.forEach((e,o)=>{const r=function(e,t){return e.slotId&&e.slotId.trim().length>0?`slot:${e.slotId}`:e.petId&&e.petId.trim().length>0?`pet:${e.petId}`:`index:${t}`}(e,o);n.add(r);const i=em.get(r),a=e.species??i?.species??null,s="number"==typeof e.level&&Number.isFinite(e.level)?e.level:null,l="number"==typeof e.xp&&Number.isFinite(e.xp)?e.xp:null,c="number"==typeof e.strength&&Number.isFinite(e.strength)?e.strength:null;if(i&&a&&i.species===a){const e=i.level,n=i.xp,o=i.strength;null!=e&&null!=s&&s>e&&null!=n&&n>0&&am(a,e,n,o,"level-up",t)}if(a&&null!=s&&null!=l){const e=i?.xp,n=i?.level;(null==e||Math.round(e)!==Math.round(l)||(null==n||n!==s))&&am(a,s,l,c,"snapshot",t)}em.set(r,{species:a,level:s,xp:l,strength:c})});for(const o of em.keys())n.has(o)||em.delete(o)}function lm(){if(!rm){rm=!0;try{const t=g.get(Zg,null);(e=t??null)&&1===e.version&&(om.clear(),tm.clear(),nm.clear(),e.species.forEach(e=>{const t=new Map;e.levels.forEach(e=>{const n=Math.max(0,Math.round(e.level)),o=Number.isFinite(e.xp)?Math.max(0,Math.round(e.xp)):null;null!=o&&t.set(n,{level:n,xp:o,strength:e.strength??null,samples:Math.max(1,Math.round(e.samples??1)),lastObservedAt:e.lastObservedAt??0,source:"level-up"===e.source?"level-up":"snapshot"})}),0!==t.size&&(om.set(e.key,t),tm.set(e.key,e.displayName??e.key),nm.set(e.key,e.lastUpdated??Date.now()))}))}catch(t){s("‚ö†Ô∏è Failed to restore pet XP observations",t)}var e;kr(),$r(sm)}}const cm="sellAllCrops";let dm=null,pm=!1,um=[],gm=null;const mm=new Set;function fm(e){return"produce"===(e.itemType??e?.raw?.itemType??"").toString().toLowerCase()}async function hm(){if(!dm&&!pm){pm=!0;try{const e=V("actionAtom");if(!e)return s("‚ö†Ô∏è Sell snapshot watcher: actionAtom not found"),void(pm=!1);dm=await U(e,e=>{e===cm&&async function(){try{const e=await zs();if(!e||!Array.isArray(e.items))return um=[],void(gm=Date.now());um=e.items.filter(fm).map(e=>({...e})),gm=Date.now(),mm.forEach(e=>{try{e({items:[...um],timestamp:gm})}catch(t){s("‚ö†Ô∏è Sell snapshot listener error",t)}}),s(`üßæ Captured produce snapshot before ${cm} (${um.length} entries)`)}catch(e){s("‚ö†Ô∏è Failed to capture produce snapshot",e)}}()}),s("‚úÖ Sell snapshot watcher initialized")}catch(e){s("‚ö†Ô∏è Failed to initialize sell snapshot watcher",e)}finally{pm=!1}}}const bm=6e5;let ym=[],xm=null,vm=!1;function wm(e){if(!e)return null;const t=`${e}`.trim();return t?t.toLowerCase():null}function Cm(e,t){e.size&&(ym.push({timestamp:t,species:e}),Sm(t))}function Tm(e,t){const n=new Set;e.forEach(e=>{const t=function(e){const t=[e.species,e.displayName,e.name,e.itemId,e.id,e?.raw?.species,e?.raw?.name,e?.raw?.displayName];for(const n of t){const e=wm(n);if(e)return e}return null}(e);t&&n.add(t)}),Cm(n,t)}function Sm(e){ym=ym.filter(t=>e-t.timestamp<=bm)}async function Pm(e){if(!vm){var t;vm=!0,t=({items:t,timestamp:n})=>{Tm(t,n),e()},mm.add(t);try{const t=V("newCropLogsFromSellingAtom");t?(s("üßæ Sell window: subscribing to crop sale logs"),xm=await U(t,t=>{!function(e,t){if(!e||"object"!=typeof e)return;const n=new Set;Object.keys(e).forEach(e=>{const t=wm(e);t&&n.add(t)}),Cm(n,t)}(t,Date.now()),e()})):s("‚ö†Ô∏è Sell window: log atom not found")}catch(n){s("‚ö†Ô∏è Sell window: failed to subscribe to logs",n)}}}const km="qpm:achievements:v1",Am=new Set;let Em={initialized:!1,progress:new Map,definitions:[],lastSnapshot:null},$m=null,Mm=null,Im=null,Fm=null,zm=null,Lm=!1,Rm=0,qm=0,Nm=null,Bm=null,Dm=0,Hm=!1,jm=null,_m=0,Om=!1,Gm=0,Vm=null;const Wm=[];let Um=!1,Xm=!1,Qm=!1,Jm=!1,Km=!1;function Ym(e,t){for(const n of t){const t=Array.isArray(n)?n:[n];let o=e,r=!0;for(const e of t){if(!o||"object"!=typeof o||!(e in o)){r=!1;break}o=o[e]}if(r){const e=Number(o);if(Number.isFinite(e))return e}}return null}async function Zm(e,t,n){const o=V(e);if(o)try{t(await U(o,t=>{if(n)try{n(t)}catch(o){s(`‚ö†Ô∏è Achievements: handler for ${e} failed`,o)}mf()}))}catch(r){s(`‚ö†Ô∏è Achievements: failed to subscribe to ${e}`,r)}}function ef(e){const t=e-36e5;for(;Wm.length;){const e=Wm[0];if(!e||e.timestamp>=t)break;Wm.shift()}}function tf(e,t){const n=`${e??""}`.trim().toLowerCase();n&&n!==Vm&&(Vm=n,Wm.push({kind:n,timestamp:t}),ef(t))}function nf(e,t){const n=e?.room;if(!n||"object"!=typeof n)return;const o=String(n.id??"").trim();if(!o)return;const r=!0===n.isPrivate,i=Number(n.playersCount??Dm??0);if(null!=Bm&&Nm&&o===Nm){const e=t-Bm;e>0&&(qm+=e/6e4)}o!==Nm&&(r||(Rm+=1),Nm=o),Bm=t,Dm=Number.isFinite(i)&&i>0?i:Dm,Hm=r}function of(e){const t=[e?.coins,e?.state?.coins,e?.state?.player?.coins,e?.state?.stats?.player?.coins,e?.player?.coins].map(e=>Number(e)).find(e=>Number.isFinite(e));if(Number.isFinite(t)){if(null!=jm){const e=t-jm;e>0&&(_m=e,Om=!Hm&&(Dm||0)<=1)}jm=t}}function rf(e){const t=Date.now();nf(e,t),of(e);const n=e?.state?.weather?.activeKind??e?.state?.weather?.current??null;n&&tf(n,t)}function af(e){const t=Date.now();if(!e||"object"!=typeof e)return;const n=e.room??e.currentRoom??null;n&&"object"==typeof n&&nf({room:n},t),of(e)}function sf(e=1){const t=Number(e);Number.isFinite(t)&&t>0&&(Gm+=t,mf())}function lf(){Em.definitions.length||(Em.definitions=[{id:"garden:seedling-50",title:"Seedling Planter I",description:"Plant 50 crops.",category:"garden",rarity:"common",visibility:"public",target:50,icon:"üå±"},{id:"garden:seedling-200",title:"Seedling Planter II",description:"Plant 200 crops.",category:"garden",rarity:"uncommon",visibility:"public",target:200,icon:"üå±"},{id:"garden:seedling-500",title:"Seedling Planter III",description:"Plant 500 crops.",category:"garden",rarity:"rare",visibility:"public",target:500,icon:"üå±"},{id:"garden:seedling-2500",title:"Seedling Planter IV",description:"Plant 2,500 crops.",category:"garden",rarity:"legendary",visibility:"public",target:2500,icon:"üå±"},{id:"garden:seedling-5000",title:"Seedling Planter V",description:"Plant 5,000 crops.",category:"garden",rarity:"mythical",visibility:"public",target:5e3,icon:"üå±"},{id:"garden:seedling-12500",title:"Seedling Planter VI",description:"Plant 12,500 crops.",category:"garden",rarity:"divine",visibility:"public",target:12500,icon:"üå±"},{id:"garden:seedling-100000",title:"Seedling Planter VII",description:"Plant 50,000 crops.",category:"garden",rarity:"celestial",visibility:"public",target:5e4,icon:"üå±",hiddenTargetUntil:"garden:seedling-12500"},{id:"garden:harvester-300",title:"Harvester I",description:"Harvest 300 crops.",category:"garden",rarity:"common",visibility:"public",target:300,icon:"üß∫"},{id:"garden:harvester-1000",title:"Harvester II",description:"Harvest 1,000 crops.",category:"garden",rarity:"uncommon",visibility:"public",target:1e3,icon:"üß∫"},{id:"garden:harvester-5000",title:"Harvester III",description:"Harvest 5,000 crops.",category:"garden",rarity:"rare",visibility:"public",target:5e3,icon:"üß∫"},{id:"garden:harvester-20000",title:"Harvester IV",description:"Harvest 20,000 crops.",category:"garden",rarity:"legendary",visibility:"public",target:2e4,icon:"üß∫"},{id:"garden:harvester-50000",title:"Harvester V",description:"Harvest 50,000 crops.",category:"garden",rarity:"mythical",visibility:"public",target:5e4,icon:"üß∫"},{id:"garden:harvester-150000",title:"Harvester VI",description:"Harvest 75,000 crops.",category:"garden",rarity:"divine",visibility:"public",target:75e3,icon:"üß∫"},{id:"garden:harvester-100000",title:"Harvester VII",description:"Harvest 100,000 crops.",category:"garden",rarity:"celestial",visibility:"public",target:1e5,icon:"üß∫",hiddenTargetUntil:"garden:harvester-150000"},{id:"garden:watering-200",title:"I wish I could buy more than 99... I",description:"Use 200 watering cans on your crops.",category:"garden",rarity:"common",visibility:"public",target:200,icon:"üíß"},{id:"garden:watering-800",title:"I wish I could buy more than 99... II",description:"Use 800 watering cans on your crops.",category:"garden",rarity:"uncommon",visibility:"public",target:800,icon:"üíß"},{id:"garden:watering-2000",title:"I wish I could buy more than 99... III",description:"Use 2,000 watering cans on your crops.",category:"garden",rarity:"rare",visibility:"public",target:2e3,icon:"üíß"},{id:"garden:watering-10000",title:"I wish I could buy more than 99... IV",description:"Use 10,000 watering cans on your crops.",category:"garden",rarity:"legendary",visibility:"public",target:1e4,icon:"üíß"},{id:"garden:watering-50000",title:"I wish I could buy more than 99... V",description:"Use 50,000 watering cans on your crops.",category:"garden",rarity:"mythical",visibility:"public",target:5e4,icon:"üíß"},{id:"garden:watering-200000",title:"I wish I could buy more than 99... VI",description:"Use 80,000 watering cans on your crops.",category:"garden",rarity:"divine",visibility:"public",target:8e4,icon:"üíß"},{id:"garden:watering-125000",title:"I wish I could buy more than 99... VII",description:"Use 125,000 watering cans.",category:"garden",rarity:"celestial",visibility:"public",target:125e3,icon:"üíß",hiddenTargetUntil:"garden:watering-200000"},{id:"pets:hatchling-10",title:"Hatchery Rookie",description:"Hatch 10 pets.",category:"pets",rarity:"common",visibility:"public",target:10,icon:"ü•ö"},{id:"pets:hatchling-100",title:"Hatchery Scout",description:"Hatch 100 pets.",category:"pets",rarity:"uncommon",visibility:"public",target:100,icon:"ü•ö"},{id:"pets:hatchling-500",title:"Hatchery Specialist",description:"Hatch 500 pets.",category:"pets",rarity:"rare",visibility:"public",target:500,icon:"ü•ö"},{id:"pets:hatchling-2000",title:"Hatchery Expert",description:"Hatch 2,000 pets.",category:"pets",rarity:"legendary",visibility:"public",target:2e3,icon:"ü•ö"},{id:"pets:hatchling-5000",title:"Hatchery Master",description:"Hatch 5,000 pets.",category:"pets",rarity:"mythical",visibility:"public",target:5e3,icon:"ü•ö"},{id:"pets:hatchling-15000",title:"Hatchery Legend",description:"Hatch 15,000 pets.",category:"pets",rarity:"divine",visibility:"public",target:15e3,icon:"ü•ö"},{id:"pets:hatchling-50000",title:"Hatchery Celestial",description:"Hatch 50,000 pets.",category:"pets",rarity:"celestial",visibility:"public",target:5e4,icon:"ü•ö",hiddenTargetUntil:"pets:hatchling-15000"},{id:"pets:gold-1",title:"Gold Digger I",description:"Hatch 1 gold pet.",category:"pets",rarity:"common",visibility:"public",target:1,icon:"üèÖ"},{id:"pets:gold-3",title:"Gold Digger II",description:"Hatch 3 gold pets.",category:"pets",rarity:"uncommon",visibility:"public",target:3,icon:"üèÖ"},{id:"pets:gold-10",title:"Gold Digger III",description:"Hatch 10 gold pets.",category:"pets",rarity:"rare",visibility:"public",target:10,icon:"üèÖ"},{id:"pets:gold-25",title:"Gold Digger IV",description:"Hatch 25 gold pets.",category:"pets",rarity:"legendary",visibility:"public",target:25,icon:"üèÖ"},{id:"pets:gold-75",title:"Gold Digger V",description:"Hatch 75 gold pets.",category:"pets",rarity:"mythical",visibility:"public",target:75,icon:"üèÖ"},{id:"pets:gold-200",title:"Gold Digger VI",description:"Hatch 200 gold pets.",category:"pets",rarity:"divine",visibility:"public",target:200,icon:"üèÖ"},{id:"pets:gold-1000",title:"Gold Digger VII",description:"Hatch 1,000 gold pets.",category:"pets",rarity:"celestial",visibility:"public",target:1e3,icon:"üèÖ",hiddenTargetUntil:"pets:gold-200"},{id:"abilities:proc-50",title:"Trigger Happy I",description:"Trigger 50 abilities.",category:"abilities",rarity:"common",visibility:"public",target:50,icon:"‚ú®"},{id:"abilities:proc-200",title:"Trigger Happy II",description:"Trigger 200 abilities.",category:"abilities",rarity:"uncommon",visibility:"public",target:200,icon:"‚ú®"},{id:"abilities:proc-1000",title:"Trigger Happy III",description:"Trigger 1,000 abilities.",category:"abilities",rarity:"rare",visibility:"public",target:1e3,icon:"‚ú®"},{id:"abilities:proc-5000",title:"Trigger Happy IV",description:"Trigger 5,000 abilities.",category:"abilities",rarity:"legendary",visibility:"public",target:5e3,icon:"‚ú®"},{id:"abilities:proc-20000",title:"Trigger Happy V",description:"Trigger 20,000 abilities.",category:"abilities",rarity:"mythical",visibility:"public",target:2e4,icon:"‚ú®"},{id:"abilities:proc-85000",title:"Trigger Happy VI",description:"Trigger 85,000 abilities.",category:"abilities",rarity:"divine",visibility:"public",target:85e3,icon:"‚ú®"},{id:"abilities:proc-150000",title:"Trigger Happy VII",description:"Trigger 150,000 abilities.",category:"abilities",rarity:"celestial",visibility:"public",target:15e4,icon:"‚ú®",hiddenTargetUntil:"abilities:proc-85000"},{id:"economy:crop-earner-1000000",title:"Filthy Rich I",description:"Earn 1,000,000 coins from crops.",category:"wealth",rarity:"common",visibility:"public",target:1e6,icon:"üåæ"},{id:"economy:crop-earner-100000000",title:"Filthy Rich II",description:"Earn 100,000,000 coins from crops.",category:"wealth",rarity:"uncommon",visibility:"public",target:1e8,icon:"üåæ"},{id:"economy:crop-earner-10000000000",title:"Filthy Rich III",description:"Earn 10,000,000,000 coins from crops.",category:"wealth",rarity:"rare",visibility:"public",target:1e10,icon:"üåæ"},{id:"economy:crop-earner-1000000000000",title:"Filthy Rich IV",description:"Earn 1,000,000,000,000 coins from crops.",category:"wealth",rarity:"legendary",visibility:"public",target:1e12,icon:"üåæ"},{id:"economy:crop-earner-5000000000000",title:"Filthy Rich V",description:"Earn 5,000,000,000,000 coins from crops.",category:"wealth",rarity:"mythical",visibility:"public",target:5e12,icon:"üåæ"},{id:"economy:crop-earner-10000000000000",title:"Filthy Rich VI",description:"Earn 10,000,000,000,000 coins from crops.",category:"wealth",rarity:"divine",visibility:"public",target:1e13,icon:"üåæ"},{id:"economy:crop-earner-150000000000000",title:"Filthy Rich VII",description:"Earn 150,000,000,000,000 coins from crops.",category:"wealth",rarity:"celestial",visibility:"public",target:15e13,icon:"üåæ",hiddenTargetUntil:"economy:crop-earner-10000000000000"},{id:"weather:fresh-frozen-50",title:"Fresh Frozen I",description:"Watch it snow 50 times.",category:"weather",rarity:"common",visibility:"public",target:50,icon:"‚ùÑÔ∏è"},{id:"weather:fresh-frozen-125",title:"Fresh Frozen II",description:"Watch it snow 125 times.",category:"weather",rarity:"uncommon",visibility:"public",target:125,icon:"‚ùÑÔ∏è"},{id:"weather:fresh-frozen-300",title:"Fresh Frozen III",description:"Watch it snow 300 times.",category:"weather",rarity:"rare",visibility:"public",target:300,icon:"‚ùÑÔ∏è"},{id:"weather:fresh-frozen-625",title:"Fresh Frozen IV",description:"Watch it snow 625 times.",category:"weather",rarity:"legendary",visibility:"public",target:625,icon:"‚ùÑÔ∏è"},{id:"weather:fresh-frozen-1250",title:"Fresh Frozen V",description:"Watch it snow 1,250 times.",category:"weather",rarity:"mythical",visibility:"public",target:1250,icon:"‚ùÑÔ∏è"},{id:"weather:fresh-frozen-2500",title:"Fresh Frozen VI",description:"Watch it snow 2,500 times.",category:"weather",rarity:"divine",visibility:"public",target:2500,icon:"‚ùÑÔ∏è"},{id:"weather:fresh-frozen-5000",title:"Fresh Frozen VII",description:"Watch it snow 5,000 times.",category:"weather",rarity:"celestial",visibility:"public",target:5e3,icon:"‚ùÑÔ∏è",hiddenTargetUntil:"weather:fresh-frozen-2500"},{id:"weather:early-bird-50",title:"Early Bird I",description:"Sit through 50 Dawn moons.",category:"weather",rarity:"common",visibility:"public",target:50,icon:"üåÖ"},{id:"weather:early-bird-125",title:"Early Bird II",description:"Sit through 125 Dawn moons.",category:"weather",rarity:"uncommon",visibility:"public",target:125,icon:"üåÖ"},{id:"weather:early-bird-300",title:"Early Bird III",description:"Sit through 300 Dawn moons.",category:"weather",rarity:"rare",visibility:"public",target:300,icon:"üåÖ"},{id:"weather:early-bird-625",title:"Early Bird IV",description:"Sit through 625 Dawn moons.",category:"weather",rarity:"legendary",visibility:"public",target:625,icon:"üåÖ"},{id:"weather:early-bird-1250",title:"Early Bird V",description:"Sit through 1,250 Dawn moons.",category:"weather",rarity:"mythical",visibility:"public",target:1250,icon:"üåÖ"},{id:"weather:early-bird-2500",title:"Early Bird VI",description:"Sit through 2,500 Dawn moons.",category:"weather",rarity:"divine",visibility:"public",target:2500,icon:"üåÖ"},{id:"weather:early-bird-5000",title:"Early Bird VII",description:"Sit through 5,000 Dawn moons.",category:"weather",rarity:"celestial",visibility:"public",target:5e3,icon:"üåÖ",hiddenTargetUntil:"weather:early-bird-2500"},{id:"weather:night-owl-50",title:"Night Owl I",description:"Sit through 50 Amber moons.",category:"weather",rarity:"common",visibility:"public",target:50,icon:"üåô"},{id:"weather:night-owl-125",title:"Night Owl II",description:"Sit through 125 Amber moons.",category:"weather",rarity:"uncommon",visibility:"public",target:125,icon:"üåô"},{id:"weather:night-owl-300",title:"Night Owl III",description:"Sit through 300 Amber moons.",category:"weather",rarity:"rare",visibility:"public",target:300,icon:"üåô"},{id:"weather:night-owl-625",title:"Night Owl IV",description:"Sit through 625 Amber moons.",category:"weather",rarity:"legendary",visibility:"public",target:625,icon:"üåô"},{id:"weather:night-owl-1250",title:"Night Owl V",description:"Sit through 1,250 Amber moons.",category:"weather",rarity:"mythical",visibility:"public",target:1250,icon:"üåô"},{id:"weather:night-owl-2500",title:"Night Owl VI",description:"Sit through 2,500 Amber moons.",category:"weather",rarity:"divine",visibility:"public",target:2500,icon:"üåô"},{id:"weather:night-owl-5000",title:"Night Owl VII",description:"Sit through 5,000 Amber moons.",category:"weather",rarity:"celestial",visibility:"public",target:5e3,icon:"üåô",hiddenTargetUntil:"weather:night-owl-2500"},{id:"pets:rainbow-1",title:"Pure Luck I",description:"Hatch 1 rainbow pet.",category:"pets",rarity:"common",visibility:"public",target:1,icon:"üåà"},{id:"pets:rainbow-2",title:"Pure Luck II",description:"Hatch 2 rainbow pets.",category:"pets",rarity:"uncommon",visibility:"public",target:2,icon:"üåà"},{id:"pets:rainbow-3",title:"Pure Luck III",description:"Hatch 3 rainbow pets.",category:"pets",rarity:"rare",visibility:"public",target:3,icon:"üåà"},{id:"pets:rainbow-6",title:"Pure Luck IV",description:"Hatch 6 rainbow pets.",category:"pets",rarity:"legendary",visibility:"public",target:6,icon:"üåà"},{id:"pets:rainbow-10",title:"Pure Luck V",description:"Hatch 10 rainbow pets.",category:"pets",rarity:"mythical",visibility:"public",target:10,icon:"üåà"},{id:"pets:rainbow-20",title:"Pure Luck VI",description:"Hatch 20 rainbow pets.",category:"pets",rarity:"divine",visibility:"public",target:20,icon:"üåà"},{id:"pets:rainbow-50",title:"Pure Luck VII",description:"Hatch 50 rainbow pets.",category:"pets",rarity:"celestial",visibility:"public",target:50,icon:"üåà",hiddenTargetUntil:"pets:rainbow-20"},{id:"garden:seed-hoarder-100",title:"Seed Hoarder I",description:"Hold 100 seeds of a single type.",category:"garden",rarity:"common",visibility:"public",target:100,icon:"üå±"},{id:"garden:seed-hoarder-500",title:"Seed Hoarder II",description:"Hold 500 seeds of a single type.",category:"garden",rarity:"uncommon",visibility:"public",target:500,icon:"üå±"},{id:"garden:seed-hoarder-1500",title:"Seed Hoarder III",description:"Hold 1,500 seeds of a single type.",category:"garden",rarity:"rare",visibility:"public",target:1500,icon:"üå±"},{id:"garden:seed-hoarder-5000",title:"Seed Hoarder IV",description:"Hold 7,500 seeds of a single type.",category:"garden",rarity:"legendary",visibility:"public",target:7500,icon:"üå±"},{id:"garden:seed-hoarder-15000",title:"Seed Hoarder V",description:"Hold 35,000 seeds of a single type.",category:"garden",rarity:"mythical",visibility:"public",target:35e3,icon:"üå±"},{id:"garden:seed-hoarder-35000",title:"Seed Hoarder VI",description:"Hold 100,000 seeds of a single type.",category:"garden",rarity:"divine",visibility:"public",target:1e5,icon:"üå±"},{id:"garden:seed-hoarder-80000",title:"Seed Hoarder VII",description:"Hold 750,000 seeds of a single type.",category:"garden",rarity:"celestial",visibility:"public",target:75e4,icon:"üå±",hiddenTargetUntil:"garden:seed-hoarder-35000"},{id:"onetime:this-is-only-the-beginning",title:"This is just the beginning",description:"Crop Eater ate a crop.",category:"obscure",rarity:"common",visibility:"public",target:1,icon:"ü™ì",oneTime:!0},{id:"onetime:yummy-crop-eater",title:"YUMMY!",description:"Crop Eater ate a celestial crop.",category:"obscure",rarity:"rare",visibility:"public",target:1,icon:"üç¨",oneTime:!0},{id:"onetime:eating-good",title:"Eating Good :(",description:"Fed pet produce worth over 500M.",category:"pets",rarity:"legendary",visibility:"public",target:5e8,icon:"ü•ó",oneTime:!0},{id:"onetime:all-i-see-is-money",title:"All I see is Money",description:"Only gold or rainbow pets in inventory and hutch.",category:"pets",rarity:"celestial",visibility:"public",target:1,icon:"üí∞",oneTime:!0},{id:"onetime:gamblers-fallacy",title:"Gamblers Fallacy",description:"12h accumulated with 3+ Crop Size Boost pets active and no boost proc.",category:"obscure",rarity:"legendary",visibility:"public",target:1,icon:"üé≤",oneTime:!0},{id:"onetime:money-cant-buy-happiness",title:"Money can‚Äôt buy happiness",description:"Open 1,000 eggs or reach 1B crop value sold with no rainbow pets ever.",category:"wealth",rarity:"legendary",visibility:"public",target:1,icon:"üí∏",oneTime:!0},{id:"onetime:rich",title:"Rich",description:"Reach 50B coin balance.",category:"wealth",rarity:"rare",visibility:"public",target:5e10,icon:"üè¶",oneTime:!0},{id:"onetime:baller-status",title:"Baller Status",description:"Reach 1T coin balance.",category:"wealth",rarity:"mythical",visibility:"public",target:1e12,icon:"ü™ô",oneTime:!0},{id:"onetime:whos-bill-gates",title:"Who's Bill Gates?",description:"Reach 10T coin balance.",category:"wealth",rarity:"divine",visibility:"public",target:1e13,icon:"üè∞",oneTime:!0},{id:"onetime:what-is-money",title:"What is money??",description:"Reach 100T coin balance.",category:"wealth",rarity:"celestial",visibility:"public",target:1e14,icon:"üíé",oneTime:!0},{id:"onetime:what-is-grass",title:"What is Grass..",description:"Reach 1Q coin balance.",category:"wealth",rarity:"celestial",visibility:"public",target:1e15,icon:"üåæ",oneTime:!0},{id:"onetime:god-tier-research",title:"GOD-TIER RESEARCH",description:"Complete all journal sections.",category:"collection",rarity:"celestial",visibility:"public",target:1,icon:"üìö",oneTime:!0},{id:"collection:pets-3",title:"Animal Lover I",description:"Complete the pets journal.",category:"collection",rarity:"common",visibility:"public",target:3,icon:"üìî"},{id:"collection:pets-7",title:"Animal Lover II",description:"Complete the pets journal.",category:"collection",rarity:"uncommon",visibility:"public",target:7,icon:"üìî"},{id:"collection:pets-12",title:"Animal Lover III",description:"Complete the pets journal.",category:"collection",rarity:"rare",visibility:"public",target:12,icon:"üìî"},{id:"collection:pets-20",title:"Animal Lover IV",description:"Complete the pets journal.",category:"collection",rarity:"legendary",visibility:"public",target:20,icon:"üìî"},{id:"collection:pets-35",title:"Animal Lover V",description:"Complete the pets journal.",category:"collection",rarity:"mythical",visibility:"public",target:35,icon:"üìî"},{id:"collection:pets-50",title:"Animal Lover VI",description:"Complete the pets journal.",category:"collection",rarity:"divine",visibility:"public",target:50,icon:"üìî"},{id:"collection:pets-60",title:"Animal Lover VII",description:"Complete the pets journal.",category:"collection",rarity:"celestial",visibility:"public",target:60,icon:"üìî",hiddenTargetUntil:"collection:pets-50"},{id:"collection:produce-10",title:"Completionist I",description:"Complete the produce journal.",category:"collection",rarity:"common",visibility:"public",target:10,icon:"üìî"},{id:"collection:produce-25",title:"Completionist II",description:"Complete the produce journal.",category:"collection",rarity:"uncommon",visibility:"public",target:25,icon:"üìî"},{id:"collection:produce-50",title:"Completionist III",description:"Complete the produce journal.",category:"collection",rarity:"rare",visibility:"public",target:50,icon:"üìî"},{id:"collection:produce-100",title:"Completionist IV",description:"Complete the produce journal.",category:"collection",rarity:"legendary",visibility:"public",target:100,icon:"üìî"},{id:"collection:produce-250",title:"Completionist V",description:"Complete the produce journal.",category:"collection",rarity:"mythical",visibility:"public",target:250,icon:"üìî"},{id:"collection:produce-325",title:"Completionist VI",description:"Complete the produce journal.",category:"collection",rarity:"divine",visibility:"public",target:325,icon:"üìî"},{id:"collection:produce-385",title:"Completionist VII",description:"Complete the produce journal.",category:"collection",rarity:"celestial",visibility:"public",target:385,icon:"üìî",hiddenTargetUntil:"collection:produce-325"},{id:"onetime:perfect-produce",title:"Perfect Produce",description:"Complete every variant for any single crop.",category:"collection",rarity:"rare",visibility:"public",target:1,icon:"ü•ï",oneTime:!0,tags:["per-species","journal","variant"]},{id:"onetime:perfect-symmetry",title:"Perfect Symmetry",description:"Complete all variants for any pet species.",category:"collection",rarity:"rare",visibility:"public",target:1,icon:"üêæ",oneTime:!0,tags:["per-species","journal","variant"]},{id:"onetime:mutation-marathon",title:"Mutation Marathon",description:"Trigger 10 mutations within 30 minutes.",category:"weather",rarity:"legendary",visibility:"public",target:10,icon:"üå¶Ô∏è",oneTime:!0,tags:["window","mutations"]},{id:"onetime:all-weathered",title:"All-Weathered",description:"See Dawn, Amber, and Snow in a single session.",category:"weather",rarity:"legendary",visibility:"public",target:3,icon:"‚õàÔ∏è",oneTime:!0,tags:["weather","session"]},{id:"onetime:triple-hatch",title:"Triple Hatch",description:"Hatch Gold, Rainbow, and Normal pets within 30 minutes.",category:"pets",rarity:"legendary",visibility:"public",target:3,icon:"ü•ö",oneTime:!0,tags:["window","hatch"]},{id:"onetime:These-Exist!?",title:"These-Exist!?",description:"Hatch a pet with 4 abilities.",category:"pets",rarity:"mythical",visibility:"public",target:1,icon:"‚ùî",oneTime:!0,tags:["hatch"]},{id:"onetime:loyal-companion",title:"Loyal Companion",description:"Keep one pet active for 6+ hours in a single day.",category:"pets",rarity:"legendary",visibility:"public",target:1,icon:"üï∞Ô∏è",oneTime:!0,tags:["session","pet-active"]},{id:"onetime:ability-synergy",title:"Ability Synergy",description:"Trigger 5 different abilities within 5 minutes.",category:"abilities",rarity:"legendary",visibility:"public",target:5,icon:"üß©",oneTime:!0,tags:["window","abilities"]},{id:"onetime:combo-caster",title:"Combo Caster",description:"Trigger 3 different abilities inside 30 seconds.",category:"abilities",rarity:"mythical",visibility:"public",target:3,icon:"‚ö°",oneTime:!0,tags:["window","abilities"]},{id:"onetime:market-maker",title:"Market Maker",description:"Sell 10 different crop types within 10 minutes.",category:"shop",rarity:"legendary",visibility:"public",target:10,icon:"üõí",oneTime:!0,tags:["sell","window"]},{id:"onetime:fire-sale",title:"Fire Sale",description:"Sell 5 different crop types within 60 seconds.",category:"shop",rarity:"legendary",visibility:"public",target:5,icon:"üî•",oneTime:!0,tags:["sell","window"]},{id:"onetime:abilities:crit-crafter",title:"Crit Crafter",description:"Apply Rainbow or Gold-granting abilities to 1,000 crops total.",category:"abilities",rarity:"mythical",visibility:"public",target:1e3,icon:"üåà",oneTime:!0,tags:["abilities","value"]},{id:"onetime:clutch-hatch",title:"Clutch Hatch",description:"Hatch a Gold or Rainbow pet within 2 minutes of egg purchase.",category:"pets",rarity:"legendary",visibility:"public",target:1,icon:"‚è±Ô∏è",oneTime:!0,tags:["hatch","window"]},{id:"garden:mutation-harvester-100",title:"Mutation Harvester I",description:"Harvest 100 mutated crops.",category:"garden",rarity:"common",visibility:"public",target:100,icon:"üß¨"},{id:"garden:mutation-harvester-1000",title:"Mutation Harvester II",description:"Harvest 1,000 mutated crops.",category:"garden",rarity:"uncommon",visibility:"public",target:1e3,icon:"üß¨"},{id:"garden:mutation-harvester-2500",title:"Mutation Harvester III",description:"Harvest 2,500 mutated crops.",category:"garden",rarity:"rare",visibility:"public",target:2500,icon:"üß¨"},{id:"garden:mutation-harvester-7500",title:"Mutation Harvester IV",description:"Harvest 7,500 mutated crops.",category:"garden",rarity:"legendary",visibility:"public",target:7500,icon:"üß¨"},{id:"garden:mutation-harvester-15000",title:"Mutation Harvester V",description:"Harvest 15,000 mutated crops.",category:"garden",rarity:"mythical",visibility:"public",target:15e3,icon:"üß¨"},{id:"garden:mutation-harvester-50000",title:"Mutation Harvester VI",description:"Harvest 50,000 mutated crops.",category:"garden",rarity:"divine",visibility:"public",target:5e4,icon:"üß¨"},{id:"garden:mutation-harvester-125000",title:"Mutation Harvester VII",description:"Harvest 125,000 mutated crops.",category:"garden",rarity:"celestial",visibility:"public",target:125e3,icon:"üß¨",hiddenTargetUntil:"garden:mutation-harvester-50000"},{id:"garden:giant-grower-1",title:"Giant Grower I",description:"Achieve max weight on 1 crop.",category:"garden",rarity:"common",visibility:"public",target:1,icon:"üå≥"},{id:"garden:giant-grower-3",title:"Giant Grower II",description:"Achieve max weight on 3 crops.",category:"garden",rarity:"uncommon",visibility:"public",target:3,icon:"üå≥"},{id:"garden:giant-grower-7",title:"Giant Grower III",description:"Achieve max weight on 7 crops.",category:"garden",rarity:"rare",visibility:"public",target:7,icon:"üå≥"},{id:"garden:giant-grower-10",title:"Giant Grower IV",description:"Achieve max weight on 10 crops.",category:"garden",rarity:"legendary",visibility:"public",target:10,icon:"üå≥"},{id:"garden:giant-grower-15",title:"Giant Grower V",description:"Achieve max weight on 15 crops.",category:"garden",rarity:"mythical",visibility:"public",target:15,icon:"üå≥"},{id:"garden:giant-grower-25",title:"Giant Grower VI",description:"Achieve max weight on 25 crops.",category:"garden",rarity:"divine",visibility:"public",target:25,icon:"üå≥"},{id:"garden:giant-grower-35",title:"Giant Grower VII",description:"Achieve max weight on 35 crops.",category:"garden",rarity:"celestial",visibility:"public",target:35,icon:"üå≥",hiddenTargetUntil:"garden:giant-grower-25"},{id:"pets:trainer-50",title:"Trainer I",description:"Gain 50 pet levels total.",category:"pets",rarity:"common",visibility:"public",target:50,icon:"üéì"},{id:"pets:trainer-200",title:"Trainer II",description:"Gain 200 pet levels total.",category:"pets",rarity:"uncommon",visibility:"public",target:200,icon:"üéì"},{id:"pets:trainer-800",title:"Trainer III",description:"Gain 800 pet levels total.",category:"pets",rarity:"rare",visibility:"public",target:800,icon:"üéì"},{id:"pets:trainer-2000",title:"Trainer IV",description:"Gain 2,000 pet levels total.",category:"pets",rarity:"legendary",visibility:"public",target:2e3,icon:"üéì"},{id:"pets:trainer-5000",title:"Trainer V",description:"Gain 5,000 pet levels total.",category:"pets",rarity:"mythical",visibility:"public",target:5e3,icon:"üéì"},{id:"pets:trainer-10000",title:"Trainer VI",description:"Gain 10,000 pet levels total.",category:"pets",rarity:"divine",visibility:"public",target:1e4,icon:"üéì"},{id:"pets:trainer-50000",title:"Trainer VII",description:"Gain 50,000 pet levels total.",category:"pets",rarity:"celestial",visibility:"public",target:5e4,icon:"üéì",hiddenTargetUntil:"pets:trainer-10000"},{id:"streaks:diligent-gardener-3",title:"Diligent Gardener I",description:"Keep a 3-day garden streak.",category:"streaks",rarity:"common",visibility:"public",target:3,icon:"üìÖ"},{id:"streaks:diligent-gardener-7",title:"Diligent Gardener II",description:"Keep a 7-day garden streak.",category:"streaks",rarity:"uncommon",visibility:"public",target:7,icon:"üìÖ"},{id:"streaks:diligent-gardener-14",title:"Diligent Gardener III",description:"Keep a 14-day garden streak.",category:"streaks",rarity:"rare",visibility:"public",target:14,icon:"üìÖ"},{id:"streaks:diligent-gardener-30",title:"Diligent Gardener IV",description:"Keep a 30-day garden streak.",category:"streaks",rarity:"legendary",visibility:"public",target:30,icon:"üìÖ"},{id:"streaks:diligent-gardener-80",title:"Diligent Gardener V",description:"Keep an 80-day garden streak.",category:"streaks",rarity:"mythical",visibility:"public",target:80,icon:"üìÖ"},{id:"streaks:diligent-gardener-180",title:"Diligent Gardener VI",description:"Keep a 180-day garden streak.",category:"streaks",rarity:"divine",visibility:"public",target:180,icon:"üìÖ"},{id:"streaks:diligent-gardener-365",title:"Diligent Gardener VII",description:"Keep a 365-day garden streak.",category:"streaks",rarity:"celestial",visibility:"public",target:365,icon:"üìÖ",hiddenTargetUntil:"streaks:diligent-gardener-180"},{id:"abilities:empowered-harvest-10",title:"Empowered Harvest I",description:"Apply Rainbow/Gold-granting abilities to 10 crops.",category:"abilities",rarity:"common",visibility:"public",target:10,icon:"üí†"},{id:"abilities:empowered-harvest-50",title:"Empowered Harvest II",description:"Apply Rainbow/Gold-granting abilities to 50 crops.",category:"abilities",rarity:"uncommon",visibility:"public",target:50,icon:"üí†"},{id:"abilities:empowered-harvest-500",title:"Empowered Harvest III",description:"Apply Rainbow/Gold-granting abilities to 500 crops.",category:"abilities",rarity:"rare",visibility:"public",target:500,icon:"üí†"},{id:"abilities:empowered-harvest-2500",title:"Empowered Harvest IV",description:"Apply Rainbow/Gold-granting abilities to 2,500 crops.",category:"abilities",rarity:"legendary",visibility:"public",target:2500,icon:"üí†"},{id:"abilities:empowered-harvest-5000",title:"Empowered Harvest V",description:"Apply Rainbow/Gold-granting abilities to 5,000 crops.",category:"abilities",rarity:"mythical",visibility:"public",target:5e3,icon:"üí†"},{id:"abilities:empowered-harvest-10000",title:"Empowered Harvest VI",description:"Apply Rainbow/Gold-granting abilities to 10,000 crops.",category:"abilities",rarity:"divine",visibility:"public",target:1e4,icon:"üí†"},{id:"abilities:empowered-harvest-50000",title:"Empowered Harvest VII",description:"Apply Rainbow/Gold-granting abilities to 50,000 crops.",category:"abilities",rarity:"celestial",visibility:"public",target:5e4,icon:"üí†",hiddenTargetUntil:"abilities:empowered-harvest-10000"},{id:"rooms:socialite-10",title:"Room Socialite I",description:"Join 10 public rooms.",category:"streaks",rarity:"common",visibility:"public",target:10,icon:"ü™©"},{id:"rooms:socialite-40",title:"Room Socialite II",description:"Join 40 public rooms.",category:"streaks",rarity:"uncommon",visibility:"public",target:40,icon:"ü™©"},{id:"rooms:socialite-120",title:"Room Socialite III",description:"Join 120 public rooms.",category:"streaks",rarity:"rare",visibility:"public",target:120,icon:"ü™©"},{id:"rooms:socialite-300",title:"Room Socialite IV",description:"Join 300 public rooms.",category:"streaks",rarity:"legendary",visibility:"public",target:300,icon:"ü™©"},{id:"rooms:socialite-750",title:"Room Socialite V",description:"Join 750 public rooms.",category:"streaks",rarity:"mythical",visibility:"public",target:750,icon:"ü™©"},{id:"rooms:socialite-2500",title:"Room Socialite VI",description:"Join 2,500 public rooms.",category:"streaks",rarity:"divine",visibility:"public",target:2500,icon:"ü™©"},{id:"rooms:socialite-10000",title:"Room Socialite VII",description:"Join 10,000 public rooms.",category:"streaks",rarity:"celestial",visibility:"public",target:1e4,icon:"ü™©",hiddenTargetUntil:"rooms:socialite-2500"},{id:"rooms:anchor-60",title:"Room Anchor I",description:"Spend 60 minutes in public rooms.",category:"streaks",rarity:"common",visibility:"public",target:60,icon:"‚öì"},{id:"rooms:anchor-300",title:"Room Anchor II",description:"Spend 300 minutes in public rooms.",category:"streaks",rarity:"uncommon",visibility:"public",target:300,icon:"‚öì"},{id:"rooms:anchor-1000",title:"Room Anchor III",description:"Spend 1,000 minutes in public rooms.",category:"streaks",rarity:"rare",visibility:"public",target:1e3,icon:"‚öì"},{id:"rooms:anchor-3000",title:"Room Anchor IV",description:"Spend 3,000 minutes in public rooms.",category:"streaks",rarity:"legendary",visibility:"public",target:3e3,icon:"‚öì"},{id:"rooms:anchor-7500",title:"Room Anchor V",description:"Spend 7,500 minutes in public rooms.",category:"streaks",rarity:"mythical",visibility:"public",target:7500,icon:"‚öì"},{id:"rooms:anchor-15000",title:"Room Anchor VI",description:"Spend 15,000 minutes in public rooms.",category:"streaks",rarity:"divine",visibility:"public",target:15e3,icon:"‚öì"},{id:"rooms:anchor-50000",title:"Room Anchor VII",description:"Spend 50,000 minutes in public rooms.",category:"streaks",rarity:"celestial",visibility:"public",target:5e4,icon:"‚öì",hiddenTargetUntil:"rooms:anchor-15000"},{id:"shop:sell-burst-1000000",title:"Sell Burst I",description:"Earn 1,000,000 coins in a single sell-all.",category:"shop",rarity:"common",visibility:"public",target:1e6,icon:"üí∞"},{id:"shop:sell-burst-5000000",title:"Sell Burst II",description:"Earn 5,000,000 coins in a single sell-all.",category:"shop",rarity:"uncommon",visibility:"public",target:5e6,icon:"üí∞"},{id:"shop:sell-burst-50000000",title:"Sell Burst III",description:"Earn 50,000,000 coins in a single sell-all.",category:"shop",rarity:"rare",visibility:"public",target:5e7,icon:"üí∞"},{id:"shop:sell-burst-250000000",title:"Sell Burst IV",description:"Earn 250,000,000 coins in a single sell-all.",category:"shop",rarity:"legendary",visibility:"public",target:25e7,icon:"üí∞"},{id:"shop:sell-burst-1000000000",title:"Sell Burst V",description:"Earn 1,000,000,000 coins in a single sell-all.",category:"shop",rarity:"mythical",visibility:"public",target:1e9,icon:"üí∞"},{id:"shop:sell-burst-1000000000000",title:"Sell Burst VI",description:"Earn 1,000,000,000,000 coins in a single sell-all.",category:"shop",rarity:"divine",visibility:"public",target:1e12,icon:"üí∞"},{id:"shop:sell-burst-5000000000000",title:"Sell Burst VII",description:"Earn 5,000,000,000,000 coins in a single sell-all.",category:"shop",rarity:"celestial",visibility:"public",target:5e12,icon:"üí∞",hiddenTargetUntil:"shop:sell-burst-1000000000000"},{id:"garden:mutation-appraiser-10000000",title:"Mutation Appraiser I",description:"Track 10,000,000 coins of mutation value.",category:"garden",rarity:"common",visibility:"public",target:1e7,icon:"üß´"},{id:"garden:mutation-appraiser-50000000",title:"Mutation Appraiser II",description:"Track 50,000,000 coins of mutation value.",category:"garden",rarity:"uncommon",visibility:"public",target:5e7,icon:"üß´"},{id:"garden:mutation-appraiser-500000000",title:"Mutation Appraiser III",description:"Track 500,000,000 coins of mutation value.",category:"garden",rarity:"rare",visibility:"public",target:5e8,icon:"üß´"},{id:"garden:mutation-appraiser-25000000000",title:"Mutation Appraiser IV",description:"Track 25,000,000,000 coins of mutation value.",category:"garden",rarity:"legendary",visibility:"public",target:25e9,icon:"üß´"},{id:"garden:mutation-appraiser-100000000000",title:"Mutation Appraiser V",description:"Track 100,000,000,000 coins of mutation value.",category:"garden",rarity:"mythical",visibility:"public",target:1e11,icon:"üß´"},{id:"garden:mutation-appraiser-500000000000",title:"Mutation Appraiser VI",description:"Track 500,000,000,000 coins of mutation value.",category:"garden",rarity:"divine",visibility:"public",target:5e11,icon:"üß´"},{id:"garden:mutation-appraiser-1000000000000",title:"Mutation Appraiser VII",description:"Track 1,000,000,000,000 coins of mutation value.",category:"garden",rarity:"celestial",visibility:"public",target:1e12,icon:"üß´",hiddenTargetUntil:"garden:mutation-appraiser-500000000000"},{id:"garden:boosted-operation-100",title:"Boosted Operation I",description:"Track 100 crop boost procs.",category:"garden",rarity:"common",visibility:"public",target:100,icon:"‚öôÔ∏è"},{id:"garden:boosted-operation-600",title:"Boosted Operation II",description:"Track 600 crop boost procs.",category:"garden",rarity:"uncommon",visibility:"public",target:600,icon:"‚öôÔ∏è"},{id:"garden:boosted-operation-2000",title:"Boosted Operation III",description:"Track 2,000 crop boost procs.",category:"garden",rarity:"rare",visibility:"public",target:2e3,icon:"‚öôÔ∏è"},{id:"garden:boosted-operation-6000",title:"Boosted Operation IV",description:"Track 6,000 crop boost procs.",category:"garden",rarity:"legendary",visibility:"public",target:6e3,icon:"‚öôÔ∏è"},{id:"garden:boosted-operation-15000",title:"Boosted Operation V",description:"Track 15,000 crop boost procs.",category:"garden",rarity:"mythical",visibility:"public",target:15e3,icon:"‚öôÔ∏è"},{id:"garden:boosted-operation-35000",title:"Boosted Operation VI",description:"Track 35,000 crop boost procs.",category:"garden",rarity:"divine",visibility:"public",target:35e3,icon:"‚öôÔ∏è"},{id:"garden:boosted-operation-100000",title:"Boosted Operation VII",description:"Track 100,000 crop boost procs.",category:"garden",rarity:"celestial",visibility:"public",target:1e5,icon:"‚öôÔ∏è",hiddenTargetUntil:"garden:boosted-operation-35000"},{id:"pets:chow-line-80",title:"Pet Chow Line I",description:"Use 80 instant feeds.",category:"pets",rarity:"common",visibility:"public",target:80,icon:"üçñ"},{id:"pets:chow-line-240",title:"Pet Chow Line II",description:"Use 240 instant feeds.",category:"pets",rarity:"uncommon",visibility:"public",target:240,icon:"üçñ"},{id:"pets:chow-line-720",title:"Pet Chow Line III",description:"Use 720 instant feeds.",category:"pets",rarity:"rare",visibility:"public",target:720,icon:"üçñ"},{id:"pets:chow-line-1850",title:"Pet Chow Line IV",description:"Use 1,850 instant feeds.",category:"pets",rarity:"legendary",visibility:"public",target:1850,icon:"üçñ"},{id:"pets:chow-line-5000",title:"Pet Chow Line V",description:"Use 5,000 instant feeds.",category:"pets",rarity:"mythical",visibility:"public",target:5e3,icon:"üçñ"},{id:"pets:chow-line-15000",title:"Pet Chow Line VI",description:"Use 15,000 instant feeds.",category:"pets",rarity:"divine",visibility:"public",target:15e3,icon:"üçñ"},{id:"pets:chow-line-50000",title:"Pet Chow Line VII",description:"Use 50,000 instant feeds.",category:"pets",rarity:"celestial",visibility:"public",target:5e4,icon:"üçñ",hiddenTargetUntil:"pets:chow-line-15000"},{id:"weather:dawnsmith-10",title:"Dawnsmith I",description:"Harvest 10 crops during Dawn moon.",category:"weather",rarity:"common",visibility:"public",target:10,icon:"üåÖ"},{id:"weather:dawnsmith-40",title:"Dawnsmith II",description:"Harvest 40 crops during Dawn moon.",category:"weather",rarity:"uncommon",visibility:"public",target:40,icon:"üåÖ"},{id:"weather:dawnsmith-250",title:"Dawnsmith III",description:"Harvest 250 crops during Dawn moon.",category:"weather",rarity:"rare",visibility:"public",target:250,icon:"üåÖ"},{id:"weather:dawnsmith-1000",title:"Dawnsmith IV",description:"Harvest 1,000 crops during Dawn moon.",category:"weather",rarity:"legendary",visibility:"public",target:1e3,icon:"üåÖ"},{id:"weather:dawnsmith-5000",title:"Dawnsmith V",description:"Harvest 5,000 crops during Dawn moon.",category:"weather",rarity:"mythical",visibility:"public",target:5e3,icon:"üåÖ"},{id:"weather:dawnsmith-12000",title:"Dawnsmith VI",description:"Harvest 12,000 crops during Dawn moon.",category:"weather",rarity:"divine",visibility:"public",target:12e3,icon:"üåÖ"},{id:"weather:dawnsmith-250000",title:"Dawnsmith VII",description:"Harvest 250,000 crops during Dawn moon.",category:"weather",rarity:"celestial",visibility:"public",target:25e4,icon:"üåÖ",hiddenTargetUntil:"weather:dawnsmith-12000"},{id:"weather:amberforge-10",title:"Amberforge I",description:"Harvest 10 crops during Amber moon.",category:"weather",rarity:"common",visibility:"public",target:10,icon:"üü†"},{id:"weather:amberforge-40",title:"Amberforge II",description:"Harvest 40 crops during Amber moon.",category:"weather",rarity:"uncommon",visibility:"public",target:40,icon:"üü†"},{id:"weather:amberforge-250",title:"Amberforge III",description:"Harvest 250 crops during Amber moon.",category:"weather",rarity:"rare",visibility:"public",target:250,icon:"üü†"},{id:"weather:amberforge-1000",title:"Amberforge IV",description:"Harvest 1,000 crops during Amber moon.",category:"weather",rarity:"legendary",visibility:"public",target:1e3,icon:"üü†"},{id:"weather:amberforge-5000",title:"Amberforge V",description:"Harvest 5,000 crops during Amber moon.",category:"weather",rarity:"mythical",visibility:"public",target:5e3,icon:"üü†"},{id:"weather:amberforge-12000",title:"Amberforge VI",description:"Harvest 12,000 crops during Amber moon.",category:"weather",rarity:"divine",visibility:"public",target:12e3,icon:"üü†"},{id:"weather:amberforge-250000",title:"Amberforge VII",description:"Harvest 250,000 crops during Amber moon.",category:"weather",rarity:"celestial",visibility:"public",target:25e4,icon:"üü†",hiddenTargetUntil:"weather:amberforge-12000"},{id:"weather:fresh-freeze-harvest-10",title:"Fresh Freeze I",description:"Harvest 10 Frozen variants during snow.",category:"weather",rarity:"common",visibility:"public",target:10,icon:"üßä"},{id:"weather:fresh-freeze-harvest-40",title:"Fresh Freeze II",description:"Harvest 40 Frozen variants during snow.",category:"weather",rarity:"uncommon",visibility:"public",target:40,icon:"üßä"},{id:"weather:fresh-freeze-harvest-250",title:"Fresh Freeze III",description:"Harvest 250 Frozen variants during snow.",category:"weather",rarity:"rare",visibility:"public",target:250,icon:"üßä"},{id:"weather:fresh-freeze-harvest-1000",title:"Fresh Freeze IV",description:"Harvest 1,000 Frozen variants during snow.",category:"weather",rarity:"legendary",visibility:"public",target:1e3,icon:"üßä"},{id:"weather:fresh-freeze-harvest-5000",title:"Fresh Freeze V",description:"Harvest 5,000 Frozen variants during snow.",category:"weather",rarity:"mythical",visibility:"public",target:5e3,icon:"üßä"},{id:"weather:fresh-freeze-harvest-12000",title:"Fresh Freeze VI",description:"Harvest 12,000 Frozen variants during snow.",category:"weather",rarity:"divine",visibility:"public",target:12e3,icon:"üßä"},{id:"weather:fresh-freeze-harvest-250000",title:"Fresh Freeze VII",description:"Harvest 250,000 Frozen variants during snow.",category:"weather",rarity:"celestial",visibility:"public",target:25e4,icon:"üßä",hiddenTargetUntil:"weather:fresh-freeze-harvest-12000"},{id:"onetime:first-contact",title:"First Contact",description:"Join your first public room session.",category:"streaks",rarity:"common",visibility:"public",target:1,icon:"üõ∞Ô∏è",oneTime:!0},{id:"onetime:marathoner",title:"Marathoner",description:"Stay in a single room session for 60 minutes.",category:"streaks",rarity:"rare",visibility:"public",target:60,icon:"‚è≥",oneTime:!0},{id:"onetime:market-buzz-25000000",title:"Market Buzz",description:"Earn 25,000,000 coins in a single sell-all.",category:"shop",rarity:"legendary",visibility:"public",target:25e6,icon:"üìà",oneTime:!0},{id:"onetime:market-shock-250000000000",title:"Market Shock",description:"Earn 250,000,000,000 coins in a single sell-all.",category:"shop",rarity:"mythical",visibility:"public",target:25e10,icon:"üìâ",oneTime:!0},{id:"onetime:perfect-storm",title:"Perfect Storm",description:"Log three different weather events in one hour.",category:"weather",rarity:"legendary",visibility:"public",target:3,icon:"üå™Ô∏è",oneTime:!0,tags:["window"]},{id:"onetime:rainbow-weather",title:"Rainbow Weather",description:"Trigger a rainbow pet ability during rain or snow.",category:"abilities",rarity:"legendary",visibility:"public",target:1,icon:"üåà",oneTime:!0},{id:"onetime:goldsmith",title:"Goldsmith",description:"Trigger a gold pet ability during Dawn moon.",category:"abilities",rarity:"legendary",visibility:"public",target:1,icon:"ü•á",oneTime:!0},{id:"onetime:crystal-clear",title:"Crystal Clear",description:"Harvest a Frozen variant while snow is active.",category:"weather",rarity:"rare",visibility:"public",target:1,icon:"üîÆ",oneTime:!0},{id:"onetime:quiet-profit-50000000",title:"Quiet Profit",description:"Earn 50,000,000 coins from a sell-all while alone in a room.",category:"shop",rarity:"legendary",visibility:"public",target:5e7,icon:"ü§´",oneTime:!0},{id:"onetime:dawn-double",title:"Dawn Double",description:"Hatch a rainbow pet and harvest a max-size crop during the same Dawn moon.",category:"weather",rarity:"mythical",visibility:"public",target:1,icon:"üåÖ",oneTime:!0,tags:["window"]},{id:"onetime:amber-artisan",title:"Amber Artisan",description:"Hatch a gold pet and sell 100,000,000+ coins in one action during the same Amber moon.",category:"weather",rarity:"mythical",visibility:"public",target:1,icon:"üü†",oneTime:!0,tags:["window"]}])}function cf(){return lf(),[...Em.definitions]}function df(){return new Map(Em.progress)}async function pf(){const e=Date.now(),t=hl(),n=Is();let o=null,r=null,i=null,a=null,l=null;const c={};let d=null,p=null;const u={},g={};let m=null,f=null,h=null,b=null,y=null,x=null,v=null,w=null,C=null,S=null,P=null,k=null,A=null,E=null;try{const e=V("myCoinsCountAtom");if(e){const t=await W(e);o="number"==typeof t?t:Number(t??NaN),Number.isFinite(o)||(o=null)}}catch(j){s("‚ö†Ô∏è Achievements: coin balance snapshot failed",j)}try{const e=V("inventoryValueAtom");if(e){const t=await W(e);Number.isFinite(t)&&(l=t)}if(null==l&&t?.shop){const e=Ym(t.shop,["inventoryValue","inventoryWorth",["inventory","value"],["inventory","worth"],["inventory","total"],["inventory","coins"],["inventory","netWorth"]]);null!=e&&(l=e)}if(null==l){const e=(e=>{let t=0,n=!1;const o=["value","worth","price","sellValue","sellPrice","coinValue",["sell","value"],["sale","value"]];for(const r of e){const e=Number(r.quantity??r.count??r.amount??r.stackSize??0);if(!Number.isFinite(e)||e<=0)continue;const i=Ym(r,o)??Ym(r.raw,o);null!=i&&i>0&&(n=!0,t+=i*e)}return n?t:null})(n);null!=e&&(l=e)}}catch(j){s("‚ö†Ô∏è Achievements: inventory value snapshot failed",j)}try{const e=e=>{let t=null;const n=e=>{const t=e?.raw??{};if([e.itemType,e.name,e.displayName,e.id,e.species,t.itemType,t.type,t.category,t.subType,t.itemCategory,t.itemSubType,t.kind].some(e=>`${e??""}`.toLowerCase().includes("seed")))return!0;const n=[t.tags,t.tagList,t.itemTags,t.labels];for(const o of n)if(Array.isArray(o)&&o.some(e=>`${e??""}`.toLowerCase().includes("seed")))return!0;return!0===t.isSeed},o=e=>{const t=e?.raw??{},n=[e.quantity,e.count,e.amount,e.stackSize,e.qty,e.owned,e.quantityOwned,t.quantity,t.count,t.amount,t.stackSize,t.qty,t.owned,t.quantityOwned];for(const o of n){const e=Number(o);if(Number.isFinite(e)&&e>0)return e}return null};for(const r of e){if(!n(r))continue;const e=o(r);!Number.isFinite(e)||e<=0||(t=null==t?e:Math.max(t,e))}return t},t=await zs(),o=e(t?.items??[]),r=[o,e(n)].filter(e=>Number.isFinite(e));r.length&&(d=Math.max(...r))}catch(j){s("‚ö†Ô∏è Achievements: seed stack scan failed",j)}try{const t=Ml(),n=e,o=[],r=new Set(["GoldGranter","RainbowGranter","ProduceScaleBoost","ProduceScaleBoostII"]);if(t.forEach(e=>{const{abilityId:t,events:n,lastPerformedAt:r}=e;u[t]=(u[t]??0)+n.length;const i=n.length?Math.max(...n.map(e=>e.performedAt)):r??null,a=g[t];g[t]=null==a?i:Math.max(a,i??0),n.forEach(e=>{if(!e)return;const n=Number(e.performedAt??0);!Number.isFinite(n)||n<=0||o.push({abilityId:t,performedAt:n})})}),o.length){const e=n-3e5,t=n-3e4,i=n-18e5,a=new Set,s=new Set;let l=0;o.forEach(({abilityId:n,performedAt:o})=>{o>=e&&a.add(n),o>=t&&s.add(n),o>=i&&r.has(n)&&(l+=1)}),f=a.size,h=s.size,b=l}if(0===Object.keys(u).length){const e=T?.AriesMod?.services?.PetsService;if(e&&"function"==typeof e.getAbilityLogs)try{const t=await e.getAbilityLogs();Array.isArray(t)&&t.forEach(e=>{const t=String(e?.abilityId??e?.id??"").trim(),n=Number(e?.performedAt??e?.timestamp??e?.createdAt??0);if(!t)return;if(!Number.isFinite(n)||n<=0)return;u[t]=(u[t]??0)+1;const o=g[t];g[t]=null==o?n:Math.max(o,n)})}catch(j){s("‚ö†Ô∏è Achievements: Aries ability log backfill failed",j)}}}catch(j){s("‚ö†Ô∏è Achievements: ability history scan failed",j)}try{const e=e=>{const t=(e,n)=>{if(n>4||null==e)return[];if(Array.isArray(e)){const t=e.filter(e=>e&&"object"==typeof e);if(t.length)return t}if("object"!=typeof e)return[];const o=[],r=["items","pets","inventory","entries","list","data","value"];for(const t of r){const n=e[t];Array.isArray(n)&&o.push(...n.filter(e=>e&&"object"==typeof e))}for(const i of Object.values(e))o.push(...t(i,n+1));return o};return t(e,0)},t=async t=>{const n=V(t);if(!n)return[];try{const t=await W(n);return e(t)}catch(j){return s(`‚ö†Ô∏è Achievements: failed to read ${t} for rainbow count`,j),[]}},o=async()=>{let o=[];const r=["myPetInventoryAtom","myPetHutchPetItemsAtom"];for(const e of r)o.push(...await t(e));if(!o.length)try{const t=O(/pet|hutch/i);for(const n of t)try{const t=await W(n);o.push(...e(t))}catch{}}catch{}if(!o.length)for(const e of n){const t=e?.raw??e;(String(t?.itemType??t?.type??"").toLowerCase().includes("pet")||t?.petSpecies||t?.species)&&o.push(t)}return o},r=e=>{const t=e?.raw??e??{};if([e.rarity,e.petRarity,e.rarityName,e.quality,e.variant,e.mutation,e.name,e.petVariant,t.rarity,t.petRarity,t.rarityName,t.quality,t.variant,t.mutation,t.name].some(e=>`${e??""}`.toLowerCase().includes("rainbow")))return!0;const n=[];return Array.isArray(e?.mutations)&&n.push(...e.mutations),Array.isArray(t?.mutations)&&n.push(...t.mutations),Array.isArray(t?.pet?.mutations)&&n.push(...t.pet.mutations),!!n.some(e=>`${e??""}`.toLowerCase().includes("rainbow"))||(!0===e?.isRainbow||!0===t.isRainbow)},i=(e=>{let t=0;const n=new Set;return e.forEach((e,o)=>{if(!e)return;if(!r(e))return;const i=String(e.id??e.itemId??e.petId??`${e.petSpecies??e.species??"pet"}:${o}`);n.has(i)||(n.add(i),t+=1)}),t})(await o());Number.isFinite(i)&&(p=i)}catch(j){s("‚ö†Ô∏è Achievements: rainbow ownership scan failed",j)}try{const e=Er();if(e?.length){m=e.filter(e=>e.abilities?.some(e=>"ProduceScaleBoost"===e||"ProduceScaleBoostII"===e)).length;const t=e.filter(e=>Array.isArray(e.abilities)&&e.abilities.length>=4).length;t>0&&(v=t)}}catch(j){s("‚ö†Ô∏è Achievements: boost pet scan failed",j)}try{const e=V("lastCurrencyTransactionAtom");e&&(r=await W(e))}catch(j){s("‚ö†Ô∏è Achievements: transaction snapshot failed",j)}let $=null,M=null,I=null,F=null,z=null,L=null,R=null,q=null,N=null;try{const e=await Ca();if(e)I=Math.round(e.produce.collected),F=Math.round(e.produce.total),$=Math.round(e.produce.percentage),z=Math.round(e.petVariants.collected),L=Math.round(e.petVariants.total),M=Math.round(e.petVariants.percentage);else{const e=await va();if(e?.produce){const t=Object.values(e.produce);if(t.length){const e=t.filter(e=>100===e?.completion).length;I=e,F=t.length,$=Math.round(e/t.length*100)}}if(e?.pets){const t=Object.values(e.pets);if(t.length){const e=t.filter(e=>100===e?.completion).length;z=e,L=t.length,M=Math.round(e/t.length*100)}}}try{const e=await wa();if(e?.produce?.length){let t=0,n=0;e.produce.forEach(e=>{e.variants.every(e=>e.collected)&&(t+=1);e.variants.some(e=>e.collected&&/max\s*weight/i.test(e.variant))&&(n+=1)}),R=t,N=n}if(e?.pets?.length){let t=0;e.pets.forEach(e=>{e.variants.every(e=>e.collected)&&(t+=1)}),q=t}}catch(j){s("‚ö†Ô∏è Achievements: journal summary scan failed",j)}}catch(j){s("‚ö†Ô∏è Achievements: journal snapshot failed",j)}const B=e=>{if(!e||"object"!=typeof e||!t)return;const n=e.player??e,o=n.garden??n.plants??n.farm??n,r=n.pets??n,s=n.abilities??n.abilityStats??n,l=n.shop??n.shops??n.economy??n,d=n.weather??n,p=e.player;if(p&&"object"==typeof p){const e=Ym(p,["numSeedsPlanted","numPlantsPotted"]);null!=e&&e>t.garden.totalPlanted&&(t.garden.totalPlanted=e);const n=Ym(p,["numCropsHarvested"]);null!=n&&n>t.garden.totalHarvested&&(t.garden.totalHarvested=n);const o=Ym(p,["numPlantsWatered"]);null!=o&&o>t.garden.totalWateringCans&&(t.garden.totalWateringCans=o);const r=Ym(p,["numPlantsDestroyed"]);null!=r&&r>t.garden.totalDestroyed&&(t.garden.totalDestroyed=r);const s=Ym(p,["numEggsHatched"]);null!=s&&s>t.pets.totalHatched&&(t.pets.totalHatched=s);const l=Ym(p,["numRainbowPetsHatched",["rarity","rainbow"]]);null!=l&&l>t.pets.hatchedByRarity.rainbow&&(t.pets.hatchedByRarity.rainbow=l);const c=Ym(p,["totalEarningsSellCrops"]);null!=c&&(i=c);const d=Ym(p,["totalEarningsSellPet"]);null!=d&&(a=d)}const u=Ym(o,["seedsPlanted","totalPlanted","planted",["stats","planted"],"totalSeedsPlanted"]);null!=u&&u>t.garden.totalPlanted&&(t.garden.totalPlanted=u);const g=Ym(o,["cropsHarvested","totalHarvested","harvested",["stats","harvested"],"totalCropsHarvested"]);null!=g&&g>t.garden.totalHarvested&&(t.garden.totalHarvested=g);const m=Ym(o,["plantsWatered","totalWateringCans","watered",["stats","watered"],"wateringCansUsed","watercanUsed"]);null!=m&&m>t.garden.totalWateringCans&&(t.garden.totalWateringCans=m);const f=Ym(o,["plantsDestroyed","totalDestroyed","destroyed"]);null!=f&&f>t.garden.totalDestroyed&&(t.garden.totalDestroyed=f);const h=Ym(r,["eggsHatched","totalHatched","hatched","petsHatched"]);null!=h&&h>t.pets.totalHatched&&(t.pets.totalHatched=h);const b=Ym(r,["gold","hatchedGold","goldPets",["rarity","gold"]]);null!=b&&b>t.pets.hatchedByRarity.gold&&(t.pets.hatchedByRarity.gold=b);const y=r.hatchedByType;if(y&&"object"==typeof y){let e=t.pets.totalHatched,n=t.pets.hatchedByRarity.gold,o=t.pets.hatchedByRarity.rainbow;for(const t of Object.values(y)){if(!t||"object"!=typeof t)continue;const r=Number(t.normal??0),i=Number(t.gold??0),a=Number(t.rainbow??0);Number.isFinite(r)&&(e+=r),Number.isFinite(i)&&(e+=i,n+=i),Number.isFinite(a)&&(e+=a,o+=a)}e>t.pets.totalHatched&&(t.pets.totalHatched=e),n>t.pets.hatchedByRarity.gold&&(t.pets.hatchedByRarity.gold=n),o>t.pets.hatchedByRarity.rainbow&&(t.pets.hatchedByRarity.rainbow=o)}const x=(()=>{const e=Ym(s,["totalProcs","procs","abilityProcs",["stats","procs"]]);if(null!=e)return e;const n=s.triggers??s.triggerCounts??s.abilityTriggers??s;if(n&&"object"==typeof n){let e=0,o=0;for(const t of Object.values(n))if(t&&"object"==typeof t&&"triggers"in t){const n=Number(t.triggers),r=Number(t.totalValue??0);Number.isFinite(n)&&(e+=n),Number.isFinite(r)&&(o+=r)}return o>t.abilities.totalEstimatedValue&&(t.abilities.totalEstimatedValue=o),e>0?e:null}return null})();null!=x&&x>t.abilities.totalProcs&&(t.abilities.totalProcs=x);const v=Ym(l,["totalSpentCoins","coinsSpent","spentCoins","totalCoinsSpent","totalCoinsUsed","coinsUsed","spendCoins","spent",["spend","coins"],["coins","spent"]]);if(null!=v&&v>t.shop.totalSpentCoins&&(t.shop.totalSpentCoins=v),p&&"object"==typeof p){const e=Ym(p,["coinsSpent","totalCoinsSpent","totalSpentCoins"]);null!=e&&e>t.shop.totalSpentCoins&&(t.shop.totalSpentCoins=e)}const w=Ym(l,["cropEarnings","cropsEarned","coinsFromCrops","coinsEarnedFromCrops","totalCropEarnings","cropCoinsEarned",["cropsSold","coins"],["cropsSold","value"],["cropsSold","total"],"cropsSoldValue",["shop","totalSpentCoins"]]);null!=w&&null==i&&(i=w);const C=Ym(l,["petEarnings","coinsFromPets","coinsEarnedFromPets","petsSoldValue"]);if(null!=C&&null==a&&(a=C),null==i){const e=Ym(l,["cropsSoldCount"]);null!=e&&(i=e)}const T=Ym(d,["totalSwaps","swaps","weatherSwaps"]);if(null!=T&&(t.weather.totalSwaps=T),d&&"object"==typeof d&&d!==n){let e=0;for(const[t,n]of Object.entries(d))if(n&&"object"==typeof n&&"triggers"in n){const o=Number(n.triggers);Number.isFinite(o)&&(e+=o,c[t]=o)}e>t.weather.totalSwaps&&(t.weather.totalSwaps=e)}};try{const e=V("myStatsAtom");if(e&&t){const t=await W(e);if(B(t),!Um&&t&&"object"==typeof t){Um=!0;Object.keys(t),["player","garden","plants","farm","pets","abilities","abilityStats","shop","economy","weather"].reduce((e,n)=>(n in t&&(e[n]=Object.keys(t[n]||{})),e),{});if(!Km&&t.player){Km=!0;const e=t.player;Object.keys(e||{}),Object.fromEntries(Object.entries(e||{}).slice(0,5))}}}}catch(j){s("‚ö†Ô∏è Achievements: merge from live stats atom failed",j)}try{const e=await async function(){try{const e=T?.AriesMod?.services?.StatsService;return e?"function"==typeof e.getStats?await e.getStats():"function"==typeof e.getSnapshot?await e.getSnapshot():"function"==typeof e.getState?await e.getState():"object"==typeof e.stats?e.stats:null:null}catch(j){return s("‚ö†Ô∏è Achievements: Aries StatsService fetch failed",j),null}}();if(e&&(af(e),B(e),!Xm&&e&&"object"==typeof e)){Xm=!0;Object.keys(e),["garden","plants","farm","pets","abilities","abilityStats","shop","economy","weather"].reduce((t,n)=>(n in e&&(t[n]=Object.keys(e[n]||{})),t),{});if(!Qm){Qm=!0;const t=(e,t)=>{if(!e||"object"!=typeof e||!(t in e))return;const n=e[t];return n&&"object"==typeof n?Object.fromEntries(Object.entries(n).slice(0,5)):n};t(e,"garden"),t(e,"pets"),t(e,"abilities"),t(e,"shops"),t(e,"weather"),Jm||(Jm=!0,e.shops&&e.shops)}}}catch(j){s("‚ö†Ô∏è Achievements: Aries stats merge failed",j)}try{if(t?.weather?.timeByKind){const e=new Set;Object.entries(t.weather.timeByKind).forEach(([t,n])=>{const o=Number(n??0);Number.isFinite(o)&&o>0&&e.add(t.toLowerCase())});const n=t.weather.activeKind;n&&e.add(String(n).toLowerCase()),x=e}if(t?.weather?.activeKind&&tf(t.weather.activeKind,e),ef(e),Wm.length){w=new Set(Wm.map(e=>e.kind)).size}}catch(j){s("‚ö†Ô∏è Achievements: weather seen scan failed",j)}try{const e=Ae.inventory??Ae.garden??null;if(e){const t=e,n=Math.max(0,(t.overallTrackedPlantCount??0)-(t.overallEligiblePlantCount??0)),o=Math.max(0,t.lunar?.mutatedPlantCount??0),r=[n,o,Math.max(n,o,t.lunar?.mutatedFruitCount??0)].filter(e=>Number.isFinite(e));r.length&&(y=Math.max(...r))}}catch(j){s("‚ö†Ô∏è Achievements: mutation summary scan failed",j)}const D=function(e=Date.now()){Sm(e);const t=new Set,n=new Set;return ym.forEach(o=>{const r=e-o.timestamp;r<=bm&&(o.species.forEach(e=>n.add(e)),r<=6e4&&o.species.forEach(e=>t.add(e)))}),{unique60s:t.size,unique10m:n.size}}();C=Rm,S=Math.floor(qm),P=Dm||null,k=_m||null,A=Om,E=Gm||null;const H={stats:t,inventoryCount:n.length,inventoryValue:l,journalProduceCompletion:$,journalPetCompletion:M,journalProduceCompleted:I,journalProduceTotal:F,journalPetCompleted:z,journalPetTotal:L,journalProduceSpeciesCompleted:R,journalPetSpeciesCompleted:q,journalProduceMaxWeightCompleted:N,coinBalance:o,lastCurrencyTransaction:r,cropEarnings:i,petEarnings:a,weatherTriggers:c,maxSeedsOfSingleType:d,rainbowHatches:(()=>{const e=t?.pets.hatchedByRarity.rainbow;return null!=p?p:e??null})(),abilityCounts:u,abilityLastProc:g,boostPetsActive:m,abilityUnique5m:f,abilityUnique30s:h,mutationEvents30m:b,mutatedHarvests:y,weatherSeenKinds:x,activePetsWithFourAbilities:v,saleUnique60s:D.unique60s,saleUnique10m:D.unique10m,roomJoinCount:C,roomMinutes:S,lastRoomPlayers:P,sellBurstCoins:k,sellBurstAlone:A,instantFeedsUsed:E,weatherEventsLastHour:w};return t.garden.totalPlanted,t.garden.totalHarvested,t.garden.totalWateringCans,t.garden.totalDestroyed,t.pets.totalHatched,t.pets.hatchedByRarity.gold,t.abilities.totalProcs,t.abilities.totalEstimatedValue,t.weather.totalSwaps,Em.lastSnapshot=H,H}let uf=null;const gf=800;function mf(){null!=uf&&clearTimeout(uf),uf=window.setTimeout(async()=>{uf=null;try{lf();const e=await pf();!function(e,t){const n=Date.now(),o=t.abilityCounts??{},r=t.abilityLastProc??{},i=t.abilityUnique5m??0,a=t.abilityUnique30s??0,l=t.mutationEvents30m??0,c=t.mutatedHarvests??0,d=t.weatherSeenKinds??null,p=t.activePetsWithFourAbilities??0,u=t.saleUnique60s??0,g=t.saleUnique10m??0,m=t.roomJoinCount??0,f=t.roomMinutes??0,h=t.sellBurstCoins??0,b=t.sellBurstAlone??!1,y=t.instantFeedsUsed??0,x=t.weatherEventsLastHour??0;e.forEach(e=>{const v=Em.progress.get(e.id)??{id:e.id,current:0,target:"number"==typeof e.target?e.target:0,completedAt:null,lastUpdated:n,ineligible:!1};let w=v.current;const C="number"==typeof e.target?e.target:0,T=!!v.completedAt,S=!!e.oneTime;let P=!!v.ineligible;try{if(t.stats){const s=t.weatherTriggers??{};if(e.id.startsWith("garden:seedling-"))w=t.stats.garden.totalPlanted;else if(e.id.startsWith("garden:harvester-"))w=t.stats.garden.totalHarvested;else if(e.id.startsWith("garden:watering-"))w=t.stats.garden.totalWateringCans;else if(e.id.startsWith("pets:hatchling-"))w=t.stats.pets.totalHatched;else if(e.id.startsWith("pets:gold-"))w=t.stats.pets.hatchedByRarity.gold;else if(e.id.startsWith("pets:rainbow-"))w=t.rainbowHatches??t.stats.pets.hatchedByRarity.rainbow;else if(e.id.startsWith("abilities:proc-"))w=t.stats.abilities.totalProcs;else if(e.id.startsWith("economy:crop-earner-"))w=t.cropEarnings??v.current;else if(e.id.startsWith("weather:fresh-frozen-"))w=s.frost??0;else if(e.id.startsWith("weather:early-bird-"))w=s.dawn??0;else if(e.id.startsWith("weather:night-owl-"))w=s.ambermoon??0;else if("onetime:fire-sale"===e.id)w=u;else if("onetime:market-maker"===e.id)w=g;else if(e.id.startsWith("rooms:socialite-"))w=m;else if(e.id.startsWith("rooms:anchor-"))w=f;else if(e.id.startsWith("shop:sell-burst-"))w=h;else if("onetime:market-buzz-25000000"===e.id||"onetime:market-shock-250000000000"===e.id)w=h;else if("onetime:quiet-profit-50000000"===e.id)w=b?h:0;else if(e.id.startsWith("collection:produce-"))w=t.journalProduceCompleted??v.current;else if(e.id.startsWith("collection:pets-"))w=t.journalPetCompleted??v.current;else if(e.id.startsWith("garden:seed-hoarder-"))w=t.maxSeedsOfSingleType??0;else if("onetime:rich"===e.id||"onetime:baller-status"===e.id||"onetime:whos-bill-gates"===e.id||"onetime:what-is-money"===e.id||"onetime:what-is-grass"===e.id)w=t.coinBalance??v.current;else if("onetime:god-tier-research"===e.id){const e=null!=t.journalProduceCompleted&&null!=t.journalProduceTotal&&t.journalProduceCompleted>=t.journalProduceTotal,n=null!=t.journalPetCompleted&&null!=t.journalPetTotal&&t.journalPetCompleted>=t.journalPetTotal;w=e&&n?C:0}else if("onetime:money-cant-buy-happiness"===e.id){const e=t.stats.pets.totalHatched,n=t.cropEarnings??0,o=e>=1e3&&n>=1e9;P=o,o&&(w=C)}else if("onetime:perfect-produce"===e.id)w=(t.journalProduceSpeciesCompleted??0)>0?C:0;else if("onetime:perfect-symmetry"===e.id)w=(t.journalPetSpeciesCompleted??0)>0?C:0;else if("onetime:mutation-marathon"===e.id)w=l;else if("onetime:all-weathered"===e.id)if(d&&d.size>0){const e=Array.from(d).some(e=>e.includes("dawn")),t=Array.from(d).some(e=>e.includes("amber")),n=Array.from(d).some(e=>e.includes("snow")||e.includes("frost"));w=e&&t&&n?C:0}else w=v.current;else if("onetime:triple-hatch"===e.id)w=v.current;else if("onetime:These-Exist!?"===e.id)w=p>0?C:0;else if("onetime:this-is-only-the-beginning"===e.id)w=o.ProduceEater??0,w>0&&(w=C);else if("onetime:yummy-crop-eater"===e.id)w=o.ProduceEater??0,w>0&&(w=C);else if("onetime:gamblers-fallacy"===e.id){const e=t.boostPetsActive??0,o=Math.max(r.ProduceScaleBoost??0,r.ProduceScaleBoostII??0),i=o>0?n-o:Number.POSITIVE_INFINITY;w=e>=3&&i>=432e5?C:0}else w="onetime:ability-synergy"===e.id?i:"onetime:combo-caster"===e.id?a:"onetime:abilities:crit-crafter"===e.id?(o.GoldGranter??0)+(o.RainbowGranter??0):e.id.startsWith("pets:chow-line-")?y:e.id.startsWith("garden:mutation-harvester-")?c:e.id.startsWith("garden:giant-grower-")?t.journalProduceMaxWeightCompleted??v.current:e.id.startsWith("abilities:empowered-harvest-")?(o.GoldGranter??0)+(o.RainbowGranter??0):"onetime:perfect-storm"===e.id?x:v.current}}catch($){s("‚ö†Ô∏è Achievements evaluate error",$)}const k=!P&&w>=C&&C>0,A=v.completedAt||(k?n:null),E={...v,current:w,target:C,completedAt:A,lastUpdated:n,ineligible:P};Em.progress.set(e.id,E),!T&&k&&$i({feature:"achievements",level:"success",message:`${S?"One-time achievement":"Achievement"}: ${e.title} completed!`})})}(Em.definitions,e),function(){try{const e=Array.from(Em.progress.values());g.set(km,{progress:e})}catch(e){s("‚ö†Ô∏è Achievements: failed to persist",e)}}(),Am.forEach(e=>{try{e(Em.progress)}catch(t){s("‚ö†Ô∏è Achievements listener error",t)}})}catch(e){s("‚ö†Ô∏è Achievements evaluation failed",e)}},gf)}function ff(){if(!Em.initialized){Em.initialized=!0,function(){try{const e=g.get(km,null);if(!e||"object"!=typeof e)return;Array.isArray(e.progress)&&e.progress.forEach(e=>{if(!e||"object"!=typeof e)return;const t=String(e.id??"");if(!t)return;const n={id:t,current:Number(e.current??0),target:Number(e.target??0),completedAt:e.completedAt??null,lastUpdated:e.lastUpdated??Date.now(),ineligible:!!e.ineligible};Em.progress.set(t,n)})}catch(e){s("‚ö†Ô∏è Achievements: failed to load persisted state",e)}}(),lf(),async function(){if(wl)return;wl=!0;const e=V("myPetSlotInfosAtom");if(!e)throw wl=!1,new Error("myPetSlotInfosAtom not available");try{Cl=await U(e,e=>{try{El(e)}catch(t){s("‚ö†Ô∏è Failed processing ability triggers",t)}})}catch(t){throw wl=!1,Cl=null,t}}().catch(e=>s("‚ö†Ô∏è Achievements: ability trigger store start failed",e)),kr().catch(e=>s("‚ö†Ô∏è Achievements: pet info store start failed",e)),Lm||(Lm=!0,Pm(()=>mf()).catch(e=>{s("‚ö†Ô∏è Achievements: sell window tracker failed to start",e),Lm=!1})),mf();try{$m=fl(()=>mf())}catch(e){s("‚ö†Ô∏è Achievements: failed to subscribe to stats",e)}Zm("myStatsAtom",e=>{Fm=e}),function(){try{const t=T?.AriesMod?.services?.StatsService;if(t&&"function"==typeof t.subscribe){const n=t.subscribe(t=>{try{af(t)}catch(e){s("‚ö†Ô∏è Achievements: Aries room snapshot handler failed",e)}mf()});"function"==typeof n&&(zm=n)}}catch(e){s("‚ö†Ô∏è Achievements: failed to subscribe to Aries StatsService",e)}}(),Zm("newLogsAtom",e=>{Mm=e},rf),Zm("newCropLogsFromSellingAtom",e=>{Im=e}),s("‚úÖ Achievements store initialized (phase 1 stub)")}}function hf(){mf()}const bf={respectRules:!1,avoidFavorited:!0,overrides:{},updatedAt:Date.now()},yf=["Carrot","Strawberry","Blueberry","Apple","Watermelon","Pumpkin"],xf=Object.fromEntries(Object.entries({Worm:["Carrot","Strawberry","Aloe","Tomato","Apple"],Snail:["Blueberry","Tomato","Corn","Daffodil"],Bee:["Strawberry","Blueberry","Daffodil","Lily","Chrysanthemum"],Chicken:["Aloe","Corn","Watermelon","Pumpkin"],Bunny:["Carrot","Strawberry","Blueberry","OrangeTulip","Apple"],Dragonfly:["Apple","OrangeTulip","Echeveria"],Pig:["Watermelon","Pumpkin","Mushroom","Bamboo"],Cow:["Coconut","Banana","BurrosTail","Mushroom"],Squirrel:["Pumpkin","Banana","Grape"],Turtle:["Watermelon","BurrosTail","Bamboo","Pepper"],Goat:["Pumpkin","Coconut","Pepper","Camellia","PassionFruit"],Butterfly:["Daffodil","Lily","Grape","Lemon","Sunflower","Chrysanthemum"],Capybara:["Lemon","PassionFruit","DragonFruit","Lychee"],Peacock:["Cactus","Sunflower","Lychee"]}).map(([e,t])=>{const n=Vn(e),o=t.map(e=>Vn(e)).filter(Boolean);return[n,{display:[...t],normalized:o}]})),vf=yf.map(e=>Vn(e));let wf=function(){const e=g.get("quinoa-pet-food-rules",{});if(!e||"object"!=typeof e)return{...bf};return{respectRules:"boolean"==typeof e.respectRules?e.respectRules:bf.respectRules,avoidFavorited:"boolean"==typeof e.avoidFavorited?e.avoidFavorited:bf.avoidFavorited,overrides:"object"==typeof e.overrides&&e.overrides?e.overrides:{},updatedAt:"number"==typeof e.updatedAt?e.updatedAt:Date.now()}}();function Cf(e){const t=[e.species,e.itemType,e.name];for(const n of t){if("string"!=typeof n||0===n.length)continue;const e=Vn(n);if(e)return e}return null}function Tf(e,t,n={}){if(!t||0===t.items.length)return null;const o=function(e){if(!e)return{display:[...yf],normalized:[...vf]};const t=Vn(e),n=t?xf[t]:void 0;return n||{display:[...yf],normalized:[...vf]}}(e),r=function(e){if(!e)return null;const t=Vn(e);return t&&wf.overrides[t]||null}(e),i=new Set(o.normalized),a=r?.preferred?Vn(r.preferred):null;if(a&&i.add(a),r?.allowed)for(const m of r.allowed){const e=Vn(m);e&&i.add(e)}const s=new Set;if(r?.forbidden)for(const m of r.forbidden){const e=Vn(m);e&&s.add(e)}0===i.size&&vf.forEach(e=>i.add(e));const l=n.avoidFavorited??wf.avoidFavorited,c=(e,n)=>{for(const o of t.items){const r=Cf(o);if(r&&((!e||!t.favoritedIds.has(o.id))&&n(r,o)))return o}return null},d=e=>a?c(e,e=>e===a):null,p=e=>c(e,e=>i.has(e)&&!s.has(e)),u=d(!0);if(u)return{item:u,usedFavoriteFallback:!1};if(l){const e=d(!1);if(e)return{item:e,usedFavoriteFallback:t.favoritedIds.has(e.id)}}const g=p(!0);if(g)return{item:g,usedFavoriteFallback:!1};if(l){const e=p(!1);if(e)return{item:e,usedFavoriteFallback:t.favoritedIds.has(e.id)}}return null}function Sf(){return T.MagicCircle_RoomConnection??null}function Pf(){const e=T;return e.__mga_lastScopePath?.slice()??["Room","Quinoa"]}function kf(e,t){try{const n=Sf();if(!n)return s("‚ö†Ô∏è MagicCircle_RoomConnection not found"),!1;const o={type:"FeedPet",petItemId:e,cropItemId:t,scopePath:Pf()};return s("üì§ Sending FeedPet WebSocket message",o),n.sendMessage(o),!0}catch(n){return s("‚ùå Failed to send FeedPet message",n),!1}}async function Af(e,t=!1){try{const t=Er();if(0===t.length)return{success:!1,petName:null,petSpecies:null,foodSpecies:null,error:"No active pets found"};const n=t[e];if(!n)return{success:!1,petName:null,petSpecies:null,foodSpecies:null,error:`Pet at index ${e} not found`};if(!n.petId)return{success:!1,petName:n.name,petSpecies:n.species,foodSpecies:null,error:"Pet has no petId (UUID)"};const o=await zs();if(!o||!o.items||0===o.items.length)return{success:!1,petName:n.name,petSpecies:n.species,foodSpecies:null,error:"Failed to read inventory"};const r={items:o.items.filter(e=>"Produce"===e.itemType||"Crop"===e.itemType).map(e=>({id:e.id,species:e.species??null,itemType:e.itemType??null,name:e.name??null})),favoritedIds:new Set(o.favoritedItemIds??[]),source:"myInventoryAtom"},i=Tf(n.species,r,{avoidFavorited:!0});if(!i)return{success:!1,petName:n.name,petSpecies:n.species,foodSpecies:null,error:"No suitable food found in inventory"};const a=i.item;if(!a.id)return{success:!1,petName:n.name,petSpecies:n.species,foodSpecies:a.species,error:"Crop has no ID"};const l=null!==n.hungerPct?`hunger: ${n.hungerPct}%`:"hunger: unknown";s(`üçñ Attempting to feed ${n.name||n.species||"pet"} (${l}) with ${a.species||"food"}`);return kf(n.petId,a.id)?(s(`‚úÖ Fed ${n.name||n.species||"pet"} with ${a.species||"food"}`),sf(1),{success:!0,petName:n.name,petSpecies:n.species,foodSpecies:a.species}):{success:!1,petName:n.name,petSpecies:n.species,foodSpecies:a.species,error:"Failed to send WebSocket message"}}catch(n){return s("‚ùå Instant feed error",n),{success:!1,petName:null,petSpecies:null,foodSpecies:null,error:n instanceof Error?n.message:"Unknown error"}}}const Ef={enabled:!0,autoRefresh:!0,refreshInterval:30,selectedSpecies:null};let $f={...Ef},Mf=null,If=null,Ff=null,zf=0;const Lf=new Map;function Rf(e){$f.selectedSpecies=e,g.set("cropBoostTracker:config",$f),Df()}function qf(e,t){if(e.currentScale>=e.maxScale)return 0;if(t<=0)return 1/0;const n=1+t/100,o=e.maxScale/e.currentScale,r=Math.log(o)/Math.log(n);return Math.ceil(r)}function Nf(e,t){if(0===t.length||e<=0)return{p10:0,p50:0,p90:0};const n=e*(1.5*t.reduce((e,t)=>t.effectiveBoostPercent<e.effectiveBoostPercent?t:e).expectedMinutesPerProc);return{p10:.8*n,p50:n,p90:1.5*n}}function Bf(){const e=function(){const e=Er(),t=[];for(const n of e){const e=[{id:"ProduceScaleBoost",name:"Crop Size Boost I",base:6,chance:.3},{id:"ProduceScaleBoostII",name:"Crop Size Boost II",base:10,chance:.4}];for(const o of e)if(n.abilities&&n.abilities.includes(o.id)){const e=n.strength??100,r=o.base*e/100,i=o.chance*e/100,a=100/i;t.push({slotIndex:n.slotIndex,displayName:n.name??n.species??"Unknown",species:n.species??"unknown",strength:e,abilityId:o.id,abilityName:o.name,baseBoostPercent:o.base,effectiveBoostPercent:r,baseProcChance:o.chance,effectiveProcChance:i,expectedMinutesPerProc:a})}}return t}(),t=function(){const e=ln();if(!e)return[];const t=[],n=(e,n)=>{if(e)for(const[o,r]of Object.entries(e))if("plant"===r.objectType&&r.slots&&Array.isArray(r.slots))for(let e=0;e<r.slots.length;e++){const i=r.slots[e];if(!i||!i.species)continue;const a=i.species,s=i.targetScale??i.scale??i.plantScale??1,l=a.toLowerCase(),c=i.maxScale??i.targetMaxScale??On(l)??2,d=i.mutations??[],p=i.fruitCount??i.remainingFruitCount??1,u=i.endTime??0,g=u>0&&Date.now()>=u,m=50+(s-1)/(c-1)*50,f=Math.max(0,100-m);t.push({species:a,currentScale:s,maxScale:c,currentSizePercent:Math.max(50,Math.min(100,m)),sizeRemaining:f,mutations:d,fruitCount:p,isMature:g,tileKey:`${n}${o}`,slotIndex:e})}};return n(e.tileObjects,""),n(e.boardwalkTileObjects,"bw-"),t}();if(0===e.length)return s("‚ÑπÔ∏è Crop Boost Tracker: No active boost pets"),null;!function(e){const t=Date.now();for(const o of e){const e=`${o.tileKey}-${o.slotIndex}`,n=Lf.get(e);n?o.currentSizePercent-n.lastSize>.5&&(n.boostTimestamps.push(t),n.lastSize=o.currentSizePercent):Lf.set(e,{initialSize:o.currentSizePercent,boostTimestamps:[],lastSize:o.currentSizePercent})}const n=new Set(e.map(e=>`${e.tileKey}-${e.slotIndex}`));for(const o of Lf.keys())n.has(o)||Lf.delete(o)}(t);const n=t.filter(e=>e.sizeRemaining<=0),o=t.filter(e=>e.sizeRemaining>0),r=e.map(e=>e.effectiveBoostPercent),i=r.reduce((e,t)=>e+t,0)/r.length,a=Math.min(...r),l=Math.max(...r),c=e.map(e=>e.expectedMinutesPerProc),d=c.reduce((e,t)=>e+t,0)/c.length,p=Math.max(...c),u=Math.min(...c),g=i,m=new Map;let f=0;const h=Date.now();for(const s of o){const t=`${s.tileKey}-${s.slotIndex}`,n=Lf.get(t),o=n?.boostTimestamps.length??0,r=n?.boostTimestamps[n.boostTimestamps.length-1]??null,i=qf(s,g),a=Nf(Math.max(0,i-o),e),l=h+60*Nf(1,e).p50*1e3,c={boostsNeeded:i,timeEstimateP10:a.p10,timeEstimateP50:a.p50,timeEstimateP90:a.p90,boostsReceived:o,lastBoostAt:r,expectedNextBoostAt:l};m.set(t,c),f=Math.max(f,i)}const b=Nf(f,e);return{boostPets:e,crops:t,totalBoostPets:e.length,totalMatureCrops:t.length,totalCropsAtMax:n.length,totalCropsNeedingBoost:o.length,averageBoostPercent:i,weakestBoostPercent:a,strongestBoostPercent:l,averageMinutesPerProc:d,slowestMinutesPerProc:p,fastestMinutesPerProc:u,overallEstimate:{boostsNeeded:f,timeEstimateP10:b.p10,timeEstimateP50:b.p50,timeEstimateP90:b.p90,boostsReceived:0,lastBoostAt:null,expectedNextBoostAt:0},cropEstimates:m,timestamp:Date.now()}}function Df(){const e=Date.now();e-zf<5e3||(zf=e,Mf=Bf(),Ff&&Ff(Mf))}function Hf(){return Mf}function jf(){!function(){const e=g.get("cropBoostTracker:config",Ef);$f={...Ef,...e}}(),$f.enabled&&(If||(s("üå± Crop Boost Tracker: Starting"),Df(),If=dn(()=>{Df()}))),s("üå± Crop Boost Tracker initialized")}function _f(e){if(!isFinite(e))return"N/A";if(e<1)return"< 1m";const t=Math.floor(e/60),n=Math.floor(e%60);if(t>24){return`${Math.floor(t/24)}d ${t%24}h`}return t>0?`${t}h ${n}m`:`${n}m`}function Of(e,t,n){const o=_f(e),r=_f(t),i=_f(n);return o===r&&r===i?r:`${o} - ${i} (median: ${r})`}function Gf(e,t){return new Promise(n=>{const o=function(e,t){const n=new URL(e,"https://ariesmod-api.ariedam.fr/");if(t)for(const[o,r]of Object.entries(t))void 0!==r&&n.searchParams.set(o,String(r));return n.toString()}(e,t),r=function(){if("function"==typeof GM_xmlhttpRequest)return GM_xmlhttpRequest;const e=globalThis.GM;return e?.xmlHttpRequest?e.xmlHttpRequest.bind(e):void 0}();r?r({method:"GET",url:o,headers:{},onload:e=>{let t,o=null;if(e.responseText)try{o=JSON.parse(e.responseText)}catch(i){t=`Failed to parse JSON: ${i.message}`}(e.status<200||e.status>=300)&&!t&&(t=`HTTP ${e.status}`);const r=t?{status:e.status,data:o,error:t}:{status:e.status,data:o};n(r)},onerror:e=>{n({status:0,data:null,error:String(e??"Network error")})}}):n({status:0,data:null,error:"GM_xmlhttpRequest unavailable"})})}const Vf=0;let Wf={connectionStatus:"connecting",allRooms:{},currentSearchTerm:"",currentPlayerFilter:"all",currentSortBy:"players-desc",lastUpdatedAt:null},Uf={},Xf=!1,Qf=null,Jf=null,Kf=null;function Yf(e){Wf.connectionStatus!==e&&(Wf.connectionStatus=e,Kf?.(e))}function Zf(e){const t=Object.entries(e||{});if(0===t.length)return{};const n=Wf.currentSearchTerm.trim().toLowerCase(),o=t.filter(([e,t])=>{const o=t.playersCount||0;if("all"!==Wf.currentPlayerFilter){if("empty"===Wf.currentPlayerFilter&&0!==o)return!1;if("low"===Wf.currentPlayerFilter&&(o<1||o>2))return!1;if("medium"===Wf.currentPlayerFilter&&(o<3||o>4))return!1;if("high"===Wf.currentPlayerFilter&&o<5)return!1}if(!n)return!0;const r=e.toLowerCase().includes(n),i=t.userSlots?.some(e=>e.name?.toLowerCase().includes(n));return r||Boolean(i)});return o.sort(([,e],[,t])=>{switch(Wf.currentSortBy){case"name":return e.id.localeCompare(t.id);case"players-asc":return(e.playersCount||0)-(t.playersCount||0);default:return(t.playersCount||0)-(e.playersCount||0)}}),o.reduce((e,[t,n])=>(e[t]=n,e),{})}async function eh(){Yf("connecting");const e=await async function(e=50){const t=await Gf("rooms",{limit:e});if(!t.data||!Array.isArray(t.data))return t.error?{status:t.status,data:null,error:t.error}:{status:t.status,data:null};const n=t.data.map(e=>{const t={id:e.id,isPrivate:e.is_private,playersCount:e.players_count??0,lastUpdatedAt:e.last_updated_at,lastUpdatedByPlayerId:e.last_updated_by_player_id};if(Array.isArray(e.user_slots)){const n=e.user_slots.map(e=>({name:e.name,avatarUrl:e.avatar_url??null,playerId:e.player_id??null}));return{...t,userSlots:n}}return t});return t.error?{status:t.status,data:n,error:t.error}:{status:t.status,data:n}}(200),t=e.data??[];t&&0!==t.length?(!function(e){const t={};for(const n of e)t[n.id]=n;Wf.allRooms=t,Wf.lastUpdatedAt=(new Date).toISOString(),Uf=Zf(Wf.allRooms),Qf?.({...Uf})}(t),Yf("connected")):Yf("retrying")}async function th(){Xf||(Xf=!0,g.get("publicRooms:refreshInterval",Vf),await eh())}async function nh(){try{await eh()}catch(t){s("‚ö†Ô∏è fetchRooms failed:",t),Yf("retrying"),e="Unable to refresh rooms",Jf?.(e)}var e}function oh(e){Wf.currentSearchTerm=e,Uf=Zf(Wf.allRooms),Qf?.({...Uf})}function rh(){return{...Wf}}const ih={origin:"https://magicgarden.gg",jobOn:!0,jobBudgetMs:30,jobBurstMs:80,jobBurstWindowMs:5e3,jobCapPerTick:2,cacheOn:!0,cacheMaxEntries:2e3,cacheMaxCost:8e3,keepCacheOnClose:!0,srcCanvasMax:450,debugLog:!1,debugLimitDefault:25},ah={Gold:{overlayTall:null,tallIconOverride:null},Rainbow:{overlayTall:null,tallIconOverride:null,angle:130,angleTall:0},Wet:{overlayTall:"sprite/mutation-overlay/WetTallPlant",tallIconOverride:"sprite/mutation/Puddle"},Chilled:{overlayTall:"sprite/mutation-overlay/ChilledTallPlant",tallIconOverride:null},Frozen:{overlayTall:"sprite/mutation-overlay/FrozenTallPlant",tallIconOverride:null},Dawnlit:{overlayTall:null,tallIconOverride:null},Ambershine:{overlayTall:null,tallIconOverride:"sprite/mutation/Amberlit"},Dawncharged:{overlayTall:null,tallIconOverride:null},Ambercharged:{overlayTall:null,tallIconOverride:null}},sh=new Set(["Dawnlit","Ambershine","Dawncharged","Ambercharged"]),lh={Banana:.6,Carrot:.6,Sunflower:.5,Starweaver:.5,FavaBean:.25,BurrosTail:.2},ch={Pepper:.5,Banana:.6},dh=new Map(["Gold","Rainbow","Wet","Chilled","Frozen","Ambershine","Dawnlit","Dawncharged","Ambercharged"].map((e,t)=>[e,t]));function ph(){const e="undefined"!=typeof unsafeWindow?unsafeWindow:window,t=e.gameVersion||e.MG_gameVersion||e.__MG_GAME_VERSION__;if(t){if("function"==typeof t.getVersion)return t.getVersion();if("function"==typeof t.get)return t.get();if("string"==typeof t)return t}const n=[...Array.from(document.scripts||[]).map(e=>e.src).filter(Boolean),...Array.from(document.querySelectorAll("link[href]")||[]).map(e=>e.href)];for(const o of n){const e=o.match(/\/version\/([^/]+)\//);if(e?.[1])return e[1]}throw new Error("Version not found. Could not detect game version from DOM or global variables.")}function uh(){return"undefined"!=typeof unsafeWindow&&unsafeWindow?unsafeWindow:globalThis}async function gh(e,t,n){const o=performance.now(),r=e=>new Promise(t=>setTimeout(()=>t(null),e));for(;performance.now()-o<t;){const t=await Promise.race([e,r(50)]);if(null!==t)return t}throw new Error(`${n} timeout`)}function mh(e,t){return"undefined"!=typeof GM_xmlhttpRequest?new Promise((n,o)=>{const r={method:"GET",url:e,onload:t=>t.status>=200&&t.status<300?n(t):o(new Error(`HTTP ${t.status} (${e})`)),onerror:()=>o(new Error(`Network error (${e})`)),ontimeout:()=>o(new Error(`Timeout (${e})`))};"blob"===t&&(r.responseType="blob"),GM_xmlhttpRequest(r)}):"blob"===t?fetch(e).then(t=>{if(!t.ok)throw new Error(`HTTP ${t.status} (${e})`);return t.blob()}):fetch(e).then(t=>{if(!t.ok)throw new Error(`HTTP ${t.status} (${e})`);return t.text().then(e=>({responseText:e}))})}async function fh(e){const t=await mh(e,"text"),n=t.responseText||t;return JSON.parse(n)}async function hh(e){const t=await mh(e,"blob");return t.response||t}function bh(e){return new Promise((t,n)=>{const o=URL.createObjectURL(e),r=new Image;r.decoding="async",r.crossOrigin="anonymous",r.onload=()=>{URL.revokeObjectURL(o),t(r)},r.onerror=()=>{URL.revokeObjectURL(o),n(new Error("Image decode failed"))},r.src=o})}function yh(e,t){return e.replace(/\/?$/,"/")+String(t||"").replace(/^\//,"")}function xh(e,t){return"string"!=typeof t?t:t.startsWith("/")?t.slice(1):function(e){return e.lastIndexOf("/")>=0?e.slice(0,e.lastIndexOf("/")+1):""}(e)+t}async function vh(e,t){const n=function(e){const t=new Set;for(const n of e.bundles||[])for(const e of n.assets||[])for(const n of e.src||[]){const e="string"==typeof n?n:n.src;"string"==typeof e&&e.endsWith(".json")&&"manifest.json"!==e&&(e.startsWith("audio/")||t.add(e))}return t}(t),o=new Set,r={},i=async t=>{if(o.has(t))return;o.add(t);const n=await fh(yh(e,t));if(r[t]=n,n?.meta?.related_multi_packs)for(const e of n.meta.related_multi_packs)await i(xh(t,e))};return await Promise.all(Array.from(n).map(e=>i(e))),r}function wh(e){return e&&"object"==typeof e&&e.frames&&e.meta&&"string"==typeof e.meta.image}function Ch(e){return String(e||"").split("/").filter(Boolean)}function Th(e){const t=Ch(e),n=t[t.length-1],o=n&&n.match(/^(.*?)(?:[_-])(\d{1,6})(\.[a-z0-9]+)?$/i);if(!o)return null;const r=(o[1]||"")+(o[3]||""),i=Number(o[2]);return r&&Number.isFinite(i)?{baseKey:t.slice(0,-1).concat(r).join("/"),idx:i,frameKey:e}:null}function Sh(e,t,n=25e3){const o=[e],r=new Set;let i=0;for(;o.length&&i++<n;){const e=o.pop();if(!e||r.has(e))continue;if(r.add(e),t(e))return e;const n=e.children;if(Array.isArray(n))for(let t=n.length-1;t>=0;t-=1)o.push(n[t])}return null}function Ph(e,t){const n="undefined"!=typeof unsafeWindow&&unsafeWindow?unsafeWindow:globalThis,o=n.PIXI||n.__PIXI__;if(o?.Texture&&o?.Sprite&&o?.Container&&o?.Rectangle)return{Container:o.Container,Sprite:o.Sprite,Texture:o.Texture,Rectangle:o.Rectangle,Text:o.Text||null};if(e?.stage){const t=e.stage,n=Sh(t,e=>e?.texture?.frame&&e?.constructor&&e?.texture?.constructor&&e?.texture?.frame?.constructor);if(n){const e=Sh(t,e=>("string"==typeof e?.text||"number"==typeof e?.text)&&e?.style);return{Container:t.constructor,Sprite:n.constructor,Texture:n.texture.constructor,Rectangle:n.texture.frame.constructor,Text:e?.constructor||null}}}throw new Error("No PIXI constructors found - cannot extract from app or globals")}function kh(e,t){const n=function(e){return e?.baseTexture??e?.source?.baseTexture??e?.source??e?._baseTexture??null}(e);n&&t.add(n)}function Ah(e){return String(e||"").toLowerCase().replace(/[^a-z0-9]/g,"")}function Eh(e){const t=String(e||"").split("/").filter(Boolean);return t[t.length-1]||""}function $h(e,t,n,o,r){return new e(t,n,o,r)}function Mh(e,t,n,o,r,i,a){let s;try{s=new e({source:t.source,frame:n,orig:o,trim:r||void 0,rotate:i||0})}catch(l){s=new e(t.baseTexture??t,n,o,r||void 0,i||0)}try{s&&!s.label&&(s.label=n?.width&&n?.height?`sub:${n.width}x${n.height}`:"subtex")}catch(l){}if(a){const e=s;if(e.defaultAnchor?.set)try{e.defaultAnchor.set(a.x,a.y)}catch(l){}e.defaultAnchor&&!e.defaultAnchor.set&&(e.defaultAnchor.x=a.x,e.defaultAnchor.y=a.y),e.defaultAnchor||(e.defaultAnchor={x:a.x,y:a.y})}try{s?.updateUvs?.()}catch(l){}return s}function Ih(e,t,n,o,r){const{Texture:i,Rectangle:a}=r;try{t&&!t.label&&(t.label=e?.meta?.image||"atlasBase")}catch(s){}kh(t,o);for(const[l,c]of Object.entries(e.frames)){const e=c.frame,r=c.rotated?2:0,d=c.rotated?e.h:e.w,p=c.rotated?e.w:e.h,u=$h(a,e.x,e.y,d,p),g=c.sourceSize||{w:e.w,h:e.h},m=$h(a,0,0,g.w,g.h);let f=null;if(c.trimmed&&c.spriteSourceSize){const e=c.spriteSourceSize;f=$h(a,e.x,e.y,e.w,e.h)}const h=Mh(i,t,u,m,f,r,c.anchor||null);try{h.label=l}catch(s){}kh(h,o),n.set(l,h)}}function Fh(e,t={}){const n=[...e.keys()].sort((e,t)=>e.localeCompare(t)),o=new Set,r=[],i=new Map,a=(e,n)=>{const o=function(e,t=1){const n=Ch(e),o="sprite"===n[0]||"sprites"===n[0]?1:0,r=Math.max(1,0|t);return n.slice(o,o+r).join("/")||"misc"}(e,t.catLevels||1);i.has(o)||i.set(o,[]),i.get(o).push(n)};for(const s of n){const t=e.get(s);if(!t||o.has(s))continue;const i=Th(s);if(!i){const e={key:s,isAnim:!1,first:t};r.push(e),a(s,e);continue}const l=[];for(const r of n){const t=Th(r);if(!t||t.baseKey!==i.baseKey)continue;const n=e.get(r);n&&(l.push({idx:t.idx,tex:n}),o.add(r))}l.sort((e,t)=>e.idx-t.idx);const c=l.map(e=>e.tex);if(1===c.length){const e={key:i.baseKey,isAnim:!1,first:c[0]};r.push(e),a(i.baseKey,e)}else if(c.length>1){const e={key:i.baseKey,isAnim:!0,frames:c,first:c[0],count:c.length};r.push(e),a(i.baseKey,e)}}return{items:r,cats:i}}function zh(e){return e?e.isAnim?e.frames?.length||0:e.tex?1:0:0}function Lh(e,t,n,o){t.cacheOn&&(e.lru.set(n,o),e.cost+=zh(o),function(e,t){if(t.cacheOn)for(;e.lru.size>t.cacheMaxEntries||e.cost>t.cacheMaxCost;){const t=e.lru.keys().next().value;if(void 0===t)break;const n=e.lru.get(t);e.lru.delete(t),e.cost=Math.max(0,e.cost-zh(n))}}(e,t))}const Rh={Gold:{op:"source-atop",colors:["rgb(235,200,0)"],a:.7},Rainbow:{op:"color",colors:["#FF1744","#FF9100","#FFEA00","#00E676","#2979FF","#D500F9"],ang:130,angTall:0,masked:!0},Wet:{op:"source-atop",colors:["rgb(50,180,200)"],a:.25},Chilled:{op:"source-atop",colors:["rgb(100,160,210)"],a:.45},Frozen:{op:"source-atop",colors:["rgb(100,130,220)"],a:.5},Dawnlit:{op:"source-atop",colors:["rgb(209,70,231)"],a:.5},Ambershine:{op:"source-atop",colors:["rgb(190,100,40)"],a:.5},Dawncharged:{op:"source-atop",colors:["rgb(140,80,200)"],a:.5},Ambercharged:{op:"source-atop",colors:["rgb(170,60,25)"],a:.5}},qh=(()=>{try{const e=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});if(!e)return new Set;const t=["color","hue","saturation","luminosity","overlay","screen","lighter","source-atop"],n=new Set;for(const o of t)e.globalCompositeOperation=o,e.globalCompositeOperation===o&&n.add(o);return n}catch(e){return new Set}})();function Nh(e){return Boolean(e&&Rh[e])}function Bh(e){return[...new Set(e.filter(Boolean))].sort((e,t)=>(dh.get(e)??1/0)-(dh.get(t)??1/0))}function Dh(e){switch(e){case"Ambershine":return["Ambershine","Amberlit"];case"Dawncharged":return["Dawncharged","Dawnbound"];case"Ambercharged":return["Ambercharged","Amberbound"];default:return[e]}}function Hh(e){const t=e.filter((e,t,n)=>Rh[e]&&n.indexOf(e)===t);if(!t.length)return[];if(t.includes("Gold"))return["Gold"];if(t.includes("Rainbow"))return["Rainbow"];const n=["Ambershine","Dawnlit","Dawncharged","Ambercharged"];return Bh(t.some(e=>n.includes(e))?t.filter(e=>!["Wet","Chilled","Frozen"].includes(e)):t)}function jh(e){return Bh(e.filter((e,t,n)=>ah[e]?.overlayTall&&n.indexOf(e)===t))}function _h(e,t){return e.map(e=>({name:e,meta:ah[e],overlayTall:ah[e]?.overlayTall??null,isTall:t}))}function Oh(e,t,n,o,r=!1){const i=o.colors?.length?o.colors:["#fff"],a=null!=o.ang?function(e,t,n,o,r=!1){const i=(o-90)*Math.PI/180,a=t/2,s=n/2;if(!r){const o=Math.min(t,n)/2;return e.createLinearGradient(a-Math.cos(i)*o,s-Math.sin(i)*o,a+Math.cos(i)*o,s+Math.sin(i)*o)}const l=Math.cos(i),c=Math.sin(i),d=Math.abs(l)*t/2+Math.abs(c)*n/2;return e.createLinearGradient(a-l*d,s-c*d,a+l*d,s+c*d)}(e,t,n,o.ang,r):e.createLinearGradient(0,0,0,n);if(1===i.length){const e=i[0]||"#fff";a.addColorStop(0,e),a.addColorStop(1,e)}else i.forEach((e,t)=>a.addColorStop(t/(i.length-1),e||"#fff"));e.fillStyle=a,e.fillRect(0,0,t,n)}function Gh(e,t,n,o){const r=Rh[n];if(!r)return;const i={...r};"Rainbow"===n&&o&&null!=i.angTall&&(i.ang=i.angTall);const a="Rainbow"===n&&o,s=t.width,l=t.height;e.save();const c=i.masked?(d=i.op,qh.has(d)?d:qh.has("overlay")?"overlay":qh.has("screen")?"screen":qh.has("lighter")?"lighter":"source-atop"):"source-in";var d;if(e.globalCompositeOperation=c,null!=i.a&&(e.globalAlpha=i.a),i.masked){const n=document.createElement("canvas");n.width=s,n.height=l;const o=n.getContext("2d",{willReadFrequently:!0});o.imageSmoothingEnabled=!1,Oh(o,s,l,i,a),o.globalCompositeOperation="destination-in",o.drawImage(t,0,0),e.drawImage(n,0,0)}else Oh(e,s,l,i,a);e.restore()}function Vh(e,t,n){const o=t.srcCan.get(e);if(o)return o;let r=null;const i=t.renderer;try{if(i?.extract?.canvas&&1===(i?.resolution??1)){const n=new t.ctors.Sprite(e);r=i.extract.canvas(n),n.destroy?.({children:!0,texture:!1,baseTexture:!1})}}catch(a){}if(!r){const t=e?.frame||e?._frame,n=e?.orig||e?._orig,o=e?.trim||e?._trim,i=e?.rotate||e?._rotate||0,a=e?.baseTexture?.resource?.source||e?.baseTexture?.resource||e?.source?.resource?.source||e?.source?.resource||e?._source?.resource?.source||null;if(!t||!a)throw new Error("textureToCanvas failed");r=document.createElement("canvas");const s=Math.max(1,0|(n?.width??t.width)),l=Math.max(1,0|(n?.height??t.height)),c=o?.x??0,d=o?.y??0;r.width=s,r.height=l;const p=r.getContext("2d",{willReadFrequently:!0});p.imageSmoothingEnabled=!1;!0===i||2===i||8===i?(p.save(),p.translate(c+t.height/2,d+t.width/2),p.rotate(-Math.PI/2),p.drawImage(a,t.x,t.y,t.width,t.height,-t.width/2,-t.height/2,t.width,t.height),p.restore()):p.drawImage(a,t.x,t.y,t.width,t.height,c,d,t.width,t.height)}if(t.srcCan.set(e,r),t.srcCan.size>n.srcCanvasMax){const e=t.srcCan.keys().next().value;void 0!==e&&t.srcCan.delete(e)}return r}function Wh(e,t,n,o){if(!t)return null;const r=Eh(e),i=Dh(t);for(const a of i){const e=[`sprite/mutation/${a}${r}`,`sprite/mutation/${a}-${r}`,`sprite/mutation/${a}_${r}`,`sprite/mutation/${a}/${r}`,`sprite/mutation/${a}`];for(const t of e){const e=n.tex.get(t);if(e)return{tex:e,key:t}}{const e=`sprite/mutation-overlay/${a}TallPlant`,t=n.tex.get(e);if(t)return{tex:t,key:e}}}return null}function Uh(e,t,n,o){if(!t)return null;const r=ah[t];if(n&&r?.tallIconOverride){const e=o.tex.get(r.tallIconOverride);if(e)return e}const i=Eh(e),a=Dh(t);for(const s of a){const e=[`sprite/mutation/${s}Icon`,`sprite/mutation/${s}`,`sprite/mutation/${s}${i}`,`sprite/mutation/${s}-${i}`,`sprite/mutation/${s}_${i}`,`sprite/mutation/${s}/${i}`];for(const t of e){const e=o.tex.get(t);if(e)return e}if(n){const e=o.tex.get(`sprite/mutation-overlay/${s}TallPlantIcon`)||o.tex.get(`sprite/mutation-overlay/${s}TallPlant`);if(e)return e}}return null}function Xh(e,t,n,o,r){try{if(!(e&&o.renderer&&o.ctors?.Container&&o.ctors?.Sprite&&o.ctors?.Texture))return null;const{Container:a,Sprite:s,Texture:l}=o.ctors,c=e?.orig?.width??e?.frame?.width??e?.width??1,d=e?.orig?.height??e?.frame?.height??e?.height??1,p=e?.defaultAnchor?.x??.5,u=e?.defaultAnchor?.y??.5,g={x:c*p,y:d*u},m=Vh(e,o,r),f=new a;f.sortableChildren=!0;try{const t=new s(e);t.anchor?.set?.(p,u),t.position.set(g.x,g.y),t.width=c,t.height=d,t.alpha=0,t.zIndex=-1e3,f.addChild(t)}catch(i){}const h=new s(e);h.anchor?.set?.(p,u),h.position.set(g.x,g.y),h.zIndex=0,f.addChild(h);const b=/tallplant/i.test(t),y=_h(n.muts,b),x=_h(n.overlayMuts,b),v=_h(n.selectedMuts,b),w=function(e,t,n){const o=e?.orig?.width??e?.frame?.width??e?.width??1,r=e?.orig?.height??e?.frame?.height??e?.height??1,i=e?.defaultAnchor?.x??0,a=e?.defaultAnchor?.y??0,s={x:((ch[t]??i)-i)*o,y:((lh[t]??(r>1.5*o?a:.4))-a)*r},l=Math.min(o,r);let c=.5*Math.min(1.5,l/256);return n&&(c*=2),{width:o,height:r,anchorX:i,anchorY:a,offset:s,iconScale:c}}(e,Eh(t),b);for(const t of y){const n=new s(e);n.anchor?.set?.(p,u),n.position.set(g.x,g.y),n.zIndex=1;const o=document.createElement("canvas");o.width=c,o.height=d;const r=o.getContext("2d",{willReadFrequently:!0});r.imageSmoothingEnabled=!1,r.save(),r.translate(c*p,d*u),r.drawImage(m,-c*p,-d*u),r.restore(),Gh(r,o,t.name,t.isTall);const i=l.from(o);n.texture=i,f.addChild(n)}if(b)for(const e of x){const n=e.overlayTall&&o.tex.get(e.overlayTall)&&{tex:o.tex.get(e.overlayTall),key:e.overlayTall}||Wh(t,e.name,o);if(!n?.tex)continue;const i=Vh(n.tex,o,r);if(!i)continue;const a=i.width,c={x:g.x-p*a,y:0},d=document.createElement("canvas");d.width=a,d.height=i.height;const u=d.getContext("2d",{willReadFrequently:!0});u.imageSmoothingEnabled=!1,u.drawImage(i,0,0),u.globalCompositeOperation="destination-in",u.drawImage(m,-c.x,-c.y);const h=new s(l.from(d));h.anchor?.set?.(0,0),h.position.set(c.x,c.y),h.scale.set(1),h.alpha=1,h.zIndex=3,f.addChild(h)}for(const e of v){if("Gold"===e.name||"Rainbow"===e.name)continue;const n=Uh(t,e.name,e.isTall,o);if(!n)continue;const r=new s(n),i=n?.defaultAnchor?.x??.5,a=n?.defaultAnchor?.y??.5;r.anchor?.set?.(i,a),r.position.set(g.x+w.offset.x,g.y+w.offset.y),r.scale.set(w.iconScale),e.isTall&&(r.zIndex=-1),sh.has(e.name)&&(r.zIndex=10),r.zIndex||(r.zIndex=2),f.addChild(r)}const C=o.renderer;let T=null;const S=o.ctors.Rectangle,P=S?new S(0,0,c,d):null;if("function"==typeof C?.generateTexture?T=C.generateTexture(f,{resolution:1,region:P??void 0}):C?.textureGenerator?.generateTexture&&(T=C.textureGenerator.generateTexture({target:f,resolution:1})),!T)throw new Error("No render texture");const k=T instanceof l?T:l.from(C.extract.canvas(T));T&&T!==k&&T.destroy?.(!0),f.destroy({children:!0,texture:!1,baseTexture:!1});try{k.__mg_gen=!0,k.label=`${t}|${n.sig}`}catch(i){}return k}catch(i){return null}}function Qh(e,t){if(!t.jobOn||!e.open||!e.jobs.length)return!1;const n=performance.now()-e.changedAt<=t.jobBurstWindowMs?t.jobBurstMs:t.jobBudgetMs,o=performance.now();let r=0,i=!1;for(;e.jobs.length&&!(performance.now()-o>=n)&&!(r>=t.jobCapPerTick);){const n=e.jobs[0];if(!n){e.jobs.shift();continue}if(n.sig!==e.sig){e.jobs.shift(),e.jobMap.delete(n.k);continue}const o=n.src[n.i];if(!o){e.jobs.shift(),e.jobMap.delete(n.k);continue}const a=Xh(o,n.itKey,n.V,e,t);if(a&&n.out.push(a),n.i++,r++,n.i>=n.src.length){e.jobs.shift(),e.jobMap.delete(n.k);let o=null;n.isAnim?n.out.length>=2&&(o={isAnim:!0,frames:n.out}):n.out[0]&&(o={isAnim:!1,tex:n.out[0]}),o&&(Lh(e,t,n.k,o),i=!0)}}return i}function Jh(e){const t=e.filter(e=>Nh(e)),n=Bh(t),o=Hh(t),r=jh(t);return{mode:"M",muts:o,overlayMuts:r,selectedMuts:n,sig:`M:${n.join(",")}|${o.join(",")}|${r.join(",")}`}}function Kh(e){if(!e.mutOn){const t=Nh(e.f)?e.f:null,n=t?[t]:[];return{mode:"F",muts:n,overlayMuts:n,selectedMuts:n,sig:`F:${t??""}`}}const t=e.mutations.filter(e=>Nh(e)),n=Bh(t),o=Hh(t),r=jh(t);return{mode:"M",muts:o,overlayMuts:r,selectedMuts:n,sig:`M:${n.join(",")}|${o.join(",")}|${r.join(",")}`}}const Yh={plant:["plant"],tallplant:["tallplant"],crop:["crop"],decor:["decor"],item:["item"],pet:["pet"],seed:["seed"],mutation:["mutation"],"mutation-overlay":["mutation-overlay"],any:[]};function Zh(e){const t=e.split("/").filter(Boolean);return"sprite"===t[0]||"sprites"===t[0]?t[1]??"":t[0]??""}function eb(e,t){if("any"===t)return!0;return(Yh[t]||[]).some(t=>Ah(e)===Ah(t))}function tb(e,t,n){const o=Ah(n);for(const r of e.items){if(!eb(Zh(r.key),t))continue;if(Ah(Eh(r.key))===o)return r}return null}let nb=null;const ob=function(){let e,t;const n=new Promise(t=>{e=t}),o=new Promise(e=>{t=e});let r=null,i=null,a=null;const s=uh();!function(){const e=uh();if(e.__QPM_HOOKS_INJECTED__)return;e.__QPM_HOOKS_INJECTED__=!0;try{const e=document.createElement("script");e.textContent="\n(function() {\n  if (window.__QPM_PIXI_HOOKS_ACTIVE__) return;\n  window.__QPM_PIXI_HOOKS_ACTIVE__ = true;\n  \n  // Storage for captured PIXI objects\n  window.__QPM_PIXI_CAPTURED__ = { app: null, renderer: null, version: null };\n  \n  // Hook into a global function, preserving any previous hook\n  function hook(name, cb) {\n    var prev = window[name];\n    window[name] = function() {\n      try { cb.apply(this, arguments); }\n      finally { if (typeof prev === 'function') try { prev.apply(this, arguments); } catch(e) {} }\n    };\n  }\n  \n  // Hook PIXI initialization\n  hook('__PIXI_APP_INIT__', function(app, version) {\n    if (app && !window.__QPM_PIXI_CAPTURED__.app) {\n      window.__QPM_PIXI_CAPTURED__.app = app;\n      window.__QPM_PIXI_CAPTURED__.version = version;\n      if (app.renderer) window.__QPM_PIXI_CAPTURED__.renderer = app.renderer;\n    }\n  });\n  \n  hook('__PIXI_RENDERER_INIT__', function(renderer, version) {\n    if (renderer && !window.__QPM_PIXI_CAPTURED__.renderer) {\n      window.__QPM_PIXI_CAPTURED__.renderer = renderer;\n      window.__QPM_PIXI_CAPTURED__.version = version;\n    }\n  });\n  \n  // Poll for already-existing PIXI globals\n  function checkExisting() {\n    if (window.__QPM_PIXI_CAPTURED__.app && window.__QPM_PIXI_CAPTURED__.renderer) return;\n    var maybeApp = window.__PIXI_APP__ || window.PIXI_APP || window.app;\n    if (maybeApp && maybeApp.renderer && !window.__QPM_PIXI_CAPTURED__.app) {\n      window.__QPM_PIXI_CAPTURED__.app = maybeApp;\n      window.__QPM_PIXI_CAPTURED__.renderer = maybeApp.renderer;\n    }\n    var maybeRdr = window.__PIXI_RENDERER__ || window.PIXI_RENDERER__;\n    if (maybeRdr && !window.__QPM_PIXI_CAPTURED__.renderer) {\n      window.__QPM_PIXI_CAPTURED__.renderer = maybeRdr;\n    }\n  }\n  \n  checkExisting();\n  var pollCount = 0;\n  var pollInterval = setInterval(function() {\n    checkExisting();\n    if (++pollCount >= 100 || (window.__QPM_PIXI_CAPTURED__.app && window.__QPM_PIXI_CAPTURED__.renderer)) {\n      clearInterval(pollInterval);\n    }\n  }, 100);\n})();\n",(document.head||document.documentElement).appendChild(e),e.remove()}catch{}}();const l=(e,t)=>{const n=s[e];s[e]=function(){try{t.apply(this,arguments)}finally{if("function"==typeof n)try{n.apply(this,arguments)}catch{}}}};l("__PIXI_APP_INIT__",(t,n)=>{r||(r=t,a=n,e?.(t))}),l("__PIXI_RENDERER_INIT__",(e,n)=>{i||(i=e,a=n,t?.(e))});const c=()=>{if(r&&i)return;const n=s.__QPM_PIXI_CAPTURED__;if(n&&(!r&&n.app&&(r=n.app,a=n.version,e?.(r)),!i&&n.renderer&&(i=n.renderer,a=n.version,t?.(i))),!r){const t=s.__PIXI_APP__||s.PIXI_APP||s.app;t?.renderer&&(r=t,e?.(r))}if(!i){const e=s.__PIXI_RENDERER__||s.PIXI_RENDERER__||s.renderer||r?.renderer;e&&(i=e,t?.(i))}r&&!a&&(a=s.__PIXI__?.VERSION||s.PIXI?.VERSION||"8.x")};c();let d=0;const p=setInterval(()=>{r&&i?clearInterval(p):(c(),d+=1,d>=100&&clearInterval(p))},100);return{get app(){return r},get renderer(){return i},get pixiVersion(){return a},appReady:n,rendererReady:o}}();let rb={total:0,done:0,completed:!1,phase:"idle"};const ib=new Set;function ab(e){Object.assign(rb,e);for(const t of ib)try{t(rb)}catch{}}let sb=null;async function lb(){const e="undefined"!=typeof unsafeWindow&&unsafeWindow?unsafeWindow:globalThis,t=()=>function(){try{const e=document.querySelector("canvas");if(!e)return null;let t=e,n=null;for(;t&&!n;){const e=Object.keys(t);for(const o of e)if(o.startsWith("__reactFiber$")||o.startsWith("__reactContainer$")){n=t[o];break}t=t.parentElement}if(!n)return null;const o=[n],r=new WeakSet;let i=0;const a=1e4;for(;o.length>0&&i++<a;){const e=o.shift();if(!e||r.has(e))continue;r.add(e);let t=e.memoizedState,n=0;for(;t&&n++<50;){const e=void 0!==t.memoizedState?t.memoizedState:t;if(e&&"object"==typeof e){if(e.canvasSpriteCache?.renderer)return{app:e.app||null,renderer:e.canvasSpriteCache.renderer,version:null};if(e.gameTextureCache?.renderer)return{app:e.app||null,renderer:e.gameTextureCache.renderer,version:null};if(e.stage&&e.renderer&&e.ticker)return{app:e,renderer:e.renderer,version:null};if(e.extract&&e.render&&(e.gl||e.context))return{app:null,renderer:e,version:null}}t=t.next}e.child&&o.push(e.child),e.sibling&&o.push(e.sibling),e.return&&!r.has(e.return)&&o.push(e.return)}}catch{}return null}(),n=()=>(()=>{const t=e.__QPM_PIXI_CAPTURED__;return t?.app&&t?.renderer?{app:t.app,renderer:t.renderer,version:t.version||null}:null})()||(()=>{const t=e.__PIXI_APP__||e.PIXI_APP||e.app||null,n=e.__PIXI_RENDERER__||e.PIXI_RENDERER__||e.renderer||t?.renderer||null;if(t&&n)return{app:t,renderer:n,version:e.__PIXI_VERSION__||e.__PIXI__?.VERSION||e.PIXI?.VERSION||null};return null})()||(()=>{const t=e.__MG_SPRITE_SERVICE__;return t?.state?.renderer?{app:t.state.app||null,renderer:t.state.renderer,version:t.state.version||null}:null})()||t(),o=n();if(o)return o;const r=performance.now();for(;performance.now()-r<15e3;){await new Promise(e=>setTimeout(e,100));const e=n();if(e)return e}const i=await async function(e,t=15e3){return{app:await gh(e.appReady,t,"PIXI app"),renderer:await gh(e.rendererReady,t,"PIXI renderer"),version:e.pixiVersion}}(ob,5e3).catch(()=>({app:null,renderer:null,version:null}));if(i.renderer||i.app?.renderer)return{app:i.app,renderer:i.renderer||i.app?.renderer,version:i.version};throw new Error("PIXI app timeout")}async function cb(){if(nb={cfg:{...ih},state:{started:!1,open:!1,loaded:!1,version:null,base:null,ctors:null,app:null,renderer:null,cat:"__all__",q:"",f:"",mutOn:!1,mutations:[],scroll:0,items:[],filtered:[],cats:new Map,tex:new Map,lru:new Map,cost:0,jobs:[],jobMap:new Set,srcCan:new Map,atlasBases:new Set,dbgCount:{},sig:"",changedAt:0,needsLayout:!1,overlay:null,bg:null,grid:null,dom:null,selCat:null,count:null,pool:[],active:new Map,anim:new Set}},nb.state.started)throw new Error("Sprite system already started");nb.state.started=!0,ab({phase:"init",total:0,done:0,completed:!1});const e=ph(),t=function(e="https://magicgarden.gg"){const t=ph();return`${e.replace(/\/$/,"")}/version/${t}/assets/`}(nb.cfg.origin);nb.state.version=e,nb.state.base=t,sb||(sb=async function(e){try{ab({phase:"prefetch-manifest"});const t=await fh(yh(e,"manifest.json"));ab({phase:"prefetch-atlas-json"});const n=await vh(e,t),o=new Map,r=Object.entries(n);ab({phase:"prefetch-images",total:r.filter(([,e])=>wh(e)).length,done:0});let i=0;const a=new d(3,16);for(const[s,l]of r){if(!wh(l))continue;const t=xh(s,l.meta.image);try{const n=await hh(yh(e,t));o.set(t,n),i++,ab({done:i})}catch{}await a.yieldIfNeeded()}return{base:e,atlasJsons:n,blobs:o}}catch(t){return console.warn("[QPM Sprite-v2] Prefetch failed, will load normally:",t),null}}(t)),ab({phase:"wait-pixi"});const{app:n,renderer:o,version:r}=await lb();await("loading"!==document.readyState?Promise.resolve():new Promise(e=>{const t=()=>{document.removeEventListener("DOMContentLoaded",t),e()};document.addEventListener("DOMContentLoaded",t)})),await l();const i=o||n?.renderer||n?.render||null;if(!i)throw new Error("No PIXI renderer found");nb.state.ctors=Ph(n),nb.state.app=n,nb.state.renderer=i,nb.state.sig=Kh(nb.state).sig;const a=await(sb??Promise.resolve(null));if(await async function(e,t,n,o){const r=t.ctors;if(!r?.Texture||!r?.Rectangle)throw new Error("PIXI constructors missing");const i=o&&o.base===e?o:null;ab({phase:"load-manifest"});const a=i?.atlasJsons?null:await fh(yh(e,"manifest.json")),s=i?.atlasJsons??await vh(e,a),p=Object.entries(s);ab({phase:"load-textures",total:p.filter(([,e])=>wh(e)).length,done:0});const u=new d(4,12);let g=0;for(let l=0;l<p.length;l++){const n=p[l];if(!n)continue;const[o,a]=n;if(!wh(a))continue;const s=xh(o,a.meta.image);let d=i?.blobs.get(s);d||(d=await hh(yh(e,s)));const m=await bh(d);Ih(a,r.Texture.from(m),t.tex,t.atlasBases,r),g++,ab({done:g}),await u.yieldIfNeeded(),l<p.length-1&&await c(16)}ab({phase:"build-catalog"}),await l();const{items:m,cats:f}=Fh(t.tex,{catLevels:1});await l(),t.items=m,t.filtered=m.slice(),t.cats=f,t.loaded=!0,ab({phase:"complete",completed:!0})}(nb.state.base,nb.state,nb.cfg,a),nb.state.open=!0,n?.ticker?.add)n.ticker.add(()=>{Qh(nb.state,nb.cfg)});else{const e=()=>{nb?.state?.open&&(Qh(nb.state,nb.cfg),requestAnimationFrame(e))};requestAnimationFrame(e)}const s=e=>{try{const t=new nb.state.ctors.Sprite(e),n=nb.state.renderer.extract.canvas(t,{resolution:1});return t.destroy?.({children:!0,texture:!1,baseTexture:!1}),n}catch(t){return null}},p={ready:Promise.resolve(),state:nb.state,cfg:nb.cfg,list:(e="any")=>function(e,t="any"){return e.items.filter(e=>eb(Zh(e.key),t))}(nb.state,e),getBaseSprite:e=>function(e,t){const n=tb(t,e.category,e.id);return n?n.isAnim?n.frames?.[0]??null:n.first:null}(e,nb.state),getSpriteWithMutations:e=>function(e,t,n){const o=tb(t,e.category,e.id);if(!o)return null;const r=o.isAnim?o.frames?.[0]:o.first;if(!r)return null;const i=Jh(e.mutations||[]),a=`${o.key}|${i.sig}`,s=function(e,t){return e.lru.get(t)}(t,a);if(s)return s.isAnim?s.frames?.[0]??null:s.tex??null;const l=Xh(r,o.key,i,t,n);return l&&Lh(t,n,a,{isAnim:!1,tex:l}),l}(e,nb.state,nb.cfg),buildVariant:e=>function(e){return Jh(e)}(e),renderToCanvas(e){const t=e?.isTexture||e?.frame?e:p.getSpriteWithMutations(e);return t?s(t):null},async renderToDataURL(e,t="image/png",n){const o=p.renderToCanvas(e);return o?o.toDataURL(t,n):null},renderOnCanvas(e,t={}){const n=p.renderToCanvas(e);if(!n)return null;n.style.background="transparent",n.style.display="block";let o=n.width||n.clientWidth,r=n.height||n.clientHeight,i=o,a=r;if(e&&!e.isTexture&&!e.frame){const t=p.getBaseSprite(e);t&&(i=t?.orig?.width??t?._orig?.width??t?.frame?.width??t?._frame?.width??t?.width??i,a=t?.orig?.height??t?._orig?.height??t?.frame?.height??t?._frame?.height??t?.height??a)}const s=Math.min(i/o,a/r,1);let l=o*s,c=r*s;const{maxWidth:d,maxHeight:u,allowScaleUp:g}=t;if(d||u){const e=d?d/l:1,t=u?u/c:1;let n=Math.min(e||1,t||1);g||(n=Math.min(n,1)),l=Math.floor(l*n),c=Math.floor(c*n)}l&&(n.style.width=`${l}px`),c&&(n.style.height=`${c}px`);const m=document.createElement("div");return m.style.cssText="display:inline-flex;align-items:flex-start;justify-content:flex-start;padding:0;margin:0;background:transparent;border:none;flex:0 0 auto;",m.appendChild(n),{wrap:m,canvas:n}},clearOverlay(){const e=document.getElementById("mg-sprite-overlay");e&&e.remove()},renderAnimToCanvases(e){const t=nb.state.items.find(t=>t.key===`sprite/${e.category}/${e.id}`||t.key===e.id);if(!t)return[];if(t.isAnim&&t.frames?.length){return(e?.mutations?.length?[p.getSpriteWithMutations(e)]:t.frames).map(e=>s(e)).filter(Boolean)}const n=p.getSpriteWithMutations(e);return n?[s(n)].filter(Boolean):[]}},u="undefined"!=typeof unsafeWindow&&unsafeWindow?unsafeWindow:window;return u.__MG_SPRITE_STATE__=nb.state,u.__MG_SPRITE_CFG__=nb.cfg,u.__MG_SPRITE_SERVICE__=p,u.MG_SPRITE_HELPERS=p,u.getSpriteWithMutations=p.getSpriteWithMutations,u.getBaseSprite=p.getBaseSprite,u.buildSpriteVariant=p.buildVariant,u.listSpritesByCategory=p.list,u.renderSpriteToCanvas=p.renderToCanvas,u.renderSpriteToDataURL=p.renderToDataURL,u.MGSpriteCatalog={open(){nb.state.open=!0},close(){nb.state.open=!1},toggle(){nb.state.open=!nb.state.open},setCategory(e){nb.state.cat=e||"__all__"},setFilterText(e){nb.state.q=String(e||"").trim()},setSpriteFilter(e){nb.state.f=e,nb.state.mutOn=!1},setMutation(e,...t){nb.state.mutOn=!!e,nb.state.f="",nb.state.mutations=nb.state.mutOn?t.filter(Boolean).map(e=>e):[]},filters:()=>[],categories:()=>[...nb.state.cats.keys()].sort((e,t)=>e.localeCompare(t)),cacheStats(){return{entries:(e=nb.state).lru.size,cost:e.cost};var e},clearCache(){var e;(e=nb.state).lru.clear(),e.cost=0,e.srcCan.clear()},curVariant:()=>Kh(nb.state)},console.log("[QPM Sprite-v2] Initialized",{version:nb.state.version,pixi:r,textures:nb.state.tex.size,items:nb.state.items.length,categories:nb.state.cats.size}),p}const db={enabled:!0};let pb={...db};const ub=.001,gb=.01;async function mb(){if(!Lo())return{rainbow:ub,gold:gb};const e=await async function(){try{const e=V("myPetInfosAtom");if(!e)return s("?? [Mutation] myPetInfosAtom not found"),0;const t=await W(e);if(s("?? [Mutation] Pet slots:",t),!t||0===t.length)return s("?? [Mutation] No pet slots found"),0;let n=0;for(let o=0;o<t.length;o++){const e=t[o],r=e?.slot??e;s(`[Mutation] Pet slot ${o}:`,{species:r?.petSpecies,hunger:r?.hunger,abilities:r?.abilities,raw:e});const i=r?.hunger??0;if(i<=0)s(`[Mutation] Pet ${o} has no hunger (${i}), skipping`);else if(r.abilities&&Array.isArray(r.abilities))for(const t of r.abilities){if("PetMutationBoost"!==t&&"PetMutationBoostII"!==t)continue;s(`[Mutation] Found ${t} on pet ${o}`);const e=Qo(t);if(s(`[Mutation] Ability def for ${t}:`,e),!e?.baseParameters?.mutationChanceIncreasePercentage){s("[Mutation] No mutationChanceIncreasePercentage in ability def");continue}const i=Number(e.baseParameters.mutationChanceIncreasePercentage);if(isNaN(i)||i<=0){s(`[Mutation] Invalid boost percentage: ${i}`);continue}const a=r?.targetScale??1;let l;l=a>=1.9?.9:a>=1.5?.75:.5,s(`[Mutation] Using estimated strength based on targetScale ${a}: ${l}`);const c=i*l/100;s(`[Mutation] Adding ${c} boost (${i}% x ${l})`),n+=c}else s(`[Mutation] Pet ${o} has no abilities array, skipping`)}return s(`?? [Mutation] Total boost: ${n}`),n}catch(e){return s("?ÔøΩÔøΩ? Error getting pet mutation boost:",e),0}}();return{rainbow:ub*(1+e),gold:gb*(1+e)}}function fb(e){if(!Lo())return null;const t=function(e){const t=Go(e);if(!t?.faunaSpawnWeights)return{};if(Array.isArray(t.faunaSpawnWeights)){const e={};for(const n of t.faunaSpawnWeights)n.species&&"number"==typeof n.weight&&(e[n.species]=n.weight);return e}return{...t.faunaSpawnWeights}}(e);if(!t||0===Object.keys(t).length)return null;const n=Object.values(t).reduce((e,t)=>e+t,0);if(0===n)return null;return Object.entries(t).map(([e,t])=>{let o=null;try{const t=Yi(e);t&&(o=Fi(t))}catch(r){s(`?ÔøΩÔøΩ? Failed to load sprite for ${e}:`,r)}return{species:e,weight:t,percentage:t/n*100,sprite:o}}).sort((e,t)=>t.percentage-e.percentage)}const hb="qpm-egg-probability-style",bb="data-qpm-egg-probability",yb="data-qpm-egg-mutation";function xb(e){const t=100*e;return t<1?t.toFixed(4).replace(/\.?0+$/,"")+"%":t.toFixed(2).replace(/\.?0+$/,"")+"%"}async function vb(e,t){!function(){if(document.getElementById(hb))return;const e=document.createElement("style");e.id=hb,e.textContent=`\n    [${bb}] {\n      display: block;\n      width: 100%;\n      margin-top: 8px;\n      pointer-events: none;\n    }\n\n    .qpm-egg-probability-container {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      gap: 10px;\n    }\n\n    .qpm-egg-probability-item {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      gap: 3px;\n    }\n\n    .qpm-egg-probability-sprite {\n      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.5));\n      transition: transform 0.15s ease;\n      object-fit: contain;\n    }\n\n    .qpm-egg-probability-sprite:hover {\n      transform: scale(1.1);\n    }\n\n    .qpm-egg-probability-percentage {\n      font-size: 12px;\n      font-weight: 700;\n      color: #B5BCAF;\n      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.9);\n      letter-spacing: 0.03em;\n    }\n\n    .qpm-egg-probability-fallback {\n      font-size: 20px;\n      opacity: 0.5;\n    }\n\n    [${yb}] {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      gap: 16px;\n      margin-top: 6px;\n      pointer-events: none;\n    }\n\n    .qpm-egg-mutation-item {\n      display: flex;\n      align-items: center;\n      gap: 5px;\n      font-size: 13px;\n      font-weight: 700;\n      color: #B5BCAF;\n      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.9);\n      letter-spacing: 0.03em;\n    }\n\n    .qpm-egg-mutation-square {\n      width: 12px;\n      height: 12px;\n      border-radius: 2px;\n      flex-shrink: 0;\n    }\n\n    .qpm-egg-mutation-rainbow {\n      background: linear-gradient(120deg, #ff8a80, #ffd180, #80d8ff, #b388ff);\n    }\n\n    .qpm-egg-mutation-gold {\n      background: #FFB300;\n    }\n  `.trim(),document.head.appendChild(e)}();let n=e.querySelector(`[${bb}]`);n||(n=document.createElement("div"),n.setAttribute(bb,"true"),n.setAttribute("data-qpm-injected","true"),e.appendChild(n));const o=t.map(({species:e,percentage:t,sprite:n})=>`\n      <div class="qpm-egg-probability-item">\n        ${n?`<img src="${n}"\n             alt="${e}"\n             class="qpm-egg-probability-sprite"\n             style="width: 26px; height: 26px; image-rendering: pixelated; object-fit: contain;"\n             title="${e}" />`:`<div class="qpm-egg-probability-fallback" title="${e}">?ÔøΩÔøΩ</div>`}\n        <div class="qpm-egg-probability-percentage">${Math.round(t)}%</div>\n      </div>\n    `).join("");n.innerHTML=`\n    <div class="qpm-egg-probability-container">\n      ${o}\n    </div>\n  `;const r=await mb(),i=e.querySelector(`[${yb}]`);i&&i.remove();const a=function(e){const t=document.createElement("div");t.setAttribute(yb,"true"),t.setAttribute("data-qpm-injected","true");const n=`\n    <div class="qpm-egg-mutation-item">\n      <div class="qpm-egg-mutation-square qpm-egg-mutation-rainbow"></div>\n      <span>${xb(e.rainbow)}</span>\n    </div>\n  `,o=`\n    <div class="qpm-egg-mutation-item">\n      <div class="qpm-egg-mutation-square qpm-egg-mutation-gold"></div>\n      <span>${xb(e.gold)}</span>\n    </div>\n  `;return t.innerHTML=n+o,t}(r);e.appendChild(a)}function wb(e){if(!e)return;const t=e.querySelector(`[${bb}]`),n=e.querySelector(`[${yb}]`);t?.remove(),n?.remove()}const Cb="data-qpm-egg-probability-injected";const Tb=".McFlex.css-fsggty",Sb=new Map;let Pb=null;function kb(e){if(Sb.has(e))return;let t=null;const n=()=>{t=null,async function(e){if(!pb.enabled||e.classList.contains("qpm-window")||e.closest(".qpm-window"))return;let t=e.querySelector("p.chakra-text.css-1jc0opy")||e.querySelector("p.chakra-text")||Array.from(e.querySelectorAll("p")).find(e=>{const t=e.textContent?.trim()||"";return t.includes("Egg")&&t.length>0&&t.length<50})||null;if(!t)return void wb(e);const n=t.closest(".chakra-stack")??t.parentElement??e,o=t.textContent?.trim();if(!o)return void wb(n);const r=o.replace(/\s+/g,"");if(!Lo())return;if(!Go(r))return void wb(n);const i=fb(r);if(!i||0===i.length)return void wb(n);const a=`egg-probability-${r}`,l=e.getAttribute(Cb),c=null!==n.querySelector(`[${bb}]`);l===a&&c||(l&&l!==a&&wb(n),e.setAttribute(Cb,a),vb(n,i).catch(e=>{s("?ÔøΩÔøΩ? Error ensuring egg probability indicator:",e)}))}(e).catch(e=>{s("?ÔøΩÔøΩ? Error injecting egg probability info:",e)})};n();const o=r(e,()=>{null===t&&(t=window.requestAnimationFrame(n))});Sb.set(e,{disconnect:()=>{o.disconnect(),null!==t&&(window.cancelAnimationFrame(t),t=null)}})}function Ab(e){const t=Sb.get(e);t&&(t.disconnect(),Sb.delete(e))}function Eb(){Pb||(s("?? Egg Probability Indicator: Starting"),function(){if(Pb)return;s("?? Egg Probability Indicator: Watching for egg tooltips");const e=n(Tb,kb),t=o(Tb,Ab);Pb={disconnect:()=>{e.disconnect(),t.disconnect(),Sb.forEach(e=>e.disconnect()),Sb.clear()}}}())}function $b(){Pb&&(Pb.disconnect(),Pb=null),s("?? Egg Probability Indicator: Stopped")}function Mb(){!function(){const e=g.get("eggProbabilityIndicator:config",db);pb={...db,...e}}(),pb.enabled&&Eb()}const Ib=Object.freeze(Object.defineProperty({__proto__:null,getEggProbabilityConfig:function(){return{...pb}},initEggProbabilityIndicator:Mb,setEggProbabilityConfig:function(e){pb={...pb,...e},g.set("eggProbabilityIndicator:config",pb),pb.enabled?Eb():$b()},startEggProbabilityIndicator:Eb,stopEggProbabilityIndicator:$b},Symbol.toStringTag,{value:"Module"})),Fb={worm:30,snail:60,bee:15,chicken:60,bunny:45,dragonfly:15,pig:60,cow:75,turkey:60,squirrel:30,turtle:90,goat:60,butterfly:30,peacock:60,capybara:60};function zb(e){if(!e)return null;const t=e.replace(/[^a-z0-9]/gi,"").toLowerCase();return Fb[t]??null}function Lb(e,t){const n=zb(e);return n?t/n:null}function Rb(e,t,n,o,r){const i=Lb(e,t);if(!i||o<=0)return null;const a=i*(60*(n*r/o));return Math.ceil(a/t)+1}const qb=new Set(["ProduceScaleBoost","ProduceScaleBoostII","GoldGranter","RainbowGranter","ProduceMutationBoost","ProduceMutationBoostII"]);let Nb=null,Bb=0;function Db(e,t){if(!qb.has(e))return null;const n=function(){const e=Date.now();if(Nb&&e-Bb<5e3)return Nb;try{Nb=Ql(),Bb=e}catch(t){Nb=null,Bb=0,s("Failed to build ability valuation context:",t)}return Nb}();if(!n)return null;try{return Yl(e,n,t)}catch(o){return s("Failed to resolve dynamic ability effect:",o),null}}function Hb(e){const t=e.species??"",n=e.targetScale??null,o=t?Ic(t):null,r=Zo(t),i=null!=r?Lb(t,r):null,a=nr(t);let s=Fc(n,t);if(null==s&&null!=n){const e=o?Math.max(.01,o-1):1,t=Math.max(0,Math.min(1,(n-1)/e));s=Math.round(80+20*t)}let l=e.strength??null;null!=l&&null!=s&&l>s&&(l=s);const c=null!=l&&null!=s?Math.round(l/s*100):null,d=e.hungerValue??null,p=e.hungerPct??null;let u=null,g=null;if(null!=i&&null!=r){u=i/r,null!=p&&i>0&&(g=p/100*(r/i))}const m=e.xp??null,f=e.level??null,h=(e.abilities??[]).map(e=>function(e,t){const n=Ll(e),o=t??100;let r=null,i=n?.name??e;const a=e.match(/I{1,3}V?$/);a&&(r={I:1,II:2,III:3,IV:4}[a[0]]??null,i=i.replace(/\s+(I{1,3}V?|[1-4])$/,""));const s=n?.baseProbability??null,l=null!=s?s*o/100:null,c=n?.rollPeriodMinutes??null;let d=null,p=null,u=null;null!=l&&null!=c&&c>0&&(d=l/100*(60/c),p=24*d,u=d>0?60/d:null);const g=n?.effectBaseValue??null,m=null!=g?g*o/100:null,f=n?.effectValuePerProc??null;let h=null,b=null;null!=f&&null!=d&&(h=f*d,b=24*h);let y=null,x=null;const v=Db(e,o);return v?(y=v.effectPerProc,x=v.detail,null!=y&&y>0&&null!=d&&null==h&&(h=y*d,b=24*h)):qb.has(e)&&null==x&&(x="Garden context not available"),{id:e,name:n?.name??e,tier:r,baseName:i,category:n?.category??"misc",trigger:n?.trigger??"unknown",baseProbability:s,effectiveProbability:l,rollPeriodMinutes:c,procsPerHour:d,procsPerDay:p,timeBetweenProcs:u,effectLabel:n?.effectLabel??null,effectBaseValue:g,effectSuffix:n?.effectSuffix??null,effectiveValue:m,effectUnit:n?.effectUnit??null,valuePerHour:h,valuePerDay:b,gardenValuePerProc:y,gardenValueDetail:x,notes:n?.notes??null}}(e,l)),b=e.mutations??[],y=b.some(e=>e.toLowerCase().includes("gold")),x=b.some(e=>e.toLowerCase().includes("rainbow"));return{petId:e.petId,name:e.name,species:e.species,location:"active",slotIndex:e.slotIndex,currentStrength:l,maxStrength:s,targetScale:n,maxScale:o,strengthProgress:c,maturityTime:a,xp:m,level:f,xpToNextLevel:null,hungerPct:p,hungerValue:d,hungerMax:r,hungerDepletionRate:i,feedsPerHour:u,timeUntilStarving:g,mutations:b,mutationCount:b.length,hasGold:y,hasRainbow:x,abilities:h,abilityCount:h.length,position:e.position,updatedAt:e.updatedAt,raw:e.raw}}function jb(e){return e>=1e9?`${(e/1e9).toFixed(2)}B coins`:e>=1e6?`${(e/1e6).toFixed(2)}M coins`:e>=1e3?`${(e/1e3).toFixed(2)}K coins`:`${e.toFixed(0)} coins`}function _b(){s("üß™ Testing Pet Data Access...\n");const e=Er();if(0!==e.length){s(`‚úÖ Found ${e.length} active pet(s)\n`),s("=".repeat(80)+"\n");for(const t of e){const e=Hb(t);if(s(`\nüêæ PET: ${e.name??"Unnamed"} (${e.species??"Unknown Species"})`),s(`   ID: ${e.petId??"N/A"}`),s(`   Slot: ${e.slotIndex}`),s(""),s("üìä STRENGTH & GROWTH:"),s(`   Current Strength: ${e.currentStrength??"N/A"}`),s(`   Max Strength: ${e.maxStrength??"N/A"}`),s("   Strength Progress: "+(null!=e.strengthProgress?`${e.strengthProgress}%`:"N/A")),s(`   Target Scale: ${e.targetScale??"N/A"}`),s(`   Max Scale: ${e.maxScale??"N/A"}`),s("   Time to Mature: "+(null!=e.maturityTime?`${e.maturityTime}h`:"N/A")),s(""),s("üéì XP & LEVELING:"),s(`   XP: ${e.xp??"N/A"}`),s(`   Level: ${e.level??"N/A"}`),s(`   XP to Next Level: ${e.xpToNextLevel??"N/A"}`),s(""),s("üçñ HUNGER SYSTEM:"),s("   Hunger: "+(null!=e.hungerPct?`${e.hungerPct.toFixed(1)}%`:"N/A")),s(`   Hunger Value: ${e.hungerValue??"N/A"} / ${e.hungerMax??"N/A"}`),s("   Depletion Rate: "+(null!=e.hungerDepletionRate?`${e.hungerDepletionRate}/h`:"N/A")),s(`   Feeds Per Hour: ${null!=e.feedsPerHour?e.feedsPerHour.toFixed(2):"N/A"}`),s("   Time Until Starving: "+(null!=e.timeUntilStarving?`${e.timeUntilStarving.toFixed(1)}h`:"N/A")),s(""),s(`‚ú® MUTATIONS (${e.mutationCount}):`),e.mutations.length>0?(e.mutations.forEach(e=>s(`   ‚Ä¢ ${e}`)),s("   Gold: "+(e.hasGold?"‚úÖ":"‚ùå")),s("   Rainbow: "+(e.hasRainbow?"‚úÖ":"‚ùå"))):s("   (none)"),s(""),s(`‚ö° ABILITIES (${e.abilityCount}):`),e.abilities.length>0)for(const t of e.abilities)s(`\n   üìå ${t.name} (${t.id})`),s(`      Category: ${t.category} | Trigger: ${t.trigger}`),s(`      Tier: ${t.tier??"N/A"} | Base Name: ${t.baseName}`),s(""),s("      PROBABILITY & PROC RATES:"),s("      ‚Ä¢ Base Probability: "+(null!=t.baseProbability?`${t.baseProbability}%`:"N/A")),s("      ‚Ä¢ Effective Probability: "+(null!=t.effectiveProbability?`${t.effectiveProbability.toFixed(2)}%`:"N/A")),s("      ‚Ä¢ Roll Period: "+(null!=t.rollPeriodMinutes?`${t.rollPeriodMinutes}m`:"N/A")),s(`      ‚Ä¢ Procs Per Hour: ${null!=t.procsPerHour?t.procsPerHour.toFixed(2):"N/A"}`),s(`      ‚Ä¢ Procs Per Day: ${null!=t.procsPerDay?t.procsPerDay.toFixed(2):"N/A"}`),s("      ‚Ä¢ Avg Time Between Procs: "+(null!=t.timeBetweenProcs?`${t.timeBetweenProcs.toFixed(1)}m`:"N/A")),s(""),s("      EFFECT VALUES:"),s(`      ‚Ä¢ Label: ${t.effectLabel??"N/A"}`),s("      ‚Ä¢ Base Value: "+(null!=t.effectBaseValue?`${t.effectBaseValue}${t.effectSuffix??""}`:"N/A")),s("      ‚Ä¢ Effective Value: "+(null!=t.effectiveValue?`${t.effectiveValue.toFixed(2)}${t.effectSuffix??""}`:"N/A")),s(`      ‚Ä¢ Unit: ${t.effectUnit??"N/A"}`),s(""),null!=t.gardenValuePerProc&&(s("      üåø GARDEN VALUE:"),s(`      ‚Ä¢ Value Per Proc: ${jb(t.gardenValuePerProc)}`),t.gardenValueDetail&&s(`      ‚Ä¢ Detail: ${t.gardenValueDetail}`),s("")),s("      VALUE PER TIME:"),s(`      ‚Ä¢ Value Per Hour: ${null!=t.valuePerHour?jb(t.valuePerHour):"N/A"}`),s(`      ‚Ä¢ Value Per Day: ${null!=t.valuePerDay?jb(t.valuePerDay):"N/A"}`),t.notes&&(s(""),s(`      üìù Notes: ${t.notes}`));else s("   (none)");s("\n"+"=".repeat(80))}s("\n‚úÖ Test complete! All pet data accessed successfully.\n"),s("üí° Available data includes:"),s("   ‚Ä¢ Basic info (name, species, ID, slot)"),s("   ‚Ä¢ Strength metrics (current, max, progress, scale)"),s("   ‚Ä¢ XP & leveling data"),s("   ‚Ä¢ Hunger system (%, value, depletion rate, feeds/hour, time until starving)"),s("   ‚Ä¢ Mutations (list, count, gold/rainbow flags)"),s("   ‚Ä¢ Detailed ability stats:"),s("     - Probability & proc rates (base, effective, per hour, per day, time between)"),s("     - Effect values (base, effective, unit, label)"),s("     - Value per time period (hour, day)"),s("     - Category, trigger, tier, notes"),s("\nüìä This data is ready for the comparison hub!")}else s("‚ùå No active pets found. Make sure pets are placed in your garden.")}function Ob(e,t){s(`üîç Comparing Pet Slot ${e} vs Slot ${t}...\n`);const n=Er(),o=n.find(t=>t.slotIndex===e),r=n.find(e=>e.slotIndex===t);if(!o)return void s(`‚ùå No pet found in slot ${e}`);if(!r)return void s(`‚ùå No pet found in slot ${t}`);const i=Hb(o),a=Hb(r),l=(e,t,n,o=!0,r="")=>{const i=null!=t?`${t}${r}`:"N/A",a=null!=n?`${n}${r}`:"N/A";let l="";"number"==typeof t&&"number"==typeof n&&(l=t>n?o?" üèÜ A":" üèÜ B":n>t?o?" üèÜ B":" üèÜ A":" ‚öñÔ∏è TIE"),s(`   ${e.padEnd(25)} | ${i.padEnd(15)} | ${a.padEnd(15)} ${l}`)};s(`${"Attribute".padEnd(25)} | ${"Pet A".padEnd(15)} | ${"Pet B".padEnd(15)}`),s("=".repeat(80)),s("\nüêæ BASIC INFO:"),l("Name",i.name,a.name,!1),l("Species",i.species,a.species,!1),l("Pet ID",i.petId,a.petId,!1),s("\nüìä STRENGTH:"),l("Current Strength",i.currentStrength,a.currentStrength,!0),l("Max Strength",i.maxStrength,a.maxStrength,!0),l("Strength Progress",i.strengthProgress,a.strengthProgress,!0,"%"),l("Target Scale",i.targetScale,a.targetScale,!0),s("\nüéì XP & LEVEL:"),l("XP",i.xp,a.xp,!0),l("Level",i.level,a.level,!0),s("\nüçñ HUNGER:"),l("Hunger %",i.hungerPct,a.hungerPct,!0,"%"),l("Depletion Rate",i.hungerDepletionRate,a.hungerDepletionRate,!1,"/h"),l("Feeds Per Hour",i.feedsPerHour,a.feedsPerHour,!1),l("Time Until Starving",i.timeUntilStarving,a.timeUntilStarving,!0,"h"),s("\n‚ú® MUTATIONS:"),l("Mutation Count",i.mutationCount,a.mutationCount,!0),l("Has Gold",i.hasGold?"Yes":"No",a.hasGold?"Yes":"No",!1),l("Has Rainbow",i.hasRainbow?"Yes":"No",a.hasRainbow?"Yes":"No",!1),s("\n‚ö° ABILITIES:"),l("Ability Count",i.abilityCount,a.abilityCount,!0);const c=new Set(i.abilities.map(e=>e.baseName)),d=new Set(a.abilities.map(e=>e.baseName)),p=[...c].filter(e=>d.has(e));if(p.length>0){s(`\nüìä SHARED ABILITIES (${p.length}):`);for(const e of p){const t=i.abilities.find(t=>t.baseName===e),n=a.abilities.find(t=>t.baseName===e);if(t&&n&&(s(`\n   ${e}:`),l("     Tier",t.tier,n.tier,!0),l("     Eff. Probability",t.effectiveProbability,n.effectiveProbability,!0,"%"),l("     Procs Per Hour",t.procsPerHour,n.procsPerHour,!0),l("     Effective Value",t.effectiveValue,n.effectiveValue,!0,t.effectSuffix??""),null!=t.gardenValuePerProc&&null!=n.gardenValuePerProc)){const e=jb(t.gardenValuePerProc),o=jb(n.gardenValuePerProc);let r="";r=t.gardenValuePerProc>n.gardenValuePerProc?" üèÜ A":n.gardenValuePerProc>t.gardenValuePerProc?" üèÜ B":" ‚öñÔ∏è TIE",s(`        ${"Garden Value/Proc".padEnd(25)} | ${e.padEnd(15)} | ${o.padEnd(15)} ${r}`),t.gardenValueDetail&&s(`        üí° ${t.gardenValueDetail}`)}}}s("\n"+"=".repeat(80)),s("\n‚úÖ Comparison complete!")}function Gb(){s("üìö Testing Ability Definitions...\n");const e=Rl();s(`‚úÖ Found ${e.length} ability definition(s)\n`),s("=".repeat(80));for(const t of e)s(`\n‚ö° ${t.name} (${t.id})`),s(`   Category: ${t.category}`),s(`   Trigger: ${t.trigger}`),null!=t.baseProbability&&s(`   Base Probability: ${t.baseProbability}%`),null!=t.rollPeriodMinutes&&s(`   Roll Period: ${t.rollPeriodMinutes} minutes`),null!=t.effectBaseValue&&s(`   Effect: ${t.effectBaseValue}${t.effectSuffix??""} ${t.effectLabel??""}`),t.notes&&s(`   Notes: ${t.notes}`);s("\n"+"=".repeat(80)),s("\n‚úÖ All ability definitions retrieved successfully!")}"undefined"!=typeof window&&(window.testPetData=_b,window.testComparePets=Ob,window.testAbilityDefinitions=Gb,s("üß™ Pet Data Tester loaded! Available console commands:"),s("   ‚Ä¢ window.testPetData() - Get detailed stats for all active pets"),s("   ‚Ä¢ window.testComparePets(0, 1) - Compare two pets side-by-side"),s("   ‚Ä¢ window.testAbilityDefinitions() - List all ability definitions"));const Vb=["qws:pets:teams:v1","MGA_petPresets","aries:teams","aries:petTeams","qws:teams","qws:petTeams","petTeams","teams"];function Wb(){const e=[];return Vb.forEach(t=>{try{const n=localStorage.getItem(t);if(!n)return;const o=JSON.parse(n),r=[];Array.isArray(o)?r.push(o):o&&"object"==typeof o&&Object.values(o).forEach(e=>{Array.isArray(e)&&r.push(e)}),r.forEach(t=>{t.forEach(t=>{const n=function(e){if(!e||"object"!=typeof e)return null;const t=e,n=Array.isArray(t.slots)?t.slots:Array.isArray(t.team)?t.team:[],o=[];for(let a=0;a<3;a+=1){const e=n[a];if("string"==typeof e&&e.trim())o.push(e.trim());else if("number"==typeof e&&Number.isFinite(e))o.push(String(e));else if(e&&"object"==typeof e){const t=e,n=t.id??t.petId??t.slotId;o.push("string"==typeof n&&n.trim()?n.trim():null)}else o.push(null)}const r="string"==typeof t.id&&t.id.trim()?t.id.trim():"string"==typeof t.teamId&&t.teamId.trim()?t.teamId.trim():`team-${Math.random().toString(36).slice(2,8)}`,i=t.name??t.label??t.title??r;return{id:r,name:"string"==typeof i&&i.trim()?i.trim():r,slotIds:o,source:"unknown"}}(t);n&&(n.source="localStorage",e.push(n))})})}catch(n){s("‚ö†Ô∏è AriesBridge: failed parsing team storage",n)}}),e}function Ub(){const e=[];e.push(...Wb());const t=function(){const e=Er();return e.length?{id:"active-pets",name:"Active Pets",slotIds:e.slice(0,3).map(e=>String(e.petId??e.slotIndex??"").trim()||null),source:"activePets"}:null}();return t&&e.push(t),e}function Xb(){const e={getAchievements:()=>function(){const e=cf(),t=df();return e.map(e=>{const n=t.get(e.id);return{id:e.id,title:e.title,description:e.description,category:e.category,rarity:e.rarity,target:"number"==typeof e.target?e.target:null,current:n?.current??0,completedAt:n?.completedAt??null,ineligible:!!n?.ineligible}})}(),getTeams:()=>Ub()};try{P("QPM_ARIES_BRIDGE",e),s("‚úÖ AriesBridge: exposed QPM_ARIES_BRIDGE with achievements and teams")}catch(t){s("‚ö†Ô∏è AriesBridge: failed to expose bridge",t)}}function Qb(e,t){return new Promise(n=>{const o=function(e,t){const n=new URL(e,"https://ariesmod-api.ariedam.fr/");if(t)for(const[o,r]of Object.entries(t))void 0!==r&&n.searchParams.set(o,String(r));return n.toString()}(e,t),r=function(){if("function"==typeof GM_xmlhttpRequest)return GM_xmlhttpRequest;const e=globalThis.GM;return e?.xmlHttpRequest?e.xmlHttpRequest.bind(e):void 0}();r?r({method:"GET",url:o,headers:{},onload:e=>{let t,o=null;if(e.responseText)try{o=JSON.parse(e.responseText)}catch(r){t=`Failed to parse JSON: ${r.message}`}(e.status<200||e.status>=300)&&!t&&(t=`HTTP ${e.status}`),n(t?{status:e.status,data:o,error:t}:{status:e.status,data:o})},onerror:e=>n({status:0,data:null,error:String(e??"Network error")})}):n({status:0,data:null,error:"GM_xmlhttpRequest unavailable"})})}async function Jb(e){if(!e)return{status:0,data:null,error:"Missing playerId"};const t=await Qb("get-player-view",{playerId:e});return 404===t.status?{status:404,data:null,error:"Player not found"}:t}let Kb=null;async function Yb(e){if(!e)return new Set;if(Kb&&Kb.playerId===e)return Kb.friends;const t=await async function(e){if(!e)return{status:0,data:null,error:"Missing playerId"};const t=await Qb("list-friends",{playerId:e});return 200===t.status&&t.data&&Array.isArray(t.data.friends)?{status:t.status,data:t.data.friends}:{status:t.status,data:null,error:t.error??"Bad response"}}(e),n=new Set(t.data??[]);return Kb={playerId:e,friends:n},n}function Zb(){Kb=null}const ey={targetPlayerId:null,targetPlayerName:"",targetRoomId:""},ty=Ri;let ny=null;const oy=new Map,ry=new Map;function iy(e){return String(e||"").toLowerCase().replace(/[^a-z0-9]/g,"")}ty.then(e=>{if(ny=e,!e)return;["item","decor","seed","plant","tallplant","crop","pet"].forEach(t=>{try{e.list(t).forEach(e=>{const n=String(e.key||"").split("/"),o=n[n.length-1]||e.key;!function(e,t){const n=iy(e),o=oy.get(n)??[];o.push(t),oy.set(n,o)}(o,{category:t,id:o})})}catch{}})});const ay=()=>{function e(e,t){const n=Object.keys(e).map(e=>parseInt(e,10)).sort((e,t)=>e-t);console.log(`[QPM] Garden for ${t}`),console.log("[QPM] Total tiles:",n.length),console.log("[QPM] Tile IDs:",n);const o={};n.forEach(e=>{const t=Math.floor(e/10);o[t]||(o[t]=[]),o[t].push(e)}),console.log("[QPM] Tiles grouped by row (√∑10):"),console.table(Object.entries(o).map(([e,t])=>({Row:e,Count:t.length,Range:`${t[0]}-${t[t.length-1]}`,IDs:t.join(",")}))),console.log("[QPM] Sample tile data (first 3):"),n.slice(0,3).forEach(t=>{console.log(`Tile ${t}:`,e[t])})}return{QPM_INSPECT_GARDEN:async()=>{console.log("[QPM Garden Inspector] Starting...");try{const t=rh();console.log("[QPM] Public Rooms state:",t);const n=sy();if(console.log("[QPM] Your Player ID:",n||"Not found"),ey.targetPlayerId){console.log("[QPM] Currently inspecting:",ey.targetPlayerName,ey.targetPlayerId);const t=await Jb(ey.targetPlayerId),n=t?.data?.garden||t?.garden;if(n?.tileObjects)return void e(n.tileObjects,ey.targetPlayerName)}if(n){console.log("[QPM] Fetching YOUR garden...");const t=await Jb(n),o=t?.data?.garden||t?.garden;if(o?.tileObjects)return void e(o.tileObjects,"You")}console.warn("[QPM] No garden data found. Open the inspector on a player first.")}catch(t){console.error("[QPM] Error:",t)}},QPM_EXPOSE_GARDEN:async()=>{try{const e=sy();let t=ey.targetPlayerId||e,n=ey.targetPlayerName||"You";if(!t)return console.warn("[QPM] No player selected. Open inspector on a player first."),null;console.log(`[QPM] Fetching garden data for ${n}...`);const o=await Jb(t);console.log("[QPM] API Response:",o);const r=o?.data?.garden||o?.garden;return r?(console.log("[QPM] Garden Data:"),console.log("  tileObjects:",r.tileObjects),console.log("  boardwalkTileObjects:",r.boardwalkTileObjects),console.log("\n[QPM] Tile IDs in tileObjects:",Object.keys(r.tileObjects||{}).map(e=>parseInt(e,10)).sort((e,t)=>e-t)),console.log("[QPM] Tile IDs in boardwalkTileObjects:",Object.keys(r.boardwalkTileObjects||{}).map(e=>parseInt(e,10)).sort((e,t)=>e-t)),r):(console.warn("[QPM] No garden data in response. Response structure:",Object.keys(o||{})),o?.data&&console.warn("[QPM] Response.data keys:",Object.keys(o.data)),null)}catch(e){return console.error("[QPM] Error:",e),null}},QPM_CURRENT_TILE:async()=>{try{const{getAtomByLabel:e,readAtomValue:t}=await Promise.resolve().then(()=>X),n=e("myCurrentGardenTileAtom"),o=e("myOwnCurrentGardenObjectAtom");if(!n||!o)return console.warn("[QPM] Tile atoms not found. Make sure you're in your garden."),null;const r=await t(n),i=await t(o);return console.log("[QPM] Current Tile Info:"),console.log("  localTileIndex:",r?.localTileIndex),console.log("  tileType:",r?.tileType),console.log("  objectType:",i?.objectType),console.log("  species:",i?.species),console.log("\n[QPM] Full tile data:",{tileInfo:r,tileObject:i}),{tileInfo:r,tileObject:i}}catch(e){return console.error("[QPM] Error:",e),null}}}};function sy(){const e=rh?.(),t=e?.selfPlayerId||g.get("quinoa:selfPlayerId","");if(t)return t;try{const t=e?.allRooms||{};for(const e of Object.values(t)){const t=e.userSlots?.find(e=>e.playerId&&e.name&&e.name.toLowerCase().includes("you"));if(t?.playerId)return t.playerId}}catch{}return null}function ly(e,t){const n=document.getElementById(e);n&&(n.innerHTML=`<div class="pr-pane-placeholder">${t}</div>`)}function cy(e,t){const n=document.getElementById(e);n&&(n.innerHTML=t)}function dy(e){ly("pr-overview-content",e),ly("pr-pets-content",e),ly("pr-inventory-content",e),ly("pr-activity-content",e)}function py(){let e=document.getElementById("pr-inspector-shell");if(e)return e;e=document.createElement("div"),e.id="pr-inspector-shell",e.className="pr-inspector hidden",e.innerHTML='\n    <div class="pr-inspector-overlay"></div>\n    <div class="pr-inspector-panel">\n      <div class="pr-inspector-header" id="pr-drag-handle">\n        <div class="pr-drag-indicator">‚ãÆ</div>\n        <div class="pr-inspector-identity">\n          <div id="pr-inspector-avatar" class="pr-inspector-avatar">üë§</div>\n          <div>\n            <div id="pr-inspector-name" class="pr-inspector-name">Player</div>\n            <div id="pr-inspector-sub" class="pr-inspector-sub">Room ‚Äî</div>\n          </div>\n        </div>\n        <div class="pr-inspector-actions">\n          <button id="pr-inspector-refresh" class="qpm-button qpm-button--primary" title="Refresh player data">\n            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n              <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/>\n            </svg>\n          </button>\n          <button id="pr-inspector-close" class="qpm-button qpm-button--negative" title="Close inspector">‚úï</button>\n        </div>\n      </div>\n      <div class="pr-inspector-tabs">\n        <button class="pr-inspector-tab active" data-tab="player">Player</button>\n        <button class="pr-inspector-tab" data-tab="compare">Compare</button>\n      </div>\n      <div class="pr-inspector-body">\n        <div id="pr-tab-player" class="pr-inspector-pane active">\n          <div class="pr-pane-card">\n            <div class="pr-pane-title">Overview</div>\n            <div id="pr-overview-content" class="pr-pane-placeholder">Awaiting endpoint & token. Data will load here when configured.</div>\n          </div>\n          <div class="pr-pane-card collapsible">\n            <div class="pr-pane-title">Garden</div>\n            <div id="pr-pets-content" class="pr-pane-placeholder">Grid, timers, eggs, mutations will render here.</div>\n          </div>\n          <div class="pr-pane-card collapsible">\n            <div class="pr-pane-title">Inventory</div>\n            <div id="pr-inventory-content" class="pr-pane-placeholder">Seeds, potions, tools, rare produce.</div>\n          </div>\n          <div class="pr-pane-card collapsible">\n            <div class="pr-pane-title">Activity</div>\n            <div id="pr-activity-content" class="pr-pane-placeholder">Recent actions (harvest, feedPet, MoonKisser...).</div>\n          </div>\n        </div>\n\n        <div id="pr-tab-compare" class="pr-inspector-pane">\n          <div class="pr-pane-card">\n            <div class="pr-pane-title">Compare (coming soon)</div>\n            <div class="pr-pane-placeholder">Compare pets/achievements once other player data is available.</div>\n          </div>\n        </div>\n      </div>\n    </div>\n  ',document.body.appendChild(e);const t=()=>e?.classList.add("hidden");if(e.querySelector("#pr-inspector-close")?.addEventListener("click",t),e.querySelector(".pr-inspector-overlay")?.addEventListener("click",t),e.querySelectorAll(".pr-inspector-tab").forEach(t=>{t.addEventListener("click",t=>{const n=t.currentTarget.getAttribute("data-tab");e?.querySelectorAll(".pr-inspector-tab").forEach(e=>e.classList.remove("active")),e?.querySelectorAll(".pr-inspector-pane").forEach(e=>e.classList.remove("active")),t.currentTarget.classList.add("active");const o=n?e?.querySelector(`#pr-tab-${n}`):null;o?.classList.add("active")})}),e.dataset.prRefreshBound||(e.querySelector("#pr-inspector-refresh")?.addEventListener("click",()=>Ly(!0)),e.dataset.prRefreshBound="1"),!e.dataset.prDraggableBound){const t=e.querySelector("#pr-drag-handle"),n=e.querySelector(".pr-inspector-panel");if(t&&n){let e=!1,o=0,r=0,i=0,a=0;t.addEventListener("mousedown",o=>{const r=o.target;if(r.closest(".pr-inspector-actions")||r.closest("button"))return;e=!0;const s=n.getBoundingClientRect();i=o.clientX-s.left,a=o.clientY-s.top,n.style.transition="none",t.style.cursor="grabbing"}),document.addEventListener("mousemove",t=>{if(!e)return;t.preventDefault(),o=t.clientX-i,r=t.clientY-a;const s=n.getBoundingClientRect(),l=window.innerWidth-s.width,c=window.innerHeight-s.height;o=Math.max(0,Math.min(o,l)),r=Math.max(0,Math.min(r,c)),n.style.left=`${o}px`,n.style.top=`${r}px`,n.style.transform="none"}),document.addEventListener("mouseup",()=>{e&&(e=!1,n.style.transition="",t.style.cursor="")})}e.dataset.prDraggableBound="1"}return e}function uy(e,t){const n=(e||"").trim();if(!n)return void console.warn("[PublicRooms] Missing playerId for inspector");const o=py(),r=o.querySelector("#pr-inspector-avatar"),i=o.querySelector("#pr-inspector-name"),a=o.querySelector("#pr-inspector-sub");r&&(r.style.backgroundImage="none",r.textContent=qy(t??n),r.classList.remove("has-img")),i&&(i.textContent=t||n),a&&(a.textContent="Inspector (direct)"),ey.targetPlayerId=n,ey.targetPlayerName=t||n,ey.targetRoomId="debug",dy("Loading player view..."),o.classList.remove("hidden"),Ly(!1).catch(e=>{console.error("[PublicRooms] Inspector direct refresh failed",e),dy("Unable to load player view.")})}function gy(e,t="info"){console.log(`[PublicRooms:${t}]`,e)}function my(e,t=1){const n="number"==typeof e?e:Number(e);if(!Number.isFinite(n))return"‚Äî";const o=Math.abs(n);return o>=1e15?`${(n/1e15).toFixed(t)}Q`:o>=1e12?`${(n/1e12).toFixed(t)}T`:o>=1e9?`${(n/1e9).toFixed(t)}B`:o>=1e6?`${(n/1e6).toFixed(t)}M`:o>=1e3?`${(n/1e3).toFixed(t)}K`:n.toLocaleString()}function fy(e){return Array.isArray(e)?e:[]}function hy(e){if(null==e||!Number.isFinite(e)||e<=0)return"done";const t=Math.floor(e/1e3),n=Math.floor(t/60),o=Math.floor(n/60),r=Math.floor(o/24);return r>0?`${r}d ${o%24}h`:o>0?`${o}h ${n%60}m`:n>0?`${n}m`:`${Math.max(t,0)}s`}function by(e){if(!e)return"Unknown";return String(e).replace(/[_-]+/g," ").replace(/\b\w/g,e=>e.toUpperCase())}window.QPM_INSPECT_FRIEND||(window.QPM_INSPECT_FRIEND=e=>{const t=(e||"").trim();if(t){try{localStorage.setItem("quinoa:selfPlayerId",t)}catch(n){console.warn("[QPM Inspector] Unable to persist self playerId",n)}Zb(),console.log("[QPM Inspector] self playerId set to",t,"friend cache cleared.")}else console.warn("[QPM Inspector] Provide a playerId string.")});const yy={shovel:"‚õèÔ∏è",wateringcan:"üíß",watering:"üíß",fertilizer:"üß™",hoe:"‚öíÔ∏è",bucket:"ü™£",seed:"üå±"},xy="items",vy={shovel:1,"watering can":8,wateringcan:8,"planter pot":5,planterpot:5,"wet potion":15,wetpotion:15,"frozen potion":17,frozenpotion:17,"chilled potion":16,chilledpotion:16,"dawnlit potion":18,dawnlitpotion:18,"amberlit potion":19,amberlitpotion:19,"ambercharged potion":19,"amberbound potion":19,"dawncharged potion":18,"dawnbound potion":18,"gold potion":14,goldpotion:14,"rainbow potion":13,rainbowpotion:13};function wy(e){const t=e.toLowerCase(),n=vy[t]??vy[t.replace(/\s+/g,"")];if("number"==typeof n){const e=Sy(ta.getTile(xy,n));if(e)return e}const o=ry.get(`item:${iy(e)}`);if(o)return o;const r=Py(e,["item","decor"]);return r&&ry.set(`item:${iy(e)}`,r),r}function Cy(e){const t=[e,e.toLowerCase(),e.charAt(0).toUpperCase()+e.slice(1).toLowerCase(),e.replace(/egg$/i,"")+"Egg"];for(const n of t){const e=Yi(n);if(e)return Sy(e)}return Py(e,["pet","item"])}const Ty={gold:{blendMode:"source-atop",colors:["rgb(255, 215, 0)"],alpha:.7},rainbow:{blendMode:"color",colors:["#FF1744","#FF9100","#FFEA00","#00E676","#2979FF","#D500F9"],gradientAngle:130,masked:!0},wet:{blendMode:"source-atop",colors:["rgb(128, 128, 255)"],alpha:.2},chilled:{blendMode:"source-atop",colors:["rgb(183, 183, 236)"],alpha:.5},frozen:{blendMode:"source-atop",colors:["rgb(128, 128, 255)"],alpha:.6},dawnlit:{blendMode:"source-atop",colors:["rgb(120, 100, 180)"],alpha:.4},ambershine:{blendMode:"source-atop",colors:["rgb(255, 140, 26)","rgb(230, 92, 26)","rgb(178, 58, 26)"],alpha:.5},dawncharged:{blendMode:"source-atop",colors:["rgb(100, 80, 160)","rgb(110, 90, 170)","rgb(120, 100, 180)"],alpha:.5},ambercharged:{blendMode:"source-atop",colors:["rgb(167, 50, 30)","rgb(177, 60, 40)","rgb(187, 70, 50)"],alpha:.5}};function Sy(e){if(!e)return null;try{return e.toDataURL("image/png")}catch{return null}}function Py(e,t=["item","decor","seed","crop","plant","tallplant","pet"]){if(!e||!ny)return null;const n=iy(e),o=ry.get(`${t.join(",")}:${n}`);if(o)return o;const r=oy.get(n);if(!r||!r.length)return null;const i=t.map(e=>r.find(t=>t.category===e)).find(e=>!!e)||r[0];if(!i)return null;try{const e=Sy(ny.renderToCanvas({category:i.category,id:i.id,mutations:[]}));return e&&ry.set(`${t.join(",")}:${n}`,e),e}catch{return null}}function ky(e,t,n,o){const r=(o.gradientAngle??90)*Math.PI/180,i=Math.sqrt(t*t+n*n)/2,a=t/2,s=n/2,l=a-Math.cos(r)*i,c=s-Math.sin(r)*i,d=a+Math.cos(r)*i,p=s+Math.sin(r)*i,u=e.createLinearGradient(l,c,d,p),g=o.colors&&o.colors.length>0?o.colors:["rgba(255,255,255,0.7)"];g.forEach((e,t)=>u.addColorStop(1===g.length?0:t/(g.length-1),e)),e.fillStyle=u,e.fillRect(0,0,t,n)}function Ay(e){const t=String(e).trim().toLowerCase();return t.replace(/egg$/i,"").trim()||t}function Ey(e){if(!e||0===e.length)return"";return e.slice(0,4).map(e=>{const t=function(e){const t=(e||"").toLowerCase().replace(/\s+/g,"");return t.includes("rainbowgranter")||t.includes("rainbow")?{base:"linear-gradient(135deg, #FF0000 0%, #FF7F00 16.67%, #FFFF00 33.33%, #00FF00 50%, #0000FF 66.67%, #4B0082 83.33%, #9400D3 100%)",glow:"rgba(124,77,255,0.7)",text:"#FFF"}:t.includes("goldgranter")||t.includes("golden")||"gold"===t?{base:"linear-gradient(135deg, #FFD700 0%, #FFA500 50%, #FFD700 100%)",glow:"rgba(255,215,0,0.75)",text:"#000"}:t.includes("coinfinder")?{base:"#FFD700",glow:"rgba(255,215,0,0.65)",text:"#000"}:t.includes("produceeater")||t.includes("cropeater")||t.includes("producerefund")||t.includes("croprefund")?{base:"#FF5722",glow:"rgba(255,87,34,0.6)",text:"#FFF"}:t.includes("producescaleboost")||t.includes("cropsize")?{base:"#4CAF50",glow:"rgba(76,175,80,0.6)",text:"#FFF"}:t.includes("producemutation")||t.includes("cropmutation")?{base:"#E91E63",glow:"rgba(233,30,99,0.6)",text:"#FFF"}:t.includes("seedfinder")?{base:"#FF9800",glow:"rgba(255,152,0,0.6)",text:"#FFF"}:t.includes("egggrowth")?{base:"#9C27B0",glow:"rgba(156,39,176,0.6)",text:"#FFF"}:t.includes("petrefund")?{base:"#00BCD4",glow:"rgba(0,188,212,0.6)",text:"#FFF"}:t.includes("petmutation")?{base:"#E91E63",glow:"rgba(233,30,99,0.6)",text:"#FFF"}:t.includes("petageboost")||t.includes("maxstrength")||t.includes("strengthboost")?{base:"#673AB7",glow:"rgba(103,58,183,0.6)",text:"#FFF"}:t.includes("pethatchsizeboost")||t.includes("hatchxp")?{base:"#7C4DFF",glow:"rgba(124,77,255,0.65)",text:"#FFF"}:t.includes("sellboost")?{base:"#F44336",glow:"rgba(244,67,54,0.6)",text:"#FFF"}:t.includes("hunger")?{base:"#EC407A",glow:"rgba(236,64,122,0.6)",text:"#FFF"}:t.includes("xpboost")?{base:"#2196F3",glow:"rgba(33,150,243,0.6)",text:"#FFF"}:t.includes("plantgrowth")||t.includes("producegrowth")?{base:"#26A69A",glow:"rgba(38,166,154,0.6)",text:"#FFF"}:t.includes("raindance")?{base:"#2196F3",glow:"rgba(33,150,243,0.6)",text:"#FFF"}:t.includes("doublehatch")?{base:"#5C6BC0",glow:"rgba(92,107,192,0.6)",text:"#FFF"}:t.includes("doubleharvest")?{base:"#1976D2",glow:"rgba(25,118,210,0.6)",text:"#FFF"}:{base:"#90A4AE",glow:"rgba(144,164,174,0.6)",text:"#FFF"}}(e);return`<div class="pr-ability-square" title="${e}" style="background:${t.base};border:1px solid rgba(255,255,255,0.3);box-shadow:0 0 6px ${t.glow};"></div>`}).join("")}function $y(e,t,n){if(!e)return null;const o=function(e){const t=String(e).toLowerCase();return"mooncelestial"===t?"mooncelestialcrop":"dawncelestial"===t?"dawncelestialcrop":t.includes("tulip")?"tulip":t}(e),r=t.map(e=>String(e||"").toLowerCase()).filter(Boolean).slice(0,4),i=r.length?Ji(o,r):Qi(o),a=`crop:${o}:${r.join(",")}`;if(i){const e=Sy(i);if(e)return ry.set(a,e),e}const s=ry.get(a);if(s)return s;const l=Py(o,["crop","plant","tallplant","seed"])||null;return l&&ry.set(a,l),l}function My(e,t,n){const o=e.playerName||ey.targetPlayerName||"Unknown player";e.room&&(e.room.id||e.room.roomId);const r=e.lastEventAt?Ry(e.lastEventAt):"n/a",i=function(e){const t="number"==typeof e?e:Number(e);return Number.isFinite(t)?my(t,1):"‚Äî"}(e.coins);cy("pr-overview-content",`\n    <div class="pr-overview">\n      ${function(e,t){return`<div class="pr-avatar-block">${e.avatarUrl?`<div class="pr-avatar-block-img" style="background-image:url(${e.avatarUrl})"></div>`:`<div class="pr-avatar-block-fallback">${qy(t)}</div>`}<div><div class="pr-avatar-name">${t}</div><div class="pr-avatar-id">${e.playerId}</div></div></div>`}(e,o)}\n      <div class="pr-overview-grid">\n        <div class="pr-row"><span>Status</span><span>${e.isOnline?"üü¢ Online":"‚ö™ Offline"}</span></div>\n        <div class="pr-row"><span>Last event</span><span>${r}</span></div>\n        <div class="pr-row"><span>Coins</span><span>${i}</span></div>\n      </div>\n    </div>\n  `)}async function Iy(e,t,n){await ty;const o=e.state?.inventory,r=[],i=(e,t)=>{if(!e)return;if(t&&("FavoritedItemIDs"===t||t.includes("Favorited")))return;if("object"!=typeof e||Array.isArray(e))return;const n=e.quantity??e.qty??e.count??1,o=Number.isFinite(Number(n))?Number(n):1,i=e.itemType&&String(e.itemType).toLowerCase().includes("pet"),a=e.itemType&&String(e.itemType).toLowerCase().includes("egg"),s=e.seedName||e.seed||e.crop||e.species||e.cropId,l=i?e.petSpecies||e.species:null;let c=null;if(a&&e.eggId){c=String(e.eggId).replace(/Egg$/i,"").trim()||"Common"}let d=e.displayName||e.name||s||l||e.toolId||e.itemType||e.id||t||"Item";a&&c&&(d=`${c} Egg`),String(d).toLowerCase().includes("tulip")&&(d="Tulip");const p=Boolean(s)&&(!e.itemType||String(e.itemType).toLowerCase().includes("seed"));"decor"===d.toLowerCase()&&(e.id||e.decorId||e.itemId)&&(d=e.displayName||e.name||e.id||e.decorId||e.itemId||"Decor");const u=by(p?`${d} Seeds`:d);let g=null,m=30;if(i){const t=e.xp??e.petXP??e.petXp??0,n=e.targetScale??e.petTargetScale??e.scale??1;if(t>0&&l){const e=Fc(n,l),o=$c(l);if(o&&o>0&&e){const n=Math.min(30,Math.floor(t/o)),r=50,i=(e-r)/30;g=Math.min(e,Math.round(r+n*i)),m=e}}}const f=i?l:s,h=u.toLowerCase(),b=i&&(e.mutation||e.mutations)?String(Array.isArray(e.mutations)?e.mutations[0]:e.mutation).toLowerCase():"";let y=null;const x=[u,d,s,l,e.decorId,e.id,e.itemId,t].map(e=>e?String(e):null).filter(Boolean);if(p&&f)y=function(e){let t=String(e).toLowerCase();t.includes("tulip")&&(t="tulip");const n=`seed:${t}`,o=ry.get(n);if(o)return o;const r=Qi(t);if(r){const e=Sy(r);if(e)return ry.set(n,e),e}const i=Py(t,["seed","crop","plant","tallplant"]);return i&&ry.set(n,i),i}(String(f).toLowerCase());else if(a)y=e.eggId?Cy(String(e.eggId)):null;else if(i&&f){const e=Ay(String(f));y=Sy(b?Zi(e,[b]):Yi(e))}else f&&(y=$y(String(f).toLowerCase(),e.mutations||[]));y||(y=wy(h)||wy(d.toLowerCase())||x.map(e=>Py(e,["decor","item"])).find(Boolean)||x.map(e=>Py(e,["item","decor"])).find(Boolean)||null);let v=y;!v&&wy(d.toLowerCase())&&(v=wy(d.toLowerCase()));const w=yy[h.replace(/\s+/g,"")],C=i&&e.abilities?Array.isArray(e.abilities)?e.abilities:[e.abilities]:[],T=i?e.xp??e.petXP??e.petXp??0:0,S=i?e.targetScale??e.petTargetScale??e.scale??1:1;r.push({label:u,qty:o,sprite:v||null,icon:w||null,petLevel:g,petMaxLevel:m,isPet:i,abilities:C,xp:T,targetScale:S})};Array.isArray(o)?o.forEach(e=>i(e)):o&&"object"==typeof o&&Object.entries(o).forEach(([e,t])=>{Array.isArray(t)?t.forEach(t=>i(t,e)):t&&"object"==typeof t&&i(t,e)});const a=(e.state?.inventory?.storages||[]).find(e=>"PetHutch"===e.decorId||"hutch"===e.type||"hutch"===e.id);let s="";if(a&&a.items&&a.items.length>0){const e=a.items.map(e=>{const t=e.petSpecies||e.species,n=Ay(String(t)),o=e.name||by(t);let r=Sy(Yi(n));const i=e.mutation||e.mutations?String(Array.isArray(e.mutations)?e.mutations[0]:e.mutation).toLowerCase():"";if(r&&i){const e=Zi(n,[i]);if(e){r=Sy(function(e,t){const n=Ty[t.toLowerCase()];if(!n)return null;const o=e.width,r=e.height,i=document.createElement("canvas");i.width=o,i.height=r;const a=i.getContext("2d",{willReadFrequently:!0});if(!a)return null;if(a.imageSmoothingEnabled=!1,a.drawImage(e,0,0),a.save(),a.globalCompositeOperation=n.blendMode,null!=n.alpha&&(a.globalAlpha=n.alpha),n.masked){const t=document.createElement("canvas");t.width=o,t.height=r;const i=t.getContext("2d",{willReadFrequently:!0});i&&(ky(i,o,r,n),i.globalCompositeOperation="destination-in",i.drawImage(e,0,0),i.globalCompositeOperation="source-over",a.drawImage(t,0,0))}else ky(a,o,r,n);return a.restore(),i}(e,i))||r}}const a=e.xp||0;let s=50;const l=Fc(e.targetScale||1,t),c=$c(t);if(c&&c>0&&a>0&&l){const e=Math.min(30,Math.floor(a/c)),t=50,n=(l-t)/30;s=Math.min(l,Math.round(t+e*n))}const d=Ey(e.abilities?Array.isArray(e.abilities)?e.abilities:[e.abilities]:[]);return`\n        <div class="pr-inv-card pet-card">\n          ${d?`<div class="pr-inv-abilities">${d}</div>`:""}\n          <div class="pr-inv-sprite-container">\n            ${r?`<img src="${r}" alt="${o}" class="pr-inv-sprite" />`:'<div class="pr-inv-placeholder">?</div>'}\n          </div>\n          <div class="pr-inv-name">${o}</div>\n          <div class="pr-inv-str">STR: ${s}</div>\n        </div>\n      `}).join("");s=`\n      <div class="pr-section">\n        <div class="pr-section-head">üêæ Pet Hutch (${a.items.length} pets)</div>\n        <div class="pr-card-grid">${e}</div>\n      </div>\n    `}cy("pr-inventory-content",`\n    <div class="pr-section">\n      <div class="pr-section-head">üéí Inventory (<span id="pr-inv-count">${r.length}</span> items)</div>\n      <div class="pr-card-grid" id="pr-inv-cards"></div>\n    </div>\n    ${s}\n  `);const l=document.getElementById("pr-inv-cards");if(l){const e=e=>{const t=Ey(e.abilities||[]),n=e.petLevel??0;return`\n        <div class="pr-inv-card pet-card">\n          ${t?`<div class="pr-inv-abilities">${t}</div>`:""}\n          <div class="pr-inv-sprite-container">\n            ${e.sprite?`<img src="${e.sprite}" alt="${e.label}" class="pr-inv-sprite" />`:'<div class="pr-inv-placeholder">?</div>'}\n          </div>\n          <div class="pr-inv-name">${e.label}</div>\n          <div class="pr-inv-str">STR: ${n}</div>\n        </div>\n      `},t=e=>{const t=e.icon||"?";return`\n        <div class="pr-inv-card">\n          <div class="pr-inv-sprite-container">\n            ${e.sprite?`<img src="${e.sprite}" alt="${e.label}" class="pr-inv-sprite" />`:`<div class="pr-inv-placeholder">${t}</div>`}\n          </div>\n          <div class="pr-inv-name">${e.label}</div>\n          <div class="pr-inv-qty">x${e.qty}</div>\n        </div>\n      `},n=32;let o=0;const i=()=>{const a=performance.now();let s="",c=0;for(;o<r.length&&c<n&&performance.now()-a<10;){const n=r[o++];n&&(s+=n.isPet?e(n):t(n),c+=1)}s&&l.insertAdjacentHTML("beforeend",s),o<r.length?requestAnimationFrame(i):l.innerHTML.trim()||(l.innerHTML='<div class="pr-pane-placeholder">Inventory payload empty or private.</div>')};r.length?requestAnimationFrame(i):l.innerHTML='<div class="pr-pane-placeholder">Inventory payload empty or private.</div>'}}function Fy(e,t,n){const o=Array.isArray(e.state?.activityLog)?e.state?.activityLog:Array.isArray(e.state?.activityLogs)?e.state?.activityLogs:[];if(!o||0===o.length)return void ly("pr-activity-content","No activity shared in the payload.");cy("pr-activity-content",`\n    <div class="pr-section">\n      <div class="pr-section-head">Recent Activity</div>\n      <div class="pr-timeline">${o.slice(0,8).map(e=>{let t=e;if("string"==typeof e)try{t=JSON.parse(e)}catch{t={note:e}}const n=t.action||t.type||t.event||t.name||"Activity",o=by(n),r=function(e){if(null==e)return null;const t=Number(e);return Number.isFinite(t)?t<1e11?1e3*t:t:null}(t.timestamp??t.time??t.createdAt??null),i=r?Ry(new Date(r).toISOString()):"recently",a=t.parameters||t,s=a?.species||a?.crop||a?.seed||t.seed,l=a?.pet?.name||a?.pet?.petSpecies||a?.petSpecies||t.pet,c=a?.mutations||a?.mutation||[];let d=null;if(s)d=$y(String(s).toLowerCase(),c);else if(l){d=Sy(Yi(String(a?.pet?.petSpecies||l).toLowerCase()))}let p="";if("feedPet"===n){p=`Fed ${a?.pet?.name||"pet"}`}else if("purchaseEgg"===n){const e=a?.eggIds||[];p=`Purchased ${by(Array.isArray(e)&&e.length>0?e[0]:"egg")}`}else if("purchaseSeed"===n){const e=a?.seedIds||[];p=`Purchased ${by(Array.isArray(e)&&e.length>0?e[0]:"seed")}`}else if("purchaseTool"===n)p="Purchased tool";else if("harvest"===n){const e=a?.crops||[];p=`Harvested ${Array.isArray(e)?e.length:1} ${by(Array.isArray(e)&&e.length>0?e[0].species:"crops")}`}else if("plantEgg"===n)p="Planted an egg";else if(n.startsWith("PetXpBoost")){const e=a?.bonusXp||0,t=a?.petsAffected?.length||0;p=`+${e} XP to ${t} pet${1!==t?"s":""}`}else p="ProduceScaleBoostII"===n||"ProduceScaleBoost"===n?"Crop size boost activated":n.includes("Kisser")||n.includes("Granter")?`${o} ability triggered`:n.toLowerCase().includes("hatch")?`Hatched ${by(l||s||"pet")}`:n.toLowerCase().includes("sell")?`Sold ${by(l||s||"item")}`:a?.currency&&a?.purchasePrice?`Spent ${a.purchasePrice} ${a.currency}`:function(e){try{const t="string"==typeof e?e:JSON.stringify(e,null,2);return t.length>320?`${t.slice(0,320)}‚Ä¶`:t}catch{return"Data available"}}(a)||"No details";return{action:o,ago:i,detail:p,sprite:d}}).map(e=>{return`\n    <div class="pr-timeline-item">\n      <div class="pr-timeline-dot"></div>\n      ${e.sprite?(t=e.sprite,n="",`<div class="pr-sprite-circle" style="${t?`background-image:url('${t}');`:""}">${t?"":n}</div>`):'<div style="width:10px"></div>'}\n      <div class="pr-timeline-main">\n        <div class="pr-timeline-title">${e.action}</div>\n        <div class="pr-timeline-detail">${e.detail||"No details"}</div>\n      </div>\n      <div class="pr-time-badge">${e.ago}</div>\n    </div>\n  `;var t,n}).join("")}</div>\n      ${o.length>8?'<div class="pr-hint">Showing first 8 entries</div>':""}\n    </div>\n  `)}async function zy(e,t){e.privacy,My(e),function(e){const t=e.garden||e.state?.garden,n=e.stats||e.state?.stats,o=[],r=[];for(let g=0;g<10;g++){o[g]=[],r[g]=[];for(let e=0;e<10;e++)o[g][e]={tileId:-1,species:null,mutations:[],isMultiHarvest:!1,slots:[],exists:!1},r[g][e]={tileId:-1,species:null,mutations:[],isMultiHarvest:!1,slots:[],exists:!1}}const i=t?.tileObjects&&"object"==typeof t.tileObjects?t.tileObjects:null;i&&Object.entries(i).forEach(([e,t])=>{const n=parseInt(e,10),i=t,a=i?.objectType;if("egg"===a){const e={tileId:n,species:null,mutations:[],isMultiHarvest:!1,slots:[],exists:!0,objectType:"egg",eggId:i.eggId,maturedAt:i.maturedAt,plantedAt:i.plantedAt},t=Math.floor(n/20),a=n%20;return void(t>=0&&t<10&&(a>=0&&a<10&&o[t]?o[t][a]=e:a>=10&&a<20&&r[t]&&(r[t][a-10]=e)))}const s=fy(i?.slots),l=s[0],c={tileId:n,species:l?.species??l?.plant??null,mutations:fy(l?.mutations),isMultiHarvest:s.length>1,slots:s,exists:!0},d=Math.floor(n/20),p=n%20;d>=0&&d<10&&(p>=0&&p<10&&o[d]?o[d][p]=c:p>=10&&p<20&&r[d]&&(r[d][p-10]=c))});const a=(e,t)=>e.map(e=>e.map(e=>{if(!e.exists)return'<div class="pr-garden-tile pr-garden-tile-empty" title="Empty"></div>';if("egg"===e.objectType&&e.eggId){const t=Cy(e.eggId),n=by(e.eggId),o=e.maturedAt?new Date(e.maturedAt).toLocaleString():"Unknown",r=e.plantedAt?new Date(e.plantedAt).toLocaleString():"Unknown",i=e.maturedAt?hy(Math.max(0,e.maturedAt-Date.now())):"N/A";return`\n          <div class="pr-garden-tile pr-garden-tile-egg" title="${`Tile ${e.tileId}: ${n}\nPlanted: ${r}\nMatured: ${o}\nTime left: ${i}`.replace(/\n/g,"&#10;")}">\n            ${t?`<img src="${t}" alt="${n}" class="pr-garden-sprite" />`:'<div class="pr-garden-placeholder">ü•ö</div>'}\n          </div>\n        `}if(!e.species)return`<div class="pr-garden-tile pr-garden-tile-empty" title="Tile ${e.tileId}: Empty"></div>`;const t=$y(String(e.species).toLowerCase(),e.mutations),n=e.mutations.length>0?e.mutations.map(e=>by(String(e))).join(", "):"None",o=e.isMultiHarvest?`<span class="pr-multi-icon" title="Multi-harvest: ${e.slots.length} slots">√ó${e.slots.length}</span>`:"",r=e.slots[0]||{},i=r.startTime?new Date(r.startTime).toLocaleString():"Unknown",a=r.endTime?new Date(r.endTime).toLocaleString():"Unknown",s=r.endTime?hy(Math.max(0,r.endTime-Date.now())):"N/A";return`\n        <div class="pr-garden-tile" title="${`Tile ${e.tileId}: ${by(e.species)}\nMutations: ${n}\n${e.isMultiHarvest?`Multi-harvest (${e.slots.length} slots)\n`:""}Started: ${i}\nReady: ${a}\nTime left: ${s}`.replace(/\n/g,"&#10;")}">\n          ${t?`<img src="${t}" alt="${e.species}" class="pr-garden-sprite" />`:'<div class="pr-garden-placeholder">üå±</div>'}\n          ${o}\n        </div>\n      `}).join("")).join(""),s=`\n    <div class="pr-garden-plots">\n      <div class="pr-garden-plot">\n        <div class="pr-garden-plot-label">Left Plot</div>\n        <div class="pr-garden-grid pr-garden-grid-10x10">${a(o)}</div>\n      </div>\n      <div class="pr-garden-plot">\n        <div class="pr-garden-plot-label">Right Plot</div>\n        <div class="pr-garden-grid pr-garden-grid-10x10">${a(r)}</div>\n      </div>\n    </div>\n  `,l=n?.player||n?.Player||n,c=l?Object.keys(l):[],d=l?c.slice(0,24).map(e=>{let t=e;t=t.replace(/^num/i,"").replace(/^total/i,"").replace(/^seconds/i,"Seconds"),t=t.replace(/([A-Z])/g," $1").trim(),t+=":";const n=l[e];return`<div class="pr-stat-row"><span class="pr-stat-label">${t}</span><span class="pr-stat-value">${("object"==typeof n?JSON.stringify(n):"number"==typeof n?my(n,1):n)??"‚Äî"}</span></div>`}).join(""):"",p=e=>{let t=0,n=0;return e.forEach(e=>e.forEach(e=>{e.exists&&(n++,e.species&&t++)})),{active:t,total:n}},u=p(o),m=p(r),f=u.active+m.active,h=u.total+m.total,b=e.state?.journal;let y="";if(b){const e=b.pets||{},t=b.produce||{};let n=0;Object.keys(e).forEach(t=>{const o=e[t];o&&(o.variantsLogged?.length>0||o.abilitiesLogged?.length>0)&&n++});let o=0;Object.keys(t).forEach(e=>{const n=t[e];n&&n.variantsLogged?.length>0&&(o+=n.variantsLogged.length)});const r=60,i=385,a=Math.min(100,n/r*100),s=Math.min(100,o/i*100),l=g.get("player-inspector:journal-expanded",!1);g.get("player-inspector:journal-tab","crops");const c=Object.entries(t).filter(([e,t])=>t&&t.variantsLogged?.length>0).sort(([e],[t])=>e.localeCompare(t)).map(([e,t])=>{const n=t.variantsLogged?.length||0,o=Math.min(100,n/11*100),r=11===n,i=r?["Rainbow"]:[],a=$y(String(e).toLowerCase(),i),s=r?"background: linear-gradient(90deg, #dc2626, #ea580c, #facc15, #16a34a, #2563eb, #9333ea); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-weight: 700;":"";return`\n          <div class="pr-journal-detail-row">\n            ${a?`<img src="${a}" alt="${e}" style="width:28px;height:28px;image-rendering:pixelated;border-radius:4px;border:1px solid rgba(168,139,250,0.3);margin-right:10px;" />`:""}\n            <span class="pr-journal-species" style="${r?"background: linear-gradient(90deg, #e11d48, #f97316, #eab308, #22c55e, #3b82f6, #a855f7); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-weight: 700;":""}">${by(e)}</span>\n            <span class="pr-journal-variants" style="${s}">${n}/11</span>\n            <div class="pr-progress-bar-mini">\n              <div class="pr-progress-fill-mini" style="width:${o}%;background:${100===o?"linear-gradient(90deg, #f43f5e, #fb923c, #fde047, #4ade80, #60a5fa, #c084fc)":"linear-gradient(90deg, #4CAF50, #2E7D32)"}"></div>\n            </div>\n          </div>\n        `}).join("")||'<div class="pr-pane-placeholder">No crops logged yet</div>';Object.entries(e).filter(([e,t])=>t&&(t.variantsLogged?.length>0||t.abilitiesLogged?.length>0)).sort(([e],[t])=>e.localeCompare(t)).map(([e,t])=>{const n=t.abilitiesLogged?.length||0,o=t.variantsLogged?.length||0,r=Math.min(100,n/3*100);return`\n          <div class="pr-journal-detail-row">\n            <span class="pr-journal-species">${by(e)}</span>\n            <span class="pr-journal-variants">${n}/3 abilities, ${o}/3 variants</span>\n            <div class="pr-progress-bar-mini">\n              <div class="pr-progress-fill-mini" style="width:${r}%;background:${100===r?"linear-gradient(90deg, #a78bfa, #7c3aed)":"linear-gradient(90deg, #FF7043, #FF5722)"}"></div>\n            </div>\n          </div>\n        `}).join(""),y=`\n      <div class="pr-section pr-section-animated" data-expandable-section="journal">\n        <div class="pr-section-head" style="cursor: pointer; user-select: none; display: flex; align-items: center; justify-content: space-between;" onclick="\n          const section = this.closest('[data-expandable-section]');\n          const content = section.querySelector('.pr-journal-container');\n          const arrow = this.querySelector('.pr-expand-arrow');\n          const isExpanded = content.style.display !== 'none';\n          content.style.display = isExpanded ? 'none' : 'block';\n          arrow.textContent = isExpanded ? '‚ñ∂' : '‚ñº';\n          window.QPM?.storage?.set('player-inspector:journal-expanded', !isExpanded);\n        ">\n          <span>üìñ Journal Progress</span>\n          <span class="pr-expand-arrow" style="font-size: 12px; transition: transform 0.2s;">${l?"‚ñº":"‚ñ∂"}</span>\n        </div>\n        <div class="pr-journal-container" style="display: ${l?"block":"none"};">\n          \x3c!-- Original Progress Bars --\x3e\n          <div class="pr-journal-progress">\n            <div class="pr-journal-item">\n              <div class="pr-journal-header">\n                <span>üêæ Pets Discovered</span>\n                <span class="pr-journal-count">${n} / ${r}</span>\n              </div>\n              <div class="pr-progress-bar">\n                <div class="pr-progress-fill pr-progress-animated" style="width:${a}%;background:${100===a?"linear-gradient(90deg, #FF1744, #FF9100, #FFEA00, #00E676, #2979FF, #D500F9)":"linear-gradient(90deg, #FF7043, #FF5722)"};${100===a?"animation: qpm-rainbow-progress 3s linear infinite; background-size: 200% 100%;":""}"></div>\n              </div>\n              <div class="pr-progress-pct">${a.toFixed(1)}%</div>\n            </div>\n            <div class="pr-journal-item">\n              <div class="pr-journal-header">\n                <span>üåø Crop Variants Discovered</span>\n                <span class="pr-journal-count">${o} / ${i}</span>\n              </div>\n              <div class="pr-progress-bar">\n                <div class="pr-progress-fill pr-progress-animated" style="width:${s}%;background:${100===s?"linear-gradient(90deg, #FF1744, #FF9100, #FFEA00, #00E676, #2979FF, #D500F9)":"linear-gradient(90deg, #2E7D32, #4CAF50)"};${100===s?"animation: qpm-rainbow-progress 3s linear infinite; background-size: 200% 100%;":""}"></div>\n              </div>\n              <div class="pr-progress-pct">${s.toFixed(1)}%</div>\n            </div>\n          </div>\n\n          \x3c!-- Detailed Journal Stats - Crops Only --\x3e\n          <div class="pr-journal-details" style="margin-top: 16px;">\n            <div class="pr-journal-tab-content" style="display: block;">\n              ${c}\n            </div>\n          </div>\n        </div>\n      </div>\n    `}cy("pr-pets-content",`\n    <div class="pr-section">\n      <div class="pr-section-head">Virtual Garden (${f} planted / ${h} tiles)</div>\n      <div class="pr-garden-grid">${s||'<div class="pr-pane-placeholder">No garden data.</div>'}</div>\n    </div>\n    ${y}\n    <div class="pr-section">\n      <div class="pr-section-head">üìä Player Stats</div>\n      ${l?`<div class="pr-stats-grid">${d}</div>`:'<div class="pr-pane-placeholder">No stats shared.</div>'}\n    </div>\n  `)}(e),await Iy(e),Fy(e)}async function Ly(e=!1){py();const t=ey.targetPlayerId;if(!t)return void dy("No player id available for this player yet.");dy("Loading player view...");let n=null;const o=sy();if(o)try{n=await Yb(o)}catch(i){console.warn("[PublicRooms] Friends lookup failed",i)}const r=await Jb(t);if(!r||r.error||!r.data){return void dy(401===r?.status?"Unauthorized. Check your Basic token.":r?.error||"Unable to load player view.")}await zy(r.data),e&&gy("Inspector refreshed","success")}function Ry(e){if(!e)return"n/a";const t=new Date(e).getTime();if(!Number.isFinite(t))return"n/a";const n=Date.now()-t,o=Math.max(0,Math.floor(n/6e4));if(o<1)return"just now";if(o<60)return`${o}m ago`;const r=Math.floor(o/60);if(r<24)return`${r}h ago`;return`${Math.floor(r/24)}d ago`}function qy(e){if(!e)return"üë§";const t=e.trim().split(/\s+/);if(0===t.length||!t[0])return"üë§";return`${(t[0]??"").charAt(0)||""}${t.length>1?(t[t.length-1]??"").charAt(0):""}`.trim().toUpperCase()||"üë§"}function Ny(e){const t=document.getElementById("pr-rooms-list");if(!t)return;t.innerHTML="";const n=Object.keys(e);!function(e,t,n){const o=document.getElementById("pr-total-rooms-pill"),r=document.getElementById("pr-visible-rooms-pill"),i=document.getElementById("pr-last-updated-pill");if(o&&(o.textContent=`Rooms: ${e}`),r&&(r.textContent=`Showing: ${t}`),i)if(n){const e=new Date(n);i.textContent=`Updated: ${e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`}else i.textContent="Updated: --"}(Object.keys(rh().allRooms||{}).length,n.length,rh().lastUpdatedAt);const o=document.createDocumentFragment();0!==n.length?(n.forEach(t=>{const n=e[t];if(!n)return;const r=n.playersCount||0;let i="#666",a="rgba(102, 102, 102, 0.2)";const s=r>=6;s?(i="#E53935",a="rgba(229, 57, 53, 0.25)"):r>=5?(i="#4CAF50",a="rgba(76, 175, 80, 0.2)"):r>=3?(i="#FF9800",a="rgba(255, 152, 0, 0.2)"):r>=1&&(i="#42A5F5",a="rgba(66, 165, 245, 0.2)");const l=function(e){const t=e.trim();return t.length<=16?t:`${t.slice(0,10)}‚Ä¶${t.slice(-4)}`}(n.id),c=n.id.trim().startsWith("I-")?"Discord":"Web";const d="Discord"===c?"#7289DA":"#26A69A",p="Discord"===c?"rgba(114, 137, 218, 0.2)":"rgba(38, 166, 154, 0.2)",u=n.userSlots&&n.userSlots.length>0?`<div class="pr-avatar-stack">${n.userSlots.slice(0,6).map(e=>e.avatarUrl?`<span class="pr-avatar" data-room="${n.id}" data-player="${e.name||""}"><img src="${e.avatarUrl}" alt="avatar"></span>`:`<span class="pr-avatar" data-room="${n.id}" data-player="${e.name||""}">${qy(e.name)}</span>`).join("")}${n.userSlots.length>6?`<span class="pr-avatar" style="background: rgba(148,163,184,0.2); color: #fff;">+${n.userSlots.length-6}</span>`:""}</div>`:'<div class="pr-players-empty">No visible players</div>',g=document.createElement("div");g.className="pr-room-card",g.innerHTML=`\n      <div class="pr-room-header">\n        <div class="pr-room-title">\n          <span class="pr-pill ${n.isPrivate?"pr-pill-private":"pr-pill-public"}">${n.isPrivate?"üîí Private":"üîì Public"}</span>\n          <span title="${n.id}" style="font-size: 18px;">${l}</span>\n          <span class="pr-pill" style="background: ${p}; border: 1px solid ${d}; color: ${d};">${"Discord"===c?"üõ∞Ô∏è Discord":"üåê Web"}</span>\n        </div>\n        <div class="pr-player-count" style="background: ${a}; border-color: ${i}; color: ${i};">\n          <span>üë•</span><span>${r}</span>\n        </div>\n      </div>\n      <div class="pr-meta-line">\n        <span><span class="pr-dot"></span> Updated ${Ry(n.lastUpdatedAt)}</span>\n        <span>Code: <code style="color: #e2e8f0;">${n.id}</code></span>\n      </div>\n      ${u||""}\n      <div class="pr-hint-line">Tap an avatar to open the Inspector</div>\n      <div class="pr-room-actions">\n        <button\n          class="qpm-button ${s?"qpm-button--negative":"qpm-button--positive"} pr-join-btn"\n          data-room-code="${t}"\n          style="flex: 1; padding: 10px; font-size: 13px; font-weight: 700; ${s?"background: linear-gradient(135deg, rgba(229,57,53,0.85), rgba(183,28,28,0.9)); border: 2px solid rgba(229,57,53,0.9); color: #fff;":""}"\n        >${s?"‚õî Full":"üöÄ Join"}</button>\n        <button class="qpm-button qpm-button--neutral pr-view-btn" data-room-code="${t}" style="padding: 10px; font-size: 13px; font-weight: 700;">üëÅÔ∏è Players</button>\n      </div>\n    `,o.appendChild(g)}),t.appendChild(o),t.querySelectorAll(".pr-join-btn").forEach(e=>{e.addEventListener("click",e=>{const t=e.target.getAttribute("data-room-code");t&&(window.location.href=`/r/${t}`)})}),t.querySelectorAll(".pr-player-chip").forEach(e=>{e.addEventListener("click",e=>{const t=e.currentTarget.getAttribute("data-player-name");if(!t)return;const n=document.getElementById("pr-search-input");n&&(n.value=t),oh(t)})}),t.querySelectorAll(".pr-view-btn").forEach(e=>{e.addEventListener("click",e=>{const t=e.target.getAttribute("data-room-code");if(!t)return;const n=rh().allRooms[t];n?n.userSlots&&0!==n.userSlots.length?function(e){const t=document.createElement("div");t.style.cssText="position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 9999; display: flex; align-items: center; justify-content: center; padding: 20px;";const n=document.createElement("div");n.style.cssText="width: min(520px, 100%); max-height: 80vh; overflow: auto; background: #111827; border: 2px solid rgba(66,165,245,0.35); border-radius: 10px; padding: 18px; color: #fff; box-shadow: 0 12px 32px rgba(0,0,0,0.4);";const o=e.userSlots||[];n.innerHTML=`\n    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">\n      <div>\n        <div style="font-size: 18px; font-weight: 700;">Players in ${e.id}</div>\n        <div style="font-size: 12px; color: #9CA3AF;">${o.length} visible player${1===o.length?"":"s"}</div>\n      </div>\n      <button id="pr-modal-close" class="qpm-button qpm-button--neutral" style="padding: 6px 12px;">‚úñ</button>\n    </div>\n    <div style="display: flex; flex-direction: column; gap: 10px;">\n      ${0===o.length?'<div style="color: #9CA3AF; font-size: 13px; text-align: center; padding: 20px;">No players visible for this room.</div>':o.map(e=>`\n        <div class="qpm-card" style="padding: 10px 12px; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08); display: flex; align-items: center; gap: 10px;">\n          ${e.avatarUrl?`<img src="${e.avatarUrl}" alt="avatar" style="width: 36px; height: 36px; border-radius: 50%; border: 1px solid rgba(255,255,255,0.2); object-fit: cover;">`:'<div style="width: 36px; height: 36px; border-radius: 50%; background: rgba(255,255,255,0.08); display: grid; place-items: center; color: #9CA3AF;">üë§</div>'}\n          <div style="flex: 1;">\n            <div style="font-size: 14px; font-weight: 700;">${e.name||"Unknown player"}</div>\n            <div style="font-size: 11px; color: #9CA3AF;">Tap to search by this player</div>\n          </div>\n          <button class="qpm-button qpm-button--neutral pr-search-player" data-player-name="${e.name||""}" style="padding: 6px 10px; font-size: 12px;">üîç Search</button>\n        </div>\n      `).join("")}\n    </div>\n  `,t.appendChild(n),document.body.appendChild(t);const r=()=>t.remove();n.querySelector("#pr-modal-close")?.addEventListener("click",r),t.addEventListener("click",e=>{e.target===t&&r()}),n.querySelectorAll(".pr-search-player").forEach(e=>{e.addEventListener("click",e=>{const t=e.currentTarget.getAttribute("data-player-name")||"",n=document.getElementById("pr-search-input");n&&(n.value=t),oh(t),r()})})}(n):gy("No players visible in this room","info"):gy("Room data unavailable","error")})}),t.querySelectorAll(".pr-avatar").forEach(e=>{e.addEventListener("click",e=>{const t=e.currentTarget,n=t.getAttribute("data-room"),o=t.getAttribute("data-player")||"";if(!n)return;const r=rh().allRooms[n];if(!r)return;!function(e,t){const n=py(),o=n.querySelector("#pr-inspector-avatar"),r=n.querySelector("#pr-inspector-name"),i=n.querySelector("#pr-inspector-sub");o&&(e?.avatarUrl?(o.style.backgroundImage=`url(${e.avatarUrl})`,o.textContent="",o.classList.add("has-img")):(o.style.backgroundImage="none",o.textContent=qy(e?.name??""),o.classList.remove("has-img"))),r&&(r.textContent=e?.name||"Unknown player"),i&&(i.textContent=`Room ${t.id} ‚Ä¢ Updated ${Ry(t.lastUpdatedAt)}`),ey.targetPlayerId=e?.playerId??null,ey.targetPlayerName=e?.name||"",ey.targetRoomId=t.id,ey.targetPlayerId?(dy("Loading player view..."),Ly(!1).catch(e=>{console.error("[PublicRooms] Inspector refresh failed",e),dy("Unable to load player view.")})):dy("No player id available for this player yet. Ask the player to enable Aries sync or try a different slot."),n.classList.remove("hidden")}(r.userSlots?.find(e=>(e.name||"")===o)??null??null,r)})})):t.innerHTML='<p style="text-align: center; color: #aaa; grid-column: 1/-1; font-size: 14px;">No rooms found. Try adjusting filters or search by player name.</p>'}function By(e){const t=document.getElementById("pr-rooms-list");if(t){t.innerHTML=`\n      <div style="text-align: center; color: #ff4d4d; grid-column: 1/-1; padding: 40px;">\n        <div style="font-size: 32px; margin-bottom: 16px;">‚ö†Ô∏è</div>\n        <p style="font-size: 14px; margin-bottom: 16px;">${e}</p>\n        <button id="pr-retry-fetch-btn" style="padding: 10px 20px; background: rgba(66, 165, 245, 0.2); border: 2px solid #42A5F5; border-radius: 6px; color: #42A5F5; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s;">üîÑ Retry</button>\n      </div>\n    `;const n=document.getElementById("pr-retry-fetch-btn");n&&n.addEventListener("click",()=>{t.innerHTML='<p style="text-align: center; color: #aaa; grid-column: 1/-1; font-size: 14px;">Loading rooms...</p>',nh()})}}function Dy(e){const t=document.getElementById("pr-connection-status"),n=document.getElementById("pr-rooms-list");if(t){const n={connecting:{text:"üîÑ Connecting...",color:"#42A5F5"},connected:{text:"‚úÖ Connected",color:"#4CAF50"},failed:{text:"‚ùå Connection Failed",color:"#ff4d4d"},retrying:{text:"üîÑ Retrying...",color:"#FF9800"}}[e];t.textContent=n.text,t.style.color=n.color}!n||"connecting"!==e&&"retrying"!==e||(n.innerHTML=`\n      <div style="text-align: center; color: #aaa; grid-column: 1/-1; padding: 40px;">\n        <div style="font-size: 32px; margin-bottom: 16px;">üîÑ</div>\n        <p style="font-size: 14px; margin-bottom: 8px;">${"connecting"===e?"Connecting to Public Rooms...":"Retrying connection..."}</p>\n        <p style="font-size: 12px; color: #666;">This may take a few seconds</p>\n      </div>\n    `)}const Hy=Object.freeze(Object.defineProperty({__proto__:null,openInspectorDirect:uy,renderPublicRoomsWindow:function(e){if(e.innerHTML="",e.style.cssText="height: 100%; overflow-y: auto; background: linear-gradient(135deg, rgba(33, 33, 33, 0.95) 0%, rgba(0, 0, 0, 0.95) 50%, rgba(22, 22, 44, 0.95) 100%);",!document.querySelector("#pr-style-block")){const e=document.createElement("style");e.id="pr-style-block",e.textContent="\n      .hidden { display: none !important; }\n      #pr-app { color: #e5e7eb; font-family: 'Inter', system-ui, -apple-system, sans-serif; padding: 16px; }\n      .pr-hero { display: flex; flex-wrap: wrap; justify-content: space-between; gap: 16px; padding: 18px; border-radius: 14px; background: linear-gradient(135deg, #0b1f2b, #0f2f3c 50%, #0b1b27); border: 1px solid rgba(100, 181, 246, 0.25); box-shadow: 0 12px 30px rgba(0,0,0,0.35); }\n      .pr-hero h3 { margin: 6px 0; font-size: 22px; color: #f8fafc; letter-spacing: 0.2px; }\n      .pr-hero p { margin: 0; color: #94a3b8; font-size: 13px; }\n      .pr-hero-badges { display: flex; gap: 8px; margin-top: 10px; flex-wrap: wrap; }\n      .pr-badge { display: inline-flex; align-items: center; gap: 6px; padding: 6px 10px; border-radius: 999px; font-size: 12px; font-weight: 700; letter-spacing: 0.1px; border: 1px solid transparent; }\n      .pr-badge-ghost { background: rgba(255,255,255,0.05); border-color: rgba(255,255,255,0.08); color: #cbd5e1; }\n      .pr-badge-status { background: rgba(100, 181, 246, 0.12); border-color: rgba(100, 181, 246, 0.4); color: #90caf9; }\n      .pr-status-connecting { background: rgba(100, 181, 246, 0.12); color: #90caf9; border-color: rgba(100, 181, 246, 0.4); }\n      .pr-status-connected { background: rgba(76, 175, 80, 0.12); color: #a5d6a7; border-color: rgba(76, 175, 80, 0.45); }\n      .pr-status-failed { background: rgba(229, 57, 53, 0.12); color: #ef9a9a; border-color: rgba(229, 57, 53, 0.45); }\n      .pr-status-retrying { background: rgba(255, 152, 0, 0.14); color: #ffcc80; border-color: rgba(255, 152, 0, 0.5); }\n      .pr-controls { margin-top: 16px; padding: 16px; border-radius: 12px; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.06); display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 12px; }\n      .pr-control { display: flex; flex-direction: column; gap: 6px; }\n      .pr-control label { font-size: 12px; color: #cbd5e1; letter-spacing: 0.2px; font-weight: 600; }\n      .pr-control input, .pr-control select { width: 100%; padding: 11px 12px; border-radius: 10px; border: 1px solid rgba(148, 163, 184, 0.35); background: rgba(15, 23, 42, 0.6); color: #e2e8f0; font-size: 13px; box-shadow: inset 0 1px 0 rgba(255,255,255,0.04); }\n      .pr-control input:focus, .pr-control select:focus { outline: 2px solid rgba(100, 181, 246, 0.4); border-color: rgba(100, 181, 246, 0.6); }\n      .pr-hint-line { margin: 6px 0 0; color: #9ca3af; font-size: 12px; letter-spacing: 0.1px; }\n      .pr-stats { margin-top: 14px; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; }\n      .pr-stat { padding: 12px 14px; border-radius: 12px; background: linear-gradient(135deg, rgba(148, 163, 184, 0.08), rgba(30, 41, 59, 0.6)); border: 1px solid rgba(148, 163, 184, 0.25); box-shadow: 0 6px 18px rgba(0,0,0,0.25); }\n      .pr-stat-label { font-size: 12px; color: #94a3b8; letter-spacing: 0.2px; margin-bottom: 6px; }\n      .pr-stat-value { font-size: 15px; font-weight: 700; color: #e2e8f0; }\n      .pr-grid { margin-top: 16px; display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 16px; }\n      .pr-room-card { padding: 16px; border-radius: 14px; background: linear-gradient(145deg, rgba(255,255,255,0.04), rgba(15,23,42,0.7)); border: 1px solid rgba(148, 163, 184, 0.16); box-shadow: 0 10px 24px rgba(0,0,0,0.32); transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease; }\n      .pr-room-card:hover { transform: translateY(-3px); border-color: rgba(100, 181, 246, 0.5); box-shadow: 0 14px 28px rgba(0,0,0,0.42); }\n      .pr-room-header { display: flex; justify-content: space-between; gap: 10px; align-items: flex-start; }\n      .pr-room-title { display: flex; flex-wrap: wrap; gap: 8px; align-items: center; font-size: 17px; font-weight: 700; color: #f8fafc; }\n      .pr-room-badges { display: flex; gap: 6px; flex-wrap: wrap; }\n      .pr-player-count { display: inline-flex; align-items: center; gap: 6px; padding: 6px 10px; border-radius: 12px; font-weight: 700; font-size: 12px; border: 1px solid rgba(255,255,255,0.08); }\n      .pr-player-list { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 12px; }\n      .pr-players-empty { color: #94a3b8; font-size: 12px; margin-top: 10px; }\n      .pr-room-actions { display: flex; gap: 8px; margin-top: 14px; }\n      .pr-pill { padding: 6px 10px; border-radius: 10px; font-size: 11px; font-weight: 700; display: inline-flex; align-items: center; gap: 6px; }\n      .pr-pill-private { background: rgba(229, 115, 115, 0.12); border: 1px solid rgba(229, 115, 115, 0.35); color: #ef9a9a; }\n      .pr-pill-public { background: rgba(129, 199, 132, 0.12); border: 1px solid rgba(129, 199, 132, 0.35); color: #c8e6c9; }\n      .pr-meta-line { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; color: #94a3b8; font-size: 12px; margin-top: 10px; }\n      .pr-dot { width: 6px; height: 6px; border-radius: 50%; background: #4dd0e1; display: inline-block; }\n      .pr-avatar-stack { display: flex; align-items: center; gap: 6px; margin-top: 10px; flex-wrap: wrap; }\n      .pr-avatar { width: 28px; height: 28px; border-radius: 999px; border: 1px solid rgba(255,255,255,0.12); background: rgba(255,255,255,0.06); display: grid; place-items: center; color: #cbd5e1; font-weight: 700; font-size: 12px; overflow: hidden; transition: transform 0.15s ease, box-shadow 0.15s ease; cursor: pointer; }\n      .pr-avatar img { width: 100%; height: 100%; object-fit: cover; }\n      @media (prefers-reduced-motion: reduce) {\n        *, *::before, *::after { animation-duration: 0.01ms !important; animation-iteration-count: 1 !important; transition-duration: 0.01ms !important; }\n      }\n      .pr-inspector { position: fixed; inset: 0; z-index: 10000; }\n      .pr-inspector.hidden { display: none; }\n      .pr-inspector-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.85); }\n      .pr-inspector-panel { position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); width: min(1000px, 96vw); max-height: 92vh; overflow: hidden; border-radius: 20px; background: linear-gradient(135deg, #0a1628 0%, #0f172a 30%, #1e1b4b 100%); border: 2px solid rgba(100,181,246,0.4); box-shadow: 0 25px 80px rgba(0,0,0,0.7), 0 0 0 1px rgba(100,181,246,0.2), inset 0 1px 0 rgba(255,255,255,0.1); display: flex; flex-direction: column; transition: left 0.2s ease, top 0.2s ease; }\n      .pr-inspector-header { display: flex; justify-content: space-between; align-items: center; padding: 18px 24px; background: linear-gradient(135deg, rgba(100,181,246,0.15) 0%, rgba(139,92,246,0.1) 100%); border-bottom: 1px solid rgba(100,181,246,0.3); cursor: move; position: relative; overflow: hidden; }\n      .pr-inspector-header:active { cursor: grabbing; }\n      .pr-drag-indicator { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); font-size: 22px; color: rgba(255,255,255,0.25); pointer-events: none; letter-spacing: -4px; font-weight: 700; }\n      .pr-inspector-identity { display: flex; align-items: center; gap: 12px; }\n      .pr-inspector-avatar { width: 42px; height: 42px; border-radius: 12px; background: rgba(255,255,255,0.06); display: grid; place-items: center; color: #e2e8f0; font-weight: 800; font-size: 14px; background-size: cover; background-position: center; border: 1px solid rgba(255,255,255,0.08); }\n      .pr-inspector-avatar.has-img { color: transparent; }\n      .pr-inspector-name { font-size: 16px; font-weight: 800; color: #f8fafc; }\n      .pr-inspector-sub { font-size: 12px; color: #9ca3af; }\n      .pr-inspector-actions { display: flex; gap: 8px; position: relative; z-index: 10; }\n      .pr-inspector-actions button { padding: 10px 14px; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); border: 1px solid rgba(255,255,255,0.1); }\n      .pr-inspector-actions button:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.3); }\n      .pr-inspector-actions button:active { transform: translateY(0); }\n      #pr-inspector-refresh { background: linear-gradient(135deg, rgba(100,181,246,0.2), rgba(139,92,246,0.15)); border-color: rgba(100,181,246,0.4); color: #7dd3fc; }\n      #pr-inspector-refresh:hover { background: linear-gradient(135deg, rgba(100,181,246,0.3), rgba(139,92,246,0.25)); box-shadow: 0 4px 16px rgba(100,181,246,0.4); }\n      #pr-inspector-close { background: rgba(239,68,68,0.15); border-color: rgba(239,68,68,0.4); color: #fca5a5; }\n      #pr-inspector-close:hover { background: rgba(239,68,68,0.25); box-shadow: 0 4px 16px rgba(239,68,68,0.3); }\n      .pr-inspector-tabs { display: flex; gap: 6px; padding: 12px 16px; background: linear-gradient(135deg, rgba(15,23,42,0.8) 0%, rgba(30,27,75,0.6) 100%); border-bottom: 1px solid rgba(100,181,246,0.2); }\n      .pr-inspector-tab { padding: 10px 20px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.03); color: #e2e8f0; font-weight: 700; font-size: 14px; cursor: pointer; position: relative; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }\n      .pr-inspector-tab:hover { background: rgba(100,181,246,0.1); color: #e0e7ff; transform: translateY(-2px); border-color: rgba(100,181,246,0.3); }\n      .pr-inspector-tab.active { background: linear-gradient(135deg, rgba(100,181,246,0.25), rgba(139,92,246,0.2)); border-color: rgba(100,181,246,0.5); color: #7dd3fc; box-shadow: 0 4px 12px rgba(100,181,246,0.3), inset 0 1px 0 rgba(255,255,255,0.1); }\n      .pr-inspector-tab.active::after { content: ''; position: absolute; bottom: -1px; left: 50%; transform: translateX(-50%); width: 60%; height: 3px; background: linear-gradient(90deg, transparent, #38bdf8, transparent); border-radius: 999px; }\n      .pr-inspector-body { padding: 12px; overflow: auto; flex: 1; display: grid; }\n      .pr-inspector-pane { display: none; gap: 10px; }\n      .pr-inspector-pane.active { display: grid; gap: 10px; }\n      .pr-pane-card { border-radius: 12px; border: 1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.03); padding: 12px; transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1); }\n      .pr-pane-card:hover { border-color: rgba(100,181,246,0.15); background: rgba(255,255,255,0.05); box-shadow: 0 4px 16px rgba(100,181,246,0.1); }\n      .pr-pane-title { font-weight: 800; margin-bottom: 6px; color: #f8fafc; font-size: 15px; }\n      .pr-pane-placeholder { color: #9ca3af; font-size: 13px; }\n      .pr-overview { display: flex; flex-direction: column; gap: 12px; color: #e2e8f0; }\n      .pr-avatar-block { display: flex; gap: 12px; align-items: center; padding: 12px; border-radius: 12px; background: linear-gradient(135deg, rgba(100,181,246,0.05), rgba(139,92,246,0.03)); border: 1px solid rgba(100,181,246,0.15); transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1); }\n      .pr-avatar-block:hover { background: linear-gradient(135deg, rgba(100,181,246,0.08), rgba(139,92,246,0.05)); border-color: rgba(100,181,246,0.25); box-shadow: 0 4px 12px rgba(100,181,246,0.15); }\n      .pr-avatar-block-img { width: 50px; height: 50px; border-radius: 12px; background-size: cover; background-position: center; border: 1px solid rgba(255,255,255,0.08); }\n      .pr-avatar-block-fallback { width: 50px; height: 50px; border-radius: 12px; display: grid; place-items: center; font-weight: 800; color: #cbd5e1; background: rgba(148,163,184,0.12); border: 1px solid rgba(255,255,255,0.08); }\n      .pr-avatar-name { font-weight: 800; color: #f8fafc; }\n      .pr-avatar-id { font-size: 12px; color: #94a3b8; }\n      .pr-overview-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 8px; }\n      .pr-row { display: flex; justify-content: space-between; gap: 8px; padding: 10px 12px; border-radius: 10px; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.06); font-size: 13px; }\n      .pr-row span:first-child { color: #94a3b8; }\n      .pr-hint { color: #94a3af; font-size: 12px; }\n      .pr-section { display: flex; flex-direction: column; gap: 12px; }\n      .pr-section-head { font-weight: 800; color: #f8fafc; letter-spacing: 0.2px; display: flex; align-items: center; gap: 8px; }\n      .pr-card-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 10px; }\n      .pr-garden-plots { display: flex; gap: 20px; justify-content: center; align-items: flex-start; flex-wrap: wrap; }\n      .pr-garden-plot { display: flex; flex-direction: column; gap: 8px; }\n      .pr-garden-plot-label { font-weight: 700; color: #94a3b8; font-size: 13px; text-align: center; letter-spacing: 0.5px; }\n      .pr-garden-grid-10x10 { display: grid; grid-template-columns: repeat(10, 32px); grid-template-rows: repeat(10, 32px); gap: 2px; padding: 12px; background: rgba(15,23,42,0.5); border-radius: 8px; justify-content: center; max-width: fit-content; }\n      .pr-garden-tile { width: 32px; height: 32px; border: 1px solid rgba(255,255,255,0.1); border-radius: 4px; background: rgba(34,40,49,0.6); display: flex; align-items: center; justify-content: center; position: relative; cursor: help; transition: transform 0.15s ease, box-shadow 0.15s ease; }\n      .pr-garden-tile:hover { transform: scale(1.15); box-shadow: 0 4px 12px rgba(56,189,248,0.4); z-index: 10; }\n      .pr-garden-tile-empty { background: rgba(20,25,32,0.4); border-color: rgba(255,255,255,0.05); }\n      .pr-garden-tile-egg { border-color: rgba(255,179,0,0.3); }\n      .pr-garden-sprite { width: 100%; height: 100%; object-fit: contain; image-rendering: pixelated; }\n      .pr-garden-placeholder { font-size: 16px; opacity: 0.3; }\n      .pr-multi-icon { position: absolute; top: 0; right: 0; background: rgba(124,58,237,0.9); color: #fff; font-size: 9px; font-weight: 700; padding: 1px 3px; border-radius: 0 3px 0 4px; line-height: 1; }\n      .pr-boardwalk-section { display: flex; flex-direction: column; gap: 8px; align-items: center; }\n      .pr-boardwalk-grid-23x12 { display: grid; grid-template-columns: repeat(23, 20px); grid-template-rows: repeat(12, 20px); gap: 1px; padding: 8px; background: rgba(101, 67, 33, 0.2); border-radius: 8px; justify-content: center; border: 2px dashed rgba(139, 90, 43, 0.4); }\n      .pr-boardwalk-tile { width: 20px; height: 20px; background: linear-gradient(135deg, #654321, #8B5A2B); border: 1px solid rgba(139, 90, 43, 0.6); border-radius: 3px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: help; transition: transform 0.15s ease, box-shadow 0.15s ease; }\n      .pr-boardwalk-tile:hover { transform: scale(1.15); box-shadow: 0 4px 12px rgba(139, 90, 43, 0.6); z-index: 10; }\n      .pr-boardwalk-tile-empty { background: rgba(20,25,32,0.4); border-color: rgba(139, 90, 43, 0.2); }\n      .pr-pet-str { color: #a78bfa; font-size: 13px; font-weight: 700; }\n      .pr-journal-progress { display: flex; flex-direction: column; gap: 16px; }\n      .pr-journal-item { display: flex; flex-direction: column; gap: 8px; padding: 14px; border-radius: 12px; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08); transition: transform 0.2s ease, box-shadow 0.2s ease; }\n      .pr-journal-item:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.3); }\n      .pr-journal-header { display: flex; justify-content: space-between; font-size: 14px; color: #cbd5e1; font-weight: 600; }\n      .pr-journal-count { font-weight: 800; color: #7dd3fc; font-size: 15px; }\n      .pr-progress-pct { font-size: 12px; color: #94a3b8; text-align: right; margin-top: 4px; }\n      .pr-progress-bar { height: 12px; border-radius: 999px; background: rgba(0,0,0,0.3); overflow: hidden; border: 1px solid rgba(255,255,255,0.15); position: relative; box-shadow: inset 0 2px 4px rgba(0,0,0,0.3); }\n      .pr-progress-fill { height: 100%; transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1); position: relative; }\n      .pr-journal-tabs { display: flex; gap: 6px; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.08); }\n      .pr-journal-tab { padding: 8px 16px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.03); color: #cbd5e1; font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.2s ease; }\n      .pr-journal-tab:hover { background: rgba(100,181,246,0.1); color: #e0e7ff; border-color: rgba(100,181,246,0.3); }\n      .pr-journal-tab.active { background: linear-gradient(135deg, rgba(100,181,246,0.25), rgba(139,92,246,0.2)); border-color: rgba(100,181,246,0.5); color: #7dd3fc; box-shadow: 0 2px 8px rgba(100,181,246,0.3); }\n      .pr-journal-tab-content { display: flex; flex-direction: column; gap: 8px; padding: 12px 0; max-height: 300px; overflow-y: auto; overflow-x: hidden; }\n      .pr-journal-detail-row { display: flex; align-items: center; gap: 10px; padding: 12px 14px; border-radius: 8px; background: transparent; border: 1px solid rgba(255,255,255,0.08); transition: all 0.2s ease; min-width: 0; }\n      .pr-journal-detail-row:hover { background: rgba(100,181,246,0.08); border-color: rgba(100,181,246,0.3); transform: translateX(2px); }\n      .pr-journal-species { font-size: 12px; font-weight: 600; color: #e2e8f0; min-width: 100px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; flex: 1; }\n      .pr-journal-variants { font-size: 11px; color: #94a3b8; font-weight: 500; min-width: 120px; }\n      .pr-progress-bar-mini { height: 8px; border-radius: 999px; background: rgba(0,0,0,0.3); overflow: hidden; border: 1px solid rgba(255,255,255,0.1); flex: 1; }\n      .pr-progress-fill-mini { height: 100%; transition: width 0.4s ease; border-radius: 999px; }\n      .pr-stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 10px; }\n      .pr-stat-row { display: flex; justify-content: space-between; padding: 12px 14px; border-radius: 10px; background: linear-gradient(135deg, rgba(100,181,246,0.05), rgba(139,92,246,0.03)); border: 1px solid rgba(255,255,255,0.1); transition: all 0.2s ease; }\n      .pr-stat-row:hover { transform: translateX(4px); background: linear-gradient(135deg, rgba(100,181,246,0.1), rgba(139,92,246,0.05)); border-color: rgba(100,181,246,0.3); box-shadow: 0 4px 12px rgba(100,181,246,0.2); }\n      .pr-stat-label { color: #cbd5e1; font-size: 13px; font-weight: 500; }\n      .pr-stat-value { color: #7dd3fc; font-weight: 800; font-size: 14px; letter-spacing: 0.3px; }\n      \n      /* New vertical inventory cards - game style */\n      .pr-inv-card { position: relative; padding: 12px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.12); background: rgba(20,25,35,0.85); box-shadow: 0 4px 12px rgba(0,0,0,0.4); transition: all 0.2s ease; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 6px; min-width: 100px; }\n      .pr-inv-card:hover { transform: translateY(-3px); border-color: rgba(100,181,246,0.4); box-shadow: 0 6px 20px rgba(100,181,246,0.2); }\n      .pr-inv-card.pet-card { background: rgba(30,20,45,0.9); border-color: rgba(168,139,250,0.2); position: relative; min-width: 130px; }\n      .pr-inv-card.pet-card:hover { border-color: rgba(168,139,250,0.5); }\n      .pr-inv-abilities { position: absolute; left: 12px; top: 48px; transform: translateY(-50%); display: flex; flex-direction: column; gap: 3px; z-index: 2; pointer-events: none; }\n      .pr-inv-sprite-container { width: 64px; height: 64px; display: flex; align-items: center; justify-content: center; }\n      .pr-inv-sprite { width: 100%; height: 100%; object-fit: contain; image-rendering: pixelated; }\n      .pr-inv-placeholder { font-size: 32px; opacity: 0.4; }\n      .pr-inv-name { font-size: 13px; font-weight: 700; color: #e2e8f0; text-align: center; line-height: 1.2; max-width: 100%; word-wrap: break-word; }\n      .pr-inv-qty { font-size: 12px; font-weight: 700; color: #7dd3fc; background: rgba(56,189,248,0.15); padding: 3px 8px; border-radius: 6px; }\n      .pr-inv-str { font-size: 12px; font-weight: 700; color: #a78bfa; background: rgba(168,139,250,0.15); padding: 3px 8px; border-radius: 6px; }\n      .pr-ability-square { width: 14px; height: 14px; border-radius: 3px; box-shadow: 0 1px 4px rgba(0,0,0,0.5); cursor: help; flex-shrink: 0; }\n      .pr-card-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 10px; justify-items: center; }\n      .pr-badge-soft { padding: 6px 8px; border-radius: 10px; background: rgba(148,163,184,0.12); color: #cbd5e1; font-size: 11px; font-weight: 700; }\n      .pr-sprite-circle { width: 42px; height: 42px; border-radius: 12px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.08); display: grid; place-items: center; image-rendering: pixelated; background-size: contain; background-repeat: no-repeat; background-position: center; font-size: 18px; }\n      .pr-chip { display: inline-flex; align-items: center; gap: 6px; padding: 6px 10px; border-radius: 10px; background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.1); color: #cbd5e1; font-size: 12px; font-weight: 700; }\n      .pr-mut-badges { display: flex; gap: 6px; margin-top: 6px; flex-wrap: wrap; }\n      .pr-mut-badge { display: inline-flex; align-items: center; justify-content: center; font-size: 13px; font-weight: 700; letter-spacing: 0.5px; }\n      .pr-stack { display: flex; flex-direction: column; gap: 6px; }\n      .pr-progress { display: flex; flex-direction: column; gap: 6px; margin-top: 8px; }\n      .pr-progress-track { width: 100%; height: 8px; border-radius: 999px; background: rgba(255,255,255,0.06); overflow: hidden; border: 1px solid rgba(255,255,255,0.08); }\n      .pr-progress-fill { height: 100%; background: linear-gradient(90deg, #7c3aed, #38bdf8); border-radius: 999px; }\n      .pr-progress-label { font-size: 12px; color: #cbd5e1; }\n      .pr-pill-qty { padding: 6px 10px; border-radius: 10px; background: rgba(56,189,248,0.16); color: #7dd3fc; font-weight: 800; font-size: 12px; }\n      .pr-timeline { display: flex; flex-direction: column; gap: 10px; }\n      .pr-timeline-item { display: grid; grid-template-columns: auto auto 1fr auto; gap: 10px; align-items: center; padding: 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.08); background: linear-gradient(135deg, rgba(255,255,255,0.03), rgba(100,181,246,0.02)); transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1); }\n      .pr-timeline-item:hover { background: linear-gradient(135deg, rgba(100,181,246,0.08), rgba(139,92,246,0.05)); border-color: rgba(100,181,246,0.2); transform: translateX(4px); box-shadow: -4px 0 12px rgba(100,181,246,0.15); }\n      .pr-timeline-dot { width: 10px; height: 10px; border-radius: 50%; background: linear-gradient(135deg, #38bdf8, #a855f7); box-shadow: 0 0 8px rgba(56,189,248,0.7); }\n      .pr-timeline-main { display: flex; flex-direction: column; gap: 4px; min-width: 0; }\n      .pr-timeline-title { font-weight: 800; color: #f8fafc; }\n      .pr-timeline-detail { color: #cbd5e1; font-size: 12px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }\n      .pr-time-badge { padding: 6px 10px; border-radius: 999px; background: rgba(148,163,184,0.14); color: #cbd5e1; font-size: 12px; font-weight: 700; }\n      .pr-inspector-footer { padding: 10px 12px; border-top: 1px solid rgba(255,255,255,0.05); color: #94a3b8; font-size: 11px; letter-spacing: 0.2px; }\n      .pr-avatar:hover { transform: scale(1.14); box-shadow: 0 0 0 2px rgba(100,181,246,0.45); }\n      \n      /* Custom scrollbar styling */\n      .pr-inspector-body::-webkit-scrollbar { width: 10px; }\n      .pr-inspector-body::-webkit-scrollbar-track { background: rgba(15,23,42,0.5); border-radius: 10px; margin: 4px; }\n      .pr-inspector-body::-webkit-scrollbar-thumb { background: linear-gradient(180deg, rgba(100,181,246,0.4), rgba(139,92,246,0.3)); border-radius: 10px; border: 2px solid rgba(15,23,42,0.5); }\n      .pr-inspector-body::-webkit-scrollbar-thumb:hover { background: linear-gradient(180deg, rgba(100,181,246,0.6), rgba(139,92,246,0.5)); }\n    ",document.head.appendChild(e)}const t=function(){const e=document.createElement("div");return e.id="pr-app",e.innerHTML='\n    <div class="pr-hero">\n      <div>\n        <div style="font-size: 12px; letter-spacing: 0.3px; color: #94a3b8; text-transform: uppercase; font-weight: 700;">Live Directory</div>\n        <h3 style="display: flex; align-items: center; gap: 8px;">\n          üåê Public Rooms\n        </h3>\n        <p>Discover active rooms and who is inside. Data via Aries API.</p>\n        <div class="pr-hero-badges">\n          <span class="pr-badge pr-badge-ghost">Powered by Aries</span>\n          <span id="pr-connection-status" class="pr-badge pr-badge-status pr-status-connecting">üîÑ Connecting...</span>\n        </div>\n      </div>\n      <div style="display: flex; gap: 8px; align-items: center;">\n        <button id="pr-refresh-btn" class="qpm-button qpm-button--positive" style="padding: 10px 16px; font-weight: 700;">üîÑ Refresh</button>\n      </div>\n    </div>\n\n    <div class="pr-stats">\n      <div class="pr-stat">\n        <div class="pr-stat-label">Rooms</div>\n        <div id="pr-total-rooms-pill" class="pr-stat-value">Rooms: --</div>\n      </div>\n      <div class="pr-stat">\n        <div class="pr-stat-label">Visible</div>\n        <div id="pr-visible-rooms-pill" class="pr-stat-value">Showing: --</div>\n      </div>\n      <div class="pr-stat">\n        <div class="pr-stat-label">Last Update</div>\n        <div id="pr-last-updated-pill" class="pr-stat-value">Updated: --</div>\n      </div>\n    </div>\n\n    <div class="pr-controls">\n      <div class="pr-control">\n        <label>üîé Search rooms or players</label>\n        <input type="text" id="pr-search-input" placeholder="Search by room code or player name..." />\n      </div>\n      <div class="pr-control">\n        <label>üë• Player count</label>\n        <select id="pr-player-filter">\n          <option value="all">All Rooms</option>\n          <option value="low">Few (1-2)</option>\n          <option value="medium">Some (3-4)</option>\n          <option value="high">Many (5-6)</option>\n        </select>\n      </div>\n      <div class="pr-control">\n        <label>üìä Sort by</label>\n        <select id="pr-sort-by">\n          <option value="name">Room Code</option>\n          <option value="players-desc" selected>Most Players</option>\n          <option value="players-asc">Least Players</option>\n        </select>\n      </div>\n    </div>\n\n    <div style="margin-top: 18px; display: flex; align-items: center; gap: 10px; color: #cbd5e1; font-weight: 700; letter-spacing: 0.2px;">\n      <span style="font-size: 18px;">üéÆ</span> <span>Available Rooms</span>\n    </div>\n    <div id="pr-rooms-list" class="pr-grid">\n      <p style="text-align: center; color: #aaa; grid-column: 1/-1; font-size: 14px;">Loading rooms...</p>\n    </div>\n  ',e}();e.appendChild(t);const n=document.getElementById("pr-search-input"),o=document.getElementById("pr-player-filter"),r=document.getElementById("pr-sort-by"),i=document.getElementById("pr-refresh-btn");if(n){let e=null;const t=e=>{e.stopPropagation(),"function"==typeof e.stopImmediatePropagation&&e.stopImmediatePropagation()};["keydown","keyup","keypress"].forEach(e=>n.addEventListener(e,t,!0)),n.addEventListener("input",t=>{e&&window.clearTimeout(e),e=window.setTimeout(()=>{oh(t.target.value)},200)})}var a;o?.addEventListener("change",e=>{var t;t=e.target.value,Wf.currentPlayerFilter=t,Uf=Zf(Wf.allRooms),Qf?.({...Uf})}),r?.addEventListener("change",e=>{var t;t=e.target.value,Wf.currentSortBy=t,Uf=Zf(Wf.allRooms),Qf?.({...Uf})}),i?.addEventListener("click",()=>{nh(),gy("Refreshing rooms...","info")}),Qf=a=Ny,a({...Uf}),function(e){Kf=e,e(Wf.connectionStatus)}(Dy),function(e){Jf=e}(By),th().catch(e=>{gy("Unable to initialize Public Rooms","error"),console.error("[PublicRooms] init failed",e)}),window.QPM_INSPECT_PLAYER||(window.QPM_INSPECT_PLAYER=(e,t)=>uy(e,t))},setupGardenInspector:ay},Symbol.toStringTag,{value:"Module"}));function jy(){s("‚úÖ Testing all sprites...");const e=["Worm","Snail","Bee","Chicken","Bunny","Dragonfly","Pig","Cow","Turkey","Squirrel","Turtle","Goat","Butterfly","Peacock","Capybara"],t=["rainbow","gold"];let n=0,o=0;const r=[];s("Testing pet sprites...");for(const s of e)try{ta.getPetSprite(s)?n++:(o++,r.push(`Pet: ${s} (returned null)`))}catch(a){o++,r.push(`Pet: ${s} (${a})`)}s("Testing crop sprites...");const i=ua();for(const s of i){try{ta.getCropSprite(s.toLowerCase())?n++:(o++,r.push(`Crop: ${s} (returned null)`))}catch(a){o++,r.push(`Crop: ${s} (${a})`)}for(const e of t)try{ta.getCropSprite(s.toLowerCase())?n++:(o++,r.push(`Crop: ${s} + ${e} (base sprite returned null)`))}catch(a){o++,r.push(`Crop: ${s} + ${e} (${a})`)}}s(`‚úÖ Sprite Test Complete: ${n} passed, ${o} failed`),r.length>0&&s("‚ö†Ô∏è Failed sprites:",r),s("‚ÑπÔ∏è Cache stats unavailable (canvas-first sprite path uses PIXI internal cache)")}function _y(){s("üöÄ Running performance benchmark...");const e=1e3,t=performance.now();for(let i=0;i<e;i++)ta.getPetSprite("Butterfly");const n=performance.now()-t,o=n/e,r=(e/(n/1e3)).toFixed(0);s("üìä Benchmark Results (1000 iterations):"),s(`   Total time: ${n.toFixed(2)}ms`),s(`   Average time per sprite: ${o.toFixed(3)}ms`),s(`   Operations per second: ${r}`)}function Oy(){s("üîé Validating species name mappings...");const e=[{input:"OrangeTulip",expected:"Tulip"},{input:"WhiteTulip",expected:"Tulip"},{input:"DawnCelestial",expected:"Dawnbinder"},{input:"MoonCelestial",expected:"Moonbinder"},{input:"Starweaver",expected:"Starweaver"},{input:"MythicalEgg",expected:"Mythical"},{input:"Butterfly",expected:"Butterfly"},{input:"Sunflower",expected:"Sunflower"}];let t=0,n=0;for(const o of e){const e=o.input.replace(/^(Orange|White|Pink|Red|Purple)Tulip$/i,"Tulip").replace(/^DawnCelestial$/i,"Dawnbinder").replace(/^MoonCelestial$/i,"Moonbinder").replace(/^MythicalEgg$/i,"Mythical");e===o.expected?(t++,s(`‚úÖ ${o.input} ‚Üí ${e}`)):(n++,s(`‚ö†Ô∏è ${o.input} ‚Üí ${e} (expected ${o.expected})`))}s(`\nüìã Validation Complete: ${t} passed, ${n} failed`)}const Gy={storage:g,debugPets:()=>{const e=Ar();return console.log("=== Active Pets Debug (v2024-11-13-DOM-STRENGTH) ==="),console.table(e.map(e=>({Slot:e.slotIndex,Name:e.name||e.species,Species:e.species,Level:e.level,Strength:e.strength,TargetScale:e.targetScale,Abilities:e.abilities.join(", "),Hunger:e.hungerPct?`${e.hungerPct.toFixed(1)}%`:"N/A"}))),console.log("Full normalized data:",e),console.log("\n=== Raw Data Inspection ==="),e.forEach((e,t)=>{if(console.log(`\nPet ${t} (${e.name}):`),console.log("Raw object:",e.raw),e.raw&&"object"==typeof e.raw){const t=e.raw;console.log("Available fields:",Object.keys(t)),t.slot&&"object"==typeof t.slot&&(console.log("slot fields:",Object.keys(t.slot)),console.log("slot.xp:",t.slot.xp)),t.pet&&"object"==typeof t.pet&&console.log("pet fields:",Object.keys(t.pet))}}),e},debugAllAtoms:()=>{try{const e=window.__qpmJotaiAtomCache__;if(!e||"function"!=typeof e.entries)return console.error("Jotai atom cache not available"),null;console.log("=== All Available Atoms ===");const t=[];for(const[o,r]of e.entries())if(r&&"object"==typeof r&&"debugLabel"in r){const n=r.debugLabel;"string"==typeof n&&t.push({label:n,hasValue:e.has(o)})}console.table(t),console.log("\n=== Pet-related Atoms ===");const n=t.filter(e=>e.label.toLowerCase().includes("pet"));return console.table(n),t}catch(e){return console.error("Failed to list atoms:",e),null}},showPetSpriteGrid:(e="pets",t=80)=>{console.warn("[Sprite Compat] renderSpriteGridOverlay is deprecated in sprite-v2")},showAllSpriteSheets:(e=120)=>{console.warn("[Sprite Compat] renderAllSpriteSheetsOverlay is deprecated in sprite-v2")},listSpriteResources:(e="all")=>(console.warn("[Sprite Compat] listTrackedSpriteResources is deprecated in sprite-v2"),[]),loadTrackedSpriteSheets:(e=8,t="all")=>(console.warn("[Sprite Compat] loadTrackedSpriteSheets is deprecated in sprite-v2"),Promise.resolve([])),spriteExtractor:ta,viewAllSprites:()=>{console.log("=== Exporting all sprite tiles ===");const e=document.createElement("div");e.style.cssText="\n      position: fixed;\n      top: 50px;\n      right: 50px;\n      background: rgba(0,0,0,0.9);\n      padding: 20px;\n      max-width: 800px;\n      max-height: 80vh;\n      overflow: auto;\n      z-index: 999999;\n      display: grid;\n      grid-template-columns: repeat(10, 1fr);\n      gap: 5px;\n    ";for(let n=0;n<60;n++){const t=ta.getTile("plants",n);if(t){const o=document.createElement("div");o.style.cssText="position: relative; text-align: center;";const r=document.createElement("div");r.textContent=`${n}`,r.style.cssText="font-size: 10px; color: #fff; background: rgba(0,0,0,0.7); padding: 2px;";const i=new Image;i.src=t.toDataURL(),i.style.cssText="width: 64px; height: 64px; image-rendering: pixelated; border: 1px solid #444;",i.title=`Tile ${n}`,o.appendChild(r),o.appendChild(i),e.appendChild(o)}}const t=document.createElement("button");t.textContent="Close",t.style.cssText="position: sticky; top: 0; left: 0; z-index: 1; grid-column: 1 / -1;",t.onclick=()=>e.remove(),e.insertBefore(t,e.firstChild),document.body.appendChild(e),console.log("Sprite viewer opened. Click tiles to see index.")},checkTargetScale:()=>{const e=Ar();return console.log("=== TargetScale Analysis ==="),console.log("Checking if targetScale might be strength-related...\n"),e.forEach((e,t)=>{const n=e.targetScale??0,o=e.xp??0,r=Math.round(50*n),i=Math.round(100*(n-1)),a=Math.round(45*n+5);console.log(`Pet ${t}: ${e.name}`),console.log(`  XP: ${o}`),console.log(`  TargetScale: ${n.toFixed(6)}`),console.log(`  Possible STR (√ó50): ${r}`),console.log(`  Possible STR ((x-1)√ó100): ${i}`),console.log(`  Possible STR (√ó45+5): ${a}\n`)}),e},debugSlotInfos:()=>{try{const e=window.__qpmJotaiAtomCache__,t=window.__qpmJotaiStore__;if(!e||!t)return console.error("Jotai cache/store not available"),null;console.log("=== myPetSlotInfosAtom Data ===");let n=null;for(const[r,i]of e.entries())if(i&&"object"==typeof i&&"debugLabel"in i){if("myPetSlotInfosAtom"===i.debugLabel){n=r;break}}if(!n)return console.error("myPetSlotInfosAtom not found in cache"),null;const o=t.get(n);return console.log("Raw value:",o),Array.isArray(o)&&(console.log(`\nFound ${o.length} entries:\n`),o.forEach((e,t)=>{console.log(`Entry ${t}:`,e),e&&"object"==typeof e&&(console.log("  Fields:",Object.keys(e)),"slot"in e&&e.slot&&"object"==typeof e.slot&&console.log("  slot fields:",Object.keys(e.slot)),"pet"in e&&e.pet&&"object"==typeof e.pet&&console.log("  pet fields:",Object.keys(e.pet)),"stats"in e&&e.stats&&"object"==typeof e.stats&&(console.log("  stats fields:",Object.keys(e.stats)),console.log("  stats content:",e.stats)))})),o}catch(e){return console.error("Failed to inspect myPetSlotInfosAtom:",e),null}},debugPetInventory:()=>{try{const t=window.__qpmJotaiAtomCache__,n=window.__qpmJotaiStore__;if(!t||!n)return console.error("Jotai cache/store not available"),null;console.log("=== Pet Inventory & Hutch Atoms ===\n");const o=["myPetInventoryAtom","myPetHutchPetItemsAtom","myPrimitivePetSlotsAtom","petInfosAtom"],r={};for(const i of o){console.log(`\n--- ${i} ---`);let o=null;for(const[e,n]of t.entries())if(n&&"object"==typeof n&&"debugLabel"in n){if(n.debugLabel===i){o=e;break}}if(o)try{const e=n.get(o);if(r[i]=e,console.log("Value:",e),Array.isArray(e)&&e.length>0){const t=e[0];t&&"object"==typeof t&&(console.log("First entry fields:",Object.keys(t)),"pet"in t&&t.pet&&"object"==typeof t.pet&&(console.log("  pet fields:",Object.keys(t.pet)),console.log("  pet sample:",t.pet)),"stats"in t&&t.stats&&"object"==typeof t.stats&&(console.log("  stats fields:",Object.keys(t.stats)),console.log("  stats sample:",t.stats)),"slot"in t&&t.slot&&"object"==typeof t.slot&&console.log("  slot fields:",Object.keys(t.slot)))}}catch(e){console.error(`Error reading ${i}:`,e)}else console.log(`${i} not found`)}return r}catch(e){return console.error("Failed to inspect pet atoms:",e),null}},searchPageWindow:()=>{try{const e=window.unsafeWindow||window;console.log("=== Searching Page Window for Pet Data ===\n");const t=["myData","myPets","activePets","petData","pets","UnifiedState","gameState","quinoaData"],n={};for(const r of t)if(r in e){console.log(`\nFound: ${r}`);const t=e[r];if(console.log("Type:",typeof t),t&&"object"==typeof t&&(console.log("Keys:",Object.keys(t).slice(0,20)),n[r]=t,"pets"in t&&console.log("  ‚Üí has pets property:",t.pets),"activePets"in t&&console.log("  ‚Üí has activePets property:",t.activePets),"inventory"in t&&t.inventory)){console.log("  ‚Üí has inventory property");const e=t.inventory;if(e&&"object"==typeof e&&"items"in e){const t=e.items;if(Array.isArray(t)){console.log(`  ‚Üí inventory has ${t.length} items`);const e=t.filter(e=>e&&"object"==typeof e&&("Pet"===e.itemType||"Pet"===e.type||"petSpecies"in e||"species"in e));e.length>0&&(console.log(`  ‚Üí Found ${e.length} pet items in inventory`),console.log("  ‚Üí First pet item:",e[0]),console.log("  ‚Üí First pet fields:",Object.keys(e[0])))}}}}console.log("\n=== Searching all window properties ===");const o=Object.keys(e).filter(e=>e.toLowerCase().includes("pet")||e.toLowerCase().includes("animal")||e.toLowerCase().includes("creature"));return console.log("Pet-related keys:",o),n}catch(e){return console.error("Failed to search page window:",e),null}},inspectPetCards:()=>{try{console.log("=== Inspecting Pet Card UI Elements ===\n");const e=["[data-pet-slot]","[data-pet-id]","[data-slot-index]",".pet-card",".pet-slot",'[class*="pet"]','[class*="Pet"]'],t=[];for(const n of e){const e=document.querySelectorAll(n);e.length>0&&(console.log(`Found ${e.length} elements with selector: ${n}`),e.forEach(e=>{e instanceof HTMLElement&&!t.includes(e)&&t.push(e)}))}return console.log(`\nTotal unique pet card elements found: ${t.length}\n`),t.slice(0,10).forEach((e,t)=>{console.log(`\n--- Element ${t} ---`),console.log("Tag:",e.tagName),console.log("Classes:",e.className),console.log("Text content:",e.textContent?.substring(0,200)),console.log("Data attributes:",Object.keys(e.dataset));const n=e.textContent||"",o=n.match(/(?:level|lvl|lv)[:\s]*(\d+)/i),r=n.match(/(?:str|strength)[:\s]*(\d+)/i),i=n.match(/(?:age)[:\s]*(\d+)/i);o&&console.log("  ‚Üí Found level:",o[1]),r&&console.log("  ‚Üí Found strength:",r[1]),i&&console.log("  ‚Üí Found age:",i[1])}),t}catch(e){return console.error("Failed to inspect pet cards:",e),null}},findPetDataInDOM:()=>{try{console.log("=== Searching DOM for Pet Level/Strength Data ===\n");const e=Ar().map(e=>e.name).filter(Boolean);console.log("Looking for pets:",e);const t=document.querySelectorAll("*"),n=[];for(const o of t){const t=o.textContent?.toLowerCase()||"";if(!(t.length>500)){for(const r of e)if(r&&t.includes(r.toLowerCase())){n.push({el:o,reason:`Contains pet name: ${r}`});break}/\b(age|level|lvl|lv|str|strength|max str)\b/i.test(t)&&n.push({el:o,reason:"Contains level/strength keywords"})}}return console.log(`\nFound ${n.length} potentially relevant elements\n`),n.slice(0,15).forEach(({el:e,reason:t},n)=>{console.log(`\n--- Element ${n} ---`),console.log("Reason:",t),console.log("Tag:",e.tagName),console.log("Classes:",e.className),console.log("Text (first 300 chars):",e.textContent?.substring(0,300));const o=e.textContent||"",r=o.match(/age[:\s]*(\d+)/i),i=o.match(/(?:max\s+)?str[:\s]*(\d+)/i),a=o.match(/(?:level|lvl|lv)[:\s]*(\d+)/i);r&&console.log("  ‚úì Age:",r[1]),i&&console.log("  ‚úì Strength:",i[1]),a&&console.log("  ‚úì Level:",a[1])}),n}catch(e){return console.error("Failed to search DOM:",e),null}},extractStrengthFromUI:()=>{try{console.log("=== Extracting Strength from Pet Card UI ===\n");const e=Ar(),t=[],n=Array.from(document.querySelectorAll("*"));for(const o of e){const e=o.name||o.species||`Pet ${o.slotIndex}`;let r=null,i=null;for(const t of n){const e=t.textContent||"";if(e.length>100)continue;const n=e.match(/\bSTR\s+(\d+)\b/i);if(n&&n[1]){const o=parseInt(n[1],10);console.log(`Found STR ${o} in element:`,t),console.log("  Tag:",t.tagName),console.log("  Classes:",t.className),console.log("  Text:",e.trim()),console.log("  Parent:",t.parentElement?.className),r||(r=o,i=t)}}t.push({pet:e,strength:r,element:i})}return console.log("\n=== Extracted Strength Values ==="),console.table(t.map(e=>({Pet:e.pet,Strength:e.strength??"Not found"}))),t}catch(e){return console.error("Failed to extract strength from UI:",e),null}},debugLevels:()=>{try{console.log("=== Pet Level Calculation Debug ===\n");const e=Ar();return e.forEach((e,t)=>{if(console.log(`\n--- Pet ${t}: ${e.name} (${e.species}) ---`),console.log(`XP: ${e.xp??"N/A"}`),console.log(`Strength: ${e.strength??"N/A"}`),console.log(`Level (Jotai): ${e.level??"null"}`),e.petId){const t=(n=e.petId,or.get(n)??[]);if(console.log(`XP History: ${t.length} samples`),t.length>=2){const e=t[0],n=t[t.length-1],o=n.xp-e.xp,r=(n.timestamp-e.timestamp)/1e3,i=o/r;console.log(`  First sample: ${e.xp} XP at ${new Date(e.timestamp).toLocaleTimeString()}`),console.log(`  Last sample: ${n.xp} XP at ${new Date(n.timestamp).toLocaleTimeString()}`),console.log(`  XP gained: ${o.toFixed(0)} over ${r.toFixed(0)}s`),console.log(`  XP rate: ${i.toFixed(2)} XP/sec`)}const o=ir(e);if(console.log("\nLevel Estimate:"),console.log(`  Current Level: ${o.currentLevel??"N/A"} / ${o.maxLevel}`),console.log(`  Confidence: ${o.confidence}`),console.log(`  Total XP Needed: ${o.totalXPNeeded?.toFixed(0)??"N/A"}`),console.log(`  XP Rate: ${o.xpGainRate?.toFixed(2)??"N/A"} XP/sec`),o.totalXPNeeded&&e.xp){const t=e.xp/o.totalXPNeeded*100;console.log(`  Progress: ${t.toFixed(1)}%`)}}var n}),e}catch(e){return console.error("Failed to debug levels:",e),null}},feedPet:async e=>{console.log(`üçñ Feeding pet at index ${e}...`);const t=await Af(e);return t.success?console.log(`‚úÖ Successfully fed ${t.petName||t.petSpecies} with ${t.foodSpecies}`):console.error(`‚ùå Failed to feed pet: ${t.error}`),t},feedPetByIds:async(e,t)=>{console.log(`üçñ Feeding pet ${e} with crop ${t}...`);const n=await async function(e,t){try{const n=Er().find(t=>t.petId===e);return kf(e,t)?(s(`‚úÖ Fed pet ${e} with crop ${t}`),sf(1),{success:!0,petName:n?.name??null,petSpecies:n?.species??null,foodSpecies:null}):{success:!1,petName:n?.name??null,petSpecies:n?.species??null,foodSpecies:null,error:"Failed to send WebSocket message"}}catch(n){return s("‚ùå Feed by IDs error",n),{success:!1,petName:null,petSpecies:null,foodSpecies:null,error:n instanceof Error?n.message:"Unknown error"}}}(e,t);return n.success?console.log("‚úÖ Successfully fed pet"):console.error(`‚ùå Failed to feed pet: ${n.error}`),n},feedAllPets:async(e=40)=>{console.log(`üçñ Feeding all pets below ${e}% hunger...`);const t=await async function(e=40,t=!1){const n=Er(),o=[];for(let r=0;r<n.length;r++){const i=n[r];if(!i)continue;const a=i.hungerPct??100;if(a>=e){s(`‚è≠Ô∏è Skipping ${i.name||i.species} - hunger ${a}% >= ${e}%`);continue}s(`üçñ Feeding ${i.name||i.species} - hunger ${a}%`);const l=await Af(r,t);o.push(l),r<n.length-1&&await new Promise(e=>setTimeout(e,500))}return o}(e),n=t.filter(e=>e.success).length,o=t.filter(e=>!e.success).length;return console.log(`‚úÖ Fed ${n} pets, ${o} failed`),t},isInstantFeedAvailable:()=>{const e=null!==Sf();return console.log(e?"‚úÖ Instant feed is available":"‚ùå Instant feed is NOT available (RoomConnection missing)"),e},debugInventory:async()=>{try{const{getAtomByLabel:e,readAtomValue:t}=await Promise.resolve().then(()=>X);console.log("=== Inventory Debug ===\n");const n=e("userSlotsAtom");if(n){const e=await t(n);console.log("userSlotsAtom inventory:",e);const o=Array.isArray(e)?e.filter(e=>"Plant"===e.itemType||e.slots&&e.slots.length>0):[];return console.log(`\nFound ${o?.length||0} plant items:`),console.table(o?.map((e,t)=>({Index:t,Species:e.species||"N/A",Name:e.name||"N/A",ItemType:e.itemType,HasSlots:!!(e.slots&&e.slots.length>0),NumSlots:e.slots?.length||0,Keys:Object.keys(e).join(", ")}))),o&&o.length>0&&(console.log("\n=== First Plant Item (Full Structure) ==="),console.log(o[0]),o[0].slots&&(console.log("\n=== Slots Detail ==="),console.log(o[0].slots))),{userSlots:e,plantItems:o}}return console.error("‚ùå userSlotsAtom not found"),null}catch(e){return console.error("Failed to debug inventory:",e),null}},testPetData:_b,testComparePets:Ob,testAbilityDefinitions:Gb,debugAriesIntegration:()=>{console.log("=== Aries Mod Integration Debug ===\n");const e=[{name:"window.PetsService",value:window.PetsService},{name:"window.QWS",value:window.QWS},{name:"window.QWS?.PetsService",value:window.QWS?.PetsService},{name:"unsafeWindow.PetsService",value:"undefined"!=typeof unsafeWindow?unsafeWindow.PetsService:void 0},{name:"unsafeWindow.QWS",value:"undefined"!=typeof unsafeWindow?unsafeWindow.QWS:void 0}];console.log("Checking for PetsService in various locations:\n"),e.forEach(e=>{if(void 0!==e.value){if(console.log(`‚úÖ ${e.name}:`,e.value),e.value&&"object"==typeof e.value&&(console.log("   Properties:",Object.keys(e.value)),"function"==typeof e.value.getTeams))try{const t=e.value.getTeams();console.log(`   Teams (${Array.isArray(t)?t.length:"N/A"}):`,t)}catch(t){console.log("   Error calling getTeams():",t)}}else console.log(`‚ùå ${e.name}: Not found`)}),console.log("\n=== Instructions ==="),console.log("If PetsService is not detected:"),console.log("1. Make sure Aries mod is installed and running"),console.log("2. Check that both scripts are loaded (QPM and Aries)"),console.log("3. Try reloading the page"),console.log('4. Check console for "[Aries]" prefixed logs from QPM'),console.log("\nIf you see PetsService but it's not working:"),console.log('‚Ä¢ Open Pet Hub (QPM menu) and go to "3v3 Compare" tab'),console.log('‚Ä¢ Click the "üîÑ Refresh" button in the Aries section'),console.log("‚Ä¢ Check console for detection logs")},toggleBadgePreview:async e=>{try{const{toggleBadgePreview:t}=await Promise.resolve().then(()=>Fv),n=t(e);return s(`QPM badge preview ${n?"enabled":"disabled"}${void 0===e?"":` (forced ${e})`}`),n}catch(t){return console.error("Failed to toggle badge preview",t),null}},debugInventoryAtoms:async(e=["myInventoryAtom","myCropInventoryAtom","seedInventoryAtom"])=>{const t=window.__qpmJotaiAtomCache__,n=window.__qpmJotaiStore__;console.log("Atom cache present:",!!t,"Store present:",!!n);const o=[];e.forEach(e=>{const n=V(e);if(n){const r=!!t?.has?.(n);o.push({label:e,hasValue:r})}}),console.table(o);for(const i of e){const e=V(i);if(e)try{const t=await W(e);console.log(`Value for ${i}:`,t)}catch(r){console.error(`Failed reading ${i}`,r)}}return o},scanSeeds:async()=>{const e=await zs(),t=Is(),n=e=>{const t=e?.raw??{},n=[e.quantity,e.count,e.amount,e.stackSize,e.qty,e.owned,e.quantityOwned,t.quantity,t.count,t.amount,t.stackSize,t.qty,t.owned,t.quantityOwned];for(const o of n){const e=Number(o);if(Number.isFinite(e)&&e>0)return e}return null},o=e=>{const t=e?.raw??{};if([e.itemType,e.name,e.displayName,e.id,e.species,t.itemType,t.type,t.category,t.subType,t.itemCategory,t.itemSubType,t.kind].some(e=>`${e??""}`.toLowerCase().includes("seed")))return!0;const n=[t.tags,t.tagList,t.itemTags,t.labels];for(const o of n)if(Array.isArray(o)&&o.some(e=>`${e??""}`.toLowerCase().includes("seed")))return!0;return!0===t.isSeed},r=e=>{const t=[];let r=0;for(const i of e){if(!o(i))continue;const e=n(i);if(!Number.isFinite(e)||e<=0)continue;const a=String(i.id??i.itemId??i.species??i.name??"unknown");t.push({id:a,qty:e,name:i.displayName??i.name??null}),r=Math.max(r,e)}return t.sort((e,t)=>t.qty-e.qty),{max:r,seeds:t}},i=r(e?.items??[]),a=r(t);return console.log("Seed scan (direct atom read): max",i.max,i.seeds.slice(0,10)),console.log("Seed scan (cached store): max",a.max,a.seeds.slice(0,10)),{directScan:i,cachedScan:a}},auditRainbowPets:async()=>{const e=async e=>{const t=V(e);if(!t)return null;try{const e=await W(t);if(Array.isArray(e))return e;if(e&&Array.isArray(e.items))return e.items}catch(n){console.error(`Failed to read ${e}`,n)}return null},t=["myPetInventoryAtom","myPetHutchPetItemsAtom"],n={},o=e=>{const t=e?.raw??{};return!![e.rarity,e.petRarity,e.rarityName,e.quality,e.variant,e.mutation,e.name,e.petVariant,t.rarity,t.petRarity,t.rarityName,t.quality,t.variant,t.mutation,t.name].some(e=>`${e??""}`.toLowerCase().includes("rainbow"))||(!0===e.isRainbow||!0===t.isRainbow)};for(const r of t){const t=await e(r);if(!t)continue;const i=[];t.forEach((e,t)=>{const n=e?.raw??{};o(e)&&i.push({id:String(e.id??e.itemId??`idx-${t}`),targetScale:Number(e.targetScale??n.targetScale??null)||null,fields:[e.rarity,e.petRarity,e.rarityName,e.quality,e.variant,e.mutation,e.name,e.petVariant,n.rarity,n.petRarity,n.rarityName,n.quality,n.variant,n.mutation,n.name]})}),n[r]=i,console.log(`Rainbow hits for ${r}:`,i)}return n},openPetHub3v3:async()=>{try{const e=document.querySelector('button[data-window-id="pet-hub"]');if(e)return e.click(),setTimeout(()=>{const e=Array.from(document.querySelectorAll("button")).find(e=>e.textContent?.includes("3v3 Compare"));e?.click()},300),!0;return lc("pet-hub","üêæ Pet Hub",e=>Promise.resolve().then(()=>Ww).then(({renderPetHubWindow:t})=>t(e)),"1600px","92vh"),setTimeout(()=>{const e=Array.from(document.querySelectorAll("button")).find(e=>e.textContent?.includes("3v3 Compare"));e?.click()},400),!0}catch(e){return console.error("Failed to open Pet Hub 3v3",e),!1}},resetTutorial:async()=>{const{resetTutorial:e}=await Promise.resolve().then(()=>EC);e(),console.log("Tutorial reset. Reload the page to see it again.")},showTutorial:async()=>{const{showTutorialPopup:e}=await Promise.resolve().then(()=>EC);e()}};!function(){const e=e=>{const t=(e||"").trim();if(t)try{localStorage.setItem("quinoa:selfPlayerId",t),Zb(),console.log("[QPM Inspector] self playerId set to",t,"friend cache cleared.")}catch(n){console.warn("[QPM Inspector] Unable to persist self playerId",n)}else console.warn("[QPM Inspector] Provide a playerId string.")};window.QPM_INSPECT_FRIEND||(window.QPM_INSPECT_FRIEND=e);try{P("QPM_INSPECT_FRIEND",e)}catch(t){console.warn("[QPM Inspector] Failed to share helper globally",t)}}(),function(){const e=(e,t)=>{const n=(e||"").trim();n?uy(n,t||n):console.warn("[PublicRooms] Provide a playerId string.")};window.QPM_INSPECT_PLAYER||(window.QPM_INSPECT_PLAYER=e);try{P("QPM_INSPECT_PLAYER",e)}catch(t){console.warn("[PublicRooms] Failed to share QPM_INSPECT_PLAYER globally",t)}}(),P("QPM",Gy),P("QPM_DEBUG_API",Gy);const Vy="undefined"!=typeof unsafeWindow?unsafeWindow:window;Vy.QPM_DEBUG_API=Gy,Vy.QPM=Gy,s("‚úÖ QPM debug API registered");const Wy={enabled:!1,threshold:40,pollMs:3e3,clickCooldownMs:4e3,retryDelaySeconds:15,logs:!0,ui:{preventScrollClicks:!0},inventoryLocker:{syncMode:!0},mutationReminder:{enabled:!0,showNotifications:!0,highlightPlants:!0},harvestReminder:{enabled:!1,highlightEnabled:!0,toastEnabled:!0,minSize:80,selectedMutations:{Rainbow:!0,Gold:!1,Frozen:!1,Wet:!1,Chilled:!1,Dawnlit:!1,Amberlit:!1,Amberbound:!1,Dawnbound:!1}},turtleTimer:{enabled:!0,includeBoardwalk:!1,minActiveHungerPct:2,fallbackTargetScale:1.5,focus:"latest"}};const Uy=function(){try{return JSON.parse(localStorage.getItem("quinoa-pet-manager")||"{}")}catch{return{}}}(),Xy={...Wy,...Uy,ui:{...Wy.ui,...Uy.ui||{}},inventoryLocker:{...Wy.inventoryLocker,...Uy.inventoryLocker||{}},mutationReminder:{...Wy.mutationReminder,...Uy.mutationReminder||{}},harvestReminder:{...Wy.harvestReminder,...Uy.harvestReminder||{},selectedMutations:{...Wy.harvestReminder.selectedMutations,...Uy.harvestReminder?.selectedMutations||{}}},turtleTimer:{...Wy.turtleTimer,...Uy.turtleTimer||{}}};function Qy(e,t,n){return.4*e+(t<=2?30:t<=4?20:10)+("easy"===n?30:"medium"===n?20:"hard"===n?10:"very-hard"===n?5:0)}function Jy(e,t,n,o,r){const i=(o-n.length)/o*100,a=function(e,t,n,o){if(0===e.length)return"easy";const r=e.map(e=>function(e,t,n,o){return"Normal"===e?"easy":"Max Weight"===e||"Max"===e?"pet"===n?"very-hard":"hard":"Rainbow"===e?"pet"===n?"very-hard":o.hasRainbowGranter?"medium":"very-hard":"Gold"===e?"pet"===n?"hard":o.hasGoldGranter?"medium":"very-hard":"Wet"===e||"Chilled"===e?"easy":"Frozen"===e?"medium":"Dawnlit"===e||"Ambershine"===e?o.hasRainbowGranter?"hard":"medium":"Amberlit"===e?o.hasRainbowGranter?"very-hard":"hard":"Dawncharged"===e?o.hasDawnbinder?"hard":"impossible":"Ambercharged"===e?o.hasMoonbinder?"hard":"impossible":"medium"}(e,0,n,o)),i=["easy","medium","hard","very-hard","impossible"];return r.reduce((e,t)=>i.indexOf(t)>i.indexOf(e)?t:e)}(n,0,t,r),s=Qy(i,n.length,a),l=(c=s)>=70?"high":c>=40?"medium":"low";var c;const d=function(e,t,n,o){if(0===e.length)return"Complete!";const r=[],i=e.includes("Rainbow"),a=e.includes("Gold");if(i||a)if("produce"===n)if(o.hasRainbowGranter||o.hasGoldGranter){const e=[];i&&o.hasRainbowGranter&&e.push("Rainbow"),a&&o.hasGoldGranter&&e.push("Gold"),e.length>0?r.push(`Use ${e.join(" and/or ")} Pets`):r.push("‚ö†Ô∏è Rare without Granters")}else r.push("‚ö†Ô∏è Rare without Granters");else r.push("Hatch eggs (0.1-1%)");const s=e.includes("Wet"),l=e.includes("Chilled"),c=e.includes("Frozen");s&&r.push("Rain (~20-35min)"),l&&r.push("Snow (~20-35min)"),c&&r.push("Wet+Chilled (~30-45min)");const d=e.includes("Dawnlit")||e.includes("Ambershine"),p=e.includes("Amberlit"),u=e.includes("Dawncharged"),g=e.includes("Ambercharged");d&&r.push("‚ö†Ô∏è Log before charging! Dawn event"),p&&r.push("‚ö†Ô∏è Log before charging! Amber event"),u&&(o.hasDawnbinder?r.push("Dawnlit + Dawnbinder (25%/min)"):r.push("‚ö†Ô∏è Need Dawnbinder")),g&&(o.hasMoonbinder?r.push("Amberlit + Moonbinder (25%/min)"):r.push("‚ö†Ô∏è Need Moonbinder")),(e.includes("Max Weight")||e.includes("Max"))&&("pet"===n?r.push("‚ö†Ô∏è Hatch at lvl 70+ (rare)"):r.push("Needs Size Boost ability")),"produce"===n&&["Starweaver","Moonbinder","Dawnbinder"].includes(t)&&e.includes("Normal")&&r.unshift("üåü Log NORMAL first!");return r.join(" | ")||"Grow normally"}(n,e,t,r),p=function(e,t,n,o,r){const i=[];return n>=90?i.push(`Almost complete (${n.toFixed(0)}%)`):n>=70&&i.push(`Good progress (${n.toFixed(0)}%)`),1===r?i.push("Just 1 variant away from completion"):2===r?i.push("Only 2 variants remaining"):r<=4&&i.push(`${r} variants remaining`),"easy"===o?i.push("Quick and easy to complete"):"medium"===o?i.push("Moderate effort required"):"hard"===o?i.push("Challenging but achievable"):"very-hard"===o&&i.push("Very difficult - requires rare conditions"),i}(0,0,i,a,n.length),u=function(e,t){if(0===e.length)return"Complete";if("impossible"===t)return"Impossible without required resources";const n=function(e){switch(e){case"easy":return"20-30 minutes";case"medium":return"30-45 minutes";case"hard":return"Several hours to 1 day";case"very-hard":return"Days to weeks"}}(t);return 1===e.length?n:2===e.length?"easy"===t?"30-60 minutes":"medium"===t?"1-2 hours":"hard"===t?"1-2 days":"1-2 weeks":e.length<=4?"easy"===t?"1-2 hours":"medium"===t?"2-4 hours":"hard"===t?"2-4 days":"2-4 weeks":"easy"===t?"2-4 hours":"medium"===t?"4-8 hours":"hard"===t?"1 week":"1+ month"}(n,a);return{species:e,type:t,priority:l,missingVariants:n,completionPct:i,difficulty:a,estimatedTime:u,strategy:d,reasons:p}}async function Ky(e){const t=await async function(){const e={hasRainbowGranter:!1,hasGoldGranter:!1,hasMutationBoost:!1,hasDawnbinder:!1,hasMoonbinder:!1,granterCount:0,granterStrengthAvg:0};try{let t=0;const n=Er();s(`[JOURNAL-GRANTER] Checking ${n.length} active pets`);for(const i of n){const n=i.abilities||[],o=i.strength??100,r=n.some(e=>{const t="string"==typeof e?e:e?.type||e?.abilityType||"";return t.toLowerCase().includes("rainbow")&&t.toLowerCase().includes("grant")}),a=n.some(e=>{const t="string"==typeof e?e:e?.type||e?.abilityType||"";return t.toLowerCase().includes("gold")&&t.toLowerCase().includes("grant")});r&&(s(`[JOURNAL-GRANTER] Found Rainbow Granter in active pets: ${i.species||"unknown"}`),e.hasRainbowGranter=!0,e.granterCount++,t+=o),a&&(s(`[JOURNAL-GRANTER] Found Gold Granter in active pets: ${i.species||"unknown"}`),e.hasGoldGranter=!0,e.granterCount++,t+=o),(n.includes("Crop Mutation Boost I")||n.includes("Crop Mutation Boost II"))&&(e.hasMutationBoost=!0)}const o=await zs();if(o?.items){const t=o.items.filter(e=>"Pet"===e.itemType);s(`[JOURNAL-GRANTER] Checking ${t.length} pets in inventory`);for(const n of t){if("Pet"!==n.itemType)continue;const t=n.abilities||[],o=(n.strength,t.some(e=>{const t="string"==typeof e?e:e?.type||e?.abilityType||"";return t.toLowerCase().includes("rainbow")&&t.toLowerCase().includes("grant")})),r=t.some(e=>{const t="string"==typeof e?e:e?.type||e?.abilityType||"";return t.toLowerCase().includes("gold")&&t.toLowerCase().includes("grant")});o&&(s(`[JOURNAL-GRANTER] Found Rainbow Granter in inventory: ${n.species||"unknown"}`),e.hasRainbowGranter=!0),r&&(s(`[JOURNAL-GRANTER] Found Gold Granter in inventory: ${n.species||"unknown"}`),e.hasGoldGranter=!0),(t.includes("Crop Mutation Boost I")||t.includes("Crop Mutation Boost II"))&&(e.hasMutationBoost=!0),"Dawnbinder"===n.species&&(e.hasDawnbinder=!0),"Moonbinder"===n.species&&(e.hasMoonbinder=!0)}}const r=V("myPetHutchAtom");if(r){const t=await W(r),n=t?.pets||[];s(`[JOURNAL-GRANTER] Checking ${n.length} pets in hutch`);for(const o of n){const t=o.abilities||[],n=t.some(e=>{const t="string"==typeof e?e:e?.type||e?.abilityType||"";return t.toLowerCase().includes("rainbow")&&t.toLowerCase().includes("grant")}),r=t.some(e=>{const t="string"==typeof e?e:e?.type||e?.abilityType||"";return t.toLowerCase().includes("gold")&&t.toLowerCase().includes("grant")});n&&(s(`[JOURNAL-GRANTER] Found Rainbow Granter in hutch: ${o.species||"unknown"}`),e.hasRainbowGranter=!0),r&&(s(`[JOURNAL-GRANTER] Found Gold Granter in hutch: ${o.species||"unknown"}`),e.hasGoldGranter=!0),(t.includes("Crop Mutation Boost I")||t.includes("Crop Mutation Boost II"))&&(e.hasMutationBoost=!0)}}e.granterCount>0&&(e.granterStrengthAvg=t/e.granterCount),s(`[JOURNAL-GRANTER] Final detection results: Rainbow=${e.hasRainbowGranter}, Gold=${e.hasGoldGranter}, Granters=${e.granterCount}, MutationBoost=${e.hasMutationBoost}`)}catch(t){s("‚ùå Error detecting player resources:",t)}return e}(),n=[];for(const o of e.produce){const e=o.variants.filter(e=>!e.collected).map(e=>e.variant);if(0===e.length)continue;const r=Jy(o.species,"produce",e,o.variants.length,t);n.push(r)}for(const o of e.pets){const e=o.variants.filter(e=>!e.collected).map(e=>e.variant);if(0===e.length)continue;const r=Jy(o.species,"pet",e,o.variants.length,t);n.push(r)}return n}function Yy(e){const t=[...e].sort((e,t)=>{const n=Qy(e.completionPct,e.missingVariants.length,e.difficulty);return Qy(t.completionPct,t.missingVariants.length,t.difficulty)-n}).filter(e=>"impossible"!==e.difficulty).slice(0,10),n=t.reduce((e,t)=>e+t.missingVariants.length,0),o=t.some(e=>"very-hard"===e.difficulty),r=t.some(e=>"hard"===e.difficulty);let i="1-2 weeks";return i=o?"2-4 weeks":r?"1-2 weeks":t.every(e=>"easy"===e.difficulty)?"2-3 days":"4-7 days",{steps:t,estimatedTime:i,expectedCompletion:n}}function Zy(e){return e.filter(e=>e.missingVariants.length<=2&&("easy"===e.difficulty||"medium"===e.difficulty)).sort((e,t)=>e.missingVariants.length-t.missingVariants.length).slice(0,10)}function ex(e){return e.filter(e=>"hard"===e.difficulty||"very-hard"===e.difficulty).sort((e,t)=>{const n=["easy","medium","hard","very-hard","impossible"];return n.indexOf(t.difficulty)-n.indexOf(e.difficulty)}).slice(0,10)}window.addEventListener("error",e=>{try{if(String(e?.message||"").includes("Failed to execute 'contains' on 'Node'"))return e.stopImmediatePropagation?.(),e.preventDefault?.(),!1}catch{}return!0},!0),async function(){s("üöÄ Quinoa Pet Manager initializing..."),No(),s("[Main] Catalog loader initialized"),qo(e=>{const t=performance.now();s(`‚úÖ [Catalog] Catalogs ready at ${(t/1e3).toFixed(1)}s after page load`),Jo()});const n=cb().then(e=>{if(Oi(e),P("Sprites",e),s("‚úÖ Sprite system v2 initialized"),"undefined"!=typeof window){("undefined"!=typeof unsafeWindow?unsafeWindow:window).inspectPetSprites=na,s("üñºÔ∏è inspectPetSprites() available in console")}}).catch(e=>{s("‚ùå Sprite system failed to initialize:",e)});var o;await async function(){s("‚è≥ Waiting for game to load..."),await t,await e(100);const n=Date.now()+3e4;for(;Date.now()<n;){const t=a();if(t&&t.querySelector("canvas, button, [data-tm-main-interface], [data-tm-hud-root], [data-tm-player-id]"))return void s("‚úÖ Game UI detected");if(document.querySelector("#App canvas"))return void s("‚úÖ Game UI detected");await e(500)}s("‚ö†Ô∏è Game UI not detected within timeout, proceeding anyway")}(),ml(),lm(),await l(),function(){try{const e=g.get("qpm.xpTrackerProcs.v1",null);e?.procs&&Sc.splice(0,Sc.length,...e.procs);const t=g.get(Tc,null);t?.speciesXpPerLevel&&Object.assign(Pc.speciesXpPerLevel,t.speciesXpPerLevel)}catch(e){s("‚ö†Ô∏è Failed to restore XP tracker data",e)}Lo()?Lc():qo(()=>{Lc()})}(),rd(),await Ms(),await l(),Ad(),function(){if(Ls)return void s("‚ö†Ô∏è [BulkFavorite] Already started");if(Gs(),Ls=new MutationObserver(tl),Ls.observe(document.body,{childList:!0,subtree:!0,attributes:!1,characterData:!1}),null!==document.querySelector(js)&&Ks()){const e=Js();e&&Ys(e)}s("‚úÖ [BulkFavorite] Started")}(),await hm(),await l(),await sn(),await l(),_d(),await l(),o={enabled:Xy.harvestReminder.enabled,highlightEnabled:Xy.harvestReminder.highlightEnabled,toastEnabled:Xy.harvestReminder.toastEnabled,minSize:Xy.harvestReminder.minSize,selectedMutations:Xy.harvestReminder.selectedMutations},Yn?o&&ao(o):(Yn=!0,o&&ao(o),Zn=ln(),dn(e=>{Zn=e,Kn.enabled&&po()},!1),lo(),po(),s("üåæ Harvest reminder ready")),xi(Xy.turtleTimer),await l(),dt(),un||(un=!0,s("üåø Garden mutation tracker starting..."),Ce(),hn=Pe(),mn=Pn(hn.kind),gn=ln(),Se(e=>{const t=hn;hn=e;const n=Pn(e.kind),o=n!==mn,r=!t||t.startedAt!==e.startedAt||t.expectedEndAt!==e.expectedEndAt||t.hash!==e.hash;o?(mn=n,yn()):r&&"unknown"!==n&&yn()}),dn(e=>{gn=e,yn()},!0),yn(),s("üåø Garden mutation tracker ready")),await l(),ao({enabled:Xy.harvestReminder.enabled,highlightEnabled:Xy.harvestReminder.highlightEnabled,toastEnabled:Xy.harvestReminder.toastEnabled,minSize:Xy.harvestReminder.minSize,selectedMutations:Xy.harvestReminder.selectedMutations}),vi(Xy.turtleTimer),await l(),jf(),us(),Mb(),s("‚úÖ Egg Probability Indicator initialized"),await l(),ff(),Xb(),await l(),th();const r=ay();P("QPM_INSPECT_GARDEN",r.QPM_INSPECT_GARDEN),P("QPM_EXPOSE_GARDEN",r.QPM_EXPOSE_GARDEN),P("QPM_CURRENT_TILE",r.QPM_CURRENT_TILE),Gy.inspectGarden=r.QPM_INSPECT_GARDEN,Gy.exposeGarden=r.QPM_EXPOSE_GARDEN,Gy.currentTile=r.QPM_CURRENT_TILE,Gy.getCatalogs=zo,Gy.areCatalogsReady=Lo,Gy.waitForCatalogs=Ro,Gy.logCatalogStatus=Jo,Gy.diagnoseCatalogs=Bo;const{getGardenSnapshot:i,getMapSnapshot:c,isGardenBridgeReady:d}=await Promise.resolve().then(()=>pn);Gy.getGardenSnapshot=i,Gy.getMapSnapshot=c,Gy.isGardenBridgeReady=d;const{getGardenFiltersConfig:p,updateGardenFiltersConfig:u,applyGardenFiltersNow:m}=await Promise.resolve().then(()=>Qd),f="undefined"!=typeof unsafeWindow?unsafeWindow:window;f.__QPM_INTERNAL__={...f.__QPM_INTERNAL__,getGardenSnapshot:i,getMapSnapshot:c,isGardenBridgeReady:d,getGardenFiltersConfig:p,updateGardenFiltersConfig:u,applyGardenFiltersNow:m};const{getEggProbabilityConfig:h,setEggProbabilityConfig:b,startEggProbabilityIndicator:y,stopEggProbabilityIndicator:x}=await Promise.resolve().then(()=>Ib);Gy.eggProbability={getConfig:h,setConfig:b,start:y,stop:x},"undefined"!=typeof window&&(window.__QPM_DiagnoseCatalogs=Bo,s("üîç __QPM_DiagnoseCatalogs() available in console")),window.QPM_TEST_ALL_SPRITES=jy,window.QPM_BENCHMARK=_y,window.QPM_VALIDATE_SPECIES=Oy,s("‚úÖ Validation commands exposed to window:"),s("   QPM_TEST_ALL_SPRITES() - Test all pet and crop sprites"),s("   QPM_BENCHMARK() - Performance benchmark"),s("   QPM_VALIDATE_SPECIES() - Validate species name mappings"),yg=Xy,await n,await Cg(),Eu();const{showTutorialPopup:v}=await Promise.resolve().then(()=>EC);setTimeout(()=>{v()},1500),s("‚úÖ Quinoa Pet Manager initialized successfully"),function(e=2e3){if(ra||ia)return;const t=()=>{"function"==typeof window.requestIdleCallback?window.requestIdleCallback(()=>{ca()},{timeout:5e3}):ca()};Ni?setTimeout(t,e):Bi(()=>{setTimeout(t,e)})}(2e3)}().catch(e=>{console.error("[QuinoaPetMgr] Initialization failed:",e)});const tx=Object.freeze(Object.defineProperty({__proto__:null,generateJournalStrategy:async function(){try{const e=await wa();if(!e)return s("‚ö†Ô∏è Could not get journal summary"),null;const t=await Ky(e),n={recommendedFocus:t.sort((e,t)=>{const n=Qy(e.completionPct,e.missingVariants.length,e.difficulty);return Qy(t.completionPct,t.missingVariants.length,t.difficulty)-n}).slice(0,10),fastestPath:Yy(t),lowHangingFruit:Zy(t),longTermGoals:ex(t)};return s(`[JOURNAL] Generated strategy: ${n.recommendedFocus.length} recommendations, ${n.fastestPath.steps.length} fastest path steps`),n}catch(e){return s("‚ùå Error generating journal strategy:",e),null}},getDifficultyDescription:function(e){switch(e){case"easy":return"Easy";case"medium":return"Medium";case"hard":return"Hard";case"very-hard":return"Very Hard";case"impossible":return"Impossible"}},getDifficultyEmoji:function(e){switch(e){case"easy":return"üü¢";case"medium":return"üü°";case"hard":return"üü†";case"very-hard":return"üî¥";case"impossible":return"‚õî"}},getPriorityEmoji:function(e){switch(e){case"high":return"üî¥";case"medium":return"üü°";case"low":return"‚ö™"}}},Symbol.toStringTag,{value:"Module"}));let nx=new Set;const ox=Object.freeze(Object.defineProperty({__proto__:null,resetPetHatchingTracker:function(){nx.clear(),function(){try{g.set("qpm.petHatchingTracker.knownPetIds.v1",Array.from(nx))}catch(e){s("‚ö†Ô∏è Failed to save known pet IDs to storage",e)}}(),s("üóëÔ∏è Pet hatching tracker reset - all known pet IDs cleared")}},Symbol.toStringTag,{value:"Module"}));function rx(e){if(!Lo())return e;const t=Qo(e);return t?.name||e}const ix=["PetXpBoost","PetXpBoostII"];function ax(e){if(!e)return null;const t=e.match(/\((\d+)\)/);return t&&t[1]?parseInt(t[1],10):null}async function sx(e,t,n=10){const o=await async function(e){const t=[];for(const o of e){if(!o.species||null===o.xp||null===o.strength)continue;const e=$c(o.species);if(!e)continue;const n=Math.floor(o.xp/e),r=Math.min(30,n),i=o.strength-r,a=Math.min(i+30,100);if(o.strength>=a)continue;const s=a-o.strength,l=e-o.xp%e+e*(s-1);t.push({name:o.name||o.species,species:o.species,level:o.strength,xp:o.xp,maxStr:a,xpNeeded:l,xpPerLevel:e,source:"active"})}try{const e=V("myInventoryAtom");if(e){const n=await W(e);if(n&&Array.isArray(n.items))for(const e of n.items){const n=e.petSpecies||e.species;if("Pet"!==e.itemType||!n||null===e.xp||void 0===e.xp)continue;const o=$c(n);if(!o)continue;let r,i;if(null!==e.strength&&void 0!==e.strength){r=e.strength;const t=Math.floor(e.xp/o),n=r-Math.min(30,t);i=Math.min(n+30,100)}else{const t=ax(e.name);if(!t||t<80||t>100)continue;i=t;const n=i-30,a=Math.floor(e.xp/o);r=n+Math.min(30,a)}if(r>=i)continue;const a=i-r,s=o-e.xp%o+o*(a-1);t.push({name:e.name||n,species:n,level:r,xp:e.xp,maxStr:i,xpNeeded:s,xpPerLevel:o,source:"inventory"})}}}catch(n){s("‚ö†Ô∏è Failed to read inventory for near max level pets:",n)}try{const e=V("myPetHutchPetItemsAtom");if(e){const n=await W(e);if(Array.isArray(n))for(const e of n){const n=e.petSpecies||e.species;if(!n||null===e.xp||void 0===e.xp)continue;const o=$c(n);if(!o)continue;let r,i;if(null!==e.strength&&void 0!==e.strength){r=e.strength;const t=Math.floor(e.xp/o),n=r-Math.min(30,t);i=Math.min(n+30,100)}else{const t=ax(e.name);if(!t||t<80||t>100)continue;i=t;const n=i-30,a=Math.floor(e.xp/o);r=n+Math.min(30,a)}if(r>=i)continue;const a=i-r,s=o-e.xp%o+o*(a-1);t.push({name:e.name||n,species:n,level:r,xp:e.xp,maxStr:i,xpNeeded:s,xpPerLevel:o,source:"hutch"})}}}catch(n){s("‚ö†Ô∏è Failed to read hutch for near max level pets:",n)}return t}(e);return o.sort((e,t)=>e.xpNeeded-t.xpNeeded).slice(0,n)}function lx(e){const t=[];if(!e.abilities||0===e.abilities.length)return t;for(const n of e.abilities){if(!n)continue;const e=Ll(n);e&&("continuous"===e.trigger&&ix.includes(e.id)&&t.push({ability:e,rawName:n}))}return t}function cx(e,t,n=!0){const o=document.createElement("div");o.style.cssText="\n    border-bottom: 1px solid var(--qpm-border, #444);\n  ";const r=document.createElement("div");r.style.cssText="\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 10px 16px;\n    background: var(--qpm-surface-2, #222);\n    cursor: pointer;\n    user-select: none;\n  ";const i=document.createElement("div");i.textContent=e,i.style.cssText="\n    color: var(--qpm-text, #fff);\n    font-size: 13px;\n    font-weight: 600;\n  ";const a=document.createElement("span");a.textContent=n?"‚ñº":"‚ñ≤",a.style.cssText="\n    color: var(--qpm-text-muted, #aaa);\n    font-size: 10px;\n  ",r.appendChild(i),r.appendChild(a);const s=document.createElement("div");s.style.cssText=`\n    display: ${n?"block":"none"};\n    padding: 0;\n  `;const l=()=>{const e="block"===s.style.display;s.style.display=e?"none":"block",a.textContent=e?"‚ñ≤":"‚ñº"};return r.onclick=l,o.appendChild(r),o.appendChild(s),{root:o,content:s,toggle:l}}let dx={species:new Set,sources:new Set(["active","inventory","hutch"])};async function px(e){try{const t=await sx(e.latestPets,e.totalTeamXpPerHour,50);if(0===t.length)return void(e.nearMaxLevelContainer.innerHTML='\n        <div style="color: var(--qpm-text-muted, #aaa); font-style: italic;">\n          No pets near max level (all pets are either at max level or don\'t have enough data)\n        </div>\n      ');const n=[...new Set(t.map(e=>e.species))].sort();let o='<div style="font-weight: 600; margin-bottom: 8px; color: var(--qpm-accent, #4CAF50);">Pets Closest to Max Level:</div>';o+='<div style="margin-bottom: 12px; padding: 8px; background: rgba(255, 255, 255, 0.05); border-radius: 4px;">',o+='<div style="font-size: 11px; font-weight: 600; margin-bottom: 4px; color: var(--qpm-text-muted, #aaa);">Filter by Species:</div>',o+='<div style="display: flex; flex-wrap: wrap; gap: 6px;">';const r=0===dx.species.size;o+=`<button\n      onclick="window.qpmNearMaxToggleSpecies('__ALL__')"\n      style="\n        padding: 4px 8px;\n        font-size: 11px;\n        background: ${r?"var(--qpm-accent, #4CAF50)":"rgba(255, 255, 255, 0.1)"};\n        color: var(--qpm-text, #fff);\n        border: 1px solid ${r?"var(--qpm-accent, #4CAF50)":"rgba(255, 255, 255, 0.2)"};\n        border-radius: 4px;\n        cursor: pointer;\n        font-weight: ${r?"600":"400"};\n      ">All</button>`;for(const e of n){const t=0===dx.species.size||dx.species.has(e);o+=`<button\n        onclick="window.qpmNearMaxToggleSpecies('${e}')"\n        style="\n          padding: 4px 8px;\n          font-size: 11px;\n          background: ${t?"var(--qpm-accent, #4CAF50)":"rgba(255, 255, 255, 0.1)"};\n          color: var(--qpm-text, #fff);\n          border: 1px solid ${t?"var(--qpm-accent, #4CAF50)":"rgba(255, 255, 255, 0.2)"};\n          border-radius: 4px;\n          cursor: pointer;\n          font-weight: ${t?"600":"400"};\n        ">${e}</button>`}o+="</div>",o+='<div style="font-size: 11px; font-weight: 600; margin: 8px 0 4px 0; color: var(--qpm-text-muted, #aaa);">Filter by Location:</div>',o+='<div style="display: flex; flex-wrap: wrap; gap: 6px;">';const i=[{key:"active",label:"Active",icon:"üü¢"},{key:"inventory",label:"Inventory",icon:"üì¶"},{key:"hutch",label:"Hutch",icon:"üè†"}];for(const e of i){const t=dx.sources.has(e.key);o+=`<button\n        onclick="window.qpmNearMaxToggleSource('${e.key}')"\n        style="\n          padding: 4px 8px;\n          font-size: 11px;\n          background: ${t?"var(--qpm-accent, #4CAF50)":"rgba(255, 255, 255, 0.1)"};\n          color: var(--qpm-text, #fff);\n          border: 1px solid ${t?"var(--qpm-accent, #4CAF50)":"rgba(255, 255, 255, 0.2)"};\n          border-radius: 4px;\n          cursor: pointer;\n          font-weight: ${t?"600":"400"};\n        ">${e.icon} ${e.label}</button>`}o+="</div>",o+="</div>";const a=t.filter(e=>!(dx.species.size>0&&!dx.species.has(e.species))&&!!dx.sources.has(e.source)).slice(0,10);if(0===a.length)return o+='<div style="color: var(--qpm-text-muted, #aaa); font-style: italic; margin-top: 8px;">No pets match the current filters</div>',void(e.nearMaxLevelContainer.innerHTML=o);o+=`<div style="margin-top: 8px; font-size: 10px; color: var(--qpm-text-muted, #aaa);">Showing ${a.length} of ${t.length} pets</div>`;for(const s of a){const t="active"===s.source?"üü¢":"inventory"===s.source?"üì¶":"üè†",n="active"===s.source?e.totalTeamXpPerHour:3600;let r="‚Äî";if(n>0&&s.xpNeeded>0&&s.maxStr){const e=zc(0,s.xpNeeded,n);if(e)if(e.hours>=24){const t=Math.floor(e.hours/24);r=`${t}d ${e.hours%24}h ${e.minutes}m`}else r=`${e.hours}h ${e.minutes}m`}o+=`\n        <div style="padding: 4px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">\n          <span style="color: var(--qpm-text, #fff);">${t} ${s.name} (${s.species})</span>\n          <span style="color: var(--qpm-text-muted, #aaa); margin-left: 8px;">Lv${s.level} ‚Üí Lv${s.maxStr||"?"}</span>\n          <span style="color: var(--qpm-warning, #FF9800); margin-left: 8px;">(${r})</span>\n          <span style="color: var(--qpm-positive, #4CAF50); margin-left: 8px;">(${Dn(s.xp)} XP, needs ${Dn(s.xpNeeded)})</span>\n        </div>\n      `}e.nearMaxLevelContainer.innerHTML=o}catch(t){s("‚ö†Ô∏è Failed to update near max level display:",t),e.nearMaxLevelContainer.innerHTML='\n      <div style="color: var(--qpm-danger, #f44336);">\n        Failed to load near max level pets\n      </div>\n    '}}function ux(e){e.petLevelTbody.innerHTML="",e.tbody.innerHTML="";const t=[];for(const a of e.latestPets){const e=lx(a);for(const{ability:n,rawName:o}of e){const e=Ec(a,n.id,rx(n.id),n.baseProbability??0,n.effectValuePerProc??0);t.push(e)}}e.latestStats=t;const n=t.length>0?function(e){const t=e.reduce((e,t)=>e+t.expectedXpPerHour,0),n=e.reduce((e,t)=>e+t.expectedProcsPerHour,0),o=100*(1-e.map(e=>e.actualChancePerSecond/100).reduce((e,t)=>e*(1-t),1)),r=60*o,i=e.map(e=>e.lastProcAt).filter(e=>null!==e);return{totalXpPerHour:t,totalProcsPerHour:n,combinedChancePerSecond:o,combinedChancePerMinute:r,lastProcAt:i.length>0?Math.max(...i):null,totalProcCount:e.reduce((e,t)=>e+t.procCount,0)}}(t):null,o=n?n.totalXpPerHour:0;if(e.totalTeamXpPerHour=3600+o,0===t.length)e.tbody.innerHTML='\n      <div style="color: var(--qpm-warning, #FF9800); font-style: italic;">\n        ‚ö†Ô∏è No pets with XP Boost abilities detected. Equip pets with XP Boost I or XP Boost II to generate team-wide XP.\n      </div>\n      <div style="margin-top: 8px; color: var(--qpm-text-muted, #aaa); font-size: 11px;">\n        Each active pet still receives 3,600 XP/hour base (1 XP/second).\n      </div>\n    ';else{const r=t.map(e=>`${e.petName} (${e.abilityName}, ${e.actualChancePerMinute.toFixed(2)}%/min)`).join(", ");e.tbody.innerHTML=`\n      <div style="margin-bottom: 12px; padding: 10px; background: var(--qpm-surface-2, #1a1a1a); border-left: 3px solid var(--qpm-accent, #4CAF50); border-radius: 4px;">\n        <div style="font-size: 12px; font-weight: 600; margin-bottom: 6px; color: var(--qpm-accent, #4CAF50);">XP Rate Per Pet (Each Active Pet Receives):</div>\n        <div style="margin-left: 8px; font-size: 11px; color: var(--qpm-text, #fff); line-height: 1.6;">\n          ‚Ä¢ Base: <span style="color: var(--qpm-warning, #FF9800); font-weight: 600; font-family: monospace;">3,600 XP/hr</span> <span style="color: var(--qpm-text-muted, #aaa);">(1 XP/second, always)</span><br/>\n          ‚Ä¢ Ability Bonus: <span style="color: var(--qpm-warning, #FF9800); font-weight: 600; font-family: monospace;">+${Dn(o)} XP/hr</span> <span style="color: var(--qpm-text-muted, #aaa);">(shared by all pets)</span><br/>\n          ‚Ä¢ <strong style="color: var(--qpm-accent, #4CAF50);">Total: ${Dn(e.totalTeamXpPerHour)} XP/hr per pet</strong>\n        </div>\n      </div>\n      <div style="margin-bottom: 8px;">\n        <strong style="color: var(--qpm-accent, #4CAF50);">Combined Chance:</strong>\n        <span style="color: var(--qpm-accent, #4CAF50); font-weight: 600; font-family: monospace;">${n.combinedChancePerMinute.toFixed(2)}%/min</span>\n        <span style="color: var(--qpm-text-muted, #aaa); font-size: 11px; margin-left: 8px;">(~${n.totalProcsPerHour.toFixed(1)} procs/hr)</span>\n      </div>\n      <div style="margin-bottom: 6px; color: var(--qpm-text-muted, #aaa); font-size: 11px; font-style: italic;">\n        Note: Each ability rolls independently every second. When an XP Boost procs, all active pets receive the XP.\n      </div>\n      <div>\n        <strong style="color: var(--qpm-accent, #4CAF50);">XP Boost Pets:</strong>\n        <span style="color: var(--qpm-text, #fff);">${r}</span>\n      </div>\n    `}0===t.length?e.summaryText.textContent="‚ö†Ô∏è No pets with XP Boost abilities detected. Each pet receives 3,600 XP/hr base only.":e.summaryText.innerHTML=`\n      <strong>Each Pet Receives:</strong> ${Dn(e.totalTeamXpPerHour)} XP/hr (${Dn(3600)} base + ${Dn(o)} ability bonus) ‚Ä¢\n      <strong>Active Pets:</strong> ${e.latestPets.length} (${t.length} with XP Boost)\n    `;for(const a of e.latestPets)gx(e.petLevelTbody,a,e.totalTeamXpPerHour);const r=new Set;for(const a of e.latestPets)a.species&&r.add(a.species);const i={...Pc.speciesXpPerLevel};for(const a of Object.keys(i))r.add(a);e.lastKnownSpecies=r,px(e)}function gx(e,t,n){const o=e.insertRow();o.style.cssText="border-bottom: 1px solid var(--qpm-border, #444);";const r=o.insertCell(),i=t.species&&t.targetScale?Fc(t.targetScale,t.species):null,a=t.name||t.species||"Unknown",s=t.species?ea(t.species):null,l=lx(t),c=(t.abilities||[]).slice(0,4).map(e=>{const t=qc(e);return`<div style="width:8px;height:8px;border-radius:2px;background:${t.base};border:1px solid rgba(255,255,255,0.4);box-shadow:0 0 3px ${t.glow};" title="${e}"></div>`}).join(""),d=t.species?`<div style="display:inline-flex;align-items:center;vertical-align:middle;margin-right:6px;">\n        ${c?`<div style="display:flex;flex-direction:column;gap:2px;margin-right:4px;">${c}</div>`:""}\n        <img data-qpm-sprite="pet:${t.species}" src="${s||""}" style="width:20px;height:20px;object-fit:contain;image-rendering:pixelated;" alt="${t.species}" />\n      </div>`:"";r.innerHTML=i?`\n      ${d}<div style="display:inline-block;vertical-align:middle;"><div style="font-weight: 500; color: var(--qpm-text, #fff);">${a}</div>\n      <div style="font-size: 10px; color: var(--qpm-text-muted, #888); margin-top: 2px;">MAX STR ${i}</div></div>\n    `:d+a,r.style.cssText="\n    padding: 10px 12px;\n    color: var(--qpm-text, #fff);\n  ",r.title=`Slot: ${t.slotIndex}\nPet ID: ${t.petId||"N/A"}\nStrength: ${t.strength??"N/A"}${i?`\nMAX STR: ${i}`:""}${t.targetScale?`\nTarget Scale: ${t.targetScale.toFixed(2)}`:""}`;const p=o.insertCell();p.textContent=t.species||"‚Äî",p.style.cssText="\n    padding: 10px 12px;\n    color: var(--qpm-text-muted, #aaa);\n  ";const u=o.insertCell();if(l.length>0){const e=l.map(e=>e.rawName).join(", ");u.textContent=e,u.style.cssText="\n      padding: 10px 12px;\n      color: var(--qpm-accent, #4CAF50);\n      font-size: 11px;\n    ",u.title="This pet generates XP for the team"}else u.textContent="‚Äî",u.style.cssText="\n      padding: 10px 12px;\n      color: var(--qpm-text-muted, #666);\n      font-size: 11px;\n    ";const g=o.insertCell();null!==t.strength&&void 0!==t.strength?(g.textContent=String(t.strength),g.style.cssText="\n      padding: 10px 12px;\n      text-align: right;\n      color: var(--qpm-accent, #4CAF50);\n      font-family: monospace;\n      font-weight: 600;\n    ",g.title=`Current Strength: ${t.strength}\n(Strength increases by 1 each time XP threshold is reached)`):(g.textContent="‚ö†Ô∏è ‚Äî",g.style.cssText="\n      padding: 10px 12px;\n      text-align: right;\n      color: var(--qpm-warning, #FF9800);\n      font-family: monospace;\n      font-weight: 600;\n    ",g.title="Strength data not available");const m=o.insertCell();m.textContent=null!==t.xp?Dn(t.xp):"‚Äî",m.style.cssText="\n    padding: 10px 12px;\n    text-align: right;\n    color: var(--qpm-warning, #FF9800);\n    font-family: monospace;\n  ";const f=o.insertCell();if(f.style.cssText="\n    padding: 10px 12px;\n    text-align: right;\n    color: var(--qpm-text, #fff);\n    min-width: 200px;\n  ",t.species&&null!==t.xp&&null!==t.strength){const e=$c(t.species);if(e){const n=Math.floor(t.xp/e),o=Math.min(30,n),r=t.strength-o,i=Math.min(r+30,100),a=t.xp%e,s=a/e*100;t.strength>=i?(f.innerHTML=`\n          <div style="color: var(--qpm-accent, #4CAF50); font-weight: 600; font-size: 12px;">üåü MAX STR ${i}</div>\n          <div style="font-size: 10px; color: var(--qpm-text-muted, #aaa); margin-top: 2px;">No further STR gains</div>\n        `,f.title=`Pet is at MAX Strength (${i})\nTotal XP: ${Dn(t.xp)}\nLevels gained from hatch: ${n}${t.targetScale?`\nTarget Scale: ${t.targetScale.toFixed(2)}`:""}`):(f.innerHTML=`\n          <div style="font-size: 11px; margin-bottom: 4px;">${Dn(a)} / ${Dn(e)} (${Math.min(100,s).toFixed(1)}%)</div>\n          <div style="width: 100%; height: 8px; background: #333; border-radius: 4px; overflow: hidden;">\n            <div style="width: ${Math.min(100,s).toFixed(1)}%; height: 100%; background: linear-gradient(90deg, #4CAF50, #8BC34A);"></div>\n          </div>\n        `,f.title=`Total XP: ${Dn(t.xp)}\nLevels gained from hatch: ${n}${i?`\nMAX STR: ${i}`:""}${t.targetScale?`\nTarget Scale: ${t.targetScale.toFixed(2)}`:""}`)}else f.innerHTML='<span style="color: var(--qpm-text-muted, #aaa); font-size: 11px;">Configure XP/level</span>'}else f.textContent="‚Äî";const h=o.insertCell();if(h.style.cssText="\n    padding: 10px 12px;\n    text-align: right;\n    color: var(--qpm-text, #fff);\n    font-family: monospace;\n    font-weight: 500;\n  ",t.species&&null!==t.xp&&null!==t.strength){const e=$c(t.species),o=er(t.species);if(e){const r=Math.floor(t.xp/e),i=Math.min(30,r),a=t.strength-i,s=Math.min(a+30,100);if(t.strength>=s)h.innerHTML='<span style="color: var(--qpm-accent, #4CAF50); font-weight: 600;">‚Äî</span>',h.title="Pet is at MAX Strength - no further STR gains possible";else if(n>0){const r=t.xp%e,i=zc(r,e,n),a=function(e,t,n,o){return Rb(e,t,n,o,1)}(t.species,o,e,n),s=a&&a>0?`üçñ ${a}`:"";i?(h.innerHTML=`\n            <div style="color: var(--qpm-positive, #4CAF50);">${i.hours}h ${i.minutes}m</div>\n            <div style="font-size: 10px; color: var(--qpm-text-muted, #aaa); margin-top: 2px;">${Dn(n)} XP/hr</div>\n            ${s?`<div style="font-size: 10px; color: var(--qpm-warning, #FF9800); margin-top: 2px;">${s}</div>`:""}\n          `,h.title=`This pet receives ${Dn(n)} XP/hr\n(3,600 base + ability bonus shared by all pets)${s?`\n~${a} feeds per level`:""}`):r>=e?h.innerHTML='<span style="color: var(--qpm-accent, #4CAF50); font-weight: 600;">Ready!</span>':h.textContent="‚Äî"}else 0===n?h.innerHTML='<span style="color: var(--qpm-text-muted, #aaa); font-size: 11px;">No XP boost</span>':h.textContent="‚Äî"}else h.innerHTML='<span style="color: var(--qpm-text-muted, #aaa); font-size: 11px;">‚Äî</span>'}else h.textContent="‚Äî";const b=o.insertCell();if(b.style.cssText="\n    padding: 10px 12px;\n    text-align: right;\n    color: var(--qpm-text, #fff);\n    font-family: monospace;\n    font-weight: 500;\n  ",t.species&&null!==t.xp&&null!==t.strength){const e=$c(t.species);if(e){const o=Math.floor(t.xp/e),r=Math.min(30,o),i=t.strength-r,a=Math.min(i+30,100);if(t.strength>=a)b.innerHTML='<span style="color: var(--qpm-accent, #4CAF50); font-weight: 600;">‚Äî</span>',b.title="Pet is already at MAX Strength";else if(n>0){const o=a-t.strength,r=e-t.xp%e+e*(o-1),i=r/n,s=Math.floor(i/24),l=Math.floor(i%24),c=Math.floor(i%1*60);let d="";d=s>0?`${s}d ${l}h`:l>0?`${l}h ${c}m`:`${c}m`;const p=er(t.species),u=p?Rb(t.species,p,e,n,o):null,g=u&&u>0?`üçñ ${u}`:"";b.innerHTML=`\n          <div style="color: var(--qpm-warning, #FF9800); font-weight: 600;">${d}</div>\n          <div style="font-size: 10px; color: var(--qpm-text-muted, #aaa); margin-top: 2px;">${o} STR left</div>\n          ${g?`<div style="font-size: 10px; color: var(--qpm-warning, #FF9800); margin-top: 2px;">${g}</div>`:""}\n        `,b.title=`${o} STR levels remaining\n${Dn(r)} XP needed\nThis pet receives ${Dn(n)} XP/hr\n(3,600 base + ability bonus)${g?`\n~${u} total feeds to max`:""}`}else 0===n?b.innerHTML='<span style="color: var(--qpm-text-muted, #aaa); font-size: 11px;">No XP boost</span>':(b.innerHTML='<span style="color: var(--qpm-text-muted, #aaa); font-size: 11px;">‚Äî</span>',b.title="Max STR unknown")}else b.innerHTML='<span style="color: var(--qpm-text-muted, #aaa); font-size: 11px;">‚Äî</span>'}else b.textContent="‚Äî"}function mx(e){const t=e.getBoundingClientRect(),n=window.innerWidth,o=window.innerHeight;let r=parseFloat(e.style.top)||t.top,i=parseFloat(e.style.left)||t.left,a=parseFloat(e.style.right);isNaN(a)||""===e.style.right||(i=n-t.right,e.style.right="");const s=Math.max(8,n-t.width-8),l=Math.max(8,o-t.height-8);i=Math.min(Math.max(i,8),s),r=Math.min(Math.max(r,8),l),e.style.left=`${i}px`,e.style.top=`${r}px`}let fx=null;const hx=Object.freeze(Object.defineProperty({__proto__:null,createXpTrackerWindow:function(){const e=document.createElement("div");e.style.cssText="\n    position: fixed;\n    top: 80px;\n    right: 20px;\n    width: 850px;\n    max-height: 80vh;\n    overflow-y: auto;\n    background: var(--qpm-background, rgba(0, 0, 0, 0.92));\n    border: 2px solid var(--qpm-border, #555);\n    border-radius: 8px;\n    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);\n    z-index: 10002;\n    font-family: Arial, sans-serif;\n    display: none;\n  ";const t=document.createElement("div");t.style.cssText="\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 12px 16px;\n    background: var(--qpm-surface-1, #1a1a1a);\n    border-bottom: 2px solid var(--qpm-border, #555);\n    cursor: move;\n  ";const n=document.createElement("h3");n.textContent="‚ú® XP Tracker",n.style.cssText="\n    margin: 0;\n    color: var(--qpm-text, #fff);\n    font-size: 16px;\n    font-weight: 600;\n  ";const o=document.createElement("button");o.textContent="‚úï",o.style.cssText="\n    background: transparent;\n    border: none;\n    color: var(--qpm-text, #fff);\n    font-size: 20px;\n    cursor: pointer;\n    padding: 0 8px;\n    line-height: 1;\n  ",o.onclick=()=>{e.style.display="none"},t.appendChild(n),t.appendChild(o),e.appendChild(t);const r=document.createElement("div");r.style.cssText="\n    padding: 12px 16px;\n    background: var(--qpm-surface-1, #1a1a1a);\n    border-bottom: 1px solid var(--qpm-border, #444);\n  ";const i=document.createElement("div");i.style.cssText="\n    color: var(--qpm-text, #fff);\n    font-size: 13px;\n    line-height: 1.6;\n  ",i.textContent="Loading XP data...",r.appendChild(i),e.appendChild(r);const a=cx("üêæ All Active Pets"),s=function(){const e=document.createElement("table");e.style.cssText="\n    width: 100%;\n    border-collapse: collapse;\n    font-size: 12px;\n  ";const t=document.createElement("thead");t.innerHTML='\n    <tr style="background: var(--qpm-surface-2, #222); border-bottom: 2px solid var(--qpm-border, #555);">\n      <th style="padding: 10px 12px; text-align: left; color: var(--qpm-text, #fff); font-weight: 600;">Pet</th>\n      <th style="padding: 10px 12px; text-align: left; color: var(--qpm-text, #fff); font-weight: 600;">Species</th>\n      <th style="padding: 10px 12px; text-align: left; color: var(--qpm-text, #fff); font-weight: 600;">XP Ability</th>\n      <th style="padding: 10px 12px; text-align: right; color: var(--qpm-text, #fff); font-weight: 600;">Strength</th>\n      <th style="padding: 10px 12px; text-align: right; color: var(--qpm-text, #fff); font-weight: 600;">Current XP</th>\n      <th style="padding: 10px 12px; text-align: right; color: var(--qpm-text, #fff); font-weight: 600;">Progress to Next STR</th>\n      <th style="padding: 10px 12px; text-align: right; color: var(--qpm-text, #fff); font-weight: 600;">Time to Next STR</th>\n      <th style="padding: 10px 12px; text-align: right; color: var(--qpm-text, #fff); font-weight: 600;">Time to Max STR</th>\n    </tr>\n  ';const n=document.createElement("tbody");return e.appendChild(t),e.appendChild(n),e}(),l=s.querySelector("tbody");a.content.appendChild(s),e.appendChild(a.root);const c=cx("‚ú® XP Generation Summary"),d=document.createElement("div");d.style.cssText="\n    padding: 12px 16px;\n    color: var(--qpm-text, #fff);\n    font-size: 12px;\n    line-height: 1.6;\n  ",c.content.appendChild(d),e.appendChild(c.root);const u=cx("üèÜ Near Max Level","near-max-level-section",!1),g=document.createElement("div");g.style.cssText="\n    padding: 12px 16px;\n    color: var(--qpm-text, #fff);\n    font-size: 12px;\n    line-height: 1.8;\n    font-family: monospace;\n  ",g.textContent="Loading...",u.content.appendChild(g),e.appendChild(u.root);const m=d,f=document.createElement("tbody");document.body.appendChild(e),function(e,t){let n=0,o=0,r=0,i=0;function a(e){e.preventDefault(),r=e.clientX,i=e.clientY,document.onmouseup=l,document.onmousemove=s}function s(t){t.preventDefault(),n=r-t.clientX,o=i-t.clientY,r=t.clientX,i=t.clientY,e.style.top=e.offsetTop-o+"px",e.style.left=e.offsetLeft-n+"px"}function l(){document.onmouseup=null,document.onmousemove=null,mx(e)}t.onmousedown=a}(e,t);const h={root:e,summaryText:i,petLevelTbody:l,tbody:m,combinedTbody:f,nearMaxLevelContainer:g,updateInterval:null,latestPets:[],latestStats:[],totalTeamXpPerHour:0,lastKnownSpecies:new Set,unsubscribePets:null,unsubscribeXpTracker:null,resizeListener:null},b=()=>{"none"!==e.style.display&&mx(e)};window.addEventListener("resize",b),h.resizeListener=b;const y=p(e=>{h.latestPets=e,ux(h)},500);var x;return h.unsubscribePets=$r(y),h.unsubscribeXpTracker=(x=()=>{!function(e){e.petLevelTbody.innerHTML="";for(const t of e.latestPets)gx(e.petLevelTbody,t,e.totalTeamXpPerHour)}(h)},kc.push(x),()=>{kc=kc.filter(e=>e!==x)}),h.updateInterval=ie("xp-tracker-countdown",()=>{!function(e){const t=e.root.querySelectorAll(".eta-countdown");t.forEach(e=>{const t=parseInt(e.dataset.lastProc??"0",10),n=parseFloat(e.dataset.effectiveRate??"0");if(!n||n<=0)return;const o=Bc(t,60/n,n);e.textContent=o.text,e.style.color=o.isOverdue?"var(--qpm-danger, #f44336)":e.classList.contains("combined")?"var(--qpm-accent, #4CAF50)":"var(--qpm-positive, #4CAF50)"})}(h)},1e3),h},hideXpTrackerWindow:function(e){e.root.style.display="none"},setGlobalXpTrackerState:function(e){fx=e,window.qpmNearMaxToggleSpecies=e=>{fx&&("__ALL__"===e?dx.species.clear():dx.species.has(e)?dx.species.delete(e):(dx.species.size,dx.species.add(e)),px(fx))},window.qpmNearMaxToggleSource=e=>{fx&&(dx.sources.has(e)?dx.sources.delete(e):dx.sources.add(e),px(fx))}},showXpTrackerWindow:function(e){e.root.style.display="block",ux(e)}},Symbol.toStringTag,{value:"Module"})),bx={weather:["Rain","Snow","Frost"],eggs:["Uncommon Eggs","Rare Eggs","Mythical Eggs","Legendary Eggs"],crops:["Carrot","Strawberry","Aloe","Delphinium","Blueberry","Apple","Tulip","Tomato","Corn","Camellia","Squash","Mushroom","Banana","Grape","Coconut","Lychee","Bamboo","Dragon Fruit","Fava Bean"],seeds:["Carrot","Strawberry","Aloe","Delphinium","Blueberry","Apple","Tulip","Tomato","Daffodil","Corn","Watermelon","Pumpkin","Echeveria","Coconut","Banana","Lily","Camellia","Squash","Burro's Tail","Mushroom","Cactus","Bamboo","Chrysanthemum","Grape","Pepper","Lemon","Passion Fruit","Dragon Fruit","Lychee","Sunflower","Starweaver","Dawnbinder","Moonbinder","Fava Bean","Cacao Bean"]};function yx(e){return e.replace(/[\u2018\u2019]/g,"'").trim()}function xx(e){const t=yx(e);return bx.weather.includes(t)?"weather":bx.eggs.some(e=>t.includes(e))?"egg":bx.crops.includes(t)?"crop":bx.seeds.includes(t)?"seed":"unknown"}const vx=[/!!!/,/omg/i,/ping/i,/spam/i,/^\d+/,/\d+\s+[A-Z]/,/stock!!!/i,/vegetables/i,/named/i];function wx(e){if(!function(e){return!(vx.some(t=>t.test(e))||e.length>50)}(e))return!1;const t=xx(e);return"seed"===t||"egg"===t}const Cx=36e6;function Tx(e,t){try{if(e.includes("/")){const t=e.split(" ");if(t.length<3)return Date.now();const n=t[0],o=t[1],r=t[2].toLowerCase(),i=n.split("/").map(Number),a=o.split(":").map(Number);if(3!==i.length||2!==a.length)return Date.now();const l=i[0],c=i[1],d=i[2];let p,u;if(p=l,u=c,p<1||p>31||u<1||u>12)return s("‚ö†Ô∏è Invalid date after parsing:",e,{day:p,month:u,year:d}),Date.now();const g=a[0],m=a[1];let f=g;"pm"===r&&12!==g?f+=12:"am"===r&&12===g&&(f=0);const h=Date.UTC(d,u-1,p,f,m,0,0);return h-Cx}if(t){const n=e.split(" ");if(n.length<2)return Date.now();const o=n[0],r=n[1].toLowerCase(),i=o.split(":").map(Number);if(2!==i.length)return Date.now();const a=i[0],s=i[1];let l=a;"pm"===r&&12!==a?l+=12:"am"===r&&12===a&&(l=0);const c=new Date(t).getUTCFullYear(),d=new Date(t).getUTCMonth(),p=new Date(t).getUTCDate(),u=Date.UTC(c,d,p,l,s,0,0);return u-Cx}return Date.now()}catch(n){return s("‚ö†Ô∏è Failed to parse timestamp:",e,n),Date.now()}}function Sx(e){const t=[],n=e.split("|").map(e=>e.trim());for(const o of n){const e=o.match(/@([^@]+?)(?:\s+(\d+))?$/);if(e&&e[1]){const n=yx(e[1]);if(!wx(n))continue;const o=e[2]?parseInt(e[2],10):0;t.push({name:n,quantity:o,type:xx(n)})}}return t}function Px(e,t){const n=t.map(e=>`${e.name}:${e.quantity}`).join(",");return`${e}-${btoa(n).substring(0,8)}`}function kx(e){if(!e||"number"!=typeof e.timestamp||!Array.isArray(e.items))return null;const t=e.items.map(e=>({name:yx(e.name),quantity:Number.isFinite(e.quantity)?e.quantity:0,type:e.type??xx(e.name)})).filter(e=>wx(e.name));if(0===t.length)return null;return{id:e.id||Px(e.timestamp,t),timestamp:e.timestamp,dateString:e.dateString||new Date(e.timestamp).toISOString(),items:t,source:e.source||"manual"}}async function Ax(e){const t=(new DOMParser).parseFromString(e,"text/html"),n=function(e){const t=e.getElementById("qpm-restock-data");if(!t)return null;try{const e=t.textContent||"[]",n=JSON.parse(e),o=Array.isArray(n?.events)?n.events:Array.isArray(n)?n:[],r=[];for(const t of o){const e=kx(t);e&&r.push(e)}if(r.length>0)return s(`‚úÖ Parsed ${r.length} restock events from embedded JSON payload`),r}catch(n){s("‚ö†Ô∏è Failed to parse embedded restock JSON payload",n)}return null}(t);if(n)return n;const o=[],r=Array.from(t.querySelectorAll(".chatlog__message-group"));let i;const a=r.length;let l=0;s(`üìä Parsing ${a} message groups from Discord HTML...`);for(let c=0;c<a;c+=50){const e=Math.min(c+50,a),t=r.slice(c,e);for(const n of t){const e=n.querySelector(".chatlog__author");if(!e||!e.textContent?.includes("Magic Shopkeeper"))continue;const t=n.querySelector(".chatlog__timestamp a");if(t){const e=Tx(t.textContent?.trim()||"");i=new Date(e)}const r=n.querySelectorAll(".chatlog__message-container");for(const n of r){let e="",t=0;const r=n.querySelector(".chatlog__timestamp a"),a=n.querySelector(".chatlog__short-timestamp");if(r)e=r.textContent?.trim()||"",t=Tx(e),i=new Date(t);else{if(!a)continue;e=a.textContent?.trim()||"",t=Tx(e,i)}const s=n.querySelector(".chatlog__content");if(!s)continue;const l=s.textContent?.trim()||"";if(!l)continue;const c=Sx(l);if(0===c.length)continue;const d={id:Px(t,c),timestamp:t,dateString:e,items:c,source:"discord"};o.push(d)}}l+=t.length,e<a&&(s(`üìä Parsed ${l}/${a} message groups (${o.length} events so far)...`),await new Promise(e=>setTimeout(e,0)))}return s(`‚úÖ Parsed ${o.length} restock events from ${a} message groups`),o}async function Ex(e){return new Promise((t,n)=>{const o=new FileReader;o.onload=async o=>{try{const n=o.target?.result??"";if(e.name.toLowerCase().endsWith(".json")||e.type.includes("json")||n.trim().startsWith("{")||n.trim().startsWith("["))return void t(function(e){try{const t=JSON.parse(e),n=Array.isArray(t?.events)?t.events:Array.isArray(t)?t:[],o=[];for(const e of n){const t=kx(e);t&&o.push(t)}return s(`‚úÖ Parsed ${o.length} restock events from JSON payload`),o}catch(t){return s("‚ö†Ô∏è Failed to parse restock JSON content",t),[]}}(n));const r=await Ax(n);t(r)}catch(r){n(r)}},o.onerror=()=>{n(new Error("Failed to read file"))},o.readAsText(e)})}function $x(e){return e.toLocaleString()}function Mx(e){return new Date(e).toLocaleString()}function Ix(e){const t=Fp(),n=Lp();null!==e.countdownInterval&&(e.countdownInterval(),e.countdownInterval=null),e.contentContainer.innerHTML="";const o=Fx();e.contentContainer.appendChild(o);const r=function(e){const t=document.createElement("div");t.style.cssText="\n    margin-bottom: 20px;\n    padding: 16px;\n    background: rgba(255, 255, 255, 0.05);\n    border-radius: 8px;\n    border: 2px dashed rgba(255, 255, 255, 0.2);\n  ";const n=document.createElement("h4");n.textContent="üì• Import Discord Data",n.style.cssText="\n    margin: 0 0 12px 0;\n    color: var(--qpm-accent, #4CAF50);\n    font-size: 14px;\n  ",t.appendChild(n);const o=document.createElement("p");o.style.cssText="\n    margin: 0 0 12px 0;\n    font-size: 12px;\n    color: var(--qpm-text-muted, #aaa);\n    line-height: 1.5;\n  ",o.textContent="Upload a Discord HTML export from the restock channel to import historical data. You can also import the smaller JSON export.",t.appendChild(o);const r=document.createElement("input");r.type="file",r.accept=".html,.json",r.style.display="none";const i=document.createElement("button");i.textContent="üìÅ Choose File",i.style.cssText="\n    padding: 8px 16px;\n    background: var(--qpm-accent, #4CAF50);\n    color: white;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 12px;\n    font-weight: 600;\n    margin-right: 8px;\n  ",i.onclick=()=>r.click(),r.onchange=async e=>{const t=e.target,n=t.files?.[0];if(n){i.disabled=!0,i.textContent="‚è≥ Parsing...";try{const e=await Ex(n);!function(e){let t=0;const n=new Set(wp.map(e=>e.id));for(const o of e)n.has(o.id)||(wp.push(o),n.add(o.id),t++);Tp=!1,Mp(!0),Gp(),s(`dY"S Added ${t} new restock events (${e.length-t} duplicates skipped)`)}(e),i.textContent=`‚úÖ Imported ${e.length} restocks`,setTimeout(()=>{i.disabled=!1,i.textContent="üìÅ Choose File"},3e3)}catch(o){s("‚ùå Failed to parse Discord HTML:",o),i.textContent="‚ùå Import failed",setTimeout(()=>{i.disabled=!1,i.textContent="üìÅ Choose File"},3e3)}}},t.appendChild(r),t.appendChild(i);const a=Fp();if(a.length>0){const n=document.createElement("div");n.style.cssText="display: flex; gap: 8px; margin-top: 12px;";const o=document.createElement("button");o.textContent="üì§ Export HTML",o.style.cssText="\n      padding: 8px 16px;\n      background: rgba(66, 165, 245, 0.2);\n      color: #42A5F5;\n      border: 1px solid #42A5F5;\n      border-radius: 4px;\n      cursor: pointer;\n      font-size: 12px;\n      font-weight: 600;\n    ",o.onclick=()=>{!function(){const e=Fp();if(0===e.length)return void s("‚ö†Ô∏è No restock data to export");const t=[...e].sort((e,t)=>e.timestamp-t.timestamp),n=zx(t),o=`<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="utf-8">\n  <title>Shop Restock Data Export</title>\n  <style>\n    body { font-family: Arial, sans-serif; background: #36393f; color: #dcddde; padding: 20px; }\n    .chatlog__message-group { margin-bottom: 20px; padding: 10px; background: #2f3136; border-radius: 4px; }\n    .chatlog__author { font-weight: 600; color: #7289da; margin-bottom: 8px; }\n    .chatlog__message-container { margin: 4px 0; padding: 4px 0; }\n    .chatlog__timestamp { font-size: 11px; color: #72767d; margin-right: 8px; }\n    .chatlog__short-timestamp { font-size: 11px; color: #72767d; margin-right: 8px; }\n    .chatlog__content { color: #dcddde; }\n  </style>\n</head>\n<body>\n  <h1>Shop Restock Data Export</h1>\n  <p>Total Events: ${e.length} | Exported: ${(new Date).toLocaleString()}</p>\n  <p style="font-size: 12px; color: #72767d;">Note: All times are shown in your local timezone (${Intl.DateTimeFormat().resolvedOptions().timeZone})</p>\n\n  <div class="chatlog__message-group">\n    <div class="chatlog__author">Magic Shopkeeper</div>\n${t.map(e=>{const{full:t,time:n}=function(e){const t=new Date(e),n=t.toLocaleString("en-AU",{timeZone:"Australia/Sydney",day:"2-digit",month:"2-digit",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}).replace(",",""),o=t.toLocaleTimeString("en-AU",{timeZone:"Australia/Sydney",hour:"numeric",minute:"2-digit",hour12:!0});return{full:n,time:o}}(e.timestamp);return`    <div class="chatlog__message-container">\n      <span class="chatlog__timestamp"><a>${t}</a></span>\n      <span class="chatlog__short-timestamp">${n}</span>\n      <div class="chatlog__content">${e.items.map(e=>e.quantity>0?`@${e.name} ${e.quantity}`:`@${e.name}`).join(" | ")}</div>\n    </div>`}).join("\n")}\n  </div>\n  <script id="qpm-restock-data" type="application/json">${Lx(n)}<\/script>\n</body>\n</html>`,r=new Blob([o],{type:"text/html"}),i=URL.createObjectURL(r),a=document.createElement("a");a.href=i,a.download=`qpm-shop-restock-export-${Date.now()}.html`,a.click(),URL.revokeObjectURL(i),s(`‚úÖ Exported ${e.length} restock events to HTML`)}()},n.appendChild(o);const r=document.createElement("button");r.textContent="üì¶ Export JSON (small)",r.style.cssText="\n      padding: 8px 16px;\n      background: rgba(66, 165, 245, 0.08);\n      color: #42A5F5;\n      border: 1px solid rgba(66, 165, 245, 0.6);\n      border-radius: 4px;\n      cursor: pointer;\n      font-size: 12px;\n      font-weight: 600;\n    ",r.onclick=()=>{!function(){const e=Fp();if(0===e.length)return void s("‚ö†Ô∏è No restock data to export");const t=zx([...e].sort((e,t)=>e.timestamp-t.timestamp)),n=new Blob([Lx(t)],{type:"application/json"}),o=URL.createObjectURL(n),r=document.createElement("a");r.href=o,r.download=`qpm-shop-restock-export-${Date.now()}.json`,r.click(),URL.revokeObjectURL(o),s(`‚úÖ Exported ${e.length} restock events to JSON`)}()},n.appendChild(r);const i=document.createElement("button");i.textContent="üóëÔ∏è Clear Restock Data",i.style.cssText="\n      padding: 8px 16px;\n      background: rgba(244, 67, 54, 0.2);\n      color: #f44336;\n      border: 1px solid #f44336;\n      border-radius: 4px;\n      cursor: pointer;\n      font-size: 12px;\n      font-weight: 600;\n    ",i.onclick=()=>{confirm("‚ö†Ô∏è This will clear all Shop Restock history and prediction data.\n\nYour other QPM settings (auto-feed, XP tracking, etc.) will NOT be affected.\n\nThis cannot be undone. Are you sure?")&&(_p(),Ix(e),alert("‚úÖ Shop restock history and prediction data has been cleared."))},n.appendChild(i),t.appendChild(n)}return t}(e);if(e.contentContainer.appendChild(r),t.length>0){const t=document.createElement("div");t.style.cssText="\n      text-align: center;\n      padding: 40px 20px;\n      color: var(--qpm-text-muted, #aaa);\n    ",t.textContent="‚è≥ Loading predictions and statistics...",e.contentContainer.appendChild(t),requestAnimationFrame(()=>{e.contentContainer.removeChild(t);const o=function(e){const t=document.createElement("div");t.style.cssText="\n    margin-bottom: 20px;\n    padding: 16px;\n    background: rgba(66, 165, 245, 0.1);\n    border-radius: 8px;\n    border: 2px solid rgba(66, 165, 245, 0.3);\n  ";const n=document.createElement("h4");n.textContent="üîÆ Next Rare Restock Windows",n.style.cssText="\n    margin: 0 0 4px 0;\n    color: #42A5F5;\n    font-size: 14px;\n  ",t.appendChild(n);const o=document.createElement("p");o.textContent="Window-based predictions from pseudo-RNG analysis of 34,861 events",o.style.cssText="\n    margin: 0 0 12px 0;\n    font-size: 10px;\n    color: #888;\n    font-style: italic;\n  ",t.appendChild(o);const r=Vp(),i=Wp();if(i.length>0){const e=document.createElement("div");e.style.cssText="\n      margin-bottom: 12px;\n      padding: 10px;\n      background: rgba(255, 152, 0, 0.15);\n      border: 2px solid rgba(255, 152, 0, 0.4);\n      border-radius: 6px;\n    ";const n=document.createElement("div");n.textContent="üö® Active Alerts",n.style.cssText="\n      color: #FF9800;\n      font-weight: 700;\n      font-size: 11px;\n      margin-bottom: 8px;\n      text-transform: uppercase;\n    ",e.appendChild(n);for(const t of i){const n=document.createElement("div");n.style.cssText=`\n        padding: 6px 8px;\n        margin-bottom: 4px;\n        background: rgba(0, 0, 0, 0.3);\n        border-left: 3px solid ${"high"===t.urgency?"#f44336":"medium"===t.urgency?"#FF9800":"#4CAF50"};\n        border-radius: 3px;\n        font-size: 10px;\n        color: #fff;\n      `,n.textContent=t.message,e.appendChild(n)}t.appendChild(e)}const a=[{name:"Sunflower",color:"#FFD700"},{name:"Mythical Eggs",color:"#9C27B0"},{name:"Starweaver",color:"#FFD700"},{name:"Moonbinder",color:"#CE93D8"},{name:"Dawnbinder",color:"#FF9800"}],s=document.createElement("div");s.style.cssText="\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n  ";for(const c of a){const e=r.get(c.name);if(jp(c.name),!e)continue;const t=document.createElement("div");t.style.cssText=`\n      background: rgba(0, 0, 0, 0.3);\n      border-radius: 6px;\n      border-left: 3px solid ${c.color};\n      overflow: hidden;\n    `;const n=document.createElement("div");n.style.cssText="\n      display: flex;\n      justify-content: space-between;\n      align-items: flex-start;\n      padding: 10px 12px;\n      cursor: pointer;\n      transition: background 0.2s;\n    ",n.addEventListener("mouseenter",()=>{n.style.background="rgba(255, 255, 255, 0.05)"}),n.addEventListener("mouseleave",()=>{n.style.background=""});const o=document.createElement("div");o.style.cssText="display: flex; align-items: center; gap: 8px;";const i=Fi(Qi(c.name));if(i){const e=document.createElement("img");e.src=i,e.alt=c.name,e.style.cssText="\n        width: 16px;\n        height: 16px;\n        image-rendering: pixelated;\n        border-radius: 3px;\n        border: 1px solid rgba(168, 139, 250, 0.2);\n      ",o.appendChild(e)}const a=document.createElement("span");a.textContent=c.name,a.style.cssText=`\n      color: ${c.color};\n      font-weight: 600;\n      font-size: 12px;\n    `;const l=document.createElement("span");l.textContent="‚ñº",l.style.cssText="\n      color: #aaa;\n      font-size: 10px;\n      transition: transform 0.2s;\n    ",o.appendChild(a),o.appendChild(l);const d=document.createElement("div");d.style.cssText="\n      display: flex;\n      flex-direction: column;\n      align-items: flex-end;\n      gap: 4px;\n      font-size: 10px;\n    ";const p=document.createElement("div");p.style.cssText="\n      padding: 3px 8px;\n      border-radius: 10px;\n      font-weight: 600;\n      font-size: 9px;\n      text-transform: uppercase;\n    ",e.cooldownActive?(p.textContent="‚è≥ Cooldown",p.style.cssText+="background: rgba(244, 67, 54, 0.3); color: #f44336; border: 1px solid #f44336;"):e.tooEarly?(p.textContent="‚è∞ Too Early",p.style.cssText+="background: rgba(255, 152, 0, 0.3); color: #FF9800; border: 1px solid #FF9800;"):(p.textContent="üìä Monitoring",p.style.cssText+="background: rgba(66, 165, 245, 0.3); color: #42A5F5; border: 1px solid #42A5F5;"),d.appendChild(p);const u=document.createElement("div");if(u.style.cssText="color: #42A5F5; font-size: 10px; font-weight: 600; text-align: right;",e.cooldownActive||e.tooEarly)e.cooldownActive&&null!==e.hardCooldownRemaining?(u.style.color="#f44336",u.setAttribute("data-countdown-target",String(Date.now()+60*e.hardCooldownRemaining*60*1e3)),u.setAttribute("data-countdown-prefix","Cooldown: ")):e.tooEarly&&null!==e.practicalMinimumRemaining&&(u.style.color="#FF9800",u.setAttribute("data-countdown-target",String(Date.now()+60*e.practicalMinimumRemaining*60*1e3)),u.setAttribute("data-countdown-prefix","Monitor in: "));else{let t=null,n=null;const o=Date.now();if(e.nextWindows.length>0){const r=e.nextWindows.find(e=>e.endTime>=o);r&&(t=r.startTime,n=r.endTime)}if(e.statisticalPrediction){const r=e.statisticalPrediction.certaintyRange.earliest,i=e.statisticalPrediction.certaintyRange.latest;i>=o&&(t=t?Math.min(t,r):r,n=n?Math.max(n,i):i)}if(t&&n&&n>=o){const e=new Date(t),o=new Date(n),r=e.toLocaleString([],{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}),i=o.toLocaleString([],{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0});u.textContent=`${r} - ${i}`}}if((u.textContent||u.hasAttribute("data-countdown-target"))&&d.appendChild(u),null!==e.timeSinceLastSeen){const t=document.createElement("div");t.style.cssText="color: #aaa; font-size: 9px;";const n=e.timeSinceLastSeen.toFixed(1),o=(e.timeSinceLastSeen/24).toFixed(1);t.textContent=`Last seen: ${o}d ago (${n}h)`,d.appendChild(t)}n.appendChild(o),n.appendChild(d),t.appendChild(n);const g=document.createElement("div");if(g.style.cssText="\n      display: none;\n      padding: 12px;\n      background: linear-gradient(135deg, rgba(0, 0, 0, 0.5) 0%, rgba(33, 150, 243, 0.1) 100%);\n      border-top: 1px solid rgba(255, 255, 255, 0.1);\n      font-size: 10px;\n    ",e.cooldownActive||e.tooEarly){const t=document.createElement("div");if(t.style.cssText="\n        padding: 10px;\n        background: rgba(255, 152, 0, 0.1);\n        border-left: 3px solid #FF9800;\n        border-radius: 3px;\n        margin-bottom: 10px;\n      ",e.cooldownActive&&null!==e.hardCooldownRemaining){const n=document.createElement("div");n.style.cssText="color: #f44336; font-weight: 600; margin-bottom: 4px;",n.setAttribute("data-countdown-target",String(Date.now()+60*e.hardCooldownRemaining*60*1e3)),n.setAttribute("data-countdown-prefix","‚è≥ Hard cooldown: "),t.appendChild(n)}if(e.tooEarly&&null!==e.practicalMinimumRemaining){const n=document.createElement("div");n.style.cssText="color: #FF9800; font-weight: 600; margin-bottom: 4px;",n.setAttribute("data-countdown-target",String(Date.now()+60*e.practicalMinimumRemaining*60*1e3)),n.setAttribute("data-countdown-prefix","‚è∞ Practical minimum: "),t.appendChild(n);const o=document.createElement("div");o.style.cssText="color: #888; font-size: 9px; margin-top: 4px; font-style: italic;",o.textContent="Based on historical intervals - prevents false alarms",t.appendChild(o)}g.appendChild(t)}if(e.correlationSignals&&e.correlationSignals.length>0){const t=document.createElement("div");t.style.cssText="\n        padding: 10px;\n        background: rgba(206, 147, 216, 0.1);\n        border-left: 3px solid #CE93D8;\n        border-radius: 3px;\n        margin-bottom: 10px;\n      ";const n=document.createElement("div");n.style.cssText="color: #CE93D8; font-weight: 700; margin-bottom: 6px;",n.textContent="üîó Correlation Signals",t.appendChild(n);for(const o of e.correlationSignals){const e=document.createElement("div");e.style.cssText="color: #fff; margin-bottom: 4px;";const n=(100*o.probability).toFixed(0);e.innerHTML=`<span style="color: #FFD700;">Sunflower detected</span> ‚Üí <span style="color: ${c.color};">${c.name} possible</span> <span style="color: #CE93D8;">(${n}%)</span>`,t.appendChild(e);const r=document.createElement("div");r.style.cssText="color: #888; font-size: 9px; margin-left: 12px;";const i=((Date.now()-o.detectedAt)/36e5).toFixed(1);r.textContent=`Detected ${i}h ago`,t.appendChild(r)}g.appendChild(t)}const m=Date.now(),f=e.nextWindows.filter(e=>e.endTime>=m);if(f.length>0){const e=document.createElement("div");e.style.cssText="\n        padding: 10px;\n        background: rgba(66, 165, 245, 0.1);\n        border-left: 3px solid #42A5F5;\n        border-radius: 3px;\n        margin-bottom: 10px;\n      ";const t=document.createElement("div");t.style.cssText="color: #42A5F5; font-weight: 700; margin-bottom: 6px;",t.textContent="üìÖ Next Possible Windows",e.appendChild(t);for(let n=0;n<Math.min(5,f.length);n++){const t=f[n],o=document.createElement("div");o.style.cssText="\n          padding: 6px 8px;\n          margin-bottom: 4px;\n          background: rgba(0, 0, 0, 0.3);\n          border-radius: 3px;\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n        ";const r=document.createElement("span");r.style.cssText="color: #fff;",r.textContent=Zd(t);const i=document.createElement("span");i.style.cssText="\n          padding: 2px 6px;\n          border-radius: 8px;\n          font-size: 8px;\n          font-weight: 700;\n          text-transform: uppercase;\n        ","high"===t.confidence?(i.textContent="HIGH",i.style.cssText+="background: #4CAF50; color: white;"):"medium"===t.confidence?(i.textContent="MED",i.style.cssText+="background: #FF9800; color: white;"):(i.textContent="LOW",i.style.cssText+="background: #666; color: white;"),o.appendChild(r),o.appendChild(i),e.appendChild(o)}g.appendChild(e)}if(e.monitoringSchedule){const t=document.createElement("div");t.style.cssText="\n        padding: 10px;\n        background: rgba(76, 175, 80, 0.1);\n        border-left: 3px solid #4CAF50;\n        border-radius: 3px;\n        margin-bottom: 10px;\n      ";const n=document.createElement("div");n.style.cssText="color: #4CAF50; font-weight: 700; margin-bottom: 6px;",n.textContent="‚è∞ Monitoring Schedule",t.appendChild(n);const o=document.createElement("div");o.style.cssText="color: #aaa; margin-bottom: 6px;",o.textContent=e.monitoringSchedule.message,t.appendChild(o);const r=document.createElement("div");r.style.cssText="display: flex; flex-wrap: wrap; gap: 4px;";const i=(new Date).getHours();for(const a of e.monitoringSchedule.optimalHours){const e=document.createElement("span"),t=a===i;e.style.cssText=`\n          padding: 3px 6px;\n          background: ${t?"rgba(76, 175, 80, 0.3)":"rgba(244, 67, 54, 0.3)"};\n          border: 1px solid ${t?"#4CAF50":"#f44336"};\n          border-radius: 4px;\n          font-size: 9px;\n          font-weight: 600;\n          color: ${t?"#4CAF50":"#f44336"};\n        `;const n=0===a?12:a>12?a-12:a,o=a>=12?"PM":"AM";e.textContent=`${n}${o}`,r.appendChild(e)}t.appendChild(r),g.appendChild(t)}const h=Fp().filter(e=>e.items.some(e=>e.name===c.name)).sort((e,t)=>t.timestamp-e.timestamp).slice(0,3);if(h.length>0){const e=document.createElement("div");e.style.cssText="\n        padding: 10px;\n        background: rgba(0, 0, 0, 0.3);\n        border-top: 1px solid rgba(255, 255, 255, 0.1);\n        border-radius: 3px;\n      ";const t=document.createElement("div");t.style.cssText="color: #42A5F5; font-weight: 700; margin-bottom: 6px;",t.textContent="üìä Past 3 Restocks",e.appendChild(t);for(const n of h){const t=new Date(n.timestamp),o=document.createElement("div");o.style.cssText="\n          color: #aaa;\n          font-size: 9px;\n          margin-bottom: 4px;\n          padding: 4px 6px;\n          background: rgba(255, 255, 255, 0.03);\n          border-radius: 3px;\n        ",o.innerHTML=`\n          <span style="color: #4CAF50;">‚úì</span> ${t.toLocaleString([],{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}\n        `,e.appendChild(o)}g.appendChild(e)}t.appendChild(g);let b=!1;n.addEventListener("click",()=>{b=!b,g.style.display=b?"block":"none",l.style.transform=b?"rotate(180deg)":""}),s.appendChild(t)}t.appendChild(s);const l=()=>{const e=Date.now();t.querySelectorAll("[data-countdown-target]").forEach(t=>{const n=t,o=parseInt(n.getAttribute("data-countdown-target")||"0",10),r=n.getAttribute("data-countdown-prefix")||"";if(o>0){const t=o-e;if(t<=0)n.textContent=r+"00d 00h 00m 00s",n.style.color="#4CAF50";else{const e=Math.floor(t/864e5),o=Math.floor(t%864e5/36e5),i=Math.floor(t%36e5/6e4),a=Math.floor(t%6e4/1e3),s=`${e.toString().padStart(2,"0")}d ${o.toString().padStart(2,"0")}h ${i.toString().padStart(2,"0")}m ${a.toString().padStart(2,"0")}s`;n.textContent=r+s}}})};l(),null!==e.countdownInterval&&e.countdownInterval();return e.countdownInterval=re("shop-restock-countdown",()=>{document.contains(t)?l():null!==e.countdownInterval&&(e.countdownInterval(),e.countdownInterval=null)},1e3),t}(e);e.contentContainer.appendChild(o);const r=function(e){const t=document.createElement("div");t.style.cssText="\n    margin-bottom: 20px;\n    padding: 16px;\n    background: rgba(255, 255, 255, 0.05);\n    border-radius: 8px;\n  ";const n=document.createElement("h4");n.textContent="üìä Summary Statistics",n.style.cssText="\n    margin: 0 0 12px 0;\n    color: var(--qpm-accent, #4CAF50);\n    font-size: 14px;\n  ",t.appendChild(n);const o=document.createElement("div");o.style.cssText="\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n    gap: 12px;\n  ";const r=[{label:"Total Restocks",value:$x(e.totalRestocks),icon:"üîÑ"},{label:"Unique Items",value:$x(e.uniqueItems),icon:"üì¶"},{label:"Avg Interval",value:`${e.avgRestockInterval.toFixed(1)} min`,icon:"‚è±Ô∏è"},{label:"Total Items",value:$x(e.totalItems),icon:"üìä"}];e.dateRange&&r.push({label:"First Restock",value:Mx(e.dateRange.start),icon:"üìÖ"},{label:"Last Restock",value:Mx(e.dateRange.end),icon:"üìÖ"});for(const i of r){const e=document.createElement("div");e.style.cssText="\n      padding: 12px;\n      background: rgba(0, 0, 0, 0.3);\n      border-radius: 4px;\n      border: 1px solid rgba(255, 255, 255, 0.1);\n    ";const t=document.createElement("div");t.textContent=`${i.icon} ${i.label}`,t.style.cssText="\n      font-size: 11px;\n      color: var(--qpm-text-muted, #aaa);\n      margin-bottom: 4px;\n    ";const n=document.createElement("div");n.textContent=i.value,n.style.cssText="\n      font-size: 16px;\n      font-weight: 600;\n      color: var(--qpm-text, #fff);\n    ",e.appendChild(t),e.appendChild(n),o.appendChild(e)}return t.appendChild(o),t}(n);e.contentContainer.appendChild(r);const i=function(){const e=document.createElement("div");e.style.cssText="\n    margin-bottom: 20px;\n  ";const t=document.createElement("h4");t.textContent="üéØ Item Statistics",t.style.cssText="\n    margin: 0 0 12px 0;\n    color: var(--qpm-accent, #4CAF50);\n    font-size: 14px;\n  ",e.appendChild(t);const n=zp(),o=Array.from(n.values()).filter(e=>"unknown"!==e.type).sort((e,t)=>t.totalRestocks-e.totalRestocks),r=30;let i=r,a=!1;const s=document.createElement("table");s.style.cssText="\n    width: 100%;\n    border-collapse: collapse;\n    font-size: 12px;\n  ";const l=document.createElement("thead"),c=document.createElement("tr");c.style.cssText="\n    border-bottom: 2px solid var(--qpm-border, #444);\n    background: rgba(255, 255, 255, 0.05);\n  ";const d=["Item","Type","Restocks","Avg Qty","Rate","Rarity","Last Seen","Next Restock"];for(const g of d){const e=document.createElement("th");e.textContent=g,e.style.cssText="\n      padding: 10px 12px;\n      text-align: left;\n      color: var(--qpm-text-muted, #aaa);\n      font-weight: 600;\n    ",c.appendChild(e)}l.appendChild(c),s.appendChild(l);const p=document.createElement("tbody"),u=e=>{const t=document.createElement("tr");t.style.cssText="\n      border-bottom: 1px solid var(--qpm-border, #444);\n    ";const n={common:"#aaa",uncommon:"#4CAF50",rare:"#42A5F5",mythic:"#9C27B0",divine:"#FF9800",celestial:"#FFD700"};let o="N/A",r="font-size: 11px; color: #aaa;";const i=Np(e.name);if(i){const e=new Date(i),t=e.toLocaleTimeString([],{hour:"numeric",minute:"2-digit",hour12:!0});o=`${e.toLocaleDateString([],{month:"short",day:"numeric"})} ${t}`,r="font-size: 11px; color: #42A5F5; font-weight: 600;"}const a=[{value:e.type,style:"text-transform: capitalize; color: #aaa;"},{value:$x(e.totalRestocks),style:""},{value:e.avgQuantity.toFixed(1),style:""},{value:`${e.appearanceRate.toFixed(1)}%`,style:""},{value:e.rarity,style:`color: ${n[e.rarity]}; text-transform: capitalize; font-weight: 600;`},{value:new Date(e.lastSeen).toLocaleDateString(),style:"font-size: 11px; color: #aaa;"},{value:o,style:r}],s=document.createElement("td");s.style.cssText="padding: 10px 12px; font-weight: 600;";const l=document.createElement("div");l.style.cssText="display: flex; align-items: center; gap: 6px;";let c=null;if(c="Mythical Eggs"===e.name||"Mythical Egg"===e.name?Fi(Yi("MythicalEgg")):Fi(Qi(e.name)),c){const t=document.createElement("img");t.src=c,t.alt=e.name,t.style.cssText="width: 20px; height: 20px; object-fit: contain; image-rendering: pixelated; flex-shrink: 0;",l.appendChild(t)}const d=document.createElement("span");d.textContent=e.name,l.appendChild(d),s.appendChild(l),t.appendChild(s);for(const p of a){const e=document.createElement("td");e.textContent=p.value,e.style.cssText=`\n        padding: 10px 12px;\n        ${p.style}\n      `,t.appendChild(e)}return t};for(let g=0;g<Math.min(r,o.length);g++)p.appendChild(u(o[g]));if(s.appendChild(p),e.appendChild(s),o.length>r){const t=document.createElement("button");t.textContent=`üìã Show All Items (${o.length-r} more)`,t.style.cssText="\n      width: 100%;\n      padding: 10px;\n      margin-top: 12px;\n      background: rgba(66, 165, 245, 0.15);\n      border: 1px solid rgba(66, 165, 245, 0.3);\n      color: #42A5F5;\n      font-size: 12px;\n      font-weight: 600;\n      cursor: pointer;\n      border-radius: 4px;\n      transition: all 0.2s;\n    ",t.addEventListener("mouseenter",()=>{t.style.background="rgba(66, 165, 245, 0.25)"}),t.addEventListener("mouseleave",()=>{t.style.background=a?"rgba(66, 165, 245, 0.2)":"rgba(66, 165, 245, 0.15)"}),t.addEventListener("click",()=>{if(a){for(;p.children.length>r;)p.removeChild(p.lastChild);i=r,a=!1,t.textContent=`üìã Show All Items (${o.length-r} more)`,t.style.background="rgba(66, 165, 245, 0.15)"}else t.textContent="‚è≥ Loading...",t.disabled=!0,requestAnimationFrame(()=>{for(let e=i;e<o.length;e++)p.appendChild(u(o[e]));i=o.length,a=!0,t.textContent="üìã Show Less",t.disabled=!1,t.style.background="rgba(66, 165, 245, 0.2)"})}),e.appendChild(t)}return e}();e.contentContainer.appendChild(i)})}else{const t=document.createElement("div");t.style.cssText="\n      text-align: center;\n      padding: 40px 20px;\n      color: var(--qpm-text-muted, #aaa);\n      font-style: italic;\n    ",t.textContent="No restock data imported yet. Upload a Discord HTML export to get started!",e.contentContainer.appendChild(t)}}function Fx(){const e=document.createElement("div");e.style.cssText="\n    margin-bottom: 20px;\n    padding: 16px;\n    background: rgba(76, 175, 80, 0.1);\n    border-radius: 8px;\n    border: 2px solid rgba(76, 175, 80, 0.3);\n  ";const t=document.createElement("h4");t.textContent="üì° Live Shop Monitoring",t.style.cssText="\n    margin: 0 0 12px 0;\n    color: var(--qpm-accent, #4CAF50);\n    font-size: 14px;\n  ",e.appendChild(t);const n=document.createElement("div"),o=lu,r=xu();n.style.cssText="\n    margin-bottom: 12px;\n    font-size: 12px;\n    padding: 8px 12px;\n    background: rgba(0, 0, 0, 0.3);\n    border-radius: 4px;\n  ",n.innerHTML=o?'<span style="color: #4CAF50;">‚óè Active</span> - Monitoring shop for restocks in real-time':'<span style="color: #aaa;">‚óã Inactive</span> - Live tracking is not running',e.appendChild(n);const i=document.createElement("p");i.style.cssText="\n    margin: 0 0 12px 0;\n    font-size: 12px;\n    color: var(--qpm-text-muted, #aaa);\n    line-height: 1.5;\n  ",i.textContent="Automatically detects and records shop restocks while you play.",e.appendChild(i);const a=document.createElement("button");return a.textContent=r?"üõë Disable Live Tracking":"‚ñ∂Ô∏è Enable Live Tracking",a.style.cssText=`\n    padding: 8px 16px;\n    background: ${r?"rgba(244, 67, 54, 0.2)":"rgba(76, 175, 80, 0.2)"};\n    color: ${r?"#f44336":"#4CAF50"};\n    border: 1px solid ${r?"#f44336":"#4CAF50"};\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 12px;\n    font-weight: 600;\n  `,a.onclick=()=>{r?yu():(cu=!0,lu||bu());const t=e.parentElement;if(t){const n=Fx();t.replaceChild(n,e)}},e.appendChild(a),e}function zx(e){return{version:"2025-12-08",exportedAt:Date.now(),timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,events:e.map(e=>({id:e.id,timestamp:e.timestamp,dateString:e.dateString,source:e.source,items:e.items.map(e=>({name:e.name,quantity:e.quantity,type:e.type}))}))}}function Lx(e){return JSON.stringify(e).replace(/</g,"\\u003c")}function Rx(e){const t=e.getBoundingClientRect(),n=window.innerWidth,o=window.innerHeight;let r=parseFloat(e.style.top)||t.top,i=parseFloat(e.style.left)||t.left,a=parseFloat(e.style.right);isNaN(a)||""===e.style.right||(i=n-t.right,e.style.right="");const s=Math.max(8,n-t.width-8),l=Math.max(8,o-t.height-8);i=Math.min(Math.max(i,8),s),r=Math.min(Math.max(r,8),l),e.style.left=`${i}px`,e.style.top=`${r}px`}const qx=Object.freeze(Object.defineProperty({__proto__:null,createShopRestockWindow:function(){const e=document.createElement("div");e.style.cssText="\n    position: fixed;\n    top: 80px;\n    right: 20px;\n    width: 900px;\n    max-height: 80vh;\n    overflow-y: auto;\n    background: var(--qpm-background, rgba(0, 0, 0, 0.92));\n    border: 2px solid var(--qpm-border, #555);\n    border-radius: 8px;\n    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);\n    z-index: 10003;\n    font-family: Arial, sans-serif;\n    display: none;\n  ";const t=document.createElement("div");t.style.cssText="\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 12px 16px;\n    background: var(--qpm-surface-1, #1a1a1a);\n    border-bottom: 2px solid var(--qpm-border, #555);\n    cursor: move;\n  ";const n=document.createElement("h3");n.textContent="üè™ Shop Restock Tracker",n.style.cssText="\n    margin: 0;\n    color: var(--qpm-text, #fff);\n    font-size: 16px;\n    font-weight: 600;\n  ";const o=document.createElement("button");o.textContent="‚úï",o.style.cssText="\n    background: transparent;\n    border: none;\n    color: var(--qpm-text, #fff);\n    font-size: 20px;\n    cursor: pointer;\n    padding: 0 8px;\n    line-height: 1;\n  ",o.onclick=()=>{e.style.display="none"},t.appendChild(n),t.appendChild(o),e.appendChild(t);const r=document.createElement("div");r.style.cssText="\n    padding: 16px;\n    color: var(--qpm-text, #fff);\n  ",e.appendChild(r),function(e,t){let n=0,o=0,r=0,i=0;function a(e){e.preventDefault(),r=e.clientX,i=e.clientY,document.onmouseup=l,document.onmousemove=s}function s(t){t.preventDefault(),n=r-t.clientX,o=i-t.clientY,r=t.clientX,i=t.clientY,e.style.top=e.offsetTop-o+"px",e.style.left=e.offsetLeft-n+"px"}function l(){document.onmouseup=null,document.onmousemove=null,Rx(e)}t.onmousedown=a}(e,t),document.body.appendChild(e);const i={root:e,contentContainer:r,countdownInterval:null,resizeListener:null},a=()=>{"none"!==e.style.display&&Rx(e)};window.addEventListener("resize",a),i.resizeListener=a,$p(),xu()&&bu(),Ix(i);let s=null;return Op(()=>{null!==s&&clearTimeout(s),s=window.setTimeout(()=>{s=null,Ix(i)},500)}),i},hideShopRestockWindow:function(e){e.root.style.display="none"},showShopRestockWindow:function(e){e.root.style.display="block"}},Symbol.toStringTag,{value:"Module"}));function Nx(e){return e.charAt(0).toUpperCase()+e.slice(1)}function Bx(e){e.innerHTML="",e.style.cssText="\n    padding: 20px;\n    display: flex;\n    flex-direction: column;\n    gap: 16px;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n  ";const t=Hf(),n={...$f};if(!t){const t=document.createElement("div");return t.style.cssText="\n      text-align: center;\n      padding: 40px 20px;\n      color: rgba(255, 255, 255, 0.5);\n      font-size: 14px;\n    ",t.innerHTML='\n      <div style="font-size: 48px; margin-bottom: 12px;">üêæ</div>\n      <div style="font-weight: 500; margin-bottom: 8px;">No Crop Size Boost pets active</div>\n      <div style="font-size: 12px;">Add pets with "Crop Size Boost I" or "Crop Size Boost II" abilities</div>\n    ',void e.appendChild(t)}const o=document.createElement("div");o.style.cssText="\n    padding: 16px;\n    background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(76, 175, 80, 0.05));\n    border: 1px solid rgba(76, 175, 80, 0.3);\n    border-radius: 8px;\n  ";const r=document.createElement("div");r.style.cssText="font-size: 14px; font-weight: 600; color: #4CAF50; margin-bottom: 8px;",r.textContent=`üêæ ${t.totalBoostPets} Active Boost Pet${1!==t.totalBoostPets?"s":""}`,o.appendChild(r);const i=document.createElement("div");i.style.cssText="display: flex; flex-direction: column; gap: 6px; font-size: 12px;",t.boostPets.forEach(e=>{const t=document.createElement("div");var n;t.style.cssText="color: rgba(255, 255, 255, 0.8);",t.innerHTML=`\n      ‚Ä¢ <strong>${e.displayName}</strong>: ${e.abilityName}\n      <span style="color: #4CAF50; font-weight: 600;">(+${n=e.effectiveBoostPercent,n.toFixed(1)}% per proc)</span>\n    `,i.appendChild(t)}),o.appendChild(i);const a=document.createElement("div");a.style.cssText="margin-top: 12px; padding: 8px; background: rgba(255, 152, 0, 0.1); border: 1px solid rgba(255, 152, 0, 0.3); border-radius: 4px; font-size: 11px; color: rgba(255, 255, 255, 0.7);",a.innerHTML='\n    <div style="font-weight: 600; color: #FF9800; margin-bottom: 4px;">‚ö†Ô∏è Important Notes:</div>\n    <div>‚Ä¢ Crop Size Boost abilities do <strong>NOT stack</strong> - only the weakest boost is used in calculations</div>\n    <div>‚Ä¢ Time estimates are conservative and include RNG variance</div>\n  ',o.appendChild(a),e.appendChild(o);const s=document.createElement("div");s.style.cssText="\n    padding: 14px 18px;\n    background: linear-gradient(135deg, rgba(76, 175, 80, 0.15), rgba(76, 175, 80, 0.05));\n    border: 2px solid rgba(76, 175, 80, 0.4);\n    border-radius: 8px;\n    margin-bottom: 16px;\n    box-shadow: 0 2px 8px rgba(76, 175, 80, 0.1);\n  ";const l=document.createElement("div");l.style.cssText="font-size: 12px; font-weight: 700; color: #4CAF50; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.8px; display: flex; align-items: center; gap: 6px;",l.innerHTML="üìñ <span>Crop Status Legend</span>",s.appendChild(l);const c=document.createElement("div");c.style.cssText="display: flex; gap: 24px; font-size: 13px; color: rgba(255, 255, 255, 0.9);",c.innerHTML='\n    <div style="display: flex; align-items: center; gap: 8px; padding: 6px 12px; background: rgba(255, 255, 255, 0.08); border-radius: 6px;">\n      <span style="font-size: 20px;">üå±</span>\n      <span style="font-weight: 600;">Still Growing</span>\n    </div>\n    <div style="display: flex; align-items: center; gap: 8px; padding: 6px 12px; background: rgba(255, 255, 255, 0.08); border-radius: 6px;">\n      <span style="font-size: 20px;">üåæ</span>\n      <span style="font-weight: 600;">Fully Grown (Mature)</span>\n    </div>\n  ',s.appendChild(c),e.appendChild(s);const d=document.createElement("div");d.style.cssText="\n    display: flex;\n    justify-content: flex-end;\n    gap: 8px;\n  ";const p=document.createElement("button");p.style.cssText="\n    padding: 6px 12px;\n    background: rgba(100, 181, 246, 0.2);\n    border: 1px solid #64B5F6;\n    border-radius: 4px;\n    color: #64B5F6;\n    font-size: 12px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.2s;\n  ",p.textContent=_x?"üìä Simple View":"üìà Detailed View",p.addEventListener("click",()=>{_x=!_x,Dx&&Bx(Dx)}),p.addEventListener("mouseenter",()=>{p.style.background="rgba(100, 181, 246, 0.3)"}),p.addEventListener("mouseleave",()=>{p.style.background="rgba(100, 181, 246, 0.2)"}),d.appendChild(p),e.appendChild(d);const u=document.createElement("div");u.style.cssText="\n    padding: 16px;\n    background: rgba(255, 255, 255, 0.05);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: 8px;\n  ";const g=document.createElement("div");g.style.cssText="font-size: 13px; font-weight: 600; color: rgba(255, 255, 255, 0.7); margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.5px;",g.textContent="üìä Overall Progress",u.appendChild(g);const m=document.createElement("div");m.style.cssText="\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));\n    gap: 12px;\n  ";if([{label:"Total Crops",value:t.crops.length,color:"#fff"},{label:"At Max Size",value:t.totalCropsAtMax,color:"#4CAF50"},{label:"Crops Needing Boost",value:t.totalCropsNeedingBoost,color:"#FF9800"},{label:"Progress",value:`${t.crops.length>0?Math.round(t.totalCropsAtMax/t.crops.length*100):0}%`,color:"#64B5F6"}].forEach(({label:e,value:t,color:n})=>{const o=document.createElement("div");o.innerHTML=`\n      <div style="font-size: 11px; color: rgba(255, 255, 255, 0.6); margin-bottom: 4px;">${e}</div>\n      <div style="font-size: 20px; font-weight: 600; color: ${n};">${t}</div>\n    `,m.appendChild(o)}),u.appendChild(m),e.appendChild(u),t.totalCropsNeedingBoost>0){const n=document.createElement("div");n.style.cssText="\n      padding: 16px;\n      background: linear-gradient(135deg, rgba(255, 193, 7, 0.15), rgba(255, 193, 7, 0.05));\n      border: 2px solid rgba(255, 193, 7, 0.4);\n      border-radius: 8px;\n    ",n.setAttribute("data-countdown-section","overall");const o=document.createElement("div");o.style.cssText="font-size: 14px; font-weight: 600; color: #FFC107; margin-bottom: 12px;",o.textContent="üéØ Time Until All Crops Max Size",n.appendChild(o);const r=document.createElement("div");if(r.style.cssText="font-size: 13px; color: rgba(255, 255, 255, 0.9); margin-bottom: 8px;",r.innerHTML=`<strong>Boosts Needed:</strong> ${t.overallEstimate.boostsNeeded}`,n.appendChild(r),_x){const e=document.createElement("div");e.style.cssText="font-size: 16px; font-weight: 600; color: #FFC107; margin-bottom: 8px;";const o=Of(t.overallEstimate.timeEstimateP10,t.overallEstimate.timeEstimateP50,t.overallEstimate.timeEstimateP90);e.innerHTML=`‚è∞ ${o}`,n.appendChild(e);const r=document.createElement("div");r.style.cssText="font-size: 11px; color: rgba(255, 255, 255, 0.5); margin-top: 4px; font-style: italic;",r.textContent="* Time estimates based on combined proc rates (P10-P90 range, median)",n.appendChild(r)}else{const e=document.createElement("div");if(e.style.cssText="font-size: 16px; font-weight: 600; color: #FFC107;",e.setAttribute("data-next-boost-range","true"),t.boostPets.length>0){const n=1-t.boostPets.map(e=>e.effectiveProcChance/60/100).reduce((e,t)=>e*(1-t),1);if(n>0){const t=Math.log(1-n),o=Math.log(.9)/t,r=Math.log(.1)/t,i=_f(o/60),a=_f(r/60);e.innerHTML=`‚è∞ Next boost: <span style="color: #FFC107;">${i} - ${a}</span>`}}else e.innerHTML='‚è∞ Next boost: <span style="color: #999;">No boost pets</span>';n.appendChild(e)}e.appendChild(n)}const f=document.createElement("div");f.style.cssText="\n    padding: 16px;\n    background: rgba(255, 255, 255, 0.05);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: 8px;\n  ";const h=document.createElement("div");h.style.cssText="font-size: 13px; font-weight: 600; color: rgba(255, 255, 255, 0.7); margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.5px;",h.textContent="üå± View Specific Crop",f.appendChild(h);const b=document.createElement("div");b.style.cssText="display: flex; gap: 12px; align-items: center;";const y=document.createElement("select");y.style.cssText="\n    flex: 1;\n    padding: 8px 12px;\n    background: rgba(0, 0, 0, 0.3);\n    border: 1px solid rgba(255, 255, 255, 0.2);\n    border-radius: 4px;\n    color: #fff;\n    font-size: 14px;\n    cursor: pointer;\n  ";const x=document.createElement("option");x.value="",x.textContent="All Crops",y.appendChild(x);const v=function(){const e=Hf();if(!e)return[];const t=new Set;for(const n of e.crops)t.add(n.species);return Array.from(t).sort()}();v.forEach(e=>{const t=document.createElement("option");t.value=e,t.textContent=Nx(e),y.appendChild(t)}),y.value=n.selectedSpecies??"",y.addEventListener("change",()=>{Rf(y.value||null),Dx&&Bx(Dx)}),b.appendChild(y),f.appendChild(b),e.appendChild(f);const w=n.selectedSpecies,C=(w?t.crops.filter(e=>e.species===w):t.crops).filter(e=>e.sizeRemaining>0);if(C.sort((e,n)=>{const o=`${e.tileKey}-${e.slotIndex}`,r=`${n.tileKey}-${n.slotIndex}`,i=t.cropEstimates.get(o),a=t.cropEstimates.get(r),s=i?.boostsNeeded??0;return(a?.boostsNeeded??0)-s}),C.length>0){const n=document.createElement("div");n.style.cssText="\n      padding: 16px;\n      background: rgba(255, 255, 255, 0.02);\n      border: 1px solid rgba(255, 255, 255, 0.1);\n      border-radius: 8px;\n    ";const o=document.createElement("div");o.style.cssText="font-size: 13px; font-weight: 600; color: rgba(255, 255, 255, 0.7); margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.5px;",o.textContent=w?`üåæ ${Nx(w)} Crops (${C.length})`:`üåæ All Crops Needing Boosts (${C.length})`,n.appendChild(o);const r=document.createElement("table");r.style.cssText="\n      width: 100%;\n      border-collapse: collapse;\n      font-size: 13px;\n    ";const i=document.createElement("thead");i.innerHTML=`\n      <tr>\n        <th style="text-align: left; padding: 10px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); color: rgba(255, 255, 255, 0.6); font-weight: 600; text-transform: uppercase; font-size: 11px;">Crop</th>\n        <th style="text-align: right; padding: 10px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); color: rgba(255, 255, 255, 0.6); font-weight: 600; text-transform: uppercase; font-size: 11px;">Size</th>\n        <th style="text-align: right; padding: 10px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); color: rgba(255, 255, 255, 0.6); font-weight: 600; text-transform: uppercase; font-size: 11px;">Boosts</th>\n        <th style="text-align: right; padding: 10px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); color: rgba(255, 255, 255, 0.6); font-weight: 600; text-transform: uppercase; font-size: 11px;">${_x?"Time Estimate":"Next Boost"}</th>\n      </tr>\n    `,r.appendChild(i);const a=document.createElement("tbody");C.forEach((e,n)=>{const o=`${e.tileKey}-${e.slotIndex}`,r=t.cropEstimates.get(o),i=document.createElement("tr");i.style.cssText="\n        border-bottom: 1px solid rgba(255, 255, 255, 0.05);\n        transition: background 0.2s;\n      ",i.addEventListener("mouseenter",()=>{i.style.background="rgba(76, 175, 80, 0.1)"}),i.addEventListener("mouseleave",()=>{i.style.background="transparent"});const s=document.createElement("td");s.style.cssText="padding: 12px 10px; display: flex; align-items: center; gap: 8px;";const l=document.createElement("span");l.textContent=e.isMature?"üåæ":"üå±",l.style.cssText="font-size: 16px; flex-shrink: 0;";const c=document.createElement("div");c.style.cssText="\n        width: 24px;\n        height: 24px;\n        background-size: contain;\n        background-repeat: no-repeat;\n        background-position: center;\n        flex-shrink: 0;\n        image-rendering: pixelated;\n      ";let d=e.species;const p=[...e.mutations||[]],u=["Rainbow","Gold","Golden","Frozen","Amber","Wet","Chilled","Dawnlit"];for(const t of u)if(d.startsWith(t+" ")){d=d.substring(t.length+1),p.includes(t)||p.push("Golden"===t?"Gold":t);break}const g=d.charAt(0).toUpperCase()+d.slice(1).toLowerCase();let m=null;p.length>0&&(m=Fi(Ji(g,p))),m||(m=Fi(Qi(g))),m?(c.style.backgroundImage=`url(${m})`,c.setAttribute("data-qpm-sprite",`crop:${g}${p.length>0?":"+p.join(","):""}`)):(c.style.background="linear-gradient(135deg, #4CAF50 0%, #45a049 100%)",c.setAttribute("data-qpm-sprite",`crop:${g}`));const f=document.createElement("span"),h=e.mutations.length>0?` <span style="color: #FFD700;">(${e.mutations.join(", ")})</span>`:"";f.innerHTML=`${Nx(e.species)}${h}`,s.appendChild(l),s.appendChild(c),s.appendChild(f),i.appendChild(s);const b=document.createElement("td");b.style.cssText="padding: 12px 10px; text-align: right;";const y=e.currentSizePercent.toFixed(1);b.innerHTML=`<span style="color: ${e.currentSizePercent>=90?"#4CAF50":e.currentSizePercent>=70?"#FF9800":"#fff"}; font-weight: 600;">${y}%</span>`,i.appendChild(b);const x=document.createElement("td");x.style.cssText="padding: 12px 10px; text-align: right;",r&&_x?x.innerHTML=`<span style="color: #64B5F6; font-weight: 600;">${r.boostsReceived}/${r.boostsNeeded}</span>`:r?x.innerHTML=`<span style="color: #64B5F6; font-weight: 600;">${r.boostsNeeded}</span>`:x.textContent="N/A",i.appendChild(x);const v=document.createElement("td");if(v.style.cssText="padding: 12px 10px; text-align: right; color: #FFC107; font-weight: 500;",r)if(_x){const e=Of(r.timeEstimateP10,r.timeEstimateP50,r.timeEstimateP90);v.textContent=e}else{const e=_f(r.timeEstimateP10),t=_f(r.timeEstimateP90);v.innerHTML=`<span style="color: #FFC107;">${e} - ${t}</span>`}else v.textContent="N/A";i.appendChild(v),a.appendChild(i)}),r.appendChild(a),n.appendChild(r),e.appendChild(n)}else{const t=document.createElement("div");t.style.cssText="\n      padding: 24px;\n      text-align: center;\n      background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(76, 175, 80, 0.05));\n      border: 2px solid rgba(76, 175, 80, 0.4);\n      border-radius: 8px;\n      color: #4CAF50;\n    ",t.innerHTML=`\n      <div style="font-size: 48px; margin-bottom: 12px;">‚ú®</div>\n      <div style="font-size: 16px; font-weight: 600; margin-bottom: 8px;">All crops ${w?`(${Nx(w)}) `:""}are at maximum size!</div>\n      <div style="font-size: 13px; color: rgba(255, 255, 255, 0.6);">You're doing great! üéâ</div>\n    `,e.appendChild(t)}}let Dx=null,Hx=!1,jx=null,_x=!1;const Ox=Object.freeze(Object.defineProperty({__proto__:null,openCropBoostTrackerWindow:function(){lc("crop-boost-tracker","üå± Crop Size Boost Tracker",e=>{Dx=e,Hx||(Ff=()=>{jx&&clearTimeout(jx),jx=window.setTimeout(()=>{const e=document.activeElement;e&&"SELECT"===e.tagName||Dx&&Bx(Dx)},100)},Hx=!0),Bx(e)},"650px","75vh")}},Symbol.toStringTag,{value:"Module"}));let Gx=!1,Vx=null;const Wx=new Map,Ux=new Set;let Xx=0,Qx=!1;let Jx=null;let Kx=!1;const Yx=["common","uncommon","rare","legendary","mythical","divine","celestial"],Zx=Yx.reduce((e,t,n)=>(e[t]=n,e),{}),ev={common:{bg:"#1f2430",color:"#e0e0e0",border:"#2f3644",bar:"linear-gradient(90deg, #9ea7b8, #c7cfdd)",accent:"#c7cfdd"},uncommon:{bg:"#1f3024",color:"#d7f7df",border:"#3a5f44",bar:"linear-gradient(90deg, #5bbf7a, #8ee0a8)",accent:"#8ee0a8"},rare:{bg:"#1f233a",color:"#e6e1ff",border:"#5b5fa8",bar:"linear-gradient(90deg, #6d7dff, #a48bff)",accent:"#a48bff"},legendary:{bg:"#2c210f",color:"#ffecc2",border:"#d9a441",bar:"linear-gradient(90deg, #ffcc55, #ffdf99)",accent:"#ffcc55"},mythical:{bg:"#271a3a",color:"#f2d9ff",border:"#9b6bdf",bar:"linear-gradient(90deg, #b377ff, #e2c3ff)",accent:"#d3a2ff"},divine:{bg:"#301616",color:"#ffe4d7",border:"#d46b4e",bar:"linear-gradient(90deg, #ff7b4a, #ffc2a1)",accent:"#ff9e7a"},celestial:{bg:"linear-gradient(120deg, #1b1f3a, #1f2f46, #2f1f46)",color:"#f8fbff",border:"rgba(255,255,255,0.85)",bar:"linear-gradient(90deg, #ff6ec7, #ffd166, #6ec8ff, #b37bff, #ff6ec7)",accent:"#ffd166"}};function tv(e){const t=Math.abs(e),n=e=>{const t=e.toFixed(1);return t.endsWith(".0")?t.slice(0,-2):t};return t>=1e15?`${n(t/1e15)}Q`:t>=1e12?`${n(t/1e12)}T`:t>=1e9?`${n(t/1e9)}B`:t>=1e6?`${n(t/1e6)}M`:t>=1e3?`${n(t/1e3)}K`:e.toLocaleString()}function nv(){!Jx&&"undefined"!=typeof window&&"IntersectionObserver"in window&&(Jx=new IntersectionObserver(e=>{for(const t of e){if(!t.isIntersecting)continue;const e=t.target;Jx?.unobserve(e),ov(e)}},{rootMargin:"128px 0px 256px 0px"}))}function ov(e){Ux.add(e),iv()}function rv(){if(Kx)return;Kx=!0;const e=window.requestIdleCallback,t=()=>{Kx=!1,function(){if(!gv)return;if(!Ux.size)return;let e=0;const t=performance.now();for(const n of Array.from(Ux))if(Ux.delete(n),sv(n),e+=1,e>=32||performance.now()-t>=24)break;Ux.size&&rv()}()};"function"==typeof e?e(t,{timeout:500}):setTimeout(t,32)}function iv(){if(Qx)return;Qx=!0;const e="undefined"!=typeof window?window.requestAnimationFrame:null;"function"==typeof e?e(av):setTimeout(av,16)}function av(){if(Qx=!1,!gv)return;if(!Ux.size)return;const e=performance.now();let t=0;for(const n of Array.from(Ux))if(Ux.delete(n),sv(n),t+=1,t>=4||performance.now()-e>=12)break;Ux.size&&iv()}function sv(e){if(!gv)return void ov(e);const t=e.dataset.achievementSpriteId;if(!t)return;const n=Wx.get(t);if(!n)return void e.removeAttribute("data-achievement-sprite-id");const o=n();o&&(e.style.backgroundImage=`url(${o})`),e.dataset.achievementSpriteHydrated="1",e.removeAttribute("data-achievement-sprite-id"),Wx.delete(t)}function lv(e,t){const n="ach-sprite-"+ ++Xx;Wx.set(n,t),e.dataset.achievementSpriteId=n,nv();Jx?Jx.observe(e):ov(e),rv()}function cv(e){if(!e)return;nv();const t=Jx;e.querySelectorAll("[data-achievement-sprite-id]").forEach(e=>{"1"!==e.dataset.achievementSpriteHydrated&&(t?t.observe(e):ov(e))}),rv()}function dv(e,t={}){const n=t.hideTarget??!1,o="number"==typeof e.target?e.target:void 0,r=n?"???":null!=o?tv(o):"‚Äî",i=e.id.replace(/-\d+$/u,""),a={"garden:seedling":()=>`Plant ${r} crops.`,"garden:harvester":()=>`Harvest ${r} crops.`,"garden:watering":()=>`Use ${r} watering cans.`,"garden:seed-hoarder":()=>`Hold ${r} seeds of one type.`,"pets:hatchling":()=>`Hatch ${r} pets.`,"pets:gold":()=>`Hatch ${r} gold pets.`,"pets:rainbow":()=>`Hatch ${r} rainbow pets.`,"abilities:proc":()=>`Trigger ${r} pet ability procs.`,"economy:crop-earner":()=>`Sell crops worth ${r} coins.`,"weather:fresh-frozen":()=>`Watch it snow ${r} times.`,"weather:early-bird":()=>`Sit through ${r} Dawn moons.`,"weather:night-owl":()=>`Sit through ${r} Amber moons.`,"collection:produce":()=>`Complete ${r} produce journal entries.`,"collection:pets":()=>`Complete ${r} pet journal entries.`};if(e.oneTime)return e.description;const s=a[i];return s?s():n?e.description.replace(/\d[\d,_.]*(?:\s*[A-Za-z]+)?/u,"???"):e.description}const pv=28,uv=new Map;let gv=!1;const mv=Ri.then(e=>(gv=!!e,gv&&(iv(),rv()),e));let fv=null;const hv=new Map;function bv(e){return String(e||"").toLowerCase().replace(/[^a-z0-9]/g,"")}function yv(e,t){return gv?ta.getTile(e,t):null}function xv(e,t,n=28){if(!yv(e,t))return null;const o=document.createElement("div");return o.style.cssText=`\n    width: ${n}px;\n    height: ${n}px;\n    background-size: contain;\n    background-repeat: no-repeat;\n    background-position: center;\n    flex-shrink: 0;\n    image-rendering: pixelated;\n    image-rendering: -moz-crisp-edges;\n    image-rendering: crisp-edges;\n  `,lv(o,()=>vv(e,t)),o}function vv(e,t){const n=`${e}:${t}`;if(uv.has(n))return uv.get(n)??null;const o=yv(e,t);if(!o)return null;try{const e=o.toDataURL("image/png");return uv.set(n,e),e}catch(r){return s("‚ö†Ô∏è Failed to read tile data URL",r),null}}function wv(e,t,n=28){const o=document.createElement("div");return o.style.cssText=`\n    width: ${n}px;\n    height: ${n}px;\n    background-size: contain;\n    background-repeat: no-repeat;\n    background-position: center;\n    flex-shrink: 0;\n    image-rendering: pixelated;\n    image-rendering: -moz-crisp-edges;\n    image-rendering: crisp-edges;\n  `,lv(o,()=>wc(e,t)??ea(e)),o}function Cv(e,t=28){if(!e.length)return null;const n=document.createElement("div");return n.style.cssText=`position: relative; width: ${t}px; height: ${t}px; display: inline-flex; align-items: center; justify-content: center; flex-shrink: 0;`,e.forEach(e=>{e.style.position="absolute",e.style.inset="0",e.style.width="100%",e.style.height="100%",e.style.backgroundSize||(e.style.backgroundSize="contain"),e.style.backgroundRepeat||(e.style.backgroundRepeat="no-repeat"),e.style.backgroundPosition||(e.style.backgroundPosition="center"),n.appendChild(e)}),cv(n),n}function Tv(e,t,n=28){const o=xv(e,t,n),r=vv(e,t);if(!o||!r)return{element:o,url:r};const i=document.createElement("div");i.style.cssText=`position:absolute; inset:0; background: linear-gradient(135deg, #ff1744, #ff9100, #ffea00, #00e676, #2979ff, #d500f9); mask-image: url(${r}); -webkit-mask-image: url(${r}); mask-size: contain; -webkit-mask-size: contain; mask-repeat: no-repeat; -webkit-mask-repeat: no-repeat; mask-position: center; -webkit-mask-position: center; opacity: 0.9; mix-blend-mode: screen;`;return{element:Cv([o,i],n)??o,url:r}}function Sv(e,t){const n=wv(e,"rainbow",pv);if(n){return{element:n,url:wc(e,"rainbow")??ea(e)??null}}return Tv("pets",t,pv)}function Pv(e){const t=e.id.replace(/-\d+$/u,""),n=(e,t)=>{const n=vv(e,t);return{element:xv(e,t),url:n}},o=(e,t)=>{const n=t?wc(e,t)??ea(e):ea(e),o=t?wv(e,t,pv):function(e,t){const n=t?.size,o=document.createElement("div");return o.style.cssText=`\n    width: ${n}px;\n    height: ${n}px;\n    background-size: contain;\n    background-repeat: no-repeat;\n    background-position: center;\n    flex-shrink: 0;\n    image-rendering: pixelated;\n    image-rendering: -moz-crisp-edges;\n    image-rendering: crisp-edges;\n  `,lv(o,()=>ea(e)),o}(e,{size:pv});return{element:o,url:n}},r={"onetime:this-is-only-the-beginning":()=>Sv("worm",9),"onetime:yummy-crop-eater":()=>{const e=Sv("worm",9),t=xv("plants",51,Math.round(1.1*pv));t&&(t.style.transform="translate(8px, 6px)",t.style.zIndex="1");const n=e.element;n&&(n.style.zIndex="2");const o=[t,n].filter(e=>!!e),r=o.length?Cv(o,pv):e.element,i=vv("plants",51);return{element:r,url:e.url??i}},"onetime:eating-good":()=>n("pets",6),"onetime:all-i-see-is-money":()=>Sv("capybara",4),"onetime:money-cant-buy-happiness":()=>{const e=vv("pets",10)??vv("items",10);return e?function(e,t=28){const n=document.createElement("div");n.style.cssText=`position:absolute; inset:0; background: url(${e}) center/contain no-repeat; image-rendering: pixelated;`;const o=document.createElement("div");return o.style.cssText=`position:absolute; inset:0; background: linear-gradient(135deg, #ff1744, #ff9100, #ffea00, #00e676, #2979ff, #d500f9); mask-image: url(${e}); -webkit-mask-image: url(${e}); mask-size: contain; -webkit-mask-size: contain; mask-repeat: no-repeat; -webkit-mask-repeat: no-repeat; mask-position: center; -webkit-mask-position: center; opacity: 0.9; mix-blend-mode: screen;`,{element:Cv([n,o],t),url:e}}(e,pv):Tv("pets",10,pv)},"onetime:gamblers-fallacy":()=>n("pets",0),"onetime:rich":()=>n("items",0),"onetime:baller-status":()=>n("items",0),"onetime:whos-bill-gates":()=>n("items",0),"onetime:what-is-money":()=>n("items",0),"onetime:what-is-grass":()=>n("items",0),"onetime:god-tier-research":()=>n("animations",92),"onetime:perfect-produce":()=>n("plants",14),"onetime:perfect-symmetry":()=>o("peacock","gold"),"onetime:mutation-marathon":()=>n("mutations",3),"onetime:all-weathered":()=>n("animations",19),"onetime:triple-hatch":()=>{const e=o("bunny"),t=o("capybara","gold"),r=o("peacock","rainbow"),i=[e.element,t.element,r.element].filter(e=>!!e);return i.length?(i.forEach((e,t)=>{const n=6*(t-1),o=1===t?-4:2;e.style.transform=`translate(${n}px, ${o}px)`,e.style.opacity="0.95"}),{element:Cv(i,pv)??null,url:e.url??t.url??r.url}):n("items",1)},"onetime:These-Exist!?":()=>Tv("pets",15,pv),"onetime:loyal-companion":()=>o("turtle"),"onetime:ability-synergy":()=>n("items",13),"onetime:combo-caster":()=>n("animations",49),"onetime:market-maker":()=>n("items",10),"onetime:fire-sale":()=>n("animations",16),"onetime:abilities:crit-crafter":()=>n("mutations",1),"onetime:clutch-hatch":()=>{const e=xv("items",7,Math.round(.55*pv)),t=wv("bunny","gold",Math.round(.98*pv))??xv("pets",13,pv);e&&(e.style.transform="translate(14px, -14px)");const n=[t,e].filter(e=>!!e);return{element:n.length?Cv(n,pv):t,url:ea("bunny")??vv("pets",13)??vv("items",7)}}},i=r[e.id];if(i)return i();const a={"garden:seedling":()=>n("seeds",2),"garden:seed-hoarder":()=>n("seeds",1),"garden:watering":()=>n("items",8),"garden:harvester":()=>n("plants",14),"pets:hatchling":()=>o("bunny"),"pets:gold":()=>o("capybara","gold"),"pets:rainbow":()=>o("peacock","rainbow"),"economy:crop-earner":()=>n("items",10),"abilities:proc":()=>n("items",13),"abilities:empowered-harvest":()=>n("mutations",2),"garden:mutation-harvester":()=>n("mutations",0),"garden:giant-grower":()=>n("plants",30),"pets:trainer":()=>o("goat"),"streaks:diligent-gardener":()=>n("items",11),"collection:produce":()=>n("items",24),"collection:pets":()=>n("items",25),"weather:fresh-frozen":()=>n("animations",19),"weather:early-bird":()=>n("animations",49),"weather:night-owl":()=>n("animations",39),"rooms:socialite":()=>Tv("animations",49,pv),"rooms:anchor":()=>{const e=xv("items",11,pv),t=xv("animations",39,Math.round(25.2));t&&(t.style.opacity="0.65");const n=[t,e].filter(e=>!!e);return{element:n.length?Cv(n,pv):e,url:vv("items",11)??vv("animations",39)}},"shop:sell-burst":()=>{const e=xv("items",10,pv),t=xv("animations",16,Math.round(1.05*pv));t&&(t.style.opacity="0.8");const n=[t,e].filter(e=>!!e);return{element:n.length?Cv(n,pv):e,url:vv("items",10)??vv("animations",16)}},"garden:mutation-appraiser":()=>{const e=xv("mutations",1,pv),t=xv("items",10,Math.round(.82*pv));t&&(t.style.opacity="0.82");const n=[e,t].filter(e=>!!e);return{element:n.length?Cv(n,pv):e,url:vv("mutations",1)??vv("items",10)}},"garden:boosted-operation":()=>{const e=xv("items",13,pv),t=xv("mutations",2,Math.round(25.2));t&&(t.style.opacity="0.75",t.style.mixBlendMode="screen");const n=[e,t].filter(e=>!!e);return{element:n.length?Cv(n,pv):e,url:vv("items",13)??vv("mutations",2)}},"weather:dawnsmith":()=>{const e=xv("animations",49,pv),t=xv("plants",30,Math.round(.7*pv));t&&(t.style.transform="translate(2px, 8px)");const n=[e,t].filter(e=>!!e);return{element:n.length?Cv(n,pv):e,url:vv("animations",49)??vv("plants",30)}},"weather:amberforge":()=>{const e=xv("animations",39,pv),t=xv("plants",14,Math.round(.7*pv));t&&(t.style.transform="translate(2px, 8px)");const n=[e,t].filter(e=>!!e);return{element:n.length?Cv(n,pv):e,url:vv("animations",39)??vv("plants",14)}},"weather:fresh-freeze-harvest":()=>{const e=xv("animations",19,pv),t=xv("plants",30,Math.round(20.16));t&&(t.style.transform="translate(2px, 8px)");const n=[e,t].filter(e=>!!e);return{element:n.length?Cv(n,pv):e,url:vv("animations",19)??vv("plants",30)}},"onetime:first-contact":()=>{const e=Tv("items",24,pv);if(e.element)return e;return{element:xv("items",24,pv),url:vv("items",24)}},"onetime:marathoner":()=>{const e=xv("items",7,pv),t=xv("items",11,Math.round(25.2));t&&(t.style.opacity="0.8");const n=[e,t].filter(e=>!!e);return{element:n.length?Cv(n,pv):e,url:vv("items",7)??vv("items",11)}},"onetime:market-buzz":()=>{const e=xv("items",10,pv),t=xv("items",13,Math.round(.82*pv));t&&(t.style.mixBlendMode="screen",t.style.opacity="0.9");const n=[t,e].filter(e=>!!e);return{element:n.length?Cv(n,pv):e,url:vv("items",10)??vv("items",13)}},"onetime:market-shock":()=>{const e=xv("items",10,pv),t=xv("animations",16,Math.round(.95*pv));t&&(t.style.opacity="0.88");const n=[t,e].filter(e=>!!e);return{element:n.length?Cv(n,pv):e,url:vv("items",10)??vv("animations",16)}},"onetime:perfect-storm":()=>{const e=xv("animations",49,Math.round(25.2)),t=xv("animations",39,Math.round(.82*pv)),n=xv("animations",19,Math.round(21.84));t&&(t.style.opacity="0.82"),n&&(n.style.opacity="0.82"),t&&(t.style.transform="translate(-6px, 4px)"),n&&(n.style.transform="translate(6px, -4px)");const o=[e,t,n].filter(e=>!!e);return{element:o.length?Cv(o,pv):e,url:vv("animations",49)??vv("animations",39)??vv("animations",19)}},"onetime:rainbow-weather":()=>{const e=Sv("peacock",29),t=xv("animations",19,Math.round(21.84));t&&(t.style.opacity="0.78"),t&&(t.style.transform="translate(-6px, -6px)");const n=[e.element,t].filter(e=>!!e);return{element:n.length?Cv(n,pv):e.element,url:e.url??vv("animations",19)}},"onetime:goldsmith":()=>{const e=o("capybara","gold"),t=xv("animations",49,Math.round(.8*pv));t&&(t.style.opacity="0.8"),t&&(t.style.transform="translate(-6px, -6px)");const n=[e.element,t].filter(e=>!!e);return{element:n.length?Cv(n,pv):e.element,url:e.url??vv("animations",49)}},"onetime:crystal-clear":()=>{const e=xv("animations",19,pv),t=xv("mutations",0,Math.round(.8*pv));t&&(t.style.opacity="0.85");const n=[e,t].filter(e=>!!e);return{element:n.length?Cv(n,pv):e,url:vv("animations",19)??vv("mutations",0)}},"onetime:quiet-profit":()=>{const e=xv("items",10,pv),t=vv("items",10);let n=null;t&&(n=document.createElement("div"),n.style.cssText=`position:absolute; inset:0; background: linear-gradient(145deg, rgba(20,20,30,0.65), rgba(30,30,40,0.4)); mix-blend-mode: multiply; mask-image: url(${t}); -webkit-mask-image: url(${t}); mask-size: contain; -webkit-mask-size: contain; mask-repeat: no-repeat; -webkit-mask-repeat: no-repeat; mask-position: center; -webkit-mask-position: center;`);const o=[e,n].filter(e=>!!e);return{element:o.length?Cv(o,pv):e,url:vv("items",10)}},"onetime:dawn-double":()=>{const e=Sv("peacock",29),t=xv("plants",30,Math.round(21));t&&(t.style.transform="translate(-4px, 10px)");const n=xv("animations",49,Math.round(25.76));n&&(n.style.opacity="0.7");const o=[n,e.element,t].filter(e=>!!e);return{element:o.length?Cv(o,pv):e.element,url:e.url??vv("plants",30)??vv("animations",49)}},"onetime:amber-artisan":()=>{const e=o("capybara","gold"),t=xv("items",10,Math.round(21));t&&(t.style.transform="translate(10px, 10px)");const n=xv("animations",39,Math.round(25.76));n&&(n.style.opacity="0.7");const r=[n,e.element,t].filter(e=>!!e);return{element:r.length?Cv(r,pv):e.element,url:e.url??vv("items",10)??vv("animations",39)}}}[t]??("weather"===e.category?()=>n("animations",9):void 0);if(a)return a();const s=((...e)=>{if(!fv)return null;for(const t of e){if(!t)continue;const e=bv(t),n=hv.get(e),o=n&&n.length?n[0]:null;if(!o)continue;const r=fv.renderToCanvas({category:o.cat,id:o.id,mutations:[]});if(r){const e=Fi(r),t=document.createElement("div");return t.style.cssText=`\n          width: 28px;\n          height: 28px;\n          background: url(${e}) center/contain no-repeat;\n          image-rendering: pixelated;\n          flex-shrink: 0;\n        `,lv(t,()=>e),{element:t,url:e}}}return null})(e.title,e.id,t,e.description);return s||{element:null,url:null}}function kv(e,t,n=52){const{element:o,url:r}=Pv(e),i=document.createElement("div");if(i.style.cssText=`position: relative; width: ${n}px; height: ${n}px; display: inline-flex; align-items: center; justify-content: center; flex-shrink: 0;`,o)o.style.width=`${n}px`,o.style.height=`${n}px`,i.appendChild(o),cv(i);else if(r){const e=document.createElement("div");e.style.cssText=`position:absolute; inset:0; background: url(${r}) center/contain no-repeat; image-rendering: pixelated;`,i.appendChild(e)}else{const o=xv("items",10,n)??xv("items",0,n);if(o)i.appendChild(o),cv(i);else{const n="celestial"===t?"linear-gradient(135deg, #ff1744, #ff9100, #ffea00, #00e676, #2979ff, #d500f9)":"rgba(255,255,255,0.06)",o=document.createElement("div");o.style.cssText=`position:absolute; inset:0; border-radius: 10px; background:${n}; display:flex; align-items:center; justify-content:center; color:#f5f5f5; font-weight:800;`,o.textContent=e.icon||"‚òÜ",i.appendChild(o)}}const a=r??null,s=e.id.startsWith("pets:gold"),l=Zx[t];if(a&&l>=Zx.legendary&&!s){const e=document.createElement("div"),n="celestial"===t?"linear-gradient(135deg, #ff6ec7, #ffd166, #6ec8ff, #b37bff)":ev[t].bar,o="legendary"===t||"mythical"===t?.5:"divine"===t?.6:"celestial"===t?.8:.65;e.style.cssText=`position:absolute; inset:0; background:${n}; mask-image: url(${a}); -webkit-mask-image: url(${a}); mask-size: contain; -webkit-mask-size: contain; mask-repeat: no-repeat; -webkit-mask-repeat: no-repeat; mask-position: center; -webkit-mask-position: center; opacity: ${o}; mix-blend-mode: screen;`,i.appendChild(e)}if(a&&"celestial"===t){const e=document.createElement("div");e.style.cssText=`\n      position:absolute;\n      inset:0;\n      background: linear-gradient(135deg, #ff1744, #ff9100, #ffea00, #00e676, #2979ff, #d500f9);\n      mask-image: url(${a});\n      -webkit-mask-image: url(${a});\n      mask-size: contain;\n      -webkit-mask-size: contain;\n      mask-repeat: no-repeat;\n      -webkit-mask-repeat: no-repeat;\n      mask-position: center;\n      -webkit-mask-position: center;\n      opacity: 0.92;\n      mix-blend-mode: screen;\n      filter: saturate(1.05);\n    `,i.appendChild(e)}return i}function Av(e,t,n){const o=document.createElement("div"),r=e.entries[0]?.category,i=r&&{all:"#8f82ff",garden:"#7cb342",pets:"#64b5f6",abilities:"#ba68c8",shop:"#4dd0e1",weather:"#90caf9",wealth:"#ffca28",collection:"#ff8a65",streaks:"#f06292",obscure:"#b0bec5"}[r]||"#8f82ff";o.style.cssText="\n    background: #0f1624;\n    border: 1px solid rgba(255,255,255,0.05);\n    border-radius: 14px;\n    padding: 14px;\n    box-shadow: 0 10px 28px rgba(0,0,0,0.35);\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n    position: relative;\n    overflow: hidden;\n  ";const a=document.createElement("div");a.style.cssText=`position:absolute; inset:0; background: linear-gradient(135deg, ${i}22, transparent); pointer-events:none;`,o.appendChild(a);const s=document.createElement("div");s.style.cssText="display: grid; grid-template-columns: auto 1fr auto; gap: 10px; align-items: center; position: relative; z-index: 1;";const l=document.createElement("div");l.style.cssText="font-weight: 800; color: #fff; display: inline-flex; align-items: center; gap: 8px; letter-spacing: 0.01em; filter: drop-shadow(0 2px 6px rgba(0,0,0,0.35));";const c=document.createElement("span");c.style.cssText="font-size: 11px; padding: 4px 8px; border-radius: 999px; border: 1px solid rgba(255,255,255,0.12); box-shadow: 0 2px 8px rgba(0,0,0,0.25);";const d=document.createElement("div");d.style.cssText="display: flex; align-items: center; justify-content: space-between; gap: 8px; flex-wrap: wrap; padding: 6px 8px; background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.07); border-radius: 10px; position: relative; z-index: 1;";const p=document.createElement("span");p.style.cssText="font-size: 11px; color: #cfd8dc; font-weight: 700;";const u=document.createElement("div");u.style.cssText="display: flex; gap: 6px; align-items: center;";const g=document.createElement("span");g.textContent=r??"misc",g.style.cssText=`font-size: 11px; padding: 4px 8px; border-radius: 999px; background: ${i}22; color: #e3f2fd; border: 1px solid ${i}44;`;const m=document.createElement("span");m.textContent=e.entries[0]?.title??"Achievement";const f=e=>{if(!e)return;const t=ev[e.rarity];m.style.color=t.accent??t.color};f(e.entries[0]);const h=e.entries[0],b=h?function(e){const t=Pv(e).element;if(t)return cv(t),t;const n=document.createElement("div");return n.textContent=e.icon||"‚òÜ",n.style.cssText="\n    width: 28px;\n    height: 28px;\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    background: rgba(255,255,255,0.06);\n    border: 1px solid rgba(255,255,255,0.08);\n    border-radius: 8px;\n    font-weight: 800;\n    color: #e0e0e0;\n  ",n}(h):null;b&&(b.style.width="34px",b.style.height="34px",b.style.flexShrink="0",b.style.marginRight="6px",l.prepend(b)),l.append(m),s.append(l,c);const y=e=>{const t=document.createElement("button");return t.textContent=e,t.style.cssText="border: 1px solid rgba(143,130,255,0.5); background: rgba(255,255,255,0.05); color: #e0e0e0; border-radius: 8px; padding: 4px 8px; cursor: pointer; font-weight: 700;",t},x=y("< Previous"),v=y("Next >");u.append(x,v),d.append(g,p,u);const w=document.createElement("div");if(w.style.cssText="position: relative; max-height: 220px; overflow: hidden; padding-right: 4px;",w.style.overscrollBehavior="contain",!e.entries.length){const e=document.createElement("div");return e.style.cssText="color: #cfd8dc; font-size: 12px;",e.textContent="No achievement data available.",o.append(s,d,e),o}const C=e.entries.map((e,n)=>{const o=function(e,t,n){const o=document.createElement("div");o.dataset.tierIndex=String(n);const r=ev[e.rarity],i="celestial"===e.rarity?"linear-gradient(180deg, rgba(0,0,0,0.28), rgba(0,0,0,0.28)), ":"";o.style.cssText="padding: 12px; border-radius: 12px; display: flex; flex-direction: column; gap: 10px; scroll-snap-align: start;",o.style.background=`${i}${r.bg}`,o.style.border=`1px solid ${r.border??"rgba(143,130,255,0.25)"}`,o.style.boxShadow="0 8px 18px rgba(0,0,0,0.35)";const a=t.get(e.id),s=a?.current??0,l=a?.target??("number"==typeof e.target?e.target:0),c=l>0?Math.min(100,Math.round(s/l*100)):0,d=!!a?.completedAt,p=!!a?.ineligible,u=e.hiddenTargetUntil,g=!u||!!t.get(u)?.completedAt,m=!d&&null!=u&&!g,f=document.createElement("div");f.style.cssText=`color: ${"celestial"===e.rarity?"#f4f7ff":"#d6e1ec"}; font-size: 12px; line-height: 1.45;`,f.textContent=dv(e,{hideTarget:m});const h=document.createElement("div");h.style.cssText="background: rgba(255,255,255,0.08); border-radius: 12px; height: 12px; overflow: hidden;";const b=document.createElement("div");b.style.cssText=`height: 100%; width: ${c}%; background: ${r.bar}; transition: width 0.3s;`,h.appendChild(b);const y=document.createElement("div");return y.style.cssText=`display: flex; justify-content: space-between; color: ${"celestial"===e.rarity?"#e4ebff":"#b0bec5"}; font-size: 11px; font-weight: 700; letter-spacing: 0.01em;`,y.textContent=p?"N/A (ineligible)":d?"Completed":m?"Progress hidden until the previous tier is complete":`${s.toLocaleString()} / ${l.toLocaleString()}`,o.append(f,h,y),o}(e,t,n);return o.style.position="absolute",o.style.inset="0",o.style.margin="0",o.style.transition="opacity 0.15s ease",o.style.opacity="0",o.style.pointerEvents="none",w.appendChild(o),o}),T=e=>Math.min(Math.max(e,0),C.length-1),S=e=>{C.forEach((t,n)=>{const o=n===e;t.style.opacity=o?"1":"0",t.style.pointerEvents=o?"auto":"none",t.style.position=o?"relative":"absolute",t.style.boxShadow=o?"0 6px 18px rgba(126,0,252,0.25)":"none"})},P=n.groupPages[e.key],k=Number.isInteger(P)?T(P):(()=>{const n=e.entries.findIndex(e=>!t.get(e.id)?.completedAt),o=-1===n?e.entries.length-1:n;return T(o)})();n.groupPages[e.key]=k;let A=k;const E=()=>{const t=e.entries[A];m.textContent=t.title,f(t),(e=>{const t=ev[e.rarity];c.textContent=e.rarity.toUpperCase(),c.style.background=t.bg,c.style.color=t.color,c.style.border=`1px solid ${t.border??"rgba(255,255,255,0.12)"}`})(t),p.textContent=`Tier ${A+1} / ${e.entries.length}`,x.disabled=0===A,v.disabled=A===e.entries.length-1,x.style.opacity=x.disabled?"0.5":"1",v.style.opacity=v.disabled?"0.5":"1"},$=t=>{const o=T(t);o!==A&&(A=o,n.groupPages[e.key]=o,E(),S(o))};return C.forEach((e,t)=>{e.addEventListener("click",()=>$(t))}),w.addEventListener("wheel",e=>{e.preventDefault();const t=e.deltaY;t>5?$(A+1):t<-5&&$(A-1)},{passive:!1}),x.addEventListener("click",()=>$(A-1)),v.addEventListener("click",()=>$(A+1)),S(A),E(),s.append(l,c),o.append(s,d,w),setTimeout(()=>S(A),0),o}function Ev(e){const t=df(),n=cf().length,o=Array.from(t.values()).filter(e=>e.completedAt).length,r=Em.lastSnapshot?{...Em.lastSnapshot}:null,i=r?.inventoryCount??0,a=r?.inventoryValue,s=r?.cropEarnings??r?.stats?.shop?.totalSpentCoins??r?.shop?.totalSpentCoins??r?.shop?.coinsSpent??0;e.summary.innerHTML=`\n    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px;">\n      <div style="background: linear-gradient(135deg, #7e00fc, #a463ff); border-radius: 12px; padding: 12px; color: #fff; box-shadow: 0 12px 28px rgba(0,0,0,0.4);">\n        <div style="font-size: 26px; font-weight: 900;">${o}/${n}</div>\n        <div style="font-size: 12px; opacity: 0.9;">Completed</div>\n      </div>\n      <div style="background: rgba(255,255,255,0.06); border: 1px solid rgba(143,130,255,0.25); border-radius: 12px; padding: 12px; color: #fff;">\n        <div style="font-size: 14px; font-weight: 700;">Inventory Items</div>\n        <div style="color: #ffecb3; font-weight: 800; font-size: 18px;">${i.toLocaleString()}</div>\n        <div style="color: #b0bec5; font-weight: 700; font-size: 12px; margin-top: 2px;">Value: ${null!=a?Hn(a):"‚Äî"}</div>\n      </div>\n      <div style="background: rgba(255,255,255,0.06); border: 1px solid rgba(255,202,40,0.35); border-radius: 12px; padding: 12px; color: #fff;">\n        <div style="font-size: 14px; font-weight: 700;">Crop Value Sold</div>\n        <div style="color: #ffd54f; font-weight: 800; font-size: 18px;">${Hn(s)}</div>\n      </div>\n    </div>\n  `}function $v(e,t){const n=df(),o=t??cf(),r=o.map(e=>({def:e,prog:n.get(e.id)})).filter(({def:t})=>"all"===e.filterCategory||t.category===e.filterCategory).filter(({def:t,prog:n})=>{if(Gx)return!0;const o=!!n?.completedAt&&!n?.ineligible,r="number"==typeof t.target?t.target:n?.target??0,i=n?.current??0,a=!o&&r>0&&i>0&&i<r;return"completed"===e.filterStatus?o:"in-progress"===e.filterStatus?a:o||a}),i=o.filter(t=>"all"===e.filterCategory||t.category===e.filterCategory),a=Gx?r.map(({def:e})=>({def:e,prog:n.get(e.id)??{current:e.target??1,target:e.target??1,completedAt:Date.now()}})):r,s=[...Yx].reverse(),l=new Map;s.forEach(e=>l.set(e,[])),a.forEach(e=>{const t=l.get(e.def.rarity);t&&t.push(e)}),s.forEach(e=>{const t=l.get(e);t?.sort((e,t)=>{const n=e.prog?.completedAt?new Date(e.prog.completedAt).getTime():0;return(t.prog?.completedAt?new Date(t.prog.completedAt).getTime():0)-n})}),e.badgesList.innerHTML="";const c=i.filter(e=>{const t=n.get(e.id);return!!t?.completedAt&&!t?.ineligible}).length,d=i.length,p=document.createElement("div");p.style.cssText="margin-bottom: 10px; font-weight: 800; color: #fff; letter-spacing: 0.01em; display: flex; align-items: center; gap: 8px;";const u=document.createElement("div");u.textContent=`${c}/${d} badges earned`,u.style.cssText="padding: 6px 10px; border-radius: 999px; background: linear-gradient(135deg, rgba(143,130,255,0.18), rgba(255,255,255,0.08)); border: 1px solid rgba(255,255,255,0.18); font-size: 12px;",p.appendChild(u),e.badgesList.appendChild(p);const g={common:{bg:"linear-gradient(135deg, #1f2430, #252b3a)",border:"1px solid rgba(255,255,255,0.08)",glow:"0 8px 20px rgba(0,0,0,0.35)",text:"#e0e0e0"},uncommon:{bg:"linear-gradient(135deg, #1f3024, #24382a)",border:"1px solid rgba(120,200,140,0.55)",glow:"0 8px 22px rgba(0,255,120,0.15)",text:"#d7f7df"},rare:{bg:"linear-gradient(135deg, #1f233a, #2c3160)",border:"1px solid rgba(160,140,255,0.65)",glow:"0 10px 26px rgba(160,140,255,0.25)",text:"#e6e1ff"},legendary:{bg:"linear-gradient(135deg, #2c210f, #3a2a12)",border:"1px solid rgba(255,215,0,0.7)",glow:"0 12px 28px rgba(255,215,0,0.25)",text:"#ffecc2"},mythical:{bg:"linear-gradient(135deg, #271a3a, #36254d)",border:"1px solid rgba(214,139,255,0.75)",glow:"0 14px 30px rgba(214,139,255,0.35)",text:"#f2d9ff"},divine:{bg:"linear-gradient(135deg, #301616, #3f1c1c)",border:"1px solid rgba(255,180,150,0.85)",glow:"0 16px 32px rgba(255,180,150,0.35)",text:"#ffe4d7"},celestial:{bg:"linear-gradient(135deg, #291f46, #1f2f46, #2f1f46)",border:"1px solid rgba(255,255,255,0.85)",glow:"0 18px 36px rgba(255,255,255,0.4)",text:"#f8fbff"}},m=e=>tv(e);if(s.forEach(t=>{const n=document.createElement("div");n.style.cssText="display: flex; flex-direction: column; gap: 10px; padding: 8px; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.06); border-radius: 12px; min-height: 120px;";const o=document.createElement("div");o.textContent=t.charAt(0).toUpperCase()+t.slice(1),o.style.cssText="font-weight: 800; color: #fff; font-size: 13px; letter-spacing: 0.02em;",n.appendChild(o);const r=l.get(t)??[];if(r.length||Gx){if(!r.length&&Gx){const e=document.createElement("div");e.style.cssText="color: #90a4ae; font-size: 11px; padding: 8px; border: 1px dashed rgba(255,255,255,0.08); border-radius: 10px;",e.textContent="Preview only",n.appendChild(e)}else r.forEach(e=>n.appendChild((({def:e,prog:t})=>{const n=g[e.rarity],o=document.createElement("div");o.style.cssText=`\n      background: ${n.bg};\n      border: ${n.border};\n      border-radius: 12px;\n      padding: 10px;\n      display: flex;\n      gap: 10px;\n      align-items: center;\n      box-shadow: ${n.glow};\n    `;const r=kv(e,e.rarity,56);o.appendChild(r);const i=document.createElement("div");i.style.cssText="display: flex; flex-direction: column; gap: 6px; flex: 1; min-width: 0;";const a=document.createElement("div");a.textContent=e.title,a.style.cssText=`font-weight: 800; color: ${n.text}; font-size: 14px;`;const s=t?.completedAt?new Date(t.completedAt).toLocaleString():"‚Äî",l=document.createElement("div");l.style.cssText="font-size: 11px; color: rgba(255,255,255,0.7);",l.textContent=`Completed: ${s}`;const c=document.createElement("div");c.textContent=dv(e,{hideTarget:!1}),c.style.cssText="font-size: 11px; color: rgba(255,255,255,0.78); line-height: 1.4;";const d=document.createElement("div"),p=Math.min(t?.current??0,"number"==typeof e.target?e.target:t?.current??0),u="number"==typeof e.target?e.target:t?.target??p,f=`${m(p)} / ${m(u)}`;d.style.cssText=`font-size: 12px; color: ${n.text}; font-weight: 700;`,d.textContent=f;const h=document.createElement("div");h.style.cssText="background: rgba(255,255,255,0.12); border-radius: 999px; height: 8px; overflow: hidden;";const b=document.createElement("div"),y="celestial"===e.rarity?"linear-gradient(90deg, #ff6ec7, #ffd166, #6ec8ff, #b37bff, #ff6ec7)":ev[e.rarity].bar;return b.style.cssText=`height: 100%; width: 100%; background: ${y};`,h.appendChild(b),i.append(a,c,l,d,h),o.append(i),o})(e)));e.badgesList.appendChild(n)}}),!a.length){const t=document.createElement("div");t.style.cssText="grid-column: 1 / -1; color: #cfd8dc; font-size: 12px; padding: 12px; text-align: center; border: 1px dashed rgba(255,255,255,0.12); border-radius: 10px;",t.textContent="Earn achievements to unlock badges!",e.badgesList.appendChild(t)}}function Mv(e,t){const n=df(),o=(t??cf()).filter(e=>e.oneTime);e.oneTimeList.innerHTML="";const r=new Map;Yx.forEach(e=>r.set(e,[])),o.forEach(t=>{const o=n.get(t.id),i=!!o?.completedAt,a=!i,s="all"===e.filterStatus||("completed"===e.filterStatus?i:a),l="all"===e.filterCategory||t.category===e.filterCategory;if(!s||!l)return;const c=r.get(t.rarity);c&&c.push({def:t,prog:o})});if(Yx.forEach(t=>{const n=r.get(t)??[];if(!n.length)return;const o=document.createElement("div");o.style.cssText="display: flex; flex-direction: column; gap: 10px; padding: 8px; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.06); border-radius: 12px;";const i=document.createElement("div");i.textContent=t.charAt(0).toUpperCase()+t.slice(1),i.style.cssText="font-weight: 800; color: #fff; font-size: 13px; letter-spacing: 0.02em;",o.appendChild(i),n.forEach(e=>o.appendChild((({def:e,prog:t})=>{const n=ev[e.rarity],o=document.createElement("div");o.style.cssText=`\n      background: ${n.bg};\n      border: 1px solid ${n.border??"rgba(255,255,255,0.12)"};\n      border-radius: 12px;\n      padding: 10px;\n      display: grid;\n      grid-template-columns: auto 1fr;\n      gap: 10px;\n      align-items: center;\n      box-shadow: 0 10px 26px rgba(0,0,0,0.35);\n    `;const r=kv(e,e.rarity,48);o.appendChild(r);const i=document.createElement("div");i.style.cssText="display: flex; flex-direction: column; gap: 6px; min-width: 0;";const a=document.createElement("div");a.textContent=e.title,a.style.cssText=`font-weight: 800; color: ${n.accent??n.color}; font-size: 14px;`;const s=document.createElement("div");s.textContent=dv(e,{hideTarget:!1}),s.style.cssText="font-size: 12px; color: #cfd8dc; line-height: 1.4;";const l=document.createElement("div"),c=!!t?.completedAt;return l.textContent=c?`Completed: ${new Date(t.completedAt).toLocaleString()}`:"Not yet earned",l.style.cssText=`font-size: 11px; color: ${c?"#b0f4c6":"#ffcdd2"}; font-weight: 700;`,i.append(a,s,l),o.append(i),o})(e))),e.oneTimeList.appendChild(o)}),!e.oneTimeList.childElementCount){const t=document.createElement("div");t.style.cssText="grid-column: 1 / -1; color: #cfd8dc; font-size: 12px; padding: 12px; text-align: center; border: 1px dashed rgba(255,255,255,0.12); border-radius: 10px;",t.textContent=o.length?"No one-time achievements match this filter.":"No one-time achievements found yet.",e.oneTimeList.appendChild(t)}}function Iv(e){return Gx=e??!Gx,s("üß™ Badge preview "+(Gx?"ENABLED (visual only)":"DISABLED (earned only)")),Vx&&$v(Vx),Gx}mv.then(e=>{if(fv=e,!e)return;["item","decor","pet","seed","plant","tallplant","crop"].forEach(t=>{try{e.list(t).forEach(e=>{const n=String(e.key||"").split("/"),o=n[n.length-1]||e.key,r=bv(o),i=hv.get(r)??[];i.push({cat:t,id:o}),hv.set(r,i)})}catch{}})}),"undefined"!=typeof window&&(window.toggleBadgePreview=Iv);const Fv=Object.freeze(Object.defineProperty({__proto__:null,createAchievementsWindow:function(){const e=document.createElement("div");e.dataset.achievementsRoot="true",e.style.cssText="display: flex; flex-direction: column; gap: 12px; width: 100%; min-width: min(1100px, 100%); max-width: 100%;";const t=cf(),n=t.filter(e=>!e.oneTime),o=t.filter(e=>e.oneTime),r=document.createElement("div");r.style.cssText="display: inline-flex; gap: 8px; background: rgba(255,255,255,0.04); padding: 6px; border-radius: 12px; align-self: flex-start; border: 1px solid rgba(255,255,255,0.08);";const i={achievements:document.createElement("button"),badges:document.createElement("button"),onetime:document.createElement("button")};Object.entries(i).forEach(([e,t])=>{t.type="button",t.textContent="achievements"===e?"Achievements":"badges"===e?"Badges":"One-time",t.style.cssText="border: none; padding: 8px 14px; border-radius: 10px; background: transparent; color: #e0e0e0; cursor: pointer; font-weight: 700;",r.appendChild(t)});const a=document.createElement("div"),l=document.createElement("div");l.style.cssText="display: flex; gap: 8px; flex-wrap: wrap; align-items: center;";const c=document.createElement("div");c.style.cssText="display: grid; gap: 14px; grid-template-columns: repeat(auto-fit, minmax(340px, 1fr)); align-items: stretch;";const d=document.createElement("div");d.style.cssText="display: flex; flex-direction: column; gap: 12px;",d.append(a,l,c);const p=document.createElement("div");p.style.cssText="display: grid; gap: 14px; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); align-items: stretch;";const u=document.createElement("div");u.style.cssText="display: none; flex-direction: column; gap: 12px;";const g=document.createElement("div");g.style.cssText="display: flex; gap: 8px; flex-wrap: wrap; align-items: center;";const m=document.createElement("div");m.style.cssText="color: #cfd8dc; font-size: 12px; opacity: 0.9;",m.textContent="Unique achievements that can only be earned once.",u.append(g,m,p);const f=document.createElement("div");f.style.cssText="display: grid; gap: 12px; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); align-items: start; width: 100%;";const h=document.createElement("div");h.style.cssText="display: none; flex-direction: column; gap: 12px;";const b=document.createElement("div");b.style.cssText="display:flex;gap:8px;flex-wrap:wrap;align-items:center;";const y=document.createElement("button");y.type="button",y.textContent="Refresh badges",y.style.cssText="border: 1px solid rgba(143,130,255,0.4); background: rgba(255,255,255,0.06); color: #e0e0e0; border-radius: 8px; padding: 6px 10px; font-weight: 700; cursor: pointer;",y.addEventListener("click",()=>{try{hf()}catch{}$v(v,t)});const x=document.createElement("button");x.type="button",x.textContent="Hide previewed badges",x.style.cssText="border: 1px solid rgba(255,99,132,0.5); background: rgba(255,255,255,0.05); color: #ffcdd2; border-radius: 8px; padding: 6px 10px; font-weight: 700; cursor: pointer;",x.addEventListener("click",()=>{try{Iv(!1)}catch{Gx=!1}$v(v,t)}),b.append(y),h.append(b,f),e.append(r,d,u,h);const v={root:e,list:c,oneTimeList:p,badgesList:f,achievementsSection:d,oneTimeSection:u,badgesSection:h,tabButtons:i,summary:a,unsubscribe:null,filterStatus:"in-progress",filterCategory:"all",groupPages:{},activeTab:"achievements"};Gx=!1,Vx=v;const w=()=>{Object.entries(i).forEach(([e,t])=>{const n=v.activeTab===e;t.style.background=n?"linear-gradient(90deg, #7e00fc, #a463ff)":"transparent",t.style.color=n?"#fff":"#e0e0e0",t.style.boxShadow=n?"0 6px 14px rgba(126,0,252,0.35)":"none"}),d.style.display="achievements"===v.activeTab?"flex":"none",u.style.display="onetime"===v.activeTab?"flex":"none",h.style.display="badges"===v.activeTab?"flex":"none"};i.achievements.addEventListener("click",()=>{v.activeTab="achievements",v.filterStatus="in-progress",P(),w(),E()}),i.badges.addEventListener("click",()=>{v.activeTab="badges",v.filterStatus="completed",P(),w(),$v(v,t)}),i.onetime.addEventListener("click",()=>{v.activeTab="onetime",v.filterStatus="all",P(),w(),Mv(v,o)}),w();const C=[{key:"all",label:"All"},{key:"in-progress",label:"In Progress"},{key:"completed",label:"Completed"}],T=document.createElement("div");T.style.cssText="display: inline-flex; gap: 6px; background: rgba(255,255,255,0.04); padding: 6px; border-radius: 999px; border: 1px solid rgba(143,130,255,0.25);";const S=[],P=()=>{S.forEach(({key:e,btn:t})=>{const n=v.filterStatus===e;t.style.background=n?"linear-gradient(90deg, #7e00fc, #a463ff)":"transparent",t.style.color=n?"#fff":"#e0e0e0",t.style.boxShadow=n?"0 6px 14px rgba(126,0,252,0.35)":"none"})};C.forEach(({key:e,label:n})=>{const r=document.createElement("button");r.type="button",r.textContent=n,r.style.cssText="border: none; padding: 6px 12px; border-radius: 999px; background: transparent; color: #e0e0e0; cursor: pointer; font-weight: 600;",r.addEventListener("click",()=>{v.filterStatus=e,P(),E(),Mv(v,o),$v(v,t)}),S.push({key:e,btn:r}),T.appendChild(r)}),P();const k=document.createElement("div");k.style.cssText="display: inline-flex; gap: 6px; background: rgba(255,255,255,0.04); padding: 6px; border-radius: 999px; border: 1px solid rgba(143,130,255,0.25);",C.forEach(({key:e,label:t})=>{const n=document.createElement("button");n.type="button",n.textContent=t,n.style.cssText="border: none; padding: 6px 12px; border-radius: 999px; background: transparent; color: #e0e0e0; cursor: pointer; font-weight: 600;",n.addEventListener("click",()=>{v.filterStatus=e,P(),E(),Mv(v,o)}),S.push({key:e,btn:n}),k.appendChild(n)}),P();const A=document.createElement("select");A.style.cssText="padding: 8px 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.18); background: linear-gradient(135deg, #0b1020, #141a2a); color: #f5f7ff; box-shadow: inset 0 1px 0 rgba(255,255,255,0.06);",[{key:"all",label:"All Categories"},{key:"garden",label:"Garden"},{key:"pets",label:"Pets"},{key:"abilities",label:"Abilities"},{key:"shop",label:"Shop"},{key:"weather",label:"Weather"},{key:"wealth",label:"Wealth"},{key:"collection",label:"Collection"},{key:"streaks",label:"Streaks"},{key:"obscure",label:"Obscure"}].forEach(({key:e,label:t})=>{const n=document.createElement("option");n.value=e,n.textContent=t,n.style.background="#0b1020",n.style.color="#f5f7ff",A.appendChild(n)}),A.addEventListener("change",()=>{v.filterCategory=A.value,E(),Mv(v,o),$v(v,t)}),l.append(T,A),g.append(k);const E=()=>{const e=n,t=df();P(),Ev(v),c.innerHTML="";const o=function(e){const t=[],n=new Map;return e.forEach(e=>{const o=e.id.replace(/-\d+$/u,"");n.has(o)||(n.set(o,[]),t.push(o)),n.get(o).push(e)}),t.map(e=>({key:e,entries:(n.get(e)??[]).slice().sort((e,t)=>{const n=Zx[e.rarity]-Zx[t.rarity];return 0!==n?n:("number"==typeof e.target?e.target:0)-("number"==typeof t.target?t.target:0)})}))}(e);o.map(e=>{const n=e.entries[0]?.category;if("all"!==v.filterCategory&&n!==v.filterCategory)return null;const o=e.entries.filter((n,o)=>{const r=t.get(n.id),i=!!r?.completedAt,a=e.entries[o-1],s=!a||!!t.get(a.id)?.completedAt,l=!i&&(s||"common"===n.rarity);return"completed"===v.filterStatus?i:"in-progress"!==v.filterStatus||l});return o.length?{key:e.key,entries:o}:null}).filter(e=>Boolean(e)).forEach(e=>c.appendChild(Av(e,t,v)))};var $;v.unsubscribe=($=()=>{E(),"onetime"===v.activeTab&&Mv(v,o),"badges"===v.activeTab&&$v(v,t),cv(v.root)},Am.add($),$(df()),()=>Am.delete($));try{hf()}catch(M){s("Achievements recompute failed",M)}return mv.then(()=>{E(),Mv(v,o),$v(v,t),cv(v.root)}),E(),Mv(v,o),cv(v.root),v},toggleBadgePreview:Iv},Symbol.toStringTag,{value:"Module"})),zv={pets:{Worm:{name:"Worm",hungerCost:500,hoursToMature:12,rarity:"Common",weight:1},Snail:{name:"Snail",hungerCost:1e3,hoursToMature:12,rarity:"Common",weight:1},Bee:{name:"Bee",hungerCost:1500,hoursToMature:12,rarity:"Common",weight:1},Chicken:{name:"Chicken",hungerCost:3e3,hoursToMature:24,rarity:"Uncommon",weight:2},Bunny:{name:"Bunny",hungerCost:750,hoursToMature:24,rarity:"Uncommon",weight:2},Dragonfly:{name:"Dragonfly",hungerCost:250,hoursToMature:24,rarity:"Uncommon",weight:2},Pig:{name:"Pig",hungerCost:5e4,hoursToMature:72,rarity:"Rare",weight:3},Cow:{name:"Cow",hungerCost:25e3,hoursToMature:72,rarity:"Rare",weight:3},Turkey:{name:"Turkey",hungerCost:25e3,hoursToMature:72,rarity:"Rare",weight:3},Squirrel:{name:"Squirrel",hungerCost:15e3,hoursToMature:100,rarity:"Legendary",weight:4},Turtle:{name:"Turtle",hungerCost:1e5,hoursToMature:100,rarity:"Legendary",weight:4},Goat:{name:"Goat",hungerCost:2e4,hoursToMature:100,rarity:"Legendary",weight:4},Butterfly:{name:"Butterfly",hungerCost:25e3,hoursToMature:144,rarity:"Mythical",weight:5},Peacock:{name:"Peacock",hungerCost:1e5,hoursToMature:144,rarity:"Mythical",weight:5},Capybara:{name:"Capybara",hungerCost:15e4,hoursToMature:144,rarity:"Mythical",weight:5}}},Lv=new Map;function Rv(e){return e.trim().toLowerCase()}function qv(e){return Math.abs(e)>=1e9?`${(e/1e9).toFixed(2)}B`:Math.abs(e)>=1e6?`${(e/1e6).toFixed(2)}M`:Math.abs(e)>=1e3?`${(e/1e3).toFixed(2)}K`:e.toFixed(0)}function Nv(e){return null==e||Number.isNaN(e)?"‚Äî":qv(e)}!function(){const e=zv;if(e?.pets)for(const[t,n]of Object.entries(e.pets))n&&Lv.set(Rv(t),{weight:"number"==typeof n.weight?n.weight:null,maturityHours:"number"==typeof n.hoursToMature?n.hoursToMature:null,hungerCost:"number"==typeof n.hungerCost?n.hungerCost:null,sellPrice:"number"==typeof n.sellPrice?n.sellPrice:null,rarity:n.rarity??null})}();const Bv=[{id:"crop_harvest_value",name:"Crop Harvest Value",displayName:"üí∞ Crop Harvest Value",description:"Abilities that increase coin income through harvesting and selling crops",abilityIds:["DoubleHarvest","ProduceRefund","SellBoostI","SellBoostII","SellBoostIII","SellBoostIV"],comparisonMetric:"garden_impact",calculateComparableValue:(e,t)=>{const n=Ql(ln());if(null!=e.gardenValuePerProc&&e.gardenValuePerProc>0)return e.gardenValuePerProc;try{const o=Yl(e.id,n,t??100);if(o&&o.effectPerProc>0)return o.effectPerProc}catch(o){}if(n.totalMatureValue>0&&n.crops.length>0){const t=n.totalMatureValue/n.crops.length;if("DoubleHarvest"===e.id)return t;if("ProduceRefund"===e.id)return t;if(e.id.startsWith("SellBoost")){const t=10+2*((e.tier??1)-1);return n.totalMatureValue*t/100}return t}return null!=e.effectiveValue&&e.effectiveValue>0?e.effectiveValue:null}},{id:"mutation",name:"Mutation",displayName:"üåü Mutation & Transformation",description:"Abilities that transform crops through size increases or color mutations",abilityIds:["ProduceScaleBoost","ProduceScaleBoostII","ProduceMutationBoost","ProduceMutationBoostII","GoldGranter","RainbowGranter"],comparisonMetric:"garden_impact",calculateComparableValue:(e,t)=>{const n=Ql(ln());try{const o=Yl(e.id,n,t??100);if(o&&o.effectPerProc>0){return(e.procsPerHour??0)*o.effectPerProc}}catch(o){}return null!=e.valuePerHour&&e.valuePerHour>0?e.valuePerHour:null!=e.gardenValuePerProc&&null!=e.procsPerHour?e.gardenValuePerProc*e.procsPerHour:null}}],Dv=new Map;for(const $C of Bv)for(const e of $C.abilityIds)Dv.set(e,$C);function Hv(e){return Dv.get(e)??null}function jv(e){const t=null!=e.effectiveProbability?`${e.effectiveProbability.toFixed(1)}%`:"‚Äî",n=null!=e.procsPerHour?`${e.procsPerHour.toFixed(2)}/hr`:"‚Äî",o=e.baseName?.toLowerCase()??e.name.toLowerCase(),r=o.includes("egg growth"),i=o.includes("plant growth"),a=o.includes("rainbow")||o.includes("gold")||o.includes("size")||"coins"===e.effectUnit,s="xp"===e.effectUnit||"xp"===e.category;if(r){const o=e.valuePerHour??e.effectiveValue??null;return{valueText:null!=o?`${o.toFixed(1)} min/hr`:"‚Äî",procsText:n,probText:t}}if(i){const o=e.valuePerHour??e.effectiveValue??null;return{valueText:null!=o?`${o.toFixed(1)} min/hr`:"‚Äî",procsText:n,probText:t}}if(a){return{valueText:null!=e.valuePerHour?`${Nv(e.valuePerHour)}/hr`:"‚Äî",procsText:n,probText:t}}if(s){return{valueText:null!=e.valuePerHour?`${qv(e.valuePerHour)} XP/hr`:"‚Äî",procsText:n,probText:t}}if(e.effectLabel&&null!=e.effectiveValue){return{valueText:`${e.effectLabel}: ${e.effectiveValue.toFixed(2)}${e.effectSuffix??""}`,procsText:n,probText:t}}return{valueText:null!=e.valuePerHour?`${qv(e.valuePerHour)}/hr`:"‚Äî",procsText:n,probText:t}}function _v(e,t,n){if(!t||!n||t<=0||n<=t)return e;const o=n/t;return{...e,effectiveProbability:null!=e.effectiveProbability?e.effectiveProbability*o:null,procsPerHour:null!=e.procsPerHour?e.procsPerHour*o:null,procsPerDay:null!=e.procsPerDay?e.procsPerDay*o:null,valuePerHour:null!=e.valuePerHour?e.valuePerHour*o:null,valuePerDay:null!=e.valuePerDay?e.valuePerDay*o:null,gardenValuePerProc:null!=e.gardenValuePerProc?e.gardenValuePerProc*o:null,effectiveValue:null!=e.effectiveValue?e.effectiveValue*o:e.effectiveValue}}const Ov={plantGrowth:{base:"#2E7D32",glow:"rgba(46,125,50,0.65)",text:"#C8E6C9",border:"rgba(200,230,201,0.4)",label:"Plant Growth"},eggGrowth:{base:"#FF7043",glow:"rgba(255,112,67,0.65)",text:"#FFE0B2",border:"rgba(255,224,178,0.45)",label:"Egg Growth"},xp:{base:"#7C4DFF",glow:"rgba(124,77,255,0.65)",text:"#EDE7F6",border:"rgba(237,231,246,0.45)",label:"XP"},coins:{base:"#FFB300",glow:"rgba(255,179,0,0.65)",text:"#FFF8E1",border:"rgba(255,248,225,0.45)",label:"Coins"},misc:{base:"#90A4AE",glow:"rgba(144,164,174,0.6)",text:"#ECEFF1",border:"rgba(236,239,241,0.4)",label:"Ability"},hunger:{base:"#26C6DA",glow:"rgba(38,198,218,0.65)",text:"#E0F7FA",border:"rgba(224,247,250,0.45)",label:"Hunger"},mutation:{base:"#EC407A",glow:"rgba(236,64,122,0.6)",text:"#FCE4EC",border:"rgba(252,228,236,0.45)",label:"Mutation"},rainbow:{base:"#7C4DFF",glow:"rgba(124,77,255,0.7)",text:"#F3E5F5",border:"rgba(243,229,245,0.55)",label:"Rainbow"},gold:{base:"#FDD835",glow:"rgba(253,216,53,0.75)",text:"#FFFDE7",border:"rgba(255,253,231,0.55)",label:"Gold"},default:{base:"#5E5CE6",glow:"rgba(94,92,230,0.5)",text:"#E0E7FF",border:"rgba(224,231,255,0.4)",label:"Ability"}};function Gv(e){const t=(e||"").toLowerCase();return t.includes("rainbow")?"linear-gradient(135deg, #FF0000 0%, #FF7F00 16.67%, #FFFF00 33.33%, #00FF00 50%, #0000FF 66.67%, #4B0082 83.33%, #9400D3 100%)":t.includes("gold")||t.includes("golden")?"linear-gradient(135deg, #FFD700 0%, #FFA500 50%, #FFD700 100%)":t.includes("crop eater")||t.includes("crop refund")?"#FF5722":t.includes("crop mutation boost")?"#E91E63":t.includes("crop size boost")?"#4CAF50":t.includes("seed finder")?"#FF9800":t.includes("coin finder")?"#FFD700":t.includes("egg growth boost")?"#9C27B0":t.includes("pet refund")?"#00BCD4":t.includes("pet mutation boost")?"#E91E63":t.includes("sell boost")?"#F44336":t.includes("hunger restore")||t.includes("hunger boost")?"#EC407A":t.includes("hatch xp boost")?"#7C4DFF":t.includes("xp boost")?"#2196F3":t.includes("max strength boost")?"#673AB7":t.includes("plant growth boost")?"#26A69A":t.includes("rain dance")?"#2196F3":t.includes("double hatch")?"#5C6BC0":t.includes("double harvest")?"#1976D2":"#90A4AE"}const Vv={left:{border:"rgba(64,196,255,0.7)",glow:"0 0 22px rgba(64,196,255,0.35)",text:"#C9F1FF",gradient:"linear-gradient(135deg, rgba(64,196,255,0.16), rgba(10,23,42,0.75))",accent:"#7dd3ff"},right:{border:"rgba(189,147,249,0.8)",glow:"0 0 22px rgba(189,147,249,0.4)",text:"#F7E5FF",gradient:"linear-gradient(135deg, rgba(189,147,249,0.18), rgba(25,6,41,0.8))",accent:"#e3b7ff"}};function Wv(e,t,n,o){const r=function(e){return null==e||Number.isNaN(e)?null:Math.max(0,Math.min(100,e))}(n);return`\n    <div style="display:flex;flex-direction:column;gap:6px;padding:8px 10px;border-radius:12px;background:rgba(0,0,0,0.25);border:1px solid rgba(255,255,255,0.08);">\n      <div style="display:flex;justify-content:space-between;align-items:center;">\n        <span style="font-size:11px;color:rgba(255,255,255,0.75);letter-spacing:0.4px;">${e}</span>\n        <span style="font-size:13px;font-weight:700;color:${o};">${t}</span>\n      </div>\n      <div style="height:8px;border-radius:999px;background:rgba(255,255,255,0.08);overflow:hidden;">\n        <div style="height:100%;width:${null!=r?`${r}%`:"0%"};background:linear-gradient(90deg, ${o}, rgba(255,255,255,0.65));transition:width 0.3s ease;"></div>\n      </div>\n    </div>\n  `}const Uv=["rainbow","gold"],Xv=new WeakMap;let Qv=null,Jv=!1;const Kv="rgba(64, 255, 194, 0.28)",Yv="rgba(64, 255, 194, 0.9)",Zv=new Map;function ew(e){return`${e.species??"unknown"}-${e.mutations&&e.mutations.length?e.mutations.join(","):"none"}`}const tw=new Map,nw=new Set;let ow=0,rw=null;function iw(e){if(!e)return;const t=e.querySelectorAll("[data-pet-sprite-id]");if(!t.length)return;const n=[];for(const o of t)"1"!==o.dataset.petSpriteHydrated&&o.dataset.petSpriteId&&n.push(o);!async function(e){const t=5,n=16;for(let o=0;o<e.length;o+=t){const r=performance.now(),i=e.slice(o,o+t);for(const e of i)aw(e);if(o+t<e.length){performance.now()-r>=n&&await new Promise(e=>{"requestIdleCallback"in window?window.requestIdleCallback(()=>e(),{timeout:50}):requestAnimationFrame(()=>e())})}}}(n)}function aw(e){if(!e.isConnected){const t=e.dataset.petSpriteId;return t&&tw.delete(t),e.removeAttribute("data-pet-sprite-id"),void(e.dataset.petSpriteHydrated="1")}const t=e.dataset.petSpriteId;if(!t)return;const n=tw.get(t);if(!n)return e.dataset.petSpriteHydrated="1",void e.removeAttribute("data-pet-sprite-id");const o=lw({species:n.species,mutations:n.mutations,hasGold:n.hasGold,hasRainbow:n.hasRainbow});o&&(e.style.backgroundImage=`url(${o})`,n.species&&Zv.set(ew(n),o)),tw.delete(t),e.dataset.petSpriteHydrated="1",e.removeAttribute("data-pet-sprite-id")}const sw=e=>{if(!Qv)return;const t=e.target;t&&(Qv.element.contains(t)||Qv.select.contains(t))||Sw()};function lw(e){if(!e?.species)return null;const t=e.species.toLowerCase(),n=function(e){const t=new Set,n=e=>{const n=function(e){const t=String(e??"").toLowerCase();return"rainbow"===t?"rainbow":"gold"===t?"gold":null}(e);n&&t.add(n)};(e.mutations??[]).forEach(n),e.hasRainbow&&n("rainbow");e.hasGold&&n("gold");return t}(e);for(const o of Uv)if(n.has(o)){const e=Fi(Zi(t,["rainbow"===o?"Rainbow":"Gold"]));if(e)return e}return Fi(Yi(t))}const cw=new Set;let dw=[],pw="unknown",uw=!1,gw=null,mw=null;function fw(){gw||(gw=(async()=>{const e=function(){let e;const t=function(){const e=T.AriesMod??window.AriesMod??k("AriesMod"),t=e?.services?.PetsService;if(t&&"function"==typeof t.getTeams&&!1!==t.enabled)return s("[Aries] ‚úÖ Found PetsService via AriesMod.services.PetsService"),t;return null}();if(t)return t;if(e=T.PetsService,e&&"function"==typeof e.getTeams)return s("[Aries] ‚úÖ Found PetsService at pageWindow.PetsService"),e;if(S&&(e=window.PetsService,e&&"function"==typeof e.getTeams))return s("[Aries] ‚úÖ Found PetsService at window.PetsService"),e;if(e=k("PetsService"),e&&"function"==typeof e.getTeams)return s("[Aries] ‚úÖ Found PetsService via readSharedGlobal"),e;const n=T.QWS;if(n&&"object"==typeof n.PetsService&&(e=n.PetsService??void 0,e&&"function"==typeof e.getTeams))return s("[Aries] ‚úÖ Found PetsService at pageWindow.QWS.PetsService"),e;const o=window.QWS;if(o&&"object"==typeof o.PetsService&&(e=o.PetsService??void 0,e&&"function"==typeof e.getTeams))return s("[Aries] ‚úÖ Found PetsService at window.QWS.PetsService"),e;const r=function(){const e=[T.aries_mod,window.aries_mod,k("aries_mod"),yw("aries_mod")];for(const t of e){if(!bw(t).length)continue;const e=()=>xw(bw(t));return s("[Aries] ‚úÖ Found teams via aries_mod state"),{getTeams:e}}return null}();if(r)return r;const i=function(){const e=["qws:pets:teams:v1","MGA_petPresets","aries:teams","aries:petTeams","qws:teams","qws:petTeams","petTeams","teams"];for(const t of e)try{const e=localStorage.getItem(t);if(!e)continue;const n=JSON.parse(e);if(!Array.isArray(n))continue;if(n.every(e=>e&&"object"==typeof e&&"id"in e&&"name"in e&&"slots"in e&&Array.isArray(e.slots))&&n.length>0)return{getTeams:()=>n}}catch{}return null}();if(i)return s("[Aries] ‚úÖ Found teams in localStorage"),i;return null}();if(!e)return pw="unavailable",hw(),gw=null,void(null==mw&&cw.size>0&&(mw=window.setTimeout(()=>{mw=null,fw()},4e3)));if(s("[Aries] üîó PetsService detected, setting up team sync"),null!=mw&&(window.clearTimeout(mw),mw=null),uw)gw=null;else{uw=!0,pw="ready";try{dw=await async function(e){try{return xw(await Promise.resolve(e.getTeams()))}catch(t){return s("Aries getTeams failed",t),[]}}(e),s(`[Aries] Loaded ${dw.length} team(s):`,dw.map(e=>e.name).join(", ")),hw()}catch(t){s("[Aries] Failed to read Aries teams",t)}if("function"==typeof e.onTeamsChangeNow)try{await e.onTeamsChangeNow(e=>{dw=xw(e),s(`[Aries] Teams updated: ${dw.length} team(s)`),hw()}),s("[Aries] Successfully subscribed to team changes")}catch(t){s("[Aries] Failed to subscribe to Aries teams",t)}else s("[Aries] onTeamsChangeNow not available; presets will be static");gw=null}})().catch(e=>{s("Aries watcher setup failed",e),gw=null}))}function hw(){const e={status:pw,teams:dw};for(const n of cw)try{n(e)}catch(t){s("Aries listener failed",t)}}function bw(e){if(!e||"object"!=typeof e)return[];const t=e.pets??e.pet??e,n=t?.teams??t?.presets??t?.petTeams??t?.petTeam;return Array.isArray(n)?n:n&&"object"==typeof n?Object.values(n):[]}function yw(e){try{const t=localStorage.getItem(e);return t?JSON.parse(t):null}catch{return null}}function xw(e){if(!Array.isArray(e))return[];const t=[];return e.forEach(e=>{const n=function(e){if(!e||"object"!=typeof e)return null;const t=e,n=vw(t.id??t.teamId??t.key)??`team-${Math.random().toString(36).slice(2,8)}`,o=t.name??t.label??t.title??n,r="string"==typeof o&&o.trim().length?o.trim():`Team ${n}`,i=Array.isArray(t.slots)?t.slots:Array.isArray(t.team)?t.team:[],a=[];for(let s=0;s<3;s+=1)a.push(vw(i[s]));return{id:n,name:r,slotIds:a}}(e);n&&t.push(n)}),t}function vw(e){if("string"==typeof e){const t=e.trim();return t.length?t:null}if("number"==typeof e&&Number.isFinite(e))return String(e);if(e&&"object"==typeof e){const t=e;return vw(t.id)??vw(t.petId)??vw(t.slotId)??null}return null}function ww(e,t){let n=e.isConnected;const o=new MutationObserver(()=>{const r=e.isConnected;n||!r?n&&!r&&(o.disconnect(),t()):n=!0});o.observe(document.body,{childList:!0,subtree:!0})}function Cw(e,t){Xv.has(e)||(Xv.set(e,t),e.style.cursor="pointer",e.addEventListener("mousedown",t=>{e.disabled||(t.preventDefault(),t.stopPropagation(),function(e){Qv?.select===e?Sw():Tw(e)}(e))}),e.addEventListener("keydown",t=>{e.disabled||("ArrowDown"===t.key||"Enter"===t.key||" "===t.key?(t.preventDefault(),Tw(e)):"Escape"===t.key&&Sw())}))}function Tw(e){const t=Xv.get(e);if(!t)return;const n=Array.from(e.options);if(!n.length)return;Sw();const o=t(),r=e.getBoundingClientRect(),i=document.createElement("div"),a=r.left+window.scrollX,s=r.bottom+window.scrollY+8;let l=Math.min(360,window.innerHeight-r.bottom-8-4),c=s;if(l<160){const e=r.top-8;e>l&&(l=Math.min(360,e),c=r.top+window.scrollY-8-l)}const d=l>0?Math.min(360,l):240;i.style.cssText=`\n    position: absolute;\n    left: ${a}px;\n    top: ${c}px;\n    width: ${r.width}px;\n    max-height: ${d}px;\n    overflow-y: auto;\n    background: rgba(8, 10, 15, 0.98);\n    border: 1px solid var(--qpm-border);\n    border-radius: 10px;\n    box-shadow: 0 18px 40px rgba(0,0,0,0.55);\n    z-index: 1000000;\n    padding: 6px;\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n  `,n.forEach(t=>{const n=Number(t.value),r=Number.isFinite(n)?o[n]??null:null,a=r?lw(r.stats):null,s=function(e,t,n,o,r){const i=document.createElement("button");i.type="button",i.style.cssText=`\n    width: 100%;\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 8px 10px;\n    border: none;\n    border-radius: 8px;\n    background: ${r?"rgba(143,130,255,0.18)":"transparent"};\n    color: var(--qpm-text);\n    font-size: 13px;\n    text-align: left;\n    cursor: pointer;\n  `;const a=document.createElement("div");a.style.cssText=`\n    width: 30px;\n    height: 30px;\n    border-radius: 8px;\n    flex-shrink: 0;\n    image-rendering: pixelated;\n    background: ${o?`url("${o}") center/contain no-repeat`:"rgba(255,255,255,0.05)"};\n  `;const s=document.createElement("div");s.style.cssText="flex:1;font-weight:600;",s.textContent=n,i.appendChild(a),i.appendChild(s);const l=e=>{i.style.background="hover"===e?"rgba(143,130,255,0.22)":"selected"===e?"rgba(143,130,255,0.18)":"transparent"};r&&l("selected");return i.addEventListener("mouseenter",()=>l("hover")),i.addEventListener("mouseleave",()=>l(r?"selected":"idle")),i.addEventListener("click",()=>{e.value!==t&&(e.value=t,e.dispatchEvent(new Event("change",{bubbles:!0}))),Sw()}),i}(e,t.value,t.textContent??t.value,a,t.value===e.value);i.appendChild(s)}),i.children.length||(i.textContent="No pets available",i.style.color="var(--qpm-text-dim)",i.style.textAlign="center",i.style.padding="12px"),document.body.appendChild(i),Qv={element:i,select:e},function(){if(Jv)return;Jv=!0,document.addEventListener("mousedown",kw,!0),window.addEventListener("resize",Sw),document.addEventListener("scroll",sw,!0),document.addEventListener("keydown",Aw,!0)}()}function Sw(){Qv&&(Qv.element.remove(),Qv=null,Pw())}function Pw(e=!1){Jv&&(!e&&Qv||(Jv=!1,Qv=null,document.removeEventListener("mousedown",kw,!0),window.removeEventListener("resize",Sw),document.removeEventListener("scroll",sw,!0),document.removeEventListener("keydown",Aw,!0)))}function kw(e){if(!Qv)return;const t=e.target;Qv.element.contains(t)||Qv.select.contains(t)||Sw()}function Aw(e){"Escape"===e.key&&Sw()}const Ew=["Inventory","inventoryAtom","lockerAtom"],$w=["petHutchAtom","petHutch","hutchAtom","petHutchData","hutchPets","petHutchPets","Hutch Pets","petHutchEntries","/home/runner/work/magiccircle.gg/magiccircle.gg/client/src/games/Quinoa/atoms/inventoryAtoms.ts/myPetHutchStoragesAtom","/home/runner/work/magiccircle.gg/magiccircle.gg/client/src/games/Quinoa/atoms/inventoryAtoms.ts/myPetHutchItemsAtom","/home/runner/work/magiccircle.gg/magiccircle.gg/client/src/games/Quinoa/atoms/inventoryAtoms.ts/myPetHutchPetItemsAtom","/home/runner/work/magiccircle.gg/magiccircle.gg/client/src/games/Quinoa/atoms/inventoryAtoms.ts/myNumPetHutchItemsAtom"];function Mw(e){const t=(e,n)=>{if(n>4||null==e)return[];if(Array.isArray(e)){const t=e.filter(e=>e&&"object"==typeof e);if(t.length)return t}if("object"!=typeof e)return[];const o=[],r=["items","pets","inventory","entries","list","data","value"];for(const t of r){const n=e[t];Array.isArray(n)&&o.push(...n.filter(e=>e&&"object"==typeof e))}for(const i of Object.values(e))o.push(...t(i,n+1));return o};return t(e,0)}function Iw(e){if(!e||"object"!=typeof e)return!1;if(e.petSpecies||e.species)return!0;if(Array.isArray(e.abilities)||Array.isArray(e.mutations))return!0;return!!String(e.itemType??e.type??"").toLowerCase().includes("pet")||!(!e.pet||"object"!=typeof e.pet)&&Boolean(e.pet.species||e.pet.petSpecies)}function Fw(e,t){const n=e?.id??e?.petId??e?.itemId??e?.slotId??e?.uuid;if(n)return`${t}:${String(n)}`;return`${t}:${(e?.petSpecies??e?.species??"unknown").toLowerCase()}:${e?.xp??e?.pet?.xp??0}:${e?.targetScale??e?.pet?.targetScale??""}:${Array.isArray(e?.mutations)?e.mutations.length:0}`}function zw(e,t){const n=new Set,o=[];for(const r of e){if(!Iw(r))continue;const e=Fw(r,t);n.has(e)||(n.add(e),o.push(r))}return o}async function Lw(e){const t=V(e);if(!t)return[];try{return Mw(await W(t))}catch(n){return s(`Failed to read ${e}:`,n),[]}}async function Rw(){let e=[];for(const t of Ew){const n=await Lw(t);n.length&&(e=e.concat(n))}if(!e.length){const t=Is();for(const n of t){const t=n.raw,o=Boolean(t?.petSpecies||t?.species);(n.itemType&&"pet"===n.itemType.toLowerCase()||n.species||o)&&e.push(t??n)}}return zw(e,"inventory")}async function qw(){let e=[];for(const o of $w){const t=await Lw(o);t.length&&(e=e.concat(t))}if(!e.length)try{const n=O(/PetHutch|hutch/i);for(const o of n)try{const t=await W(o);e=e.concat(Mw(t))}catch(t){s("Failed reading hutch atom candidate",t)}}catch(t){s("Failed to scan atom cache for hutch",t)}if(!e.length)try{const t="undefined"!=typeof unsafeWindow?unsafeWindow:window,n=Object.keys(t).filter(e=>e.toLowerCase().includes("hutch"));for(const r of n){const n=t[r];if(n&&"object"==typeof n&&(n.debugLabel||n.label))try{const t=await W(n);e=e.concat(Mw(t));continue}catch{}if(e=e.concat(Mw(n)),n instanceof Map)for(const[,t]of n.entries()){const n=t?.value??t;e=e.concat(Mw(n))}}const o=Object.values(t).find(e=>e instanceof Map&&[...e.keys()].some(e=>String(e).includes("myPetHutch")));if(o)for(const[,r]of o.entries()){const t=r?.value??r;if(r?.debugLabel??r?.label??"")try{const t=await W(r);e=e.concat(Mw(t));continue}catch{}e=e.concat(Mw(t))}}catch(n){s("Failed to scan global hutch entries",n)}return zw(e,"hutch")}function Nw(e){return e&&Array.isArray(e)?e.map(e=>"string"==typeof e?e:e&&"object"==typeof e?e.name??e.type??e.abilityType??null:null).filter(e=>Boolean(e)):[]}function Bw(e,t){let n=0;const o=Array.from(e.options);for(const r of o){if(n>=16)break;const e=Number(r.value);if(!Number.isFinite(e))continue;const o=t[e];if(!o)continue;const i=Zv.get(ew(o.stats));i&&(r.style.backgroundImage=`url(${i})`,r.style.backgroundRepeat="no-repeat",r.style.backgroundSize="20px 20px",r.style.backgroundPosition="6px center",r.style.paddingLeft="30px",r.style.imageRendering="pixelated",n+=1)}}function Dw(e,t){const n=lw(t?.stats??null);n?(e.style.backgroundImage=`url(${n})`,e.style.backgroundRepeat="no-repeat",e.style.backgroundSize="24px 24px",e.style.backgroundPosition="8px center",e.style.paddingLeft="40px",e.style.imageRendering="pixelated"):(e.style.backgroundImage="",e.style.paddingLeft="12px")}async function Hw(){const e=[];let t=0;const n=async()=>{t+=1,t%8==0&&await new Promise(e=>{const t=T?.requestAnimationFrame??window.requestAnimationFrame;"function"!=typeof t?setTimeout(e,0):t(()=>e())})},o=async(t,o,r)=>{try{const n=Hb(t);e.push({stats:n,source:o,petInfo:t})}catch(i){s(r,i)}finally{await n()}},r=async(e,t)=>{try{const n=function(e){if(!e||"object"!=typeof e)return null;if(!(e.petSpecies||e.pet?.species||e.itemType&&String(e.itemType).toLowerCase().includes("pet")||e.type&&String(e.type).toLowerCase().includes("pet")))return null;const t=e.petSpecies??e.species??e.pet?.species??null;if(!t)return null;const n=e.targetScale??e.pet?.targetScale??null;let o=null;if(null!=n&&(o=Fc(n,t),null==o)){const e=Ic(t)??2;if(e>1){const t=(n-1)/(e-1);o=Math.round(80+20*t)}}null==o&&(o=100);let r=e.strength??e.pet?.strength??null;if(null!=r&&r>o&&(r=o),null==r&&null!=e.xp){const n=$c(t);if(n&&n>0){const t=Math.min(30,Math.floor(e.xp/n)),i=50,a=(o-i)/30;r=Math.min(o,Math.round(i+t*a))}}const i=Nw(e.mutations??e.pet?.mutations),a=Nw(e.abilities??e.pet?.abilities);return{slotIndex:-1,slotId:null,petId:e.id??e.petId??null,hungerPct:null,hungerValue:null,hungerMax:null,hungerRaw:null,name:e.name??e.pet?.name??null,species:t,targetScale:n,mutations:i,abilities:a,xp:e.xp??e.pet?.xp??null,level:r,levelRaw:null,strength:r,position:null,updatedAt:Date.now(),raw:e}}(e);if(!n)return;await o(n,t,`Failed to get stats for ${t} pet:`)}catch(r){s(`Failed to convert ${t} entry to pet info:`,r),await n()}},i=Er();for(const s of i)await o(s,"active","Failed to get stats for active pet:");const[a,l]=await Promise.all([Rw(),qw()]);for(const s of a)await r(s,"inventory");for(const s of l)await r(s,"hutch");return e}function jw(e,t,n=!1){const o=e.species?function(e){const t="sprite-"+ ++ow;return tw.set(t,{species:e.species??null,mutations:[...e.mutations??[]],hasGold:Boolean(e.hasGold),hasRainbow:Boolean(e.hasRainbow)}),t}(e):null;return`\n    <div ${o?`data-pet-sprite-id="${o}"`:""} style="${`\n    width: ${t}px;\n    height: ${t}px;\n    border-radius: ${Math.round(.2*t)}px;\n    background: linear-gradient(135deg,#3a3f5a,#202437);\n    position: relative;\n    overflow: hidden;\n    image-rendering: pixelated;\n    background-size: contain;\n    background-repeat: no-repeat;\n    background-position: center;\n    ${n?"border: 1px solid var(--qpm-border);":""}\n  `}"></div>\n  `}function _w(e){const t=document.createElement("div");if(e.length<2)return t.innerHTML='<div style="padding:20px;color:var(--qpm-text-dim);">Need at least 2 pets to compare.</div>',t;let n=0,o=1,r="";const i=document.createElement("div"),a=()=>{Sw();const t=e=>{if(!r.trim())return!0;if(r.startsWith("group:")){const t=r.substring(6);return e.stats.abilities.some(e=>{const n=Hv(e.id);return n&&n.id===t})}return e.stats.abilities.some(e=>e.name.toLowerCase().includes(r.toLowerCase())||(e.baseName||"").toLowerCase().includes(r.toLowerCase()))};[b,x].forEach((r,i)=>{const a=r.value;r.innerHTML="",e.forEach((e,n)=>{if(!t(e))return;const o=document.createElement("option");o.value=n.toString(),o.textContent=`${e.stats.name||e.stats.species||"Pet"} [${e.stats.currentStrength??"?"} STR]`,r.appendChild(o)}),Bw(r,e),Cw(r,()=>e);if(Array.from(r.options).some(e=>e.value===a))r.value=a;else if(r.options.length){r.selectedIndex=0;const e=Number(r.value);0===i?n=e:o=e}});const a=e[n],s=e[o];Dw(b,a),Dw(x,s),a&&s&&t(a)&&t(s)?(i.innerHTML="",i.appendChild(Ow(a,s,0,r)),iw(i)):i.innerHTML='<div style="padding:12px;color:var(--qpm-text-dim);">Select two pets with the chosen ability.</div>'},s=document.createElement("div");s.style.cssText="display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:18px;margin-bottom:16px;padding:12px;border:1px solid var(--qpm-border);border-radius:8px;background:rgba(143,130,255,0.05);";const l=document.createElement("div");l.style.cssText="display:flex;flex-direction:column;gap:6px;max-width:240px;text-align:left;";const c=document.createElement("select");c.style.cssText="padding:8px 10px;border:1px solid var(--qpm-border);border-radius:6px;background:rgba(18,20,26,0.6);color:var(--qpm-text);font-size:13px;";const d=document.createElement("div");d.style.cssText="font-size:12px;color:var(--qpm-text-dim);text-transform:uppercase;letter-spacing:0.5px;",d.textContent="Ability filter";const p=Array.from(new Set(e.flatMap(e=>e.stats.abilities.map(e=>e.baseName||e.name.split(" ")[0])))).filter(Boolean).sort();c.appendChild(new Option("All abilities",""));const u=document.createElement("optgroup");u.label="‚îÅ‚îÅ‚îÅ Ability Groups ‚îÅ‚îÅ‚îÅ",Bv.forEach(e=>{const t=new Option(e.displayName,`group:${e.id}`);u.appendChild(t)}),c.appendChild(u);const g=document.createElement("optgroup");g.label="‚îÅ‚îÅ‚îÅ Individual Abilities ‚îÅ‚îÅ‚îÅ",p.forEach(e=>{const t=new Option(e,e?e.toLowerCase():"");g.appendChild(t)}),c.appendChild(g),c.addEventListener("change",()=>{r=c.value,a()}),l.appendChild(d),l.appendChild(c);const m=document.createElement("div");m.style.cssText="display:flex;justify-content:center;margin:0 0 12px;",m.appendChild(l);const f=(t,n,o)=>{const r=document.createElement("div");r.style.cssText="display:flex;flex-direction:column;gap:6px;flex:1;max-width:320px;";const i=document.createElement("div");i.textContent=t,i.style.cssText="font-size:12px;color:var(--qpm-text-dim);text-transform:uppercase;letter-spacing:0.5px;";const s=document.createElement("select");return s.style.cssText="\n      width: 100%;\n      padding: 10px 12px;\n      background: rgba(18, 20, 26, 0.6);\n      color: var(--qpm-text);\n      border: 1px solid var(--qpm-border);\n      border-radius: 6px;\n      font-size: 14px;\n      font-weight: 500;\n    ",e.forEach((e,t)=>{const o=document.createElement("option");o.value=t.toString(),o.textContent=`${e.stats.name||e.stats.species||"Pet"} [${e.stats.currentStrength??"?"} STR]`,t===n&&(o.selected=!0),s.appendChild(o)}),s.addEventListener("change",t=>{const n=Number(t.target.value);o(n),Dw(s,e[n]),a()}),Bw(s,e),Dw(s,e[n]),Cw(s,()=>e),r.appendChild(i),r.appendChild(s),{wrap:r,select:s}},{wrap:h,select:b}=f("Pet A",n,t=>{n=t,n===o&&(o=(t+1)%e.length)}),{wrap:y,select:x}=f("Pet B",o,t=>{o=t,o===n&&(n=(t+1)%e.length)});return s.appendChild(h),s.appendChild(y),t.appendChild(m),t.appendChild(s),t.appendChild(i),a(),t}function Ow(e,t,n,o){const r=document.createElement("div");r.style.cssText="\n    display: grid;\n    grid-template-columns: repeat(3, minmax(0, 1fr));\n    gap: 12px;\n    align-items: stretch;\n  ";const i=e?.stats??null,a=t?.stats??null,s=function(e,t){if(e&&!t)return"A";if(t&&!e)return"B";if(!e||!t)return null;const n=Number(e.currentStrength??0),o=Number(t.currentStrength??0);if(n!==o)return n>o?"A":"B";const r=Number(e.maxStrength??0),i=Number(t.maxStrength??0);if(r!==i)return r>i?"A":"B";const a=Number(e.abilityCount??e.abilities.length??0),s=Number(t.abilityCount??t.abilities.length??0);if(a!==s)return a>s?"A":"B";const l=Number(e.mutationCount??e.mutations.length??0),c=Number(t.mutationCount??t.mutations.length??0);if(l!==c)return l>c?"A":"B";const d=e=>[...e.abilities].sort((e,t)=>{const n=(t.valuePerHour||0)-(e.valuePerHour||0);return Math.abs(n)>1e-6?n:(t.procsPerHour||0)-(e.procsPerHour||0)})[0],p=d(e),u=d(t),g=p&&p.valuePerHour||0,m=u&&u.valuePerHour||0;if(g!==m)return g>m?"A":"B";const f=p&&p.procsPerHour||0,h=u&&u.procsPerHour||0;return f!==h?f>h?"A":"B":null}(i,a),l=(e,t)=>{const n=Number(e),o=Number(t);return Number.isFinite(n)&&Number.isFinite(o)&&n!==o?n>o?"A":"B":null};l(i?.currentStrength,a?.currentStrength),l(i?.maxStrength,a?.maxStrength),l(i?.xp,a?.xp),l(i?.abilityCount??i?.abilities.length,a?.abilityCount??a?.abilities.length),l(i?.mutationCount??i?.mutations.length,a?.mutationCount??a?.mutations.length);const c=document.createElement("div");c.style.cssText="\n    background: rgba(255,255,255,0.03);\n    border: 1px solid var(--qpm-border);\n    border-radius: 10px;\n    padding: 12px;\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    align-content: center;\n    text-align: center;\n    font-size: 12px;\n    color: var(--qpm-text);\n  ";const d=(e,t,n)=>{const o=t??"‚Äî",r=n??"‚Äî",i=Number(t),a=Number(n),s=Number.isFinite(i)&&Number.isFinite(a),l=s&&i>a,c=s&&a>i,d=s&&i<a,p=s&&a<i,u="rgba(143,130,255,0.08)",g="#C9F1FF",m="#F7E5FF";return`\n      <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px;">\n        <div style="background:${u};padding:6px;border-radius:6px;${l?`box-shadow:0 0 0 1px ${Yv};background:${Kv};`:d?"box-shadow:0 0 0 1px var(--qpm-error);background:rgba(244,67,54,0.08);":""}">\n          <div style="font-size:10px;color:${g};">${e}</div>\n          <div style="font-weight:700;color:${l?"rgb(64, 255, 194)":d?"var(--qpm-error)":g};">${o}</div>\n        </div>\n        <div style="background:${u};padding:6px;border-radius:6px;${c?`box-shadow:0 0 0 1px ${Yv};background:${Kv};`:p?"box-shadow:0 0 0 1px var(--qpm-error);background:rgba(244,67,54,0.08);":""}">\n          <div style="font-size:10px;color:${m};">${e}</div>\n          <div style="font-weight:700;color:${c?"rgb(64, 255, 194)":p?"var(--qpm-error)":m};">${r}</div>\n        </div>\n      </div>\n    `},p=e=>e?.effectiveProbability??e?.probability??e?.procChance??null,u=e=>e?.procsPerHour??e?.procs??null,g=e=>e?.valuePerHour??e?.effectiveValue??e?.gardenValuePerProc??e?.value??null,m=(e,t)=>{const n=l(g(e),g(t));if(n)return n;const o=l(u(e),u(t));return o||l(p(e),p(t))},f=e=>{if(!e)return null;return(e.baseName||e.name).replace(/\s+(I|II|III|IV|V)$/i,"").trim()},h=i?.species??null,b=a?.species??null,y=h&&b&&h!==b,x=e=>{if(!e)return null;let t=e.stats.abilities;if(o.trim())if(o.startsWith("group:")){const n=o.substring(6);t=e.stats.abilities.filter(e=>{const t=Hv(e.id);return t&&t.id===n})}else t=e.stats.abilities.filter(e=>e.name.toLowerCase().includes(o.toLowerCase())||(e.baseName||"").toLowerCase().includes(o.toLowerCase()));return[...t].sort((e,t)=>{const n=(t.valuePerHour||0)-(e.valuePerHour||0);return Math.abs(n)>1e-6?n:(t.procsPerHour||0)-(e.procsPerHour||0)})[0]??null};let v=null,w=null,C=!1,T=!1,S=null,P=[];if(y&&e&&t){const n=e=>{if(!o.trim())return e;if(o.startsWith("group:")){const t=o.substring(6);return e.filter(e=>{const n=Hv(e.id);return n&&n.id===t})}return e.filter(e=>e.name.toLowerCase().includes(o.toLowerCase())||(e.baseName||"").toLowerCase().includes(o.toLowerCase()))},r=n(e.stats.abilities),i=n(t.stats.abilities);let a=!1;for(const e of r){const t=f(e);if(t){for(const n of i){const o=f(n);if(o&&t===o){v=e,w=n,C=!0,a=!0;break}}if(a)break}}if(!a){for(const e of r){const t=Hv(e.id);if(t)for(const n of i){const o=Hv(n.id);o&&t.id===o.id&&(P.push({abilityA:e,abilityB:n}),v&&w||(v=e,w=n,S=t,T=!0))}}P.length>0&&(a=!0)}a||(v=x(e),w=x(t))}else v=x(e),w=x(t);let k=null,A=null,E=null,$=null;if(y&&C){const e=zb(h),t=zb(b);e&&e>0&&(k=e/60),t&&t>0&&(A=t/60);const n=h?$c(h):null,o=b?$c(b):null,r=v?v.valuePerHour&&v.valuePerHour>0?v.valuePerHour:v.procsPerHour&&v.effectiveValue?v.procsPerHour*v.effectiveValue:null:null,i=w?w.valuePerHour&&w.valuePerHour>0?w.valuePerHour:w.procsPerHour&&w.effectiveValue?w.procsPerHour*w.effectiveValue:null:null;n&&r&&r>0&&(E=n/r),o&&i&&i>0&&($=o/i)}const M=(e,t="",n=!1,o=!1,r=!1,i="left")=>{if(!e)return'<div style="color:var(--qpm-text-dim);font-size:11px;">No proc data</div>';const{valueText:a,procsText:s,probText:l}=jv(e),c="rgb(64, 255, 194)",d="left"===i?"#C9F1FF":"#F7E5FF",p=n?c:d,u=o?c:d,g=r?c:d,m=n||o||r;return`\n      <div style="display:flex;flex-direction:column;gap:4px;font-size:11px;color:${d};padding:8px;border:1px solid ${m?Yv:"var(--qpm-border)"};border-radius:8px;background:${m?Kv:"rgba(255,255,255,0.02)"};text-align:left;">\n        <div style="font-weight:700;">${t||e.name}</div>\n        <div style="display:flex;justify-content:space-between;"><span style="color:var(--qpm-text-dim);">Proc %</span><span style="font-weight:700;color:${p};">${l}</span></div>\n        <div style="display:flex;justify-content:space-between;"><span style="color:var(--qpm-text-dim);">Procs/Hr</span><span style="font-weight:700;color:${u};">${s}</span></div>\n        <div style="display:flex;justify-content:space-between;"><span style="color:var(--qpm-text-dim);">Impact</span><span style="font-weight:700;color:${g};">${a}</span></div>\n      </div>\n    `},I=i&&(i.currentStrength??0)<(i.maxStrength??0)||a&&(a.currentStrength??0)<(a.maxStrength??0),F=v&&i?_v(v,i.currentStrength,i.maxStrength):null,z=w&&a?_v(w,a.currentStrength,a.maxStrength):null,L=l(p(v),p(w)),R=l(u(v),u(w)),q=l(g(v),g(w)),N=m(v,w),B=l(p(F),p(z)),D=l(u(F),u(z)),H=l(g(F),g(z)),j=m(F,z),_=Gw(e,n,"A"===s,o,"left",{}),O=Gw(t,n,"B"===s,o,"right",{}),G=I?`\n      <div style="margin-top:4px;padding:8px;border:1px dashed var(--qpm-border);border-radius:8px;background:rgba(143,130,255,0.05);">\n        <div style="font-size:11px;color:var(--qpm-text-dim);margin-bottom:6px;">Potential ability output at max STR</div>\n        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">\n          <div>${M(F,F?`${F.name} (max)`:"","A"===B||"A"===j,"A"===D||"A"===j,"A"===H||"A"===j,"left")}</div>\n          <div>${M(z,z?`${z.name} (max)`:"","B"===B||"B"===j,"B"===D||"B"===j,"B"===H||"B"===j,"right")}</div>\n        </div>\n      </div>\n    `:"",V=y&&C?`\n    <div style="margin-top:8px;padding:8px;border:1px dashed rgba(255,193,7,0.5);border-radius:8px;background:rgba(255,193,7,0.05);">\n      <div style="font-size:11px;color:rgba(255,193,7,0.9);margin-bottom:6px;font-weight:600;">üìä Cross-Species Comparison</div>\n      ${null!=k&&null!=A?d("Hunger Lifespan (h)",k.toFixed(1),A.toFixed(1)):""}\n      ${null!=E&&null!=$?d("Time/Level (h)",E.toFixed(2),$.toFixed(2)):""}\n    </div>\n  `:"",W=y&&T&&S?(()=>{const e=P.map(e=>{const t=function(e,t,n,o){const r=Hv(e.id),i=Hv(t.id);if(!r||!i||r.id!==i.id)return null;const a=r.calculateComparableValue(e,n),s=i.calculateComparableValue(t,o);let l=null;return null!=a&&null!=s&&(a>s?l="A":s>a&&(l="B")),{abilityA:e,abilityB:t,group:r,valueA:a,valueB:s,winner:l,comparisonLabel:"value_per_hour"===r.comparisonMetric?"üí∞ Value/Hour":"garden_impact"===r.comparisonMetric?"üåø Garden Impact/Hour":"‚ö° Procs/Hour"}}(e.abilityA,e.abilityB,i?.currentStrength??null,a?.currentStrength??null);if(!t)return"";const n="crop_harvest_value"===t.group.id,o=e=>null==e?"‚Äî":n?`${Nv(e)}/proc`:Nv(e),r="A"===t.winner,s="B"===t.winner;return`\n        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:6px;">\n          <div style="padding:6px;border-radius:6px;background:rgba(143,130,255,0.08);${r?"box-shadow:0 0 0 1px rgb(64,255,194);background:rgba(64,255,194,0.1);":""}">\n            <div style="font-size:10px;color:#C9F1FF;font-weight:600;">${e.abilityA.name}</div>\n            <div style="font-size:11px;color:${r?"rgb(64,255,194)":"#fff"};font-weight:${r?"700":"400"};">${o(t.valueA)}</div>\n          </div>\n          <div style="padding:6px;border-radius:6px;background:rgba(143,130,255,0.08);${s?"box-shadow:0 0 0 1px rgb(64,255,194);background:rgba(64,255,194,0.1);":""}">\n            <div style="font-size:10px;color:#F7E5FF;font-weight:600;">${e.abilityB.name}</div>\n            <div style="font-size:11px;color:${s?"rgb(64,255,194)":"#fff"};font-weight:${s?"700":"400"};">${o(t.valueB)}</div>\n          </div>\n        </div>\n      `}).join("");return`\n      <div style="margin-top:8px;padding:8px;border:1px dashed rgba(100,200,255,0.5);border-radius:8px;background:rgba(100,200,255,0.05);">\n        <div style="font-size:11px;color:rgba(100,200,255,0.9);margin-bottom:6px;font-weight:600;">üîÑ Cross-Ability Comparison: ${S.displayName}</div>\n        <div style="font-size:10px;color:var(--qpm-text-dim);margin-bottom:6px;">${S.description}</div>\n        ${e}\n      </div>\n    `})():"";return c.innerHTML=`\n    <div style="font-size: 13px; font-weight: 700; color: var(--qpm-accent);">Duel Metrics</div>\n    ${d("Strength",i?.currentStrength,a?.currentStrength)}\n    ${d("Max STR",i?.maxStrength,a?.maxStrength)}\n    <div style="background:rgba(255,255,255,0.02);border:1px solid var(--qpm-border);padding:8px;border-radius:8px;display:grid;grid-template-columns:1fr 1fr;gap:8px;text-align:left;">\n      <div>${M(v,"","A"===L||"A"===N,"A"===R||"A"===N,"A"===q||"A"===N,"left")}</div>\n      <div>${M(w,"","B"===L||"B"===N,"B"===R||"B"===N,"B"===q||"B"===N,"right")}</div>\n    </div>\n    ${V}\n    ${W}\n    ${G}\n  `,r.appendChild(_),r.appendChild(c),r.appendChild(O),r}function Gw(e,t,n,o,r,i={}){const a=document.createElement("div"),s=Vv[r],l=n?"rgba(64,255,194,0.9)":s.border,c=n?"0 0 22px rgba(64,255,194,0.45)":s.glow;if(a.dataset.slot=String(t+1),a.style.cssText=`\n    background: ${s.gradient};\n    border: 1px solid ${l};\n    border-radius: 16px;\n    padding: 16px;\n    min-height: 220px;\n    box-shadow: ${c};\n    position: relative;\n    overflow: hidden;\n  `,!e)return a.innerHTML='\n      <div style="font-size: 13px; font-weight: 600; color: var(--qpm-text-dim); text-align: center;">\n        Empty Slot\n      </div>\n    ',a;const d=e.stats;var p;(p=d.species??null)&&Lv.get(Rv(p));const u=d.hungerPct??null,g=d.species?$c(d.species):null,m=d.xp??0,f=g?m%g:0,h=g&&g>0?f/g*100:0,b=g?`${f.toFixed(0)} / ${g} XP`:"‚Äî",y=u;let x=null;if(d.species&&null!=u){const e=zb(d.species);null!=e&&(x=u/100*(e/60))}const v=[];null!=y&&v.push(`${y.toFixed(0)}%`),null!=x&&v.push(`${x.toFixed(1)}h left`);const w=v.join(" ‚Ä¢ ")||"‚Äî",C=null!=d.maxStrength&&null!=d.currentStrength?Math.max(0,d.maxStrength-d.currentStrength):null,T=d.maxStrength&&d.currentStrength?Math.max(0,d.maxStrength-d.currentStrength)/Math.max(1,d.maxStrength/30):null,S=g&&T?Math.round(T*g):null;C&&C>0?S&&qv(S):null!=d.xp&&qv(d.xp);const P=o.trim().toLowerCase();[...P?d.abilities.filter(e=>e.name.toLowerCase().includes(P)||(e.baseName||"").toLowerCase().includes(P)):d.abilities].sort((e,t)=>{const n=(t.valuePerHour||0)-(e.valuePerHour||0);return Math.abs(n)>.01?n:(t.procsPerHour||0)-(e.procsPerHour||0)}).slice(0,3).map(e=>{const{valueText:t,procsText:n,probText:o}=jv(e),r=function(e){if(!e)return Ov.default;const t=e.category??"";if(t&&Object.prototype.hasOwnProperty.call(Ov,t))return Ov[t];const n=(e.baseName??e.name).toLowerCase();return n.includes("rainbow")?Ov.rainbow:n.includes("gold")?Ov.gold:n.includes("hunger")?Ov.hunger:n.includes("mutation")?Ov.mutation:Ov.default}(e);return`\n      <div style="display:flex;align-items:center;gap:10px;padding:10px;border-radius:12px;background:rgba(8,5,16,0.45);border:1px solid ${r.border};box-shadow:0 0 14px ${r.glow};">\n        <span style="width:18px;height:18px;border-radius:6px;background:${r.base};border:1px solid rgba(255,255,255,0.15);"></span>\n        <div style="flex:1;">\n          <div style="font-size:12px;font-weight:600;color:${r.text};">${e.name}</div>\n          <div style="font-size:10px;color:var(--qpm-text-dim);">${t}</div>\n        </div>\n        <div style="text-align:right;font-size:10px;color:var(--qpm-text-dim);">\n          <div style="font-weight:600;color:${r.text};">${n}</div>\n          <div>${o} proc</div>\n        </div>\n      </div>\n    `}).join("");const k=d.abilities.slice(0,4).map(e=>({color:Gv(e.baseName||e.name),name:e.name||"Unknown Ability"})),A=`\n    <div style="display:flex;flex-direction:column;gap:10px;width:100%;">\n      ${Wv("XP/Level",b,h,"#7C4DFF")}\n      ${Wv("Hunger",w,y,"#9BF5C3")}\n    </div>\n  `,E=`\n    <div style="position:relative;display:flex;flex-direction:column;align-items:center;gap:8px;width:100%;padding:8px 0;">\n      \x3c!-- STR text above image --\x3e\n      <div style="font-size:13px;font-weight:600;color:${s.text};">\n        STR: ${null!=d.currentStrength?d.currentStrength.toFixed(0):"?"}\n      </div>\n\n      \x3c!-- Pet image centered --\x3e\n      <div style="position:relative;display:flex;justify-content:center;">\n        ${jw(d,128,!1)}\n\n        \x3c!-- Ability squares positioned to the left of pet image --\x3e\n        <div class="qpm-ability-squares" style="position:absolute;left:-30px;top:50%;transform:translateY(-50%);display:flex;flex-direction:column;gap:6px;"></div>\n      </div>\n\n      \x3c!-- MAX STR text below image --\x3e\n      <div style="font-size:13px;font-weight:600;color:${s.text};">\n        MAX STR: ${null!=d.maxStrength?d.maxStrength.toFixed(0):"?"}\n      </div>\n    </div>\n  `;a.innerHTML=`\n    <div style="display:flex;flex-direction:column;align-items:center;gap:12px;text-align:center;">\n      <div>\n        <div style="font-size:16px;font-weight:700;color:${s.text};">${d.name||d.species||"Pet"}</div>\n        <div style="font-size:12px;color:rgba(255,255,255,0.7);">${d.species||"Unknown Species"}</div>\n      </div>\n      ${E}\n      ${A}\n    </div>\n  `;const $=a.querySelector(".qpm-ability-squares");return $&&k.forEach(({color:e,name:t})=>{const n=document.createElement("div");n.style.cssText=`\n        width: 20px;\n        height: 20px;\n        background: ${e};\n        border-radius: 4px;\n        border: 1px solid rgba(255, 255, 255, 0.4);\n        cursor: help;\n        transition: all 0.2s;\n      `,n.title=t,n.addEventListener("mouseenter",()=>{n.style.transform="scale(1.15)",n.style.borderColor="rgba(255,255,255,0.8)"}),n.addEventListener("mouseleave",()=>{n.style.transform="scale(1)",n.style.borderColor="rgba(255,255,255,0.4)"}),$.appendChild(n)}),a}function Vw(e){const t=document.createElement("div");if(e.length<2)return t.innerHTML='<div style="padding:20px;color:var(--qpm-text-dim);">Need more pets for 3v3 teams.</div>',t;const n=function(e){const t=new Map,n=(e,n)=>{const o=vw(e);o&&!t.has(o)&&t.set(o,n)};return e.forEach(e=>{n(e.stats.petId,e),n(e.petInfo?.petId??null,e),n(e.petInfo?.slotId??null,e);const t=e.petInfo?.raw;if(t){n(t.id,e),n(t.petId,e),n(t.slotId,e);const o=t.slot;o&&(n(o.id,e),n(o.petId,e),n(o.slotId,e))}}),t}(e),o=[e[0]??null,e[1]??null,e[2]??null],r=[e[3]??null,e[4]??null,e[5]??null];let i="";const a=document.createElement("div");a.style.cssText="\n    display: grid;\n    grid-template-columns: repeat(2, minmax(0, 1fr));\n    gap: 10px;\n    margin-bottom: 14px;\n  ";const l=(t,n,o)=>{const r=document.createElement("div");r.style.cssText="\n      border: 1px solid var(--qpm-border);\n      border-radius: 8px;\n      padding: 10px;\n      background: rgba(143, 130, 255, 0.05);\n    ";const a=document.createElement("div");a.textContent=t,a.style.cssText="font-weight:700;color:var(--qpm-accent);margin-bottom:6px;";const s=document.createElement("div");return s.style.cssText="display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:6px;",n.forEach((t,r)=>{const a=document.createElement("select");a.style.cssText="\n        width: 100%;\n        padding: 8px;\n        background: rgba(18, 20, 26, 0.6);\n        color: var(--qpm-text);\n        border: 1px solid var(--qpm-border);\n        border-radius: 6px;\n        font-size: 12px;\n      ",a.dataset.slot=String(r);const l=()=>{const o=a.value;if(a.innerHTML="",e.forEach((e,n)=>{if(i)if(i.startsWith("group:")){const t=i.substring(6);if(!e.stats.abilities.some(e=>{const n=Hv(e.id);return n&&n.id===t}))return}else if(!e.stats.abilities.some(e=>(e.baseName||"").toLowerCase().includes(i.toLowerCase())||e.name.toLowerCase().includes(i.toLowerCase())))return;const o=document.createElement("option");o.value=n.toString(),o.textContent=`${e.stats.name||e.stats.species||"Pet"} [${e.stats.currentStrength??"?"} STR]`,e!==t||a.value||(o.selected=!0),a.appendChild(o)}),Bw(a,e),Array.from(a.options).some(e=>e.value===o))a.value=o;else if(a.options.length){a.selectedIndex=0;const t=Number(a.value);n[r]=e[t]??null}Dw(a,n[r])};l(),a.addEventListener("change",t=>{const i=[...n],s=Number(t.target.value);i[r]=e[s]??null,o(i),Dw(a,i[r]),T()}),a.dataset.rebuild="1",a._rebuild=l,Cw(a,()=>e),s.appendChild(a)}),r.appendChild(a),r.appendChild(s),r};let c;a.appendChild(l("üîµ Team A",o,e=>{o.splice(0,o.length,...e)})),a.appendChild(l("üî¥ Team B",r,e=>{r.splice(0,r.length,...e)}));const d=(e,t)=>{const o=[],r=[];e.slotIds.forEach((e,t)=>{if(!e)return void(o[t]=null);const i=n.get(e)??null;i||r.push(t+1),o[t]=i}),t.splice(0,t.length,...o),r.length?(c.textContent=`Applied "${e.name}" but slots ${r.join(", ")} are missing in Pet Hub data.`,c.style.color="var(--qpm-error)"):(c.textContent=`‚úÖ Applied "${e.name}" preset.`,c.style.color="var(--qpm-success)"),T()},p=(e,t)=>{let n=[];const o=document.createElement("div");o.style.cssText="display:flex;flex-direction:column;gap:4px;";const r=document.createElement("div");r.textContent=e,r.style.cssText="font-size:12px;font-weight:600;color:var(--qpm-accent);";const i=document.createElement("select");i.style.cssText="padding:6px 10px;border:1px solid var(--qpm-border);border-radius:6px;background:rgba(18,20,26,0.6);color:var(--qpm-text);font-size:13px;",i.disabled=!0,i.appendChild(new Option("No presets detected","")),i.addEventListener("change",()=>{const e=n.find(e=>e.id===i.value);e&&(t(e),i.value="")});return o.append(r,i),{wrapper:o,updateOptions:e=>{n=e,i.innerHTML="",i.appendChild(new Option("Select preset","")),e.length?(e.forEach(e=>{i.appendChild(new Option(e.name,e.id))}),i.disabled=!1):i.disabled=!0}}},u=document.createElement("div");u.style.cssText="display:none;flex-direction:column;gap:10px;margin-bottom:12px;padding:10px;border:1px solid var(--qpm-border);border-radius:10px;background:rgba(143,130,255,0.08);";const g=document.createElement("div");g.style.cssText="display:flex;align-items:center;justify-content:space-between;";const m=document.createElement("div");m.textContent="üîó Aries Mod Presets",m.style.cssText="font-size:13px;font-weight:700;color:var(--qpm-accent);";const f=document.createElement("button");f.textContent="üîÑ Refresh",f.style.cssText="padding:4px 8px;font-size:11px;background:rgba(143,130,255,0.2);color:var(--qpm-accent);border:1px solid var(--qpm-border);border-radius:4px;cursor:pointer;",f.title="Manually retry detection of Aries Mod",f.addEventListener("click",()=>{s("[Aries] Manual refresh triggered"),uw=!1,gw=null,null!=mw&&(window.clearTimeout(mw),mw=null),fw()}),g.append(m,f),c=document.createElement("div"),c.style.cssText="font-size:11px;color:var(--qpm-text-dim);",c.textContent="Detecting Aries Mod teams...";const h=document.createElement("div");h.style.cssText="display:grid;grid-template-columns:repeat(auto-fit, minmax(220px,1fr));gap:10px;";const b=p("Apply to Team A",e=>d(e,o)),y=p("Apply to Team B",e=>d(e,r));h.append(b.wrapper,y.wrapper),u.append(g,c,h);var x;ww(t,(x=({status:e,teams:t})=>{"ready"===e&&t.length>0?(u.style.display="flex",c.textContent=`‚úÖ Found ${t.length} preset(s). Select one to populate team slots automatically.`,c.style.color="var(--qpm-success)",b.updateOptions(t),y.updateOptions(t),h.style.display="grid"):"ready"===e&&0===t.length?(u.style.display="flex",c.textContent="‚ö†Ô∏è No pet teams found in Aries Mod. Create teams first.",c.style.color="var(--qpm-warning)",h.style.display="none"):u.style.display="none"},cw.add(x),x({status:pw,teams:dw}),fw(),()=>{cw.delete(x)}));const v=document.createElement("div");v.style.cssText="display:grid;grid-template-columns:1fr;gap:12px;";const w=()=>{const e=document.createDocumentFragment();for(let t=0;t<3;t++){const n=Ow(o[t]??null,r[t]??null,t,i);e.appendChild(n)}for(;v.firstChild;)v.removeChild(v.firstChild);v.appendChild(e),iw(v)};let C=null;const T=()=>{null!=C&&window.clearTimeout(C),C=window.setTimeout(()=>{C=null,w()},50)},S=document.createElement("div");S.style.cssText="display:flex;flex-direction:column;gap:6px;align-items:center;text-align:center;";const P=document.createElement("div");P.textContent="Ability filter",P.style.cssText="font-size:12px;color:var(--qpm-text-dim);text-transform:uppercase;letter-spacing:0.5px;";const k=document.createElement("select");k.style.cssText="padding:6px 10px;border:1px solid var(--qpm-border);border-radius:6px;background:rgba(18,20,26,0.6);color:var(--qpm-text);font-size:13px;width:220px;",k.appendChild(new Option("All abilities",""));const A=document.createElement("optgroup");A.label="‚îÅ‚îÅ‚îÅ Ability Groups ‚îÅ‚îÅ‚îÅ",Bv.forEach(e=>{const t=new Option(e.displayName,`group:${e.id}`);A.appendChild(t)}),k.appendChild(A);const E=Array.from(new Set(e.flatMap(e=>e.stats.abilities.map(e=>e.baseName||e.name.split(" ")[0])))).filter(e=>Boolean(e)).sort(),$=document.createElement("optgroup");$.label="‚îÅ‚îÅ‚îÅ Individual Abilities ‚îÅ‚îÅ‚îÅ",E.forEach(e=>{const t=new Option(e,e.toLowerCase());$.appendChild(t)}),k.appendChild($),k.addEventListener("change",()=>{i=k.value.trim(),a.querySelectorAll('select[data-rebuild="1"]').forEach(e=>{const t=e._rebuild;"function"==typeof t&&t()}),T()}),S.appendChild(P),S.appendChild(k);const M=document.createElement("div");return M.style.cssText="display:flex;justify-content:center;margin-bottom:12px;",M.appendChild(S),t.appendChild(M),t.appendChild(u),t.appendChild(a),t.appendChild(v),w(),t}window.__QPM__=window.__QPM__||{},window.__QPM__.getAtomByLabel=V;const Ww=Object.freeze(Object.defineProperty({__proto__:null,renderPetHubWindow:function(e){e.innerHTML="",e.style.cssText="\n    padding: 0;\n    min-height: 400px;\n  ",e.innerHTML='<div style="padding: 40px; text-align: center; color: var(--qpm-text-dim);">Loading pets...</div>',Hw().then(t=>{e.innerHTML="",0!==t.length?function(e,t){const n=document.createElement("div");n.style.cssText="\n    display: flex;\n    border-bottom: 1px solid var(--qpm-border);\n    background: rgba(143, 130, 255, 0.05);\n  ";const o=document.createElement("div");o.style.cssText="\n    padding: 20px;\n    overflow-y: auto;\n    max-height: 75vh;\n    min-width: 1080px;\n  ";let r="compare";const i=(e,t,o)=>{const i=document.createElement("button");i.textContent=`${o} ${t}`;return(()=>{const t=r===e;i.style.cssText=`\n        flex: 1;\n        padding: 14px 20px;\n        background: ${t?"rgba(143, 130, 255, 0.15)":"transparent"};\n        color: ${t?"var(--qpm-accent)":"var(--qpm-text-dim)"};\n        border: none;\n        border-bottom: 2px solid ${t?"var(--qpm-accent)":"transparent"};\n        font-size: 14px;\n        font-weight: 600;\n        cursor: pointer;\n        transition: all 0.2s;\n      `})(),i.addEventListener("click",()=>{r=e,Array.from(n.children).forEach(e=>{const t=e;t.style.background=t===i?"rgba(143,130,255,0.15)":"transparent",t.style.color=t===i?"var(--qpm-accent)":"var(--qpm-text-dim)",t.style.borderBottom=t===i?"2px solid var(--qpm-accent)":"2px solid transparent"}),a()}),i},a=()=>{o.innerHTML="";if("team"===r&&t.length>10){const e=document.createElement("div");e.style.cssText="padding:40px;text-align:center;color:var(--qpm-text-dim);",e.textContent="‚è≥ Loading...",o.appendChild(e),requestAnimationFrame(()=>{o.innerHTML="","compare"===r?o.appendChild(_w(t)):"team"===r&&o.appendChild(Vw(t)),iw(o)})}else"compare"===r?o.appendChild(_w(t)):"team"===r&&o.appendChild(Vw(t)),iw(o)};n.appendChild(i("compare","1v1 Compare","‚öñÔ∏è")),n.appendChild(i("team","3v3 Compare","üë•")),e.appendChild(n),e.appendChild(o),a();let l=null;Ni||(l=Bi(()=>{iw(o),s("[PetHub] Sprites ready - re-hydrating")}));ww(e,()=>{Pw(!0),null!=mw&&(window.clearTimeout(mw),mw=null),l&&l(),tw.clear(),nw.clear(),ow=0,rw?.disconnect(),rw=null})}(e,t):e.innerHTML='\n        <div style="padding: 60px; text-align: center; color: var(--qpm-text-dim);">\n          <div style="font-size: 48px; margin-bottom: 12px;">üêæ</div>\n          <div style="font-size: 16px; font-weight: 600;">No Pets Found</div>\n          <div style="font-size: 13px;">Hatch or place some pets to use the Pet Hub.</div>\n        </div>\n      '}).catch(t=>{s("Failed to load pets:",t),e.innerHTML=`\n      <div style="padding: 40px; text-align: center; color: var(--qpm-error);">\n        <div style="font-size: 48px; margin-bottom: 15px;">‚ö†Ô∏è</div>\n        <div style="font-size: 16px; font-weight: 600; margin-bottom: 8px;">Failed to Load Pets</div>\n        <div style="font-size: 13px; color: var(--qpm-text-dim);">${t}</div>\n      </div>\n    `})}},Symbol.toStringTag,{value:"Module"})),Uw=[{id:"growth",name:"Growth Acceleration",icon:"üå±",description:"Speeds up plant or egg growth"},{id:"coins",name:"Coin Generation",icon:"üí∞",description:"Increases coin income"},{id:"mutations",name:"Mutation Boosting",icon:"‚ú®",description:"Boosts mutation chances or grants special mutations"},{id:"xp",name:"XP Farming",icon:"üìà",description:"Increases XP gains"},{id:"harvest",name:"Harvest Boosting",icon:"üåæ",description:"Increases harvest yields"},{id:"specialty",name:"Specialty",icon:"‚≠ê",description:"Unique or rare abilities"},{id:"general",name:"General",icon:"üìã",description:"Other useful abilities"}],Xw={PlantGrowthBoost:"growth",PlantGrowthBoostII:"growth",EggGrowthBoost:"growth",EggGrowthBoostII:"growth",EggGrowthBoostII_NEW:"growth",CoinFinder:"coins",CoinFinderII:"coins",CoinFinderIII:"coins",SellBoostI:"coins",SellBoostII:"coins",SellBoostIII:"coins",SellBoostIV:"coins",ProduceRefund:"coins",RainbowGranter:"mutations",GoldGranter:"mutations",ProduceMutationBoost:"mutations",ProduceMutationBoostII:"mutations",PetMutationBoost:"mutations",PetMutationBoostII:"mutations",PetXpBoost:"xp",PetXpBoostII:"xp",DoubleHarvest:"harvest",ProduceScaleBoost:"harvest",ProduceScaleBoostII:"harvest",RainDance:"specialty",PetHatchSizeBoost:"specialty",PetHatchSizeBoostII:"specialty",PetAgeBoostII:"specialty",SeedFinder:"coins",SeedFinderII:"coins",SeedFinderIII:"coins",SeedFinderIV:"coins",ProduceEater:"general",PetRefund:"general",DoubleHatch:"specialty"};let Qw={...{selectedStrategy:"all",showObsoleteOnly:!1,groupBySpecies:!0,sortBy:"score",sortDirection:"desc",minStrengthThreshold:100,protectedPetIds:new Set},protectedPetIds:new Set},Jw=null,Kw=0;const Yw=new Set;function Zw(){return{...Qw,protectedPetIds:new Set(Qw.protectedPetIds)}}function eC(e){Qw={...Qw,...e},g.set("petOptimizer:config",{...Qw,protectedPetIds:Array.from(Qw.protectedPetIds)}),Jw=null,Kw=0}async function tC(){const e=[];try{const t=Er();for(const r of t){const t=nC(r);t&&e.push(t)}const n=await async function(){try{const e=V("myInventoryAtom");if(!e)return s("‚ö†Ô∏è Pet Optimizer: myInventoryAtom not found"),[];const t=await W(e);if(!t||!Array.isArray(t.items))return[];const n=[];for(const o of t.items){if("object"!=typeof o||null===o)continue;const e=o;if("Pet"===e.itemType||"petSpecies"in e){const t=oC(e,"inventory");t&&n.push(t)}}return n}catch(e){return s("‚ö†Ô∏è Pet Optimizer: Failed to get inventory pets:",e),[]}}();e.push(...n);const o=await async function(){try{const e=V("myPetHutchPetItemsAtom");if(!e)return s("‚ö†Ô∏è Pet Optimizer: myPetHutchPetItemsAtom not found"),[];const t=await W(e);if(!t||!Array.isArray(t))return[];const n=[];for(const o of t){const e=oC(o,"hutch");e&&n.push(e)}return n}catch(e){return s("‚ö†Ô∏è Pet Optimizer: Failed to get hutch pets:",e),[]}}();e.push(...o)}catch(t){throw s("‚ùå Pet Optimizer: Error during collection:",t),t}return e}function nC(e){if(!e.species)return null;const t=e.abilities.map(e=>{const t=Ll(e);return t?.id||e}),n=e.species&&e.targetScale?Fc(e.targetScale,e.species):null;return{id:e.petId||`active-${e.slotIndex}`,name:e.name,species:e.species,location:"active",slotIndex:e.slotIndex,strength:e.strength||0,maxStrength:n,targetScale:e.targetScale,xp:e.xp,level:e.level,abilities:e.abilities,abilityIds:t,mutations:e.mutations,hasGold:e.mutations.some(e=>e.toLowerCase().includes("gold")),hasRainbow:e.mutations.some(e=>e.toLowerCase().includes("rainbow")),raw:e.raw}}function oC(e,t){const n=e.petSpecies||e.species||null;if(!n)return null;const o=e.name||null,r=e.id||`${t}-${Math.random()}`,i=e.abilities||e.ability||[],a=Array.isArray(i)?i.filter(e=>"string"==typeof e):[],s=a.map(e=>{const t=Ll(e);return t?.id||e}),l="number"==typeof e.targetScale?e.targetScale:null,c="number"==typeof e.xp?e.xp:null,d="number"==typeof e.level?e.level:null;let p,u=null;const g=$c(n);if("number"==typeof e.strength&&e.strength>0)if(p=e.strength,null!==c&&g){const e=Math.floor(c/g),t=p-Math.min(30,e);u=Math.min(t+30,100)}else l&&(u=Fc(l,n));else{const e=function(e){if(!e)return null;const t=e.match(/[\(\[](\d+)[\)\]]/);return t&&t[1]?parseInt(t[1],10):null}(o);if(e&&e>=80&&e<=100&&null!==c&&g){u=e;const t=u-30,n=Math.floor(c/g);p=t+Math.min(30,n)}else l?(u=Fc(l,n),p=null!==u?u:0):(p=0,u=null)}const m=e.mutations||[],f=Array.isArray(m)?m.filter(e=>"string"==typeof e):[];return{id:r,name:o,species:n,location:t,slotIndex:-1,strength:p,maxStrength:u,targetScale:l,xp:c,level:d,abilities:a,abilityIds:s,mutations:f,hasGold:f.some(e=>e.toLowerCase().includes("gold")),hasRainbow:f.some(e=>e.toLowerCase().includes("rainbow")),raw:e}}function rC(e){const t={currentStrength:2*e.strength,maxStrength:2*(e.maxStrength||e.strength),potential:0,abilityTier:0,abilityRarity:0,mutation:0};if(e.maxStrength&&e.maxStrength>e.strength){const n=e.maxStrength-e.strength;t.potential=Math.min(100,3*n)}const n=new Set(["ProduceEater","SeedFinderI"]),o=e.hasRainbow||e.hasGold?e.abilityIds.filter(e=>!n.has(e)):e.abilityIds;var r;t.abilityTier=function(e){let t=0;for(const n of e){if(n in aC){const e=aC[n];if(void 0!==e){t+=e;continue}}const e=n.match(/(I{1,3}|IV)$/);if(e&&e[1]){const n=e[1],o=iC[n];t+=void 0!==o?o:25}else t+=50}return Math.min(300,t)}(o),t.abilityRarity=3===(r=o).length?100:2===r.length?60:1===r.length?30:0,e.hasRainbow?t.mutation=100:e.hasGold&&(t.mutation=50);let i=0,a=null;e.abilityIds.includes("RainbowGranter")?(i=aC.RainbowGranter,a="rainbow"):e.abilityIds.includes("GoldGranter")&&(i=aC.GoldGranter,a="gold");return{total:t.currentStrength+t.maxStrength+t.potential+t.abilityTier+t.abilityRarity+t.mutation,breakdown:t,granterBonus:i,granterType:a}}const iC={I:25,II:50,III:75,IV:100},aC={Copycat:100,RainDance:80,DoubleHatch:90,DoubleHarvest:85,RainbowGranter:95,GoldGranter:85,SeedFinderIV:100,CoinFinderIII:100};async function sC(e,t){const n=[],o=new Map;for(const d of e)o.set(d.id,rC(d));const r=function(e){const t=new Map;for(const n of e){if(!n.species)continue;const e=[...n.abilityIds].sort().join(","),o=`${n.species}:${e}`;t.has(o)||t.set(o,{species:n.species,abilitySignature:e,pets:[]}),t.get(o).pets.push(n)}return t}(e);for(let d=0;d<e.length;d+=10){const i=e.slice(d,d+10);for(const t of i){const i=lC(t,o.get(t.id),e,r);n.push(i)}t&&t(Math.min(100,Math.round((d+10)/e.length*100))),d+10<e.length&&await new Promise(e=>setTimeout(e,0))}const i=n.filter(e=>"keep"===e.status),a=n.filter(e=>"consider"===e.status),s=n.filter(e=>"obsolete"===e.status),l=n.filter(e=>"upgrade"===e.status),c=new Map;for(const d of Uw){const e=n.filter(e=>e.pet.abilityIds.some(e=>(Xw[e]||"general")===d.id));c.set(d.id,e)}return{allPets:e,comparisons:n,keep:i,consider:a,obsolete:s,upgrades:l,strategyPets:c,totalPets:e.length,activePets:e.filter(e=>"active"===e.location).length,inventoryPets:e.filter(e=>"inventory"===e.location).length,hutchPets:e.filter(e=>"hutch"===e.location).length,obsoleteCount:s.length,upgradeCount:l.length}}function lC(e,t,n,o){if(Qw.protectedPetIds.has(e.id))return{pet:e,score:t,status:"keep",reason:"üîí Protected by user",betterAlternatives:[],upgradeOpportunities:[]};const r=[];for(const c of n){if(c.id===e.id)continue;if(c.species!==e.species)continue;cC(c,e)&&r.push(c)}if(0===r.length)return{pet:e,score:t,status:"keep",reason:"‚úÖ Best available for this ability set",betterAlternatives:[],upgradeOpportunities:[]};const i=[...e.abilityIds].sort().join(","),a=`${e.species}:${i}`,s=o.get(a);let l=!1;if(s&&s.pets.length>1){l=[...s.pets].sort((e,t)=>{const n=e.hasRainbow?3:e.hasGold?2:1,o=t.hasRainbow?3:t.hasGold?2:1;if(o!==n)return o-n;const r=e.maxStrength||e.strength,i=t.maxStrength||t.strength;return i!==r?i-r:t.strength-e.strength}).findIndex(t=>t.id===e.id)<3}if(r.length>0&&!l){const n=e.hasRainbow||e.hasGold?"üíé Lower stats but has mutation - consider keeping":`‚ùå ${r.length} better pet${r.length>1?"s":""} available`;return{pet:e,score:t,status:e.hasRainbow||e.hasGold?"consider":"obsolete",reason:n,betterAlternatives:r,upgradeOpportunities:[]}}return{pet:e,score:t,status:"keep",reason:l?"‚úÖ Top 3 for this ability set":"‚úÖ Best available",betterAlternatives:[],upgradeOpportunities:[]}}function cC(e,t){if(e.species!==t.species)return!1;const n=e.hasRainbow?3:e.hasGold?2:1,o=t.hasRainbow?3:t.hasGold?2:1;if([...e.abilityIds].sort().join(",")===[...t.abilityIds].sort().join(",")){if(n>o)return!0;if(n<o)return!1;const r=e.maxStrength||e.strength,i=t.maxStrength||t.strength;return r>i||!(r<i)&&e.strength>t.strength}if(n>=o){if(t.abilityIds.every(t=>e.abilityIds.some(e=>function(e,t){const n=e.replace(/(I{1,3}|IV)$/,""),o=t.replace(/(I{1,3}|IV)$/,"");if(n!==o)return!1;const r=dC(e),i=dC(t);if(!r||!i)return!1;const a={I:1,II:2,III:3,IV:4},s=a[r],l=a[i];return void 0!==s&&void 0!==l&&s>l}(e,t))))return!0}const r=new Set(["ProduceEater","SeedFinderI"]);if(n>o){const n=t.abilityIds.every(e=>r.has(e)),o=t.abilityIds.every(t=>e.abilityIds.includes(t));if(n&&o)return!0}return!1}function dC(e){const t=e.match(/(I{1,3}|IV)$/);return t&&t[1]?t[1]:null}async function pC(e=!1,t){const n=Date.now();if(!e&&Jw&&n-Kw<3e4)return Jw;const o=await tC(),r=await sC(o,t);return Jw=r,Kw=n,function(e){for(const n of Yw)try{n(e)}catch(t){s("‚ö†Ô∏è Pet Optimizer listener error:",t)}}(r),r}let uC=null;function gC(e,t=[]){const n=(e??"").trim();if(!n)return null;return Fi(t.length?Zi(n,t):Yi(n))||null}function mC(e){e.innerHTML="";const t=document.createElement("div");t.style.cssText="\n    color: #fff;\n    overflow-y: auto;\n    max-height: 100%;\n  ";const n=document.createElement("style");n.textContent="\n    @keyframes shimmer {\n      0% { background-position: 0% 50%; }\n      50% { background-position: 100% 50%; }\n      100% { background-position: 0% 50%; }\n    }\n  ",t.appendChild(n);const o=document.createElement("div");o.style.cssText="margin-bottom: 20px;",o.innerHTML='\n    <div style="font-size: 20px; font-weight: bold; margin-bottom: 8px;">\n      üéØ Pet Optimizer\n    </div>\n    <div style="font-size: 13px; color: var(--qpm-text-muted, #aaa);">\n      Smart analysis of your pet collection to identify obsolete pets, upgrade opportunities, and optimization strategies\n    </div>\n  ',t.appendChild(o);const r=document.createElement("div");r.style.cssText="\n    background: rgba(0, 0, 0, 0.3);\n    border-radius: 8px;\n    padding: 16px;\n    margin-bottom: 20px;\n    border: 1px solid var(--qpm-border, #444);\n  ",t.appendChild(r);const i=document.createElement("div");i.style.cssText="\n    background: rgba(0, 0, 0, 0.3);\n    border-radius: 8px;\n    padding: 16px;\n    margin-bottom: 20px;\n    border: 1px solid var(--qpm-border, #444);\n  ",t.appendChild(i);const a=document.createElement("div");a.style.cssText="min-height: 200px;",t.appendChild(a),e.appendChild(t),uC={root:t,summaryContainer:r,filtersContainer:i,resultsContainer:a,currentAnalysis:null},hC(),fC()}async function fC(e=!1){if(uC){uC.summaryContainer.innerHTML='<div style="color: #aaa;">‚è≥ Loading pets...</div>',uC.resultsContainer.innerHTML="";try{const t=document.createElement("div");t.style.cssText="color: #aaa; display: flex; align-items: center; gap: 10px;",t.innerHTML='\n      <div>‚è≥ Analyzing pets...</div>\n      <div id="analysis-progress" style="font-weight: bold; color: var(--qpm-accent, #8f82ff);">0%</div>\n    ',uC.summaryContainer.innerHTML="",uC.summaryContainer.appendChild(t);const n=await pC(e,e=>{const t=document.getElementById("analysis-progress");t&&(t.textContent=`${e}%`)});if(!n||0===n.totalPets)return uC.summaryContainer.innerHTML='\n        <div style="color: #FF9800; padding: 20px; text-align: center;">\n          <div style="font-size: 18px; margin-bottom: 8px;">‚ö†Ô∏è No Pets Found</div>\n          <div style="font-size: 13px; color: #aaa;">\n            No pets detected in active slots, inventory, or hutch.\n            <br>Make sure you have pets and try refreshing.\n          </div>\n        </div>\n      ',void(uC.resultsContainer.innerHTML="");uC.currentAnalysis=n,function(e){if(!uC)return;try{console.log("[Pet Optimizer] Rendering summary...");const t=`\n      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px;">\n      <div style="\n        background: linear-gradient(135deg, rgba(66, 165, 245, 0.2), rgba(66, 165, 245, 0.05));\n        border: 1px solid rgba(66, 165, 245, 0.3);\n        border-radius: 8px;\n        padding: 12px;\n        text-align: center;\n      ">\n        <div style="font-size: 24px; font-weight: bold; color: #42A5F5;">${e.totalPets}</div>\n        <div style="font-size: 11px; color: #aaa; margin-top: 4px;">Total Pets</div>\n        <div style="font-size: 10px; color: #777; margin-top: 4px;">\n          ${e.activePets} active ‚Ä¢ ${e.inventoryPets} inv ‚Ä¢ ${e.hutchPets} hutch\n        </div>\n      </div>\n\n      <div style="\n        background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(76, 175, 80, 0.05));\n        border: 1px solid rgba(76, 175, 80, 0.3);\n        border-radius: 8px;\n        padding: 12px;\n        text-align: center;\n      ">\n        <div style="font-size: 24px; font-weight: bold; color: #4CAF50;">${e.keep.length}</div>\n        <div style="font-size: 11px; color: #aaa; margin-top: 4px;">Keep</div>\n        <div style="font-size: 10px; color: #777; margin-top: 4px;">Best pets in each category</div>\n      </div>\n\n      <div style="\n        background: linear-gradient(135deg, rgba(255, 152, 0, 0.2), rgba(255, 152, 0, 0.05));\n        border: 1px solid rgba(255, 152, 0, 0.3);\n        border-radius: 8px;\n        padding: 12px;\n        text-align: center;\n      ">\n        <div style="font-size: 24px; font-weight: bold; color: #FF9800;">${e.consider.length}</div>\n        <div style="font-size: 11px; color: #aaa; margin-top: 4px;">Consider</div>\n        <div style="font-size: 10px; color: #777; margin-top: 4px;">Has mutations or potential</div>\n      </div>\n\n      <div style="\n        background: linear-gradient(135deg, rgba(244, 67, 54, 0.2), rgba(244, 67, 54, 0.05));\n        border: 1px solid rgba(244, 67, 54, 0.3);\n        border-radius: 8px;\n        padding: 12px;\n        text-align: center;\n      ">\n        <div style="font-size: 24px; font-weight: bold; color: #f44336;">${e.obsoleteCount}</div>\n        <div style="font-size: 11px; color: #aaa; margin-top: 4px;">Obsolete</div>\n        <div style="font-size: 10px; color: #777; margin-top: 4px;">Can safely sell</div>\n      </div>\n\n      <div style="\n        background: linear-gradient(135deg, rgba(156, 39, 176, 0.2), rgba(156, 39, 176, 0.05));\n        border: 1px solid rgba(156, 39, 176, 0.3);\n        border-radius: 8px;\n        padding: 12px;\n        text-align: center;\n      ">\n        <div style="font-size: 24px; font-weight: bold; color: #9C27B0;">${e.upgradeCount}</div>\n        <div style="font-size: 11px; color: #aaa; margin-top: 4px;">Upgrades Available</div>\n        <div style="font-size: 10px; color: #777; margin-top: 4px;">Higher tier exists</div>\n      </div>\n    </div>\n  `;uC.summaryContainer.innerHTML=t,console.log("[Pet Optimizer] Summary rendered")}catch(t){console.error("[Pet Optimizer] Error rendering summary:",t),uC.summaryContainer.innerHTML=`<div style="color: #f44336;">Error rendering summary: ${t instanceof Error?t.message:"Unknown"}</div>`}}(n),yC(n)}catch(t){console.error("[Pet Optimizer] Error:",t),uC.summaryContainer.innerHTML=`\n      <div style="color: var(--qpm-danger, #f44336); padding: 20px;">\n        <div style="font-size: 18px; margin-bottom: 8px;">‚ùå Analysis Failed</div>\n        <div style="font-size: 13px; color: #aaa;">\n          ${t instanceof Error?t.message:"Unknown error"}\n        </div>\n        <div style="font-size: 12px; color: #666; margin-top: 8px;">\n          Check browser console for details\n        </div>\n      </div>\n    `}}}function hC(){if(!uC)return;const e=Zw(),t=document.createElement("div");t.style.cssText="display: flex; flex-direction: column; gap: 16px;";const n=document.createElement("div");n.innerHTML='\n    <label style="display: block; font-size: 12px; font-weight: 600; color: #aaa; margin-bottom: 8px;">\n      Filter by Strategy\n    </label>\n  ';const o=document.createElement("div");o.style.cssText="display: flex; flex-wrap: wrap; gap: 8px;";const r=bC("all","üéØ All Pets","all"===e.selectedStrategy);r.addEventListener("click",()=>{eC({selectedStrategy:"all"}),hC(),uC?.currentAnalysis&&yC(uC.currentAnalysis)}),o.appendChild(r);for(const p of Uw){const t=bC(p.id,`${p.icon} ${p.name}`,e.selectedStrategy===p.id);t.addEventListener("click",()=>{eC({selectedStrategy:p.id}),hC(),uC?.currentAnalysis&&yC(uC.currentAnalysis)}),o.appendChild(t)}n.appendChild(o),t.appendChild(n);const i=document.createElement("div");i.style.cssText="display: flex; gap: 16px; align-items: center;";const a=document.createElement("input");a.type="checkbox",a.checked=e.showObsoleteOnly,a.id="obsolete-only-checkbox",a.style.cssText="cursor: pointer;",a.addEventListener("change",()=>{eC({showObsoleteOnly:a.checked}),uC?.currentAnalysis&&yC(uC.currentAnalysis)});const s=document.createElement("label");s.htmlFor="obsolete-only-checkbox",s.style.cssText="font-size: 13px; cursor: pointer;",s.textContent="Show obsolete pets only";const l=document.createElement("input");l.type="checkbox",l.checked=e.groupBySpecies,l.id="group-species-checkbox",l.style.cssText="cursor: pointer;",l.addEventListener("change",()=>{eC({groupBySpecies:l.checked}),uC?.currentAnalysis&&yC(uC.currentAnalysis)});const c=document.createElement("label");c.htmlFor="group-species-checkbox",c.style.cssText="font-size: 13px; cursor: pointer;",c.textContent="Group by species";const d=document.createElement("button");d.textContent="üîÑ Refresh Analysis",d.style.cssText="\n    padding: 6px 12px;\n    background: rgba(66, 165, 245, 0.2);\n    border: 1px solid #42A5F5;\n    border-radius: 4px;\n    color: #42A5F5;\n    cursor: pointer;\n    font-size: 12px;\n    margin-left: auto;\n  ",d.addEventListener("click",()=>fC(!0)),i.appendChild(a),i.appendChild(s),i.appendChild(l),i.appendChild(c),i.appendChild(d),t.appendChild(i),uC.filtersContainer.innerHTML="",uC.filtersContainer.appendChild(t)}function bC(e,t,n){const o=document.createElement("button");return o.textContent=t,o.style.cssText=`\n    padding: 8px 16px;\n    border-radius: 6px;\n    border: 2px solid ${n?"#42A5F5":"#444"};\n    background: ${n?"rgba(66, 165, 245, 0.2)":"rgba(0, 0, 0, 0.3)"};\n    color: ${n?"#42A5F5":"#aaa"};\n    cursor: pointer;\n    font-size: 12px;\n    font-weight: 600;\n    transition: all 0.2s;\n  `,o.addEventListener("mouseenter",()=>{n||(o.style.background="rgba(66, 165, 245, 0.1)",o.style.borderColor="#555")}),o.addEventListener("mouseleave",()=>{n||(o.style.background="rgba(0, 0, 0, 0.3)",o.style.borderColor="#444")}),o}function yC(e){if(uC)try{console.log("[Pet Optimizer] Rendering results...");const t=Zw();let n=[...e.comparisons];if("all"!==t.selectedStrategy){n=e.strategyPets.get(t.selectedStrategy)||[]}if(t.showObsoleteOnly&&(n=n.filter(e=>"obsolete"===e.status)),n.sort((e,n)=>{switch(t.sortBy){case"strength":return"desc"===t.sortDirection?n.pet.strength-e.pet.strength:e.pet.strength-n.pet.strength;case"maxStrength":{const o=e.pet.maxStrength||e.pet.strength,r=n.pet.maxStrength||n.pet.strength;return"desc"===t.sortDirection?r-o:o-r}case"score":return"desc"===t.sortDirection?n.score.total-e.score.total:e.score.total-n.score.total;default:return 0}}),uC.resultsContainer.innerHTML="",0===n.length)return void(uC.resultsContainer.innerHTML='\n      <div style="\n        text-align: center;\n        padding: 40px;\n        color: #aaa;\n        font-size: 14px;\n      ">\n        No pets match the current filters\n      </div>\n    ');const o=function(e){if(0===e.length)return null;const t=new Map;for(const h of e)for(const e of h.pet.abilities)t.has(e)||t.set(e,[]),t.get(e).some(e=>e.id===h.pet.id)||t.get(e).push(h.pet);const n=new Map;for(const[h,b]of t.entries()){const e=[...b].sort((e,t)=>{const n=e.hasRainbow?3:e.hasGold?2:1,o=t.hasRainbow?3:t.hasGold?2:1;if(o!==n)return o-n;const r=e.maxStrength||e.strength,i=t.maxStrength||t.strength;return i!==r?i-r:t.strength-e.strength});n.set(h,e.slice(0,3))}const o=Array.from(n.entries()).sort((e,t)=>{const n=e[0].match(/(I{1,3}|IV)$/)?.[1],o=t[0].match(/(I{1,3}|IV)$/)?.[1];if(n&&o){const r={IV:4,III:3,II:2,I:1};if(e[0].replace(/(I{1,3}|IV)$/,"")===t[0].replace(/(I{1,3}|IV)$/,"")){const e=r[o],t=r[n];if(void 0!==e&&void 0!==t)return e-t}}return e[0].localeCompare(t[0])}),r=document.createElement("div");r.style.cssText="\n    margin-bottom: 20px;\n    background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 215, 0, 0.05));\n    border-radius: 8px;\n    border: 1px solid rgba(255, 215, 0, 0.4);\n    overflow: hidden;\n  ";let i="all";const a=document.createElement("div");a.style.cssText="\n    font-size: 15px;\n    font-weight: 600;\n    color: #FFD700;\n    padding: 12px 16px;\n    background: rgba(0, 0, 0, 0.3);\n    cursor: pointer;\n    user-select: none;\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    transition: background 0.2s;\n  ";const s=document.createElement("div");s.style.cssText="display: flex; align-items: center;",s.innerHTML=`\n    <span style="font-size: 16px; margin-right: 8px;">üèÜ</span>\n    <span>Top 3 Pets Per Ability</span>\n    <span style="\n      background: rgba(255, 215, 0, 0.3);\n      color: #FFD700;\n      padding: 2px 8px;\n      border-radius: 12px;\n      font-size: 11px;\n      margin-left: 8px;\n      font-weight: 700;\n    ">${o.length} abilities</span>\n    <span style="font-size: 11px; color: #888; font-weight: normal; margin-left: 12px;">Best pets for each ability</span>\n  `;const l=document.createElement("span");l.textContent="‚ñº",l.style.cssText="font-size: 10px; transition: transform 0.3s; transform: rotate(-90deg);",a.appendChild(s),a.appendChild(l),r.appendChild(a);const c=document.createElement("div");c.style.cssText="\n    padding: 12px 16px;\n    background: rgba(0, 0, 0, 0.2);\n    border-bottom: 1px solid rgba(255, 215, 0, 0.2);\n    display: none;\n  ";const d=document.createElement("label");d.style.cssText="font-size: 12px; color: #aaa; margin-right: 8px;",d.textContent="Filter by Ability:";const p=document.createElement("select");p.style.cssText="\n    padding: 4px 8px;\n    background: rgba(0, 0, 0, 0.5);\n    border: 1px solid #FFD700;\n    border-radius: 4px;\n    color: #FFD700;\n    font-size: 12px;\n    cursor: pointer;\n  ";const u=document.createElement("option");u.value="all",u.textContent="All Abilities",p.appendChild(u);for(const[h]of o){const e=document.createElement("option");e.value=h,e.textContent=h,p.appendChild(e)}c.appendChild(d),c.appendChild(p),r.appendChild(c);const g=document.createElement("div");g.style.cssText="padding: 12px; display: none;";const m=e=>{g.innerHTML="";const t="all"===e?o:o.filter(([t])=>t===e);for(const[n,o]of t){const e=document.createElement("div");e.style.cssText="\n        font-size: 13px;\n        font-weight: 600;\n        color: #FFD700;\n        margin-top: 12px;\n        margin-bottom: 8px;\n        padding: 6px 10px;\n        background: rgba(255, 215, 0, 0.15);\n        border-radius: 4px;\n        border-left: 3px solid #FFD700;\n      ";const t=qc(n);e.style.borderLeftColor=t.base,e.style.color=t.text,e.textContent=Rc(n),g.appendChild(e);const r=document.createElement("div");r.style.cssText="display: flex; flex-direction: column; gap: 6px;";for(const n of o){const e=xC(n);r.appendChild(e)}g.appendChild(r)}};m("all"),p.addEventListener("change",e=>{i=e.target.value,m(i)}),r.appendChild(g);let f=!0;return a.addEventListener("click",()=>{f=!f,g.style.display=f?"none":"block",c.style.display=f?"none":"block",l.style.transform=f?"rotate(-90deg)":"rotate(0deg)"}),a.addEventListener("mouseenter",()=>{a.style.background="rgba(0, 0, 0, 0.4)"}),a.addEventListener("mouseleave",()=>{a.style.background="rgba(0, 0, 0, 0.3)"}),r}(n);o&&uC.resultsContainer.appendChild(o);const r={obsolete:n.filter(e=>"obsolete"===e.status),upgrade:n.filter(e=>"upgrade"===e.status),consider:n.filter(e=>"consider"===e.status),keep:n.filter(e=>"keep"===e.status)};for(const[e,i]of Object.entries(r)){if(0===i.length)continue;const t=vC(e,i);uC.resultsContainer.appendChild(t)}console.log("[Pet Optimizer] Results rendered")}catch(t){console.error("[Pet Optimizer] Error rendering results:",t),uC.resultsContainer.innerHTML=`<div style="color: #f44336;">Error rendering results: ${t instanceof Error?t.message:"Unknown"}</div>`}}function xC(e){const t=document.createElement("div");t.style.cssText="\n    background: linear-gradient(135deg, #1f1f1f, #1a1a1a);\n    border-radius: 6px;\n    padding: 8px 12px;\n    border: 1px solid #333;\n    transition: all 0.2s;\n    display: flex;\n    align-items: center;\n    gap: 10px;\n  ",t.addEventListener("mouseenter",()=>{t.style.borderColor="#555",t.style.transform="translateX(4px)"}),t.addEventListener("mouseleave",()=>{t.style.borderColor="#333",t.style.transform="translateX(0)"});let n=gC(e.species?.toLowerCase()||"");if(e.hasRainbow){n=wc(e.species?.toLowerCase()||"","rainbow")??gC(e.species?.toLowerCase()||"",["Rainbow"])}else if(e.hasGold){n=wc(e.species?.toLowerCase()||"","gold")??gC(e.species?.toLowerCase()||"",["Gold"])}return t.innerHTML=`\n    <div style="flex-shrink: 0; position: relative;">\n      ${n?`\n        <img src="${n}" alt="${e.species}" style="\n          width: 32px;\n          height: 32px;\n          object-fit: contain;\n          image-rendering: pixelated;\n        ">\n        ${CC(e.abilities,10,e.hasRainbow,e.hasGold,e.species||void 0)}\n      `:""}\n    </div>\n    <div style="flex: 1; min-width: 0;">\n      <div style="font-size: 12px; font-weight: 600; color: #fff; margin-bottom: 2px;">\n        ${e.name||e.species}\n        ${e.hasRainbow?" üåà":e.hasGold?" ‚ú®":""}\n      </div>\n      <div style="font-size: 11px; color: #aaa;">\n        ${e.species} ‚Ä¢ STR ${e.strength}${e.maxStrength?` / ${e.maxStrength}`:""} ‚Ä¢ ${{active:"üü¢",inventory:"üì¶",hutch:"üè†"}[e.location]} ${e.location}\n      </div>\n    </div>\n  `,t}function vC(e,t){const n={obsolete:{icon:"‚ùå",title:"Obsolete Pets",color:"#f44336",bgColor:"rgba(244, 67, 54, 0.1)",desc:"Can safely sell these pets"},upgrade:{icon:"‚¨ÜÔ∏è",title:"Upgrade Opportunities",color:"#9C27B0",bgColor:"rgba(156, 39, 176, 0.1)",desc:"Higher tier abilities exist"},consider:{icon:"üíé",title:"Consider Selling",color:"#FF9800",bgColor:"rgba(255, 152, 0, 0.1)",desc:"Has mutations but lower stats"},keep:{icon:"‚úÖ",title:"Keep These Pets",color:"#4CAF50",bgColor:"rgba(76, 175, 80, 0.1)",desc:"Best in their categories"}}[e],o=document.createElement("div");o.style.cssText=`\n    margin-bottom: 16px;\n    background: ${n.bgColor};\n    border-radius: 8px;\n    border: 1px solid ${n.color}44;\n    overflow: hidden;\n  `;const r=document.createElement("div");r.style.cssText=`\n    font-size: 15px;\n    font-weight: 600;\n    color: ${n.color};\n    padding: 12px 16px;\n    background: rgba(0, 0, 0, 0.3);\n    cursor: pointer;\n    user-select: none;\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    transition: background 0.2s;\n  `;const i=document.createElement("div");i.innerHTML=`\n    <span style="font-size: 16px; margin-right: 8px;">${n.icon}</span>\n    <span>${n.title}</span>\n    <span style="\n      background: ${n.color}33;\n      color: ${n.color};\n      padding: 2px 8px;\n      border-radius: 12px;\n      font-size: 11px;\n      margin-left: 8px;\n      font-weight: 700;\n    ">${t.length}</span>\n    <span style="font-size: 11px; color: #888; font-weight: normal; margin-left: 12px;">${n.desc}</span>\n  `;const a=document.createElement("span");a.textContent="‚ñº",a.style.cssText="font-size: 10px; transition: transform 0.3s;",r.appendChild(i),r.appendChild(a),o.appendChild(r);const s=document.createElement("div");s.style.cssText="padding: 12px; display: flex; flex-direction: column; gap: 8px;";if(Zw().groupBySpecies){const e=new Map;for(const o of t){const t=o.pet.species||"Unknown";e.has(t)||e.set(t,[]),e.get(t).push(o)}const n=Array.from(e.entries()).sort((e,t)=>t[1].length-e[1].length);for(const[t,o]of n){if(n.length>1){const e=document.createElement("div");e.style.cssText="\n          font-size: 12px;\n          font-weight: 600;\n          color: #aaa;\n          margin-top: 8px;\n          margin-bottom: 4px;\n          padding-bottom: 4px;\n          border-bottom: 1px solid #333;\n        ",e.textContent=`${t} (${o.length})`,s.appendChild(e)}for(const e of o){const t=wC(e);s.appendChild(t)}}}else{const e=new Map,n=new Set;for(const r of t)for(const t of r.pet.abilities){e.has(t)||e.set(t,[]);const o=`${t}:${r.pet.id}`;n.has(o)||(e.get(t).push(r),n.add(o))}const o=Array.from(e.entries()).sort((e,t)=>{const n=e[0].match(/(I{1,3}|IV)$/)?.[1],o=t[0].match(/(I{1,3}|IV)$/)?.[1];if(n&&o){const r={IV:4,III:3,II:2,I:1};if(e[0].replace(/(I{1,3}|IV)$/,"")===t[0].replace(/(I{1,3}|IV)$/,"")){const e=r[o],t=r[n];if(void 0!==e&&void 0!==t)return e-t}}return e[0].localeCompare(t[0])});for(const[t,r]of o){const e=document.createElement("div");e.style.cssText="\n        font-size: 12px;\n        font-weight: 600;\n        color: #aaa;\n        margin-top: 8px;\n        margin-bottom: 4px;\n        padding: 6px 10px;\n        background: rgba(66, 165, 245, 0.1);\n        border-radius: 4px;\n        border-left: 3px solid #42A5F5;\n      ";const n=qc(t);e.style.borderLeftColor=n.base,e.textContent=`${Rc(t)} (${r.length} pet${r.length>1?"s":""})`,s.appendChild(e);for(const t of r){const e=wC(t);s.appendChild(e)}}}o.appendChild(s);let l=!1;return r.addEventListener("click",()=>{l=!l,s.style.display=l?"none":"flex",a.style.transform=l?"rotate(-90deg)":"rotate(0deg)"}),r.addEventListener("mouseenter",()=>{r.style.background="rgba(0, 0, 0, 0.4)"}),r.addEventListener("mouseleave",()=>{r.style.background="rgba(0, 0, 0, 0.3)"}),o}function wC(e){const{pet:t,score:n,status:o,reason:r,betterAlternatives:i}=e,a=document.createElement("div");a.style.cssText="\n    background: linear-gradient(135deg, #1f1f1f, #1a1a1a);\n    border-radius: 8px;\n    padding: 14px;\n    border: 1px solid #333;\n    transition: all 0.2s;\n  ",a.addEventListener("mouseenter",()=>{a.style.borderColor="#555",a.style.transform="translateX(4px)"}),a.addEventListener("mouseleave",()=>{a.style.borderColor="#333",a.style.transform="translateX(0)"});let s=gC(t.species?.toLowerCase()||"");if(t.hasRainbow){s=wc(t.species?.toLowerCase()||"","rainbow")??gC(t.species?.toLowerCase()||"",["Rainbow"])}else if(t.hasGold){s=wc(t.species?.toLowerCase()||"","gold")??gC(t.species?.toLowerCase()||"",["Gold"])}return a.innerHTML=`\n    <div style="display: flex; gap: 12px; align-items: start;">\n      \x3c!-- Sprite --\x3e\n      <div style="flex-shrink: 0;">\n        ${s?`\n          <div style="position: relative; width: 48px; height: 48px;">\n            <img src="${s}" alt="${t.species}" style="\n              width: 100%;\n              height: 100%;\n              object-fit: contain;\n              image-rendering: pixelated;\n            ">\n            ${CC(t.abilities,12,t.hasRainbow,t.hasGold,t.species||void 0)}\n          </div>\n        `:""}\n      </div>\n\n      \x3c!-- Info --\x3e\n      <div style="flex: 1; min-width: 0;">\n        \x3c!-- Name & Location --\x3e\n        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">\n          <div style="font-size: 14px; font-weight: 600; color: #fff;">\n            ${t.name||t.species}\n          </div>\n          <div style="font-size: 12px; color: #777;">\n            ${{active:"üü¢",inventory:"üì¶",hutch:"üè†"}[t.location]} ${t.location}\n          </div>\n          ${t.hasRainbow?'<span style="font-size: 12px;">üåà Rainbow</span>':""}\n          ${t.hasGold?'<span style="font-size: 12px;">‚ú® Gold</span>':""}\n        </div>\n\n        \x3c!-- Species & STR --\x3e\n        <div style="font-size: 12px; color: #aaa; margin-bottom: 6px;">\n          ${t.species}${t.species!==(t.name||t.species)?` "${t.name||t.species}"`:""}\n          ‚Ä¢ STR ${t.strength}${t.maxStrength?` / Max ${t.maxStrength}`:""}\n          ${t.maxStrength&&t.maxStrength>t.strength?` <span style="color: #4CAF50;">(+${t.maxStrength-t.strength} potential)</span>`:""}\n        </div>\n\n        \x3c!-- Abilities --\x3e\n        <div style="display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 8px;">\n          ${t.abilities.map(e=>{const t=Rc(e),n=qc(e);let o,r;const i=e.toLowerCase().replace(/\s+/g,""),a=i.includes("rainbowgranter")||i.includes("raingranter"),s=i.includes("goldgranter");return a?(o="linear-gradient(135deg, #ff0080, #ff8c00, #40e0d0, #8a2be2, #ff0080)",r="#fff"):s?(o="linear-gradient(135deg, #ffd700, #ffed4e, #ffd700)",r="#000"):(o=n.base,r=n.text),`\n              <span style="\n                padding: 4px 10px;\n                border-radius: 4px;\n                font-size: 11px;\n                background: ${o};\n                ${a||s?"background-size: 200% 200%; animation: shimmer 3s ease infinite;":""}\n                color: ${r};\n                border: 1px solid ${a||s?"rgba(255,255,255,0.5)":"rgba(255,255,255,0.3)"};\n                font-weight: ${a||s?"600":"500"};\n              ">${t}</span>\n            `}).join("")}\n        </div>\n\n        \x3c!-- Reason --\x3e\n        <div style="font-size: 12px; color: #ccc; margin-bottom: 8px;">\n          ${r}\n        </div>\n\n        \x3c!-- Better alternatives --\x3e\n        ${i.length>0?`\n          <div style="font-size: 11px; color: #888; margin-top: 8px; padding-top: 8px; border-top: 1px solid #333;">\n            Better pets: ${i.map(e=>`${e.name||e.species} (STR ${e.strength}${e.maxStrength?`/${e.maxStrength}`:""})`).join(", ")}\n          </div>\n        `:""}\n      </div>\n\n      \x3c!-- Score --\x3e\n      <div style="flex-shrink: 0; text-align: right;">\n        <div style="font-size: 18px; font-weight: bold; color: #42A5F5;">${Math.round(n.total-n.granterBonus)}</div>\n        ${n.granterBonus>0?`\n          <div style="\n            font-size: 14px;\n            font-weight: 600;\n            margin-top: 2px;\n            ${"rainbow"===n.granterType?"background: linear-gradient(135deg, #ff0080, #ff8c00, #40e0d0, #8a2be2, #ff0080); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;":"background: linear-gradient(135deg, #ffd700, #ffed4e, #ffd700); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;"}\n          ">+${Math.round(n.granterBonus)}</div>\n        `:""}\n        <div style="font-size: 10px; color: #666;">SCORE</div>\n      </div>\n    </div>\n  `,a}function CC(e,t,n,o,r){if(!e||0===e.length)return"";const i=(r||"").toLowerCase();return`\n    <div style="\n      position: absolute;\n      left: ${["turtle","butterfly","peacock"].some(e=>i.includes(e))?-16:-10}px;\n      top: 50%;\n      transform: translateY(-50%);\n      display: flex;\n      flex-direction: column;\n      gap: 3px;\n      z-index: 2;\n    ">${e.slice(0,3).map(e=>{const n=qc(e);return`\n      <div title="${Rc(e)}" style="\n        width: ${t}px;\n        height: ${t}px;\n        background: ${n.base};\n        border: 1px solid rgba(255,255,255,0.3);\n        box-shadow: 0 0 6px ${n.glow};\n        border-radius: 2px;\n      "></div>\n    `}).join("")}</div>\n  `}const TC=Object.freeze(Object.defineProperty({__proto__:null,openPetOptimizerWindow:function(){lc("pet-optimizer","üéØ Pet Optimizer",mC,"900px","85vh")}},Symbol.toStringTag,{value:"Module"})),SC="qpm_tutorial_shown_v3.0.0",PC="https://raw.githubusercontent.com/ryandt2305-cpu/QPM-GR/master/docs/product/QPM_user_guide.jpg";function kC(){return!g.get(SC,!1)}function AC(){g.set(SC,!0),s("‚úÖ Tutorial marked as shown")}const EC=Object.freeze(Object.defineProperty({__proto__:null,markTutorialAsShown:AC,resetTutorial:function(){"remove"in g&&"function"==typeof g.remove?g.remove(SC):g.set(SC,!1),s("üîÑ Tutorial reset - will show on next load")},shouldShowTutorial:kC,showTutorialPopup:function(){if(!kC())return;const e=document.createElement("div");e.style.cssText="\n    position: fixed;\n    inset: 0;\n    background: rgba(0, 0, 0, 0.85);\n    backdrop-filter: blur(8px);\n    z-index: 999999;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    animation: qpm-tutorial-fadein 0.3s ease;\n    padding: 20px;\n  ";const t=document.createElement("div");t.style.cssText="\n    background: linear-gradient(135deg, #1a1a2e, #0f0f1a);\n    border-radius: 16px;\n    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8), 0 0 0 1px rgba(255, 255, 255, 0.1);\n    max-width: 90vw;\n    max-height: 90vh;\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n    animation: qpm-tutorial-scalein 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);\n  ";const n=document.createElement("div");n.style.cssText="\n    padding: 24px 28px;\n    background: linear-gradient(135deg, rgba(76, 175, 80, 0.15), rgba(33, 150, 243, 0.15));\n    border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n  ";const o=document.createElement("div");o.style.cssText="\n    display: flex;\n    align-items: center;\n    gap: 12px;\n  ";const r=document.createElement("div");r.style.cssText="\n    font-size: 32px;\n    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));\n  ",r.textContent="üìñ";const i=document.createElement("div");i.innerHTML='\n    <div style="font-size: 22px; font-weight: 700; color: #fff; margin-bottom: 2px;">\n      Welcome to QPM v3.0.0!\n    </div>\n    <div style="font-size: 13px; color: rgba(255, 255, 255, 0.7);">\n      Quick start guide for new features\n    </div>\n  ',o.appendChild(r),o.appendChild(i);const a=document.createElement("button");a.textContent="‚úï",a.style.cssText="\n    background: rgba(255, 255, 255, 0.1);\n    border: 1px solid rgba(255, 255, 255, 0.2);\n    color: #fff;\n    border-radius: 8px;\n    width: 36px;\n    height: 36px;\n    font-size: 18px;\n    cursor: pointer;\n    transition: all 0.2s;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  ",a.addEventListener("mouseenter",()=>{a.style.background="rgba(255, 59, 48, 0.2)",a.style.borderColor="rgba(255, 59, 48, 0.4)",a.style.transform="scale(1.05)"}),a.addEventListener("mouseleave",()=>{a.style.background="rgba(255, 255, 255, 0.1)",a.style.borderColor="rgba(255, 255, 255, 0.2)",a.style.transform="scale(1)"}),a.addEventListener("click",h),n.appendChild(o),n.appendChild(a);const l=document.createElement("div");l.style.cssText="\n    flex: 1;\n    overflow: auto;\n    padding: 20px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background: rgba(0, 0, 0, 0.3);\n  ";const c=document.createElement("img");c.src=PC,c.alt="QPM User Guide",c.style.cssText="\n    max-width: 100%;\n    max-height: 100%;\n    object-fit: contain;\n    border-radius: 8px;\n    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);\n    margin-top: 20px;\n  ",c.onerror=()=>{l.innerHTML=`\n      <div style="color: rgba(255, 255, 255, 0.6); text-align: center; padding: 40px;">\n        <div style="font-size: 48px; margin-bottom: 16px;">‚ùå</div>\n        <div style="font-size: 16px; margin-bottom: 8px;">Tutorial image not found</div>\n        <div style="font-size: 13px; opacity: 0.7;">Expected at: ${PC}</div>\n      </div>\n    `},l.appendChild(c);const d=document.createElement("div");d.style.cssText="\n    padding: 20px 28px;\n    background: rgba(0, 0, 0, 0.3);\n    border-top: 1px solid rgba(255, 255, 255, 0.1);\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    gap: 16px;\n  ";const p=document.createElement("div");p.style.cssText="\n    font-size: 12px;\n    color: rgba(255, 255, 255, 0.6);\n    flex: 1;\n  ",p.innerHTML='\n    üí° <strong>Tip:</strong> Press <kbd style="background: rgba(255, 255, 255, 0.1); padding: 2px 6px; border-radius: 4px; font-family: monospace;">ESC</kbd> to close\n  ';const u=document.createElement("button");u.textContent="Don't show again",u.style.cssText="\n    background: rgba(255, 255, 255, 0.08);\n    border: 1px solid rgba(255, 255, 255, 0.15);\n    color: rgba(255, 255, 255, 0.9);\n    padding: 10px 20px;\n    border-radius: 8px;\n    font-size: 13px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.2s;\n  ",u.addEventListener("mouseenter",()=>{u.style.background="rgba(255, 255, 255, 0.12)",u.style.borderColor="rgba(255, 255, 255, 0.25)"}),u.addEventListener("mouseleave",()=>{u.style.background="rgba(255, 255, 255, 0.08)",u.style.borderColor="rgba(255, 255, 255, 0.15)"}),u.addEventListener("click",()=>{AC(),h()});const g=document.createElement("button");g.textContent="Got it!",g.style.cssText="\n    background: linear-gradient(135deg, #4CAF50, #45a049);\n    border: none;\n    color: #fff;\n    padding: 10px 24px;\n    border-radius: 8px;\n    font-size: 14px;\n    font-weight: 600;\n    cursor: pointer;\n    transition: all 0.2s;\n    box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);\n  ",g.addEventListener("mouseenter",()=>{g.style.transform="translateY(-2px)",g.style.boxShadow="0 6px 16px rgba(76, 175, 80, 0.4)"}),g.addEventListener("mouseleave",()=>{g.style.transform="translateY(0)",g.style.boxShadow="0 4px 12px rgba(76, 175, 80, 0.3)"}),g.addEventListener("click",()=>{h()}),d.appendChild(p),d.appendChild(u),d.appendChild(g),t.appendChild(n),t.appendChild(l),t.appendChild(d),e.appendChild(t);const m=document.createElement("style");m.textContent="\n    @keyframes qpm-tutorial-fadein {\n      from { opacity: 0; }\n      to { opacity: 1; }\n    }\n    @keyframes qpm-tutorial-scalein {\n      from { transform: scale(0.9); opacity: 0; }\n      to { transform: scale(1); opacity: 1; }\n    }\n  ",document.head.appendChild(m);const f=e=>{"Escape"===e.key&&h()};function h(){e.style.animation="qpm-tutorial-fadein 0.2s ease reverse",t.style.animation="qpm-tutorial-scalein 0.2s ease reverse",setTimeout(()=>{e.remove(),m.remove(),document.removeEventListener("keydown",f)},200)}document.addEventListener("keydown",f),e.addEventListener("click",t=>{t.target===e&&h()}),document.body.appendChild(e),s("üìñ Tutorial popup shown")}},Symbol.toStringTag,{value:"Module"}))}();

})();