// ==UserScript==
// @name         QPM (ALPHA)
// @namespace    Quinoa
// @version      2.2.3
// @description  Quality-of-life enhancements for Magic Garden: crop type locking, mutation tracking, value calculator, harvest reminders, journal species checker, and persistent feed statistics.
// @author       TOKYO.#6464
// @match        https://1227719606223765687.discordsays.com/*
// @match        https://magiccircle.gg/r/*
// @match        https://magicgarden.gg/r/*
// @match        https://starweaver.org/r/*
// @updateURL    https://raw.githubusercontent.com/ryandt2305-cpu/QPM-GR/main/dist/QPM.user.js
// @downloadURL  https://raw.githubusercontent.com/ryandt2305-cpu/QPM-GR/main/dist/QPM.user.js
// @run-at       document-start
// @inject-into  page
// @require      https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js
// @require      https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js
// @require      https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js
// @grant        GM_xmlhttpRequest
// @grant        GM_registerMenuCommand
// @grant        GM_setValue
// @grant        GM_getValue
// @grant        GM_deleteValue
// @grant        GM_listValues
// @connect      pquktqrngyxkvrgtfygp.supabase.co
// @connect      supabase.co
// @grant        unsafeWindow
// ==/UserScript==

(function() {
'use strict';

!function(){"use strict";const e=e=>new Promise(t=>setTimeout(t,e)),t=new Promise(e=>{"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>e(),{once:!0}):e()});function n(e){const t=document.createElement("style");return t.textContent=e,document.head.appendChild(t),t}function o(e,t,{root:n=document,callForExisting:o=!0}={}){const r=n=>{for(const o of n){if(o.nodeType!==Node.ELEMENT_NODE)continue;const n=o;if(("string"==typeof e?n.matches(e):e(n))&&t(n),"string"==typeof e){n.querySelectorAll(e).forEach(t)}else{Array.from(n.querySelectorAll("*")).filter(e).forEach(t)}}};if(o){("string"==typeof e?Array.from(n.querySelectorAll(e)):Array.from(n.querySelectorAll("*")).filter(e)).forEach(t)}const i=new MutationObserver(e=>{for(const t of e)r(t.addedNodes)});return i.observe(n,{childList:!0,subtree:!0}),{disconnect:()=>i.disconnect()}}function r(e){if(!e)return!1;const t=e.getBoundingClientRect();if(t.width<=0||t.height<=0)return!1;const n=getComputedStyle(e);return"hidden"!==n.visibility&&"none"!==n.display&&parseFloat(n.opacity||"1")>0}const i=["#App .QuinoaUI","#App [data-tm-main-interface]","#App [data-tm-hud-root]","#App [data-mc-app-shell]","#App > div.McFlex.css-neeqas","#App > div.McFlex.css-1k630i1","#App > div.McFlex"];function a(){for(const n of i){const e=document.querySelector(n);if(e instanceof HTMLElement)return e}const e=document.getElementById("App");if(!e)return null;const t=e.querySelector("div.McFlex");return t instanceof HTMLElement?t:e instanceof HTMLElement?e:null}const s=function(e,t=!0){const n=(...t)=>{n.enabled&&console.log(`[${e}]`,...t)};return n.enabled=t,n}("QuinoaPetMgr");function l(e){if(!e)return"‚Äî";const t=Math.max(1,Math.floor((Date.now()-e)/1e3));if(t<60)return`${t}s ago`;const n=Math.floor(t/60);if(n<60)return`${n}m ago`;const o=Math.floor(n/60);if(o<24)return`${o}h ago`;return`${Math.floor(o/24)}d ago`}function c(e){return e.toLowerCase().replace(/[''`]/g,"").replace(/\s+/g,"").replace(/-/g,"").replace(/(seed|plant|baby|fruit|crop)$/i,"")}function d(e,t=120){let n;return(...o)=>{clearTimeout(n),n=setTimeout(()=>e(...o),t)}}const u={carrot:3,strawberry:2,aloe:2.5,delphinium:3,blueberry:2,apple:2,appletree:2,tulip:3,orangetulip:3,tomato:2,daffodil:3,corn:2,cornkernel:2,watermelon:3,pumpkin:3,echeveria:2.75,echeveriacutting:2.75,coconut:3,coconuttree:3,banana:1.7,lily:2.75,camellia:2.5,squash:2.5,burrostail:2.5,burrostailcutting:2.5,mushroom:3.5,mushroomspore:3.5,cactus:1.8,bamboo:2,bambooshoot:2,chrysanthemum:2.75,grape:2,pepper:2,lemon:3,lemontree:3,passionfruit:2,passion:2,dragonfruit:2.024,dragon:2.024,lychee:2,lycheepit:2,sunflower:2.5,starweaver:2,starweaverpod:2,starweaverfruit:2,dawnbinder:2.5,dawncelestial:2.5,dawnbinderpod:2.5,dawnbinderbulb:2.5,moonbinder:2,mooncelestial:2,moonbinderpod:2,moonbinderbulb:2};function p(e){const t=u[e];return"number"==typeof t&&Number.isFinite(t)?t:null}const m=["qpm.shopRestocks.v1","qpm.shopRestockConfig.v1","qpm.shopRestocks.migration","qpm.xpTrackerProcs.v1","qpm.xpTrackerConfig.v1","qpm.petXpObservations.v1","qpm.autoFavorite.v1","qpm.petHatchingTracker.knownPetIds.v1","quinoa:stats:v1","qpm.mutationValueTracking.v1","qpm.weatherMutationTracking.v1","quinoa-pet-food-rules","quinoa-ui-panel-position","quinoa-ui-panel-collapsed","quinoa-ui-notifications-collapsed","quinoa-ui-notifications-detail-expanded","quinoa-ui-tracker-target-mode","quinoa-ui-tracker-target-pet","quinoa-ui-tracker-ability-filter","quinoa-ui-mutation-tracker-source","quinoa-ui-mutation-tracker-detail","qpm-tracker-settings","quinoa-pet-manager","quinoaData"],f={get(e,t=null){try{if("function"==typeof GM_getValue){const n=GM_getValue(e);if(null==n)return t;try{return JSON.parse(n)}catch{return n}}}catch{}try{const n=localStorage.getItem(e);return null==n?t:JSON.parse(n)}catch{return t}},set(e,t){try{if("function"==typeof GM_setValue)return void GM_setValue(e,JSON.stringify(t))}catch{}try{localStorage.setItem(e,JSON.stringify(t))}catch{}},clear(){let e=0;try{if("function"==typeof GM_deleteValue&&"function"==typeof GM_listValues){const t=GM_listValues();for(const n of t)(m.includes(n)||n.startsWith("qpm.")||n.startsWith("quinoa"))&&(GM_deleteValue(n),e++)}}catch(t){console.error("[QPM Storage] Error clearing GM storage:",t)}try{for(const n of m)null!==localStorage.getItem(n)&&(localStorage.removeItem(n),e++);const t=Object.keys(localStorage);for(const n of t)(n.startsWith("qpm.")||n.startsWith("quinoa"))&&(localStorage.removeItem(n),e++)}catch(t){console.error("[QPM Storage] Error clearing localStorage:",t)}console.log(`[QPM Storage] Cleared ${e} storage keys`)}},g=window,h="undefined"!=typeof unsafeWindow&&unsafeWindow?unsafeWindow:g,b=h,y=h!==g;function x(e,t){try{h[e]=t}catch{}if(y)try{g[e]=t}catch{}}function w(e){if(y){const t=g[e];if(void 0!==t)return t}return h[e]}const v="__qpmJotaiStore__",C="__qpmJotaiAtomCache__";let T=null,S=!1;const P=e=>new Promise(t=>setTimeout(t,e));function A(e){return!!e&&"function"==typeof e.get&&"function"==typeof e.values}function k(){const e=w(C);if(e&&A(e))return e;const t=b.jotaiAtomCache,n=t&&"cache"in t?t.cache:t;return A(n)?(x(C,n),n):void 0}async function E(e=5e3){const t=await async function(e=5e3){const t=Date.now();let n=k();for(;!n&&Date.now()-t<e;)await P(50),n=k();return n}(e);if(!t)throw new Error("jotaiAtomCache.cache not available");let n=null,o=null;const r=[],i=()=>{for(const e of r)try{e.__origWrite&&(e.write=e.__origWrite,delete e.__origWrite)}catch{}};for(const a of t.values()){if(!a||"function"!=typeof a.write)continue;const e=a;if(e.__origWrite)continue;const t=e.write.bind(e);e.__origWrite=e.write,e.write=function(e,r,...a){return o||(n=e,o=r,i()),t(e,r,...a)},r.push(e)}try{const t=Date.now()+e;for(;!o&&Date.now()<t;)await P(50)}finally{i()}return o&&n?{get:e=>n(e),async set(e,t){await o(e,t)},sub(e,t){let o;const r=setInterval(()=>{try{const r=n(e);r!==o&&(o=r,t())}catch{}},100);return()=>clearInterval(r)}}:(s("‚ö†Ô∏è Unable to capture Jotai store via write hook, using polyfill"),{get(){throw new Error("Jotai store unavailable (polyfill)")},set(){throw new Error("Jotai store unavailable (polyfill)")},sub:()=>()=>{},__polyfill:!0})}async function $(){if(T&&!T.__polyfill)return T;const e=w(v);if(e&&(!e.__polyfill||!T)&&(T=e,!T.__polyfill))return T;if(S){const e=6e3,t=Date.now();for(;S&&Date.now()-t<e;)await P(50);if(T&&!T.__polyfill)return T}S=!0;try{const e=function(){const e=b.__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!e?.renderers?.size)return null;for(const[t]of e.renderers){const n=e.getFiberRoots?.(t);if(n)for(const e of n){const t=new Set,n=[],o=e.current??e;for(o&&n.push(o);n.length;){const e=n.pop();if(!e||t.has(e))continue;t.add(e);const o=e.pendingProps?.value;if(o&&"object"==typeof o&&"function"==typeof o.get&&"function"==typeof o.set&&"function"==typeof o.sub)return o;e.child&&n.push(e.child),e.sibling&&n.push(e.sibling),e.alternate&&n.push(e.alternate)}}}return null}();if(e)return T=e,x(v,T),T;const t=await E();return T=t,x(v,T),T}catch(t){throw t}finally{S=!1}}function M(e){const t=k();if(!t)return[];const n=[];for(const o of t.values()){if(!o)continue;const t=String(o.debugLabel??o.label??"");e.test(t)&&n.push(o)}return n}function F(e){const t=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return M(new RegExp(`^${t}$`))[0]??null}async function I(e){return(await $()).get(e)}async function L(e,t){const n=await $();let o=!1;const r=()=>{if(!o)try{const o=n.get(e);t(o)}catch(r){s("‚ö†Ô∏è Failed reading atom value during subscription",r)}};let i;try{const t=n.sub(e,r);i="function"==typeof t?t:await t}catch(a){s("‚ö†Ô∏è Failed subscribing to atom",a),i=void 0}return r(),()=>{o=!0;try{i?.()}catch{}}}const z=Object.freeze(Object.defineProperty({__proto__:null,ensureJotaiStore:$,findAtomsByLabel:M,getAtomByLabel:F,readAtomValue:I,subscribeAtom:L},Symbol.toStringTag,{value:"Module"})),N="userSlotsAtom";let q=!1,B=!1,R=!1;function D(e){if(!Array.isArray(e)||0===e.length)return null;const t=e.find(e=>e&&"object"==typeof e);if(!t)return null;return"itemType"in t||"species"in t||"slots"in t||"plant"in t||"item"in t?e:null}function H(e,t,n){if(!e||0===e.length)return null;const o=n&&"object"==typeof n?(r=n.favoritedItemIds,Array.isArray(r)?r.filter(e=>"string"==typeof e):[]):[];var r;const i=e.some(e=>function(e){if(!e||"object"!=typeof e)return[];const t=[e.slots,e.plant?.slots,e.item?.slots,e.data?.slots,e.slots?.slots,e.growSlots];for(const n of t)if(Array.isArray(n)&&n.length>0)return n;return[]}(e).length>0);return{items:e,favoritedItemIds:o,source:t,hasSlotData:i}}function j(e,t){const n=H(D(e),t,e);if(n)return n;if(!e||"object"!=typeof e)return null;const o=e;if("inventory"in o){const e=o.inventory,n=H(D(e?.items??e),`${t}.inventory`,e);if(n)return n}if("data"in o){const e=o.data;if(e&&"inventory"in e){const n=e.inventory,o=H(D(n?.items??n),`${t}.data.inventory`,n);if(o)return o}}return null}async function W(){try{await $(),q=!1}catch(r){return q||(s("‚ö†Ô∏è Unable to capture jotai store for userSlotsAtom",r),q=!0),null}const e=await async function(){let e=F(N);e||(e=M(/userSlotsAtom/i)[0]??null);return e||B||(s("‚ö†Ô∏è Could not locate userSlotsAtom in jotai cache"),B=!0),e&&(B=!1),e}();if(!e)return null;let t;try{t=await I(e),R=!1}catch(r){return R||(s("‚ö†Ô∏è Failed reading userSlotsAtom",r),R=!0),null}const n=new WeakSet,o=[{node:t,label:N}];for(;o.length>0;){const{node:e,label:t}=o.shift(),r=j(e,t);if(r)return r;if(!e||"object"!=typeof e)continue;const i=Array.isArray(e);!i&&n.has(e)||(i||n.add(e),Array.isArray(e)?e.forEach((e,n)=>{o.push({node:e,label:`${t}[${n}]`})}):Object.entries(e).forEach(([e,n])=>{o.push({node:n,label:`${t}.${e}`})}))}return null}const G=".McFlex.css-1cyjil4",O="div.css-vmnhaw",V="qpm-crop-lock-styles",_=".McFlex.css-1cyjil4",U=["data-tm-inventory-id","data-inventory-id","data-item-id","data-itemid","data-itemId","data-item-uuid","data-itemuuid","data-item-guid","data-uuid","data-guid","data-entity-id","data-entityid","data-record-id","data-recordid","data-row-id","data-rowid","data-tm-item-id","data-tm-itemid","data-id"];const X="quinoa:crop-lock-config",K=new Set(Object.keys(u));function J(e){return new Promise(t=>setTimeout(t,e))}function Q(e,t){let n=e;for(const o of t){if(!n||"object"!=typeof n)return;n=n[o]}return n}function Y(e,t,n=4,o=new WeakSet){if(!e||"object"!=typeof e||n<0)return null;if(o.has(e))return null;o.add(e);const r=e;for(const[i,a]of Object.entries(r)){if(t(i,a)){if("string"==typeof a&&a)return a;if("number"==typeof a&&Number.isFinite(a))return String(a)}if(a&&"object"==typeof a){const e=Y(a,t,n-1,o);if(e)return e}}return null}function Z(e){return Array.isArray(e)?e:null}function ee(){try{const e=b,t=e?.myData?.inventory;if(!t)return null;const n=function(e){if(!e||"object"!=typeof e)return[];const t=e,n=[["items"],["inventory","items"],["inventory"],["data","inventory","items"],["data","inventory"],[]];for(const o of n){const n=Z(0===o.length?e:Q(t,o));if(n)return n}return[]}(t),o=Q(t,["favoritedItemIds"]);return{items:n,favoritedItemIds:Array.isArray(o)?o.filter(e=>"string"==typeof e):[],source:"page.myData.inventory"}}catch(e){return s("‚ö†Ô∏è Unable to read inventory from page window",e),null}}function te(e){const t=[["id"],["itemId"],["itemID"],["inventoryID"],["inventoryId"],["uuid"],["item","id"],["item","itemId"],["item","itemID"],["item","inventoryId"],["item","inventoryID"],["item","uuid"],["plant","id"],["data","id"]];for(const o of t){const t=Q(e,o);if("string"==typeof t&&t)return t;if("number"==typeof t)return String(t)}const n=Y(e,e=>/(?:inventory|item).*id$/i.test(e)||/^(?:id|uuid|guid)$/i.test(e),5);return n||null}function ne(e){const t=[["species"],["item","species"],["plant","species"],["data","species"],["crop","species"],["product","species"],["product","name"],["product","displayName"],["item","name"],["item","displayName"],["data","name"],["data","displayName"],["product","productName"],["item","productName"]];for(const o of t){const t=Q(e,o);if("string"==typeof t&&t)return t}const n=Y(e,(e,t)=>{const n=e.toLowerCase();if(/(species|productname|productlabel|cropname|displayname)$/.test(n))return!0;if(n.endsWith("name")&&"string"==typeof t){return!!c(t)}return!1},4);return n||null}async function oe(){const e=ee();if(e&&e.items.length>0)return{items:[...e.items],favoritedIds:new Set(e.favoritedItemIds),source:e.source};const t=await W();return t&&t.items.length>0?{items:[...t.items],favoritedIds:new Set(t.favoritedItemIds??[]),source:t.source}:e?{items:[...e.items],favoritedIds:new Set(e.favoritedItemIds),source:e.source}:t?{items:[...t.items],favoritedIds:new Set(t.favoritedItemIds??[]),source:t.source}:null}function re(e,t){const n=t?.favoritedIds??null,o=t?function(e){const t=new Map;for(const n of e.items){const o=te(n);if(!o)continue;const r=ne(n);if(!r)continue;const i=c(r);if(!i)continue;const a={id:o,isFavorited:e.favoritedIds.has(o)},s=t.get(i);s?s.push(a):t.set(i,[a])}return t}(t):null,r={},i=[];for(const a of e){const e=a.element;if(!e)continue;const t=c(a.species||"unknown")??"unknown",s=o?.get(t)??null;let l=fe(e),d=l&&n?n.has(l):!(!a.element||!Ce(a.element));if(!l&&s&&s.length>0){const e=s.shift();l=e.id,d=e.isFavorited}else if(l&&s){const e=s.findIndex(e=>e.id===l);e>=0&&s.splice(e,1)}if(!l){r[t]=(r[t]??0)+1;continue}const u=n?n.has(l):d;i.push({item:a,element:e,itemId:l,isFavorited:u})}return Object.keys(r).length>0&&s("‚ö†Ô∏è Missing inventory ids for some crop items",{missing:r}),i}function ie(e){try{const t=b.MagicCircle_RoomConnection;if(t&&"function"==typeof t.sendMessage)return t.sendMessage({scopePath:["Room","Quinoa"],type:"ToggleFavoriteItem",itemId:e}),!0}catch(t){s("‚ö†Ô∏è Failed to send favorite toggle via MagicCircle_RoomConnection",t)}return!1}let ae={enabled:!0,syncModeEnabled:!0,lockedTypes:{},managedFavoriteIds:{},baselineFavoriteIds:{}},se=!1,le=new Map;function ce(){if(se)return;se=!0,ae=f.get(X,ae),"boolean"!=typeof ae.syncModeEnabled&&(ae.syncModeEnabled=!0),ae.managedFavoriteIds||(ae.managedFavoriteIds={}),ae.baselineFavoriteIds||(ae.baselineFavoriteIds={}),function(){if(document.getElementById(V))return;n('\n    .qpm-crop-lock-button {\n      position: absolute;\n      top: 2px;\n      right: 2px;\n      width: 20px;\n      height: 20px;\n      border: none;\n      border-radius: 4px;\n      background: rgba(0, 0, 0, 0.7);\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-size: 12px;\n      z-index: 10;\n      transition: all 0.2s;\n      backdrop-filter: blur(2px);\n    }\n    \n    .qpm-crop-lock-button:hover {\n      background: rgba(0, 0, 0, 0.9);\n      transform: scale(1.1);\n    }\n    \n    .qpm-crop-lock-button.locked {\n      background: rgba(255, 193, 7, 0.9);\n      color: #000;\n    }\n    \n    .qpm-crop-lock-button.unlocked {\n      background: rgba(108, 117, 125, 0.7);\n      color: #fff;\n    }\n    \n    .qpm-crop-lock-button.unlocked:hover {\n      background: rgba(108, 117, 125, 0.9);\n    }\n    \n    .qpm-inventory-item-wrapper {\n      position: relative;\n    }\n    \n    /* Hide default favorite button when our lock button is active */\n  .qpm-inventory-item-wrapper button[aria-label*="avorite"] {\n      display: none;\n    }\n  ').id=V}(),s("üåæ Crop type locking system starting...");new MutationObserver(()=>{const e=document.querySelector(_);if(e&&!e.hasAttribute("data-crop-lock-processed")){e.setAttribute("data-crop-lock-processed","true"),s("üîç Inventory grid found via direct observer!");let t=e.parentElement,n=null;for(;t&&t!==document.body;){if("dialog"===t.getAttribute("role")||t.classList.contains("chakra-modal__content")||"SECTION"===t.tagName){n=t,s("‚úÖ Found parent modal");break}t=t.parentElement}n?setTimeout(()=>de(n),300):(s("‚ö†Ô∏è Could not find modal parent, processing grid directly"),setTimeout(()=>{const t=Array.from(e.querySelectorAll(O));t.length>0&&ue(t,e)},300))}}).observe(document.body,{childList:!0,subtree:!0}),setTimeout(()=>{s("üîç Checking for existing inventory on startup...");const e=document.querySelector(_);if(e&&!e.hasAttribute("data-crop-lock-processed")){e.setAttribute("data-crop-lock-processed","true"),s("‚úÖ Found existing inventory grid!");let t=e.parentElement;for(;t&&t!==document.body;){if("dialog"===t.getAttribute("role")||t.classList.contains("chakra-modal__content")){s("‚úÖ Found parent modal on startup, calling enhanceInventoryPanel"),de(t);break}t=t.parentElement}}else s("‚è≥ No inventory open yet")},1e3),o('section.chakra-modal__content[role="dialog"]',e=>{if(e.className,e.getAttribute("role"),e.textContent?.substring(0,100),r(e)){const t=function(e){const t=e.textContent||"",n=t.toLowerCase();if(n.includes("inventory")||n.includes("my items")||e.querySelector('[data-testid*="inventory"]'))return!0;if(n.includes("shop")||n.includes("buy")||n.includes("purchase")||n.includes("seeds in")||n.includes("restocked")||n.includes("new seeds")||e.querySelector('[data-testid*="shop"]')||e.classList.contains("css-1ubz3lw"))return!1;const o=e.querySelector('.chakra-stack > div[role="button"]'),r=e.querySelector("div[data-tm-shop-index]");if(r&&!o)return!1;return!0}(e);t?(s("üéí Inventory panel detected, adding crop lock buttons..."),setTimeout(()=>de(e),500)):s("üõí Shop panel detected, ignoring for crop locking")}}),o(_,e=>{e.className;let t=e.parentElement;for(;t;){if("dialog"===t.getAttribute("role")||t.classList.contains("chakra-modal__content")||t.hasAttribute("aria-modal")){setTimeout(()=>de(t),200);break}t=t.parentElement}}),o('[role="dialog"]',e=>{const t=e.textContent?.toLowerCase()||"";(t.includes("inventory")||t.includes("my items")||t.includes("backpack"))&&setTimeout(()=>de(e),100)}),o(".chakra-modal__content",e=>{const t=e.textContent?.toLowerCase()||"";(t.includes("inventory")||t.includes("my items")||t.includes("backpack"))&&setTimeout(()=>de(e),100)});new MutationObserver(e=>{e.forEach(e=>{e.addedNodes.forEach(e=>{if(e.nodeType===Node.ELEMENT_NODE){const t=e,n=t.textContent?.toLowerCase()||"";if(n.includes("inventory")||n.includes("my items")){let e=t.parentElement;for(;e;){if("dialog"===e.getAttribute("role")||e.classList.contains("chakra-modal__content")||e.hasAttribute("aria-modal")){setTimeout(()=>de(e),100);break}e=e.parentElement}}}})})}).observe(document.body,{childList:!0,subtree:!0});new MutationObserver(e=>{e.forEach(e=>{e.removedNodes.forEach(e=>{if(e.nodeType===Node.ELEMENT_NODE){const t=e;if("dialog"===t.getAttribute("role")||t.classList?.contains("chakra-modal__content")||t.hasAttribute?.("aria-modal")){const e=document.getElementById("quinoa-crop-lock-sidebar");e&&(e.remove(),s("üóëÔ∏è Removed crop lock sidebar (inventory closed)"))}}})})}).observe(document.body,{childList:!0,subtree:!0}),s("‚úÖ Crop type locking system started")}function de(e){s("üéØ enhanceInventoryPanel called");const t=e.querySelector(G);if(!t)return void s(`‚ùå Could not find items container (${G})`);s("‚úÖ Found items container");const n=Array.from(t.querySelectorAll(O));s(`‚úÖ Found ${n.length} inventory items`),0!==n.length?ue(n,e):s("‚ùå No inventory items found")}function ue(e,t){const n=new Map;s(`üîç Processing ${e.length} inventory items...`);for(const o of e){const e=me(o);if(!e)continue;const t=c(e.species||"unknown");n.has(t)||n.set(t,[]),n.get(t).push({...e,element:o})}s(`üåæ Found ${n.size} different crop types`),0!==n.size?function(e,t){const n=document.querySelector("#quinoa-crop-lock-sidebar");n&&(s("üóëÔ∏è Removing existing sidebar"),n.remove());s(`üìä Creating sidebar with ${t.size} crop types`),t.forEach((e,t)=>{s(`  üåæ ${t}: ${e.length} items`)});let o=e.closest('[role="dialog"]')||e.closest(".chakra-modal__content")||e.closest('[aria-modal="true"]')||e;const r=o.getBoundingClientRect();s(`üìê Modal rect: left=${r.left}, right=${r.right}, top=${r.top}, width=${r.width}, height=${r.height}`);const i=r.right+8,a=r.top+60;s(`üìê Sidebar positioning: left=${i}px, top=${a}px`);const l=document.createElement("div");l.id="quinoa-crop-lock-sidebar",l.style.cssText=`\n    position: fixed;\n    top: ${a}px;\n    left: ${i}px;\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    z-index: 2147483646;\n    pointer-events: auto;\n  `;let d=0;if(t.forEach((e,t)=>{const n=function(e,t){const n=document.createElement("div");n.style.cssText="\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 6px;\n    cursor: pointer;\n    transition: transform 0.2s ease;\n  ",n.addEventListener("mouseenter",()=>{n.style.transform="scale(1.05)"}),n.addEventListener("mouseleave",()=>{n.style.transform="scale(1)"});const o=document.createElement("button");o.className="quinoa-crop-type-button",o.title=`${e} (${t.length} items) - Click to favorite/unfavorite all`;const r=t[0];let i="";if(r&&r.element){const t=r.element.querySelector("img");if(t&&t.src)i=t.src;else{const t=r.element.querySelector("canvas");if(t)try{i=t.toDataURL()}catch(m){s("‚ö†Ô∏è Could not get canvas data for",e)}}}o.style.cssText="\n    width: 68px;\n    height: 68px;\n    border: none;\n    background: rgba(0, 0, 0, 0.92);\n    border-radius: 8px;\n    cursor: pointer;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: flex-start;\n    position: relative;\n    padding: 11px 4px 4px 4px;\n    gap: 0px;\n  ";const a=document.createElement("div");a.style.cssText="\n    width: 100%;\n    height: 33px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    position: relative;\n    flex-shrink: 0;\n  ",i?(a.style.backgroundImage=`url(${i})`,a.style.backgroundSize="60%",a.style.backgroundRepeat="no-repeat",a.style.backgroundPosition="center"):(a.textContent=e.charAt(0).toUpperCase(),a.style.color="#fff",a.style.fontSize="24px",a.style.fontWeight="bold");o.appendChild(a);const l=document.createElement("div");l.style.cssText="\n    color: #fff;\n    font-size: 11px;\n    font-weight: 600;\n    text-align: center;\n    text-shadow: 0 1px 2px rgba(0,0,0,0.8);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    width: 100%;\n    margin-top: -24px;\n    flex-shrink: 0;\n    line-height: 1.2;\n    position: relative;\n    z-index: 10;\n  ",l.textContent=e.charAt(0).toUpperCase()+e.slice(1),o.appendChild(l);const d=c(e)??e.toLowerCase();let u=t.every(e=>Ce(e.element));function p(){const e=t.filter(e=>Ce(e.element)).length,n=e>0&&e<t.length;u?(o.style.filter="drop-shadow(0 0 8px gold)",l.style.color="#ffd700"):n?(o.style.filter="drop-shadow(0 0 6px #ffa726)",l.style.color="#ffa726"):(o.style.filter="none",l.style.color="#fff")}return p(),n.addEventListener("click",async()=>{const e=le.get(d);await async function(e,t,n){if(0===t.length)return;const o=t[0]?.species??e,r=ae.lockedTypes[e]||!1,i=!r,a=!1!==ae.syncModeEnabled;s(`üîÑ ${i?"Locking":"Unlocking"} all ${o} items...`);const l=await oe();if(!l)return s("‚ö†Ô∏è Unable to capture inventory context; aborting crop lock toggle",{speciesKey:e}),void Te(`‚ö†Ô∏è Unable to ${i?"lock":"unlock"} ${o}`);s("üì¶ Inventory context ready for crop lock",{speciesKey:e,source:l.source,items:l.items.length,favorited:l.favoritedIds.size});const c=new Set(l.favoritedIds),d=re(t,l);if(0===d.length)return s("‚ö†Ô∏è No inventory entries with ids found for crop type",{speciesKey:e}),void Te(`‚ö†Ô∏è No ${o} inventory entries found`);const u=d.filter(e=>e.isFavorited).map(e=>e.itemId),p=new Set(ae.baselineFavoriteIds[e]??u),m=new Set(ae.managedFavoriteIds[e]??[]),g=new Set;if(i)for(const s of d)s.isFavorited||g.add(s.itemId);else{if(a){const t=[];for(const e of d)e.isFavorited&&(m.has(e.itemId)||p.has(e.itemId)||(t.push(e.itemId),p.add(e.itemId)));t.length>0&&(s("‚ÑπÔ∏è Detected manual favorites during unlock; merging into baseline",{speciesKey:e,manual:t.length}),ae.baselineFavoriteIds[e]=Array.from(p),f.set(X,ae));for(const e of d){if(!e.isFavorited)continue;const t=m.has(e.itemId),n=p.has(e.itemId);!t&&n||g.add(e.itemId)}}else for(const e of d)e.isFavorited&&g.add(e.itemId);if(m.size>0)for(const e of m)g.has(e)||d.some(t=>t.itemId===e)||g.add(e);a&&0===m.size&&g.size>0&&s("‚ö†Ô∏è Unlocking without managed ids; will toggle all favorited items for this species",{speciesKey:e,count:g.size})}const h=Array.from(g);if(0===h.length)return s("‚ÑπÔ∏è Crop lock toggle skipped (state already matches request)",{speciesKey:e,shouldLock:i}),ae.lockedTypes[e]=i,p.size>0?ae.baselineFavoriteIds[e]=Array.from(p):delete ae.baselineFavoriteIds[e],n&&ve(n,i),f.set(X,ae),void Te(`${o} already ${i?"locked":"unlocked"}`);let b=0;for(const f of h)ie(f)?(b+=1,await J(40)):s("‚ö†Ô∏è Failed to dispatch favorite toggle via websocket",{speciesKey:e,itemId:f});if(0===b)return s("‚ùå No favorite toggles were dispatched; aborting state update",{speciesKey:e}),void Te(`‚ö†Ô∏è Could not ${i?"lock":"unlock"} ${o}`);await async function(e,t,n=2200,o=140){if(0===e.length)return!0;const r=Date.now()+n;for(;Date.now()<r;){const n=await oe(),r=n?.favoritedIds??null;if(r&&(t?e.every(e=>r.has(e)):e.every(e=>!r.has(e))))return!0;await J(o)}return!1}(h,i)||s("‚ö†Ô∏è Favorite state did not settle after toggle commands",{speciesKey:e,shouldLock:i});const y=await oe(),x=y?.favoritedIds??c;y||s("‚ö†Ô∏è Using initial inventory context as fallback after toggles",{speciesKey:e});const w=y??{items:l.items,favoritedIds:new Set(x),source:l.source},v=re(t,w),C=new Set(v.filter(e=>e.isFavorited).map(e=>e.itemId)),T=v.length,S=C.size,P=new Set(m);if(i)for(const s of v){if(!s.isFavorited)continue;(d.find(e=>e.itemId===s.itemId)?.isFavorited??!1)||P.add(s.itemId)}else if(m.size>0)for(const s of v)s.isFavorited||P.delete(s.itemId);else for(const s of h)C.has(s)||P.delete(s);let A;A=i?C.size===T:m.size>0?v.every(e=>!m.has(e.itemId)||!e.isFavorited):h.every(e=>!C.has(e));if(A){if(ae.lockedTypes[e]=i,i){const t=d.filter(e=>e.isFavorited).map(e=>e.itemId);t.length>0?ae.baselineFavoriteIds[e]=t:delete ae.baselineFavoriteIds[e]}else{const t=Array.from(C);t.length>0?ae.baselineFavoriteIds[e]=t:delete ae.baselineFavoriteIds[e]}n&&ve(n,i)}else ae.lockedTypes[e]=r,n&&ve(n,r),s("‚ö†Ô∏è Crop lock operation did not fully succeed",{speciesKey:e,shouldLock:i,favoritedCount:S,totalCount:T,managedBefore:m.size,dispatched:b});P.size>0?ae.managedFavoriteIds[e]=Array.from(P):delete ae.managedFavoriteIds[e];f.set(X,ae);const k=i?C.size:T-C.size;Te(`${i?"üîí Locked":"üîì Unlocked"} ${k}/${T} ${o} items`)}(d,t,e),u=t.every(e=>Ce(e.element)),p()}),n.appendChild(o),n.appendChild(l),n}(t,e);l.appendChild(n),d++}),0===t.size)return;document.body.appendChild(l),s(`‚ú® Created crop lock sidebar with ${d} buttons`);const u=new MutationObserver(()=>{document.body.contains(e)||(s("üóëÔ∏è Inventory closed, removing sidebar"),l.remove(),u.disconnect())});u.observe(document.body,{childList:!0,subtree:!0})}(t,n):s("‚ùå No crop types found - sidebar will not be created")}function pe(e){return e.replace(/\s*\+\s?\d+$/,"").replace(/\s*\([^)]+\)$/,"").replace(/\s*(produce|crop|fruit|vegetable|berry)$/i,"").trim()}function me(e){try{const t=["p.chakra-text.css-8xfasz",".McFlex.css-1gd1uup p.chakra-text","p.chakra-text.css-rbbzu5",".chakra-text",'[data-testid="item-name"]',"p"];let n=null,o=null;for(const s of t)if(n=e.querySelector(s),n&&(o=n.textContent?.trim(),o&&o.length>0))break;if(!o)return s("‚ùå No item name found"),null;const r=pe(o),i=function(e){if(!e)return!1;const t=e.toLowerCase().trim();if(/(\bplant\b|\btree\b|\bsapling\b|\bsprout\b|\bshrub\b)/.test(t))return!1;const n=["seed","spore","cutting","pod","kernel","pit","shovel","pot","watering can","tool","fertilizer","egg","decor","furniture","planter","pedestal","bench","arch"];for(const r of n)if(t.includes(r))return!1;const o=c(e);if(o&&K.has(o))return!0;if(o.endsWith("s")){const e=o.replace(/s$/,"");if(K.has(e))return!0}return!1}(r);if(!i)return null;const a=function(e){const t=pe(e);return t?t.split(/\s+/).map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):null}(r)||r;return{id:`crop-${Date.now()}-${Math.random()}`,species:a,itemType:"Crop",element:e}}catch(t){return s("‚ùå Error extracting crop data:",t),null}}function fe(e){if(!e)return null;const t=["[data-tm-inventory-id]","[data-inventory-id]","[data-item-id]","[data-itemid]","[data-item-uuid]","[data-uuid]","[data-guid]","[data-entity-id]","[data-record-id]","[data-row-id]"],n=[];let o=e;for(let a=0;o&&a<5;a++)n.push(o),o=o.parentElement;const r=e=>{const t=e.toLowerCase();return t.includes("inventoryid")||t.includes("itemid")||/(?:uuid|guid)$/.test(t)};for(const a of n){const e=ge(a,U);if(e)return e;const t=he(a,r);if(t)return t}for(const a of n)for(const e of t){const t=a.querySelector(e);if(!t)continue;const n=ge(t,U);if(n)return n;const o=he(t,r);if(o)return o}const i=function(e){for(const t of e){const e=be(t);if(e)return e;const n=xe(ye(t));if(n)return n}return null}(n);return i||null}function ge(e,t){for(const o of t){const t=e.getAttribute(o);if(null!=t)return t}const n=t.map(e=>e.toLowerCase());for(const{name:o,value:r}of Array.from(e.attributes))if(n.includes(o.toLowerCase())&&null!=r)return r;return null}function he(e,t){const n=e.dataset;if(!n)return null;for(const[o,r]of Object.entries(n))if(t(o)&&null!=r&&""!==r)return r;return null}function be(e){const t=Object.getOwnPropertyNames(e);for(const n of t){if(!n.startsWith("__reactProps$"))continue;const t=we(e[n]);if(t)return t}return null}function ye(e){const t=Object.getOwnPropertyNames(e);for(const n of t)if(n.startsWith("__reactFiber$"))return e[n];return null}function xe(e){if(!e)return null;const t=[{fiber:e,depth:0}],n=new WeakSet;for(;t.length>0;){const{fiber:e,depth:o}=t.pop();if(!e||n.has(e))continue;n.add(e);const r=we(e.memoizedProps)||we(e.pendingProps)||we(e.memoizedState)||we(e.stateNode);if(r)return r;o>=6||(e.child&&t.push({fiber:e.child,depth:o+1}),e.sibling&&t.push({fiber:e.sibling,depth:o}))}return null}function we(e,t=0,n=new WeakSet){if(!e||"object"!=typeof e)return null;if(e instanceof Element||e instanceof Node)return null;if("undefined"!=typeof Window&&e instanceof Window)return null;if(n.has(e))return null;n.add(e);const o=te(e);if(o&&!(!(r=o)||r.length<6||/^\d+$/.test(r)&&r.length<10))return o;var r;if(t>=6)return null;if(Array.isArray(e)){for(const o of e){const e=we(o,t+1,n);if(e)return e}return null}const i=e;for(const a of Object.values(i)){if(!a||"object"!=typeof a&&"function"!=typeof a)continue;const e=we(a,t+1,n);if(e)return e}return null}function ve(e,t){e.textContent=t?"üîí":"üîì",e.className="qpm-crop-lock-button "+(t?"locked":"unlocked")}function Ce(e){const t=function(e){if(!e)return null;const t=e.querySelector('button[aria-label*="avorite"]');return t instanceof HTMLButtonElement?t:null}(e);return!!t&&function(e){const t=e.getAttribute("aria-label")?.toLowerCase()??"";if(t.includes("unfavorite"))return!0;if(t.includes("favorite")&&!t.includes("unfavorite"))return!1;const n=e.getAttribute("aria-pressed");if("true"===n)return!0;if("false"===n)return!1;const o=e.querySelector("svg");if(o){const e=o.querySelector("path");if(e){const t=e.getAttribute("fill");if(t&&"none"!==t&&"currentColor"!==t)return!0}}const r=getComputedStyle(e);return"currentColor"!==r.color||e.classList.contains("active")}(t)}function Te(e){const t=document.createElement("div");t.textContent=e,t.style.cssText="\n    position: fixed;\n    bottom: 24px;\n    right: 24px;\n    background: #2e7d32;\n    color: #fff;\n    padding: 8px 12px;\n    border-radius: 6px;\n    font-size: 12px;\n    z-index: 2147483647;\n    opacity: 0.95;\n    animation: qpm-toast-in 0.3s ease;\n  ",document.querySelector("#qpm-toast-styles")||(n("\n      @keyframes qpm-toast-in {\n        from { transform: translateY(20px); opacity: 0; }\n        to { transform: translateY(0); opacity: 0.95; }\n      }\n    ").id="qpm-toast-styles"),document.body.appendChild(t),setTimeout(()=>t.remove(),2500)}function Se(){return{...ae}}function Pe(e){ae.syncModeEnabled=e,f.set(X,ae)}const Ae=["#App > div.McFlex.css-1k630i1 > div.McFlex.css-neeqas > div.McFlex.css-1mq3gde > div.McGrid.css-9guy2q > div.McFlex.css-13izacw > div.css-vmnhaw","#App > div.McFlex.css-neeqas div.css-vmnhaw","#App [data-tm-hud-root] div.css-vmnhaw","#App .QuinoaUI .css-vmnhaw","#App .css-vmnhaw"],ke=[{id:"Weather:Sunny",label:"Sunny",normalized:"sunny",kind:"sunny",category:"base",durationMs:null,rawState:"noweather",aliases:[]},{id:"Weather:Rain",label:"Rain",normalized:"rain",kind:"rain",category:"weather",durationMs:3e5,rawState:"weather",aliases:[]},{id:"Weather:Frost",label:"Frost",normalized:"frost",kind:"snow",category:"weather",durationMs:3e5,rawState:"weather",aliases:["snow"]},{id:"Weather:Dawn",label:"Dawn",normalized:"dawn",kind:"dawn",category:"lunar",durationMs:6e5,rawState:"weather",aliases:["sunrise"]},{id:"Weather:AmberMoon",label:"Amber Moon",normalized:"ambermoon",kind:"amber",category:"lunar",durationMs:6e5,rawState:"weather",aliases:["harvestmoon","amber_moon"]}],Ee=new Map;for(const sb of ke){new Set([sb.label,sb.normalized,...sb.aliases]).forEach(e=>{const t=$e(e);t&&Ee.set(t,sb)})}function $e(e){return String(e??"").trim().toLowerCase().replace(/\s+/g,"")}function Me(e){if(null==e)return Ee.get("sunny")??null;const t=$e(e);return t?Ee.get(t)??null:Ee.get("sunny")??null}function Fe(e){return Array.from(e.querySelectorAll("canvas")).find(e=>{const t=e.getBoundingClientRect();return t.width>=16&&t.width<=256&&t.top>=0&&t.top<=220})||null}function Ie(e){try{const t=e.getContext("2d",{willReadFrequently:!0});if(!t)return"noweather";const n=e.width,o=e.height,{data:r}=t.getImageData(0,0,n,o);let i=0,a=0,s=0,l=0,c=0;for(let e=0;e<r.length;e+=4){const t=r[e],n=r[e+1],o=r[e+2];if(r[e+3]<50)continue;c++,o>120&&o>t+20&&o>n+10&&i++;Math.abs(t-n)<20&&Math.abs(n-o)<20&&Math.abs(t-o)<20&&t>=60&&t<=140&&a++,t>200&&n>150&&o<120&&s++,t>200&&n>200&&o>200&&l++}if(0===c)return"noweather";if(i/c>=.05||a/c>=.1)return"weather";if(s/c>=.01||l/c>=.3)return"noweather";return(80*i+100*a+220*s+255*l)/c<120?"weather":"noweather"}catch{return"noweather"}}const Le={weather:{label:"weatherAtom"},shops:{label:"shopsAtom",transform:e=>e&&"object"==typeof e?e:null},seedShop:{label:"shopsAtom",path:"seed"},eggShop:{label:"shopsAtom",path:"egg"},toolShop:{label:"shopsAtom",path:"tool"},decorShop:{label:"shopsAtom",path:"decor"},shopPurchases:{label:"myShopPurchasesAtom"}},ze=new Set;function Ne(e,t){if(!t)return e;const n=function(e){return e?Array.isArray(e)?e.slice():String(e).split(".").map(e=>e.trim()).filter(Boolean):[]}(t);let o=e;for(const r of n){if(null==o)return;o="number"==typeof r?Array.isArray(o)?o[r]:void 0:o[r]}return o}async function qe(e){const t=F(e);if(!t)throw ze.has(e)||(s("‚ö†Ô∏è AtomRegistry missing atom",e),ze.add(e)),new Error(`Atom ${e} not found in jotaiAtomCache`);return ze.delete(e),t}function Be(e){return t=>{try{const n=Ne(t,e.path);return e.transform?e.transform(n):n??e.fallback??null}catch(n){return s("‚ö†Ô∏è AtomRegistry transform error",e.label,n),e.fallback??null}}}function Re(e){return Le[e]}async function De(e){const t=Re(e),n=await qe(t.label).catch(()=>null);if(!n){return t.fallback??null??null}return Be(t)(await I(n).catch(e=>(s("‚ö†Ô∏è AtomRegistry read error",t.label,e),null)))??null}async function He(e,t){const n=Re(e),o=await qe(n.label),r=Be(n),i=await L(o,e=>{const n=r(e);t(n??null)});return()=>{try{i()}catch(e){s("‚ö†Ô∏è AtomRegistry unsubscribe error",n.label,e)}}}const je=new Set;let We={kind:"unknown",raw:"noweather",hash:null,canvasPresent:!1,timestamp:Date.now(),source:"unknown",label:null,startedAt:null,expectedEndAt:null},Ge=null,Oe=null;let Ve=null,_e=!1,Ue=!1,Xe=null,Ke=null,Je=null,Qe=null,Ye=null;function Ze(e){if(We.kind!==e.kind||We.raw!==e.raw||We.hash!==e.hash||We.canvasPresent!==e.canvasPresent||We.source!==e.source||We.label!==e.label||We.startedAt!==e.startedAt||We.expectedEndAt!==e.expectedEndAt){We=e;for(const e of je)try{e(We)}catch(t){s("‚ö†Ô∏è Weather hub listener failed",t)}}}function et(e){const t=Date.now();if(!e)return{kind:"unknown",raw:"noweather",hash:null,canvasPresent:!1,timestamp:t,source:"canvas",label:null,startedAt:null,expectedEndAt:null};if(!function(e){try{const t=e.getContext("2d",{willReadFrequently:!0});if(!t)return!1;const n=Math.min(e.width,128),o=Math.min(e.height,128);if(0===n||0===o)return!1;const r=t.getImageData(0,0,n,o);for(let e=3;e<r.data.length;e+=4)if(r.data[e]>0)return!0;return!1}catch{return!1}}(e))return{kind:"unknown",raw:"noweather",hash:null,canvasPresent:!0,timestamp:t,source:"canvas",label:null,startedAt:null,expectedEndAt:null};const n=Ie(e),o=function(e){if("noweather"===Ie(e))return"sunny";try{const t=e.getContext("2d",{willReadFrequently:!0});if(!t)return"unknown";const n=Math.min(e.width,120),o=Math.min(e.height,120),{data:r}=t.getImageData(0,0,n,o);let i=0,a=0,s=0,l=0;for(let e=0;e<r.length;e+=4)r[e+3]<40||(i+=r[e],a+=r[e+1],s+=r[e+2],l++);if(0===l)return"unknown";const c=i/l,d=a/l,u=s/l;return u>c+20&&u>d+10?"rain":u>150&&c>150&&d>150?"snow":c>120&&u>100&&d<c-10?"dawn":c>150&&d>100&&u<100?"amber":"rain"}catch{return"unknown"}}(e),r=function(e){try{const t=e.getContext("2d",{willReadFrequently:!0});if(!t)return"no-context";const{width:n,height:o}=e,r=t.getImageData(0,0,n,o),i=[[.25*n,.25*o],[.5*n,.5*o],[.75*n,.75*o],[.2*n,.65*o],[.8*n,.35*o]];let a=0;for(const[e,s]of i){const t=Math.min(n-1,Math.max(0,Math.round(e))),i=4*(Math.min(o-1,Math.max(0,Math.round(s)))*n+t);a=(a<<5)-a+r.data[i],a|=0}return a.toString(16)}catch{return"error"}}(e);return{kind:o,raw:n,hash:r,canvasPresent:!0,timestamp:t,source:"canvas",label:"unknown"===o?null:o,startedAt:t,expectedEndAt:null}}function tt(e=!1){if(_e&&Ue)return void(e&&nt(Xe));const t=Date.now();if(Oe&&t<Oe.expiresAt){const n="sunny"===Oe.kind?"noweather":"weather",o={kind:Oe.kind,raw:n,hash:"override",canvasPresent:!0,timestamp:t,source:"unknown",label:Oe.kind,startedAt:t,expectedEndAt:Oe.expiresAt};return void((e||o.hash!==We.hash||o.kind!==We.kind)&&Ze(o))}Oe&&t>=Oe.expiresAt&&(Oe=null);const n=et(function(){for(const o of Ae){const e=document.querySelector(o);if(!e)continue;if(e instanceof HTMLCanvasElement)return e;const t=e.querySelector("canvas");if(t instanceof HTMLCanvasElement)return t}const e=[],t=a();t&&e.push(t);const n=document.getElementById("App");n instanceof HTMLElement&&!e.includes(n)&&e.push(n);for(const o of e){const e=Fe(o);if(e)return e}return Fe(document)}());Ze(n)}function nt(e){Ue=!0;const t="string"==typeof e&&e.trim().length>0?e.trim():null,n=Me(t),o=n?.kind??function(e){const t=Me(e);return t?.kind??(e?"unknown":"sunny")}(t),r=n?.rawState??("sunny"===o||"unknown"===o?"noweather":"weather"),i=`atom:${$e(t??n?.label??"sunny")||"sunny"}`,a=Date.now(),s=n?.id??"Weather:Sunny";Je!==s&&(Je=s,Qe=a,Ye=n?.durationMs?a+n.durationMs:null);Ze({kind:o,raw:r,hash:i,canvasPresent:!0,timestamp:a,source:"atom",label:t??n?.label??null,startedAt:Qe,expectedEndAt:Ye})}function ot(){null==Ge&&(!async function(){if(!Ve&&!Ke){Ke=(async()=>{try{const e=await He("weather",e=>{_e=!0,Xe="string"==typeof e?e:null,nt(Xe)});Ve=e;const t=await De("weather").catch(()=>Xe);"string"!=typeof t&&null!=t||(Xe=t),_e=!0,nt(Xe)}catch(e){_e=!1,Ue=!1,s("‚ö†Ô∏è Weather hub atom bridge error",e),Ve=null}finally{Ke=null}})();try{await Ke}catch{}}}(),tt(!0),Ge=window.setInterval(()=>tt(!1),2e3))}function rt(){_e&&Ue?nt(Xe):tt(!0)}function it(e,t=!0){if(je.add(e),t)try{e(We)}catch(n){s("‚ö†Ô∏è Weather hub immediate listener failed",n)}return()=>{je.delete(e)}}function at(){return We}const st=new Set,lt={},ct={};function dt(e){return e.map(e=>({...e}))}function ut(e){const t={source:e.source,generatedAt:e.generatedAt,summary:e.summary,perWeather:{rain:dt(e.perWeather.rain??[]),snow:dt(e.perWeather.snow??[]),dawn:dt(e.perWeather.dawn??[]),amber:dt(e.perWeather.amber??[])}};return e.metadata&&(t.metadata={...e.metadata}),t}function pt(e){const t={...e,perWeather:{rain:dt(e.perWeather.rain??[]),snow:dt(e.perWeather.snow??[]),dawn:dt(e.perWeather.dawn??[]),amber:dt(e.perWeather.amber??[])}};e.metadata&&(t.metadata={...e.metadata}),ct[e.source]=t}function mt(e,t={}){const n=Math.max(0,e.overallTrackedPlantCount-e.overallEligiblePlantCount),o=Math.max(0,n-e.lunar.mutatedPlantCount);return{...t,lunarTrackedPlantCount:e.lunar.trackedPlantCount,lunarPendingPlantCount:e.lunar.pendingPlantCount,lunarMutatedPlantCount:e.lunar.mutatedPlantCount,nonLunarMutatedPlantCount:o,dawnPendingFruitCount:e.totals.dawn.pendingFruitCount,amberPendingFruitCount:e.totals.amber.pendingFruitCount}}function ft(e){return e?ct[e]??null:ct.garden??ct.inventory??null}function gt(e,t){lt[e]=t;const n={source:e,summary:t};for(const r of st)try{r(n)}catch(o){s("‚ö†Ô∏è Mutation summary listener error",o)}}x("__qpmMutationDebug",{get:e=>function(e){const t=ft(e);return t?ut(t):null}(e),getAll(){const e={};return Object.keys(ct).forEach(t=>{const n=ct[t];n&&(e[t]=ut(n))}),e},list(e){const t=ft(e);return t?function(e){return{source:e.source,generatedAt:e.generatedAt,activeWeather:e.summary.activeWeather,perWeather:{rain:e.perWeather.rain.map(e=>e.name),snow:e.perWeather.snow.map(e=>e.name),dawn:e.perWeather.dawn.map(e=>e.name),amber:e.perWeather.amber.map(e=>e.name)},metadata:e.metadata?{...e.metadata}:void 0}}(t):null},print(e){const t=ft(e);if(!t)return null;const n=[];["rain","snow","dawn","amber"].forEach(e=>{(t.perWeather[e]??[]).forEach(t=>{const o={weather:e,name:t.name,pending:t.pendingFruit,needsSnow:t.needsSnowFruit,fruit:t.fruitCount,source:t.source};t.tag&&(o.tag=t.tag),n.push(o)})});const o=globalThis.console;return 0===n.length?(o?.info?.("[QPM] No mutation plants recorded for current snapshot."),[]):(o?.table?o.table(n):o?.log?.(n),n)}});const ht=["F","W","C","D","A","R","G"],bt="quinoa-mutation-reminder-config",yt=".McFlex.css-1cyjil4",xt="div.css-vmnhaw",wt="myCropInventoryAtom";let vt={enabled:!0,showNotifications:!0,highlightPlants:!0},Ct="unknown",Tt="unknown",St=null,Pt=null,At=null,kt=!1,Et=new Set,$t=!1,Mt=!1,Ft=!1,It=0,Lt=!1;let zt=0;const Nt=["rain","snow","dawn","amber"];function qt(e){let t=e.toLowerCase().replace(/\+\d+$/,"").trim();return t.endsWith(" plant")&&(t=t.slice(0,-6).trim()),t}function Bt(){vt={...vt,...f.get(bt,{})},s("üå± Plant Mutation Reminder starting..."),vt.enabled&&(Dt(),Rt()),s("üå± Plant Mutation Reminder started")}function Rt(){$t||($t=!0,o(yt,e=>{if(vt.enabled&&(Et.size>0&&(s(`üîÑ Inventory reopened, reapplying ${Et.size} plant highlights...`),setTimeout(()=>{!async function(){if(0===Et.size)return void s("‚è≠Ô∏è No highlights to reapply");s(`üîç Reapplying highlights for ${Et.size} tracked plants...`);const e=await _t();if(0===e.length)return void s("‚ö†Ô∏è No plants found in inventory for reapply");const t=e.filter(e=>{const t=Ot(e);return Et.has(t)});t.length>0?(s(`‚ú® Reapplying ${t.length} highlights`),hn(t)):s("‚ö†Ô∏è None of the tracked plants found in current inventory")}()},300)),At)){const{weather:e}=At;s(`üì¶ Inventory opened with pending ${e} notification`),vt.showNotifications&&yn(`${wn(e)} ${e.toUpperCase()} Weather Active`,"Checking your plants for mutation opportunities...","info");const t=(e=0)=>{const n=document.querySelector(yt);if(!n)return void s("‚ö†Ô∏è Inventory container disappeared");const o=Array.from(n.querySelectorAll(xt)).filter(e=>{const t=e.querySelector("p.chakra-text");return(t?.textContent?.trim()||"").toLowerCase().includes("plant")});o.length>0||e>=5?(o.length>0?s(`‚úÖ Found ${o.length} plant items after ${300*e}ms`):s(`‚è∞ Timeout waiting for plants after ${300*e}ms`),Gt()):(s(`‚è≥ No plants found yet, waiting... (attempt ${e+1}/5)`),setTimeout(()=>t(e+1),300))};t()}}))}function Dt(){ot(),St||(St=it(Ht,!0))}function Ht(e){Pt=e;const t=function(e){switch(e.kind){case"rain":return"rain";case"snow":return"snow";case"dawn":return"dawn";case"amber":return"amber";case"sunny":return"sunny";default:return"weather"===e.raw?"rain":"sunny"}}(e);if(!vt.enabled&&!kt)return Tt=Ct,void(Ct=t);t!==Ct&&(Tt=Ct,Ct=t,s(`üå§Ô∏è Weather changed: ${Tt} ‚Üí ${Ct}`),bn(),"sunny"===Ct||"unknown"===Ct?(At=null,s("üå§Ô∏è Weather cleared - no mutations available")):Gt())}function jt(e){switch(e){case"rain":case"snow":return 3e5;case"dawn":case"amber":return 6e5;default:return null}}function Wt(e,t){if("sunny"===e||"unknown"===e)return null;const n=jt(e),o=t?.startedAt??t?.timestamp??null,r=t?.expectedEndAt??(null!=o&&null!=n?o+n:null)??(null!=n?Date.now()+n:null),i=null!=r?Math.max(0,r-Date.now()):null;return{weather:e,startedAt:o,expectedEndAt:r,durationMs:null!=r&&null!=o?Math.max(0,r-o):n,remainingMs:i}}async function Gt(){if(!vt.enabled)return;s(`üîç Checking inventory for mutation opportunities (${Ct})...`);const e=await _t(),t=Wt(Ct,Pt),n={rain:[],snow:[],dawn:[],amber:[]},o=(e,t,o)=>{const r={name:t.name,pendingFruit:o.pendingFruit,needsSnowFruit:o.needsSnowFruit,fruitCount:t.fruitCount,source:t.slotSource};o.tag&&(r.tag=o.tag),n[e].push(r)};if(0===e.length){const e=gn([],Ct,t,o);return gt("inventory",e),pt({source:"inventory",generatedAt:e.timestamp,summary:e,perWeather:n,metadata:mt(e,{scannedPlantCount:0,highlightedPlantCount:0,notes:"Inventory empty"})}),s("üì¶ No plants found in inventory"),void("sunny"!==Ct&&"unknown"!==Ct&&(At={weather:Ct,plantCount:0},vt.showNotifications&&yn(`${wn(Ct)} ${Ct.toUpperCase()} Weather!`,"Open your inventory (press E) to check which plants to place","info")))}At=null;const r=function(e,t){const n=[];for(const o of e){mn(o,t,!0).decision&&n.push(o)}return n}(e,Ct),i=gn(e,Ct,t,o);gt("inventory",i),pt({source:"inventory",generatedAt:i.timestamp,summary:i,perWeather:n,metadata:mt(i,{scannedPlantCount:e.length,highlightedPlantCount:r.length})}),r.length>0?(s(`üå± Found ${r.length} plants to place for ${Ct}!`),vt.highlightPlants&&(r.forEach(e=>{const t=Ot(e);Et.add(t)}),hn(r)),vt.showNotifications&&function(e,t){(function(e,t){const n=wn(t),o=e.length,r=xn(t);t.toUpperCase()})(e,t),yn(`${wn(t)} ${t.toUpperCase()} Weather!`,`Place ${e.length} plant${e.length>1?"s":""} ${xn(t)}`,"success")}(r,Ct),r.length):s(`‚úì No mutation opportunities for ${Ct}`)}function Ot(e){const t=function(e){if(!e.length)return"no-slots";return e.map(e=>{const t=e.letters.join(""),n=`${e.hasDawnbound?"d":""}${e.hasAmberbound?"a":""}`,o=t||"_";return n?`${o}+${n}`:o}).join(",")}(e.slotStates);return`${e.name}|${e.mutations}|${e.fruitCount}|${t}`}function Vt(e,t,n,o){const r=e.slotStates.map((e,t)=>({index:t,letters:e.letters.join(""),wet:e.hasWet,frozen:e.hasFrozen,chilled:e.hasChilled,dawn:e.hasDawnlit,amber:e.hasAmberlit,dawnbound:e.hasDawnbound,amberbound:e.hasAmberbound,rainbow:e.hasRainbow,gold:e.hasGold,progress:e.progress}));s(`[Mutations] ${n?"‚úÖ highlight":"‚è≠Ô∏è skip"} ${e.name} for ${t}`,{slotSource:e.slotSource,fruitCount:e.fruitCount,domCounts:e.domMutationCounts,domBold:e.domBoldCounts,slotSummary:r,detail:o})}async function _t(){const e=((e,t=document)=>t.querySelector(e))(yt);if(!e||!r(e))return s("‚ùå Inventory not open"),[];const t=Array.from(e.querySelectorAll(xt)),n=await async function(){Ft=!1,It=0,zt=0;const e=await async function(){const e=async()=>{const e=await async function(){if("undefined"==typeof window)return null;const e=window,t=[{source:"MGTools.Core.Atoms.inventory.myCropInventory",atom:e?.MGTools?.Core?.Atoms?.inventory?.myCropInventory},{source:"MGTOOLS.Core.Atoms.inventory.myCropInventory",atom:e?.MGTOOLS?.Core?.Atoms?.inventory?.myCropInventory},{source:"Atoms.inventory.myCropInventory",atom:e?.Atoms?.inventory?.myCropInventory},{source:"__tmAtoms.inventory.myCropInventory",atom:e?.__tmAtoms?.inventory?.myCropInventory}];for(const o of t){const e=o.atom;if(!e)continue;const t=e=>{const t=Ut(e);if(t&&t.length>0)return t;if(e&&"object"==typeof e){const t=[e.items,e.value,e.current,e.state];for(const e of t){const t=Ut(e);if(t&&t.length>0)return t}}return null};try{if("function"==typeof e.get){const n=t(await e.get());if(n&&n.length>0)return{items:n,source:`${o.source}.get()`,hasSlotData:n.some(e=>en(e).length>0)}}const n=t(e);if(n&&n.length>0)return{items:n,source:`${o.source}`,hasSlotData:n.some(e=>en(e).length>0)}}catch(n){Lt||(s("‚ö†Ô∏è Unable to read shared atoms inventory source",{source:o.source,error:n}),Lt=!0)}}return null}();if(e)return Ft||(s("[Mutations] Using shared atoms inventory source",{source:e.source,items:e.items.length,hasSlotData:e.hasSlotData}),Ft=!0),e.items;const t=function(){if("undefined"==typeof window)return null;const e=window,t=[{source:"UnifiedState.atoms.inventory.items",value:e?.UnifiedState?.atoms?.inventory?.items},{source:"UnifiedState.atoms.inventory",value:e?.UnifiedState?.atoms?.inventory},{source:"myData.inventory.items",value:e?.myData?.inventory?.items},{source:"__mga_cachedInventory",value:e?.__mga_cachedInventory},{source:"MGTOOLS.UnifiedState.atoms.inventory.items",value:e?.MGTOOLS?.UnifiedState?.atoms?.inventory?.items}];let n=null;for(const o of t){let e=Ut(o.value),t=o.source;if((!e||0===e.length)&&o.value&&"object"==typeof o.value){const n=[{key:"myCropInventory",label:`${o.source}.myCropInventory`},{key:"cropInventory",label:`${o.source}.cropInventory`},{key:"inventory",label:`${o.source}.inventory`},{key:"items",label:`${o.source}.items`}];for(const r of n){const n=Ut(o.value[r.key]);if(n&&n.length>0){e=n,t=r.label;break}}}if(!e||0===e.length)continue;const r=e.some(e=>en(e).length>0),i={items:e,source:t,hasSlotData:r};if(r)return i;n||(n=i)}return n}();return t?(Ft||(s("[Mutations] Using global inventory source",{source:t.source,items:t.items.length,hasSlotData:t.hasSlotData}),Ft=!0),t.items):[]},t=async(t,n)=>{if(!t||0===t.length)return await e();if(t.some(e=>en(e).length>0))return Ft||(s(`[Mutations] Read crop inventory atom (${n})`,{count:t.length,hasSlotData:!0}),Ft=!0),t;if(!Ft){const e=t.slice(0,3).map((e,t)=>({index:t,summary:Xt(e)}));s("[Mutations] Crop inventory atom lacks slot data, trying fallback",{source:n,count:t.length,samples:e})}const o=await e();return o.length>0?o:(Ft||(s("[Mutations] Crop inventory atom fallback unavailable, proceeding without slot data",{source:n,count:t.length}),Ft=!0),t)};try{await $()}catch(r){return Mt||(s("‚ö†Ô∏è Unable to capture jotai store for crop inventory",r),Mt=!0),await e()}const n=await W();if(n&&n.items.length>0)return Ft||(s("[Mutations] Using userSlotsAtom inventory source",{source:n.source,items:n.items.length,hasSlotData:n.hasSlotData}),Ft=!0),n.hasSlotData?n.items:await t(n.items,n.source);const o=F(wt);if(!o)return Mt||(s("‚ö†Ô∏è Could not locate myCropInventoryAtom in jotai cache"),Mt=!0),await e();try{const n=await I(o);return Mt=!1,Array.isArray(n)?await t(n,"array"):n&&Array.isArray(n.items)?await t(n.items,"items array"):(Ft||s("[Mutations] Crop inventory atom value not array-like",{sample:n}),await e())}catch(r){return Mt||(s("‚ö†Ô∏è Failed reading myCropInventoryAtom",r),Mt=!0),await e()}return[]}();if(0===e.length)return Ft||(s("[Mutations] Inventory lookup unavailable (no items)"),Ft=!0),null;const t=new Map,n=new Map,o=new Map;if(e.forEach((e,r)=>{const i=function(e,t){if(!e||"object"!=typeof e)return null;const n=function(e){if(!e||"object"!=typeof e)return"other";if(en(e).length>0)return"plant";const t=[e?.itemType,e?.type,e?.category,e?.kind,e?.item?.itemType,e?.item?.type,e?.plant?.itemType,e?.plant?.type];for(const n of t){if("string"!=typeof n)continue;const e=n.toLowerCase();if("plant"===e||"crop"===e||e.endsWith("plant")||e.includes("plant"))return"plant"}return"other"}(e);if("plant"!==n)return It<5&&(s("[Mutations] Inventory item skipped (type mismatch)",{index:t,itemType:n,keys:Object.keys(e).slice(0,10),sample:Xt(e)}),It+=1),null;const o=en(e),r=o.map(tn),i="string"==typeof e.id?e.id:null,a="string"==typeof e.species?e.species:null,l="string"==typeof e.itemName?e.itemName:null,c="string"==typeof e.displayName?e.displayName:null;let d="string"==typeof e.name?e.name:null;d||(d=l||c);!d&&a&&(d=a.toLowerCase().includes("plant")?a:`${a} Plant`);const u=d?qt(d):null;return{baseIndex:t,id:i,slotStates:r,raw:e,name:d,normalizedName:u,used:!1}}(e,r);if(i&&(t.set(i.baseIndex,i),i.id&&n.set(i.id,i),i.normalizedName)){const e=o.get(i.normalizedName)??[];e.push(i),o.set(i.normalizedName,e)}}),0===t.size)return Ft||(s("[Mutations] Inventory lookup construction produced zero entries"),Ft=!0),null;Ft||(s("[Mutations] Inventory lookup ready",{items:e.length,byIndex:t.size,byId:n.size,byName:o.size}),Ft=!0);return{byIndex:t,byId:n,byName:o}}(),o=[];return t.forEach((e,t)=>{const r=function(e,t,n){try{const r=["p.chakra-text.css-8xfasz",".McFlex.css-1gd1uup p.chakra-text","p.chakra-text.css-rbbzu5","p.chakra-text"],i=[];let a="";for(const t of r){const n=Array.from(e.querySelectorAll(t));for(const e of n){const t=e.textContent?.trim();t&&(i.push(t),!a&&/plant/i.test(t)&&(a=t))}if(a)break}if(!a&&i.length){a=i.find(e=>/[a-z]/i.test(e))??""}if(!a||!function(e){e.toLowerCase().trim();const t=/\+\d+$/.test(e),n=e.match(/^(.+?)(?:\+\d+)?$/),o=(n?.[1]||e).toLowerCase().trim(),r=["seed","spore","cutting","pod","kernel","pit","shovel","pot","watering can","tool","fertilizer","egg","decor","furniture","planter"];for(const i of r)if(o.includes(i))return!1;if(o.includes("plant"))return!0;if(t)return!0;return!1}(a))return null;const l=function(e){const t=[],n=e.querySelectorAll("span, div, p");for(const o of n){const e=o.textContent?.trim();if(!e||1!==e.length)continue;const n=e.toUpperCase();if(!sn(n))continue;let r=!1;if(o instanceof HTMLElement){const e=window.getComputedStyle(o).fontWeight,t=Number.parseInt(e,10);r="bold"===e||Number.isFinite(t)&&t>=700}t.push({letter:n,isBold:r})}return t}(e),c=function(e){const t=rn();for(const n of e)t[n.letter]+=1;return t}(l),d={D:(o=l).filter(e=>"D"===e.letter&&e.isBold).length,A:o.filter(e=>"A"===e.letter&&e.isBold).length},u=a.match(/\+(\d+)/),p=u?parseInt(u[1]||"1",10):0;let m=[],f="fallback";if(t){const o=function(e,t){const n=dn(e,ln),o=pn(n);if(null!=o)return o;const r=un(e,e=>e.toLowerCase().includes("inventorybaseindex")),i=pn(r);if(null!=i)return i;const a=e.querySelector("[data-tm-inventory-base-index]");if(a){const e=pn(dn(a,ln));if(null!=e)return e;const t=pn(un(a,e=>e.toLowerCase().includes("inventorybaseindex")));if(null!=t)return t}return t}(e,n);let r=t.byIndex.get(o)??null;if(!r||r.used){const n=function(e){const t=["[data-tm-inventory-id]","[data-inventory-id]","[data-item-id]","[data-itemid]","[data-item-uuid]","[data-uuid]","[data-guid]","[data-entity-id]","[data-record-id]","[data-row-id]"],n=e=>{const t=e.toLowerCase();return t.includes("inventoryid")||t.includes("itemid")||/(?:uuid|guid)$/.test(t)},o=[];let r=e;for(let i=0;r&&i<5;i++)o.push(r),r=r.parentElement;for(const i of o){const e=dn(i,cn);if(e)return e;const t=un(i,n);if(t)return t}for(const i of o)for(const e of t){const t=i.querySelector(e);if(!t)continue;const o=dn(t,cn);if(o)return o;const r=un(t,n);if(r)return r}return null}(e);if(n){const e=t.byId.get(n)??null;e&&!e.used&&(r=e)}}if(!r||r.used){const e=qt(a),n=t.byName.get(e);if(n){for(;n.length>0&&n[0]&&n[0].used;)n.shift();if(n.length>0){const e=n.shift();e&&(r=e)}}}r&&!r.used&&(r.used=!0,m=r.slotStates.map(on),f="inventory")}const g=an(m,c,d),h=p>0?p:m.length;return 0===h?(s(`‚è≠Ô∏è Skipping ungrown plant: ${a} (${"inventory"===f?"no slots yet":"no fruit count"})`),null):{name:a,mutations:g,element:e,fruitCount:h,slotStates:m,slotSource:f,domMutationCounts:c,domBoldCounts:d}}catch(r){return s("‚ùå Error extracting plant data:",r),null}var o}(e,n,t);r&&o.push(r)}),s(`üì¶ Scanned ${o.length} plants from inventory`),o}function Ut(e){if(Array.isArray(e))return e;if(e&&"object"==typeof e){const t=e.items;if(Array.isArray(t))return t}return null}function Xt(e){const t={},n=["id","name","species","itemType","type","category","kind"];for(const o of n)e&&"object"==typeof e&&o in e&&(t[o]=e[o]);if(e?.item&&"object"==typeof e.item){t.item={};for(const o of n)o in e.item&&(t.item[o]=e.item[o])}if(e?.plant&&"object"==typeof e.plant){t.plant={};for(const o of n)o in e.plant&&(t.plant[o]=e.plant[o])}return e?.itemName&&(t.itemName=e.itemName),t.hasSlots=!!en(e).length,t}function Kt(e){if("string"==typeof e){const t=e.trim();return t.length>0?t:null}return"number"==typeof e&&Number.isFinite(e)?e.toString():null}function Jt(e){if("number"==typeof e&&Number.isFinite(e))return e;if("string"==typeof e){const t=Number.parseInt(e,10);return Number.isNaN(t)?null:t}return null}function Qt(e,t){if(!e||"object"!=typeof e)return null;if(t.has(e))return null;if(t.add(e),Array.isArray(e)){for(const n of e){const e=Qt(n,t);if(e)return e}return null}const n=e,o=[[n.complete,n.total],[n.completed,n.total],[n.completed,n.goal],[n.count,n.total],[n.count,n.required],[n.current,n.max],[n.value,n.max]];for(const[i,a]of o){const e=Jt(i),t=Jt(a);if(null!=e&&null!=t&&t>0&&e>=0)return{complete:e,total:t}}const r=["progress","state","status","data","info","details","counts"];for(const i of r){const e=n[i];if(!e)continue;const o=Qt(e,t);if(o)return o}return null}function Yt(e,t=new WeakSet){if("string"==typeof e)return e;if("number"==typeof e&&Number.isFinite(e))return e.toString();if(!e||"object"!=typeof e)return null;if(t.has(e))return null;t.add(e);const n=e,o=["name","displayName","display_name","mutationName","mutation","label","title","text","type","kind","state","status","key"];let r=null;for(const a of o){const e=Kt(n[a]);if(e){r=e;break}}if(!r){const e=["mutation","mut","data","info","details","entry","node","item"];for(const o of e){const e=n[o];if(!e)continue;const i=Yt(e,t);if(i){r=i;break}}}const i=Qt(n,t);return i&&(r?/\d+\s*\/\s*\d+/.test(r)||(r=`${r} ${i.complete}/${i.total}`):r=`${i.complete}/${i.total}`),r}function Zt(e){if(!e||"object"!=typeof e)return{};const t=e,n={},o=Object.keys(t).slice(0,10);for(const r of o){const e=t[r];if(null!=e)if("string"!=typeof e&&"number"!=typeof e&&"boolean"!=typeof e){if(Array.isArray(e))n[r]=e.slice(0,3).map(e=>{if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return e;if(e&&"object"==typeof e){const t=e,n=Object.keys(t).find(e=>{const n=t[e];return"string"==typeof n||"number"==typeof n});return n?t[n]:Object.keys(t).slice(0,3)}return typeof e});else if("object"==typeof e){const t=e,o={};for(const e of Object.keys(t).slice(0,5)){const n=t[e];"string"!=typeof n&&"number"!=typeof n&&"boolean"!=typeof n||(o[e]=n)}Object.keys(o).length>0&&(n[r]=o)}}else n[r]=e}return n}function en(e){if(!e||"object"!=typeof e)return[];const t=[e.slots,e.plant?.slots,e.item?.slots,e.data?.slots,e.slots?.slots,e.growSlots];for(const n of t)if(Array.isArray(n)&&n.length>0)return n;return[]}function tn(e){const t=function(e){if(!e||"object"!=typeof e)return[];const t=e,n=[],o=new Set,r=e=>{if(!e)return;const t=e.trim();t&&!o.has(t)&&(o.add(t),n.push(t))},i=[t.mutations,t.mutationStates,t.mutation_states,t.mutationHistory,t.appliedMutations,t.pendingMutations,t.mutationsList];for(const s of i)if(s)if(Array.isArray(s))for(const e of s)r(Yt(e));else if("object"==typeof s)for(const e of Object.values(s))r(Yt(e));const a=["mutation","mutationName","mutationType","currentMutation","activeMutation","latestMutation"];for(const s of a)r(Yt(t[s]));if(0===n.length){const e=[["wet","wet"],["water","wet"],["rain","wet"],["freeze","wet"],["frozen","wet"],["chill","wet"],["dawn","dawn"],["amber","amber"]];for(const[n,o]of Object.entries(t)){const t=n.toLowerCase(),i=e.find(([e])=>t.includes(e));if(!i)continue;const[,a]=i,s=Qt(o,new WeakSet);s&&r(`${a} ${s.complete}/${s.total}`)}}return n}(e);if(0===t.length&&zt<5){const t=e&&"object"==typeof e?Object.keys(e).slice(0,10):[];s("[Mutations] Inventory slot missing mutation text",{keys:t,sample:Zt(e)}),zt+=1}return nn(t)}function nn(e){const t=new Set;let n=!1,o=!1,r=!1,i=!1,a=!1,s=!1,l=!1,c=!1,d=!1;const u={};let p=0,m=0,f=0;const g=(e,t,n)=>{if(!Number.isFinite(t)||!Number.isFinite(n))return;if(n<=0||t<0)return;const o=u[e];(!o||n>o.total||n===o.total&&t>o.complete)&&(u[e]={complete:t,total:n})};for(const b of e){const e=String(b??"").toLowerCase(),u=e.includes("frozen")||e.includes("freeze");u&&(n=!0,t.add("F"));const h=e.includes("wet");h&&(o=!0,t.add("W"));const y=e.includes("chill");y&&(r=!0,t.add("C")),(u||h||y)&&(p+=1);const x=e.includes("dawnbound");x&&(s=!0,t.add("D"));const w=e.includes("amberbound");w&&(l=!0,t.add("A"));const v=(e.includes("dawnlit")||e.includes("dawnlight")||e.includes("dawn"))&&!x;v&&(i=!0,t.add("D")),(v||x)&&(m+=1);const C=(e.includes("amberlit")||e.includes("amberlight")||e.includes("amber"))&&!w;C&&(a=!0,t.add("A")),(C||w)&&(f+=1);e.includes("rainbow")&&(c=!0,t.add("R"));e.includes("gold")&&(d=!0,t.add("G"));const T=e.match(/(\d+)\s*\/\s*(\d+)/);if(T){const e=Number.parseInt(T[1]??"0",10),t=Number.parseInt(T[2]??"0",10);(u||h||y)&&g("wet",e,t),(v||x)&&g("dawn",e,t),(C||w)&&g("amber",e,t)}}const h=Array.from(t).sort();return!u.wet&&p>0&&(u.wet={complete:p,total:p}),!u.dawn&&m>0&&(u.dawn={complete:m,total:m}),!u.amber&&f>0&&(u.amber={complete:f,total:f}),{letters:h,hasFrozen:n,hasWet:o,hasChilled:r,hasDawnlit:i,hasAmberlit:a,hasDawnbound:s,hasAmberbound:l,hasRainbow:c,hasGold:d,progress:u}}function on(e){return{letters:[...e.letters],hasFrozen:e.hasFrozen,hasWet:e.hasWet,hasChilled:e.hasChilled,hasDawnlit:e.hasDawnlit,hasAmberlit:e.hasAmberlit,hasDawnbound:e.hasDawnbound,hasAmberbound:e.hasAmberbound,hasRainbow:e.hasRainbow,hasGold:e.hasGold,progress:{...e.progress??{}}}}function rn(e=0){return{F:e,W:e,C:e,D:e,A:e,R:e,G:e}}function an(e,t,n){const o=new Set;for(const r of e)r.letters.forEach(e=>o.add(e)),r.hasDawnbound&&o.add("D"),r.hasAmberbound&&o.add("A");for(const r of ht)t[r]>0&&o.add(r);return n.D>0&&o.add("D"),n.A>0&&o.add("A"),Array.from(o).sort().join("")}function sn(e){return"F"===e||"W"===e||"C"===e||"D"===e||"A"===e||"R"===e||"G"===e}const ln=["data-tm-inventory-base-index","data-tm-inventory-baseindex","data-tm-base-index","data-base-index"],cn=["data-tm-inventory-id","data-inventory-id","data-item-id","data-itemid","data-itemId","data-item-uuid","data-itemuuid","data-item-guid","data-uuid","data-guid","data-entity-id","data-entityid","data-record-id","data-recordid","data-row-id","data-rowid","data-tm-item-id","data-tm-itemid","data-id"];function dn(e,t){for(const o of t){const t=e.getAttribute(o);if(null!=t)return t}const n=t.map(e=>e.toLowerCase());for(const{name:o,value:r}of Array.from(e.attributes))if(n.includes(o.toLowerCase())&&null!=r)return r;return null}function un(e,t){const n=e.dataset;if(!n)return null;for(const[o,r]of Object.entries(n))if(t(o)&&null!=r&&""!==r)return r;return null}function pn(e){if(null==e)return null;const t=Number.parseInt(e,10);return Number.isFinite(t)?t:null}function mn(e,t,n=!0){if("sunny"===t||"unknown"===t){const o={strategy:"fallback",fruitCount:Math.max(e.fruitCount,0),frozenCount:0,wetCount:0,chilledCount:0,dawnCount:0,amberCount:0,dawnBoundCount:0,amberBoundCount:0,rainbowCount:0,goldCount:0};return n&&Vt(e,t,!1,o),{decision:!1,pendingFruits:0,totalFruits:Math.max(e.fruitCount,0),needsSnow:0,detail:o}}return e.slotStates.length>0&&("inventory"===e.slotSource||"garden"===e.slotSource)?function(e,t,n){const{slotStates:o}=e,r=o.some(e=>e.hasAmberlit||e.hasAmberbound),i=o.some(e=>e.hasDawnlit||e.hasDawnbound),a=o.some(e=>e.hasRainbow),l=o.some(e=>e.hasGold);if(!o.some(e=>e.letters.length>0||e.hasWet||e.hasFrozen||e.hasChilled||e.hasDawnlit||e.hasAmberlit||e.hasDawnbound||e.hasAmberbound||e.hasRainbow||e.hasGold))return fn(e,t,n);const c=o.filter(e=>{const t=(e.hasAmberlit||e.hasAmberbound)&&(e.hasDawnlit||e.hasDawnbound),n=e.hasRainbow&&e.hasGold;return t||n});c.length>0&&s(`‚ö†Ô∏è ${e.name} has ${c.length} fruit(s) with conflicting mutations (same fruit cannot be both amber+dawn or rainbow+gold)`);let d=0,u=0,p=0,m=0,f=0,g=Math.max(e.fruitCount,1),h=0,b=0,y=0,x=0,w=0,v=0;for(const s of o){(s.hasWet||s.hasFrozen)&&(d+=1),s.hasWet&&!s.hasFrozen&&(u+=1);(s.hasChilled||s.hasFrozen)&&(p+=1),s.hasChilled&&s.hasFrozen,(s.hasDawnlit||s.hasDawnbound)&&(m+=1),(s.hasAmberlit||s.hasAmberbound)&&(f+=1);const e=s.progress?.wet;e&&(h=Math.max(h,e.total),b=Math.max(b,e.complete));const t=s.progress?.dawn;t&&(y=Math.max(y,t.total),x=Math.max(x,t.complete));const n=s.progress?.amber;n&&(w=Math.max(w,n.total),v=Math.max(v,n.complete))}g=Math.max(g,d,p,m,f);const C=e=>Math.max(0,Math.min(g,e)),T=C(e.domMutationCounts.F),S=C(e.domMutationCounts.W),P=C(T+S),A=C(Math.max(0,P-T)),k=C(e.domMutationCounts.C),E=C(T+k),$=C(e.domMutationCounts.D+e.domBoldCounts.D),M=C(e.domMutationCounts.A+e.domBoldCounts.A);d=Math.max(d,P),u=Math.max(u,A),p=Math.max(p,E),m=Math.max(m,$),f=Math.max(f,M),h>0&&(g=Math.max(g,h),d=Math.max(d,b));y>0&&(g=Math.max(g,y),m=Math.max(m,x));w>0&&(g=Math.max(g,w),f=Math.max(f,v));const F=Math.max(0,g-d),I=Math.max(0,g-p),L=Math.max(0,g-m),z=Math.max(0,g-f),N={strategy:"inventory",totalFruits:g,wetPending:F,wetFinished:d,wetNeedsSnow:u,wetProgressComplete:b,wetProgressTotal:h,domWetProgress:P,domWetNeedsSnow:A,dawnPending:L,dawnProgressComplete:x,dawnProgressTotal:y,domDawnComplete:$,amberPending:z,amberProgressComplete:v,amberProgressTotal:w,domAmberComplete:M,hasAnyDawn:i,hasAnyAmber:r,hasAnyRainbow:a,hasAnyGold:l};let q=!1,B=0,R=u;switch(t){case"rain":q=F>0,B=F;break;case"snow":I>0?(q=!0,B=I):(q=u>0,B=u);break;case"dawn":q=L>0,B=L,R=0;break;case"amber":q=z>0,B=z,R=0;break;default:q=!1,B=0,R=0}const D={decision:q,pendingFruits:Math.max(0,B),totalFruits:Math.max(1,g),needsSnow:Math.max(0,R),detail:{...N}};n&&Vt(e,t,D.decision,D.detail);return D}(e,t,n):fn(e,t,n)}function fn(e,t,n){const{fruitCount:o,domMutationCounts:r,domBoldCounts:i}=e,a=Math.max(o,0);if(a<=0){const o={strategy:"fallback",fruitCount:a,frozenCount:0,wetCount:0,chilledCount:0,dawnCount:0,amberCount:0,dawnBoundCount:0,amberBoundCount:0,rainbowCount:0,goldCount:0};return n&&Vt(e,t,!1,o),{decision:!1,pendingFruits:0,totalFruits:a,needsSnow:0,detail:o}}const s=e=>Math.max(0,Math.min(e,a)),l=s(r.F),c=s(r.W),d=s(r.C),u=s(r.D),p=s(r.A),m=s(r.R),f=s(r.G),g=s(i.D),h=s(i.A),b={strategy:"fallback",fruitCount:a,frozenCount:l,wetCount:c,chilledCount:d,dawnCount:u,amberCount:p,dawnBoundCount:g,amberBoundCount:h,rainbowCount:m,goldCount:f};let y=!1,x=0,w=Math.max(0,c-l);switch(t){case"rain":{const e=c+l;if(e<a)y=!0,x=Math.max(0,a-e);else{const e=d-l;y=e>0,x=Math.max(0,e)}break}case"snow":{const e=d+l;if(e<a)y=!0,x=Math.max(0,a-e);else{const e=c-l;y=e>0,x=Math.max(0,e)}w=Math.max(0,c-l);break}case"dawn":{if(p+h>0){y=!1,x=0;break}const e=u+g;x=Math.max(0,a-e),y=x>0,w=0;break}case"amber":{if(u+g>0){y=!1,x=0;break}const e=p+h;x=Math.max(0,a-e),y=x>0,w=0;break}default:y=!1,x=0,w=0}const v={decision:y,pendingFruits:Math.max(0,x),totalFruits:a,needsSnow:Math.max(0,w),detail:b};return n&&Vt(e,t,v.decision,v.detail),v}function gn(e,t,n=null,o){const r={rain:{weather:"rain",plantCount:0,pendingFruitCount:0},snow:{weather:"snow",plantCount:0,pendingFruitCount:0,needsSnowFruitCount:0},dawn:{weather:"dawn",plantCount:0,pendingFruitCount:0},amber:{weather:"amber",plantCount:0,pendingFruitCount:0}},i=new Set,a=new Set,s=new Set,l=new Set;let c=0,d=0;const u=[];for(const x of e){const e={rain:mn(x,"rain",!1),snow:mn(x,"snow",!1),dawn:mn(x,"dawn",!1),amber:mn(x,"amber",!1)};let t=null;const n=e.dawn,o=e.amber;n.decision&&o.decision&&(t="amber-preferred"),u.push({plant:x,evaluations:e,lunarTag:t})}for(const{plant:x,evaluations:w,lunarTag:v}of u){const e=Ot(x);a.add(e);const t=w.amber,n=w.dawn,u=Math.max(0,Math.round(t.pendingFruits)),p=Math.max(0,Math.round(n.pendingFruits)),m=Math.max(0,Math.round(t.totalFruits??0)),f=Math.max(0,Math.round(n.totalFruits??0));(m>0||f>0)&&s.add(e);let g=null;if(m>0||u>0?g=t:(f>0||p>0)&&(g=n),g){const t=Math.max(0,Math.round(g.totalFruits??0)),n=Math.max(0,Math.round(g.pendingFruits));t>0&&(c+=t,d+=n,n>0&&l.add(e))}for(const a of Nt){const t=w[a];if(!t.decision)continue;const n=Math.max(0,Math.round(t.pendingFruits)),s="snow"===a?Math.max(0,Math.round(t.needsSnow)):0,l="amber"===a&&"amber-preferred"===v?"lunar-any":void 0;r[a].plantCount+=1,r[a].pendingFruitCount+=n,"snow"===a&&(r[a].needsSnowFruitCount=(r[a].needsSnowFruitCount??0)+s);const c={pendingFruit:n,needsSnowFruit:s};l&&(c.tag=l),o?.(a,x,c),i.add(e)}}const p=Nt.reduce((e,t)=>e+r[t].pendingFruitCount,0),m=a.size,f=s.size,g=l.size,h=Math.max(0,f-g),b=Math.max(0,c-d),y=n?{...n,remainingMs:null!=n.expectedEndAt?Math.max(0,n.expectedEndAt-Date.now()):n.remainingMs??null}:null;return{timestamp:Date.now(),activeWeather:t,totals:r,overallEligiblePlantCount:i.size,overallPendingFruitCount:p,overallTrackedPlantCount:m,lunar:{trackedPlantCount:f,pendingPlantCount:g,mutatedPlantCount:h,totalFruitCount:c,pendingFruitCount:d,mutatedFruitCount:b},weatherWindow:y}}function hn(e){for(const t of e){const e=Ot(t);if(!Et.has(e))continue;const n=t.element.parentElement;if(!n)continue;if(n.querySelector(".quinoa-mutation-highlight"))continue;const o=document.createElement("div");o.className="quinoa-mutation-highlight",o.style.cssText="\n      position: absolute;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      border: 3px solid #4CAF50;\n      border-radius: 8px;\n      pointer-events: auto;\n      z-index: 10;\n      animation: quinoa-pulse 1.5s infinite;\n      box-shadow: 0 0 15px rgba(76, 175, 80, 0.8);\n      cursor: pointer;\n    ",o.__plantId=e,o.addEventListener("click",e=>{e.stopPropagation();const n=o.__plantId;n&&(Et.delete(n),s(`‚úÖ Manually removed highlight from ${t.name}`)),o.remove()}),n.style.position="relative",n.appendChild(o)}if(!document.getElementById("quinoa-mutation-styles")){const e=document.createElement("style");e.id="quinoa-mutation-styles",e.textContent="\n      @keyframes quinoa-pulse {\n        0%, 100% { opacity: 1; }\n        50% { opacity: 0.5; }\n      }\n    ",document.head.appendChild(e)}}function bn(){((e,t=document)=>Array.from(t.querySelectorAll(e)))(".quinoa-mutation-highlight").forEach(e=>e.remove()),Et.clear(),s("‚ú® Cleared plant highlights")}function yn(e,t,n="info"){const o=document.querySelectorAll(".quinoa-notification");let r=20;o.forEach(e=>{const t=e.getBoundingClientRect();r=Math.max(r,t.bottom-document.documentElement.getBoundingClientRect().top+10)});const i=document.createElement("div");if(i.classList.add("quinoa-notification"),i.style.cssText=`\n    position: fixed;\n    top: ${r}px;\n    right: 20px;\n    background: ${{success:"rgba(76, 175, 80, 0.95)",info:"rgba(33, 150, 243, 0.95)",warning:"rgba(255, 152, 0, 0.95)"}[n]};\n    color: white;\n    padding: 16px 20px;\n    border-radius: 12px;\n    font-family: Arial, sans-serif;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n    z-index: 999999;\n    max-width: 320px;\n    animation: slideInRight 0.3s ease-out;\n    transition: top 0.3s ease-out;\n  `,i.innerHTML=`\n    <div style="font-size: 16px; font-weight: bold; margin-bottom: 4px;">${e}</div>\n    <div style="font-size: 13px; opacity: 0.95;">${t}</div>\n  `,!document.getElementById("quinoa-notification-styles")){const e=document.createElement("style");e.id="quinoa-notification-styles",e.textContent="\n      @keyframes slideInRight {\n        from {\n          transform: translateX(400px);\n          opacity: 0;\n        }\n        to {\n          transform: translateX(0);\n          opacity: 1;\n        }\n      }\n      @keyframes slideOutRight {\n        from {\n          transform: translateX(0);\n          opacity: 1;\n        }\n        to {\n          transform: translateX(400px);\n          opacity: 0;\n        }\n      }\n    ",document.head.appendChild(e)}document.body.appendChild(i),setTimeout(()=>{i.style.animation="slideOutRight 0.3s ease-in",setTimeout(()=>{i.remove(),function(){const e=document.querySelectorAll(".quinoa-notification");let t=20;e.forEach(e=>{e.style.top=`${t}px`;const n=e.getBoundingClientRect();t=n.bottom-document.documentElement.getBoundingClientRect().top+10})}()},300)},6e3)}function xn(e){switch(e){case"rain":return"to freeze (C‚ÜíF)";case"snow":return"to freeze (W‚ÜíF)";case"dawn":return"to get Dawnlit";case"amber":return"to get Amberlit";default:return"for mutations"}}function wn(e){switch(e){case"rain":return"üåßÔ∏è";case"snow":return"‚ùÑÔ∏è";case"dawn":return"üåÖ";case"amber":return"üåÜ";case"sunny":return"‚òÄÔ∏è";default:return"‚ùì"}}const vn=Object.freeze(Object.defineProperty({__proto__:null,buildMutationSummary:gn,checkForMutations:async function(){Dt(),rt(),vt.enabled&&"sunny"!==Ct&&"unknown"!==Ct?await Gt():vt.enabled&&s("üå§Ô∏è Current weather is sunny or unknown - no mutations available")},combineMutationSources:an,computeSlotStateFromMutationNames:nn,createMutationCountMap:rn,deriveWeatherWindowFromSnapshot:Wt,resolveWeatherDurationMs:jt,setMutationReminderEnabled:function(e){vt.enabled=e,f.set(bt,vt),e?(Dt(),Rt()):(St?.(),St=null)},simulateWeather:async function(e){s(`üß™ [DEBUG] Simulating weather: ${e}`),kt=!0,Dt();const t=function(e){switch(e){case"rain":return"rain";case"snow":return"snow";case"dawn":return"dawn";case"amber":return"amber";case"sunny":return"sunny";default:return null}}(e);t&&(!function(e,t=3e4){const n=Date.now()+Math.max(1e3,t);Oe={kind:e,expiresAt:n},tt(!0)}(t,3e4),rt()),Tt=Ct,Ct=e,bn(),vt.enabled&&"sunny"!==e&&"unknown"!==e?await Gt():s("üå§Ô∏è Simulated weather is sunny or unknown - no mutations available"),setTimeout(()=>{kt=!1,s("üß™ [DEBUG] Simulation mode ended, auto-detection resuming")},3e4)},startMutationReminder:Bt},Symbol.toStringTag,{value:"Module"})),Cn="myDataAtom",Tn="__qpmGardenSnapshot__";let Sn=!1,Pn=w(Tn)??null;const An=new Set;let kn=null;const En=1500;function $n(e){Pn!==e&&(Pn=e,function(){x(Tn,Pn);for(const t of An)try{t(Pn)}catch(e){s("‚ö†Ô∏è Garden listener error",e)}}())}function Mn(e){if(!e||"object"!=typeof e)return null;return e.garden??null}async function Fn(){if(Sn)return;Sn=!0,kn&&(clearTimeout(kn),kn=null);try{await $()}catch(t){return s("‚ö†Ô∏è Jotai store unavailable, garden bridge deferred",t),Sn=!1,void(kn||(kn=window.setTimeout(()=>{kn=null,Fn()},En)))}try{const e=await async function(){const e=F(Cn);if(!e)throw new Error("Unable to locate myDataAtom in jotaiAtomCache");return Mn(await I(e).catch(e=>(s("‚ö†Ô∏è Failed to read myDataAtom",e),null))??void 0)}();$n(e)}catch(t){s("‚ö†Ô∏è Unable to prime garden snapshot",t),kn||(kn=window.setTimeout(()=>{kn=null,Sn=!1,Fn()},En))}const e=F(Cn);if(!e)return s("‚ö†Ô∏è myDataAtom missing after initialization"),Sn=!1,void(kn||(kn=window.setTimeout(()=>{kn=null,Fn()},En)));await L(e,e=>{$n(Mn(e??void 0))})}function In(){return Pn}function Ln(e,t=!0){if(An.add(e),t)try{e(Pn)}catch(n){s("‚ö†Ô∏è Garden listener immediate call failed",n)}return()=>{An.delete(e)}}let zn=!1,Nn=null,qn="unknown",Bn=null,Rn=null;const Dn=["wet","dawn","amber"];function Hn(){zn&&null===Bn&&(Bn=window.setTimeout(()=>{Bn=null,function(){if(!zn)return;const e=function(e){const t=[];if(!e)return t;const n=[{label:"garden",tiles:e.tileObjects},{label:"boardwalk",tiles:e.boardwalkTileObjects}];for(const{label:o,tiles:r}of n)if(r&&"object"==typeof r)for(const[e,n]of Object.entries(r)){if(!n||"object"!=typeof n)continue;const r=n;if("plant"!==r.objectType)continue;const{slotStates:i,inferredSpecies:a}=jn(r),s=i.length;if(0===s)continue;const l=On(i),c=Vn(i),d=an(i,l,c),u=`${_n(r,a)} [${o}:${e}]`;t.push({name:u,mutations:d,element:document.createElement("div"),fruitCount:s,slotStates:i,slotSource:"garden",domMutationCounts:l,domBoldCounts:c})}return t}(Nn),t={rain:[],snow:[],dawn:[],amber:[]},n=gn(e,qn,Wt(qn,Rn),(e,n,o)=>{const r={name:n.name,pendingFruit:o.pendingFruit,needsSnowFruit:o.needsSnowFruit,fruitCount:n.fruitCount,source:n.slotSource};o.tag&&(r.tag=o.tag),t[e].push(r)});gt("garden",n),pt({source:"garden",generatedAt:n.timestamp,summary:n,perWeather:t,metadata:mt(n,{scannedPlantCount:e.length})})}()},75))}function jn(e){const t=Array.isArray(e.slots)?e.slots:[],n=[];let o=null;for(const r of t){if(!r||"object"!=typeof r)continue;const e=r,t=Wn(e);t&&!o&&(o=t);const i=nn((Array.isArray(e.mutations)?e.mutations:[]).map(e=>"string"==typeof e?e:null).filter(e=>!!e));Gn(i,e),n.push(i)}return{slotStates:n,inferredSpecies:o}}function Wn(e){const t=[e.species,e.seedSpecies,e.plantSpecies,e.cropSpecies,e.name];for(const n of t)if("string"==typeof n){const e=n.trim();if(e.length>0)return e}return null}function Gn(e,t){const n=[t.progress,t.mutationProgress];for(const o of n){if(!o||"object"!=typeof o)continue;const t=o;for(const n of Dn){const o=t[n];if(!o||"object"!=typeof o)continue;const r=o,i=Number(r.complete),a=Number(r.total);if(!Number.isFinite(a)||a<=0)continue;if(!Number.isFinite(i)||i<0)continue;const s=e.progress[n];(!s||a>s.total||a===s.total&&i>s.complete)&&(e.progress[n]={complete:i,total:a})}}}function On(e){const t=rn(0);for(const n of e)n.hasFrozen&&(t.F+=1),n.hasWet&&(t.W+=1),n.hasChilled&&(t.C+=1),(n.hasDawnlit||n.hasDawnbound)&&(t.D+=1),(n.hasAmberlit||n.hasAmberbound)&&(t.A+=1),n.hasRainbow&&(t.R+=1),n.hasGold&&(t.G+=1);return t}function Vn(e){return{D:e.filter(e=>e.hasDawnbound).length,A:e.filter(e=>e.hasAmberbound).length}}function _n(e,t){const n=[e.name,e.displayName,e.plantName,e.label],o=e.plant;if(o&&"object"==typeof o){const e=o;n.push(e.name),n.push(e.displayName)}for(const r of n)if("string"==typeof r){const e=r.trim();if(e.length>0)return e}return t&&t.length>0?t.toLowerCase().includes("plant")?t:`${t} Plant`:"Unknown Plant"}function Un(e){switch(e){case"rain":case"snow":case"dawn":case"amber":return e;case"sunny":return"sunny";default:return"unknown"}}const Xn=[{name:"Wet",category:"weather",multiplier:2,aliases:["Rainy"]},{name:"Chilled",category:"weather",multiplier:2},{name:"Frozen",category:"weather",multiplier:10}],Kn=[{name:"Dawnlit",category:"time",multiplier:2,aliases:["Dawn-lit"]},{name:"Dawnbound",category:"time",multiplier:3,aliases:["Dawn bound"]},{name:"Dawncharged",category:"time",multiplier:3,aliases:["Dawn charged"]},{name:"Amberlit",category:"time",multiplier:5,aliases:["Amber lit"]},{name:"Ambershine",category:"time",multiplier:5,aliases:["Amber shine"]},{name:"Amberbound",category:"time",multiplier:6,aliases:["Amber Radiant","Amberradiant","Amber-radiant","Amber radiant"]},{name:"Ambercharged",category:"time",multiplier:6,aliases:["Amber charged"]}],Jn=[{name:"Gold",category:"color",multiplier:25,aliases:["Golden"]},{name:"Rainbow",category:"color",multiplier:50},...Xn,...Kn],Qn=[Zn("Wet","Dawnlit",3),Zn("Chilled","Dawnlit",3),Zn("Wet","Amberlit",6),Zn("Chilled","Amberlit",6),Zn("Wet","Ambershine",6),Zn("Chilled","Ambershine",6),Zn("Frozen","Dawnlit",11),Zn("Frozen","Dawnbound",12),Zn("Frozen","Dawncharged",12),Zn("Frozen","Amberlit",14),Zn("Frozen","Ambershine",14),Zn("Frozen","Amberbound",15),Zn("Frozen","Ambercharged",15)],Yn=function(e){const t=new Map;for(const n of e)if(t.set(to(n.name),n),n.aliases)for(const e of n.aliases)t.set(to(e),n);return t}(Jn);function Zn(e,t,n){return{weather:eo(Xn,e),time:eo(Kn,t),multiplier:n}}function eo(e,t){const n=e.find(e=>e.name===t);if(!n)throw new Error(`Missing canonical mutation definition for ${t}`);return n}function to(e){return e.trim().toLowerCase().replace(/[^a-z0-9]/g,"")}function no(e){const t=oo(e);return t?t.name:null}function oo(e){if(!e)return null;const t=to(e);return t?Yn.get(t)??null:null}function ro(e){if(!e||0===e.length)return{color:null,weather:null,time:null,combo:null,totalMultiplier:1};const{colors:t,weathers:n,times:o}=function(e){const t=[],n=[],o=[],r=[];if(!e||0===e.length)return{colors:t,weathers:n,times:o,unknown:r};for(const i of e){const e=oo(i);if(!e){r.push(i);continue}const a={definition:e,sourceName:i};"color"===e.category?t.push(a):"weather"===e.category?n.push(a):o.push(a)}return{colors:t,weathers:n,times:o,unknown:r}}(e),r=io(t),i=io(n),a=io(o),s=i&&a?function(e,t){for(const n of Qn)if(n.weather===e&&n.time===t)return n;return null}(i.definition,a.definition):null,l=r?.definition.multiplier??1;let c=1;return s?c=s.multiplier:i&&a?c=Math.max(i.definition.multiplier,a.definition.multiplier):i?c=i.definition.multiplier:a&&(c=a.definition.multiplier),{color:r,weather:i,time:a,combo:s,totalMultiplier:l*c}}function io(e){return e.length?e.reduce((e,t)=>e?t.definition.multiplier>e.definition.multiplier?t:e:t,null):null}const ao={Sunflower:75e4,Starweaver:1e7,DawnCelestial:11e6,MoonCelestial:11e6,Lychee:5e4,DragonFruit:24500,PassionFruit:24500,Lemon:1e4,Pepper:7220,Grape:7085,Bamboo:5e5,Cactus:287e3,Mushroom:16e4,BurrosTail:6e3,Lily:20123,Banana:1750,Coconut:302,Echeveria:5520,Pumpkin:3700,Watermelon:2708,Corn:36,Daffodil:1090,Tomato:27,OrangeTulip:767,Apple:73,Blueberry:23,Aloe:310,Strawberry:14,Carrot:20};function so(e){return(new Intl.NumberFormat).format(Math.round(e))}function lo(e){const t=Math.abs(e),n=e<0?"-":"";return t>=1e12?`${n}${(t/1e12).toFixed(1)}T`:t>=1e9?`${n}${(t/1e9).toFixed(1)}B`:t>=1e6?`${n}${(t/1e6).toFixed(1)}M`:t>=1e3?`${n}${(t/1e3).toFixed(1)}K`:`${n}${Math.round(t)}`}function co(e,t=1,n,o=1){const r=ao[e];if(!r)return 0;const i=function(e){return e&&0!==e.length?ro(e).totalMultiplier:1}(n??[]);return Math.round(r*i*t*o)}function uo(e){return e.map(e=>({tileId:e.tileId,slotIndex:e.slotIndex,species:e.species,mutations:[...e.mutations]}))}const po=new Map;let mo="";"number"!=typeof b.devicePixelRatio||b.devicePixelRatio;let fo=[],go=null;function ho(){mo="",fo=[],go=null,po.clear()}b.document??document;const bo={Rainbow:{label:"Rainbow",highlightNames:["Rainbow"],canonicalNames:["Rainbow"]},Gold:{label:"Gold",highlightNames:["Gold"],canonicalNames:["Gold"]},Frozen:{label:"Frozen",highlightNames:["Frozen"],canonicalNames:["Frozen"]},Wet:{label:"Wet",highlightNames:["Wet"],canonicalNames:["Wet"]},Chilled:{label:"Chilled",highlightNames:["Chilled"],canonicalNames:["Chilled"]},Dawnlit:{label:"Dawnlit",highlightNames:["Dawnlit"],canonicalNames:["Dawnlit"]},Amberlit:{label:"Amberlit",highlightNames:["Amberlit","Ambershine"],canonicalNames:["Amberlit","Ambershine"]},Amberbound:{label:"Amberbound",highlightNames:["Amberbound","Ambercharged","Amber Radiant","Amberradiant","Amber-radiant"],canonicalNames:["Amberbound","Ambercharged"]},Dawnbound:{label:"Dawnbound (charged)",highlightNames:["Dawnbound","Dawncharged"],canonicalNames:["Dawnbound","Dawncharged"]}},yo=1.5,xo=new Set,wo=new Set,vo={enabled:!1,highlightEnabled:!0,toastEnabled:!0,minSize:80,selectedMutations:{Rainbow:!0,Gold:!1,Frozen:!1,Wet:!1,Chilled:!1,Dawnlit:!1,Amberlit:!1,Amberbound:!1,Dawnbound:!1}};let Co=!1,To=null,So={readyCount:0,mutatedCount:0,totalValue:0,highestValue:null,friendBonus:yo},Po=null,Ao="unknown",ko=[],Eo=new Set,$o=null;function Mo(e){if("boolean"==typeof e.enabled&&(vo.enabled=e.enabled),"boolean"==typeof e.highlightEnabled&&(vo.highlightEnabled=e.highlightEnabled,vo.highlightEnabled?ko.length>0&&Do(ko):jo()),"boolean"==typeof e.toastEnabled&&(vo.toastEnabled=e.toastEnabled),"number"==typeof e.minSize&&(vo.minSize=Math.min(100,Math.max(50,Math.round(e.minSize)))),e.selectedMutations)for(const t of Object.keys(bo)){const n=e.selectedMutations[t];"boolean"==typeof n&&(vo.selectedMutations[t]=n)}vo.enabled&&Io(),vo.enabled?zo():(ko=[],Eo.clear(),So={readyCount:0,mutatedCount:0,totalValue:0,highestValue:null,friendBonus:yo},Fo(),Ho())}function Fo(){for(const t of xo)try{t(So)}catch(e){s("‚ö†Ô∏è Harvest summary listener error",e)}}function Io(){ot(),Po||(Po=it(Lo,!0))}function Lo(e){const t=function(e){return"weather"===e.raw?"weather":"noweather"===e.raw?"noweather":"unknown"}(e);t!==Ao&&(Ao=t,"noweather"===Ao&&Eo.clear(),vo.enabled?zo():"noweather"!==Ao&&jo())}function zo(){if(!vo.enabled)return;const e=To??In();if(!e||!e.tileObjects)return Ro([]),void Ho();const t=function(e,t,n){const o=[];if(!e||!e.tileObjects)return o;for(const[r,i]of Object.entries(e.tileObjects)){if(!i||"object"!=typeof i)continue;const e=i;if("plant"!==e.objectType)continue;(Array.isArray(e.slots)?e.slots:[]).forEach((e,i)=>{const a="string"==typeof e?.species?e.species:null;if(!a)return;const s=e?.endTime??e?.readyAt??e?.harvestReadyAt,l="number"==typeof s?s:Number(s);if(!Number.isFinite(l)||l>n)return;const c=(Array.isArray(e?.mutations)?e.mutations:[]).filter(e=>"string"==typeof e);if(!qo(c,t))return;const d=e?.targetScale,u="number"==typeof d&&Number.isFinite(d)?d:1,p=Bo(u,a,e);if(p<vo.minSize)return;const m=ro(c),f=c.filter(e=>!no(e)),g=co(a,u,c,yo),h=`${r}:${i}`;o.push({key:h,tileId:r,slotIndex:i,species:a,mutations:c,size:p,value:g,multiplier:m,unknownMutations:f})})}return o.sort((e,t)=>t.value-e.value),o}(e,No(),Date.now());Ro(t),Do(t),function(e){if(!vo.toastEnabled)return;if(0===e.length)return;const t=e.filter(e=>!Eo.has(e.key));if(0===t.length)return;for(const r of t)Eo.add(r.key);const n=function(e){const{species:t,size:n,value:o,multiplier:r,mutations:i,unknownMutations:a}=e,s=Wo(r,a),l=Go(r.totalMultiplier),c=i.length?s:"No bonus mutations";return`üåæ ${t} ‚Äî ${c} ‚Üí total x${l} ‚Ä¢ size ${n} (~${so(o)} coins)`}(t[0]);for(const r of wo)try{r(n)}catch(o){s("‚ö†Ô∏è Harvest toast listener error",o)}try{window.queueNotification?.(n,!1)}catch(o){s("‚ö†Ô∏è Failed to queue harvest notification",o)}}(t)}function No(){return Object.keys(bo).filter(e=>vo.selectedMutations[e])}function qo(e,t){if(0===t.length)return!0;if(!e||0===e.length)return!1;const n=new Set;for(const o of e){const e=no(o);e&&n.add(e)}return 0!==n.size&&t.some(e=>bo[e].canonicalNames.some(e=>n.has(e)))}function Bo(e,t,n){const o=Number.isFinite(e)&&e>0?e:1;let r=null;if(n&&"object"==typeof n){const e=Number(n.maxScale);Number.isFinite(e)&&e>1&&(r=e)}if("number"!=typeof r||!Number.isFinite(r)||r<=1){const e=c(t);r=(e?p(e):null)??2}const i=Math.max(1.01,r),a=Math.min(i,Math.max(1,o)),s=50+50*(i>1?(a-1)/(i-1):0);return Math.round(s)}function Ro(e){if(ko=e,0===e.length)So={readyCount:0,mutatedCount:0,totalValue:0,highestValue:null,friendBonus:yo};else{const t=e[0];So={readyCount:e.length,mutatedCount:e.filter(e=>e.mutations.length>0).length,totalValue:e.reduce((e,t)=>e+t.value,0),highestValue:{species:t.species,value:t.value,mutations:t.mutations,size:t.size,multiplier:t.multiplier,breakdownText:Wo(t.multiplier,t.unknownMutations),totalMultiplierText:Go(t.multiplier.totalMultiplier),unknownMutations:t.unknownMutations},friendBonus:yo}}Fo()}function Do(e){if(!vo.highlightEnabled)return void Ho();const t=e.map(e=>e.key).join("|");if(t!==$o)if($o=t,0!==e.length){!function(e,t){try{{const n=e.map(e=>`${e.tileId}:${e.slotIndex}:${e.species}:${e.mutations.join(",")}`).join("|");return n!==mo&&(mo=n,fo=uo(e),go=t,0===e.length&&ho()),!0}}catch(n){return s("‚ö†Ô∏è Garden highlight overlay update failed",n),!1}}(e,To);try{const t=b.highlightTilesByMutation;if("function"!=typeof t)return;try{const e=b.removeAllTileOverrides;"function"==typeof e&&e.call(b)}catch(n){s("‚ö†Ô∏è Failed to clear previous highlights",n)}const o=Array.from(new Set(e.map(e=>e.species))),r=function(){const e=[];for(const t of No())e.push(...bo[t].highlightNames);return Array.from(new Set(e))}(),i=o.map(()=>r.length>0?r[0]:null),a={highlightSpecies:o,highlightMutations:i,slotIndex:0,highlightScale:null,hiddenSpecies:"Carrot",hiddenScale:.1};x("__qpmHarvestDebugConfig",{...a,attemptedMutations:r}),t.call(b,a);const l=b.setTimeout;l?.call(b,()=>{try{b.dispatchEvent?.(new Event("visibilitychange"))}catch(n){s("‚ö†Ô∏è Failed to nudge render after highlight",n)}},120)}catch(n){s("‚ö†Ô∏è Failed to apply harvest highlight",n)}}else Ho()}function Ho(){$o=null,jo()}function jo(){try{const e=b.removeAllTileOverrides;"function"==typeof e&&e.call(b)}catch(e){s("‚ö†Ô∏è Unable to clear harvest highlights",e)}ho()}function Wo(e,t){const n=[];if(e.color&&n.push(`${e.color.definition.name} x${Go(e.color.definition.multiplier)}`),e.combo?n.push(`${e.combo.weather.name} + ${e.combo.time.name} combo x${Go(e.combo.multiplier)}`):(e.weather&&n.push(`${e.weather.definition.name} x${Go(e.weather.definition.multiplier)}`),e.time&&n.push(`${e.time.definition.name} x${Go(e.time.definition.multiplier)}`)),n.length||1!==e.totalMultiplier||n.push("No bonus mutations"),t.length){const e=1===t.length?"1 unrecognized mutation":`${t.length} unrecognized mutations`;n.push(e)}return n.join(" + ")}function Go(e){return Number.isInteger(e)?e.toString():e.toFixed(2)}const Oo={worm:500,snail:1e3,bee:1500,chicken:3e3,bunny:750,dragonfly:250,pig:5e4,cow:25e3,squirrel:15e3,turtle:1e5,goat:2e4,butterfly:25e3,capybara:15e4,peacock:1e5},Vo=3e3;function _o(e){if(!e)return null;const t=function(e){return e.replace(/[^a-z0-9]/gi,"").toLowerCase()}(e);return t?Oo[t]??null:null}function Uo(e){return _o(e)??Vo}const Xo={Worm:12,Snail:12,Bee:12,Chicken:24,Bunny:24,Dragonfly:24,Pig:72,Cow:72,Turkey:72,Squirrel:100,Turtle:100,Goat:100,Butterfly:144,Peacock:144,Capybara:144};function Ko(e){if(!e)return null;const t=e.toLowerCase().trim();for(const[n,o]of Object.entries(Xo))if(n.toLowerCase()===t)return o;for(const[n,o]of Object.entries(Xo))if(t.includes(n.toLowerCase())||n.toLowerCase().includes(t))return o;return null}const Jo=new Map,Qo=new Set;function Yo(e){const t={currentLevel:null,maxLevel:30,confidence:"none",totalXPNeeded:null,xpGainRate:null};if(!e.petId||null==e.xp)return t;const n=Jo.get(e.petId);if(!n||n.length<2)return t;const o=function(e){if(e.length<2)return null;const t=e[0],n=e[e.length-1],o=n.xp-t.xp,r=(n.timestamp-t.timestamp)/1e3;return r<=0||o<=0?null:o/r}(n);if(!o)return t;const r=function(e){const t=Ko(e);return t?3600*t:null}(e.species);if(!r)return e.species&&!Qo.has(e.species)&&(Qo.add(e.species),s(`‚ö†Ô∏è No time-to-mature data for species: ${e.species}`)),{...t,xpGainRate:o};const i=o*r;let a=e.xp/i*30;a=Math.max(0,Math.min(30,a));const l=(n[n.length-1].timestamp-n[0].timestamp)/1e3;let c="low";return n.length>=5&&l>=300?c="high":n.length>=3&&l>=120&&(c="medium"),{currentLevel:Math.round(a),maxLevel:30,confidence:c,totalXPNeeded:i,xpGainRate:o}}let Zo=[],er=null,tr=!1;const nr=new Set;let or=null;function rr(e){if(null==e)return null;if("number"==typeof e)return Number.isFinite(e)?e:null;if("string"==typeof e){const t=e.match(/-?\d+(?:\.\d+)?/);if(!t)return null;const n=Number(t[0]);return Number.isFinite(n)?n:null}return"object"==typeof e?rr(e?.valueOf?.()):null}function ir(e){return Number.isFinite(e)?e<0?0:e>100?100:e:0}function ar(e,t=!1){if(!Number.isFinite(e))return null;if(e<0)return 0;if(e>0&&e<=1)return 100*e;if(e>=0&&e<=100)return e;if(t&&e>100&&e<=1e4){const t=e/100;if(t<=100)return t}return null}function sr(e){const t=e.slot??{},n=[e.name,e.displayName,t.name,t.displayName];for(const o of n)if("string"==typeof o&&o.trim().length>0)return o.trim();return null}function lr(e){if(!e)return[];if(Array.isArray(e))return e.filter(e=>!!e&&"object"==typeof e);if(e instanceof Map)return Array.from(e.values()).filter(e=>!!e&&"object"==typeof e);if(e instanceof Set)return Array.from(e.values()).filter(e=>!!e&&"object"==typeof e);if("object"==typeof e){const t=e,n=[];for(const[e,o]of Object.entries(t))/^\d+$/.test(e)&&o&&"object"==typeof o&&n.push(o);if(n.length)return n}return[]}function cr(e){const t=e.slot;return t&&"object"==typeof t?t:e}function dr(e){if(null==e)return null;if("string"==typeof e){const t=e.trim();return t.length>0?t:null}return"number"==typeof e&&Number.isFinite(e)?String(e):null}function ur(e){const t=new Set,n=[];for(const o of e){const e=o.toLowerCase();t.has(e)||(t.add(e),n.push(o))}return n}function pr(e){if(!e)return[];if("string"==typeof e){const t=dr(e);return t?[t]:[]}if(Array.isArray(e)){const t=[];for(const n of e){const e=dr(n);e&&t.push(e)}return t}return e instanceof Set?pr(Array.from(e.values())):[]}function mr(e){const t=cr(e),n=t.pet??e.pet??null,o=[e.slotId,t.slotId,t.slotID,t.id,n?.slotId,n?.id,e.id];for(const r of o){const e=dr(r);if(e)return e}return null}function fr(e){const t=cr(e),n=t.pet??e.pet??null,o=[e.petId,t.petId,n?.petId,n?.id,t.id,e.entityId];for(const r of o){const e=dr(r);if(e)return e}return mr(e)}function gr(e){const t=cr(e),n=t.pet??e.pet??null;return ur([...pr(e.mutations),...pr(t.mutations),...pr(n?.mutations)])}function hr(e){const t=cr(e),n=t.pet??e.pet??null;return ur([...pr(e.abilities),...pr(t.abilities),...pr(t.ability),...pr(n?.abilities)])}function br(e){const t=cr(e),n=[e.position,e.pos,t.position,t.pos];for(const o of n){if(!o||"object"!=typeof o)continue;const e=o,t=rr(e.x??e.X??e.left??e.posX??e.longitude),n=rr(e.y??e.Y??e.top??e.posY??e.latitude);if(null!=t||null!=n)return{x:t??null,y:n??null}}return null}function yr(e){const t=function(e){const t=[e],n=new Set;for(;t.length;){const e=t.shift();if(null==e)continue;const o=lr(e);if(o.length)return o;if("object"==typeof e){if(n.has(e))continue;if(n.add(e),e instanceof Map){for(const n of e.values())t.push(n);continue}if(e instanceof Set){for(const n of e.values())t.push(n);continue}const o=e;for(const e of Object.values(o))t.push(e)}}return[]}(e);if(!t.length)return[];const n=Date.now(),o=[],r=function(){const e=[];try{const t=document.querySelectorAll("p.chakra-text.css-1jrst1o");for(const n of t){const t=(n.textContent||"").match(/\bSTR\s+(\d+)\b/i);if(t&&t[1]){const n=parseInt(t[1],10);e.includes(n)||e.push(n)}}}catch(t){}return e}();return t.forEach((e,t)=>{if(!e||"object"!=typeof e)return;const i=e,a=cr(i),s=a.stats??void 0,l=a.pet??i.pet??void 0,c=function(e,t){const n=[e.slotIndex,e.slot?.slotIndex,e.order,e.index,e.slot?.index,e.slot?.originalIndex,e.slot?.orderedIndex,t];for(const o of n){const e=rr(o);if(null!=e&&Number.isFinite(e))return Math.max(0,Math.round(e))}return t}(i,t),d=function(e){const t=e.slot??{},n=[e.species,t.species,t.petSpecies,e.petSpecies];for(const o of n)if("string"==typeof o&&o.trim().length>0)return o.trim();return null}(i),u=function(e,t,n,o){const r=t.pet??e.pet??null,i=[{value:e.hungerPct,hint:"entry.hungerPct"},{value:e.hunger_percentage,hint:"entry.hunger_percentage"},{value:e.hunger,hint:"entry.hunger"},{value:t.hungerPct,hint:"slot.hungerPct"},{value:t.hunger_percentage,hint:"slot.hunger_percentage"},{value:t.hunger,hint:"slot.hunger"},{value:n?.hungerPct,hint:"stats.hungerPct"},{value:n?.hunger,hint:"stats.hunger"},{value:r?.hungerPct,hint:"nested.hungerPct"},{value:r?.hunger,hint:"nested.hunger"}];let a=null;const s=[],l=[];for(const{value:u,hint:p}of i){if(null==u)continue;null==a&&(a=String(u));const e=rr(u);if(null==e)continue;const t=/pct|percent/i.test(p),n=ar(e,t);null!=n&&(t||e<=100)?s.push(n):l.push(e)}const c=l.length>0?l[0]:null,d=o?_o(o):null;if(s.length)return{pct:ir(s[0]),value:c,max:d,raw:a};if(null!=c)return null!=d&&d>0?{pct:ir(c/d*100),value:c,max:d,raw:a}:c>0?{pct:ir(c/Vo*100),value:c,max:Vo,raw:a}:{pct:0,value:c,max:d,raw:a};return{pct:null,value:null,max:d,raw:a}}(i,a,s,d),p=[a.xp,s?.xp,i.xp];let m=null;for(const n of p){const e=rr(n);if(null!=e){m=e;break}}const f=[a.level,s?.level,i.level,l?.level];let g=null,h=null;for(const n of f){null!=n&&null==h&&(h="string"==typeof n?n:String(n));const e=rr(n);if(null!=e){g=Math.max(0,Math.round(e));break}}const b=[a.strength,s?.strength,i.strength];let y=null;for(const n of b){const e=rr(n);if(null!=e){y=e;break}}null==y&&c<r.length&&(y=r[c]??null);const x=[a.targetScale,s?.targetScale,i.targetScale,l?.targetScale];let w=null;for(const n of x){const e=rr(n);if(null!=e){w=e;break}}const v={slotIndex:c,slotId:mr(i),petId:fr(i),hungerPct:u.pct,hungerValue:u.value,hungerMax:u.max,hungerRaw:u.raw,name:sr(i),species:d,targetScale:w,mutations:gr(i),abilities:hr(i),xp:m,level:g,levelRaw:h,strength:y,position:br(i),updatedAt:n,raw:e};if(null==v.level&&null!=v.xp&&v.petId){!function(e){if(!e.petId||null==e.xp)return;const t=Date.now();let n=Jo.get(e.petId);n||(n=[],Jo.set(e.petId,n)),n.push({xp:e.xp,timestamp:t}),n.length>10&&n.shift()}(v);const e=Yo(v);null!=e.currentLevel&&(v.level=e.currentLevel)}o.push(v)}),o.sort((e,t)=>e.slotIndex-t.slotIndex)}async function xr(){if(!er&&!tr){tr=!0;try{const e=F("myPetInfosAtom");if(!e)throw new Error("myPetInfosAtom not found in jotai cache");er=await L(e,e=>{Zo=yr(e),function(){for(const t of nr)try{t(Zo)}catch(e){s("‚ö†Ô∏è Pet info listener threw",e)}}()}),null!=or&&(window.clearTimeout(or),or=null)}catch(e){s("‚ö†Ô∏è Failed to start pet info store",e),null==or&&(or=window.setTimeout(()=>{or=null,er||xr()},1500))}finally{tr=!1}}}function wr(){return Zo}function vr(){return Zo}function Cr(e,t=!0){if(nr.add(e),t)try{e(Zo)}catch(n){s("‚ö†Ô∏è Pet info immediate callback failed",n)}return()=>{nr.delete(e)}}const Tr=/myCurrentGrowSlotIndex/i;let Sr=!1,Pr=!1,Ar=null,kr=null;const Er=new Set;function $r(e){const t="number"==typeof(n=e)&&Number.isFinite(n)?Math.max(0,Math.trunc(n)):null;var n;if(Ar!==t){Ar=t;try{b.__qpmCurrentGrowSlotIndex=t,"undefined"!=typeof window&&(window.__qpmCurrentGrowSlotIndex=t)}catch{}!function(e){for(const n of Er)try{n(e)}catch(t){s("‚ö†Ô∏è Grow slot index listener error",t)}}(Ar)}}async function Mr(){try{await $()}catch(t){throw s("‚ö†Ô∏è Grow slot index tracker: jotai store unavailable",t),t}const e=await async function(){let e=F("myCurrentGrowSlotIndexAtom");return e||(M(Tr)[0]??null)}();if(!e)throw new Error("myCurrentGrowSlotIndexAtom not found");try{$r(await I(e).catch(()=>null))}catch(t){s("‚ö†Ô∏è Grow slot index tracker: failed to read initial value",t)}await L(e,e=>{$r(e)})}async function Fr(){if(!Sr&&!Pr){Pr=!0;try{await Mr(),Sr=!0}catch(e){return s("‚ö†Ô∏è Grow slot index tracker initialization failed",e),void(null==kr&&"undefined"!=typeof window&&(kr=window.setTimeout(()=>{kr=null,Pr=!1,Fr()},2500)))}finally{Pr=!1}}}const Ir="qpm-turtle-manual-overrides";let Lr={};function zr(){try{f.set(Ir,Lr)}catch(e){s("‚ö†Ô∏è Failed to save manual pet overrides",e)}}function Nr(e){return e.petId?`pet:${e.petId}`:e.species?`${e.species}:${e.slotIndex}`:`slot:${e.slotIndex}`}const qr=[{kind:"plant",patterns:["plantgrowthboost"],minutesPerBase:5,procOdds:.27},{kind:"egg",patterns:["egggrowthboost"],minutesPerBase:9,procOdds:.24}],Br={restore:["hungerrestore"],slow:["hungerboost"]},Rr=[0,30,35,40,45],Dr=[0,.12,.14,.16,.18],Hr=[0,12,16,20,24];function jr(e,t,n){const o=function(e,t){const n=e.match(/\b(IV|III|II|I)\b/i);if(n)switch(n[1].toUpperCase()){case"I":return 1;case"II":return 2;case"III":return 3;case"IV":return 4}const o=e.match(/\b(\d+)\b/);if(o){const e=Number.parseInt(o[1],10);if(Number.isFinite(e)&&e>0)return e}return t.endsWith("iv")?4:t.endsWith("iii")?3:t.endsWith("ii")?2:1}(t,n);if("restore"===e){return{effectPct:Rr[Math.min(o,Rr.length-1)]??Rr[1],procOdds:Dr[Math.min(o,Dr.length-1)]??Dr[1]}}if("slow"===e){return{effectPct:Hr[Math.min(o,Hr.length-1)]??Hr[1],procOdds:null}}return null}function Wr(e,t){if(!t||t<=0||e<=0)return 0;const n=Math.min(.95,Math.max(0,t*(e/100)));return 60*(1-Math.pow(1-n,1/60))}function Gr(e){if(!e)return!1;const t=e.toLowerCase();return!t.includes("eggplant")&&t.includes("egg")}function Or(e){if(!e)return!1;const t=e.toLowerCase();return t.includes("plant")||t.includes("crop")}function Vr(e){return!!Gr(e.objectType)||(!!Gr(e.slotType)||(!!Gr(e.slotCategory)||(!!Gr(e.slotKind)||(!!Gr(e.tileObjectType)||(!!Gr(e.tileCategory)||(!!Gr(e.seedSpecies)||(!!Gr(e.plantSpecies)||(!!Gr(e.eggId)||(!!Gr(e.eggSpecies)||function(e){if(!e)return!1;const t=e.toLowerCase();return!t.includes("eggplant")&&/\begg\b/.test(t)}(e.species))))))))))}const _r="::";let Ur={enabled:!0,includeBoardwalk:!0,minActiveHungerPct:2,fallbackTargetScale:1.5,focus:"latest",maxTargetScale:2.5,focusTargetTileId:null,focusTargetSlotIndex:null,eggFocus:"latest",eggFocusTargetTileId:null,eggFocusTargetSlotIndex:null},Xr=!1,Kr=In(),Jr=vr();const Qr=new Set;function Yr(e){return e.toLowerCase().replace(/[^a-z0-9]/g,"")}function Zr(e="no-data"){return{status:e,trackedSlots:0,growingSlots:0,maturedSlots:0,contributions:[],expectedMinutesRemoved:null,effectiveRate:null,naturalMsRemaining:null,adjustedMsRemaining:null,minutesSaved:null,focusSlot:null}}function ei(){return{enabled:Ur.enabled,now:Date.now(),includeBoardwalk:Ur.includeBoardwalk,focus:Ur.focus,focusTargetKey:null,focusTargetAvailable:!1,eggFocus:Ur.eggFocus,eggFocusTargetKey:null,eggFocusTargetAvailable:!1,minActiveHungerPct:Ur.minActiveHungerPct,fallbackTargetScale:Ur.fallbackTargetScale,availableTurtles:0,hungerFilteredCount:0,turtlesMissingStats:0,plant:Zr(),plantTargets:[],egg:Zr(),eggTargets:[],support:{restoreCount:0,restoreActiveCount:0,slowCount:0,slowActiveCount:0,restorePctTotal:0,restorePctActive:0,restorePctPerHourTotal:0,restorePctPerHourActive:0,restoreTriggersPerHourTotal:0,restoreTriggersPerHourActive:0,slowPctTotal:0,slowPctActive:0,entries:[]}}}function ti(e,t){return e&&null!=t?`${e}${_r}${t}`:null}let ni=ei();function oi(e){if("number"==typeof e&&Number.isFinite(e))return e;if("string"==typeof e){const t=Number(e);if(Number.isFinite(t))return t}return null}function ri(e,t){const n=[];if(!e)return n;const o=(e,t)=>{for(const n of t){const t=e[n];if("string"==typeof t&&t.trim().length>0)return t}return null},r=(e,t)=>{if("number"==typeof e&&Number.isFinite(e))return e;if("string"==typeof e){const t=Number(e);if(Number.isFinite(t))return t}return t},i=(e,t,n,i,a)=>{const s=r(n.slotIndex,r(a.slotIndex,i)),l=oi(n.endTime??n.maturedAt??n.readyAt??n.harvestReadyAt??n.finishAt??a.endTime??a.maturedAt??a.readyAt??a.harvestReadyAt??a.finishAt),c=oi(n.readyAt??n.maturedAt??n.harvestReadyAt??n.endTime??a.readyAt??a.maturedAt??a.harvestReadyAt??a.endTime),d=oi(n.plantedAt??n.startTime??n.startedAt??a.plantedAt??a.startTime??a.startedAt),u=o(a,["objectType","object_type"]),p=o(a,["slotCategory","category","slot_category"]),m=o(n,["objectType","object_type"])??u,f=o(n,["type","slotType","slot_type"]),g=o(n,["category","slotCategory","slot_category"]),h=o(n,["kind"]),b={tileId:e,slotIndex:s,species:o(n,["species","seedSpecies","plantSpecies","petSpecies"])??o(a,["species","seedSpecies","plantSpecies","petSpecies"]),seedSpecies:o(n,["seedSpecies"])??o(a,["seedSpecies"]),plantSpecies:o(n,["plantSpecies"])??o(a,["plantSpecies"]),eggId:o(n,["eggId","eggID"])??o(a,["eggId","eggID"]),eggSpecies:o(n,["eggSpecies","eggType"])??o(a,["eggSpecies","eggType"]),boardwalk:t,endTime:l,readyAt:c,plantedAt:d,slotType:f,slotCategory:g,objectType:m,tileObjectType:u,tileCategory:p,slotKind:h};return(e=>!!(Or(e.objectType)||Or(e.tileObjectType)||Or(e.slotType)||Or(e.slotCategory)||Or(e.tileCategory)||Gr(e.objectType)||Gr(e.slotType)||Gr(e.slotCategory)||Gr(e.slotKind)||Gr(e.tileObjectType)||Gr(e.tileCategory)||Gr(e.species)||Gr(e.seedSpecies)||Gr(e.plantSpecies)||Gr(e.eggId)||Gr(e.eggSpecies)||e.species||e.seedSpecies||e.plantSpecies||null!=e.endTime||null!=e.readyAt||null!=e.plantedAt))(b)?b:null},a=(e,t)=>{if(!e||"object"!=typeof e)return;const o=Object.entries(e);for(const[r,a]of o){if(!a||"object"!=typeof a)continue;const e=a,o=Array.isArray(e.slots)?e.slots:[];let s=!1;if(o.forEach((o,a)=>{if(!o||"object"!=typeof o)return;const l=i(r,t,o,a,e);l&&(n.push(l),s=!0)}),!s){const o=i(r,t,e,0,e);o&&n.push(o)}}};return a(e.tileObjects??null,!1),t&&a(e.boardwalkTileObjects??null,!0),n}function ii(e){const t=function(e){const t=Nr(e);return Lr[t]??null}(e);let n="number"==typeof e.xp&&Number.isFinite(e.xp)?e.xp:null;null==n&&null!=t?.xp&&(n=t.xp);let o=e.targetScale;null==o&&null!=t?.targetScale&&(o=t.targetScale);const r="number"==typeof(i=o)&&Number.isFinite(i)?i<1?1:i>Ur.maxTargetScale?Ur.maxTargetScale:i:Ur.fallbackTargetScale;var i;let a="number"==typeof e.strength&&Number.isFinite(e.strength)?e.strength:null;null==a&&null!=t?.strength&&(a=t.strength);const s=null==e.xp||null==e.targetScale,l=t&&(null!=t.xp||null!=t.targetScale||null!=t.strength);let c;if(null!=a)c=Math.max(0,a);else{const e=Math.min(Math.floor((n??0)/36e4*30),30),t=Math.floor((r-1)/(Ur.maxTargetScale-1)*20+80)-30;c=Math.max(0,e+t)}return{xp:n,targetScale:r,baseScore:c,missingStats:s&&!l}}function ai(e,t,n){const o=ii(e),{xp:r,targetScale:i,baseScore:a,missingStats:s}=o,l=a>0?a/100*t.minutesPerBase*60*(1-Math.pow(1-t.procOdds*a/100,1/60)):0,c=60*l;return{ability:t.kind,abilityNames:n,slotIndex:e.slotIndex,name:e.name,species:e.species,hungerPct:e.hungerPct,xp:r,targetScale:i,baseScore:a,rateContribution:l,perHourReduction:c,missingStats:s}}function si(e,t,n,o,r,i,a,s){const l=t.filter(e=>null!=e.endTime).length,c=t.filter(e=>null!=e.endTime&&e.endTime>o).length,d=t.filter(e=>null!=e.endTime&&e.endTime<=o).length,u={status:"no-data",trackedSlots:l,growingSlots:c,maturedSlots:d,contributions:n.slice().sort((e,t)=>t.rateContribution-e.rateContribution),expectedMinutesRemoved:null,effectiveRate:null,naturalMsRemaining:null,adjustedMsRemaining:null,minutesSaved:null,focusSlot:null};if(0===t.length||0===l)return u;if(0===c)return{...u,status:"egg"===e?"no-eggs":"no-crops"};const p=function(e,t,n,o,r){const i=e.filter(e=>null!=e.endTime&&e.endTime>r);if(!i.length)return null;if("specific"===t){if(n&&null!=o){const e=i.find(e=>e.tileId===n&&e.slotIndex===o);if(e)return e}return null}return"earliest"===t?i.reduce((e,t)=>e?(t.endTime??1/0)<(e.endTime??1/0)?t:e:t,i[0]):i.reduce((e,t)=>e?(t.endTime??-1/0)>(e.endTime??-1/0)?t:e:t,i[0])}(t,i,a,s,o);if(!p||null==p.endTime)return{...u,status:"no-data"};const m=Math.max(0,p.endTime-o),f=m/6e4,g=n.reduce((e,t)=>e+t.rateContribution,0),h=Number.isFinite(g)&&g>0,b=h?g:0,y=h?Math.max(.01,1+b):1,x=f/Math.max(.01,y),w=6e4*x,v=h?Math.max(0,f-x):null;return{status:h?"estimating":"no-turtles",trackedSlots:l,growingSlots:c,maturedSlots:d,contributions:u.contributions,expectedMinutesRemoved:h?b:null,effectiveRate:h?y:null,naturalMsRemaining:m,adjustedMsRemaining:h?w:m,minutesSaved:v,focusSlot:{...p,remainingMs:m}}}function li(e){return e.petId??e.slotId??`${e.slotIndex}-${e.name??"pet"}`}function ci(e){ni=e;for(const n of Qr)try{n(ni)}catch(t){s("‚ö†Ô∏è Turtle timer listener error",t)}}function di(){const e=Date.now(),t=ei();if(t.now=e,!Ur.enabled)return t.enabled=!1,t.plant.status="disabled",t.egg.status="disabled",void ci(t);const n=ri(Kr,Ur.includeBoardwalk),o=n.filter(e=>Vr(e)),r=n.filter(e=>!Vr(e)),i=[],a=[],s=[],l=new Set,c=new Set,d=new Set;for(const F of Jr){if(!F||"object"!=typeof F)continue;const e=Array.isArray(F.abilities)?F.abilities.filter(e=>"string"==typeof e&&e.trim().length>0).map(e=>({raw:e,normalized:Yr(e)})):[];if(0===e.length)continue;const t=li(F),n=F.hungerPct,o=null==n||n>Ur.minActiveHungerPct;let r=!1;for(const s of qr){const n=e.filter(({normalized:e})=>s.patterns.some(t=>e.includes(t))).map(({raw:e})=>e);if(0===n.length)continue;if(r=!0,l.add(t),!o){c.add(t);continue}const u=ai(F,s,n);u.missingStats&&d.add(t),u.rateContribution<=0||("plant"===s.kind?i.push(u):a.push(u))}const u=ii(F);for(const i of Object.keys(Br)){const t=e.filter(({normalized:e})=>Br[i].some(t=>e.includes(t))).map(({raw:e})=>e);if(0===t.length)continue;const r=[];let a=0,l=0,c=0,d=0;for(const e of t){const t=Yr(e),n=jr(i,e,t);if(n)if("restore"===i){const o=Wr(u.baseScore,n.procOdds),i=60*o,s=i*n.effectPct;a+=n.effectPct,l+=s,c+=i,r.push({abilityName:e,normalizedName:t,perTriggerPct:n.effectPct,slowdownPct:null,triggersPerHour:i,pctPerHour:s,probabilityPerMinute:o})}else d+=n.effectPct,r.push({abilityName:e,normalizedName:t,perTriggerPct:null,slowdownPct:n.effectPct,triggersPerHour:null,pctPerHour:null,probabilityPerMinute:null})}0!==r.length&&s.push({type:i,abilityNames:t,slotIndex:F.slotIndex,name:F.name,species:F.species,hungerPct:n,active:o,xp:u.xp,targetScale:u.targetScale,baseScore:u.baseScore,missingStats:u.missingStats,abilityDetails:r,totalRestorePerTriggerPct:a,totalRestorePerHourPct:l,totalTriggersPerHour:c,totalSlowPct:d})}r||o||c.add(t)}const u=Ur.focusTargetTileId,p=Ur.focusTargetSlotIndex,m=si("plant",r,i,e,0,Ur.focus,u,p),f=Ur.eggFocusTargetTileId,g=Ur.eggFocusTargetSlotIndex,h=si("egg",o,a,e,0,Ur.eggFocus,f,g);let b=0,y=0,x=0,w=0,v=0,C=0,T=0,S=0,P=0,A=0,k=0,E=0;s.sort((e,t)=>e.type===t.type?e.active===t.active?(e.name??"").localeCompare(t.name??""):e.active?-1:1:"restore"===e.type?-1:1);for(const F of s)"restore"===F.type?(b+=1,v+=F.totalRestorePerTriggerPct,T+=F.totalRestorePerHourPct,P+=F.totalTriggersPerHour,F.active&&(y+=1,C+=F.totalRestorePerTriggerPct,S+=F.totalRestorePerHourPct,A+=F.totalTriggersPerHour)):(x+=1,k+=F.totalSlowPct,F.active&&(w+=1,E+=F.totalSlowPct));t.enabled=!0,t.includeBoardwalk=Ur.includeBoardwalk,t.focus=Ur.focus,t.eggFocus=Ur.eggFocus;const $=r.filter(t=>null!=t.endTime&&t.endTime>e).map(t=>({key:ti(t.tileId,t.slotIndex)??`${t.tileId}${_r}${t.slotIndex}`,tileId:t.tileId,slotIndex:t.slotIndex,species:t.species??t.seedSpecies??t.plantSpecies,boardwalk:t.boardwalk,endTime:t.endTime??null,remainingMs:null!=t.endTime?Math.max(0,t.endTime-e):null}));t.plantTargets=$,t.focusTargetKey=ti(u,p),t.focusTargetAvailable=null!=t.focusTargetKey&&$.some(e=>e.key===t.focusTargetKey);const M=o.filter(t=>null!=t.endTime&&t.endTime>e).map(t=>({key:ti(t.tileId,t.slotIndex)??`${t.tileId}${_r}${t.slotIndex}`,tileId:t.tileId,slotIndex:t.slotIndex,species:t.eggSpecies??t.eggId??t.species,boardwalk:t.boardwalk,endTime:t.endTime??null,remainingMs:null!=t.endTime?Math.max(0,t.endTime-e):null}));t.eggTargets=M,t.eggFocusTargetKey=ti(f,g),t.eggFocusTargetAvailable=null!=t.eggFocusTargetKey&&M.some(e=>e.key===t.eggFocusTargetKey),t.minActiveHungerPct=Ur.minActiveHungerPct,t.fallbackTargetScale=Ur.fallbackTargetScale,t.availableTurtles=l.size,t.hungerFilteredCount=c.size,t.turtlesMissingStats=d.size,t.plant=m,t.egg=h,t.support={restoreCount:b,restoreActiveCount:y,slowCount:x,slowActiveCount:w,restorePctTotal:v,restorePctActive:C,restorePctPerHourTotal:T,restorePctPerHourActive:S,restoreTriggersPerHourTotal:P,restoreTriggersPerHourActive:A,slowPctTotal:k,slowPctActive:E,entries:s},ci(t)}function ui(e){if(e){if("boolean"==typeof e.enabled&&(Ur.enabled=e.enabled),"boolean"==typeof e.includeBoardwalk&&(Ur.includeBoardwalk=e.includeBoardwalk),"number"==typeof e.minActiveHungerPct&&Number.isFinite(e.minActiveHungerPct)){const t=Math.max(0,Math.min(100,Math.round(e.minActiveHungerPct)));Ur.minActiveHungerPct=t}if("number"==typeof e.fallbackTargetScale&&Number.isFinite(e.fallbackTargetScale)){const t=Math.max(1,Math.min(Ur.maxTargetScale,e.fallbackTargetScale));Ur.fallbackTargetScale=t}"latest"!==e.focus&&"earliest"!==e.focus&&"specific"!==e.focus||(Ur.focus=e.focus),"string"!=typeof e.focusTargetTileId&&null!==e.focusTargetTileId||(Ur.focusTargetTileId=e.focusTargetTileId??null),"number"==typeof e.focusTargetSlotIndex&&Number.isFinite(e.focusTargetSlotIndex)?Ur.focusTargetSlotIndex=Math.max(0,Math.round(e.focusTargetSlotIndex)):null===e.focusTargetSlotIndex&&(Ur.focusTargetSlotIndex=null),"latest"!==e.eggFocus&&"earliest"!==e.eggFocus&&"specific"!==e.eggFocus||(Ur.eggFocus=e.eggFocus),"string"!=typeof e.eggFocusTargetTileId&&null!==e.eggFocusTargetTileId||(Ur.eggFocusTargetTileId=e.eggFocusTargetTileId??null),"number"==typeof e.eggFocusTargetSlotIndex&&Number.isFinite(e.eggFocusTargetSlotIndex)?Ur.eggFocusTargetSlotIndex=Math.max(0,Math.round(e.eggFocusTargetSlotIndex)):null===e.eggFocusTargetSlotIndex&&(Ur.eggFocusTargetSlotIndex=null)}}function pi(e){if(Xr)e&&mi(e);else{Xr=!0,function(){try{const e=f.get(Ir,null);e&&"object"==typeof e&&(Lr=e)}catch(e){s("‚ö†Ô∏è Failed to load manual pet overrides",e)}}(),ui(e);try{const e=e=>function(e){const t=Ur.includeBoardwalk,n=e?.focusTileId??null,o=Math.max(1,Math.floor(e?.limit??10)),r=ri(Kr??null,t).filter(e=>!n||e.tileId===n).map(e=>({tileId:e.tileId,slotIndex:e.slotIndex,boardwalk:e.boardwalk,species:e.species,seedSpecies:e.seedSpecies,plantSpecies:e.plantSpecies,eggId:e.eggId,eggSpecies:e.eggSpecies,slotType:e.slotType,slotCategory:e.slotCategory,objectType:e.objectType,tileObjectType:e.tileObjectType,tileCategory:e.tileCategory,slotKind:e.slotKind,endTime:e.endTime,readyAt:e.readyAt,plantedAt:e.plantedAt,isEgg:Vr(e)})),i=r.filter(e=>e.isEgg);if(console.log("[TurtleTimer] Egg detection snapshot",{totalSlots:r.length,eggSlots:i.length,includeBoardwalk:t,focusTileId:n}),"function"==typeof console.table?console.table(r):r.forEach(e=>console.log(e)),e?.includeRaw&&i.length>0){const e=Kr??null,t=(t,n)=>{if(!e||"object"!=typeof e)return null;const o=n?e.boardwalkTileObjects:e.tileObjects;if(!o||"object"!=typeof o)return null;const r=o[t];return r&&"object"==typeof r?r:null},n=(e,t)=>{if(!e)return null;const n=e.slots;if(Array.isArray(n)){return n[t]??null}return e};i.slice(0,o).forEach((e,r)=>{const a=t(e.tileId,e.boardwalk),s=n(a,e.slotIndex);console.log(`[TurtleTimer] Raw egg ${r+1}/${Math.min(o,i.length)}`,{tileId:e.tileId,boardwalk:e.boardwalk,rawTile:a,rawSlot:s})})}}(e);b.debugEggDetection=e,"undefined"!=typeof window&&window!==b&&(window.debugEggDetection=e)}catch(t){s("‚ö†Ô∏è Unable to attach debugEggDetection helper",t)}Fr().catch(e=>{s("‚ö†Ô∏è Failed to start grow slot index tracker",e)}),xr(),Ln(e=>{Kr=e,di()}),Cr(e=>{Jr=e,di()}),di(),s("üê¢ Turtle timer ready")}}function mi(e){ui(e),di()}function fi(e){mi({enabled:e})}function gi(){di()}function hi(){return ni}function bi(e,t=!0){if(Qr.add(e),t)try{e(ni)}catch(n){s("‚ö†Ô∏è Turtle timer immediate listener error",n)}return()=>{Qr.delete(e)}}const yi=[],xi=new Set;let wi=0;function vi(){const e=yi.slice();for(const n of xi)try{n(e)}catch(t){console.error("[notifications] subscriber error",t)}}function Ci(e){const t={...e,id:`notif-${Date.now()}-${++wi}`,timestamp:Date.now()};return yi.push(t),yi.length>100&&yi.splice(0,yi.length-100),vi(),t}function Ti(e){xi.add(e);try{e(yi.slice())}catch(t){console.error("[notifications] initial subscriber error",t)}return()=>{xi.delete(e)}}function Si(){return"undefined"!=typeof unsafeWindow&&unsafeWindow?unsafeWindow:window}const Pi=new Map;let Ai=!1;const ki=new Set,Ei=[/\/assets\/(tiles|plants|allplants|pets|animals|sprites|atlas)\//i,/(plants?|crops?|pet|animal|creature|mob|atlas|sheet)\.(png|webp)$/i],$i=/(pet|animal|creature|mob)/i,Mi=/(plant|crop|tile)/i,Fi={bee:0,chicken:1,bunny:2,turtle:3,capybara:4,cow:5,pig:6,butterfly:7,snail:8,worm:9,commonegg:10,uncommonegg:11,rareegg:12,legendaryegg:13,mythicalegg:14,divineegg:15,celestialegg:16,squirrel:17,goat:18,dragonfly:19,turkey:28,peacock:29},Ii={gold:35,rainbow:44};function Li(e){if(!e)return"";const t=e.split("#")[0]||e;if(t.startsWith("data:")||t.startsWith("blob:"))return t;try{if("undefined"!=typeof window){const e=new URL(t,window.location.href);return e.hash="",e.href}}catch{}return t}function zi(){return new(Si().Image??Image)}function Ni(e){return new Promise((t,n)=>{try{const o=zi();o.crossOrigin="anonymous",o.onload=()=>t(o),o.onerror=e=>n(e),o.src=e}catch(o){n(o)}})}function qi(e,t){if("undefined"==typeof window||!e)return;const n=Li(String(e));if(!n||(o=n,!Ei.some(e=>e.test(o))))return;var o;const r=Pi.get(n),i=function(e){return $i.test(e)?"pets":Mi.test(e)?"plants":"unknown"}(n);if(r)return r.sources.add(t),r.lastSeen=Date.now(),void("unknown"===r.category&&"unknown"!==i&&(r.category=i));Pi.set(n,{url:n,sources:new Set([t]),lastSeen:Date.now(),category:i})}function Bi(e="all"){const t=Array.from(Pi.values());return("all"===e?t:t.filter(t=>t.category===e)).sort((e,t)=>t.lastSeen-e.lastSeen).map(e=>({url:e.url,sources:Array.from(e.sources),lastSeen:e.lastSeen,category:e.category}))}function Ri(){if(Ai)return;const e=Si(),t=Si().document||null;if(!e||!t)return;Ai=!0;const n=e.performance??performance;if(n&&"function"==typeof n.getEntriesByType)try{n.getEntriesByType("resource").forEach(e=>qi(e.name,"perf.initial"))}catch(i){s("‚ö†Ô∏è Failed to read initial performance entries for sprite sniffing",i)}const o=e.PerformanceObserver??PerformanceObserver;if(void 0!==o)try{new o(e=>{e.getEntries().forEach(e=>{const t=e.name;t&&qi(t,"perf.observer")})}).observe({entryTypes:["resource"]})}catch(i){s("‚ö†Ô∏è Failed to start sprite PerformanceObserver",i)}const r=e.HTMLImageElement??HTMLImageElement;if(r)try{const e=Object.getOwnPropertyDescriptor(r.prototype,"src");if(e&&"function"==typeof e.set){const t=e.set,n={configurable:e.configurable??!0,enumerable:e.enumerable??!1};e.get&&(n.get=e.get.bind(r.prototype)),n.set=function(e){return"string"==typeof e&&qi(e,"img.src"),t.call(this,e)},Object.defineProperty(r.prototype,"src",n)}}catch(i){s("‚ö†Ô∏è Failed to hook HTMLImageElement.src for sprite sniffing",i)}if(r)try{const e=r.prototype.setAttribute;r.prototype.setAttribute=function(t,n){return"string"==typeof t&&"src"===t.toLowerCase()&&"string"==typeof n&&qi(n,"img.setAttribute"),e.call(this,t,n)}}catch(i){s("‚ö†Ô∏è Failed to hook HTMLImageElement.setAttribute for sprite sniffing",i)}}const Di=new class{constructor(){this.sheets=new Map,this.tiles=new Map,this.initialized=!1,this.scanInterval=null}init(){this.initialized||(this.initialized=!0,Ri(),s("üñºÔ∏è Initializing sprite extractor (waiting for game)..."),this.waitForPixi())}async waitForPixi(){s('dY"? Looking for game sprite sheets...');if(!(await(async()=>{for(let e=0;e<60;e++){const e=document.querySelector("canvas");if(e)return e;await new Promise(e=>setTimeout(e,500))}return null})()))return void s("ÔøΩsÔøΩÔøΩ,? Canvas not found");await new Promise(e=>setTimeout(e,3e3));let e=null,t=null,n=null;const o=Si().performance??performance;if(o&&"function"==typeof o.getEntriesByType){const r=o.getEntriesByType("resource"),i=r.find(e=>e.name.includes("/assets/tiles/plants.png"));i&&(e=i.name);const a=r.find(e=>e.name.toLowerCase().includes("/assets/tiles/pets.png"));a&&(t=a.name);const s=r.find(e=>e.name.toLowerCase().includes("/assets/tiles/mutation-overlays.png"));s&&(n=s.name)}e||(e="https://magicgarden.gg/version/19aaa98/assets/tiles/plants.png",s("  Using default plants.png URL")),t||(t="https://magicgarden.gg/version/19aaa98/assets/tiles/pets.png",s("  Using default pets.png URL")),n||(n="https://magicgarden.gg/version/19aaa98/assets/tiles/mutation-overlays.png",s("  Using default mutation-overlays.png URL")),s(`ÔøΩo. Found plants sprite sheet: ${e}`);try{const t=await Ni(e);s(`ÔøΩo. Loaded plants.png (${t.width}x${t.height})`),this.processSheet("plants",t)}catch(r){s("ÔøΩsÔøΩÔøΩ,? Failed to load plants.png",r)}try{const e=await Ni(t);s(`ÔøΩo. Loaded pets.png (${e.width}x${e.height})`),this.processSheet("pets",e)}catch(r){s("ÔøΩsÔøΩÔøΩ,? Failed to load pets.png",r)}try{const e=await Ni(n);s(`ÔøΩo. Loaded mutation-overlays.png (${e.width}x${e.height})`),this.processSheet("mutation-overlays",e)}catch(r){s("ÔøΩsÔøΩÔøΩ,? Failed to load mutation-overlays.png",r)}}scanPixiTextures(){try{const e=Si(),t=e.PIXI;if(!t||!t.utils||!t.utils.TextureCache)return void s("‚ö†Ô∏è Pixi TextureCache not found yet, will retry...");const n=t.utils.TextureCache;let o=0;for(const r in n){if(!n.hasOwnProperty(r))continue;const t=n[r];if(!t||!t.baseTexture||!t.baseTexture.resource)continue;const i=t.baseTexture.resource.source,a=e.HTMLImageElement??HTMLImageElement,s=e.HTMLCanvasElement??HTMLCanvasElement,l=a?i instanceof a:i instanceof HTMLImageElement,c=s?i instanceof s:i instanceof HTMLCanvasElement;if(!l&&!c)continue;const d=r.toLowerCase(),u=d.includes("plant")||d.includes("crop")||d.includes("prod-plants"),p=d.includes("pet")||d.includes("animal")||d.includes("creature")||d.includes("mob");if(!u&&!p)continue;const m=this.getSheetNameFromKey(r);this.sheets.has(m)||(this.ingestTextureSource(r,i),o++)}o>0&&s(`üñºÔ∏è Found ${o} new sprite sheets in Pixi cache`)}catch(e){s("‚ö†Ô∏è Error scanning Pixi textures:",e)}}getSheetNameFromKey(e){const t=e.toLowerCase();return t.includes("prod-plants")?"prod-plants":t.includes("plant")?"plants":t.includes("crop")?"crops":t.includes("pet")||t.includes("animal")||t.includes("creature")||t.includes("mob")?"pets":e.split("/").pop()?.split(".")[0]||"unknown"}processSheet(e,t){if(0===t.naturalWidth||0===t.naturalHeight)return;const n=t.naturalWidth>=4096?512:256,o=Math.floor(t.naturalWidth/n),r=Math.floor(t.naturalHeight/n),i=this.getSheetNameFromKey(e);s(`üñºÔ∏è Processing sprite sheet: ${i} (${o}x${r} tiles @ ${n}px) from ${e}`),this.sheets.set(i,{url:e,image:t,tileSize:n,tilesPerRow:o,tilesPerColumn:r,loaded:!0});for(let a=0;a<Math.min(100,o*r);a++)this.getTile(i,a)}ingestTextureSource(e,t){const n=this.getSheetNameFromKey(e);if(this.sheets.has(n))return;if(Boolean(t&&"function"==typeof t.toDataURL&&"function"==typeof t.getContext)){try{const n=zi();n.src=t.toDataURL(),n.complete&&n.naturalWidth>0?this.processSheet(e,n):n.addEventListener("load",()=>this.processSheet(e,n),{once:!0})}catch(o){s("‚ö†Ô∏è Failed to clone canvas sprite sheet",o)}return}if(Boolean(t&&"number"==typeof t.naturalWidth)){const n=t;n.complete&&n.naturalWidth>0?this.processSheet(e,n):n.addEventListener("load",()=>this.processSheet(e,n),{once:!0})}}getTile(e,t){const n=`${e}-${t}`;if(this.tiles.has(n))return this.tiles.get(n).canvas;const o=this.sheets.get(e);if(!o||!o.loaded)return null;const r=Math.floor(t/o.tilesPerRow),i=t%o.tilesPerRow;if(r>=o.tilesPerColumn)return null;const a=document.createElement("canvas");a.width=o.tileSize,a.height=o.tileSize;const s=a.getContext("2d",{alpha:!0});if(!s)return null;s.imageSmoothingEnabled=!1,s.drawImage(o.image,i*o.tileSize,r*o.tileSize,o.tileSize,o.tileSize,0,0,o.tileSize,o.tileSize);const l=s.getImageData(0,0,o.tileSize,o.tileSize).data;let c=!1;for(let d=3;d<l.length;d+=4){const e=l[d],t=l[d-3],n=l[d-2],o=l[d-1];if(void 0!==e&&void 0!==t&&void 0!==n&&void 0!==o&&e>0&&(255!==t||255!==n||255!==o)){c=!0;break}}return c?(this.tiles.set(n,{canvas:a,sheet:e,index:t}),a):null}getCropSprite(e){const t=["plants","allplants","plant","crops","prod-plants","prod-plants-v2"],n=this.getCropSpriteIndex(e.toLowerCase());if(null===n)return null;for(const o of t){const e=this.getTile(o,n);if(e)return e}return null}getCropSpriteIndex(e){const t={daffodil:10,tulip:11,orangetulip:11,sunflower:12,lily:13,starweaver:14,chrysanthemum:15,aloe:16,cactus:18,bamboo:19,blueberry:20,banana:21,strawberry:22,grape:24,watermelon:25,lemon:26,apple:27,pepper:30,tomato:31,carrot:33,pumpkin:34,corn:35,"fava bean":36,favabean:36,cacao:37,cacaobean:37,lychee:39,coconut:40,"passion fruit":42,passionfruit:42,"dragon fruit":43,dragonfruit:43,mushroom:45,"burro's tail":46,burrostail:46,echeveria:48,delphinium:49,dawnbinder:50,dawncelestial:50,moonbinder:51,mooncelestial:51,camellia:57,squash:59}[e];return void 0===t?(s(`‚ö†Ô∏è Unknown crop species: "${e}"`),null):t}getPetSprite(e){const t=["pets","animals","creatures","mobs"],n=this.getPetSpriteIndex(e);if(null===n)return null;for(const o of t){const e=this.getTile(o,n);if(e)return e}for(const o of this.getSheets())if(o.toLowerCase().includes("pet")||o.toLowerCase().includes("animal")){const e=this.getTile(o,n);if(e)return e}return null}getPetSpriteIndex(e){if(!e)return null;const t=e.toLowerCase().replace(/[^a-z]/g,""),n=Fi[t];return"number"!=typeof n?(s(`ÔøΩsÔøΩÔøΩ,? Unknown pet species for sprite: "${e}"`),null):n}getSheets(){return Array.from(this.sheets.keys())}getSheetSummaries(){return Array.from(this.sheets.entries()).map(([e,t])=>({name:e,url:t.url,tileSize:t.tileSize,tilesPerRow:t.tilesPerRow,tilesPerColumn:t.tilesPerColumn}))}getMutationOverlay(e){const t=e.toLowerCase(),n=Ii[t];return"number"!=typeof n?null:this.getTile("mutation-overlays",n)}async loadSheetFromUrl(e,t){try{const n=Li(e),o=await Ni(n);return this.processSheet(t??n,o),!0}catch(n){return s(`‚ö†Ô∏è Failed to load sprite sheet from ${e}`,n),!1}}isReady(){return this.sheets.size>0}};function Hi(e){const t=`${e.name} ${e.url}`.toLowerCase();return t.includes("pet")||t.includes("animal")||t.includes("creature")||t.includes("mob")}function ji(){const e=Di.getSheetSummaries().filter(Hi);e.length?(s("\nüêæ Extracted pet sprite sheets:"),e.forEach((e,t)=>{s(`   ${t+1}. ${e.name} (${e.tilesPerRow}x${e.tilesPerColumn} tiles @ ${e.tileSize}px)`),s(`      source: ${e.url}`)})):s("‚ùå No processed pet sprite sheets yet. Move pets into view to force loads, then rerun.")}async function Wi(e=3,t="pets"){const n=Bi(t),o=[];for(const r of n){if(!r.url||ki.has(r.url))continue;if(await Di.loadSheetFromUrl(r.url)&&(ki.add(r.url),o.push(r.url)),o.length>=e)break}return o}function Gi(e){const t=Di.getCropSprite(e);if(!t)return null;try{return t.toDataURL("image/png")}catch(n){return s(`‚ö†Ô∏è Failed to convert sprite to data URL for ${e}`,n),null}}function Oi(e){const t=Di.getPetSprite(e);if(!t)return null;try{return t.toDataURL("image/png")}catch(n){return s(`ÔøΩsÔøΩÔøΩ,? Failed to convert pet sprite to data URL for ${e}`,n),null}}const Vi=e=>new Promise(t=>setTimeout(t,e));function _i(e="pets",t=80){const n=document.createElement("div");n.style.cssText="\n    position: fixed;\n    inset: 40px auto auto 40px;\n    max-height: 80vh;\n    max-width: 80vw;\n    overflow: auto;\n    padding: 16px;\n    background: rgba(0, 0, 0, 0.9);\n    border: 1px solid #444;\n    border-radius: 10px;\n    z-index: 999999;\n    box-shadow: 0 12px 30px rgba(0,0,0,0.45);\n  ";const o=document.createElement("div");o.style.cssText="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;",o.innerHTML=`\n    <div style="font-weight:700;color:#fff;">Sprite Grid: ${e}</div>\n    <button style="background:#222;color:#fff;border:1px solid #555;border-radius:6px;padding:4px 8px;cursor:pointer;">Close</button>\n  `,o.querySelector("button")?.addEventListener("click",()=>n.remove()),n.appendChild(o);const r=document.createElement("div");r.style.cssText="display:grid;grid-template-columns:repeat(auto-fill,minmax(96px,1fr));gap:10px;";let i=0;for(let a=0;a<t;a++){const t=Di.getTile(e,a);if(!t)continue;i++;const n=document.createElement("div");n.style.cssText="background:#111;border:1px solid #333;border-radius:8px;padding:6px;text-align:center;";const o=document.createElement("div");o.textContent=`#${a}`,o.style.cssText="color:#999;font-size:11px;margin-bottom:4px;font-family:monospace;";const s=new Image;s.src=t.toDataURL("image/png"),s.style.cssText="width:64px;height:64px;image-rendering:pixelated;margin:auto;display:block;",n.appendChild(o),n.appendChild(s),r.appendChild(n)}if(0===i){const e=document.createElement("div");e.textContent="No tiles available for this sheet yet.",e.style.cssText="color:#ccc;font-size:13px;",n.appendChild(e)}else n.appendChild(r);document.body.appendChild(n)}async function Ui(){s("üîç Scanning Pixi texture cache for pet sprite sheets...");try{const e=await async function(e=2e4){const t=Date.now();let n=!1;for(;Date.now()-t<e;){const e=Si(),t=e?.PIXI,o=t?.utils?.TextureCache;if(o&&Object.keys(o).length>0)return{PIXI:t,textureCache:o};n||(s("‚è≥ Waiting for Pixi texture cache to be ready before scanning pet sprites..."),n=!0),await Vi(500)}return null}();if(!e){s("‚ö†Ô∏è Pixi TextureCache never became available. Make sure you are in-game and pets have been rendered.");const e=Bi("pets");e.length>0?(s("\nüêæ Sprite resource sniffing still found pet-like URLs:"),e.forEach((e,t)=>{s(`   ${t+1}. ${e.url}`),s(`      sources: ${e.sources.join(", ")||"unknown"} | last seen: ${new Date(e.lastSeen).toLocaleTimeString()}`)})):s("‚ùå No pet sprite URLs recorded yet. Move a pet into view to force the game to load their textures.");const t=await Wi(5);return void(t.length>0?(s(`\n‚úÖ Loaded ${t.length} pet sprite sheet${1===t.length?"":"s"} directly from tracked URLs.`),ji()):e.length>0&&s("‚ö†Ô∏è Unable to fetch the tracked pet sprite sheets automatically. Open your Pet Hutch or inventory so the game loads them, then rerun inspect."))}const{textureCache:t}=e,n=Si(),o=n.HTMLImageElement??HTMLImageElement,r=n.HTMLCanvasElement??HTMLCanvasElement,i=[];s("\nüì¶ Scanning all textures...");let a=0;for(const s in t){if(!Object.prototype.hasOwnProperty.call(t,s))continue;a++;const e=t[s];if(!e||!e.baseTexture||!e.baseTexture.resource)continue;const n=e.baseTexture.resource.source,l=o?n instanceof o:Boolean(n?.naturalWidth),c=r?n instanceof r:Boolean(n?.toDataURL);if(!l&&!c)continue;l&&n.src&&qi(n.src,"pixi.cache");const d=s.toLowerCase();if(d.includes("pet")||d.includes("animal")||d.includes("creature")||d.includes("mob")){const e=l?n.naturalWidth:n.width,t=l?n.naturalHeight:n.height,o=l?n.src:"canvas";i.push({key:s,width:e,height:t,url:o}),Di.ingestTextureSource(s,n)}}if(s(`\n‚úÖ Scanned ${a} total textures`),s(`\nüêæ Found ${i.length} potential pet sprite sheets:\n`),0===i.length){s("‚ùå No pet sprite sheets found in Pixi cache."),s('   Try looking for generic sprite sheets with "atlas" or "sprites" in the name:');const e=[];for(const o in t){if(!Object.prototype.hasOwnProperty.call(t,o))continue;const n=t[o];if(!n||!n.baseTexture||!n.baseTexture.resource)continue;const r=n.baseTexture.resource.source;if(!(r instanceof HTMLImageElement||r instanceof HTMLCanvasElement))continue;const i=o.toLowerCase();if(i.includes("atlas")||i.includes("sprites")||i.includes("sheet")){const t=r instanceof HTMLImageElement?r.naturalWidth:r.width,n=r instanceof HTMLImageElement?r.naturalHeight:r.height;e.push({key:o,width:t,height:n})}}e.length>0&&(s("\nüìã Atlas/sprite sheets found:"),e.forEach((e,t)=>{s(`   ${t+1}. "${e.key}" (${e.width}x${e.height})`)}));const n=Bi("pets");n.length>0&&(s("\nüì° Sprite sniffing hints (pet candidates):"),n.forEach((e,t)=>{s(`   ${t+1}. ${e.url}`),s(`      sources: ${e.sources.join(", ")||"unknown"} | last seen: ${new Date(e.lastSeen).toLocaleTimeString()}`)}))}else{i.forEach((e,t)=>{s(`${t+1}. "${e.key}"`),s(`   Size: ${e.width}x${e.height}`),s(`   URL: ${e.url}`),s(`   Tiles (256px): ${Math.floor(e.width/256)}x${Math.floor(e.height/256)} = ${Math.floor(e.width/256)*Math.floor(e.height/256)} tiles`),s(`   Tiles (512px): ${Math.floor(e.width/512)}x${Math.floor(e.height/512)} = ${Math.floor(e.width/512)*Math.floor(e.height/512)} tiles`),s("")});const e=Bi("pets");e.length>0&&(s("\nüì° Sprite sniffing hints (pet candidates):"),e.forEach((e,t)=>{s(`   ${t+1}. ${e.url}`),s(`      sources: ${e.sources.join(", ")||"unknown"} | last seen: ${new Date(e.lastSeen).toLocaleTimeString()}`)}))}s("\nüí° To extract a specific sprite sheet, note the key name above."),s("   Example: if you see a sheet with pets, tell me which one!")}catch(e){s("‚ùå Error scanning for pet sprites:",e)}}ji();const Xi={carrot:{name:"Carrot",seedPrice:10,baseSellPrice:20,cropGrowTime:4,regrow:"No",baseWeight:.1,maxWeight:.3},strawberry:{name:"Strawberry",seedPrice:50,baseSellPrice:14,cropGrowTime:10,regrow:"5 Slots",matureTime:70,baseWeight:.05,maxWeight:.1},aloe:{name:"Aloe",seedPrice:135,baseSellPrice:310,cropGrowTime:45,regrow:"No",baseWeight:1.5,maxWeight:3.75},delphinium:{name:"Delphinium",seedPrice:0,baseSellPrice:530,cropGrowTime:25,regrow:"No",baseWeight:.02,maxWeight:.06,exclusive:"Carnival Stand"},blueberry:{name:"Blueberry",seedPrice:400,baseSellPrice:23,cropGrowTime:22,regrow:"5 Slots",matureTime:105,baseWeight:.01,maxWeight:.02},apple:{name:"Apple",seedPrice:500,baseSellPrice:73,cropGrowTime:5400,regrow:"7 Slots",matureTime:21600,baseWeight:.18,maxWeight:.36},tulip:{name:"Tulip",seedPrice:600,baseSellPrice:767,cropGrowTime:8,regrow:"No",baseWeight:.01,maxWeight:.03},tomato:{name:"Tomato",seedPrice:800,baseSellPrice:27,cropGrowTime:40,regrow:"2 Slots",matureTime:1100,baseWeight:.3,maxWeight:.6},daffodil:{name:"Daffodil",seedPrice:1e3,baseSellPrice:1090,cropGrowTime:50,regrow:"No",baseWeight:.01,maxWeight:.03},corn:{name:"Corn",seedPrice:1300,baseSellPrice:36,cropGrowTime:30,regrow:"1 Slot",matureTime:130,baseWeight:1.2,maxWeight:2.4},watermelon:{name:"Watermelon",seedPrice:2500,baseSellPrice:2708,cropGrowTime:720,regrow:"No",baseWeight:4.5,maxWeight:13.5},pumpkin:{name:"Pumpkin",seedPrice:3e3,baseSellPrice:3700,cropGrowTime:2100,regrow:"No",baseWeight:6,maxWeight:18},echeveria:{name:"Echeveria",seedPrice:4200,baseSellPrice:5520,cropGrowTime:120,regrow:"No",baseWeight:.8,maxWeight:2.2},coconut:{name:"Coconut",seedPrice:6e3,baseSellPrice:302,cropGrowTime:3600,regrow:"7 Slots",matureTime:43200,baseWeight:5,maxWeight:15},banana:{name:"Banana",seedPrice:7500,baseSellPrice:1750,cropGrowTime:4500,regrow:"5 Slots",matureTime:14400,baseWeight:.12,maxWeight:.204,exclusive:"Discord Server with even ID"},lily:{name:"Lily",seedPrice:2e4,baseSellPrice:20123,cropGrowTime:240,regrow:"No",baseWeight:.02,maxWeight:.055},camellia:{name:"Camellia",seedPrice:55e3,baseSellPrice:4875,cropGrowTime:10800,regrow:"8 Slots",matureTime:86400,baseWeight:.3,maxWeight:.75},squash:{name:"Squash",seedPrice:0,baseSellPrice:3500,cropGrowTime:200,regrow:"3 Slots",matureTime:1500,baseWeight:.3,maxWeight:.75,exclusive:"Carnival Stand"},burrostail:{name:"Burro's Tail",seedPrice:93e3,baseSellPrice:6e3,cropGrowTime:100,regrow:"2 Slots",matureTime:1800,baseWeight:.4,maxWeight:1},mushroom:{name:"Mushroom",seedPrice:15e4,baseSellPrice:16e4,cropGrowTime:86400,regrow:"No",baseWeight:25,maxWeight:87.5},cactus:{name:"Cactus",seedPrice:25e4,baseSellPrice:261e3,cropGrowTime:9e3,regrow:"No",baseWeight:1500,maxWeight:2700},bamboo:{name:"Bamboo",seedPrice:4e5,baseSellPrice:5e5,cropGrowTime:43200,regrow:"No",baseWeight:1,maxWeight:2},chrysanthemum:{name:"Chrysanthemum",seedPrice:67e4,baseSellPrice:18e3,cropGrowTime:10800,regrow:"7 Slots",matureTime:86400,baseWeight:.01,maxWeight:.0275},grape:{name:"Grape",seedPrice:85e4,baseSellPrice:12500,cropGrowTime:900,regrow:"1 Slot",matureTime:86400,baseWeight:3,maxWeight:6,exclusive:"Discord Server ID ending in 1"},pepper:{name:"Pepper",seedPrice:1e6,baseSellPrice:7220,cropGrowTime:600,regrow:"9 Slots",matureTime:560,baseWeight:.5,maxWeight:1},lemon:{name:"Lemon",seedPrice:2e6,baseSellPrice:1e4,cropGrowTime:3600,regrow:"6 Slots",matureTime:43200,baseWeight:.5,maxWeight:1.5,exclusive:"Discord Server ID ending in 2"},passionfruit:{name:"Passion Fruit",seedPrice:275e4,baseSellPrice:24500,cropGrowTime:2700,regrow:"2 Slots",matureTime:86400,baseWeight:9.5,maxWeight:19},dragonfruit:{name:"Dragon Fruit",seedPrice:5e6,baseSellPrice:24500,cropGrowTime:900,regrow:"7 Slots",matureTime:600,baseWeight:8.4,maxWeight:17},lychee:{name:"Lychee",seedPrice:25e6,baseSellPrice:5e4,cropGrowTime:1800,regrow:"6 Slots",matureTime:86400,baseWeight:9,maxWeight:18,exclusive:"Discord Server ID ending in 2"},sunflower:{name:"Sunflower",seedPrice:1e8,baseSellPrice:75e4,cropGrowTime:18e3,regrow:"1 Slot",matureTime:86400,baseWeight:10,maxWeight:25},starweaver:{name:"Starweaver",seedPrice:1e9,baseSellPrice:1e7,cropGrowTime:86400,regrow:"1 Slot",matureTime:216e3,baseWeight:10,maxWeight:20},dawnbinder:{name:"Dawnbinder",seedPrice:1e10,baseSellPrice:11e6,cropGrowTime:86400,regrow:"1 Slot",matureTime:86400,baseWeight:6,maxWeight:15},moonbinder:{name:"Moonbinder",seedPrice:5e10,baseSellPrice:11e6,cropGrowTime:86400,regrow:"3 Slots",matureTime:86400,baseWeight:2,maxWeight:4},favabean:{name:"Fava Bean",seedPrice:0,baseSellPrice:0,cropGrowTime:0,regrow:"No",baseWeight:0,maxWeight:0,rarity:0},cacaobean:{name:"Cacao Bean",seedPrice:0,baseSellPrice:0,cropGrowTime:0,regrow:"No",baseWeight:0,maxWeight:0,exclusive:"Divine"}};function Ki(e){const t=e.toLowerCase().replace(/[^a-z]/g,"");return Xi[t]||null}const Ji=Object.freeze(Object.defineProperty({__proto__:null,CROP_BASE_STATS:Xi,getAllCropNames:function(){const e=["Carrot","Strawberry","Aloe","Blueberry","Apple","Tulip","Tomato","Daffodil","Corn","Watermelon","Pumpkin","Coconut","Banana","Lily","Chrysanthemum","Echeveria","Squash","Camellia","Grape","Pepper","Lemon","Mushroom","Cactus","Bamboo","Passion Fruit","Dragon Fruit","Lychee","Sunflower","Delphinium","Starweaver","Dawnbinder","Moonbinder","Fava Bean","Cacao Bean"];return Object.values(Xi).map(e=>e.name).sort((t,n)=>{const o=e.indexOf(t),r=e.indexOf(n);return-1!==o&&-1!==r?o-r:-1!==o?-1:-1!==r?1:t.localeCompare(n)})},getCropStats:Ki},Symbol.toStringTag,{value:"Module"})),Qi={Carrot:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Tomato:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Corn:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Pepper:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],FavaBean:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Pumpkin:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Squash:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Strawberry:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Blueberry:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Watermelon:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Grape:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Apple:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Banana:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Lemon:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Coconut:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Lychee:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],DragonFruit:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],PassionFruit:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Lily:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Sunflower:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Daffodil:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Camellia:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Delphinium:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],OrangeTulip:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Chrysanthemum:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Aloe:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Cactus:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Echeveria:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],BurrosTail:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Bamboo:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Mushroom:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],Starweaver:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],DawnCelestial:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],MoonCelestial:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"],CacaoBean:["Normal","Rainbow","Gold","Frozen","Wet","Chilled","Dawnlit","Dawncharged","Ambershine","Ambercharged","Max Weight"]},Yi={Worm:["Normal","Rainbow","Gold","Max Weight"],Snail:["Normal","Rainbow","Gold","Max Weight"],Bee:["Normal","Rainbow","Gold","Max Weight"],Chicken:["Normal","Rainbow","Gold","Max Weight"],Bunny:["Normal","Rainbow","Gold","Max Weight"],Dragonfly:["Normal","Rainbow","Gold","Max Weight"],Pig:["Normal","Rainbow","Gold","Max Weight"],Cow:["Normal","Rainbow","Gold","Max Weight"],Sheep:["Normal","Rainbow","Gold","Max Weight"],Turkey:["Normal","Rainbow","Gold","Max Weight"],Squirrel:["Normal","Rainbow","Gold","Max Weight"],Turtle:["Normal","Rainbow","Gold","Max Weight"],Goat:["Normal","Rainbow","Gold","Max Weight"],Butterfly:["Normal","Rainbow","Gold","Max Weight"],Peacock:["Normal","Rainbow","Gold","Max Weight"],Capybara:["Normal","Rainbow","Gold","Max Weight"]};let Zi=null,ea=0;async function ta(){try{const e=F("stateAtom");if(!e)return s("‚ö†Ô∏è stateAtom not found"),null;const t=await I(e);if(!t)return s("‚ö†Ô∏è State is null"),null;const n=F("playerAtom");if(!n)return s("‚ö†Ô∏è playerAtom not found"),null;const o=await I(n),r=o?.id;if(!r)return s("‚ö†Ô∏è Player ID not found"),null;const i=t?.child?.data?.userSlots||[];Array.isArray(i)?i.length:Object.keys(i||{}).length,Array.isArray(i);let a=null;if(Array.isArray(i))a=i.find(e=>String(e?.playerId)===String(r));else if(i&&"object"==typeof i)for(const s of Object.values(i))if(String(s?.playerId)===String(r)){a=s;break}if(!a)return s("‚ö†Ô∏è Player slot not found"),Array.isArray(i)?i.map(e=>e?.playerId).join(", "):Object.values(i||{}).map(e=>e?.playerId).join(", "),null;const l=a?.data?.journal||a?.journal;return l&&"object"==typeof l?(JSON.stringify(Object.keys(l)),l.produce&&JSON.stringify(Object.keys(l.produce)),l.pets&&JSON.stringify(Object.keys(l.pets)),function(e){const t={};e.produce&&"object"==typeof e.produce&&(t.produce=Object.fromEntries(Object.entries(e.produce).map(([e,t])=>[e,{variantsLogged:Array.isArray(t?.variantsLogged)?t.variantsLogged:[]}])));e.pets&&"object"==typeof e.pets&&(t.pets=Object.fromEntries(Object.entries(e.pets).map(([e,t])=>[e,{variantsLogged:Array.isArray(t?.variantsLogged)?t.variantsLogged:[],abilitiesLogged:Array.isArray(t?.abilitiesLogged)?t.abilitiesLogged:[]}])));return t}(l)):(s("‚ÑπÔ∏è No journal data found for player"),JSON.stringify(Object.keys(a||{})),JSON.stringify(Object.keys(a?.data||{})),{produce:{},pets:{}})}catch(e){return s("‚ùå Error fetching journal:",e),null}}async function na(){const e=Date.now();if(Zi&&e-ea<5e3)return Zi;const t=await ta();return t&&(Zi=t,ea=e),t}async function oa(){const e=await na();if(!e)return null;const t={produce:[],pets:[]};for(const[n,o]of Object.entries(Qi)){const r=e.produce?.[n],i=new Map;if(r?.variantsLogged)for(const e of r.variantsLogged)i.set(e.variant,e.createdAt||0);t.produce.push({species:n,variants:o.map(e=>({variant:e,collected:i.has(e),collectedAt:i.get(e)}))})}for(const[n,o]of Object.entries(Yi)){const r=e.pets?.[n],i=new Map;if(r?.variantsLogged)for(const e of r.variantsLogged)i.set(e.variant,e.createdAt||0);t.pets.push({species:n,variants:o.map(e=>({variant:e,collected:i.has(e),collectedAt:i.get(e)}))})}return t}async function ra(){const e=await oa();if(!e)return null;let t=0,n=0,o=0,r=0,i=0;const a=e.produce.length;for(const c of e.produce){let e=!1;for(const o of c.variants)n++,o.collected&&(t++,e=!0);e&&i++}for(const c of e.pets)for(const e of c.variants)r++,e.collected&&o++;const s=t+o,l=n+r;return{produce:{collected:t,total:n,percentage:n>0?t/n*100:0,typesCollected:i,typesTotal:a},petVariants:{collected:o,total:r,percentage:r>0?o/r*100:0},overall:{collected:s,total:l,percentage:l>0?s/l*100:0}}}const ia=Object.freeze(Object.defineProperty({__proto__:null,getJournal:na,getJournalStats:ra,getJournalSummary:oa,refreshJournalCache:function(){Zi=null,ea=0}},Symbol.toStringTag,{value:"Module"})),aa=[{matches:["Normal"],label:"N",color:"#FFFFFF",bold:!0},{matches:["Rainbow"],label:"R",gradient:"linear-gradient(120deg, #ff8a80, #ffd180, #80d8ff, #b388ff)",bold:!0},{matches:["Gold","Golden"],label:"G",color:"#FFB300",bold:!0},{matches:["Wet"],label:"W",color:"#4DBEFA"},{matches:["Chilled"],label:"C",color:"#96F6FF"},{matches:["Frozen"],label:"F",color:"#00BCD4"},{matches:["Dawnlit"],label:"D",color:"#a463ff"},{matches:["Dawncharged","Dawnbound"],label:"D",color:"#7e00fc",bold:!0},{matches:["Amberlit","Ambershine"],label:"A",color:"#FFA726"},{matches:["Ambercharged","Amberbound"],label:"A",color:"#FFA726",bold:!0},{matches:["Max Weight","Max"],label:"S",color:"#BDBDBD",bold:!0}],sa={normal:"#111111",rainbow:"#111111",gold:"#ffffff",golden:"#ffffff",wet:"#04233A",chilled:"#05323D",frozen:"#ffffff",dawnlit:"#ffffff",dawncharged:"#ffffff",dawnbound:"#ffffff",amberlit:"#ffffff",ambershine:"#ffffff",ambercharged:"#ffffff",amberbound:"#ffffff",max:"#ffffff","max weight":"#ffffff"};function la(e){return e.trim().toLowerCase()}function ca(e,t){const n=function(e){const t=la(e);return aa.find(e=>e.matches.some(e=>la(e)===t))}(e);if(!n)return{bg:t?"#4CAF50":"#333",text:t?"#fff":"#777",weight:t?600:400};const o=la(e),r=sa[o]||"#111111";return t?{bg:n.gradient||n.color||"#4CAF50",text:n.gradient?"#111111":r,weight:600}:{bg:"#333",text:"#777",weight:400}}const da={enabled:!0,showForGrowing:!0,showForMature:!0,showJournalIndicators:!0};let ua={...da},pa=null,ma=null,fa=null,ga=null;function ha(e){ua={...ua,...e},f.set("cropSizeIndicator:config",ua),ua.enabled?Oa():function(){pa&&(pa(),pa=null);ma&&(ma.disconnect(),ma=null),function(){Wa&&(Wa(),Wa=null);ja=null}(),s("üìê Crop Size Indicator: Stopped")}()}const ba="data-qpm-crop-size-injected",ya="qpm-crop-size-tooltip-style",xa="data-qpm-tooltip-row",wa="data-qpm-journal-badge",va="#B5BCAF",Ca="qpm-crop-size",Ta="data-qpm-aries-icon",Sa="data-aries-value-row",Pa="data-aries-coin-value",Aa="data-qpm-size-value",ka="data-qpm-badge-container",Ea="data-qpm-size-divider";function $a(){if(document.getElementById(ya))return;const e=document.createElement("style");e.id=ya,e.textContent=`\n    [${xa}] {\n      display: block;\n      width: 100%;\n      pointer-events: none;\n    }\n\n    [${xa}="size"] {\n      margin-top: -2px;\n      font-size: 15px;\n      font-weight: 600;\n      letter-spacing: 0.01em;\n      line-height: 16px;\n      color: ${va};\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      gap: 8px;\n    }\n\n    [${wa}] {\n      font-weight: 600;\n      letter-spacing: 0.04em;\n      display: inline-block;\n      margin: 0 1px;\n      min-width: 10px;\n      text-align: center;\n    }\n  `.trim(),document.head.appendChild(e)}function Ma(e,t){if(!e)return;const n=`:scope > [${xa}="${t}"]`,o=e.querySelector(n);o?.remove()}function Fa(e,t,n,o){$a();const r=function(e){const t=e.querySelector(`[${Ta}]`);if(t){const e=t.parentElement;if(e)return e.setAttribute(Sa,"true"),La(e),e}const n=e.querySelector(`[${Sa}]`);if(n)return La(n),n;const o=e.querySelector(`[${Pa}]`)?.parentElement;if(o)return o.setAttribute(Sa,"true"),La(o),o;return null}(e),i=function(e,t){$a();const n=`:scope > [${xa}="${t}"]`;let o=e.querySelector(n);return o||(o=document.createElement("span"),o.setAttribute(xa,t),o.setAttribute("data-qpm-injected","true"),e.appendChild(o)),o}(e,"size");i.classList.add(Ca),i.style.color=o,i.style.marginTop=r?"2px":"0px";let a=i.querySelector(`:scope > span[${Aa}]`);a||(a=document.createElement("span"),a.setAttribute(Aa,"true"),i.appendChild(a)),a.textContent=`${t}`,a.style.flex="0 1 auto",a.style.textAlign="left";let s=i.querySelector(`:scope > span[${ka}]`);s||(s=document.createElement("span"),s.setAttribute(ka,"true"),s.style.display="inline-flex",s.style.gap="4px",s.style.textAlign="right",i.appendChild(s));let l=i.querySelector(`:scope > span[${Ea}]`);if(l||(l=document.createElement("span"),l.setAttribute(Ea,"true"),l.textContent="|",l.style.opacity="0.6",l.style.margin="0 6px",l.style.flex="0 0 auto",i.appendChild(l)),i.append(a,l,s),n.length>0){const e=n.map(e=>function(e){const t=document.createElement("span");return t.setAttribute(wa,"true"),t.textContent=e.label,e.gradient?(t.style.backgroundImage=e.gradient,t.style.color="transparent",t.style.backgroundClip="text",t.style.setProperty("-webkit-background-clip","text"),t.style.setProperty("-webkit-text-fill-color","transparent")):e.color?t.style.color=e.color:t.style.color="#FFFFFF",t.style.textShadow="0 1px 2px rgba(0, 0, 0, 0.35)",t.style.setProperty("color",t.style.color||"#FFFFFF","important"),t.style.fontWeight=e.bold?"800":"600",t.title=e.matches.join(" / "),t}(e));s.replaceChildren(...e),s.style.visibility="visible",l.style.display="inline-block",i.style.justifyContent="center"}else s.replaceChildren(),s.style.visibility="hidden",l.style.display="none",i.style.justifyContent="center";Ia(e,i,r)}function Ia(e,t,n){n&&n.parentElement===e?t.previousElementSibling!==n&&n.insertAdjacentElement("afterend",t):t.parentElement!==e&&e.appendChild(t)}function La(e){e.style.marginTop="2px",e.style.marginBottom="0",e.style.paddingTop="0";const t=e.querySelector("span, strong");if(t){const e=t;e.style.display="inline-flex",e.style.alignItems="center",e.setAttribute(Pa,"true")}}function za(e){Ma(e,"size"),Ma(e,"journal")}async function Na(e){if(!ua.enabled||e.classList.contains("qpm-window")||e.closest(".qpm-window"))return;let t=e.querySelector("p.chakra-text.css-1jc0opy")||e.querySelector("p.chakra-text")||Array.from(e.querySelectorAll("p")).find(e=>{const t=e.textContent?.trim();return t&&t.length>0&&t.length<50})||null;if(!t)return void za(e);const n=t.closest(".chakra-stack")??t.parentElement??e,o=t.textContent?.trim();if(!o)return void za(n);let r=o.toLowerCase().trim();const i={"dawnbinder bulb":"dawnbinder","moonbinder bulb":"moonbinder","starweaver fruit":"starweaver","lychee fruit":"lychee",strawberry:"strawberry",grape:"grape",pepper:"pepper",blueberry:"blueberry",eggplant:"eggplant","coffee bean":"coffee",cherry:"cherry"}[r];i&&(r=i);if(!Object.keys(Xi).some(e=>e.toLowerCase()===r))return void za(n);const a=fa||In();if(!a)return;const l=(e,t=!1)=>{const n=a?.cols||a?.map?.cols||20;return{x:e%n,y:Math.floor(e/n)}},c=[],d=e=>{if(e)for(const[t,n]of Object.entries(e))if("plant"===n.objectType&&n.slots&&Array.isArray(n.slots))for(let e=0;e<n.slots.length;e++){const o=n.slots[e];if(!o||!o.species)continue;let i=o.species;const a=["Rainbow","Gold","Golden","Frozen","Amber","Wet","Chilled","Dawnlit","Dawnbound","Amberbound"];for(const e of a)if(i.startsWith(e+" ")){i=i.substring(e.length+1);break}const s={dawncelestial:"dawnbinder",mooncelestial:"moonbinder"}[i.toLowerCase()];if(s&&(i=s),i.toLowerCase()===r){const r=parseInt(t,10),i=l(r);c.push({slot:o,tileKey:t,slotIndex:e,coords:i,tile:n})}}};if(d(a.tileObjects),d(a.boardwalkTileObjects),0===c.length){const e=new Set,t=t=>{if(t)for(const n of Object.values(t))if("plant"===n.objectType&&n.slots)for(const t of n.slots)t?.species&&e.add(t.species)};return t(a.tileObjects),t(a.boardwalkTileObjects),s(`üìê ‚ö†Ô∏è No match for "${r}" (original: "${o}")`),void s(`üìê Available species: ${Array.from(e).sort().join(", ")}`)}const u=Ar;let m=c[0];if(ja){const e=c.filter(e=>e.tileKey===String(ja.tileIndex));if(e.length>0)if(e.length>1&&null!=u){m=e.find(e=>e.slotIndex===u)||e[0]}else m=e[0]}const{slot:f,tileKey:g,slotIndex:h,tile:b}=m,y=f.scale??f.targetScale??1,x=`${r}-${g}-${h}-${y.toFixed(3)}`,w=e.getAttribute(ba);if(w===x)return;w&&za(n);const v=f.endTime??0,C=v>0&&Date.now()>=v;if(C&&!ua.showForMature||!C&&!ua.showForGrowing)return;const T=function(e){let t=e.species;if(!t)return null;const n=t.toLowerCase(),o={mooncelestial:"moonbinder",dawncelestial:"dawnbinder"}[n];o&&(t=o);const r=Ki(t);if(!r)return null;const i=e.weight??0;let a;a=i>0&&r.baseWeight>0?i/r.baseWeight:e.scale??e.targetScale??e.plantScale??1;const s=p(n)??2;return{sizePercent:50+50*Math.max(0,Math.min(1,(a-1)/(s-1))),scale:a,weight:i,value:r.baseSellPrice*a}}(f);if(!T)return;e.setAttribute(ba,x);const S=Math.floor(T.sizePercent),P=ua.showJournalIndicators?await async function(e){try{if(ga||(ga=await na()),!ga||!ga.produce)return[];let t=e.charAt(0).toUpperCase()+e.slice(1).toLowerCase();const n={moonbinder:"MoonCelestial",dawnbinder:"DawnCelestial",Moonbinder:"MoonCelestial",Dawnbinder:"DawnCelestial"};n[e]&&(t=n[e]);const o=ga.produce[t];if(!o)return aa.map(e=>({...e}));const r=new Set((o.variantsLogged||[]).map(e=>{const t="string"==typeof e?e:e?.variant;return"string"==typeof t?t.toLowerCase():""}).filter(Boolean)),i=[];for(const e of aa)e.matches.some(e=>r.has(e.toLowerCase()))||i.push({...e});return i}catch(t){return s("‚ö†Ô∏è Error checking journal for crop variants:",t),[]}}(r):[],A=function(e){if(!e)return va;const t=e.trim().toLowerCase();if(!t)return va;if("#fff"===t||"#ffffff"===t)return va;if(t.startsWith("rgb")){const e=t.match(/rgb[a]?\(([^)]+)\)/);if(e){const t=e[1];if(!t)return va;const n=t.split(",").map(e=>parseFloat(e.trim())),[o,r,i]=n;if(255===o&&255===r&&255===i)return va}}return e}(function(e){const t=e.querySelectorAll("span, p, div, strong");for(const n of Array.from(t)){if(!(n instanceof HTMLElement))continue;if("true"===n.getAttribute("data-qpm-injected"))continue;const e=n.textContent?.trim();if(e&&!(e.length>24)&&/\bkg\b/i.test(e))try{const e=window.getComputedStyle(n).color;if(e)return e}catch{}}return null}(e));Fa(n,S,P,A),function(e){const t=Array.from(e.querySelectorAll("img"));for(const n of t){if(!n||"true"===n.dataset.qpmAriesNormalized)continue;const{width:t,height:o,pointerEvents:r,userSelect:i}=n.style;if("18px"!==t||"18px"!==o)continue;if("none"!==r||"none"!==i)continue;const a=document.createElement("span");a.className=n.className,a.setAttribute("aria-hidden",n.getAttribute("aria-hidden")??"true"),a.setAttribute(Ta,"true"),a.setAttribute("style",n.getAttribute("style")??""),a.style.backgroundSize="contain",a.style.backgroundRepeat="no-repeat",a.style.backgroundPosition="center",a.style.backgroundImage=`url("${n.src}")`;const s=n.parentElement;if(n.dataset.qpmAriesNormalized="true",n.replaceWith(a),s){s.setAttribute(Sa,"true"),La(s);const e=s.querySelector("span, strong");e&&e.setAttribute(Pa,"true")}const l=e.querySelector(`:scope > [${xa}="size"]`);l&&Ia(e,l,s)}}(n)}const qa=".McFlex.css-fsggty",Ba=new Map;function Ra(e){if(Ba.has(e))return;let t=null;const n=()=>{t=null,Na(e).catch(e=>{s("‚ö†Ô∏è Error injecting crop size info:",e)})};n();const o=function(e,t,n={}){const o=new MutationObserver(()=>t(e));return o.observe(e,{attributes:!0,childList:!0,subtree:!0,...n}),{disconnect:()=>o.disconnect()}}(e,()=>{null===t&&(t=window.requestAnimationFrame(n))});Ba.set(e,{disconnect:()=>{o.disconnect(),null!==t&&(window.cancelAnimationFrame(t),t=null)}})}function Da(e){const t=Ba.get(e);t&&(t.disconnect(),Ba.delete(e))}function Ha(){if(ma)return;s("üìê Crop Size Indicator: Watching for crop tooltips");const e=o(qa,Ra),t=function(e,t,{root:n=document}={}){const o=new MutationObserver(n=>{for(const o of n)for(const n of o.removedNodes){if(n.nodeType!==Node.ELEMENT_NODE)continue;const o=n;o.matches(e)&&t(o)}});return o.observe(n,{childList:!0,subtree:!0}),{disconnect:()=>o.disconnect()}}(qa,Da);ma={disconnect:()=>{e.disconnect(),t.disconnect(),Ba.forEach(e=>e.disconnect()),Ba.clear()}}}let ja=null,Wa=null;async function Ga(){try{const e=F("myCurrentGardenTileAtom");if(!e)return;const t=await I(e);if(!t)return void(ja=null);const n=F("myOwnCurrentGardenObjectAtom");if(!n)return;const o=await I(n);if(!o)return void(ja=null);ja={objectType:o.objectType,species:o.species,tileIndex:t.localTileIndex,tileType:t.tileType}}catch(e){}}function Oa(){pa||(s("üìê Crop Size Indicator: Starting"),Fr(),function(){if(Wa)return;s("üìê Starting current tile tracking");const e=F("myCurrentGardenTileAtom");e?(L(e,()=>{Ga()}).then(e=>{Wa=e}).catch(e=>{s("üìê ‚ö†Ô∏è Error subscribing to tile info:",e)}),Ga()):s("üìê ‚ö†Ô∏è myCurrentGardenTileAtom not found")}(),pa=Ln(e=>{fa=e}),fa=In(),Ha())}function Va(){!function(){const e=f.get("cropSizeIndicator:config",da);ua={...da,...e}}(),ua.enabled&&Oa()}function _a(e){return f.get("journal:notes",{})[e]||""}function Ua(e,t){const n=f.get("journal:notes",{});n[e]=t,f.set("journal:notes",n)}function Xa(){const e=document.createElement("div");e.dataset.qpmSection="journal-checker",e.style.cssText="\n    background: rgba(0, 0, 0, 0.85);\n    border-radius: 8px;\n    padding: 16px;\n    color: #fff;\n  ";const t=document.createElement("div");t.style.cssText="\n    margin-bottom: 20px;\n    border-bottom: 2px solid #333;\n    padding-bottom: 12px;\n  ",t.innerHTML='\n    <div style="display: flex; align-items: center; justify-content: space-between;">\n      <div>\n        <div style="font-size: 18px; font-weight: bold; color: #fff; margin-bottom: 4px;">\n          üìî Journal Checker\n        </div>\n        <div style="font-size: 12px; color: #aaa;">\n          Track your collection progress across all categories\n        </div>\n      </div>\n    </div>\n  ',e.appendChild(t);const n=document.createElement("div");n.style.cssText="\n    display: grid;\n    grid-template-columns: repeat(2, 1fr);\n    gap: 12px;\n    margin-bottom: 24px;\n  ";const o=(e,t,n,o,r)=>{const i=document.createElement("div");i.style.cssText=`\n      background: linear-gradient(135deg, ${r});\n      border-radius: 12px;\n      padding: 18px;\n      text-align: center;\n      border: 2px solid ${o}22;\n      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n      cursor: pointer;\n      position: relative;\n      overflow: hidden;\n    `;const a=document.createElement("div");return a.style.cssText="position: relative; z-index: 1;",a.innerHTML=`\n      <div style="font-size: 32px; margin-bottom: 8px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));">${e}</div>\n      <div class="stat-value" style="color: ${o}; font-size: 26px; font-weight: bold; margin-bottom: 6px; font-family: 'Segoe UI', Arial, sans-serif; text-shadow: 0 2px 8px rgba(0,0,0,0.4);">${n}</div>\n      <div style="color: #bbb; font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px;">${t}</div>\n    `,i.appendChild(a),i.addEventListener("mouseenter",()=>{i.style.transform="translateY(-4px)",i.style.borderColor=`${o}55`,i.style.boxShadow=`0 8px 16px ${o}22`}),i.addEventListener("mouseleave",()=>{i.style.transform="translateY(0)",i.style.borderColor=`${o}22`,i.style.boxShadow="none"}),i},r=o("üåæ","Produce","...","#8BC34A","#1e2a1e, #1a1a1a"),i=o("üêæ","Pet Variants","...","#42A5F5","#1a212a, #1a1a1a"),a=o("‚ú®","Overall","...","#9C27B0","#241a2a, #1a1a1a");n.appendChild(r),n.appendChild(i),n.appendChild(a),e.appendChild(n);const s=document.createElement("div");s.style.cssText="\n    display: flex;\n    gap: 10px;\n    margin-bottom: 20px;\n    flex-wrap: wrap;\n  ";const l=[{key:"produce",label:"Produce",icon:"üåæ",color:"#8BC34A"},{key:"pets",label:"Pets",icon:"üêæ",color:"#42A5F5"},{key:"recommendations",label:"Smart Tips",icon:"üí°",color:"#9C27B0"},{key:"missing",label:"Missing",icon:"üìã",color:"#FF9800"}];let c="produce",d=!1;const u=async()=>{const e=await Promise.resolve().then(()=>ia).then(e=>e.getJournalSummary()),t=await Promise.resolve().then(()=>ia).then(e=>e.getJournalStats());if(!e||!t)return void(b.innerHTML='<div style="color: #999; text-align: center; padding: 40px; font-size: 14px;">‚ö†Ô∏è Unable to load journal data<br><span style="font-size: 12px; color: #666;">Try refreshing or check console for errors</span></div>');const n=(e,t)=>{const n=e.querySelector(".stat-value");n&&(n.textContent=t,n.animate([{transform:"scale(1.2)",opacity:.5},{transform:"scale(1)",opacity:1}],{duration:300,easing:"ease-out"}))};if(n(r,`${t.produce.collected}/${t.produce.total}`),n(i,`${t.petVariants.collected}/${t.petVariants.total}`),n(a,`${Math.round(t.overall.percentage)}%`),b.innerHTML="","produce"===c)for(const o of e.produce){const e=d?o.variants.filter(e=>!e.collected):o.variants;if(0===e.length)continue;const t=o.variants.filter(e=>e.collected).length,n=o.variants.length,r=t/n*100,i=document.createElement("div");100===r?(i.classList.add("qpm-rainbow-complete"),i.style.cssText="\n            border-radius: 10px;\n            padding: 16px;\n            margin-bottom: 10px;\n            border: 1px solid #333;\n            transition: all 0.2s;\n          "):i.style.cssText="\n            background: linear-gradient(135deg, #1f1f1f, #1a1a1a);\n            border-radius: 10px;\n            padding: 16px;\n            margin-bottom: 10px;\n            border: 1px solid #333;\n            transition: all 0.2s;\n          ",i.addEventListener("mouseenter",()=>{100!==r&&(i.style.borderColor="#8BC34A44"),i.style.transform="translateX(4px)"}),i.addEventListener("mouseleave",()=>{100!==r&&(i.style.borderColor="#333"),i.style.transform="translateX(0)"});const a=Gi(o.species.toLowerCase().replace(/\s+/g,""))||Gi(o.species.toLowerCase()),s=100===r;i.innerHTML=`\n          <div style="display: flex; gap: 12px; margin-bottom: 12px;">\n            ${a?`\n              <div style="\n                width: 64px;\n                height: 64px;\n                background-image: url(${a});\n                background-size: contain;\n                background-repeat: no-repeat;\n                background-position: center;\n                border-radius: 8px;\n                border: 2px solid ${s?"#8BC34A":"#444"};\n                flex-shrink: 0;\n                image-rendering: pixelated;\n                ${s?"box-shadow: 0 0 20px #8BC34A66; filter: saturate(1.5) brightness(1.2);":""}\n              "></div>\n            `:""}\n            <div style="flex: 1;">\n              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">\n                <div style="display: flex; align-items: center; gap: 8px;">\n                  <strong style="color: #fff; font-size: 14px;">${o.species}</strong>\n                  ${s?'<span style="font-size: 16px;">‚ú®</span>':""}\n                </div>\n                <div style="display: flex; align-items: center; gap: 8px;">\n                  <span style="color: #8BC34A; font-size: 13px; font-weight: bold;">${t}/${n}</span>\n                  <span style="\n                    background: ${s?"#8BC34A":"#555"};\n                    color: ${s?"#000":"#fff"};\n                    padding: 2px 8px;\n                    border-radius: 12px;\n                    font-size: 11px;\n                    font-weight: bold;\n                  ">${Math.round(r)}%</span>\n                </div>\n              </div>\n            </div>\n          </div>\n          <div style="\n            background: #111;\n            border-radius: 8px;\n            height: 6px;\n            margin-bottom: 12px;\n            overflow: hidden;\n          ">\n            <div style="\n              background: linear-gradient(90deg, #8BC34A, #66BB6A);\n              height: 100%;\n              width: ${r}%;\n              transition: width 0.5s ease;\n              box-shadow: 0 0 10px #8BC34A77;\n            "></div>\n          </div>\n          <div style="display: flex; gap: 8px; flex-wrap: wrap;">\n            ${e.map(e=>{const t=ca(e.variant,e.collected);return`\n                <span style="\n                  padding: 6px 12px;\n                  border-radius: 6px;\n                  font-size: 12px;\n                  background: ${t.bg};\n                  color: ${t.text};\n                  font-weight: ${t.weight};\n                  transition: all 0.2s;\n                  ${e.collected?"box-shadow: 0 2px 4px rgba(0,0,0,0.2);":""}\n                ">${e.collected?"‚úì ":""}${e.variant}</span>\n              `}).join("")}\n          </div>\n        `;const l=document.createElement("div");l.style.cssText="margin-top: 12px; padding-top: 12px; border-top: 1px solid #333;";const c=document.createElement("div");c.style.cssText="font-size: 11px; color: #aaa; margin-bottom: 6px; font-weight: 500;",c.textContent="üìù Notes",l.appendChild(c);const u=document.createElement("textarea");u.value=_a(o.species),u.placeholder="Add your notes here...",u.style.cssText="\n          width: 100%;\n          min-height: 60px;\n          padding: 8px;\n          background: rgba(0, 0, 0, 0.3);\n          border: 1px solid #444;\n          border-radius: 4px;\n          color: #fff;\n          font-size: 12px;\n          font-family: inherit;\n          resize: vertical;\n        ",u.addEventListener("blur",()=>{Ua(o.species,u.value)}),l.appendChild(u),i.appendChild(l),b.appendChild(i)}else if("pets"===c)for(const o of e.pets){const e=d?o.variants.filter(e=>!e.collected):o.variants;if(0===e.length)continue;const t=o.variants.filter(e=>e.collected).length,n=o.variants.length,r=t/n*100,i=document.createElement("div");100===r?(i.classList.add("qpm-rainbow-complete"),i.style.cssText="\n            border-radius: 10px;\n            padding: 16px;\n            margin-bottom: 10px;\n            border: 1px solid #333;\n            transition: all 0.2s;\n          "):i.style.cssText="\n            background: linear-gradient(135deg, #1f1f1f, #1a1a1a);\n            border-radius: 10px;\n            padding: 16px;\n            margin-bottom: 10px;\n            border: 1px solid #333;\n            transition: all 0.2s;\n          ",i.addEventListener("mouseenter",()=>{100!==r&&(i.style.borderColor="#42A5F544"),i.style.transform="translateX(4px)"}),i.addEventListener("mouseleave",()=>{100!==r&&(i.style.borderColor="#333"),i.style.transform="translateX(0)"});const a=100===r,s=Oi(o.species.toLowerCase());let l=`\n          <div style="display: flex; gap: 12px; margin-bottom: 12px;">\n            ${s?`<div style="\n                width: 64px;\n                height: 64px;\n                background-image: url(${s});\n                background-size: contain;\n                background-repeat: no-repeat;\n                background-position: center;\n                border-radius: 8px;\n                border: 2px solid ${a?"#42A5F5":"#444"};\n                flex-shrink: 0;\n                image-rendering: pixelated;\n                ${a?"box-shadow: 0 0 20px #42A5F566; filter: saturate(1.3);":""}\n              "></div>`:`<div style="\n                width: 64px;\n                height: 64px;\n                background: linear-gradient(135deg, ${a?"#42A5F5":"#333"}, ${a?"#64B5F6":"#222"});\n                border-radius: 8px;\n                border: 2px solid ${a?"#42A5F5":"#444"};\n                flex-shrink: 0;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                font-size: 32px;\n                ${a?"box-shadow: 0 0 20px #42A5F566;":""}\n              ">??</div>`}\n            <div style="flex: 1;">\n              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">\n                <div style="display: flex; align-items: center; gap: 8px;">\n                  <strong style="color: #fff; font-size: 14px;">${o.species}</strong>\n                  ${a?'<span style="font-size: 16px;">?o"</span>':""}\n                </div>\n                <span style="\n                  background: ${a?"#42A5F5":"#555"};\n                  color: ${a?"#000":"#fff"};\n                  padding: 2px 8px;\n                  border-radius: 12px;\n                  font-size: 11px;\n                  font-weight: bold;\n                ">${Math.round(r)}%</span>\n              </div>\n            </div>\n          </div>\n          <div style="\n            background: #111;\n            border-radius: 8px;\n            height: 6px;\n            margin-bottom: 12px;\n            overflow: hidden;\n          ">\n            <div style="\n              background: linear-gradient(90deg, #42A5F5, #64B5F6);\n              height: 100%;\n              width: ${r}%;\n              transition: width 0.5s ease;\n              box-shadow: 0 0 10px #42A5F577;\n            "></div>\n          </div>\n        `;e.length>0&&(l+=`\n            <div style="margin-bottom: 12px;">\n              <div style="color: #42A5F5; font-size: 11px; font-weight: 600; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px;">\n                Variants (${t}/${n})\n              </div>\n              <div style="display: flex; gap: 8px; flex-wrap: wrap;">\n                ${e.map(e=>{const t=ca(e.variant,e.collected);return`\n                    <span style="\n                      padding: 6px 12px;\n                      border-radius: 6px;\n                      font-size: 12px;\n                      background: ${t.bg};\n                      color: ${t.text};\n                      font-weight: ${t.weight};\n                      ${e.collected?"box-shadow: 0 2px 4px rgba(0,0,0,0.2);":""}\n                    ">${e.collected?"‚úì ":""}${e.variant}</span>\n                  `}).join("")}\n              </div>\n            </div>\n          `),i.innerHTML=l;const c=document.createElement("div");c.style.cssText="margin-top: 12px; padding-top: 12px; border-top: 1px solid #333;";const u=document.createElement("div");u.style.cssText="font-size: 11px; color: #aaa; margin-bottom: 6px; font-weight: 500;",u.textContent="üìù Notes",c.appendChild(u);const p=document.createElement("textarea");p.value=_a(`pet:${o.species}`),p.placeholder="Add your notes here...",p.style.cssText="\n          width: 100%;\n          min-height: 60px;\n          padding: 8px;\n          background: rgba(0, 0, 0, 0.3);\n          border: 1px solid #444;\n          border-radius: 4px;\n          color: #fff;\n          font-size: 12px;\n          font-family: inherit;\n          resize: vertical;\n        ",p.addEventListener("blur",()=>{Ua(`pet:${o.species}`,p.value)}),c.appendChild(p),i.appendChild(c),b.appendChild(i)}else if("recommendations"===c){const{generateJournalStrategy:e,getDifficultyEmoji:t,getPriorityEmoji:n,getDifficultyDescription:o}=await Promise.resolve().then(()=>Tf),r=await e();if(!r)return void(b.innerHTML='<div style="color: #999; text-align: center; padding: 40px; font-size: 14px;">‚ö†Ô∏è Unable to generate recommendations<br><span style="font-size: 12px; color: #666;">Try refreshing or check console for errors</span></div>');if(r.recommendedFocus.length>0){const e=document.createElement("div");e.style.cssText="\n          margin-bottom: 24px;\n        ",e.innerHTML=`\n          <div style="\n            font-size: 16px;\n            font-weight: bold;\n            color: #9C27B0;\n            margin-bottom: 12px;\n            padding-bottom: 8px;\n            border-bottom: 2px solid #9C27B033;\n          ">\n            üéØ Recommended Focus (Top ${Math.min(10,r.recommendedFocus.length)})\n          </div>\n        `,r.recommendedFocus.slice(0,10).forEach(n=>{const r=document.createElement("div");r.style.cssText=`\n            background: linear-gradient(135deg, #1f1f1f, #1a1a1a);\n            border-left: 4px solid ${"high"===n.priority?"#f44336":"medium"===n.priority?"#ff9800":"#666"};\n            border-radius: 8px;\n            padding: 14px;\n            margin-bottom: 10px;\n            transition: all 0.2s;\n          `,r.addEventListener("mouseenter",()=>{r.style.transform="translateX(4px)",r.style.boxShadow="0 4px 12px rgba(0,0,0,0.3)"}),r.addEventListener("mouseleave",()=>{r.style.transform="translateX(0)",r.style.boxShadow="none"});const i="high"===n.priority?"HIGH":"medium"===n.priority?"MED":"LOW",a="high"===n.priority?"#f44336":"medium"===n.priority?"#ff9800":"#666",s="produce"===n.type?Gi(n.species.toLowerCase()):Oi(n.species.toLowerCase()),l=s?`<img src="${s}" alt="${n.species}" style="width: 32px; height: 32px; image-rendering: pixelated;">`:`<span style="font-size: 18px;">${"produce"===n.type?"üåø":"üêæ"}</span>`;r.innerHTML=`\n            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">\n              <div style="display: flex; align-items: center; gap: 8px;">\n                ${l}\n                <strong style="color: #fff; font-size: 14px;">${n.species}</strong>\n              </div>\n              <div style="display: flex; gap: 6px;">\n                <span style="\n                  background: ${a}33;\n                  color: ${a};\n                  padding: 2px 8px;\n                  border-radius: 4px;\n                  font-size: 10px;\n                  font-weight: bold;\n                ">${i}</span>\n                <span style="\n                  background: #555;\n                  color: #fff;\n                  padding: 2px 8px;\n                  border-radius: 4px;\n                  font-size: 10px;\n                  font-weight: bold;\n                ">${t(n.difficulty)} ${o(n.difficulty)}</span>\n              </div>\n            </div>\n            <div style="\n              background: #111;\n              border-radius: 8px;\n              height: 4px;\n              margin-bottom: 8px;\n              overflow: hidden;\n            ">\n              <div style="\n                background: linear-gradient(90deg, #9C27B0, #BA68C8);\n                height: 100%;\n                width: ${n.completionPct}%;\n                box-shadow: 0 0 8px #9C27B077;\n              "></div>\n            </div>\n            <div style="color: #aaa; font-size: 11px; margin-bottom: 6px;">\n              <strong style="color: #9C27B0;">${n.completionPct.toFixed(0)}% complete</strong> ‚Ä¢ ${n.missingVariants.length} variant${1!==n.missingVariants.length?"s":""} remaining ‚Ä¢ Est. ${n.estimatedTime}\n            </div>\n            <div style="color: #ccc; font-size: 12px; margin-bottom: 8px; line-height: 1.4;">\n              ${n.strategy}\n            </div>\n            <div style="display: flex; gap: 6px; flex-wrap: wrap; margin-top: 8px;">\n              ${n.missingVariants.map(e=>`\n                <span style="\n                  padding: 4px 8px;\n                  border-radius: 4px;\n                  font-size: 10px;\n                  background: #333;\n                  color: #999;\n                ">${e}</span>\n              `).join("")}\n            </div>\n          `,e.appendChild(r)}),b.appendChild(e)}if(r.lowHangingFruit.length>0){const e=document.createElement("div");e.style.cssText="\n          margin-bottom: 24px;\n        ",e.innerHTML='\n          <div style="\n            font-size: 16px;\n            font-weight: bold;\n            color: #4CAF50;\n            margin-bottom: 12px;\n            padding-bottom: 8px;\n            border-bottom: 2px solid #4CAF5033;\n          ">\n            üçí Quick Wins (Easy Completions)\n          </div>\n        ',r.lowHangingFruit.slice(0,5).forEach(n=>{const r=document.createElement("div");r.style.cssText="\n            background: #1a1a1a;\n            border: 1px solid #4CAF5033;\n            border-radius: 6px;\n            padding: 10px;\n            margin-bottom: 8px;\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            transition: all 0.2s;\n          ",r.addEventListener("mouseenter",()=>{r.style.background="#1f1f1f",r.style.borderColor="#4CAF5055"}),r.addEventListener("mouseleave",()=>{r.style.background="#1a1a1a",r.style.borderColor="#4CAF5033"});const i="produce"===n.type?Gi(n.species):Oi(n.species);r.innerHTML=`\n            <div style="display: flex; align-items: center; gap: 10px;">\n              <img src="${i}" style="width: 32px; height: 32px; image-rendering: pixelated;" alt="${n.species}" />\n              <div>\n                <div style="font-size: 13px; font-weight: 600; color: #fff;">${n.species}</div>\n                <div style="font-size: 10px; color: #999;">${n.missingVariants.join(", ")}</div>\n              </div>\n            </div>\n            <div style="text-align: right;">\n              <div style="font-size: 11px; color: #4CAF50; font-weight: bold;">${n.estimatedTime}</div>\n              <div style="font-size: 10px; color: #666;">${t(n.difficulty)} ${o(n.difficulty)}</div>\n            </div>\n          `,e.appendChild(r)}),b.appendChild(e)}if(r.fastestPath.steps.length>0){const e=document.createElement("div");e.style.cssText="\n          margin-bottom: 24px;\n        ",e.innerHTML=`\n          <div style="\n            font-size: 16px;\n            font-weight: bold;\n            color: #FF9800;\n            margin-bottom: 12px;\n            padding-bottom: 8px;\n            border-bottom: 2px solid #FF980033;\n          ">\n            üöÄ Fastest Path to ${r.fastestPath.expectedCompletion} More Variants\n          </div>\n          <div style="\n            background: #FF980022;\n            border-left: 3px solid #FF9800;\n            border-radius: 6px;\n            padding: 12px;\n            margin-bottom: 12px;\n          ">\n            <div style="font-size: 12px; color: #FF9800; font-weight: 600; margin-bottom: 4px;">\n              ‚è±Ô∏è Estimated Time: ${r.fastestPath.estimatedTime}\n            </div>\n            <div style="font-size: 11px; color: #aaa;">\n              Complete these ${r.fastestPath.steps.length} species for maximum journal progress\n            </div>\n          </div>\n        `,r.fastestPath.steps.slice(0,8).forEach((n,r)=>{const i=document.createElement("div");i.style.cssText="\n            background: #1a1a1a;\n            border-left: 3px solid #FF9800;\n            border-radius: 4px;\n            padding: 10px;\n            margin-bottom: 6px;\n            display: flex;\n            align-items: center;\n            gap: 10px;\n          ";const a="produce"===n.type?Gi(n.species):Oi(n.species);i.innerHTML=`\n            <div style="\n              background: #FF9800;\n              color: #000;\n              width: 24px;\n              height: 24px;\n              border-radius: 50%;\n              display: flex;\n              const variantColors = {\n                'Normal': { bg: v.collected ? '#FFFFFF' : '#333', text: v.collected ? '#111' : '#777' },\n                'Rainbow': { bg: v.collected ? 'linear-gradient(120deg, #ff8a80, #ffd180, #80d8ff, #b388ff)' : '#333', text: v.collected ? '#111' : '#777' },\n              font-weight: bold;\n              flex-shrink: 0;\n            ">${r+1}</div>\n            <img src="${a}" style="width: 28px; height: 28px; image-rendering: pixelated; flex-shrink: 0;" alt="${n.species}" />\n                  'Dawnlit': { bg: v.collected ? '#a463ff' : '#333', text: v.collected ? '#fff' : '#777' },\n                  'Dawncharged': { bg: v.collected ? '#7e00fc' : '#333', text: v.collected ? '#fff' : '#777' },\n              <div style="font-size: 12px; font-weight: 600; color: #fff; margin-bottom: 2px;">\n                ${n.species} (${n.missingVariants.join(", ")})\n              </div>\n              <div style="font-size: 10px; color: #999;">${n.estimatedTime} ‚Ä¢ ${t(n.difficulty)} ${o(n.difficulty)}</div>\n            </div>\n          `,e.appendChild(i)}),b.appendChild(e)}if(r.longTermGoals.length>0){const e=document.createElement("div");e.style.cssText="\n          margin-bottom: 24px;\n        ",e.innerHTML='\n          <div style="\n            font-size: 16px;\n            font-weight: bold;\n            color: #f44336;\n            margin-bottom: 12px;\n            padding-bottom: 8px;\n            border-bottom: 2px solid #f4433633;\n          ">\n            üéñÔ∏è Long-Term Challenges\n          </div>\n          <div style="\n            background: #f4433622;\n            border-left: 3px solid #f44336;\n            border-radius: 6px;\n            padding: 10px;\n            margin-bottom: 12px;\n            font-size: 11px;\n            color: #f44336;\n          ">\n            ‚ö†Ô∏è These variants are very difficult or require rare conditions\n          </div>\n        ',r.longTermGoals.slice(0,5).forEach(n=>{const o=document.createElement("div");o.style.cssText="\n            background: #1a1a1a;\n            border: 1px solid #f4433633;\n            border-radius: 6px;\n            padding: 10px;\n            margin-bottom: 8px;\n          ";const r="produce"===n.type?Gi(n.species):Oi(n.species);o.innerHTML=`\n            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 6px;">\n              <div style="display: flex; align-items: center; gap: 8px;">\n                <img src="${r}" style="width: 32px; height: 32px; image-rendering: pixelated;" alt="${n.species}" />\n                <strong style="color: #fff; font-size: 13px;">${n.species}</strong>\n              </div>\n              <span style="font-size: 20px;">${t(n.difficulty)}</span>\n            </div>\n            <div style="font-size: 11px; color: #aaa; margin-bottom: 6px;">\n              ${n.missingVariants.join(", ")}\n            </div>\n            <div style="font-size: 10px; color: #999; line-height: 1.4;">\n              ${n.strategy}\n            </div>\n          `,e.appendChild(o)}),b.appendChild(e)}}};l.forEach(e=>{const t=c===e.key||"missing"===e.key&&d,n=document.createElement("button");n.textContent=`${e.icon} ${e.label}`,n.style.cssText=`\n      flex: 1;\n      padding: 10px 18px;\n      border-radius: 8px;\n      border: 2px solid ${t?e.color:"#333"};\n      background: ${t?`${e.color}22`:"#222"};\n      color: ${t?e.color:"#999"};\n      cursor: pointer;\n      font-size: 13px;\n      font-weight: 600;\n      transition: all 0.2s;\n      min-width: 110px;\n    `,n.addEventListener("mouseenter",()=>{t||(n.style.background="#2a2a2a",n.style.borderColor="#444",n.style.color="#ccc")}),n.addEventListener("mouseleave",()=>{t||(n.style.background="#222",n.style.borderColor="#333",n.style.color="#999")}),n.addEventListener("click",()=>{"missing"===e.key?d=!d:(c=e.key,d=!1),s.querySelectorAll("button").forEach((e,t)=>{const n=l[t];if(!n)return;const o=c===n.key||"missing"===n.key&&d;e.style.background=o?`${n.color}22`:"#222",e.style.borderColor=o?n.color:"#333",e.style.color=o?n.color:"#999"}),u()}),s.appendChild(n)}),e.appendChild(s);const p=document.createElement("div");p.style.cssText="\n    margin: -6px 0 16px;\n    padding: 12px 14px;\n    border-radius: 10px;\n    border: 1px solid #2a2a2a;\n    background: rgba(255, 255, 255, 0.03);\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    gap: 12px;\n    flex-wrap: wrap;\n  ";const m=document.createElement("div");m.innerHTML='\n    <div style="font-size: 13px; font-weight: 600; color: #fff;">Tooltip Helper</div>\n    <div style="font-size: 11px; color: #bbb;">Show journal letters inside crop tooltips</div>\n  ',p.appendChild(m);const f=document.createElement("button");f.type="button",f.style.cssText="\n    border-radius: 999px;\n    border: 2px solid #333;\n    padding: 6px 18px;\n    font-size: 12px;\n    font-weight: 700;\n    letter-spacing: 0.06em;\n    text-transform: uppercase;\n    cursor: pointer;\n    transition: all 0.2s;\n    min-width: 72px;\n  ";const g=e=>{f.textContent=e?"ON":"OFF",f.style.background=e?"linear-gradient(135deg, #5ad1ff, #35a8f7)":"rgba(0, 0, 0, 0.3)",f.style.borderColor=e?"#5ad1ff":"#333",f.style.color=e?"#00223b":"#777",f.setAttribute("aria-pressed",e?"true":"false")};let h=!1!=={...ua}.showJournalIndicators;g(h),f.addEventListener("click",()=>{h=!h,g(h),ha({showJournalIndicators:h})}),p.appendChild(f),e.appendChild(p);const b=document.createElement("div");b.style.cssText="\n    max-height: 550px;\n    overflow-y: auto;\n    padding-right: 4px;\n  ";const y=document.createElement("style");y.textContent='\n    div[data-qpm-section="journal-checker"] ::-webkit-scrollbar {\n      width: 8px;\n    }\n    div[data-qpm-section="journal-checker"] ::-webkit-scrollbar-track {\n      background: #1a1a1a;\n      border-radius: 4px;\n    }\n    div[data-qpm-section="journal-checker"] ::-webkit-scrollbar-thumb {\n      background: #444;\n      border-radius: 4px;\n    }\n    div[data-qpm-section="journal-checker"] ::-webkit-scrollbar-thumb:hover {\n      background: #555;\n    }\n\n    /* Rainbow animation for completed items */\n    @keyframes qpm-rainbow-border {\n      0% { border-color: #ff0000; box-shadow: 0 0 20px #ff000044, inset 0 0 20px #ff000011; }\n      16.67% { border-color: #ff8800; box-shadow: 0 0 20px #ff880044, inset 0 0 20px #ff880011; }\n      33.33% { border-color: #ffff00; box-shadow: 0 0 20px #ffff0044, inset 0 0 20px #ffff0011; }\n      50% { border-color: #00ff00; box-shadow: 0 0 20px #00ff0044, inset 0 0 20px #00ff0011; }\n      66.67% { border-color: #0088ff; box-shadow: 0 0 20px #0088ff44, inset 0 0 20px #0088ff11; }\n      83.33% { border-color: #8800ff; box-shadow: 0 0 20px #8800ff44, inset 0 0 20px #8800ff11; }\n      100% { border-color: #ff0000; box-shadow: 0 0 20px #ff000044, inset 0 0 20px #ff000011; }\n    }\n\n    @keyframes qpm-rainbow-gradient {\n      0% { background-position: 0% 50%; }\n      50% { background-position: 100% 50%; }\n      100% { background-position: 0% 50%; }\n    }\n\n    .qpm-rainbow-complete {\n      animation: qpm-rainbow-border 3s linear infinite, qpm-rainbow-gradient 8s ease infinite;\n      border-width: 2px !important;\n      background: linear-gradient(\n        135deg,\n        #ff0000 0%,\n        #ff8800 16.67%,\n        #ffff00 33.33%,\n        #00ff00 50%,\n        #0088ff 66.67%,\n        #8800ff 83.33%,\n        #ff0000 100%\n      );\n      background-size: 400% 400%;\n    }\n\n    .qpm-rainbow-complete strong {\n      color: #000 !important;\n      text-shadow: 0 0 2px rgba(255, 255, 255, 0.5);\n    }\n\n    .qpm-rainbow-complete span[style*="color"] {\n      color: #000 !important;\n    }\n  ',document.head.appendChild(y),e.appendChild(b);const x=document.createElement("button");return x.textContent="üîÑ Refresh Journal Data",x.style.cssText="\n    width: 100%;\n    padding: 12px;\n    margin-top: 16px;\n    border-radius: 8px;\n    border: 2px solid #333;\n    background: linear-gradient(135deg, #2a2a2a, #222);\n    color: #fff;\n    cursor: pointer;\n    font-size: 13px;\n    font-weight: 600;\n    transition: all 0.2s;\n  ",x.addEventListener("mouseenter",()=>{x.style.background="linear-gradient(135deg, #333, #2a2a2a)",x.style.borderColor="#444",x.style.transform="translateY(-2px)",x.style.boxShadow="0 4px 8px rgba(0,0,0,0.3)"}),x.addEventListener("mouseleave",()=>{x.style.background="linear-gradient(135deg, #2a2a2a, #222)",x.style.borderColor="#333",x.style.transform="translateY(0)",x.style.boxShadow="none"}),x.addEventListener("click",()=>{x.textContent="‚è≥ Loading...",x.style.opacity="0.6",Promise.resolve().then(()=>ia).then(e=>{e.refreshJournalCache(),u().then(()=>{x.textContent="üîÑ Refresh Journal Data",x.style.opacity="1"})})}),e.appendChild(x),u(),e}const Ka="quinoa:stats:v1";let Ja,Qa=!1,Ya=null,Za=Date.now();const es=new Set;function ts(e){return{feed:{totalFeeds:0,manualFeeds:0,perPet:{},lastFeedAt:null,sessionStart:e},weather:{totalSwaps:0,swapsByState:{weather:0,noweather:0},presetUsage:{weather:{primary:0,alternate:0},noweather:{primary:0,alternate:0}},cooldownBlocks:0,timeByKind:{},activeKind:"unknown",lastSwapAt:null,lastSnapshotAt:e},shop:{totalPurchases:0,totalSpentCoins:0,totalSpentCredits:0,purchasesByCategory:{seeds:0,eggs:0,tools:0,decor:0},items:{},history:[],lastPurchase:null,totalFailures:0,failuresByCategory:{seeds:0,eggs:0,tools:0,decor:0}},garden:{totalPlanted:0,totalHarvested:0,totalDestroyed:0,totalWateringCans:0,lastPlantedAt:null,lastHarvestedAt:null,lastDestroyedAt:null,lastWateredAt:null},pets:{totalHatched:0,hatchedByRarity:{normal:0,gold:0,rainbow:0},lastHatchedAt:null,lastHatchedRarity:null},abilities:{totalProcs:0,totalEstimatedValue:0,procsByAbility:{},valueByAbility:{},lastProcAt:null,lastProcAbility:null},meta:{initializedAt:e,updatedAt:e,version:1}}}function ns(){Qa||ss()}function os(){const e={feed:{totalFeeds:Ja.feed.totalFeeds,manualFeeds:Ja.feed.manualFeeds,perPet:Object.fromEntries(Object.entries(Ja.feed.perPet).map(([e,t])=>[e,{...t}])),lastFeedAt:Ja.feed.lastFeedAt,sessionStart:Ja.feed.sessionStart},weather:{totalSwaps:Ja.weather.totalSwaps,swapsByState:{...Ja.weather.swapsByState},presetUsage:{weather:{...Ja.weather.presetUsage.weather},noweather:{...Ja.weather.presetUsage.noweather}},cooldownBlocks:Ja.weather.cooldownBlocks,timeByKind:{...Ja.weather.timeByKind},activeKind:Ja.weather.activeKind,lastSwapAt:Ja.weather.lastSwapAt},shop:{totalPurchases:Ja.shop.totalPurchases,totalSpentCoins:Ja.shop.totalSpentCoins,totalSpentCredits:Ja.shop.totalSpentCredits,purchasesByCategory:{...Ja.shop.purchasesByCategory},items:Object.fromEntries(Object.entries(Ja.shop.items).map(([e,t])=>[e,{...t}])),history:Ja.shop.history.map(e=>({...e})),lastPurchase:Ja.shop.lastPurchase?{...Ja.shop.lastPurchase}:null,totalFailures:Ja.shop.totalFailures,failuresByCategory:{...Ja.shop.failuresByCategory}},garden:{totalPlanted:Ja.garden.totalPlanted,totalHarvested:Ja.garden.totalHarvested,totalDestroyed:Ja.garden.totalDestroyed,totalWateringCans:Ja.garden.totalWateringCans,lastPlantedAt:Ja.garden.lastPlantedAt,lastHarvestedAt:Ja.garden.lastHarvestedAt,lastDestroyedAt:Ja.garden.lastDestroyedAt,lastWateredAt:Ja.garden.lastWateredAt},pets:{totalHatched:Ja.pets.totalHatched,hatchedByRarity:{...Ja.pets.hatchedByRarity},lastHatchedAt:Ja.pets.lastHatchedAt,lastHatchedRarity:Ja.pets.lastHatchedRarity},abilities:{totalProcs:Ja.abilities.totalProcs,totalEstimatedValue:Ja.abilities.totalEstimatedValue,procsByAbility:{...Ja.abilities.procsByAbility},valueByAbility:{...Ja.abilities.valueByAbility},lastProcAt:Ja.abilities.lastProcAt,lastProcAbility:Ja.abilities.lastProcAbility},meta:{...Ja.meta}};for(const n of es)try{n(e)}catch(t){console.error("[stats] subscriber error",t)}}function rs(){null!=Ya&&window.clearTimeout(Ya),Ya=window.setTimeout(()=>{Ya=null;try{f.set(Ka,Ja)}catch(e){console.error("[stats] save error",e)}},1200)}function is(){Ja.meta.updatedAt=Date.now(),rs(),os()}function as(e){const t=e,n=Math.max(0,t-Za);if(n<1e3)return Za=t,Ja.weather.lastSnapshotAt=t,!1;const o=Ja.weather.activeKind||"unknown";return Ja.weather.timeByKind[o]=(Ja.weather.timeByKind[o]??0)+n,Za=t,Ja.weather.lastSnapshotAt=t,!0}function ss(){Qa||(Ja=function(){const e=Date.now(),t=f.get(Ka,null);if(!t||"object"!=typeof t)return ts(e);const n=ts(t.meta?.initializedAt??e);if(t.feed&&(n.feed.totalFeeds=Number(t.feed.totalFeeds??n.feed.totalFeeds),n.feed.lastFeedAt=t.feed.lastFeedAt??null,n.feed.sessionStart=t.feed.sessionStart??n.feed.sessionStart,t.feed.perPet&&"object"==typeof t.feed.perPet))for(const[o,r]of Object.entries(t.feed.perPet)){const e=r;e&&(n.feed.perPet[o]={count:Number(e.count??0),lastFeedAt:e.lastFeedAt??null})}if(t.weather){if(n.weather.totalSwaps=Number(t.weather.totalSwaps??0),n.weather.cooldownBlocks=Number(t.weather.cooldownBlocks??0),n.weather.activeKind=t.weather.activeKind??n.weather.activeKind,n.weather.lastSwapAt=t.weather.lastSwapAt??null,n.weather.lastSnapshotAt=t.weather.lastSnapshotAt??e,t.weather.swapsByState&&(n.weather.swapsByState.weather=Number(t.weather.swapsByState.weather??0),n.weather.swapsByState.noweather=Number(t.weather.swapsByState.noweather??0)),t.weather.presetUsage)for(const e of["weather","noweather"]){const o=t.weather.presetUsage[e];o&&(n.weather.presetUsage[e].primary=Number(o.primary??0),n.weather.presetUsage[e].alternate=Number(o.alternate??0))}if(t.weather.timeByKind&&"object"==typeof t.weather.timeByKind)for(const[e,o]of Object.entries(t.weather.timeByKind))n.weather.timeByKind[e]=Number(o??0)}if(t.shop){if(n.shop.totalPurchases=Number(t.shop.totalPurchases??0),n.shop.totalSpentCoins=Number(t.shop.totalSpentCoins??0),n.shop.totalSpentCredits=Number(t.shop.totalSpentCredits??0),t.shop.purchasesByCategory)for(const e of["seeds","eggs","tools","decor"]){const o=t.shop.purchasesByCategory[e];n.shop.purchasesByCategory[e]=Number(o??0)}if(t.shop.items&&"object"==typeof t.shop.items)for(const[o,r]of Object.entries(t.shop.items)){const t=r;t&&(n.shop.items[o]={count:Number(t.count??0),coins:Number(t.coins??0),credits:Number(t.credits??0),lastPurchasedAt:t.lastPurchasedAt??e})}Array.isArray(t.shop.history)&&(n.shop.history=t.shop.history.map(t=>({itemName:t.itemName,category:t.category??"seeds",count:Number(t.count??0),coins:Number(t.coins??0),credits:Number(t.credits??0),timestamp:t.timestamp??e,success:t.success??!0,failureReason:t.failureReason})).slice(-1e3)),"number"==typeof t.shop.totalFailures&&(n.shop.totalFailures=t.shop.totalFailures),t.shop.failuresByCategory&&"object"==typeof t.shop.failuresByCategory&&(n.shop.failuresByCategory={seeds:Number(t.shop.failuresByCategory.seeds??0),eggs:Number(t.shop.failuresByCategory.eggs??0),tools:Number(t.shop.failuresByCategory.tools??0),decor:Number(t.shop.failuresByCategory.decor??0)}),t.shop.lastPurchase&&(n.shop.lastPurchase={itemName:t.shop.lastPurchase.itemName,category:t.shop.lastPurchase.category??"seeds",count:Number(t.shop.lastPurchase.count??0),coins:Number(t.shop.lastPurchase.coins??0),credits:Number(t.shop.lastPurchase.credits??0),timestamp:t.shop.lastPurchase.timestamp??e})}if(t.garden&&(n.garden.totalPlanted=Number(t.garden.totalPlanted??0),n.garden.totalHarvested=Number(t.garden.totalHarvested??0),n.garden.totalDestroyed=Number(t.garden.totalDestroyed??0),n.garden.totalWateringCans=Number(t.garden.totalWateringCans??0),n.garden.lastPlantedAt=t.garden.lastPlantedAt??null,n.garden.lastHarvestedAt=t.garden.lastHarvestedAt??null,n.garden.lastDestroyedAt=t.garden.lastDestroyedAt??null,n.garden.lastWateredAt=t.garden.lastWateredAt??null),t.pets&&(n.pets.totalHatched=Number(t.pets.totalHatched??0),t.pets.hatchedByRarity&&(n.pets.hatchedByRarity.normal=Number(t.pets.hatchedByRarity.normal??0),n.pets.hatchedByRarity.gold=Number(t.pets.hatchedByRarity.gold??0),n.pets.hatchedByRarity.rainbow=Number(t.pets.hatchedByRarity.rainbow??0)),n.pets.lastHatchedAt=t.pets.lastHatchedAt??null,n.pets.lastHatchedRarity=t.pets.lastHatchedRarity??null),t.abilities){if(n.abilities.totalProcs=Number(t.abilities.totalProcs??0),n.abilities.totalEstimatedValue=Number(t.abilities.totalEstimatedValue??0),t.abilities.procsByAbility&&"object"==typeof t.abilities.procsByAbility)for(const[e,o]of Object.entries(t.abilities.procsByAbility))n.abilities.procsByAbility[e]=Number(o??0);if(t.abilities.valueByAbility&&"object"==typeof t.abilities.valueByAbility)for(const[e,o]of Object.entries(t.abilities.valueByAbility))n.abilities.valueByAbility[e]=Number(o??0);n.abilities.lastProcAt=t.abilities.lastProcAt??null,n.abilities.lastProcAbility=t.abilities.lastProcAbility??null}return t.meta&&(n.meta.initializedAt=t.meta.initializedAt??n.meta.initializedAt,n.meta.updatedAt=t.meta.updatedAt??n.meta.updatedAt,n.meta.version=t.meta.version??n.meta.version),n}(),Qa=!0,function(){ot();const e=at();Ja.weather.activeKind=e.kind??"unknown",Ja.weather.lastSnapshotAt=e.timestamp,Za=Date.now(),it(e=>{as(e.timestamp),Ja.weather.activeKind=e.kind??"unknown",is()},!0),window.setInterval(()=>{as(Date.now())&&is()},5e3)}(),os())}function ls(e){ns(),es.add(e);try{e(cs())}catch(t){console.error("[stats] immediate subscriber error",t)}return()=>{es.delete(e)}}function cs(){return ns(),{feed:{totalFeeds:Ja.feed.totalFeeds,manualFeeds:Ja.feed.manualFeeds,perPet:Object.fromEntries(Object.entries(Ja.feed.perPet).map(([e,t])=>[e,{...t}])),lastFeedAt:Ja.feed.lastFeedAt,sessionStart:Ja.feed.sessionStart},weather:{totalSwaps:Ja.weather.totalSwaps,swapsByState:{...Ja.weather.swapsByState},presetUsage:{weather:{...Ja.weather.presetUsage.weather},noweather:{...Ja.weather.presetUsage.noweather}},cooldownBlocks:Ja.weather.cooldownBlocks,timeByKind:{...Ja.weather.timeByKind},activeKind:Ja.weather.activeKind,lastSwapAt:Ja.weather.lastSwapAt},shop:{totalPurchases:Ja.shop.totalPurchases,totalSpentCoins:Ja.shop.totalSpentCoins,totalSpentCredits:Ja.shop.totalSpentCredits,purchasesByCategory:{...Ja.shop.purchasesByCategory},items:Object.fromEntries(Object.entries(Ja.shop.items).map(([e,t])=>[e,{...t}])),history:Ja.shop.history.map(e=>({...e})),lastPurchase:Ja.shop.lastPurchase?{...Ja.shop.lastPurchase}:null,totalFailures:Ja.shop.totalFailures,failuresByCategory:{...Ja.shop.failuresByCategory}},garden:{totalPlanted:Ja.garden.totalPlanted,totalHarvested:Ja.garden.totalHarvested,totalDestroyed:Ja.garden.totalDestroyed,totalWateringCans:Ja.garden.totalWateringCans,lastPlantedAt:Ja.garden.lastPlantedAt,lastHarvestedAt:Ja.garden.lastHarvestedAt,lastDestroyedAt:Ja.garden.lastDestroyedAt,lastWateredAt:Ja.garden.lastWateredAt},pets:{totalHatched:Ja.pets.totalHatched,hatchedByRarity:{...Ja.pets.hatchedByRarity},lastHatchedAt:Ja.pets.lastHatchedAt,lastHatchedRarity:Ja.pets.lastHatchedRarity},abilities:{totalProcs:Ja.abilities.totalProcs,totalEstimatedValue:Ja.abilities.totalEstimatedValue,procsByAbility:{...Ja.abilities.procsByAbility},valueByAbility:{...Ja.abilities.valueByAbility},lastProcAt:Ja.abilities.lastProcAt,lastProcAbility:Ja.abilities.lastProcAbility},meta:{...Ja.meta}}}function ds(){ns();const e=Date.now();Ja=ts(e);const t=at();Ja.weather.activeKind=t.kind??"unknown",Ja.weather.lastSnapshotAt=t.timestamp,Za=e,os(),rs()}const us=new Map,ps=new Map,ms=new Set;let fs=!1,gs=null;const hs=e=>{if(null==e)return null;if("string"==typeof e){const t=e.trim();return t.length?t:null}return"number"==typeof e&&Number.isFinite(e)?String(e):null},bs=e=>{if(null==e)return null;if("number"==typeof e&&Number.isFinite(e))return e;if("string"==typeof e){const t=Number(e);return Number.isFinite(t)?t:null}return null},ys=e=>e&&"object"==typeof e?e:null,xs=(e,t)=>{if(!t||"object"!=typeof t)return null;const n=t,o=ys(n.lastAbilityTrigger);if(!o)return null;const r=hs(o.abilityId);if(!r)return null;const i=bs(o.performedAt);if(null==i||i<=0)return null;const a=ys(n.slot)??ys(n.pet?.slot),s=ys(n.pet),l=hs(n.petId??s?.id??n.slotId??e),c=hs(n.slotId??a?.id??s?.slotId),d=((...e)=>{for(const t of e){const e=bs(t);if(null!=e&&Number.isFinite(e))return Math.max(0,Math.round(e))}return null})(n.slotIndex,a?.slotIndex,a?.index,n.index,o.slotIndex),u=ys(n.position)??ys(o.position)??null;return{sourceKey:e,abilityId:r,performedAt:i,data:o.data??null,petId:l,slotId:c,slotIndex:d,position:u}},ws=e=>{const t=`source:${e.sourceKey}::${e.abilityId}`;let n=us.get(t);if(n||(n={abilityId:e.abilityId,petId:e.petId,slotId:e.slotId,slotIndex:e.slotIndex,events:[],lastPerformedAt:0,lookupKeys:new Set},us.set(t,n)),e.performedAt<=n.lastPerformedAt)return!1;n.petId=n.petId??e.petId,n.slotId=n.slotId??e.slotId,n.slotIndex=n.slotIndex??e.slotIndex;const o={abilityId:e.abilityId,performedAt:e.performedAt,data:e.data,position:e.position};n.events.push(o),n.lastPerformedAt=e.performedAt,(e=>{const t=Date.now()-216e5;(e.events.length>30||(e.events[0]?.performedAt??0)<t)&&(e.events=e.events.filter(e=>e.performedAt>=t).slice(-30))})(n);const r=(e=>{const t=[];return e.petId&&t.push(`petId:${e.petId}`),e.slotId&&t.push(`slotId:${e.slotId}`),null!=e.slotIndex&&t.push(`slotIndex:${e.slotIndex}`),t.push(`source:${e.sourceKey}`),Array.from(new Set(t)).map(t=>`${t}::${e.abilityId}`)})(e);for(const i of r)n.lookupKeys.add(i),ps.set(i,n);return!0},vs=e=>{if(!e||"object"!=typeof e)return;const t=e;let n=!1;for(const[o,r]of Object.entries(t)){const e=xs(o,r);if(!e)continue;ws(e)&&(n=!0)}n&&(()=>{if(!ms.size)return;const e=new Map(ps);for(const n of ms)try{n(e)}catch(t){s("‚ö†Ô∏è Ability history listener failed",t)}})()};function Cs(e,t){const n=new Set,{petId:o,slotId:r,slotIndex:i,fallbackKeys:a=[]}=t;((e,t)=>{const n=[];for(const o of t){if(!o)continue;const t=o.trim();t&&(n.push(`petId:${t}::${e}`),n.push(`slotId:${t}::${e}`),n.push(`source:${t}::${e}`))}return n})(e,[o,r,...a]).forEach(e=>n.add(e)),((e,t)=>null!=t&&Number.isFinite(t)?[`slotIndex:${Math.max(0,Math.round(t))}::${e}`]:[])(e,i).forEach(e=>n.add(e));for(const s of n){const e=ps.get(s);if(e)return e}return null}function Ts(){return new Map(ps)}const Ss=[{id:"ProduceScaleBoost",name:"Crop Size Boost I",aliases:["Crop Size Boost 1"],category:"misc",trigger:"continuous",baseProbability:.3,rollPeriodMinutes:1,effectUnit:"coins",effectLabel:"Scale increase",effectBaseValue:6,effectSuffix:"%",notes:"Chance: 0.30% √ó STR. Effect: 6% size increase √ó STR, capped at max scale."},{id:"ProduceScaleBoostII",name:"Crop Size Boost II",aliases:["Crop Size Boost 2"],category:"misc",trigger:"continuous",baseProbability:.4,rollPeriodMinutes:1,effectUnit:"coins",effectLabel:"Scale increase",effectBaseValue:10,effectSuffix:"%",notes:"Chance: 0.40% √ó STR. Effect: 10% size increase √ó STR, capped at max scale."},{id:"DoubleHarvest",name:"Double Harvest",category:"misc",trigger:"harvest",baseProbability:5},{id:"ProduceEater",name:"Crop Eater",category:"coins",trigger:"continuous",baseProbability:60,rollPeriodMinutes:1,notes:"Cannot estimate coin value without live crop data."},{id:"SellBoostI",name:"Sell Boost I",aliases:["Sell Boost 1"],category:"misc",trigger:"sellAllCrops",baseProbability:10},{id:"SellBoostII",name:"Sell Boost II",aliases:["Sell Boost 2"],category:"misc",trigger:"sellAllCrops",baseProbability:12},{id:"SellBoostIII",name:"Sell Boost III",aliases:["Sell Boost 3"],category:"misc",trigger:"sellAllCrops",baseProbability:14},{id:"SellBoostIV",name:"Sell Boost IV",aliases:["Sell Boost 4"],category:"misc",trigger:"sellAllCrops",baseProbability:16},{id:"ProduceRefund",name:"Crop Refund",category:"misc",trigger:"sellAllCrops",baseProbability:20},{id:"PlantGrowthBoost",name:"Plant Growth Boost I",aliases:["Plant Growth Boost 1"],category:"plantGrowth",trigger:"continuous",baseProbability:24,rollPeriodMinutes:1,effectValuePerProc:3,effectUnit:"minutes",effectLabel:"Growth time reduction",effectBaseValue:3,effectSuffix:"m"},{id:"PlantGrowthBoostII",name:"Plant Growth Boost II",aliases:["Plant Growth Boost 2"],category:"plantGrowth",trigger:"continuous",baseProbability:27,rollPeriodMinutes:1,effectValuePerProc:5,effectUnit:"minutes",effectLabel:"Growth time reduction",effectBaseValue:5,effectSuffix:"m"},{id:"ProduceMutationBoost",name:"Crop Mutation Boost I",aliases:["Crop Mutation Boost 1"],category:"misc",trigger:"continuous",baseProbability:.1,rollPeriodMinutes:1,effectUnit:"coins",effectLabel:"Chance increase",effectBaseValue:10,effectSuffix:"%",notes:"Increases the base weather mutation chance (0.1% √ó STR) by 10% √ó STR during active weather/lunar events. Only works when weather/lunar event is active. Grants: Wet (Rain), Frozen (Snow), Dawnlit (Dawn), Amberlit (Dusk)."},{id:"ProduceMutationBoostII",name:"Crop Mutation Boost II",aliases:["Crop Mutation Boost 2"],category:"misc",trigger:"continuous",baseProbability:.1,rollPeriodMinutes:1,effectUnit:"coins",effectLabel:"Chance increase",effectBaseValue:15,effectSuffix:"%",notes:"Increases the base weather mutation chance (0.1% √ó STR) by 15% √ó STR during active weather/lunar events. Only works when weather/lunar event is active. Grants: Wet (Rain), Frozen (Snow), Dawnlit (Dawn), Amberlit (Dusk)."},{id:"PetMutationBoost",name:"Pet Mutation Boost I",aliases:["Pet Mutation Boost 1"],category:"misc",trigger:"hatchEgg"},{id:"PetMutationBoostII",name:"Pet Mutation Boost II",aliases:["Pet Mutation Boost 2"],category:"misc",trigger:"hatchEgg"},{id:"GoldGranter",name:"Gold Granter",category:"misc",trigger:"continuous",baseProbability:.72,rollPeriodMinutes:1,effectUnit:"coins",notes:"Converts a random uncolored crop to Gold using live garden snapshot."},{id:"RainbowGranter",name:"Rainbow Granter",category:"misc",trigger:"continuous",baseProbability:.72,rollPeriodMinutes:1,effectUnit:"coins",notes:"Converts a random uncolored crop to Rainbow using live garden snapshot."},{id:"RainDance",name:"Rain Dance",category:"misc",trigger:"continuous",baseProbability:10,rollPeriodMinutes:1,effectUnit:"coins",notes:"Grants Wet mutation to crops. Turkey innate ability."},{id:"EggGrowthBoost",name:"Egg Growth Boost I",aliases:["Egg Growth Boost 1"],category:"eggGrowth",trigger:"continuous",baseProbability:21,rollPeriodMinutes:1,effectValuePerProc:7,effectUnit:"minutes"},{id:"EggGrowthBoostII_NEW",name:"Egg Growth Boost II",aliases:["Egg Growth Boost 2"],category:"eggGrowth",trigger:"continuous",baseProbability:24,rollPeriodMinutes:1,effectValuePerProc:9,effectUnit:"minutes"},{id:"EggGrowthBoostII",name:"Egg Growth Boost III",aliases:["Egg Growth Boost 3"],category:"eggGrowth",trigger:"continuous",baseProbability:27,rollPeriodMinutes:1,effectValuePerProc:11,effectUnit:"minutes"},{id:"PetAgeBoost",name:"Hatch XP Boost I",aliases:["Hatch XP Boost 1"],category:"xp",trigger:"hatchEgg",baseProbability:50,effectValuePerProc:8e3,effectUnit:"xp"},{id:"PetAgeBoostII",name:"Hatch XP Boost II",aliases:["Hatch XP Boost 2"],category:"xp",trigger:"hatchEgg",baseProbability:60,effectValuePerProc:12e3,effectUnit:"xp"},{id:"PetHatchSizeBoost",name:"Max Strength Boost I",aliases:["Max Strength Boost 1"],category:"misc",trigger:"hatchEgg",baseProbability:12},{id:"PetHatchSizeBoostII",name:"Max Strength Boost II",aliases:["Max Strength Boost 2"],category:"misc",trigger:"hatchEgg",baseProbability:14},{id:"PetXpBoost",name:"XP Boost I",aliases:["Pet XP Boost I","Pet XP Boost 1","XP Boost 1"],category:"xp",trigger:"continuous",baseProbability:30,rollPeriodMinutes:1,effectValuePerProc:300,effectUnit:"xp"},{id:"PetXpBoostII",name:"XP Boost II",aliases:["Pet XP Boost II","Pet XP Boost 2","XP Boost 2"],category:"xp",trigger:"continuous",baseProbability:35,rollPeriodMinutes:1,effectValuePerProc:400,effectUnit:"xp"},{id:"HungerRestore",name:"Hunger Restore I",aliases:["Hunger Restore 1"],category:"misc",trigger:"continuous",baseProbability:12,rollPeriodMinutes:1},{id:"HungerRestoreII",name:"Hunger Restore II",aliases:["Hunger Restore 2"],category:"misc",trigger:"continuous",baseProbability:14,rollPeriodMinutes:1},{id:"HungerBoost",name:"Hunger Boost I",aliases:["Hunger Boost 1"],category:"misc",trigger:"continuous",baseProbability:0,rollPeriodMinutes:1},{id:"HungerBoostII",name:"Hunger Boost II",aliases:["Hunger Boost 2"],category:"misc",trigger:"continuous",baseProbability:0,rollPeriodMinutes:1},{id:"PetRefund",name:"Pet Refund I",aliases:["Pet Refund 1"],category:"misc",trigger:"sellPet",baseProbability:5},{id:"PetRefundII",name:"Pet Refund II",aliases:["Pet Refund 2"],category:"misc",trigger:"sellPet",baseProbability:7},{id:"Copycat",name:"Copycat",category:"misc",trigger:"continuous",baseProbability:1,rollPeriodMinutes:1},{id:"CoinFinderI",name:"Coin Finder I",aliases:["Coin Finder 1","CoinFinder I","CoinFinder 1"],category:"coins",trigger:"continuous",baseProbability:35,rollPeriodMinutes:1,effectValuePerProc:12e4,effectUnit:"coins",effectLabel:"Coin range",effectBaseValue:12e4,effectSuffix:""},{id:"CoinFinderII",name:"Coin Finder II",aliases:["Coin Finder 2","CoinFinder II","CoinFinder 2"],category:"coins",trigger:"continuous",baseProbability:13,rollPeriodMinutes:1,effectValuePerProc:12e5,effectUnit:"coins",effectLabel:"Coin range",effectBaseValue:12e5,effectSuffix:""},{id:"CoinFinderIII",name:"Coin Finder III",aliases:["Coin Finder 3","CoinFinder III","CoinFinder 3"],category:"coins",trigger:"continuous",baseProbability:6,rollPeriodMinutes:1,effectValuePerProc:1e7,effectUnit:"coins",effectLabel:"Coin range",effectBaseValue:1e7,effectSuffix:""},{id:"SeedFinderI",name:"Seed Finder I",aliases:["Seed Finder 1","SeedFinder I","SeedFinder 1"],category:"misc",trigger:"continuous",baseProbability:40,rollPeriodMinutes:1},{id:"SeedFinderII",name:"Seed Finder II",aliases:["Seed Finder 2","SeedFinder II","SeedFinder 2"],category:"misc",trigger:"continuous",baseProbability:20,rollPeriodMinutes:1},{id:"SeedFinderIII",name:"Seed Finder III",aliases:["Seed Finder 3","SeedFinder III","SeedFinder 3"],category:"misc",trigger:"continuous",baseProbability:10,rollPeriodMinutes:1},{id:"SeedFinderIV",name:"Seed Finder IV",aliases:["Seed Finder 4","SeedFinder IV","SeedFinder 4"],category:"misc",trigger:"continuous",baseProbability:.01,rollPeriodMinutes:1},{id:"RainDance",name:"Rain Dance",category:"misc",trigger:"continuous",baseProbability:10,rollPeriodMinutes:1,effectUnit:"coins",effectLabel:"Mutation chance",effectBaseValue:10,effectSuffix:"%",notes:"Chance: 10% √ó STR per minute. Grants Wet mutation to a random crop."},{id:"DoubleHatch",name:"Double Hatch",category:"misc",trigger:"hatchEgg",baseProbability:3,notes:"Chance: 3.0% √ó STR to hatch an extra pet from the same egg."}],Ps=new Map,As=e=>e.trim().toLowerCase();for(const sb of Ss)if(Ps.set(As(sb.id),sb),Ps.set(As(sb.name),sb),Array.isArray(sb.aliases))for(const e of sb.aliases)Ps.set(As(e),sb);function ks(e){if(!e)return null;const t=As(e);return Ps.get(t)??null}function Es(){return[...Ss]}const $s=.95/60;function Ms(e,t){const n=Number.isFinite(t)?t:100,o=Math.max(.25,n/100),r=Math.max(0,e.baseProbability??0)/60,i=Math.max(0,r/100),a=Math.min($s,i*o),s=3600*a,l=100*a,c=60*l;return{multiplier:o,chancePerRoll:a,rollPeriodMinutes:e.rollPeriodMinutes??1,procsPerHour:s,chancePerSecond:l,chancePerMinute:c}}function Fs(e,t){const n=e.effectValuePerProc??0;return Number.isFinite(n)&&0!==n?t.procsPerHour*n:0}const Is=Object.freeze(Object.defineProperty({__proto__:null,computeAbilityStats:Ms,computeEffectPerHour:Fs,getAbilityDefinition:ks,getAllAbilityDefinitions:Es},Symbol.toStringTag,{value:"Module"}));function Ls(){const e=In(),t=at();if(!e||!t)return{weather:null,eligibleCrops:[],eligibleFruits:0,averageValueGain:0,projectedMutationsPerEvent:0,baseMutationChance:0};const n=function(e){if(!e)return null;const t=e.toLowerCase();return t.includes("rain")?"rain":t.includes("snow")?"snow":t.includes("dawn")?"dawn":t.includes("amber")?"amber":null}("string"==typeof t?t:t.type||t.name);if(!n)return{weather:null,eligibleCrops:[],eligibleFruits:0,averageValueGain:0,projectedMutationsPerEvent:0,baseMutationChance:0};const o=[];let r=0,i=0;const a=e.tileObjects||{};Object.entries(a).forEach(([e,t])=>{if(!t||"plant"!==t.objectType)return;const a=t.species||t.plantSpecies||t.seedSpecies;if(!a)return;if(!(!0===t.fullyMature||!0===t.isMature))return;const s="number"==typeof t.scale?t.scale:1,l=Array.isArray(t.mutations)?[...t.mutations]:[],d=function(e,t){const n=e.some(e=>"Wet"===e||"Frozen"===e),o=e.some(e=>"Dawnlit"===e||"Dawnbound"===e),r=e.some(e=>"Amberlit"===e||"Amberbound"===e),i=e.includes("Gold"),a=e.includes("Rainbow");if("dawn"===t&&(r||i)||"amber"===t&&(o||i)||a)return!1;if(("rain"===t||"snow"===t)&&n)return!1;if("dawn"===t&&o)return!1;if("amber"===t&&r)return!1;return!0}(l,n);if(!d)return;const u=function(e){if("number"==typeof e.fruitCount&&e.fruitCount>0)return e.fruitCount;if(Array.isArray(e.slotStates)&&e.slotStates.length>0)return e.slotStates.length;const t=e.displayName||e.name;if("string"==typeof t){const e=t.match(/\+(\d+)/);if(e&&e[1])return parseInt(e[1],10)}return 1}(t);if(u<=0)return;const p=c(a),m=co(p,s,l,1.5),f=co(p,s,[...l,zs(n)],1.5)-m;f>0&&(o.push({species:a,scale:s,mutations:l,currentValue:m,fruitCount:u,index:parseInt(e,10)}),r+=u,i+=f*u)});const s=o.length>0?i/r:0,l=function(e){switch(e){case"rain":return 22.8;case"snow":return 7.6;case"dawn":return 6.37;case"amber":return 3.19}}(n),d=o.length*(l/100);return{weather:n,eligibleCrops:o,eligibleFruits:r,averageValueGain:s,projectedMutationsPerEvent:d,baseMutationChance:l}}function zs(e){switch(e){case"rain":return"Wet";case"snow":return"Frozen";case"dawn":return"Dawnlit";case"amber":return"Amberlit"}}const Ns=50,qs=100;function Bs(e){return!!e&&"object"==typeof e&&!Array.isArray(e)}function Rs(e){const t="number"==typeof e?e:"string"==typeof e?Number.parseFloat(e):Number.NaN;if(!Number.isFinite(t))return null;const n=Math.floor(t);return n>0?n:null}function Ds(e,t){if(!t)return 1;const n=["fruitCount","remainingFruitCount","remainingFruits","totalFruitCount","totalFruits","totalFruit"];for(const i of n)if(i in e){const t=Rs(e[i]);if(null!=t)return Math.min(t,64)}const o=e.slotStates;if(Array.isArray(o)){const e=o.filter(e=>null!=e);if(e.length>0)return Math.min(e.length,64)}const r="string"==typeof e.displayName?e.displayName:"string"==typeof e.name?e.name:null;if(r){const e=r.match(/\+(\d+)/);if(e){const t=Rs(e[1]);if(null!=t)return Math.min(t,64)}}return 1}function Hs(e,t,n){const o=Number.isFinite(e)&&e>0?e:1,r=[n.maxScale,n.targetMaxScale,n.maxTargetScale,n.maximumScale,n.max],i="string"==typeof t?c(t):null;let a=null;for(const c of r){const e=Number(c);if(Number.isFinite(e)&&e>1){a=e;break}}if((null==a||a<=1)&&i){const e=p(i);null!=e&&Number.isFinite(e)&&e>1&&(a=e)}(null==a||!Number.isFinite(a)||a<=1)&&(a=2);const s=Math.max(1.01,a),l=Math.min(s,Math.max(1,o)),d=Ns+50*(s>1?(l-1)/(s-1):0);return{maxScale:s,sizePercent:Math.min(qs,Math.max(Ns,Math.round(100*d)/100))}}function js(e,t){return 1+(Math.min(qs,Math.max(Ns,e))-Ns)/50*(Math.max(1.01,Number.isFinite(t)&&t>1?t:2)-1)}function Ws(e=In()){const t=function(e){if(!e)return[];const t=[{tiles:e.tileObjects,allowMultiHarvest:!0},{tiles:e.boardwalkTileObjects,allowMultiHarvest:!0}],n=[],o=Date.now();for(const{tiles:r,allowMultiHarvest:i}of t)if(r&&"object"==typeof r)for(const e of Object.values(r)){if(!Bs(e))continue;if("plant"!==e.objectType)continue;const t=e.slots;if(Array.isArray(t))for(const e of t){if(!Bs(e))continue;const t="string"==typeof e.species?e.species:null;if(!t)continue;const r=e.endTime,a="number"==typeof r?r:Number(r),s=!!Number.isFinite(a)&&a<=o,l=e.targetScale??e.scale??e.plantScale,c="number"==typeof l&&Number.isFinite(l)?Math.max(1,l):1,d=(Array.isArray(e.mutations)?e.mutations:[]).map(e=>"string"==typeof e?e:null).filter(e=>!!e),u=co(t,c,d,1.5);if(!Number.isFinite(u)||u<=0)continue;const p=ro(d),m="Gold"===p.color?.definition?.name||"Rainbow"===p.color?.definition?.name,{maxScale:f,sizePercent:g}=Hs(c,t,e),h=Ds(e,i);n.push({species:t,scale:c,maxScale:f,sizePercent:g,mutations:d,currentValue:u,hasColorMutation:m,fruitCount:h,isMature:s})}}return n}(e),n=t.reduce((e,t)=>t.isMature?e+t.currentValue*Math.max(1,t.fruitCount):e,0),o=t.filter(e=>{const t=e.mutations.includes("Gold"),n=e.mutations.includes("Rainbow");return!t&&!n}),r=o.reduce((e,t)=>e+Math.max(1,t.fruitCount),0);return{crops:t,uncoloredCrops:o,uncoloredFruitSlots:r,totalMatureValue:n,friendBonus:1.5}}function Gs(e,t,n){const o=n*("number"==typeof t&&Number.isFinite(t)?Math.max(0,t):100)/100;if(!e.crops.length||o<=0)return null;const r=e.crops.filter(e=>e.isMature&&e.sizePercent<99.99&&Math.max(1,e.fruitCount)>0);if(!r.length)return null;let i=0,a=0,s=0;for(const l of r){const e=Math.max(1,Math.floor(l.fruitCount)),t=Math.max(0,qs-l.sizePercent);if(t<=0)continue;const n=Math.min(o,t);if(n<=0)continue;const r=js(l.sizePercent+n,l.maxScale),c=l.scale>0?l.scale:1,d=Math.max(0,r-c);if(d<=0)continue;const u=c>0?l.currentValue/c:0;if(!Number.isFinite(u)||u<=0)continue;const p=u*d;!Number.isFinite(p)||p<=0||(s+=e,i+=p*e,a+=n*e)}if(i<=0||0===s)return null;return{effectPerProc:i/s,detail:`Boosts ${s} mature fruit${1===s?"":"s"} by ~${(a/s).toFixed(2)}% size (50% friend bonus assumed, weighted by fruit count).`}}function Os(e,t){if(!e.uncoloredCrops.length)return null;let n=0,o=0;for(const r of e.uncoloredCrops){const e=Math.max(1,Math.floor(r.fruitCount)),i=[...r.mutations,t],a=co(r.species,r.scale,i,1.5)-r.currentValue;Number.isFinite(a)&&a>0&&(o+=e,n+=a*e)}if(0===o||n<=0)return null;return{effectPerProc:n/o,detail:`Converts 1 random uncolored crop to ${t}. ${e.uncoloredFruitSlots} eligible fruit slot${1===e.uncoloredFruitSlots?"":"s"} across ${e.uncoloredCrops.length} plant${1===e.uncoloredCrops.length?"":"s"} (50% friend bonus, weighted by fruit count).`}}function Vs(e,t,n){switch(e){case"ProduceScaleBoost":return Gs(t,n,6);case"ProduceScaleBoostII":return Gs(t,n,10);case"GoldGranter":return Os(t,"Gold");case"RainbowGranter":return Os(t,"Rainbow");case"ProduceMutationBoost":case"ProduceMutationBoostII":return function(){const e=Ls();if(!e.weather||0===e.eligibleCrops.length)return{effectPerProc:0,detail:"No active weather/lunar event or no eligible crops. Mutations only proc during Rain, Snow, Dawn, or Amber Moon."};const t="rain"===e.weather?"Rain":"snow"===e.weather?"Snow":"dawn"===e.weather?"Dawn":"Amber",n="rain"===e.weather?"Wet":"snow"===e.weather?"Frozen":"dawn"===e.weather?"Dawnlit":"Amberlit";return{effectPerProc:e.projectedMutationsPerEvent*e.averageValueGain,detail:`${t} active (${e.baseMutationChance.toFixed(1)}% chance/crop). ${e.eligibleCrops.length} eligible plant${1===e.eligibleCrops.length?"":"s"} (${e.eligibleFruits} fruit${1===e.eligibleFruits?"":"s"}). Expected: ${e.projectedMutationsPerEvent.toFixed(2)} ${n} mutation${1===e.projectedMutationsPerEvent?"":"s"}/event, avg ${_s(e.averageValueGain)}/mutation.`}}();default:return null}}function _s(e){return e>=1e6?`${(e/1e6).toFixed(2)}M`:e>=1e3?`${(e/1e3).toFixed(2)}K`:e.toFixed(0)}x("__qpmAbilityDebug",{getContext:()=>Ws(),listUncolored:()=>Ws().uncoloredCrops.map(e=>({species:e.species,fruitCount:Math.max(1,e.fruitCount),sizePercent:e.sizePercent,mutations:[...e.mutations],hasColorMutation:e.hasColorMutation,isMature:e.isMature,valuePerScale:e.scale>0?e.currentValue/e.scale:e.currentValue})),listAll:()=>Ws().crops.map(e=>({species:e.species,fruitCount:Math.max(1,e.fruitCount),sizePercent:e.sizePercent,mutations:[...e.mutations],hasColorMutation:e.hasColorMutation,isMature:e.isMature,currentValue:e.currentValue,maxScale:e.maxScale}))});const Us="qpm-window-pos-",Xs=new Map;let Ks=1e4,Js=!1;function Qs(e){const t=e.getBoundingClientRect(),n=window.innerWidth,o=window.innerHeight;let r=parseFloat(e.style.right)||n-t.right,i=parseFloat(e.style.top)||t.top;const a=Math.max(8,n-t.width-8),s=Math.max(8,o-t.height-8);r=Math.min(Math.max(r,8),a),i=Math.min(Math.max(i,8),s),e.style.right=`${r}px`,e.style.top=`${i}px`,e.style.left="auto",e.style.bottom="auto"}function Ys(){Xs.forEach(e=>{e.isMinimized||Qs(e.el)})}function Zs(e,t,n,o,r){if(Xs.has(e)){const t=Xs.get(e);return t.el.style.display="",t.isMinimized=!1,ol(t.el),void al(e,!0,!1)}const i=o||"90vw",a=r||"90vh",l=document.createElement("div");l.className="qpm-window",l.id=`qpm-window-${e}`,l.style.cssText=`\n    position: fixed;\n    min-width: 260px;\n    max-width: ${i};\n    max-height: ${a};\n    background: rgba(18, 20, 26, 0.96);\n    border: 1px solid rgba(143, 130, 255, 0.5);\n    border-radius: 8px;\n    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.8), 0 0 0 1px rgba(255, 255, 255, 0.05);\n    backdrop-filter: blur(12px);\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n    font-size: 13px;\n    color: #e0e0e0;\n    z-index: ${Ks++};\n    box-sizing: border-box;\n    overflow: auto;\n  `;const c=document.createElement("div");c.className="qpm-window-head",c.style.cssText="\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 12px 16px;\n    background: linear-gradient(135deg, rgba(143, 130, 255, 0.12) 0%, rgba(143, 130, 255, 0.04) 100%);\n    border-bottom: 1px solid rgba(143, 130, 255, 0.25);\n    cursor: move;\n    user-select: none;\n  ";const d=document.createElement("div");d.className="qpm-window-title",d.textContent=t,d.style.cssText="\n    font-size: 15px;\n    font-weight: 600;\n    color: #8f82ff;\n    flex: 1;\n    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);\n  ";const u=document.createElement("div");u.style.cssText="display: flex; gap: 6px;";const p=rl("‚àí","Minimize"),m=rl("√ó","Close");u.appendChild(p),u.appendChild(m),c.appendChild(d),c.appendChild(u);const g=document.createElement("div");g.className="qpm-window-body",g.style.cssText="\n    padding: 16px;\n    background: rgba(0, 0, 0, 0.25);\n    box-sizing: border-box;\n  ",function(e){const t=`qpm-window-scrollbar-${e}`;if(document.getElementById(t))return;const n=document.createElement("style");n.id=t,n.textContent=`\n    /* Scrollbar on the window itself (Aries mod pattern) */\n    #qpm-window-${e}::-webkit-scrollbar {\n      width: 8px;\n    }\n    #qpm-window-${e}::-webkit-scrollbar-track {\n      background: rgba(0, 0, 0, 0.2);\n      border-radius: 4px;\n    }\n    #qpm-window-${e}::-webkit-scrollbar-thumb {\n      background: rgba(143, 130, 255, 0.35);\n      border-radius: 4px;\n      transition: background 0.2s;\n    }\n    #qpm-window-${e}::-webkit-scrollbar-thumb:hover {\n      background: rgba(143, 130, 255, 0.55);\n    }\n\n    /* Constrain all content within window - prevent horizontal overflow */\n    #qpm-window-${e} *,\n    #qpm-window-${e} *::before,\n    #qpm-window-${e} *::after {\n      box-sizing: border-box;\n      max-width: 100%;\n      word-wrap: break-word;\n      overflow-wrap: break-word;\n    }\n\n    #qpm-window-${e} .qpm-card,\n    #qpm-window-${e} .qpm-card__body,\n    #qpm-window-${e} .qpm-card__header,\n    #qpm-window-${e} .qpm-section-muted,\n    #qpm-window-${e} input,\n    #qpm-window-${e} button,\n    #qpm-window-${e} select,\n    #qpm-window-${e} div {\n      max-width: 100%;\n      min-width: 0;\n    }\n\n    /* Prevent pre/code from breaking layout */\n    #qpm-window-${e} pre,\n    #qpm-window-${e} code {\n      white-space: pre-wrap;\n      word-break: break-all;\n    }\n  `,document.head.appendChild(n)}(e),l.appendChild(c),l.appendChild(g),document.body.appendChild(l),n(g),function(e,t){const n=f.get(Us+e);n?(t.style.right=`${n.right}px`,t.style.top=`${n.top}px`,t.style.left="auto",t.style.bottom="auto"):(t.style.left="50%",t.style.top="50%",t.style.transform="translate(-50%, -50%)",t.style.right="auto",t.style.bottom="auto",requestAnimationFrame(()=>{const n=t.getBoundingClientRect();t.style.transform="",t.style.left="auto",t.style.right=window.innerWidth-n.right+"px",t.style.top=`${n.top}px`,il(e,t)}))}(e,l),requestAnimationFrame(()=>{Qs(l)}),Js||(window.addEventListener("resize",Ys),Js=!0,s("Window resize listener added")),function(e,t,n){let o=!1,r=0,i=0,a=0,s=0;const l=t=>{if(!o)return;t.preventDefault();const n=t.clientX-r,l=t.clientY-i,c=a-n,d=s+l,u=window.innerWidth-8,p=window.innerHeight-8,m=e.getBoundingClientRect(),f=Math.max(8-m.width,Math.min(u-m.width,c)),g=Math.max(8,Math.min(p-m.height,d));e.style.right=`${f}px`,e.style.top=`${g}px`,e.style.left="auto",e.style.bottom="auto"},c=()=>{o&&(o=!1,t.style.cursor="move",document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",c),il(n,e))};t.addEventListener("mousedown",n=>{if(n.target.closest(".qpm-window-btn"))return;o=!0,t.style.cursor="grabbing",r=n.clientX,i=n.clientY;const d=e.getBoundingClientRect();a=parseFloat(e.style.right)||window.innerWidth-d.right,s=parseFloat(e.style.top)||d.top,document.addEventListener("mousemove",l),document.addEventListener("mouseup",c),ol(e)})}(l,c,e),l.addEventListener("wheel",e=>{e.stopPropagation()},{passive:!1}),p.addEventListener("click",t=>{t.stopPropagation(),function(e){const t=Xs.get(e);if(!t)return;t.isMinimized=!t.isMinimized,t.isMinimized?(t.body.style.display="none",t.el.style.maxHeight="auto",t.minimizeBtn.textContent="‚ñ°",t.minimizeBtn.title="Restore"):(t.body.style.display="",t.el.style.maxHeight=t.maxHeight,t.minimizeBtn.textContent="‚àí",t.minimizeBtn.title="Minimize");al(e,!0,t.isMinimized)}(e)}),m.addEventListener("click",t=>{t.stopPropagation(),el(e)}),l.addEventListener("mousedown",()=>ol(l));const h={id:e,el:l,head:c,body:g,titleEl:d,minimizeBtn:p,closeBtn:m,isMinimized:!1,maxHeight:a};Xs.set(e,h),al(e,!0,!1),s(`Window ${e} opened`)}function el(e){const t=Xs.get(e);t&&(t.el.style.display="none",al(e,!1,t.isMinimized),s(`Window ${e} closed`))}function tl(e,t,n,o,r){const i=Xs.get(e);return i?nl(i.el)?(el(e),!1):(i.el.style.display="",i.isMinimized=!1,ol(i.el),al(e,!0,!1),!0):(Zs(e,t,n,o,r),!0)}function nl(e){return"none"!==e.style.display}function ol(e){e.style.zIndex=String(Ks++)}function rl(e,t){const n=document.createElement("button");return n.className="qpm-window-btn",n.textContent=e,n.title=t,n.style.cssText=`\n    width: 26px;\n    height: 26px;\n    border: none;\n    background: rgba(255, 255, 255, 0.08);\n    color: #e0e0e0;\n    font-size: ${"√ó"===e?"20px":"18px"};\n    font-weight: 300;\n    line-height: 1;\n    cursor: pointer;\n    border-radius: 4px;\n    transition: all 0.15s ease;\n    padding: 0;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  `,n.addEventListener("mouseenter",()=>{n.style.background="√ó"===e?"rgba(244, 67, 54, 0.8)":"rgba(143, 130, 255, 0.5)",n.style.color="#fff"}),n.addEventListener("mouseleave",()=>{n.style.background="rgba(255, 255, 255, 0.08)",n.style.color="#e0e0e0"}),n}function il(e,t){const n=t.getBoundingClientRect(),o={right:parseFloat(t.style.right)||window.innerWidth-n.right,top:parseFloat(t.style.top)||n.top};f.set(Us+e,o)}function al(e,t,n){f.set("qpm-window-state-"+e,{isOpen:t,isMinimized:n})}function sl(e){const t=Xs.get(e);return!!t&&nl(t.el)}const ll={none:1,golden:25,rainbow:50,wet:2,chilled:2,frozen:10,dawnlit:2,dawnbound:3,amberlit:5,amberbound:6},cl={"wet+dawnlit":3,"chilled+dawnlit":3,"wet+amberlit":6,"chilled+amberlit":6,"frozen+dawnlit":11,"frozen+dawnbound":12,"frozen+amberlit":14,"frozen+amberbound":15,"golden+wet":50,"golden+chilled":50,"golden+frozen":250,"golden+dawnlit":50,"golden+dawnbound":75,"golden+amberlit":125,"golden+amberbound":150,"golden+wet+dawnlit":75,"golden+chilled+dawnlit":75,"golden+wet+amberlit":150,"golden+chilled+amberlit":150,"golden+frozen+dawnlit":275,"golden+frozen+dawnbound":300,"golden+frozen+amberlit":350,"golden+frozen+amberbound":375,"rainbow+wet":100,"rainbow+chilled":100,"rainbow+frozen":500,"rainbow+dawnlit":100,"rainbow+dawnbound":150,"rainbow+amberlit":250,"rainbow+amberbound":300,"rainbow+wet+dawnlit":150,"rainbow+chilled+dawnlit":150,"rainbow+wet+amberlit":300,"rainbow+chilled+amberlit":300,"rainbow+frozen+dawnlit":550,"rainbow+frozen+dawnbound":600,"rainbow+frozen+amberlit":700,"rainbow+frozen+amberbound":750};function dl(e,t){if(!e&&0===t.length)return ll.none;const n=[];e&&n.push(e),t.sort().forEach(e=>n.push(e));const o=n.join("+");if(cl[o])return cl[o];let r=ll.none;return e&&(r*=ll[e]),t.forEach(e=>{r*=ll[e]}),r}function ul(){const e=Ws();if(0===e.crops.length)return null;const t=e.crops.filter(e=>e.isMature);if(0===t.length)return null;let n=null;return t.forEach((e,t)=>{const{mutation:o,weather:r}=function(e){let t=null;const n=[];for(const o of e){const e=o.toLowerCase();"golden"===e||"gold"===e?t="golden":"rainbow"===e?t="rainbow":"wet"===e?n.push("wet"):"chilled"===e?n.push("chilled"):"frozen"===e?n.push("frozen"):"dawnlit"===e?n.push("dawnlit"):"dawnbound"===e?n.push("dawnbound"):"amberlit"===e?n.push("amberlit"):"amberbound"===e&&n.push("amberbound")}return{mutation:t,weather:n}}(e.mutations),i=function(e,t){const n=[{weather:"wet",event:"Rain"},{weather:"chilled",event:"Frost"},{weather:"frozen",event:"Rain+Frost"},{weather:"dawnlit",event:"Dawn"},{weather:"amberlit",event:"Amber Moon"}];let o=null;for(const{weather:r,event:i}of n){if(t.includes(r))continue;if("dawnlit"===r&&t.some(e=>"amberlit"===e||"amberbound"===e))continue;if("amberlit"===r&&t.some(e=>"dawnlit"===e||"dawnbound"===e))continue;if("wet"===r&&t.includes("chilled"))continue;if("chilled"===r&&t.includes("wet"))continue;const n=dl(e,[...t,r]);(!o||n>o.multiplier)&&(o={weather:r,multiplier:n,weatherEventName:i})}return o}(o,r);if(!i)return;const a=dl(o,r),s=e.currentValue*Math.max(1,e.fruitCount),l=s/a*i.multiplier,c=l-s;(!n||c>n.valueDifference)&&(n={cropSpecies:e.species,cropIndex:t,currentMutations:[...e.mutations],currentMultiplier:a,currentValue:s,targetWeather:i.weather,targetMultiplier:i.multiplier,targetValue:l,valueDifference:c,weatherEventName:i.weatherEventName})}),n}function pl(e,t){if("RainbowGranter"!==t&&"GoldGranter"!==t)return{effective:e,wastePercent:0};try{const t=Ws(),n=t.crops.length,o=t.uncoloredCrops.length;if(0===n)return{effective:0,wastePercent:100};const r=o/n;return{effective:e*r,wastePercent:100*(1-r)}}catch(n){return s("‚ö†Ô∏è Failed to calculate effective proc rate",n),{effective:e,wastePercent:0}}}function ml(e,t,n){const o=n?n>0?60/n:null:t;if(!o||o<=0)return{text:"‚Äî",isOverdue:!1};const r=e+60*o*1e3-Date.now();if(r<0){const e=Math.abs(r),t=Math.floor(e/36e5),n=Math.floor(e%36e5/6e4),o=Math.floor(e%6e4/1e3);return t>0?{text:`-${t}h ${n}m ${o}s`,isOverdue:!0}:n>0?{text:`-${n}m ${o}s`,isOverdue:!0}:{text:`-${o}s`,isOverdue:!0}}const i=Math.floor(r/36e5),a=Math.floor(r%36e5/6e4),s=Math.floor(r%6e4/1e3);return i>0?{text:`${i}h ${a}m ${s}s`,isOverdue:!1}:a>0?{text:`${a}m ${s}s`,isOverdue:!1}:{text:`${s}s`,isOverdue:!1}}function fl(e,t,n,o=!1,r){const i=n.insertRow();i.style.cssText="border-bottom: 1px solid var(--qpm-border);",i.dataset.petIndex=String(e.petIndex),i.dataset.abilityId=e.definition.id;const{effective:a,wastePercent:l}=pl(e.procsPerHour,e.definition.id),c=i.insertCell(),d=e.pet.strength,u=null!=d?` (STR ${d})`:"";c.textContent=e.displayName+u,c.style.cssText="\n    padding: 10px 12px;\n    color: var(--qpm-text);\n    font-weight: 500;\n    white-space: nowrap;\n  ",c.title=`Pet: ${e.displayName}${null!=d?`\nStrength: ${d}`:"\nStrength: Unknown"}`;const p=i.insertCell();p.textContent=t,p.style.cssText="\n    padding: 10px 12px;\n    color: var(--qpm-text);\n    white-space: nowrap;\n  ",l>0&&(p.title=`‚ö†Ô∏è ${l.toFixed(1)}% proc waste (targeting colored plants)`);const m=i.insertCell(),f=e.pet.strength??100,g=e.definition.baseProbability??0,h=g/60*f/100,b=60*h,y=`${b.toFixed(2)}%/min`;m.innerHTML=l>0?`${y} <span style="color: var(--qpm-warning); font-size: 10px;">(-${l.toFixed(0)}%)</span>`:y,m.style.cssText="\n    padding: 10px 12px;\n    text-align: right;\n    color: var(--qpm-text);\n    font-family: monospace;\n    white-space: nowrap;\n  ",m.title=l>0?`Base Chance: ${g.toFixed(2)}%/min\nWith STR ${f}: ${b.toFixed(2)}%/min\nPer Second: ${h.toFixed(3)}%/sec\n${l.toFixed(1)}% waste from colored plants`:`Base Chance: ${g.toFixed(2)}%/min\nWith STR ${f}: ${b.toFixed(2)}%/min\nPer Second: ${h.toFixed(3)}%/sec (game checks every second)`;const x=i.insertCell();x.textContent=a.toFixed(2),x.style.cssText="\n    padding: 10px 12px;\n    text-align: right;\n    color: var(--qpm-text);\n    font-family: monospace;\n  ",x.title=l>0?`Base: ${e.procsPerHour.toFixed(2)}/hr\nEffective: ${a.toFixed(2)}/hr after waste`:`${e.procsPerHour.toFixed(2)} procs/hour`;const w=i.insertCell(),v=e.effectPerProc??0,C=o?so:lo;w.textContent=v>0?C(v):"‚Äî",w.style.cssText=`\n    padding: 10px 12px;\n    text-align: right;\n    color: ${v>0?"var(--qpm-warning)":"var(--qpm-text-muted)"};\n    font-family: monospace;\n    font-weight: 500;\n  `,e.effectDetail&&(w.title=e.effectDetail),!o&&v>0&&(w.title=`Exact: ${so(v)}`);const T=i.insertCell(),S=a*(v>0?v:0);if(T.textContent=S>0?C(S):"‚Äî",T.style.cssText=`\n    padding: 10px 12px;\n    text-align: right;\n    color: ${S>0?"var(--qpm-warning)":"var(--qpm-text-muted)"};\n    font-family: monospace;\n    font-weight: 600;\n  `,l>0&&S>0){const t=e.procsPerHour*(v>0?v:0);T.title=`Base: ${so(t)}/hr\nEffective: ${so(S)}/hr after ${l.toFixed(0)}% waste`}else!o&&S>0&&(T.title=`Exact: ${so(S)}/hr`);const P=i.insertCell();P.className="eta-countdown";const A=a>0?60/a:0;if(a>0){let t,n;if(e.lastProcAt&&e.lastProcAt>0)t=e.lastProcAt,n=!1;else{const o=`${e.petIndex}:${e.definition.id}`,i=r?.get(o);t=i||Date.now(),n=!0}P.dataset.lastProc=String(t),P.dataset.effectiveRate=String(a),P.dataset.normalColor="var(--qpm-positive)",P.dataset.isEstimate=n?"true":"false";const o=ml(t,e.expectedMinutesBetween,a);P.textContent=o.text,P.style.cssText=`\n      padding: 10px 12px;\n      text-align: right;\n      color: ${o.isOverdue?"var(--qpm-danger)":"var(--qpm-positive)"};\n      font-family: monospace;\n      font-weight: 500;\n      white-space: nowrap;\n    `,P.title=n?`Estimated ${A.toFixed(1)} minutes between procs\nNo proc history yet`:`Average ${A.toFixed(1)} minutes between procs\nLast proc: ${new Date(e.lastProcAt).toLocaleTimeString()}`}else P.textContent="‚Äî",P.style.cssText="\n      padding: 10px 12px;\n      text-align: right;\n      color: var(--qpm-text-muted);\n      font-family: monospace;\n      font-weight: 500;\n      white-space: nowrap;\n    ",P.title="No proc rate available";if(o){const t=n.insertRow();t.style.cssText="\n      background: var(--qpm-surface-2);\n      border-bottom: 1px solid var(--qpm-border);\n    ";const o=t.insertCell();o.colSpan=7,o.style.cssText="\n      padding: 8px 12px;\n      font-size: 11px;\n      color: var(--qpm-text-muted);\n      line-height: 1.6;\n    ";const r=e.pet.strength??100,i=e.definition.baseProbability??0,a=r/100,c=i*a,d=[];if(i>0&&d.push(`<strong>Chance Per Minute:</strong> ${i.toFixed(2)}% √ó ${r} = ${c.toFixed(2)}%`),e.definition.effectLabel&&null!=e.definition.effectBaseValue){const t=e.definition.effectBaseValue*a,n=e.definition.effectSuffix??"";d.push(`<strong>${e.definition.effectLabel}:</strong> ${e.definition.effectBaseValue}${n} √ó ${r} = ${t.toFixed(1)}${n}`)}if("ProduceMutationBoost"===e.definition.id||"ProduceMutationBoostII"===e.definition.id)try{const e=ul();if(e){const t=function(e,t){if(!e)return"No mutation opportunities found";const n=(e.weatherEventName.includes("Dawn")||e.weatherEventName.includes("Amber")?1:7)*(t/100);return`Best: ${e.cropSpecies} ‚Üí ${e.weatherEventName} (${n.toFixed(2)}% chance, +${(e.targetMultiplier/e.currentMultiplier).toFixed(1)}√ó value)`}(e,r);d.push(`<strong>üåü Opportunity:</strong> ${t}`)}}catch(k){s("‚ö†Ô∏è Failed to calculate mutation opportunity",k)}if("observed"===e.procsPerHourSource?d.push(`<strong>Data Source:</strong> Observed (${e.sampleCount} sample${1!==e.sampleCount?"s":""})`):d.push("<strong>Data Source:</strong> Estimated from ability definition"),l>0){const e=Ws();d.push(`<strong>Efficiency:</strong> ${(100-l).toFixed(1)}% (${e.uncoloredCrops.length}/${e.crops.length} uncolored crops)`)}if(e.lastProcAt){const t=new Date(e.lastProcAt),n=Date.now()-e.lastProcAt,o=Math.floor(n/6e4),r=Math.floor(o/60),i=r>0?`${r}h ${o%60}m ago`:`${o}m ago`;d.push(`<strong>Last Proc:</strong> ${t.toLocaleTimeString()} (${i})`)}o.innerHTML=d.join(" ‚Ä¢ ")}return i}let gl={stats:{wetCount:0,wetPerHour:0,wetTotalValue:0,wetLastAt:null,chilledCount:0,chilledPerHour:0,chilledTotalValue:0,chilledLastAt:null,frozenCount:0,frozenPerHour:0,frozenTotalValue:0,frozenLastAt:null,dawnlitCount:0,dawnlitPerHour:0,dawnlitTotalValue:0,dawnlitLastAt:null,dawnboundCount:0,dawnboundPerHour:0,dawnboundTotalValue:0,dawnboundLastAt:null,amberlitCount:0,amberlitPerHour:0,amberlitTotalValue:0,amberlitLastAt:null,amberboundCount:0,amberboundPerHour:0,amberboundTotalValue:0,amberboundLastAt:null,sessionValue:0,sessionStart:Date.now(),bestHourValue:0,bestHourTime:null,bestSessionValue:0,bestSessionTime:null},updatedAt:Date.now()},hl=new Map;const bl=new Set;function yl(e){const t=[e.species,e.seedSpecies,e.plantSpecies,e.cropSpecies,e.name];for(const n of t)if("string"==typeof n){const e=n.trim();if(e.length>0)return e}return null}function xl(){return{stats:{...gl.stats},updatedAt:gl.updatedAt}}function wl(e){return bl.add(e),e(xl()),()=>bl.delete(e)}function vl(){gl={stats:{wetCount:0,wetPerHour:0,wetTotalValue:0,wetLastAt:null,chilledCount:0,chilledPerHour:0,chilledTotalValue:0,chilledLastAt:null,frozenCount:0,frozenPerHour:0,frozenTotalValue:0,frozenLastAt:null,dawnlitCount:0,dawnlitPerHour:0,dawnlitTotalValue:0,dawnlitLastAt:null,dawnboundCount:0,dawnboundPerHour:0,dawnboundTotalValue:0,dawnboundLastAt:null,amberlitCount:0,amberlitPerHour:0,amberlitTotalValue:0,amberlitLastAt:null,amberboundCount:0,amberboundPerHour:0,amberboundTotalValue:0,amberboundLastAt:null,sessionValue:0,sessionStart:Date.now(),bestHourValue:gl.stats.bestHourValue,bestHourTime:gl.stats.bestHourTime,bestSessionValue:gl.stats.bestSessionValue,bestSessionTime:gl.stats.bestSessionTime},updatedAt:Date.now()},hl=new Map;const e=function(e){const t=[];if(!e)return t;const n=[{tiles:e.tileObjects},{tiles:e.boardwalkTileObjects}];for(const{tiles:o}of n)if(o&&"object"==typeof o)for(const[e,n]of Object.entries(o)){if(!n||"object"!=typeof n)continue;const o=n;"plant"===o.objectType&&(Array.isArray(o.slots)?o.slots:[]).forEach((n,o)=>{if(!n||"object"!=typeof n)return;const r=n,i=(Array.isArray(r.mutations)?r.mutations:[]).map(e=>"string"==typeof e?e:null).filter(e=>!!e);if(0===i.length)return;const a=yl(r),s=nn(i);t.push({tileId:e,slotIndex:o,cropName:a,mutations:i,slotState:s})})}return t}(In());for(const n of e){const e=`${n.tileId}-${n.slotIndex}`,t=new Set;n.slotState.hasWet&&t.add("wet"),n.slotState.hasChilled&&t.add("chilled"),n.slotState.hasFrozen&&t.add("frozen"),n.slotState.hasDawnlit&&t.add("dawnlit"),n.slotState.hasDawnbound&&t.add("dawnbound"),n.slotState.hasAmberlit&&t.add("amberlit"),n.slotState.hasAmberbound&&t.add("amberbound"),t.size>0&&hl.set(e,t)}try{f.set("qpm.weatherMutationTracking.v1",function(){const e=[];for(const[t,n]of hl.entries())e.push([t,Array.from(n)]);return{version:2,stats:{...gl.stats},updatedAt:gl.updatedAt,trackedSlots:e}}())}catch(t){console.error("[weatherMutationTracking] Failed to save after reset:",t)}!function(){for(const e of bl)try{e(gl)}catch(t){console.error("[weatherMutationTracking] Listener error:",t)}}(),console.log(`[QPM] üîÑ Weather mutation tracking reset - ${hl.size} existing slots marked as seen`)}const Cl="qpm.mutationValueTracking.v1",Tl=36e5,Sl=5e5,Pl=1e6,Al=5e6;let kl={stats:{goldProcs:0,goldPerHour:0,goldTotalValue:0,goldLastProcAt:null,rainbowProcs:0,rainbowPerHour:0,rainbowTotalValue:0,rainbowLastProcAt:null,cropBoostProcs:0,cropBoostPerHour:0,cropBoostTotalValue:0,cropBoostLastProcAt:null,sessionValue:0,sessionStart:Date.now(),bestHourValue:0,bestHourTime:null,bestSessionValue:0,bestSessionTime:null},sessions:[],hourlyBreakdown:new Map,updatedAt:Date.now()},El=!1;const $l=new Set;function Ml(e,t){const n=Ts();let o=0,r=null;for(const i of n.values())if(i.abilityId===e){const e=i.events.filter(e=>e.performedAt>=t);if(o+=e.length,e.length>0){const t=Math.max(...e.map(e=>e.performedAt));(null===r||t>r)&&(r=t)}}return{count:o,lastProcAt:r}}function Fl(){const e=Date.now(),t=kl.stats.sessionStart,n=Math.max(1,e-t)/Tl,o=Ws(),r=Vs("GoldGranter",o,null),i=Vs("RainbowGranter",o,null),a=Vs("ProduceScaleBoost",o,null),s=Vs("ProduceScaleBoostII",o,null),l=r?.effectPerProc||Sl,c=i?.effectPerProc||Pl,d=a?.effectPerProc||Al,u=s?.effectPerProc||Al,p=Ml("GoldGranter",t);kl.stats.goldProcs=p.count,kl.stats.goldLastProcAt=p.lastProcAt,kl.stats.goldTotalValue=p.count*l,kl.stats.goldPerHour=n>0?p.count/n:0;const m=Ml("RainbowGranter",t);kl.stats.rainbowProcs=m.count,kl.stats.rainbowLastProcAt=m.lastProcAt,kl.stats.rainbowTotalValue=m.count*c,kl.stats.rainbowPerHour=n>0?m.count/n:0;const f=Ml("ProduceScaleBoost",t),g=Ml("ProduceScaleBoostII",t),h=f.count+g.count,b=f.lastProcAt&&g.lastProcAt?Math.max(f.lastProcAt,g.lastProcAt):f.lastProcAt||g.lastProcAt,y=f.count*d+g.count*u;kl.stats.cropBoostProcs=h,kl.stats.cropBoostLastProcAt=b,kl.stats.cropBoostTotalValue=y,kl.stats.cropBoostPerHour=n>0?h/n:0,kl.stats.sessionValue=kl.stats.goldTotalValue+kl.stats.rainbowTotalValue+kl.stats.cropBoostTotalValue,function(e){const t=new Map,n=Vs("GoldGranter",e,null),o=Vs("RainbowGranter",e,null),r=Vs("ProduceScaleBoost",e,null),i=Vs("ProduceScaleBoostII",e,null),a=n?.effectPerProc||Sl,s=o?.effectPerProc||Pl,l=r?.effectPerProc||Al,c=i?.effectPerProc||Al,d=Ts();for(const u of d.values())for(const e of u.events){const n=new Date(e.performedAt).getHours();let o=0;if("GoldGranter"===u.abilityId?o=a:"RainbowGranter"===u.abilityId?o=s:"ProduceScaleBoost"===u.abilityId?o=l:"ProduceScaleBoostII"===u.abilityId&&(o=c),o>0){const e=t.get(n)||{value:0,count:0};e.value+=o,e.count+=1,t.set(n,e)}}kl.hourlyBreakdown=new Map;for(const[u,p]of t)kl.hourlyBreakdown.set(u,p.value/Math.max(1,p.count))}(o);const x=function(e,t){const n=e-Tl,o=Ml("GoldGranter",n),r=Ml("RainbowGranter",n),i=Ml("ProduceScaleBoost",n),a=Ml("ProduceScaleBoostII",n),s=Vs("GoldGranter",t,null),l=Vs("RainbowGranter",t,null),c=Vs("ProduceScaleBoost",t,null),d=Vs("ProduceScaleBoostII",t,null),u=s?.effectPerProc||Sl,p=l?.effectPerProc||Pl,m=c?.effectPerProc||Al,f=d?.effectPerProc||Al;return o.count*u+r.count*p+i.count*m+a.count*f}(e,o);x>kl.stats.bestHourValue&&(kl.stats.bestHourValue=x,kl.stats.bestHourTime=e),kl.stats.sessionValue>kl.stats.bestSessionValue&&(kl.stats.bestSessionValue=kl.stats.sessionValue,kl.stats.bestSessionTime=e),kl.updatedAt=e,Il(),zl()}const Il=d(()=>{try{f.set(Cl,Ll())}catch(e){console.error("[mutationValueTracking] Failed to save:",e)}},3e3);function Ll(){return{version:1,stats:{goldProcs:kl.stats.goldProcs,goldPerHour:kl.stats.goldPerHour,goldTotalValue:kl.stats.goldTotalValue,goldLastProcAt:kl.stats.goldLastProcAt,rainbowProcs:kl.stats.rainbowProcs,rainbowPerHour:kl.stats.rainbowPerHour,rainbowTotalValue:kl.stats.rainbowTotalValue,rainbowLastProcAt:kl.stats.rainbowLastProcAt,cropBoostProcs:kl.stats.cropBoostProcs,cropBoostPerHour:kl.stats.cropBoostPerHour,cropBoostTotalValue:kl.stats.cropBoostTotalValue,cropBoostLastProcAt:kl.stats.cropBoostLastProcAt,sessionValue:kl.stats.sessionValue,sessionStart:kl.stats.sessionStart,bestHourValue:kl.stats.bestHourValue,bestHourTime:kl.stats.bestHourTime,bestSessionValue:kl.stats.bestSessionValue,bestSessionTime:kl.stats.bestSessionTime},sessions:kl.sessions,updatedAt:kl.updatedAt}}function zl(){for(const t of $l)try{t(kl)}catch(e){console.error("[mutationValueTracking] Listener error:",e)}}function Nl(){if(!El){El=!0;try{!function(e){e&&1===e.version&&(kl.stats.bestHourValue=e.stats.bestHourValue||0,kl.stats.bestHourTime=e.stats.bestHourTime||null,kl.stats.bestSessionValue=e.stats.bestSessionValue||0,kl.stats.bestSessionTime=e.stats.bestSessionTime||null,kl.sessions=e.sessions||[],kl.stats.sessionStart=Date.now(),kl.updatedAt=Date.now())}(f.get(Cl,null)),s("üîÑ Mutation value tracking initialized - session data reset, tracking only current session")}catch(e){console.error("[mutationValueTracking] Failed to restore:",e)}Fl(),setInterval(()=>{Fl()},1e4)}}function ql(){return{stats:{...kl.stats},sessions:[...kl.sessions],hourlyBreakdown:new Map(kl.hourlyBreakdown),updatedAt:kl.updatedAt}}function Bl(e){return $l.add(e),e(ql()),()=>$l.delete(e)}function Rl(){!function(){const e=Date.now(),t=new Date(e).toISOString().split("T")[0];(kl.stats.sessionValue>0||kl.stats.goldProcs+kl.stats.rainbowProcs+kl.stats.cropBoostProcs>0)&&(kl.sessions.push({date:t,value:kl.stats.sessionValue,goldProcs:kl.stats.goldProcs,rainbowProcs:kl.stats.rainbowProcs,cropBoostProcs:kl.stats.cropBoostProcs,duration:e-kl.stats.sessionStart}),kl.sessions.length>30&&(kl.sessions=kl.sessions.slice(-30)))}(),vl();const e=Date.now();kl={stats:{goldProcs:0,goldPerHour:0,goldTotalValue:0,goldLastProcAt:null,rainbowProcs:0,rainbowPerHour:0,rainbowTotalValue:0,rainbowLastProcAt:null,cropBoostProcs:0,cropBoostPerHour:0,cropBoostTotalValue:0,cropBoostLastProcAt:null,sessionValue:0,sessionStart:e,bestHourValue:kl.stats.bestHourValue,bestHourTime:kl.stats.bestHourTime,bestSessionValue:kl.stats.bestSessionValue,bestSessionTime:kl.stats.bestSessionTime},sessions:kl.sessions,hourlyBreakdown:new Map,updatedAt:Date.now()};try{f.set(Cl,Ll())}catch(t){console.error("[mutationValueTracking] Failed to save after reset:",t)}zl(),s("‚úÖ [MUTATION-VALUE] Reset complete - session stats cleared")}const Dl="myInventoryAtom",Hl="myCropInventoryAtom";let jl=[],Wl=new Set,Gl=null,Ol=!1;function Vl(e){if(!e||"object"!=typeof e)return null;const t=e.species??e.name??e.displayName??e.itemId??e.id,n=String(t??"").trim();return n?{id:n,itemId:e.itemId,species:e.species??e.petSpecies??null,name:e.name??e.displayName??null,displayName:e.displayName??e.name??null,itemType:e.itemType??null,quantity:e.quantity??e.count??e.amount??e.stackSize,count:e.count,amount:e.amount,stackSize:e.stackSize,abilities:e.abilities??e.pet?.abilities,strength:e.strength??e.pet?.strength,raw:e}:null}function _l(e){if(!e)return null;let t=[];if(Array.isArray(e))t=e;else if(Array.isArray(e.items))t=e.items;else if(Array.isArray(e.inventory))t=e.inventory;else if("object"==typeof e){const n=Object.values(e).find(e=>Array.isArray(e)&&e.length>0&&"object"==typeof e[0]);n&&(t=n)}const n=[];for(const r of t){const e=Vl(r);e&&n.push(e)}let o=[];return Array.isArray(e?.favoritedItemIds)?o=e.favoritedItemIds.filter(e=>"string"==typeof e):Array.isArray(e?.favorites)&&(o=e.favorites.filter(e=>"string"==typeof e)),{items:n,favoritedItemIds:o}}async function Ul(){if(!Gl&&!Ol){Ol=!0;try{let e=F(Dl);if(e||(s("‚ö†Ô∏è myInventoryAtom not found, trying myCropInventoryAtom"),e=F(Hl)),!e)return s("‚ö†Ô∏è Inventory atom not found"),void(Ol=!1);Gl=await L(e,e=>{!function(e){const t=_l(e);t?(jl=t.items,Wl=new Set(t.favoritedItemIds??[])):(jl=[],Wl=new Set)}(e)}),s("‚úÖ Inventory store initialized")}catch(e){s("‚ùå Failed to initialize inventory store",e)}finally{Ol=!1}}}function Xl(){return[...jl]}async function Kl(){try{let e=F(Dl);if(e||(e=F(Hl)),!e)return s("‚ö†Ô∏è Inventory atom not found"),null;return _l(await I(e))}catch(e){return s("‚ùå Failed to read inventory atom",e),null}}const Jl="qpm.autoFavorite.v1";let Ql={enabled:!1,species:[],mutations:[],petAbilities:[],filterByAbilities:[],filterByAbilityCount:null,filterBySpecies:[],filterByCropTypes:[]};const Yl=new Set;let Zl=null,ec=new Set;function tc(){try{f.set(Jl,Ql),function(){for(const t of Yl)try{t({...Ql})}catch(e){s("‚ö†Ô∏è Auto-favorite listener error",e)}}()}catch(e){s("‚ö†Ô∏è Failed to save auto-favorite config",e)}}function nc(e){const t=b;if(!t?.myData?.inventory?.items)return void s("üåü [AUTO-FAVORITE] No myData available yet - waiting for game to load");const n=t.myData.inventory.items,o=new Set(t.myData.inventory.favoritedItemIds||[]);let r=0;for(const i of n)"Produce"===i.itemType&&"Pet"!==i.itemType&&"Egg"!==i.itemType&&"Tool"!==i.itemType&&"Pet"!==i.category&&"Egg"!==i.category&&"Tool"!==i.category&&(i.species&&(i.species.includes("Pet")||i.species.includes("Egg"))||i.species!==e||o.has(i.id)||cc(i.id)&&r++);s(r>0?`‚úÖ [AUTO-FAVORITE] Favorited ${r} ${e} crops`:`‚ÑπÔ∏è [AUTO-FAVORITE] No ${e} crops to favorite (already favorited or none in inventory)`)}function oc(e){s(`üîí [AUTO-FAVORITE] Checkbox unchecked for ${e} - Auto-favorite disabled, but existing favorites are preserved (script never removes favorites)`)}function rc(e){const t=b;if(!t?.myData?.inventory?.items)return void s("üåü [AUTO-FAVORITE] No myData available yet - waiting for game to load");const n=t.myData.inventory.items,o=new Set(t.myData.inventory.favoritedItemIds||[]);let r=0;for(const i of n){if("Produce"!==i.itemType)continue;if("Pet"===i.itemType||"Egg"===i.itemType||"Tool"===i.itemType)continue;if("Pet"===i.category||"Egg"===i.category||"Tool"===i.category)continue;if(i.species&&(i.species.includes("Pet")||i.species.includes("Egg")))continue;(i.mutations||[]).includes(e)&&!o.has(i.id)&&cc(i.id)&&r++}s(r>0?`‚úÖ [AUTO-FAVORITE] Favorited ${r} crops with ${e} mutation`:`‚ÑπÔ∏è [AUTO-FAVORITE] No crops with ${e} mutation to favorite (already favorited or none in inventory)`)}function ic(e){s(`üîí [AUTO-FAVORITE] Checkbox unchecked for ${e} mutation - Auto-favorite disabled, but existing favorites are preserved (script never removes favorites)`)}function ac(e){const t=b;if(!t?.myData?.inventory?.items)return void s("üåü [AUTO-FAVORITE-PET] No myData available yet - waiting for game to load");s(`üîç [AUTO-FAVORITE-PET] Searching for pets with ${e}...`);const n=t.myData.inventory.items,o=new Set(t.myData.inventory.favoritedItemIds||[]);let r=0,i=0;const a=n.find(e=>"Pet"===e.itemType);a&&s("üêæ [AUTO-FAVORITE-PET-DEBUG] Sample pet structure:",{species:a.petSpecies,mutations:a.mutations,abilities:a.abilities,hasAbilitiesArray:Array.isArray(a.abilities),hasMutationsArray:Array.isArray(a.mutations)});for(const l of n){if("Pet"!==l.itemType)continue;if(i++,o.has(l.id))continue;const t=l.mutations||[],n=t.includes("Gold"),a=t.includes("Rainbow"),c=l.abilities||[],d=c.some(e=>{const t="string"==typeof e?e:e?.type||e?.abilityType||"";return t.toLowerCase().includes("gold")&&t.toLowerCase().includes("grant")}),u=c.some(e=>{const t="string"==typeof e?e:e?.type||e?.abilityType||"";return t.toLowerCase().includes("rainbow")&&t.toLowerCase().includes("grant")});("Gold Granter"===e&&(n||d)||"Rainbow Granter"===e&&(a||u))&&(s(`‚ú® [AUTO-FAVORITE-PET] Found matching pet: ${l.petSpecies||l.species} (${l.id}) - mutations: [${t.join(", ")}], abilities: ${c.length}`),cc(l.id)&&r++)}s(`‚úÖ [AUTO-FAVORITE-PET] Scanned ${i} pets, favorited ${r} with ${e}`)}function sc(e){s(`üîí [AUTO-FAVORITE-PET] Checkbox unchecked for ${e} - Auto-favorite disabled, but existing favorites are preserved (script never removes favorites)`)}function lc(){try{const e=b;return e?.__mga_lastScopePath?.slice()??["Room","Quinoa"]}catch{return["Room","Quinoa"]}}function cc(e){try{const t=b,n=t?.MagicCircle_RoomConnection;return!(!n||"function"!=typeof n.sendMessage)&&(n.sendMessage({scopePath:lc(),type:"ToggleFavoriteItem",itemId:e}),!0)}catch(t){return s(`‚ö†Ô∏è Failed to favorite item ${e}`,t),!1}}function dc(){null===Zl&&(Zl=window.setInterval(()=>{if(!Ql.enabled)return;const e=Ql.species||[],t=Ql.mutations||[],n=Ql.petAbilities||[];if(0===e.length&&0===t.length&&0===n.length)return;if(null===Gl)return;const o=Xl(),r=new Set(Wl),i=new Set;for(const s of o)s?.id&&i.add(s.id);const a=new Set;for(const s of i)ec.has(s)||a.add(s);if(a.size>0){const i=o.filter(e=>e.id&&a.has(e.id));for(const o of i){if(r.has(o.id))continue;const i=o.raw,a=Array.isArray(i?.mutations)?i.mutations:[],l=Array.isArray(o.abilities)?o.abilities:Array.isArray(i?.abilities)?i.abilities:[],c=i?.itemType||o.itemType;let d=!1,u="";if("Pet"===c){if(Ql.filterByAbilities&&Ql.filterByAbilities.length>0&&s("[AUTO-FAVORITE-DEBUG] Pet detected:",{species:o.species,abilitiesFromItem:o.abilities,abilitiesFromRaw:i?.abilities,abilitiesUsed:l,filterByAbilities:Ql.filterByAbilities}),Ql.filterBySpecies&&Ql.filterBySpecies.length>0){const e=i?.petSpecies||i?.species||o.species||"";if(!Ql.filterBySpecies.includes(e))continue;d=!0,u="filtered species"}if(Ql.filterByAbilities&&Ql.filterByAbilities.length>0){if(!Ql.filterByAbilities.some(e=>l.some(t=>{const n=("string"==typeof t?t:t?.type||t?.abilityType||"").toLowerCase(),o=e.toLowerCase();return n.includes(o)||n===o})))continue;d=!0,u="filtered ability"}if(null!=Ql.filterByAbilityCount){if(l.length!==Ql.filterByAbilityCount)continue;d||(d=!0,u=`${Ql.filterByAbilityCount} abilities`)}if(Ql.filterByAbilities&&Ql.filterByAbilities.length>0){const e=a.includes("Gold"),t=a.includes("Rainbow"),n=l.some(e=>{const t="string"==typeof e?e:e?.type||e?.abilityType||"";return t.toLowerCase().includes("gold")&&t.toLowerCase().includes("grant")}),o=l.some(e=>{const t="string"==typeof e?e:e?.type||e?.abilityType||"";return t.toLowerCase().includes("rainbow")&&t.toLowerCase().includes("grant")});Ql.filterByAbilities.some(e=>e.toLowerCase().includes("goldgranter")||"gold granter"===e.toLowerCase())&&(e||n)&&(d=!0,u="Gold Granter"),Ql.filterByAbilities.some(e=>e.toLowerCase().includes("rainbowgranter")||"rainbow granter"===e.toLowerCase())&&(t||o)&&(d=!0,u="Rainbow Granter")}if(n.length>0&&l.length>0){const e=l.find(e=>n.some(t=>t.toLowerCase()===String(e).toLowerCase()));e&&(d=!0,u=`ability: ${e}`)}}else if("Produce"===c){if(Ql.filterByCropTypes&&Ql.filterByCropTypes.length>0){const e=i?.species||o.species||"";if(!Ql.filterByCropTypes.includes(e))continue;d=!0,u="filtered crop"}if(t.length>0&&a.length>0){const e=a.find(e=>t.some(t=>t.toLowerCase()===String(e).toLowerCase()));e&&(d=!0,u=`mutation: ${e}`)}if(e.length>0&&o.species){e.some(e=>e.toLowerCase()===o.species.toLowerCase())&&(d=!0,u=`species: ${o.species}`)}}d&&(s(`[AUTO-FAVORITE] Favoriting ${o.species||"item"} (${u})`),cc(o.id))}}ec=i},2e3),s("‚úÖ Auto-favorite polling started (2 second interval)"))}function uc(){!function(){try{const e=f.get(Jl,null);if(e&&"object"==typeof e){const t=e=>Array.isArray(e)?e:e&&"string"==typeof e?[e]:[];Ql={enabled:e.enabled??Ql.enabled,species:e.species??Ql.species,mutations:e.mutations??Ql.mutations,petAbilities:e.petAbilities??Ql.petAbilities,filterByAbilities:t(e.filterByAbilities||e.filterByAbility),filterByAbilityCount:void 0!==e.filterByAbilityCount?e.filterByAbilityCount:Ql.filterByAbilityCount,filterBySpecies:t(e.filterBySpecies),filterByCropTypes:t(e.filterByCropTypes||e.filterByCropType)}}}catch(e){s("‚ö†Ô∏è Failed to load auto-favorite config",e)}}(),dc();const e=b;e.qpm_favoriteSpecies=nc,e.qpm_unfavoriteSpecies=oc,e.qpm_favoriteMutation=rc,e.qpm_unfavoriteMutation=ic,e.qpm_favoritePetAbility=ac,e.qpm_unfavoritePetAbility=sc,s("‚úÖ [AUTO-FAVORITE] System initialized - monitoring inventory changes",Ql)}function pc(){return{...Ql}}function mc(e){Ql={...Ql,...e},tc(),Ql.enabled&&dc()}const fc={Starweaver:{hardCooldownHours:9.08,practicalMinimumHours:190,allowedHours:[0,1,2,4,11,12,13,14],correlationItems:[{itemName:"Sunflower",windowHours:1,probability:.235}]},Dawnbinder:{hardCooldownHours:24,practicalMinimumHours:220,allowedHours:[7,12,18,21,22]},Moonbinder:{hardCooldownHours:24,practicalMinimumHours:200,allowedHours:[0,6,7,8,16],correlationItems:[{itemName:"Sunflower",windowHours:1,probability:.8}]},Sunflower:{hardCooldownHours:0,practicalMinimumHours:3,allowedHours:null,burstBehavior:{windowHours:3,probability:.411}},"Mythical Eggs":{hardCooldownHours:.25,practicalMinimumHours:18,allowedHours:null,correlationItems:[{itemName:"Sunflower",windowHours:1,probability:.409}]}};function gc(e,t,n){const o=n.filter(t=>t.items.some(t=>t.name===e)).map(e=>e.timestamp).sort((e,t)=>e-t);if(o.length<2)return null;const r=[];for(let m=1;m<o.length;m++)r.push(o[m]-o[m-1]);const i=r.reduce((e,t)=>e+t,0)/r.length,a=r.reduce((e,t)=>e+Math.pow(t-i,2),0)/r.length,s=Math.sqrt(a);var l;const c=t+((l=i)<100?10*Math.round(l/10):l<1e3?50*Math.round(l/50):l<1e4?100*Math.round(l/100):1e3*Math.round(l/1e3)),d=1.5*s,u=s/i;let p;return p=u<.3?"high":u<.6?"medium":"low",{estimatedTime:c,certaintyRange:{earliest:c-d,latest:c+d},confidence:p}}function hc(e,t,n,o){const r=fc[e];if(!r)return{itemName:e,nextWindows:[],tooEarly:!0,cooldownActive:!1,lastSeenTime:null,timeSinceLastSeen:null,hardCooldownRemaining:null,practicalMinimumRemaining:null};if(!t)return{itemName:e,nextWindows:[],tooEarly:!0,cooldownActive:!1,lastSeenTime:null,timeSinceLastSeen:null,hardCooldownRemaining:null,practicalMinimumRemaining:null,monitoringSchedule:{message:"No historical data - monitor optimal hours",optimalHours:r.allowedHours||Array.from({length:24},(e,t)=>t)}};const i=Date.now(),a=(i-t)/36e5,s=a<r.hardCooldownHours,l=s?r.hardCooldownHours-a:0,c=a<r.practicalMinimumHours,d=c?r.practicalMinimumHours-a:0,u=s||c?[]:function(e,t,n){const o=fc[e];if(!o?.correlationItems)return[];const r=[];for(const i of o.correlationItems){const e=t.filter(e=>e.items.some(e=>e.name===i.itemName)).sort((e,t)=>t.timestamp-e.timestamp);if(e.length>0){const t=e[0],o=(n-t.timestamp)/36e5;o<=i.windowHours&&r.push({itemName:i.itemName,detectedAt:t.timestamp,probability:i.probability,message:`${i.itemName} detected ${o.toFixed(1)}h ago (${(100*i.probability).toFixed(0)}% correlation)`})}}return r}(e,n,i),p=function(e,t,n){const o=fc[e];if(!o)return[];const r=[];if((n-t)/36e5<o.practicalMinimumHours)return[];if(!o.allowedHours){const e=n,t=n+864e5;return r.push({startTime:e,endTime:t,hour:new Date(e).getHours(),confidence:"medium",reason:"No time restrictions - can appear any hour"}),r}const i=new Date(n),a=i.getHours();for(let s=0;s<3;s++){for(const t of o.allowedHours){if(0===s&&t<=a)continue;const n=new Date(i);n.setDate(n.getDate()+s),n.setHours(t,0,0,0);const o=n.getTime(),l=o+36e5;let c="medium";if(("Starweaver"===e&&[0,1,2,12].includes(t)||"Dawnbinder"===e&&[7,12].includes(t)||"Moonbinder"===e&&[6,7,8].includes(t))&&(c="high"),r.push({startTime:o,endTime:l,hour:t,confidence:c,reason:`${t}:00 is an allowed window (${c} confidence)`}),r.length>=5)break}if(r.length>=5)break}return r}(e,t,i),m=gc(e,t,o),f=r.allowedHours?{message:"Optimal monitoring hours (all times local)",optimalHours:r.allowedHours}:void 0;return{itemName:e,nextWindows:p,tooEarly:c,cooldownActive:s,lastSeenTime:t,timeSinceLastSeen:a,hardCooldownRemaining:l,practicalMinimumRemaining:d,statisticalPrediction:m||void 0,correlationSignals:u.length>0?u:void 0,monitoringSchedule:f}}function bc(e){const t=new Date(e.startTime),n=new Date(e.endTime),o=t.toLocaleDateString(void 0,{month:"short",day:"numeric",year:t.getFullYear()!==(new Date).getFullYear()?"numeric":void 0}),r=t.toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit",hour12:!0}),i=n.toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit",hour12:!0});if(t.toDateString()===n.toDateString())return`${o}, ${r} - ${i}`;return`${o} ${r} - ${n.toLocaleDateString(void 0,{month:"short",day:"numeric"})} ${i}`}const yc="qpm.shopRestocks.v1",xc="qpm.shopRestockConfig.v1",wc="qpm.shopRestocks.migration",vc="qpm.shopRestocks.predictions.v1",Cc="qpm.shopRestocks.activePredictions.v1",Tc=["Mythical Eggs","Sunflower","Starweaver","Dawnbinder","Moonbinder"];let Sc=null,Pc="",Ac=0;const kc=9e5;let Ec=null,$c="",Mc=0,Fc=null,Ic="",Lc=0,zc=null,Nc="",qc=0;const Bc={Starweaver:"celestial",Dawnbinder:"celestial",Moonbinder:"celestial",Sunflower:"divine",Lychee:"divine","Dragon Fruit":"divine","Passion Fruit":"divine",Lemon:"divine",Pepper:"divine","Cacao Bean":"divine","Mythical Eggs":"mythic",Grape:"mythic",Chrysanthemum:"mythic",Bamboo:"mythic",Cactus:"mythic",Mushroom:"mythic",Lily:"rare","Burro's Tail":"rare",Echeveria:"rare","Legendary Eggs":"rare","Rare Eggs":"rare",Watermelon:"uncommon",Pumpkin:"uncommon","Uncommon Eggs":"uncommon",Carrot:"common",Strawberry:"common",Aloe:"common",Delphinium:"common",Blueberry:"common",Apple:"common",Tulip:"common",Tomato:"common",Daffodil:"common",Corn:"common",Coconut:"common",Banana:"common",Camellia:"common",Squash:"common","Fava Bean":"common"};function Rc(e){return Bc[e]||"common"}let Dc=[],Hc={importedFiles:[],watchedItems:[]},jc=!0,Wc=0;let Gc=new Map,Oc=new Map,Vc=[],_c=!1;function Uc(){if(_c)s("üìä Restock tracker already initialized, skipping reload");else try{const e=f.get(yc,[]);Dc=e,Dc.length>1&&(Dc.sort((e,t)=>e.timestamp-t.timestamp),jc=!0);const t=f.get(xc,{importedFiles:[],watchedItems:[]});Hc=t;const n=f.get(vc,{});Gc=new Map(Object.entries(n));const o=f.get(Cc,{});Oc=new Map(Object.entries(o)),s(`üìä Loaded ${Oc.size} active predictions from storage`);const r=function(){if(f.get(wc,0)>=1)return 0;if(0===Dc.length)return f.set(wc,1),0;s("üîÑ Migrating restock data to fix timezone interpretation...");const e=60*-(new Date).getTimezoneOffset()*1e3-36e6;let t=0;for(const n of Dc)n.timestamp+=e,t++;return t>0&&(f.set(yc,Dc),s(`‚úÖ Migrated ${t} restock events (adjusted by ${(e/36e5).toFixed(1)} hours)`)),f.set(wc,1),t}();!function(){if(0===Dc.length)return;let e=0;for(const t of Tc){const n=Gc.get(t);if(n&&n.length>0)continue;const o=Dc.filter(e=>e.items.some(e=>e.name===t)).sort((e,t)=>t.timestamp-e.timestamp).slice(0,3);if(o.length>0){const n=o.map(e=>({itemName:t,predictedTime:null,predictionMadeAt:null,actualTime:e.timestamp,differenceMinutes:null,differenceMs:null}));Gc.set(t,n),e+=o.length,s(`üìä Backfilled ${o.length} restock(s) for ${t}`)}}e>0&&(nd(),s(`‚úÖ Backfilled ${e} total restock records into prediction history`))}(),_c=!0,od(),r>0?(s(`üìä Loaded ${Dc.length} restock events from storage (${r} migrated to correct timezone)`),setTimeout(()=>{Ci({feature:"shop-restock-tracker",level:"success",message:`‚úÖ Updated ${r} restock times to correct timezone`})},2e3)):s(`üìä Loaded ${Dc.length} restock events from storage`)}catch(e){s("‚ö†Ô∏è Failed to load restock data",e)}}function Xc(e=!1){try{const t=Date.now();if(e||t-Wc>15e3){const e=f.get(yc,[]),n=new Set(Dc.map(e=>e.id));let o=0;for(const t of e)n.has(t.id)||(Dc.push(t),n.add(t.id),o++,jc=!1);o>0&&s(`dY", Merged ${o} events from storage (multi-tab sync)`),Wc=t}jc||(Dc.sort((e,t)=>e.timestamp-t.timestamp),jc=!0),f.set(yc,Dc),f.set(xc,Hc)}catch(t){s("?s??,? Failed to save restock data",t)}}function Kc(e){if(Dc.some(t=>t.id===e.id))return void s("?s??,? Duplicate restock event skipped");const t=Dc[Dc.length-1]?.timestamp??null;Dc.push(e),null!=t&&e.timestamp<t&&(jc=!1),s(`?o. Saved restock event (${e.source}): Total ${Dc.length} events`),function(e){for(const t of e.items){if(!Tc.includes(t.name))continue;const n=Oc.get(t.name),o={itemName:t.name,predictedTime:n||null,predictionMadeAt:n?Date.now():null,actualTime:e.timestamp,differenceMinutes:n?Math.round((e.timestamp-n)/6e4):null,differenceMs:n?e.timestamp-n:null};let r=Gc.get(t.name)||[];r.unshift(o),r.length>3&&(r=r.slice(0,3)),Gc.set(t.name,r),n?(Oc.delete(t.name),rd(),s(`üìä Prediction accuracy for ${t.name}: ${o.differenceMinutes>0?`${o.differenceMinutes} min late`:`${Math.abs(o.differenceMinutes)} min early`}`)):s(`üìä Recorded restock for ${t.name} (no active prediction)`)}nd(),od()}(e),Xc(),ld()}function Jc(){return[...Dc]}function Qc(){const e=Dc.length>0?`${Dc.length}-${Dc[0]?.timestamp??0}-${Dc[Dc.length-1]?.timestamp??0}`:"",t=Date.now();if(Ec&&$c===e&&t-Mc<kc)return new Map(Ec);const n=new Map,o=Dc.length;if(0===o)return n;for(const r of Dc)for(const e of r.items){const t=n.get(e.name);t?(t.totalRestocks++,t.totalQuantity+=e.quantity,t.lastSeen=Math.max(t.lastSeen,r.timestamp),t.firstSeen=Math.min(t.firstSeen,r.timestamp)):n.set(e.name,{name:e.name,type:e.type,totalRestocks:1,totalQuantity:e.quantity,avgQuantity:0,lastSeen:r.timestamp,firstSeen:r.timestamp,appearanceRate:0,rarity:Rc(e.name)})}for(const r of n.values())r.avgQuantity=r.totalQuantity/r.totalRestocks,r.appearanceRate=r.totalRestocks/o*100,r.rarity=Rc(r.name);return Ec=n,$c=e,Mc=t,new Map(n)}function Yc(){if(0===Dc.length)return{totalRestocks:0,totalItems:0,dateRange:null,avgRestockInterval:0,uniqueItems:0};const e=Dc.reduce((e,t)=>e+t.items.length,0),t=Dc.map(e=>e.timestamp).sort((e,t)=>e-t),n={start:t[0],end:t[t.length-1]};let o=0;for(let a=1;a<t.length;a++){const e=t[a],n=t[a-1];void 0!==e&&void 0!==n&&(o+=e-n)}const r=t.length>1?o/(t.length-1)/1e3/60:0,i=new Set(Dc.flatMap(e=>e.items.map(e=>e.name))).size;return{totalRestocks:Dc.length,totalItems:e,dateRange:t.length>0?n:null,avgRestockInterval:r,uniqueItems:i}}function Zc(e,t){if(0===e.length)return 0;const n=[...e].sort((e,t)=>e-t),o=t/100*(n.length-1),r=Math.floor(o),i=Math.ceil(o),a=o-r;return n[r]*(1-a)+n[i]*a}function ed(e){return function(){const e=Dc.length>0?`${Dc.length}-${Dc[0]?.timestamp??0}-${Dc[Dc.length-1]?.timestamp??0}`:"",t=Date.now();if(Sc&&Pc===e&&t-Ac<kc)return;Sc=new Map,Pc=e,Ac=t;const n=new Map;for(const o of Dc)for(const e of o.items){let t=n.get(e.name);t||(t=[],n.set(e.name,t)),t.push(o.timestamp)}for(const[o,r]of n.entries()){if(r.sort((e,t)=>e-t),r.length<2){Sc.set(o,[]);continue}let e;e="Starweaver"===o||"Dawnbinder"===o||"Moonbinder"===o?432e6:"Sunflower"===o||"Mythical Eggs"===o?432e5:18e5;const t=[r[0]];for(let o=1;o<r.length;o++)r[o]-r[o-1]>e&&t.push(r[o]);const n=[];for(let o=1;o<t.length;o++)n.push(t[o]-t[o-1]);Sc.set(o,n)}}(),Sc?.get(e)??[]}function td(e){if(Dc.length<2)return null;const t=Qc().get(e);if(!t||0===t.appearanceRate)return null;const n=ed(e);if(0===n.length){const e=60*Yc().avgRestockInterval*1e3;if(0===e)return null;const n=1/(t.appearanceRate/100);let o=t.lastSeen+e*n;const r=Date.now();if(o<r){const t=r-o;o+=e*n*Math.ceil(t/(e*n))}return o}const o=Zc(n,50),r=n.reduce((e,t)=>e+t,0)/n.length;n.reduce((e,t)=>e+Math.pow(t-r,2),0),n.length;let i=o;i=Zc(n,"Sunflower"===e?55:"Mythical Eggs"===e?65:"Starweaver"===e||"Dawnbinder"===e||"Moonbinder"===e?80:65);let a=t.lastSeen+i;const s=Date.now();if(a<s){const e=s-t.lastSeen,n=Math.ceil(e/i);a=t.lastSeen+i*n}return a}function nd(){try{const e={};Gc.forEach((t,n)=>{e[n]=t}),f.set(vc,e)}catch(e){s("‚ö†Ô∏è Failed to save prediction history",e)}}function od(){const e=Date.now();for(const t of Tc){if(Oc.has(t))continue;const n=td(t);n&&n>e&&(Oc.set(t,n),s(`üìä Generated prediction for ${t}: ${new Date(n).toLocaleString()}`))}rd()}function rd(){try{const e={};Oc.forEach((t,n)=>{e[n]=t}),f.set(Cc,e)}catch(e){s("‚ö†Ô∏è Failed to save active predictions",e)}}function id(e){return Gc.get(e)||[]}function ad(){Dc=[],jc=!0,Wc=Date.now(),Hc.importedFiles=[],Hc.watchedItems=[],Gc.clear(),Oc.clear(),Sc=null,Pc="",Ac=0,Ec=null,$c="",Mc=0,Fc=null,Ic="",Lc=0,zc=null,Nc="",qc=0,f.set(yc,[]),f.set(xc,{importedFiles:[],watchedItems:[]}),f.set(wc,0),f.set(vc,{}),f.set(Cc,{}),ld(),s("üìä Cleared shop restock history and prediction data")}function sd(e){return Vc.push(e),()=>{Vc=Vc.filter(t=>t!==e)}}function ld(){Vc.forEach(e=>{try{e()}catch(t){s("‚ö†Ô∏è Restock callback error",t)}})}function cd(){const e=Dc.length>0?`${Dc.length}-${Dc[Dc.length-1]?.timestamp??0}`:"empty",t=Date.now(),n=t-Lc;let o=!1;if(Fc&&Fc.size>0){let e=!1;for(const n of Fc.values()){if(n.nextWindows.some(e=>e.endTime>=t)||n.cooldownActive||n.tooEarly){e=!0;break}}o=!e}if(Fc&&Ic===e&&n<kc&&!o)return new Map(Fc);const r=new Map;for(const i of Tc){const e=Qc().get(i),n=t-6048e5,o=hc(i,e?.lastSeen??null,Dc.filter(e=>e.timestamp>=n),Dc);r.set(i,o)}return Fc=r,Ic=e,Lc=t,new Map(r)}function dd(){const e=Date.now(),t=Math.floor(e/36e5),n=Ic+`-${t}`;if(zc&&Nc===n&&e-qc<kc)return[...zc];const o=function(e){const t=[],n=Date.now();new Date(n).getHours();for(const[o,r]of e.entries()){if(r.tooEarly||r.cooldownActive)continue;const e=r.nextWindows.find(e=>n>=e.startTime&&n<=e.endTime);e&&t.push({itemName:o,message:`ACTIVE WINDOW: ${o} possible now (${e.confidence} confidence)`,urgency:"high"===e.confidence?"high":"medium"});const i=r.nextWindows.find(e=>{const t=(e.startTime-n)/6e4;return t>0&&t<=30});if(i){const e=Math.round((i.startTime-n)/6e4);t.push({itemName:o,message:`UPCOMING: ${o} window in ${e} minutes (${i.confidence} confidence)`,urgency:"medium"})}if(r.correlationSignals)for(const n of r.correlationSignals)n.probability>=.5&&t.push({itemName:o,message:`CORRELATION: ${n.message}`,urgency:n.probability>=.8?"high":"medium"})}return t.sort((e,t)=>{const n={high:0,medium:1,low:2};return n[e.urgency]-n[t.urgency]})}(cd());return zc=o,Nc=n,qc=e,[...o]}const ud=["seeds","eggs","tools","decor"],pd={seeds:"seed",eggs:"egg",tools:"tool",decor:"decor"},md=new Set;let fd=null,gd=null,hd=function(){const e=Object.create(null),t=Date.now();for(const n of ud)e[n]={category:n,secondsUntilRestock:null,nextRestockAt:null,restockIntervalMs:null,items:[],availableCount:0,signature:"",updatedAt:t,raw:null};return{updatedAt:t,categories:e}}(),bd=null,yd=null,xd=null;function wd(e){const t=function(e){if("number"==typeof e&&Number.isFinite(e))return e;if("string"==typeof e){const t=e.match(/-?\d+(?:\.\d+)?/);if(t){const e=Number(t[0]);if(Number.isFinite(e))return e}}return null}(e);if(null==t)return null;const n=Math.round(t);return n>0?n:null}function vd(e,t,n,o){if(!t||"object"!=typeof t)return null;const r=function(e,t){switch(e){case"seeds":return null!=t.species?String(t.species):null!=t.id?String(t.id):null;case"eggs":return null!=t.eggId?String(t.eggId):null!=t.id?String(t.id):null;case"tools":return null!=t.toolId?String(t.toolId):null!=t.id?String(t.id):null;case"decor":return null!=t.decorId?String(t.decorId):null!=t.id?String(t.id):null;default:return null!=t.id?String(t.id):null}}(e,t);if(!r)return null;const i=function(e){const t=e.name??e.displayName??e.species??e.petSpecies??e.toolId??e.decorId??e.eggId??e.id??"Item";return String(t).trim()}(t),a=function(e){const t=[e.initialStock,e.stock,e.availableStock,e.quantity,e.count,e.amount];for(const n of t){const e=wd(n);if(null!=e)return e}return 0===e.initialStock?0:null}(t),s=wd(t.stock??t.availableStock??t.remaining),l=function(e){const t=[e.quantityPerPurchase,e.bundleSize,e.quantityPerClick,e.quantity];for(const n of t){const e=wd(n);if(null!=e)return e}return 1}(t),{coins:c,credits:d}=function(e){const t=[e.priceCoins,e.coins,e.price,e.cost],n=[e.priceCredits,e.credits,e.creditCost];let o=null,r=null;for(const i of t){const e=wd(i);if(null!=e){o=e;break}}for(const i of n){const e=wd(i);if(null!=e){r=e;break}}return{coins:o,credits:r}}(t),u=!1!==t.canSpawnHere,p=function(e,t,n){const o=pd[e],r=n?.[o]?.purchases;if(!r||"object"!=typeof r)return 0;const i=r[t];if(null!=i&&Number.isFinite(Number(i)))return Number(i);const a=Number(t);return Number.isFinite(a)&&null!=r[a]&&Number.isFinite(Number(r[a]))?Number(r[a]):0}(e,String(r),n);let m=function(e,t,n){if(null==e)return n?null:0;const o=Number.isFinite(t)?Math.max(0,Math.round(t)):0,r=Math.max(0,e-o);return n?r:0}(a,p,u);null!=s&&(m=s);let f=!1;return f=!!u&&(null!=s?s>0:null==m||m>0),{category:e,id:String(r),label:i,orderIndex:o,initialStock:a,currentStock:s,remaining:m,purchased:p,canSpawn:u,isAvailable:f,priceCoins:c,priceCredits:d,quantityPerPurchase:l,raw:t}}function Cd(e,t,n){const o=Date.now(),r=Array.isArray(t?.inventory)?t.inventory:[],i=[];r.forEach((t,o)=>{const r=vd(e,t,n,o);r&&i.push(r)});const a=i.filter(e=>e.isAvailable).length,s=i.map(e=>`${e.id}:${e.remaining??"x"}:${e.currentStock??"x"}:${e.purchased}`).join("|"),l="number"==typeof t?.secondsUntilRestock?t.secondsUntilRestock:null,c="number"==typeof t?.nextRestockAt?t.nextRestockAt:null,d="number"==typeof t?.restockIntervalMs?t.restockIntervalMs:null;return{category:e,secondsUntilRestock:l,nextRestockAt:c,restockIntervalMs:d,items:i,availableCount:a,signature:s,updatedAt:o,raw:t??null}}function Td(){const e=Date.now(),t=Object.create(null);for(const n of ud){const e=pd[n],o=fd?.[e]??null;t[n]=Cd(n,o,gd)}hd={updatedAt:e,categories:t},function(){for(const t of md)try{t(hd)}catch(e){s("‚ö†Ô∏è ShopStock listener error",e)}}()}let Sd=null,Pd=null,Ad=!1,kd=!0,Ed="",$d=0;const Md=["Carrot","Strawberry","Aloe","Delphinium","Blueberry","Apple","Tulip","Tomato","Daffodil","Corn","Watermelon","Pumpkin","Echeveria","Coconut","Banana","Lily","Camellia","Squash","Burro's Tail","Mushroom","Cactus","Bamboo","Chrysanthemum","Grape","Pepper","Lemon","Passion Fruit","Dragon Fruit","Lychee","Sunflower","Starweaver","Dawnbinder","Moonbinder","Starweaver Pod","Dawnbinder Pod","Moonbinder Pod","Uncommon Eggs","Uncommon Egg","Rare Eggs","Rare Egg","Mythical Eggs","Mythical Egg","Legendary Eggs","Legendary Egg"],Fd=[/!!!/,/omg/i,/ping/i,/spam/i,/^\d+/,/\d+\s+[A-Z]/,/stock!!!/i,/vegetables/i,/named/i];function Id(e){return!!function(e){return!(Fd.some(t=>t.test(e))||e.length>50)}(e)&&Md.some(t=>e.includes(t))}function Ld(e){return e.includes("Eggs")||e.includes("Egg")||e.includes("egg")?"egg":Md.some(t=>e.includes(t))?"seed":"unknown"}function zd(e,t){const n=t.map(e=>`${e.name}:${e.quantity}`).join(",");return`${e}-${btoa(n).substring(0,8)}`}async function Nd(){if(kd)if(Ad)s("‚ö†Ô∏è Shop tracking already active");else try{s("üìä Starting live shop restock tracking..."),await async function(){return bd||(bd=(async()=>{try{fd=await De("shops")}catch(e){s("‚ö†Ô∏è Failed to read shops atom initially",e),fd=null}try{gd=await De("shopPurchases")}catch(e){s("‚ö†Ô∏è Failed to read shop purchases atom initially",e),gd=null}Td();try{yd=await He("shops",e=>{fd=e,Td()})}catch(e){s("‚ö†Ô∏è Failed to subscribe to shops atom",e)}try{xd=await He("shopPurchases",e=>{gd=e,Td()})}catch(e){s("‚ö†Ô∏è Failed to subscribe to shop purchases atom",e)}})().catch(e=>{s("‚ö†Ô∏è startShopStockStore error",e),bd=null}),bd)}().catch(e=>{s("‚ö†Ô∏è Failed to start shop stock store",e)});const e=function(e,t=!0){if(md.add(e),t)try{e(hd)}catch(n){s("‚ö†Ô∏è ShopStock immediate listener error",n)}return()=>{md.delete(e)}}(e=>{try{const t=Object.values(e.categories||{}).map(e=>e.signature).join("|"),n=Date.now();if(t&&t===Ed&&n-$d<1200)return;if(n-$d<600)return;Ed=t,$d=n;const o=function(e){const t=new Map;try{for(const[n,o]of Object.entries(e.categories))if(o&&o.items)for(const e of o.items){const n=e.label||e.id,o=e.initialStock||e.currentStock||e.remaining||0;n&&Id(n)&&o>0&&t.set(n,o)}}catch(n){s("‚ö†Ô∏è Failed to extract shop inventory:",n)}return t}(e),r=function(e,t){const n=[];if(!t)return n;for(const[o,r]of e.entries())r>(t.get(o)||0)&&n.push({name:o,quantity:r,type:Ld(o)});return n}(o,Pd);if(r.length>0){s(`üè™ RESTOCK DETECTED! Items: ${r.map(e=>`${e.name} (${e.quantity})`).join(", ")}`);const e=Date.now();Kc({id:zd(e,r),timestamp:e,dateString:new Date(e).toLocaleString(),items:r,source:"live"})}Pd=o}catch(t){s("‚ö†Ô∏è Error processing shop update:",t)}},!1);Sd=e,Ad=!0,s("‚úÖ Live shop tracking active")}catch(e){s("‚ùå Failed to start live shop tracking:",e)}else s("‚ö†Ô∏è Live tracking is disabled")}function qd(){kd=!1,Ad&&(Sd&&(Sd(),Sd=null),Ad=!1,Pd=null,Ed="",$d=0,s("üõë Live shop tracking stopped")),Ed="",$d=0}function Bd(){return kd}const Rd="2.2.3";function Dd(){return Rd}let Hd={panel:null,content:null,status:null,toggle:null,weatherStatus:null,shopStatus:null,shopItemToggles:null,mutationStatus:null,headerContainer:null,headerAutoFeed:null,headerWeather:null,headerShop:null,headerMeta:null,headerTimer:null,dashboardFeedList:null,dashboardFeedMeta:null,dashboardRestockSummary:null,dashboardRestockValues:{seeds:null,eggs:null,tools:null,decor:null},turtleStatus:null,turtleDetail:null,turtleFooter:null,turtleEnableButtons:[],turtleFocusSelects:[],turtleFocusTargetSelects:[],turtleFocusTargetContainers:[],turtleEggFocusSelects:[],turtleEggFocusTargetSelects:[],turtleEggFocusTargetContainers:[],turtlePlantSummary:null,turtlePlantEta:null,turtlePlantTable:null,turtlePlantTotals:null,turtlePlantSimple:null,turtlePlantLuck:null,turtleEggSummary:null,turtleEggEta:null,turtleEggTable:null,turtleEggTotals:null,turtleEggSimple:null,turtleEggLuck:null,turtleSupportSummary:null,turtleSupportTotals:null,turtleSupportSimple:null,turtleSupportList:null,trackerAbilitySummary:null,trackerAbilityFilterSelect:null,trackerAbilityTable:null,trackerAbilityUnknown:null,trackerXpSummary:null,trackerXpAbilityTable:null,trackerXpPerPetTable:null,trackerXpTargetModeSelect:null,trackerXpTargetPetSelect:null,mutationTrackerCard:null,mutationTrackerSummary:null,mutationTrackerTotals:null,mutationTrackerRatios:null,mutationTrackerCountdown:null,mutationTrackerDetail:null,mutationTrackerTable:null,mutationTrackerSourceSelect:null,mutationTrackerDetailToggle:null,mutationTrackerSourceBadge:null,mutationTrackerEmpty:null,trackerAbilityHistoryUnsubscribe:null,trackerAbilityTicker:null,xpTrackerWindow:null,shopRestockWindow:null,mutationTrackerUnsubscribe:null,mutationTrackerTicker:null,turtleUnsubscribe:null,notificationsSection:null,notificationsListWrapper:null,notificationsList:null,notificationsFilterBar:null,notificationsEmpty:null,notificationsUnsubscribe:null,notificationsDetail:null,notificationsDetailHeader:null,notificationsDetailTitle:null,notificationsDetailTimestamp:null,notificationsDetailMeta:null,notificationsDetailMessage:null,notificationsDetailActions:null,notificationsDetailRaw:null,notificationsDetailPlaceholder:null,notificationsDetailToggle:null},jd=0,Wd=0,Gd=null;const Od={info:"#64b5f6",success:"var(--qpm-accent)",warn:"#ffb74d",error:"#ef5350"},Vd={info:"‚ÑπÔ∏è",success:"‚úÖ",warn:"‚ö†Ô∏è",error:"‚õî"},_d="quinoa-ui-panel-position",Ud="quinoa-ui-panel-collapsed",Xd="quinoa-ui-notifications-collapsed",Kd="quinoa-ui-notifications-detail-expanded",Jd="qpm-toast-style",Qd=new Set;let Yd=[],Zd=null;const eu=new Map,tu=new Map;let nu=null,ou=f.get(Xd,!1)??!1,ru=f.get(Kd,!1)??!1,iu=0;const au={plant:5,egg:10};function su(e){if(!e)return{tileId:null,slotIndex:null};const[t,n]=e.split("::"),o=Number.parseInt(n??"",10);return t&&Number.isFinite(o)?{tileId:t,slotIndex:o}:{tileId:null,slotIndex:null}}function lu(e){if(null==e||!Number.isFinite(e))return"‚Äî";if(e<=0)return"Ready";const t=Math.round(e/1e3);if(t<60)return`${t}s`;const n=Math.floor(t/60),o=t%60;if(n<60)return o>0?`${n}m ${o}s`:`${n}m`;const r=Math.floor(n/60),i=n%60;return i>0?`${r}h ${i.toString().padStart(2,"0")}m`:`${r}h`}function cu(e){return null!=e&&Number.isFinite(e)?`${e.toFixed(2)}√ó`:"1.00√ó"}function du(e){return null!=e&&Number.isFinite(e)?`${Math.round(e)}%`:"‚Äî"}function uu(e,t=0){return null!=e&&Number.isFinite(e)?`${e.toFixed(t)}%`:"0%"}function pu(e,t=1){if(null==e||!Number.isFinite(e)||e<=0)return"0.0 feeds/hr";return`${(e/100).toFixed(t)} feeds/hr`}function mu(e){if(null==e||!Number.isFinite(e))return"‚Äî";if(e<1){return`${Math.max(1,Math.round(60*e))}s`}if(e>=60){const t=Math.floor(e/60),n=Math.round(e%60);return n>0?`${t}h ${n}m`:`${t}h`}return`${Math.round(e)}m`}function fu(e,t,n,o){const r=document.createElement("span");return r.style.cssText="cursor:pointer;text-decoration:underline dotted;",r.title=`Click to manually set ${t} value (leave empty to clear)`,r.textContent=o(n),r.addEventListener("click",o=>{o.stopPropagation();const i=document.createElement("input");i.type="number",i.style.cssText="width:60px;font-size:9px;padding:2px;border:1px solid #4CAF50;background:#1a1a1a;color:#fff;",i.value=null!=n?String(n):"",i.placeholder="xp"===t?"XP":"Scale",i.step="targetScale"===t?"0.01":"1";const a=()=>{const n=i.value.trim(),o={species:e.species,slotIndex:e.slotIndex,petId:e.petId??null};if(""===n)!function(e,t){const n=Nr(e);Lr[n]&&(t?(delete Lr[n][t],0===Object.keys(Lr[n]).length&&delete Lr[n]):delete Lr[n],zr(),gi())}(o,t);else{const e=Number(n);Number.isFinite(e)&&e>=0&&function(e,t){const n=Nr(e);Lr[n]||(Lr[n]={}),Object.assign(Lr[n],t),zr(),gi()}(o,{[t]:e})}i.remove(),r.style.display=""};i.addEventListener("blur",()=>setTimeout(a,100)),i.addEventListener("keydown",e=>{"Enter"===e.key?(e.preventDefault(),a()):"Escape"===e.key&&(r.style.display="",i.remove())}),r.style.display="none",r.parentElement?.insertBefore(i,r.nextSibling),i.focus(),i.select()}),r}function gu(e){if(null==e||!Number.isFinite(e)||0===e)return"0m per hour";const t=e>=0?"-":"+",n=Math.abs(e),o=Math.max(0,Math.round(n)),r=Math.floor(o/60),i=o%60,a=[];return r>0&&a.push(`${r}hr`),(i>0||0===a.length)&&a.push(`${i}m`),`${t}${a.join(" ")} per hour`}const hu=e=>{if("number"==typeof e&&Number.isFinite(e))return e;if("string"==typeof e){const t=e.replace(/[^0-9.+-]/g,"");if(!t)return null;const n=Number(t);return Number.isFinite(n)?n:null}return null},bu=(e,...t)=>{if(!e||"object"!=typeof e)return null;const n=e;for(const o of t){if(!(o in n))continue;const e=hu(n[o]);if(null!=e)return e}return null},yu=(e,t)=>{const n=[];return e.petId&&n.push(e.petId),e.slotId&&n.push(e.slotId),"number"==typeof e.slotIndex&&Number.isFinite(e.slotIndex)&&n.push(String(Math.max(0,Math.round(e.slotIndex)))),Cs(t,{petId:e.petId,slotId:e.slotId,slotIndex:"number"==typeof e.slotIndex&&Number.isFinite(e.slotIndex)?e.slotIndex:null,fallbackKeys:n})},xu=e=>{const t=Date.now()-144e5;return e.events.filter(e=>e.performedAt>=t)},wu=(e,t)=>{const n=t.data;switch(e.category){case"xp":return bu(n,"bonusXp","xp","value");case"plantGrowth":return bu(n,"plantGrowthReductionMinutes","reductionMinutes","minutes");case"eggGrowth":return bu(n,"eggGrowthTimeReductionMinutes","reductionMinutes","minutes");case"coins":return bu(n,"coinsFound","coins","coinsEarned","sellPrice","bonusCoins","value","valueEarned","coinsValue");default:return null}},vu=(e,t)=>{const n=xu(e);if(!n.length)return null;const o=n[n.length-1],r=n[0];let i=null;if(n.length>=2){const e=o.performedAt-r.performedAt;e>0&&(i=(n.length-1)/(e/36e5))}const a=[];for(const s of n){const e=wu(t,s);null!=e&&Number.isFinite(e)&&a.push(e)}return{procsPerHour:i,effectPerProc:a.length?a.reduce((e,t)=>e+t,0)/a.length:null,lastProcAt:o.performedAt,sampleCount:n.length}};function Cu(e){return e.name&&e.name.trim().length>0?e.name:e.species&&e.species.trim().length>0?e.species:"number"==typeof e.slotIndex&&Number.isFinite(e.slotIndex)?`Pet ${e.slotIndex+1}`:"Unknown pet"}function Tu(){const e=$u.turtleTimer??{},t={enabled:e.enabled??!0,includeBoardwalk:e.includeBoardwalk??!1,focus:"earliest"===e.focus||"specific"===e.focus?e.focus:"latest",focusTargetTileId:"string"==typeof e.focusTargetTileId?e.focusTargetTileId:null,focusTargetSlotIndex:"number"==typeof e.focusTargetSlotIndex&&Number.isFinite(e.focusTargetSlotIndex)?Math.max(0,Math.round(e.focusTargetSlotIndex)):null,eggFocus:"earliest"===e.eggFocus||"specific"===e.eggFocus?e.eggFocus:"latest",eggFocusTargetTileId:"string"==typeof e.eggFocusTargetTileId?e.eggFocusTargetTileId:null,eggFocusTargetSlotIndex:"number"==typeof e.eggFocusTargetSlotIndex&&Number.isFinite(e.eggFocusTargetSlotIndex)?Math.max(0,Math.round(e.eggFocusTargetSlotIndex)):null};return $u.turtleTimer=t,t}function Su(e){if(null==e||!Number.isFinite(e))return"";const t=new Date(Date.now()+e),n=t.getHours(),o=n>=12?"PM":"AM";return` ‚Ä¢ ${n%12||12}:${t.getMinutes().toString().padStart(2,"0")} ${o}`}function Pu(e){if("estimating"!==e.status||null==e.naturalMsRemaining||null==e.adjustedMsRemaining||!Number.isFinite(e.adjustedMsRemaining))return{luckyMs:null,unluckyMs:null,stdMinutes:null};const t=Math.max(0,e.adjustedMsRemaining/6e4),n=Math.max(1,t);let o=0;for(const i of e.contributions){const e=i.ability,t=au[e];if(!Number.isFinite(t))continue;const r=t*(i.baseScore/100);if(!Number.isFinite(r)||r<=0)continue;const a=i.rateContribution;if(!Number.isFinite(a)||a<=0)continue;const s=Math.min(.99,Math.max(0,a/Math.max(r,1e-4)));if(s<=0)continue;o+=n*s*(1-s)*r*r}if(o<=0)return{luckyMs:e.adjustedMsRemaining,unluckyMs:e.adjustedMsRemaining,stdMinutes:0};const r=Math.sqrt(o);return{luckyMs:6e4*Math.max(0,t-r),unluckyMs:6e4*(t+r),stdMinutes:r}}function Au(e){const t=e.plant,n=e.egg,o=e.support,r=t.contributions.reduce((e,t)=>e+(t.perHourReduction??0),0),i=null!=t.naturalMsRemaining?t.naturalMsRemaining/6e4:null;null!=t.adjustedMsRemaining&&t.adjustedMsRemaining;const a=t.minutesSaved??null,s=Pu(t),l=n.contributions.reduce((e,t)=>e+(t.perHourReduction??0),0),c=null!=n.naturalMsRemaining?n.naturalMsRemaining/6e4:null;null!=n.adjustedMsRemaining&&n.adjustedMsRemaining;const d=n.minutesSaved??null,u=Pu(n),p=o.restorePctActive;o.restorePctTotal;const m=o.restorePctPerHourActive,f=o.restorePctPerHourTotal,g=o.restoreTriggersPerHourActive;o.restoreTriggersPerHourTotal;const h=o.slowPctActive,b=o.slowPctTotal,y=e=>{const t=document.createElement("div");return t.textContent=e,t.style.cssText="font-size:10px;color:#90a4ae;font-style:italic;",t},x=Hd.turtleEnableButtons;0===x.length&&(Hd.turtleEnableButtons=x);for(const J of x)J&&(e.enabled?(J.textContent="Enabled",J.style.background="rgba(56, 142, 60, 0.28)",J.style.borderColor="rgba(56, 142, 60, 0.55)",J.style.color="#e8f5e9"):(J.textContent="Disabled",J.style.background="rgba(158, 158, 158, 0.22)",J.style.borderColor="rgba(158, 158, 158, 0.35)",J.style.color="#eceff1"));for(const J of Hd.turtleFocusSelects)J&&J.value!==e.focus&&(J.value=e.focus);for(const J of Hd.turtleEggFocusSelects)J&&J.value!==e.eggFocus&&(J.value=e.eggFocus);const w=e.focusTargetKey,v=e.plantTargets??[],C="specific"===e.focus,T=v.length>0;Hd.turtleFocusTargetSelects.forEach((t,n)=>{if(!t)return;const o=Hd.turtleFocusTargetContainers[n];o&&(o.style.display=C?"inline-flex":"none");const r=Array.from(t.options).map(e=>e.value),i=v.map(e=>e.key);if(r.length!==i.length+1||r.slice(1).some((e,t)=>e!==i[t])){t.textContent="";const e=document.createElement("option");e.value="",e.textContent=v.length?"Pick a plant...":"No plants detected yet",e.disabled=v.length>0,e.hidden=v.length>0,t.appendChild(e);for(const n of v){const e=document.createElement("option");e.value=n.key;const o=n.species??"Unknown plant",r=null!=n.remainingMs?lu(n.remainingMs):"Ready",i=n.boardwalk?" (boardwalk)":"";e.textContent=`${o} - ${r}${i}`,t.appendChild(e)}}const a=C&&e.focusTargetAvailable&&w?w:"";t.value!==a&&(t.value=a),t.disabled=!C||0===v.length});const S=e.eggFocusTargetKey,P=e.eggTargets??[],A="specific"===e.eggFocus,k=P.length>0;Hd.turtleEggFocusTargetSelects.forEach((t,n)=>{if(!t)return;const o=Hd.turtleEggFocusTargetContainers[n];o&&(o.style.display=A?"inline-flex":"none");const r=Array.from(t.options).map(e=>e.value),i=P.map(e=>e.key);if(r.length!==i.length+1||r.slice(1).some((e,t)=>e!==i[t])){t.textContent="";const e=document.createElement("option");e.value="",e.textContent=P.length?"Pick an egg...":"No eggs detected yet",e.disabled=P.length>0,e.hidden=P.length>0,t.appendChild(e);for(const n of P){const e=document.createElement("option");e.value=n.key;const o=n.species??"Unknown egg",r=null!=n.remainingMs?lu(n.remainingMs):"Ready",i=n.boardwalk?" (boardwalk)":"";e.textContent=`${o} - ${r}${i}`,t.appendChild(e)}}const a=A&&e.eggFocusTargetAvailable&&S?S:"";t.value!==a&&(t.value=a),t.disabled=!A||0===P.length});const E=[];e.hungerFilteredCount>0&&E.push(`${e.hungerFilteredCount} need feeding`),e.turtlesMissingStats>0&&E.push(`${e.turtlesMissingStats} missing stats`),e.includeBoardwalk;const $=Hd.turtleStatus,M=Hd.turtleDetail,F=Hd.turtleFooter,I=(e,t,n,o=!1)=>{$&&($.textContent=e),M&&(o?M.innerHTML=t:M.textContent=t),F&&(F.textContent=n)},L=Hd.turtlePlantNameText;if(e.enabled)if("no-data"===t.status)L&&(L.textContent="Waiting..."),I("Waiting for garden data‚Ä¶","Move camera or interact with garden","");else if("no-crops"===t.status)L&&(L.textContent="No Crops"),I("No crops growing","Plant seeds to start tracking","");else if("no-turtles"===t.status){const e=t.focusSlot?.species||"Crop";L&&(L.textContent=e);I(`${e} ‚Ä¢ ${t.naturalMsRemaining?lu(t.naturalMsRemaining):"‚Äî"}`,`No plant boost ‚Ä¢ ${`${t.growingSlots}/${t.trackedSlots} crops`}`,"")}else if("estimating"===t.status){const e=t.focusSlot?.species||"Crop";L&&(L.textContent=e);const r=lu(t.adjustedMsRemaining),i=Su(t.adjustedMsRemaining),a=cu(t.effectiveRate),s=Pu(t),l=null!=s.unluckyMs?lu(s.unluckyMs):"",c=[];if(t.contributions.length>0&&c.push(`üå± ${a} plant`),n.contributions.length>0&&"estimating"===n.status&&null!=n.effectiveRate){const e=cu(n.effectiveRate);c.push(`ü•ö ${e} egg`)}else n.contributions.length>0&&c.push(`ü•ö ${n.contributions.length} egg`);const d=o.restoreCount+o.slowCount;d>0&&c.push(`üçΩÔ∏è ${d} food`);let u=`${c.length>0?c.join(" ‚Ä¢ "):"No turtles"} ‚Ä¢ ${`${t.growingSlots}/${t.trackedSlots} crops`}`;l&&(u+=` ‚Ä¢ <span style="color:#ff5252;font-size:9px;">(${l})</span>`),I(`${e} ‚Ä¢ ${r}${i}`,u,"",!0)}else L&&(L.textContent="Idle"),I("Turtle timer idle","","");else L&&(L.textContent="Timer Disabled"),I("Timer disabled","Enable to track crops and eggs","");const z=Hd.turtlePlantSummary;if(z)if(e.enabled)if("no-data"===t.status)z.innerHTML=C&&!e.focusTargetAvailable&&T?'<div style="font-size:11px;color:#FFB74D;">üéØ Select target plant</div>':'<div style="font-size:11px;color:#9E9E9E;">‚è≥ Waiting...</div>';else if("no-crops"===t.status)z.innerHTML='<div style="font-size:11px;color:#9E9E9E;">üåæ No crops</div>';else{const e=t.focusSlot?.species||"Unknown",n=t.contributions.length;z.innerHTML=`<div style="font-size:11px;font-weight:600;color:#4CAF50;">üå± ${e}</div><div style="font-size:10px;color:#81C784;">‚ö° ${n} booster${1===n?"":"s"}</div>`}else z.innerHTML='<div style="font-size:11px;color:#ef5350;">‚è∏Ô∏è Timer disabled</div>';const N=Hd.turtlePlantEta;if(N)if(e.enabled)if("estimating"===t.status){const e=Su(t.adjustedMsRemaining);N.innerHTML=`‚è±Ô∏è ${lu(t.adjustedMsRemaining)}<span style="font-size:10px;color:#81C784;margin-left:6px;">${e}</span>`}else"no-turtles"===t.status&&null!=t.naturalMsRemaining?(Su(t.naturalMsRemaining),N.innerHTML=`‚è±Ô∏è ${lu(t.naturalMsRemaining)}<span style="font-size:10px;color:#9E9E9E;margin-left:6px;">(no boost)</span>`):N.textContent="‚Äî";else N.textContent="‚Äî";const q=Hd.turtlePlantTotals;if(q)if(e.enabled)if(C&&!e.focusTargetAvailable)q.innerHTML=T?'<div style="font-size:10px;color:#9E9E9E;">üéØ Select focus plant</div>':'<div style="font-size:10px;color:#9E9E9E;">‚è≥ Loading...</div>';else if("no-data"===t.status)q.innerHTML='<div style="font-size:10px;color:#9E9E9E;">‚è≥ Loading...</div>';else if("no-crops"===t.status)q.innerHTML='<div style="font-size:10px;color:#9E9E9E;">üåæ No crops</div>';else if("no-turtles"===t.status){const e=null!=i?mu(i):"‚Äî";q.innerHTML=`<div style="font-size:10px;font-weight:600;color:#FFB74D;">‚ö†Ô∏è No boost</div><div style="font-size:9px;color:#BDBDBD;">Normal: ${e}</div>`}else{const e=null!=i?mu(i):"‚Äî",t=null!=a?mu(a):"‚Äî";q.innerHTML=`<div style="font-size:10px;font-weight:600;color:#4CAF50;">‚ö° Boost: ${gu(r)}</div><div style="font-size:9px;color:#81C784;">‚úÇÔ∏è Cut: ${t}</div><div style="font-size:9px;color:#BDBDBD;">üìÖ Normal: ${e}</div>`}else q.innerHTML='<div style="font-size:10px;color:#9E9E9E;">‚è∏Ô∏è Paused</div>';const B=Hd.turtlePlantSimple;if(B)if(e.enabled)if(C&&!e.focusTargetAvailable)B.innerHTML=T?'<span style="font-size:16px;">üéØ</span><span>Select a focus plant</span>':'<span style="font-size:16px;">‚è≥</span><span>Loading garden data...</span>';else if("no-data"===t.status)B.innerHTML='<span style="font-size:16px;">‚è≥</span><span>Loading garden data...</span>';else if("no-crops"===t.status)B.innerHTML='<span style="font-size:16px;">üåæ</span><span>No crops growing</span>';else if("no-turtles"===t.status)B.innerHTML=`<span style="font-size:16px;">‚è±Ô∏è</span><span>Matures in ${lu(t.naturalMsRemaining)} <span style="color:#9E9E9E;">(no boost)</span></span>`;else{const e=null!=a?mu(a):"‚Äî";B.innerHTML=`<span style="font-size:16px;">‚ú®</span><span>Matures in <strong>${lu(t.adjustedMsRemaining)}</strong> ‚Ä¢ <span style="color:#4CAF50;font-weight:600;">‚úÇÔ∏è ${e} saved</span></span>`}else B.innerHTML='<span style="font-size:16px;">‚è∏Ô∏è</span><span>Enable temple to track</span>';const R=Hd.turtlePlantLuck;if(R)if(e.enabled&&"estimating"===t.status){const e=null!=s.luckyMs?lu(s.luckyMs):"‚Äî",t=null!=s.unluckyMs?lu(s.unluckyMs):"‚Äî",n=null!=s.stdMinutes?mu(s.stdMinutes):"‚Äî";R.innerHTML=`<span style="font-size:14px;">üé≤</span><span>üçÄ ${e} ‚Ä¢ üòê ${t} <span style="color:#80CBC4;">(¬±${n})</span></span>`}else R.textContent="";const D=Hd.turtleEggSummary;D&&(e.enabled?"no-data"===n.status?D.textContent=A&&!e.eggFocusTargetAvailable&&k?"Select a target egg with Egg focus to track hatching.":"Waiting for garden snapshot‚Ä¶":"no-eggs"===n.status?D.textContent="No eggs incubating.":D.textContent=`${n.growingSlots}/${n.trackedSlots} growing eggs ‚Ä¢ ${n.contributions.length} booster${1===n.contributions.length?"":"s"}`:D.textContent="Timer disabled");const H=Hd.turtleEggEta;if(H)if(e.enabled)if("estimating"===n.status){const e=Su(n.adjustedMsRemaining);H.textContent=`${lu(n.adjustedMsRemaining)} (${cu(n.effectiveRate)})${e}`}else if("no-turtles"===n.status)if(null!=n.naturalMsRemaining){const e=Su(n.naturalMsRemaining);H.textContent=`${lu(n.naturalMsRemaining)} (no turtle boost)${e}`}else H.textContent="‚Äî";else H.textContent="‚Äî";else H.textContent="‚Äî";const j=Hd.turtleEggTotals;if(j)if(e.enabled)if(A&&!e.eggFocusTargetAvailable)j.textContent=k?"Total Hatch Boost will appear once a target egg is selected.":"Waiting for a fresh egg snapshot...";else if("no-eggs"===n.status)j.textContent="No incubating eggs detected yet ‚Äì hatchery estimates will appear here.";else if("no-turtles"===n.status){const e=null!=c?mu(c):"‚Äî";j.textContent=`No hatch turtles boosting yet. Normal ETA: ${e}. Assign turtles to speed this up.`}else"estimating"===n.status?j.textContent=`Total Growth Boost: ${gu(l)} ‚Ä¢ Normal ETA: ${null!=c?mu(c):"‚Äî"} ‚Ä¢ Estimated Time Cut: ${null!=d?mu(d):"‚Äî"}`:j.textContent="Waiting for an egg snapshot‚Ä¶";else j.textContent="Totals paused while the temple is disabled.";const W=Hd.turtleEggSimple;if(W)if(e.enabled)if("no-eggs"===n.status)W.textContent="No eggs on the boardwalk or garden right now. Drop an egg to start tracking.";else if(A&&!e.eggFocusTargetAvailable)W.textContent=k?"Pick a target egg with Egg focus to show its hatch ETA and boost cut.":"Waiting on egg snapshots ‚Äì try moving the camera or drop an egg to refresh.";else if("no-data"===n.status)W.textContent="Waiting on egg snapshots ‚Äì try moving the camera or interacting with the garden.";else if("no-turtles"===n.status){const e=null!=c?mu(c):"‚Äî";W.textContent=`Focused egg hatches in ${lu(n.naturalMsRemaining)} (no turtle boost active). Normal ETA: ${e}.`}else if("estimating"===n.status){const e=null!=c?mu(c):"‚Äî",t=null!=d?mu(d):"‚Äî";W.textContent=`Focused egg hatches in ${lu(n.adjustedMsRemaining)} (Normal ETA: ${e}); Estimated Time Cut: ${t}.`}else W.textContent="";else W.textContent="Enable the temple to see egg hatching boosts too.";const G=Hd.turtleEggLuck;if(G)if(e.enabled)if("estimating"===n.status){const e=null!=u.luckyMs?lu(u.luckyMs):"‚Äî",t=null!=u.unluckyMs?lu(u.unluckyMs):"‚Äî",n=null!=u.stdMinutes?mu(u.stdMinutes):"‚Äî";G.textContent=`Lucky ‚âà ${e} ‚Ä¢ Unlucky ‚âà ${t} (¬±${n})`}else"no-turtles"===n.status?G.textContent="No turtle boosts active for eggs right now.":G.textContent="";else G.textContent="";const O=Hd.turtleSupportSummary,V=Hd.turtleSupportTotals,_=Hd.turtleSupportSimple,U=Hd.turtleSupportList;if(O&&(e.enabled?0===o.entries.length?O.textContent="No food turtles detected ‚Äì add Hunger Restore or Hunger Boost companions.":O.textContent=`Restore turtles active ${o.restoreActiveCount}/${o.restoreCount} ‚Ä¢ Slow drain turtles active ${o.slowActiveCount}/${o.slowCount}`:O.textContent="Food buffs paused while the temple is disabled."),V)if(e.enabled&&0!==o.entries.length){const e=m>0?pu(m,1):"0.0 feeds/hr",t=f>0?pu(f,1):"0.0 feeds/hr",n=o.restoreCount>0?`Restore: ~${e} (max ${t})`:"Restore: none yet",r=o.slowCount>0?`Slow drain: ${uu(h,0)} active (${uu(b,0)} possible)`:"Slow drain: none yet";V.textContent=`${n} ‚Ä¢ ${r}`}else V.textContent="";if(_)if(e.enabled)if(0===o.entries.length)_.textContent="Assign turtles with Hunger Restore (refills) or Hunger Boost (slow drain) abilities to see food support stats.";else{const e=o.restoreCount>0,t=p>0&&o.restoreActiveCount>0,n=o.slowActiveCount>0&&h>0;if(t&&g>0){const e=m/100;_.textContent=`Restore turtles are covering ~${e.toFixed(1)} feeds/hr and slow drain buffs are cutting hunger by ${uu(h,0)} while they stay fed.`}else e&&0===o.restoreActiveCount?_.textContent="Your restore turtles need food before their hourly refills kick back in.":_.textContent=n?`Slow drain buffs are active, trimming hunger by ${uu(h,0)} as long as the turtles stay full.`:e?"Restore turtles are present but idle‚Äîfeed them to start the hourly refills.":"Add food turtles with Hunger Restore or Hunger Boost abilities to see refills and slowdown buffs here."}else _.textContent="Enable the turtle temple and keep turtles fed to maintain hunger buffs.";if(U)if(U.textContent="",e.enabled)if(0===o.entries.length)U.appendChild(y("No food turtles detected."));else{for(const t of o.entries){const e=document.createElement("div");e.style.cssText="display:flex;flex-direction:column;gap:3px;padding:4px 0;border-bottom:1px solid rgba(255,255,255,0.05);font-size:10px;";const n=document.createElement("div");n.style.cssText="display:flex;justify-content:space-between;align-items:center;gap:12px;color:#ffe9a6;";const o=document.createElement("span");o.textContent=`${t.name??"Unknown"} ‚Ä¢ ${t.abilityNames.join(", ")}`;const r=document.createElement("span");r.textContent=t.active?"Active":"Needs feed",r.style.cssText=`padding:1px 6px;border-radius:12px;font-size:9px;background:${t.active?"rgba(129,199,132,0.25)":"rgba(255,138,128,0.25)"};color:${t.active?"#c8e6c9":"#ffab91"};`,n.append(o,r);const i=document.createElement("div");i.style.cssText="display:flex;flex-direction:column;gap:2px;color:#ffecb3;";const a=t.totalRestorePerHourPct>0?t.totalRestorePerHourPct/100:0;if(t.totalRestorePerHourPct>0){const e=document.createElement("div");e.textContent=`Restore: ${a.toFixed(1)} feeds/hr (${uu(t.totalRestorePerTriggerPct,0)} per proc, ~${t.totalTriggersPerHour.toFixed(1)} procs/hr)`,i.appendChild(e)}if(t.totalSlowPct>0){const e=document.createElement("div");e.textContent=`Slow drain: ${uu(t.totalSlowPct,0)} less hunger/hr while active`,i.appendChild(e)}if(a>0||t.totalSlowPct>0){const e=document.createElement("div");a>0&&t.totalSlowPct>0?e.textContent=`Auto-feed relief: ~${a.toFixed(1)} fewer feeds/hr and pets eat ~${uu(t.totalSlowPct,0)} less often.`:e.textContent=a>0?`Auto-feed relief: ~${a.toFixed(1)} fewer feeds/hr thanks to this turtle.`:`Auto-feed relief: pets eat ~${uu(t.totalSlowPct,0)} less often.`,i.appendChild(e)}if(!i.hasChildNodes()){const e=document.createElement("div");e.textContent="No active food effects yet.",i.appendChild(e)}const s=document.createElement("div");s.style.cssText="font-size:9px;color:#ffdd99;display:flex;flex-wrap:wrap;gap:8px;";const l=`Hunger ${du(t.hungerPct)}`,c=`Score ${Math.round(t.baseScore)}`,d=document.createElement("span");d.textContent="xp: ";const u=fu({species:t.species,slotIndex:t.slotIndex},"xp",t.xp,e=>null!=e?`${Math.round(e/1e3)}k`:"?"),p=document.createElement("span");p.textContent=" ‚Ä¢ Scale: ";const m=fu({species:t.species,slotIndex:t.slotIndex},"targetScale",t.targetScale,e=>null!=e&&Number.isFinite(e)?`${e.toFixed(2)}√ó`:"?");s.textContent=`${l} ‚Ä¢ ${c} ‚Ä¢ `,s.appendChild(d),s.appendChild(u),s.appendChild(p),s.appendChild(m),e.append(n,i,s),U.appendChild(e)}const e=U.querySelectorAll(":scope > div");e.length>0&&(e[e.length-1].style.borderBottom="none")}else U.appendChild(y("Timer disabled."));const X=Hd.turtlePlantTable;if(X)if(X.textContent="",e.enabled)if(0===t.contributions.length)X.appendChild(y("No growth turtles contributing yet."));else for(const J of t.contributions){const t=document.createElement("div");t.style.cssText="display:grid;grid-template-columns:1.4fr 0.7fr 0.6fr 0.8fr;gap:6px;font-size:10px;padding:2px 0;";const n=document.createElement("div");n.textContent=J.name&&J.name.trim()||J.species||`Slot ${J.slotIndex+1}`,n.style.color=J.missingStats?"#ffcc80":"#e0f2f1";const o=document.createElement("div");o.textContent=du(J.hungerPct),o.style.color=null!=J.hungerPct&&J.hungerPct<e.minActiveHungerPct?"#ff8a80":"#b2dfdb";const r=document.createElement("div");r.textContent=`${J.perHourReduction.toFixed(1)} min/hr`,r.style.color="#aed581";const i=document.createElement("div");i.style.color=J.missingStats?"#ffcc80":"#c5cae9";const a=fu({species:J.species,slotIndex:J.slotIndex},"xp",J.xp,e=>null!=e?`${Math.round(e/1e3)}k xp`:"‚Äî");i.appendChild(a),t.append(n,o,r,i),X.appendChild(t)}else X.appendChild(y("Timer disabled."));const K=Hd.turtleEggTable;if(K)if(K.textContent="",e.enabled)if(0===n.contributions.length)K.appendChild(y("No egg boosters contributing yet."));else for(const J of n.contributions){const t=document.createElement("div");t.style.cssText="display:grid;grid-template-columns:1.4fr 0.7fr 0.6fr 0.8fr;gap:6px;font-size:10px;padding:2px 0;";const n=document.createElement("div");n.textContent=J.name&&J.name.trim()||J.species||`Slot ${J.slotIndex+1}`,n.style.color=J.missingStats?"#ffcc80":"#e0f2f1";const o=document.createElement("div");o.textContent=du(J.hungerPct),o.style.color=null!=J.hungerPct&&J.hungerPct<e.minActiveHungerPct?"#ff8a80":"#b2dfdb";const r=document.createElement("div");r.textContent=`${J.perHourReduction.toFixed(1)} min/hr`,r.style.color="#aed581";const i=document.createElement("div");i.style.color=J.missingStats?"#ffcc80":"#c5cae9";const a=fu({species:J.species,slotIndex:J.slotIndex},"xp",J.xp,e=>null!=e?`${Math.round(e/1e3)}k xp`:"‚Äî");i.appendChild(a),t.append(n,o,r,i),K.appendChild(t)}else K.appendChild(y("Timer disabled."))}let ku=!1;function Eu(e,t={}){const n=document.createElement("div");n.className="qpm-card",n.style.display="flex",n.style.flexDirection="column",n.style.gap="10px";const o=document.createElement("div");o.className="qpm-card__header",t.collapsible&&(o.style.cursor="pointer");const r=document.createElement("div");r.className="qpm-card__title",r.textContent=e,o.appendChild(r);const i=[];let a=null;t.subtitleElement?(a=t.subtitleElement,i.push(a)):t.subtitle&&(a=document.createElement("span"),a.className="qpm-section-muted",a.textContent=t.subtitle,i.push(a)),Array.isArray(t.headerActions)&&t.headerActions.length>0&&i.push(...t.headerActions);let s=null;if(t.collapsible&&(s=document.createElement("span"),s.className="qpm-section-muted",s.textContent=t.startCollapsed?"‚ñ≤":"‚ñº",i.push(s)),i.length>0){const e=document.createElement("div");e.className="qpm-row",e.style.justifyContent="flex-end",e.style.gap="6px",e.style.flexWrap="nowrap";for(const t of i)e.appendChild(t);o.appendChild(e)}n.appendChild(o);const l=document.createElement("div");if(l.style.display=t.startCollapsed?"none":"flex",l.style.flexDirection="column",l.style.gap="10px",n.appendChild(l),t.collapsible){let e=!!t.startCollapsed;const n=t=>{e=t,l.style.display=e?"none":"flex",s&&(s.textContent=e?"‚ñ≤":"‚ñº")};n(e),o.addEventListener("click",()=>{n(!e)})}return{root:n,header:o,body:l,indicator:s,subtitleEl:a}}let $u={};function Mu(){const{root:e,body:t}=Eu("üíé Mutation Value & Reminders",{subtitle:"Gold/Rainbow generation and mutation alerts",collapsible:!0});e.dataset.qpmSection="mutation-value";const n=document.createElement("div");n.style.cssText="padding:10px;background:#1a1a2a;border-radius:6px;font-size:11px;line-height:1.5;margin-bottom:12px;",n.innerHTML="\n    <strong>üí∞ Value generation tracking:</strong> Gold/Rainbow proc rates, session value, and best records.\n  ",t.appendChild(n);const o=document.createElement("div");o.style.cssText="margin-bottom:16px;padding:12px;background:#2a1a3a;border-radius:6px;border-left:3px solid #9C27B0;";const r=document.createElement("div");r.style.cssText="font-weight:bold;font-size:12px;margin-bottom:8px;color:#9C27B0;",r.textContent="üß¨ Mutation Reminder",o.appendChild(r);const i=document.createElement("div");i.innerHTML="üí° Detects weather events (Rain/Snow/Dawn/Amber) and notifies which plants to place for mutations.",i.style.cssText="font-size:10px;line-height:1.5;color:#aaa;margin-bottom:8px;",o.appendChild(i);const a=up($u.mutationReminder?.enabled?"‚úì Reminders Enabled":"‚úó Reminders Disabled",async()=>{if(!$u.mutationReminder)return;$u.mutationReminder.enabled=!$u.mutationReminder.enabled,a.textContent=$u.mutationReminder.enabled?"‚úì Reminders Enabled":"‚úó Reminders Disabled",a.classList.toggle("qpm-button--positive",$u.mutationReminder.enabled),a.classList.toggle("qpm-button--accent",$u.mutationReminder.enabled),pp();const{setMutationReminderEnabled:e}=await Promise.resolve().then(()=>vn);e($u.mutationReminder.enabled)});a.style.cssText="width:100%;margin-bottom:6px;",$u.mutationReminder?.enabled&&a.classList.add("qpm-button--positive","qpm-button--accent"),o.appendChild(a);const l=up("üîç Check Now",async()=>{l.disabled=!0,l.textContent="‚è≥ Checking...";try{const{checkForMutations:e}=await Promise.resolve().then(()=>vn);await e(),l.textContent="‚úÖ Done!",setTimeout(()=>{l.textContent="üîç Check Now",l.disabled=!1},2e3)}catch(e){l.textContent="‚ùå Error",s("Error checking mutations:",e),setTimeout(()=>{l.textContent="üîç Check Now",l.disabled=!1},2e3)}});l.style.cssText="width:100%;background:#9C27B0;",l.title="Manually check for mutation opportunities",o.appendChild(l),t.appendChild(o);const c=document.createElement("button");c.textContent="üóëÔ∏è Clear Restock Data",c.style.cssText="width:100%;padding:8px;background:#2a1a1a;color:#FF6B6B;border:1px solid #FF6B6B;border-radius:4px;cursor:pointer;font-size:11px;font-weight:bold;margin-bottom:12px;transition:all 0.2s;",c.onmouseenter=()=>{c.style.background="#3a2020",c.style.borderColor="#FF8888"},c.onmouseleave=()=>{c.style.background="#2a1a1a",c.style.borderColor="#FF6B6B"},c.onclick=()=>{confirm("‚ö†Ô∏è This will clear all Shop Restock history and prediction data.\n\nYour other QPM settings (auto-feed, XP tracking, etc.) will NOT be affected.\n\nThis cannot be undone. Are you sure?")&&(ad(),s("üóëÔ∏è Shop restock data cleared"),alert("‚úÖ Shop restock history and prediction data has been cleared."))},t.appendChild(c);const d=document.createElement("div");d.style.cssText="display:flex;flex-direction:column;gap:12px;",t.appendChild(d);const u=e=>e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString(),p=()=>{const e=ql(),t=xl();d.innerHTML="";const n=e.stats,o=t.stats,r=o.wetCount+o.chilledCount+o.frozenCount+o.dawnlitCount+o.dawnboundCount+o.amberlitCount+o.amberboundCount,i=o.wetPerHour+o.chilledPerHour+o.frozenPerHour+o.dawnlitPerHour+o.dawnboundPerHour+o.amberlitPerHour+o.amberboundPerHour,a=document.createElement("div");a.style.cssText="padding:12px;background:linear-gradient(135deg,rgba(255,215,0,0.1),rgba(139,69,19,0.1));border-radius:6px;border-left:3px solid #FFD700;",a.innerHTML=`\n      <div style="font-weight:bold;font-size:12px;margin-bottom:8px;">üí∞ Current Session Value</div>\n      <div style="font-size:20px;font-weight:bold;color:#FFD700;">${u(n.sessionValue)}</div>\n      <div style="font-size:10px;color:#888;margin-top:4px;">Session started ${(e=>{const t=Date.now()-e,n=Math.floor(t/6e4),o=Math.floor(n/60);return o>0?`${o}h ${n%60}m ago`:`${n}m ago`})(n.sessionStart)}</div>\n    `,d.appendChild(a);const s=document.createElement("div");if(s.style.cssText="display:grid;grid-template-columns:1fr 1fr;gap:8px;",s.innerHTML=`\n      <div style="padding:10px;background:#1a1a2a;border-radius:6px;text-align:center;">\n        <div style="font-size:18px;margin-bottom:4px;">üü°</div>\n        <div style="font-size:14px;font-weight:bold;color:#FFD700;">${n.goldProcs}</div>\n        <div style="font-size:9px;color:#888;margin-top:2px;">Gold Procs</div>\n        <div style="font-size:10px;color:#4CAF50;margin-top:4px;">${n.goldPerHour.toFixed(1)}/hr</div>\n      </div>\n      <div style="padding:10px;background:#1a1a2a;border-radius:6px;text-align:center;">\n        <div style="font-size:18px;margin-bottom:4px;">üåà</div>\n        <div style="font-size:14px;font-weight:bold;color:#FFD700;">${n.rainbowProcs}</div>\n        <div style="font-size:9px;color:#888;margin-top:2px;">Rainbow Procs</div>\n        <div style="font-size:10px;color:#4CAF50;margin-top:4px;">${n.rainbowPerHour.toFixed(1)}/hr</div>\n      </div>\n      <div style="padding:10px;background:#1a1a2a;border-radius:6px;text-align:center;">\n        <div style="font-size:18px;margin-bottom:4px;">üìà</div>\n        <div style="font-size:14px;font-weight:bold;color:#FFD700;">${n.cropBoostProcs}</div>\n        <div style="font-size:9px;color:#888;margin-top:2px;">Crop Boosts</div>\n        <div style="font-size:10px;color:#4CAF50;margin-top:4px;">${n.cropBoostPerHour.toFixed(1)}/hr</div>\n      </div>\n      <div style="padding:10px;background:#1a1a2a;border-radius:6px;text-align:center;">\n        <div style="font-size:18px;margin-bottom:4px;">‚òÅÔ∏è</div>\n        <div style="font-size:14px;font-weight:bold;color:#FFD700;">${r}</div>\n        <div style="font-size:9px;color:#888;margin-top:2px;">Weather Procs</div>\n        <div style="font-size:10px;color:#4CAF50;margin-top:4px;">${i.toFixed(1)}/hr</div>\n      </div>\n    `,d.appendChild(s),n.bestSessionValue>0||n.bestHourValue>0){const e=document.createElement("div");e.style.cssText="padding:10px;background:#1a1a2a;border-radius:6px;",e.innerHTML=`\n        <div style="font-weight:bold;font-size:11px;margin-bottom:8px;">üèÜ Best Records</div>\n        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;font-size:10px;">\n          <div><span style="color:#888;">Best Hour:</span> <strong style="color:#FFD700;">${u(n.bestHourValue)}</strong></div>\n          <div><span style="color:#888;">Best Session:</span> <strong style="color:#FFD700;">${u(n.bestSessionValue)}</strong></div>\n        </div>\n      `,d.appendChild(e)}};p();const m=Bl(p),f=wl(p),g=new MutationObserver(t=>{t.forEach(t=>{t.removedNodes.forEach(t=>{(t===e||t.contains?.(e))&&(m(),f(),g.disconnect())})})});return e.parentElement&&g.observe(e.parentElement,{childList:!0,subtree:!0}),e}function Fu(){const{root:e,body:t}=Eu("üìä Statistics Overview",{subtitle:"Session performance and value tracking"});e.dataset.qpmSection="stats-overview";const n=e=>e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString(),o=(e,t,n="‚Ä¢")=>{const o=document.createElement("div");return o.style.cssText="display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid #2a2a2a;font-size:11px;",o.innerHTML=`\n      <span style="color:#888;">${n} ${e}</span>\n      <span style="color:#FFD700;font-weight:bold;">${t}</span>\n    `,o},r=(e,t)=>{const n=document.createElement("div");return n.style.cssText="font-weight:bold;font-size:13px;color:#FFD700;margin:16px 0 8px 0;padding-bottom:4px;border-bottom:2px solid #FFD700;",n.textContent=`${t} ${e}`,n},i=new Set(["GoldGranter","RainbowGranter","ProduceScaleBoost","ProduceScaleBoostII","ProduceRefund","DoubleHarvest","SellBoostI","SellBoostII","SellBoostIII","SellBoostIV","CoinFinderI","CoinFinderII","CoinFinderIII","PetRefund","PetRefundII"]),a=()=>{t.innerHTML="";const e=ql(),l=cs(),c=xl();t.appendChild(r("Current Session","‚è±Ô∏è"));const d=Date.now()-e.stats.sessionStart;t.appendChild(o("Session Duration",(e=>{const t=Math.floor(e/36e5),n=Math.floor(e%36e5/6e4);return t>0?`${t}h ${n}m`:`${n}m`})(d),"‚è±Ô∏è")),t.appendChild(o("Session Value",n(e.stats.sessionValue)+" coins","üí∞"));const u=d>0?Math.round(e.stats.sessionValue/d*36e5):0;if(t.appendChild(o("Value per Hour",n(u)+" coins/hr","üìä")),t.appendChild(r("Mutation Value","üíé")),t.appendChild(o("Gold Procs",e.stats.goldProcs+" ("+e.stats.goldPerHour.toFixed(1)+"/hr)","üü°")),t.appendChild(o("Gold Value",n(e.stats.goldTotalValue)+" coins","üí∞")),t.appendChild(o("Rainbow Procs",e.stats.rainbowProcs+" ("+e.stats.rainbowPerHour.toFixed(1)+"/hr)","üåà")),t.appendChild(o("Rainbow Value",n(e.stats.rainbowTotalValue)+" coins","üí∞")),t.appendChild(o("Crop Boost Procs",e.stats.cropBoostProcs+" ("+e.stats.cropBoostPerHour.toFixed(1)+"/hr)","üìà")),t.appendChild(o("Boost Value",n(e.stats.cropBoostTotalValue)+" coins","üí∞")),t.appendChild(r("Personal Records","üèÜ")),e.stats.bestHourValue>0&&(t.appendChild(o("Best Hour",n(e.stats.bestHourValue)+" coins","‚≠ê")),e.stats.bestHourTime)){const n=new Date(e.stats.bestHourTime);t.appendChild(o("Best Hour Date",n.toLocaleDateString(),"üìÖ"))}if(e.stats.bestSessionValue>0&&(t.appendChild(o("Best Session",n(e.stats.bestSessionValue)+" coins","üåü")),e.stats.bestSessionTime)){const n=new Date(e.stats.bestSessionTime);t.appendChild(o("Best Session Date",n.toLocaleDateString(),"üìÖ"))}if(0===e.stats.bestHourValue&&0===e.stats.bestSessionValue){const e=document.createElement("div");e.style.cssText="padding:8px;background:rgba(139,195,74,0.1);border-radius:4px;font-size:10px;color:#8BC34A;margin-top:4px;",e.innerHTML="‚ÑπÔ∏è Personal records will be tracked as you play.",t.appendChild(e)}const p=c.stats.wetCount+c.stats.chilledCount+c.stats.frozenCount+c.stats.dawnlitCount+c.stats.dawnboundCount+c.stats.amberlitCount+c.stats.amberboundCount,m=c.stats.wetPerHour+c.stats.chilledPerHour+c.stats.frozenPerHour+c.stats.dawnlitPerHour+c.stats.dawnboundPerHour+c.stats.amberlitPerHour+c.stats.amberboundPerHour,f=c.stats.wetTotalValue+c.stats.chilledTotalValue+c.stats.frozenTotalValue+c.stats.dawnlitTotalValue+c.stats.dawnboundTotalValue+c.stats.amberlitTotalValue+c.stats.amberboundTotalValue;p>0&&(t.appendChild(r("Weather Mutations","üå§Ô∏è")),t.appendChild(o("Total Weather Procs",n(p),"üå§Ô∏è")),t.appendChild(o("Procs per Hour",m.toFixed(1),"‚ö°")),t.appendChild(o("Total Value",n(f)+" coins","üí∞"))),t.appendChild(r("Top Abilities by Value","‚ö°"));const g=Object.entries(l.abilities.valueByAbility).filter(([e])=>i.has(e)).sort(([,e],[,t])=>t-e).slice(0,5);if(g.length>0)g.forEach(([e,r])=>{const i=ks(e),a=i?.name||e,s=l.abilities.procsByAbility[e]||0,c=a+" ("+String(s)+"x)",d=n(r)+" coins";t.appendChild(o(c,d,"‚ñ∏"))});else{const e=document.createElement("div");e.style.cssText="padding:8px;background:rgba(139,195,74,0.1);border-radius:4px;font-size:10px;color:#8BC34A;margin-top:4px;",e.innerHTML="‚ÑπÔ∏è Ability stats will appear as your pets proc abilities.",t.appendChild(e)}if(e.sessions&&e.sessions.length>0){t.appendChild(r("Session History","üìà"));const i=e.sessions.slice(-7),a=i.reduce((e,t)=>e+t.value,0)/i.length;t.appendChild(o("Sessions Logged",e.sessions.length.toString(),"üìù"));const s=n(Math.round(a))+" coins/session";if(t.appendChild(o("Last 7 Days Avg",s,"üìä")),i.length>=2){const e=i.slice(-3).reduce((e,t)=>e+t.value,0)/Math.min(3,i.length),n=i.slice(0,-3).reduce((e,t)=>e+t.value,0)/Math.max(1,i.length-3),r=e>n?"üìà Improving":e<n?"üìâ Declining":"‚û°Ô∏è Stable";t.appendChild(o("Trend",r,"üìâ"))}}if(l.garden.totalHarvested>0){t.appendChild(r("Garden Insights","üå±")),t.appendChild(o("Total Harvested",n(l.garden.totalHarvested),"üåæ"));const e=d>0?Math.round(l.garden.totalHarvested/d*36e5):0;t.appendChild(o("Harvest Rate",e+"/hr","‚ö°")),l.garden.totalWateringCans>0&&t.appendChild(o("Watering Cans Used",n(l.garden.totalWateringCans),"üíß"))}const h=up("üóëÔ∏è Reset All Stats",async()=>{if(confirm("‚ö†Ô∏è This will reset ALL statistics including:\n\n‚Ä¢ Session value tracking\n‚Ä¢ Mutation records\n‚Ä¢ Ability performance\n‚Ä¢ Garden metrics\n\nThis action cannot be undone. Continue?")){h.disabled=!0,h.textContent="‚è≥ Resetting...";try{const{resetPetHatchingTracker:e}=await Promise.resolve().then(()=>Pf);ds(),e(),Rl(),h.textContent="‚úÖ Reset Complete!",setTimeout(()=>{h.textContent="üóëÔ∏è Reset All Stats",h.disabled=!1,a()},2e3)}catch(e){s("Error resetting stats:",e),h.textContent="‚ùå Error",setTimeout(()=>{h.textContent="üóëÔ∏è Reset All Stats",h.disabled=!1},2e3)}}});h.style.cssText="width:100%;margin-top:16px;background:#d32f2f;",h.title="Reset all QPM statistics",t.appendChild(h)};a();const l=ls(()=>a()),c=Bl(()=>a()),d=wl(()=>a()),u=new MutationObserver(()=>{document.contains(e)||(l(),c(),d(),u.disconnect())});return e.parentElement&&u.observe(e.parentElement,{childList:!0,subtree:!0}),e}async function Iu(){const{root:e,body:t}=Eu("‚≠ê Auto-Favorite",{subtitle:"Automatically favorite crops and pets"});e.dataset.qpmSection="auto-favorite";const n=pc(),o=document.createElement("label");o.style.cssText="\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 12px;\n    background: var(--qpm-surface-1, #1a1a1a);\n    border-radius: 8px;\n    cursor: pointer;\n    margin-bottom: 16px;\n  ";const r=document.createElement("input");r.type="checkbox",r.checked=n.enabled,r.style.cssText="\n    width: 20px;\n    height: 20px;\n    cursor: pointer;\n  ";const i=document.createElement("span");i.textContent="Enable Auto-Favorite",i.style.cssText="\n    font-weight: 600;\n    font-size: 14px;\n    color: var(--qpm-text, #fff);\n  ",r.addEventListener("change",()=>{mc({enabled:r.checked})}),o.appendChild(r),o.appendChild(i),t.appendChild(o);const a=document.createElement("div");a.style.cssText="\n    padding: 12px;\n    background: rgba(76, 175, 80, 0.1);\n    border-left: 3px solid var(--qpm-accent, #4CAF50);\n    border-radius: 4px;\n    margin-bottom: 16px;\n    font-size: 12px;\n    line-height: 1.6;\n    color: var(--qpm-text-muted, #aaa);\n  ",a.innerHTML="\n    üí° <strong>How it works:</strong><br>\n    ‚Ä¢ Monitors inventory in background (no need to open inventory)<br>\n    ‚Ä¢ Automatically favorites matching items when detected<br>\n    ‚Ä¢ Never unfavorites items (safe for manual favorites)<br>\n    ‚Ä¢ Works via WebSocket (instant, no lag)\n  ",t.appendChild(a);const s=document.createElement("div");s.style.cssText="\n    margin-bottom: 16px;\n  ";const l=document.createElement("h4");l.textContent="üêæ Pet Abilities",l.style.cssText="\n    margin: 0 0 8px 0;\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--qpm-accent, #4CAF50);\n  ",s.appendChild(l);[{id:"Gold Granter",label:"Gold Granter"},{id:"Rainbow Granter",label:"Rainbow Granter"}].forEach(e=>{const t=document.createElement("label");t.style.cssText="\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      padding: 8px;\n      cursor: pointer;\n      border-radius: 4px;\n      transition: background 0.2s;\n    ",t.addEventListener("mouseenter",()=>{t.style.background="rgba(255, 255, 255, 0.05)"}),t.addEventListener("mouseleave",()=>{t.style.background="transparent"});const o=document.createElement("input");o.type="checkbox",o.checked=n.petAbilities?.includes(e.id)??!1,o.style.cssText="width: 16px; height: 16px; cursor: pointer;",o.addEventListener("change",()=>{const t=pc().petAbilities||[];mc({petAbilities:o.checked?[...t,e.id]:t.filter(t=>t!==e.id)}),o.checked&&window.qpm_favoritePetAbility?.(e.id)});const r=document.createElement("span");r.textContent=e.label,r.style.cssText="font-size: 13px; color: var(--qpm-text, #fff);",t.appendChild(o),t.appendChild(r),s.appendChild(t)}),t.appendChild(s);const c=document.createElement("div");c.style.cssText="\n    margin-bottom: 16px;\n  ";const d=document.createElement("h4");d.textContent="‚ú® Crop Mutations",d.style.cssText="\n    margin: 0 0 8px 0;\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--qpm-accent, #4CAF50);\n  ",c.appendChild(d);[{id:"Rainbow",label:"Rainbow",color:"#9C27B0"},{id:"Gold",label:"Golden",color:"#FFD700"},{id:"Frozen",label:"Frozen",color:"#2196F3"},{id:"Wet",label:"Wet",color:"#03A9F4"},{id:"Chilled",label:"Chilled",color:"#00BCD4"},{id:"Dawnlit",label:"Dawnlit",color:"#FF9800"},{id:"Dawnbound",label:"Dawnbound",color:"#FF5722"},{id:"Amberlit",label:"Amberlit",color:"#FFC107"},{id:"Amberbound",label:"Amberbound",color:"#FF6F00"}].forEach(e=>{const t=document.createElement("label");t.style.cssText="\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      padding: 8px;\n      cursor: pointer;\n      border-radius: 4px;\n      transition: background 0.2s;\n    ",t.addEventListener("mouseenter",()=>{t.style.background="rgba(255, 255, 255, 0.05)"}),t.addEventListener("mouseleave",()=>{t.style.background="transparent"});const o=document.createElement("input");o.type="checkbox",o.checked=n.mutations.includes(e.id),o.style.cssText="width: 16px; height: 16px; cursor: pointer;",o.addEventListener("change",()=>{const t=pc().mutations;mc({mutations:o.checked?[...t,e.id]:t.filter(t=>t!==e.id)}),o.checked&&window.qpm_favoriteMutation?.(e.id)});const r=document.createElement("span");r.style.cssText=`\n      width: 12px;\n      height: 12px;\n      border-radius: 50%;\n      background: ${e.color};\n      flex-shrink: 0;\n    `;const i=document.createElement("span");i.textContent=e.label,i.style.cssText="font-size: 13px; color: var(--qpm-text, #fff);",t.appendChild(o),t.appendChild(r),t.appendChild(i),c.appendChild(t)}),t.appendChild(c);const u=document.createElement("div");u.style.cssText="\n    margin-top: 16px;\n    padding-top: 16px;\n    border-top: 1px solid rgba(255, 255, 255, 0.1);\n  ";const p=document.createElement("h4");p.textContent="‚öôÔ∏è Advanced Filters",p.style.cssText="\n    margin: 0 0 12px 0;\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--qpm-accent, #4CAF50);\n  ",u.appendChild(p);const m=document.createElement("div");m.style.cssText="\n    font-size: 11px;\n    color: rgba(255, 255, 255, 0.5);\n    margin-bottom: 12px;\n    padding: 8px;\n    background: rgba(255, 152, 0, 0.1);\n    border-left: 2px solid #FF9800;\n    border-radius: 4px;\n  ",m.textContent="üí° Select multiple options to filter which items get auto-favorited.",u.appendChild(m);const f=document.createElement("div");f.style.cssText="margin-bottom: 16px;";const g=document.createElement("h5");g.textContent="Filter by Abilities:",g.style.cssText="margin: 0 0 8px 0; font-size: 12px; font-weight: 600; color: rgba(255, 255, 255, 0.8);",f.appendChild(g);const h=document.createElement("div");h.style.cssText="display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; max-height: 300px; overflow-y: auto;";const{getAllAbilityDefinitions:b}=await Promise.resolve().then(()=>Is),y=b(),x=new Map;y.forEach(e=>{const t=e.name.replace(/\s+(I{1,4}|\d+)$/,"");x.has(t)||x.set(t,[]),x.get(t).push({id:e.id,name:e.name})});const w=[];Array.from(x.entries()).sort(([e],[t])=>e.localeCompare(t)).forEach(([e,t])=>{const n=t.map(e=>e.id);w.push({value:n,label:e})}),w.forEach(e=>{const t=document.createElement("label");t.style.cssText="display: flex; align-items: center; gap: 6px; padding: 4px 6px; cursor: pointer; border-radius: 4px; transition: background 0.2s; font-size: 12px;",t.addEventListener("mouseenter",()=>t.style.background="rgba(255, 255, 255, 0.05)"),t.addEventListener("mouseleave",()=>t.style.background="transparent");const o=document.createElement("input");o.type="checkbox";const r=n.filterByAbilities||[];o.checked=e.value.some(e=>r.includes(e)),o.style.cssText="width: 14px; height: 14px; cursor: pointer; flex-shrink: 0;",o.addEventListener("change",()=>{const t=pc().filterByAbilities||[];if(o.checked){const n=e.value.filter(e=>!t.includes(e));mc({filterByAbilities:[...t,...n]})}else{mc({filterByAbilities:t.filter(t=>!e.value.includes(t))})}});const i=document.createElement("span");i.textContent=e.label,i.style.cssText="color: var(--qpm-text, #fff); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;",i.title=e.label,t.appendChild(o),t.appendChild(i),h.appendChild(t)}),f.appendChild(h),u.appendChild(f);const v=document.createElement("div");v.style.cssText="margin-bottom: 12px;";const C=document.createElement("label");C.textContent="Filter by Ability Count:",C.style.cssText="display: block; font-size: 12px; color: rgba(255, 255, 255, 0.7); margin-bottom: 4px;",v.appendChild(C);const T=document.createElement("select");T.style.cssText="\n    width: 100%;\n    padding: 8px;\n    background: rgba(0, 0, 0, 0.3);\n    border: 1px solid rgba(255, 255, 255, 0.2);\n    border-radius: 4px;\n    color: #fff;\n    font-size: 13px;\n    cursor: pointer;\n  ",[{value:"",label:"Any Count"},{value:"1",label:"1 Ability"},{value:"2",label:"2 Abilities"},{value:"3",label:"3 Abilities"},{value:"4",label:"4 Abilities"}].forEach(e=>{const t=document.createElement("option");t.value=e.value,t.textContent=e.label,T.appendChild(t)}),T.value=null!=n.filterByAbilityCount?String(n.filterByAbilityCount):"",T.addEventListener("change",()=>{mc({filterByAbilityCount:T.value?parseInt(T.value):null})}),v.appendChild(T),u.appendChild(v);const S=document.createElement("div");S.style.cssText="margin-bottom: 16px;";const P=document.createElement("h5");P.textContent="Filter by Pet Species:",P.style.cssText="margin: 0 0 8px 0; font-size: 12px; font-weight: 600; color: rgba(255, 255, 255, 0.8);",S.appendChild(P);const A=document.createElement("div");A.style.cssText="display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px;";const k=["Worm","Snail","Bee","Chicken","Bunny","Dragonfly","Pig","Cow","Turkey","Squirrel","Turtle","Goat","Butterfly","Peacock","Capybara"];k.forEach(e=>{const t=document.createElement("label");t.style.cssText="display: flex; align-items: center; gap: 6px; padding: 6px; cursor: pointer; border-radius: 4px; transition: background 0.2s; font-size: 12px;",t.addEventListener("mouseenter",()=>t.style.background="rgba(255, 255, 255, 0.05)"),t.addEventListener("mouseleave",()=>t.style.background="transparent");const o=document.createElement("input");o.type="checkbox",o.checked=(n.filterBySpecies||[]).includes(e),o.style.cssText="width: 14px; height: 14px; cursor: pointer;",o.addEventListener("change",()=>{const t=pc().filterBySpecies||[];mc({filterBySpecies:o.checked?[...t,e]:t.filter(t=>t!==e)})});const r=document.createElement("span");r.textContent=e,r.style.cssText="color: var(--qpm-text, #fff);",t.appendChild(o),t.appendChild(r),A.appendChild(t)}),S.appendChild(A),u.appendChild(S);const E=document.createElement("div");E.style.cssText="margin-bottom: 16px;";const $=document.createElement("h5");$.textContent="Filter by Crop Name:",$.style.cssText="margin: 0 0 8px 0; font-size: 12px; font-weight: 600; color: rgba(255, 255, 255, 0.8);",E.appendChild($);const M=document.createElement("div");M.style.cssText="display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; max-height: 300px; overflow-y: auto;";const{getAllCropNames:F}=await Promise.resolve().then(()=>Ji),I=F();var L;return I.forEach(e=>{const t=document.createElement("label");t.style.cssText="display: flex; align-items: center; gap: 6px; padding: 4px 6px; cursor: pointer; border-radius: 4px; transition: background 0.2s; font-size: 12px;",t.addEventListener("mouseenter",()=>t.style.background="rgba(255, 255, 255, 0.05)"),t.addEventListener("mouseleave",()=>t.style.background="transparent");const o=document.createElement("input");o.type="checkbox",o.checked=(n.filterByCropTypes||[]).includes(e),o.style.cssText="width: 14px; height: 14px; cursor: pointer; flex-shrink: 0;",o.addEventListener("change",()=>{const t=pc().filterByCropTypes||[];mc({filterByCropTypes:o.checked?[...t,e]:t.filter(t=>t!==e)})});const r=document.createElement("span");r.textContent=e,r.style.cssText="color: var(--qpm-text, #fff); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;",r.title=e,t.appendChild(o),t.appendChild(r),M.appendChild(t)}),E.appendChild(M),u.appendChild(E),t.appendChild(u),L=e=>{r.checked=e.enabled,T.value=null!=e.filterByAbilityCount?String(e.filterByAbilityCount):"",h.querySelectorAll('input[type="checkbox"]').forEach((t,n)=>{const o=w[n];o&&(t.checked=o.value.some(t=>(e.filterByAbilities||[]).includes(t)))}),A.querySelectorAll('input[type="checkbox"]').forEach((t,n)=>{t.checked=(e.filterBySpecies||[]).includes(k[n]||"")}),M.querySelectorAll('input[type="checkbox"]').forEach((t,n)=>{t.checked=(e.filterByCropTypes||[]).includes(I[n]||"")})},Yl.add(L),L({...Ql}),e}async function Lu(){if(function(){if(ku)return;const e=document.createElement("style");e.id="qpm-panel-styles",e.textContent=':root {\n    --qpm-surface-1: rgba(18, 21, 32, 0.95);\n    --qpm-surface-2: rgba(32, 36, 52, 0.9);\n    --qpm-surface-3: rgba(52, 58, 78, 0.85);\n    --qpm-border: rgba(120, 130, 170, 0.28);\n    --qpm-text: #eef0ff;\n    --qpm-text-muted: #97a0c0;\n    --qpm-accent: #8f82ff;\n    --qpm-accent-strong: #b39cff;\n    --qpm-positive: #4fd18b;\n    --qpm-danger: #ff6f91;\n    --qpm-warning: #ffb347;\n    --qpm-shadow: 0 14px 32px rgba(15, 17, 28, 0.55);\n    --qpm-divider: rgba(120, 130, 170, 0.2);\n    --qpm-font: \'Inter\', \'Segoe UI\', Arial, sans-serif;\n  }\n\n  .qpm-panel {\n    position: fixed;\n    right: 16px;\n    bottom: 16px;\n    z-index: 2147483647;\n    background: var(--qpm-surface-1);\n    color: var(--qpm-text);\n    padding: 0;\n    border-radius: 14px;\n    font: 12px/1.55 var(--qpm-font);\n    box-shadow: var(--qpm-shadow);\n    min-width: 360px;\n    max-width: 430px;\n    max-height: calc(100vh - 32px);\n    overflow: hidden;\n    backdrop-filter: blur(18px);\n    border: 1px solid var(--qpm-border);\n  }\n\n  .qpm-panel__titlebar {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 12px 16px;\n    font-size: 15px;\n    font-weight: 600;\n    background: linear-gradient(135deg, rgba(143, 130, 255, 0.28), rgba(32, 36, 52, 0.85));\n    cursor: move;\n    user-select: none;\n  }\n\n  .qpm-panel__titlebar button {\n    background: rgba(255, 255, 255, 0.08);\n    border: 1px solid rgba(255, 255, 255, 0.18);\n    color: var(--qpm-text-muted);\n    border-radius: 18px;\n    font-size: 11px;\n    padding: 4px 10px;\n    cursor: pointer;\n    transition: background 0.2s ease, color 0.2s ease;\n  }\n\n  .qpm-panel__titlebar button:hover {\n    background: rgba(255, 255, 255, 0.16);\n    color: var(--qpm-text);\n  }\n\n  .qpm-version-bubble {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    padding: 4px 10px;\n    border-radius: 4px;\n    font-size: 11px;\n    font-weight: 600;\n    letter-spacing: 0.3px;\n    transition: all 0.2s ease;\n    margin-left: auto;\n    margin-right: 8px;\n  }\n\n  .qpm-version-bubble[data-status="up-to-date"] {\n    background: rgba(76, 175, 80, 0.2);\n    color: #4CAF50;\n    border: 1px solid rgba(76, 175, 80, 0.4);\n  }\n\n  .qpm-version-bubble[data-status="outdated"] {\n    background: rgba(255, 193, 7, 0.2);\n    color: #FFC107;\n    border: 1px solid rgba(255, 193, 7, 0.4);\n    animation: pulse-warning 2s ease-in-out infinite;\n  }\n\n  .qpm-version-bubble[data-status="checking"] {\n    background: rgba(158, 158, 158, 0.2);\n    color: #9E9E9E;\n    border: 1px solid rgba(158, 158, 158, 0.4);\n  }\n\n  .qpm-version-bubble[data-status="error"] {\n    background: rgba(244, 67, 54, 0.2);\n    color: #F44336;\n    border: 1px solid rgba(244, 67, 54, 0.4);\n  }\n\n  .qpm-version-bubble:hover[data-status="outdated"] {\n    transform: scale(1.05);\n    background: rgba(255, 193, 7, 0.3);\n  }\n\n  @keyframes pulse-warning {\n    0%, 100% {\n      opacity: 1;\n    }\n    50% {\n      opacity: 0.7;\n    }\n  }\n\n  .qpm-content {\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n    padding: 12px 16px 16px;\n    overflow-y: auto;\n    overflow-x: hidden;\n    max-height: calc(100vh - 120px);\n  }\n\n  .qpm-nav {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 8px;\n    margin-bottom: 6px;\n  }\n\n  .qpm-nav__button {\n    flex: 1 1 calc(33% - 8px);\n    min-width: 120px;\n    border: 1px solid var(--qpm-border);\n    background: rgba(255, 255, 255, 0.04);\n    color: var(--qpm-text-muted);\n    border-radius: 10px;\n    padding: 8px 10px;\n    font-size: 12px;\n    font-weight: 600;\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    cursor: pointer;\n    transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;\n  }\n\n  .qpm-nav__button:hover {\n    border-color: var(--qpm-accent-strong);\n    color: var(--qpm-text);\n  }\n\n  .qpm-nav__button--active {\n    border-color: var(--qpm-accent);\n    color: var(--qpm-text);\n    /* Background and box-shadow set by JavaScript based on tab color */\n  }\n\n  .qpm-tabs {\n    position: relative;\n  }\n\n  .qpm-tab {\n    display: none;\n    flex-direction: column;\n    gap: 12px;\n  }\n\n  .qpm-tab--active {\n    display: flex;\n  }\n\n  .qpm-card {\n    background: var(--qpm-surface-2);\n    border: 1px solid var(--qpm-border);\n    border-radius: 12px;\n    padding: 12px 14px;\n    box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.03);\n  }\n\n  .qpm-table {\n    width: 100%;\n    border-collapse: collapse;\n  }\n\n  .qpm-table thead {\n    background: rgba(255, 255, 255, 0.05);\n    text-transform: uppercase;\n    letter-spacing: 0.3px;\n    font-size: 9px;\n    color: var(--qpm-text-muted);\n  }\n\n  .qpm-table th,\n  .qpm-table td {\n    padding: 6px 8px;\n    text-align: left;\n    border-bottom: 1px solid rgba(255, 255, 255, 0.04);\n  }\n\n  .qpm-table tbody tr:nth-child(odd) {\n    background: rgba(255, 255, 255, 0.02);\n  }\n\n  .qpm-table--compact th,\n  .qpm-table--compact td {\n    font-size: 10px;\n  }\n\n  .qpm-ability-divider td {\n    border-top: 1px solid rgba(255, 255, 255, 0.08);\n  }\n\n  .qpm-ability-section td {\n    background: rgba(255, 255, 255, 0.04);\n    font-weight: 600;\n    font-size: 11px;\n    color: var(--qpm-text);\n    padding: 7px 8px;\n    border-top: 1px solid rgba(255, 255, 255, 0.08);\n  }\n\n  .qpm-ability-section__content {\n    display: flex;\n    align-items: baseline;\n    justify-content: space-between;\n    gap: 12px;\n    flex-wrap: wrap;\n  }\n\n  .qpm-ability-section__title {\n    font-weight: 600;\n  }\n\n  .qpm-ability-section__meta {\n    font-weight: 400;\n    font-size: 10px;\n    color: var(--qpm-text-muted);\n  }\n\n  .qpm-ability-total {\n    font-weight: 600;\n    background: rgba(255, 255, 255, 0.03);\n  }\n\n  .qpm-ability-total td {\n    border-top: 1px solid rgba(255, 255, 255, 0.08);\n  }\n\n  .qpm-tracker-summary {\n    font-size: 11px;\n    color: var(--qpm-text-muted);\n    line-height: 1.5;\n  }\n\n  .qpm-mutation-meta {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    gap: 8px;\n    flex-wrap: wrap;\n    font-size: 11px;\n  }\n\n  .qpm-mutation-meta__group {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    flex-wrap: wrap;\n  }\n\n  .qpm-mutation-source {\n    font-size: 10px;\n    color: var(--qpm-text-muted);\n    background: rgba(255, 255, 255, 0.06);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: 999px;\n    padding: 2px 8px;\n  }\n\n  .qpm-mutation-countdown {\n    font-size: 11px;\n    color: var(--qpm-text-muted);\n    margin-top: 4px;\n  }\n\n  .qpm-mutation-countdown[data-state=\'active\'] {\n    color: #b3ffe0;\n  }\n\n  .qpm-mutation-countdown[data-state=\'expired\'] {\n    color: #ffcc80;\n  }\n\n  .qpm-mutation-totals {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 6px;\n    margin-top: 8px;\n  }\n\n  .qpm-mutation-chip {\n    background: rgba(255, 255, 255, 0.05);\n    border: 1px solid rgba(255, 255, 255, 0.08);\n    border-radius: 10px;\n    padding: 6px 10px;\n    min-width: 130px;\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n  }\n\n  .qpm-mutation-chip--active {\n    border-color: rgba(143, 130, 255, 0.5);\n    box-shadow: 0 0 0 1px rgba(143, 130, 255, 0.3);\n  }\n\n  .qpm-mutation-chip__label {\n    font-size: 11px;\n    font-weight: 600;\n    color: var(--qpm-text);\n  }\n\n  .qpm-mutation-chip__meta {\n    font-size: 10px;\n    color: var(--qpm-text-muted);\n  }\n\n  .qpm-mutation-detail {\n    margin-top: 8px;\n  }\n\n  .qpm-tracker-note {\n    font-size: 10px;\n    color: #90caf9;\n    background: rgba(144, 202, 249, 0.08);\n    border: 1px dashed rgba(144, 202, 249, 0.4);\n    border-radius: 8px;\n    padding: 8px;\n  }\n\n  .qpm-card__header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    margin-bottom: 6px;\n  }\n\n  .qpm-card__title {\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--qpm-text);\n    display: flex;\n    align-items: center;\n    gap: 6px;\n  }\n\n  .qpm-section-muted {\n    color: var(--qpm-text-muted);\n    font-size: 11px;\n  }\n\n  .qpm-button {\n    padding: 6px 10px;\n    font-size: 12px;\n    cursor: pointer;\n    border: 1px solid var(--qpm-border);\n    border-radius: 10px;\n    background: rgba(255, 255, 255, 0.06);\n    color: var(--qpm-text);\n    transition: background 0.2s ease, border-color 0.2s ease;\n  }\n\n  .qpm-button:hover:not(:disabled) {\n    background: rgba(255, 255, 255, 0.12);\n    border-color: var(--qpm-accent);\n  }\n\n  .qpm-button:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n  }\n\n  .qpm-button--accent {\n    background: rgba(143, 130, 255, 0.24);\n    border-color: var(--qpm-accent);\n  }\n\n  .qpm-button--positive {\n    background: rgba(79, 209, 139, 0.28);\n    border-color: rgba(79, 209, 139, 0.6);\n  }\n\n  .qpm-grid {\n    display: grid;\n    gap: 10px;\n  }\n\n  .qpm-grid--two {\n    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\n  }\n\n  .qpm-row {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    flex-wrap: wrap;\n  }\n\n  .qpm-input,\n  .qpm-select {\n    padding: 4px 8px;\n    border: 1px solid var(--qpm-border);\n    border-radius: 8px;\n    background: rgba(20, 24, 36, 0.65);\n    color: var(--qpm-text);\n    font-size: 11px;\n    transition: border-color 0.2s ease, box-shadow 0.2s ease;\n  }\n\n  .qpm-input:focus,\n  .qpm-select:focus {\n    outline: none;\n    border-color: var(--qpm-accent);\n    box-shadow: 0 0 0 2px rgba(143, 130, 255, 0.18);\n  }\n\n  .qpm-checkbox {\n    accent-color: var(--qpm-accent);\n  }\n\n  .qpm-coming-grid {\n    display: grid;\n    gap: 10px;\n    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));\n  }\n\n  .qpm-coming-card {\n    background: var(--qpm-surface-3);\n    border: 1px dashed rgba(143, 130, 255, 0.35);\n    border-radius: 10px;\n    padding: 10px;\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n    color: var(--qpm-text-muted);\n  }\n\n  .qpm-coming-card strong {\n    color: var(--qpm-text);\n    font-size: 12px;\n  }\n\n  .qpm-coming-card span {\n    color: var(--qpm-accent-strong);\n    font-size: 11px;\n    font-weight: 600;\n  }\n\n  .qpm-chip {\n    display: inline-flex;\n    align-items: center;\n    gap: 4px;\n    padding: 2px 6px;\n    border-radius: 999px;\n    font-size: 10px;\n    background: rgba(143, 130, 255, 0.22);\n    color: var(--qpm-text);\n    border: 1px solid rgba(143, 130, 255, 0.35);\n  }\n\n  .qpm-toast {\n    position: fixed;\n    bottom: 24px;\n    right: 24px;\n    background: rgba(20, 26, 40, 0.92);\n    border: 1px solid rgba(143, 130, 255, 0.35);\n    color: var(--qpm-text);\n    padding: 10px 14px;\n    border-radius: 12px;\n    font-size: 12px;\n    z-index: 2147483647;\n    box-shadow: 0 10px 26px rgba(12, 16, 28, 0.55);\n    animation: qpm-toast-in 0.25s ease;\n  }\n\n  @keyframes qpm-toast-in {\n    from { opacity: 0; transform: translateY(12px); }\n    to { opacity: 1; transform: translateY(0); }\n  }\n\n  /* Custom scrollbar for main panel content */\n  .qpm-content::-webkit-scrollbar {\n    width: 8px;\n  }\n  .qpm-content::-webkit-scrollbar-track {\n    background: rgba(0, 0, 0, 0.2);\n    border-radius: 4px;\n  }\n  .qpm-content::-webkit-scrollbar-thumb {\n    background: rgba(143, 130, 255, 0.35);\n    border-radius: 4px;\n    transition: background 0.2s;\n  }\n  .qpm-content::-webkit-scrollbar-thumb:hover {\n    background: rgba(143, 130, 255, 0.55);\n  }\n  ',document.head.appendChild(e),ku=!0}(),Hd.panel)return Hd.panel;const e=document.createElement("div");e.className="qpm-panel";const t=document.createElement("div");t.className="qpm-panel__titlebar",t.title="Drag to move ‚Ä¢ Click to collapse";const n=document.createElement("span");n.textContent="üçñ Quinoa Pet Manager";const o=document.createElement("div");o.className="qpm-version-bubble",o.dataset.status="current",o.textContent=`v${Dd()}`,o.title=`QPM v${Dd()}\nUpdates are handled by Tampermonkey`,o.style.cursor="default";const r=document.createElement("button");r.type="button",r.dataset.qpmCollapseButton="true",r.className="qpm-button",r.setAttribute("aria-label","Collapse panel");const i=document.createElement("span");i.textContent="‚ñº",r.appendChild(i),t.append(n,o,r);const a=document.createElement("div");a.className="qpm-content";const c=document.createElement("div");c.className="qpm-nav";const d=document.createElement("div");d.className="qpm-tabs",a.append(c,d),e.append(t,a);const u=Se(),p=!1!==u.syncModeEnabled,m=$u.inventoryLocker?.syncMode,g="boolean"==typeof m?m:p;let h=!1;$u.inventoryLocker?$u.inventoryLocker.syncMode!==g&&($u.inventoryLocker.syncMode=g,h=!0):($u.inventoryLocker={syncMode:g},h=!0),h&&pp(),u.syncModeEnabled!==g&&Pe(g);const b=function(){const e=document.createElement("div");e.className="qpm-card",e.dataset.qpmSection="header",e.style.cssText="background: linear-gradient(135deg, rgba(143,130,255,0.08), rgba(143,130,255,0.03)); border: 1px solid rgba(143,130,255,0.15);";const t=document.createElement("div");t.className="qpm-card__header";const n=document.createElement("div");n.className="qpm-card__title",n.textContent="Session Overview",n.style.cssText="font-size: 14px; font-weight: 700; letter-spacing: 0.3px;";const o=up("‚ôª Reset Stats",Ju);o.classList.add("qpm-button--accent"),o.style.fontSize="11px",o.title="Reset header and detailed stats counters",t.append(n,o),e.appendChild(t);const r=document.createElement("div");r.style.cssText="display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:10px;margin-top:10px;",e.appendChild(r),Tu();const i=function(e,t,n){const o=document.createElement("div");o.style.cssText=`padding:8px 10px;border-radius:6px;background:${n};border:1px solid ${n.replace("0.15","0.25")};display:flex;flex-direction:column;gap:4px;`;const r=document.createElement("div");r.className="indicator-header",r.style.cssText="display:flex;align-items:center;justify-content:space-between;gap:6px;margin-bottom:2px;";const i=document.createElement("div");return i.style.cssText="font-size:11px;font-weight:600;color:#b0b0b0;letter-spacing:0.3px;",i.textContent=`${e} ${t}`,r.appendChild(i),o.appendChild(r),o}("üê¢","Bella's Turtle Temple","rgba(0,150,136,0.15)"),a=i.querySelector(".indicator-header"),l=document.createElement("button");l.type="button",l.className="qpm-chip",l.style.cssText="cursor:pointer;user-select:none;font-size:9px;padding:2px 6px;",a.appendChild(l);const c=document.createElement("div");c.style.cssText="display:flex;align-items:center;justify-content:space-between;gap:4px;cursor:pointer;padding:4px 6px;background:rgba(255,255,255,0.04);border-radius:4px;margin:4px 0;transition:background 0.2s;",c.title="Click to select a different plant";const d=document.createElement("div");d.style.cssText="font-size:12px;font-weight:600;color:#e0f2f1;flex:1;",d.textContent="Loading...",c.appendChild(d);const u=document.createElement("span");u.style.cssText="font-size:9px;color:#80cbc4;",u.textContent="‚ñº",c.appendChild(u),i.appendChild(c);const p=document.createElement("select");p.className="qpm-select",p.style.cssText="display:none;width:100%;padding:4px 6px;font-size:10px;background:rgba(0,0,0,0.3);border:1px solid rgba(0,150,136,0.3);border-radius:4px;color:#e0e0e0;margin-bottom:6px;",i.appendChild(p);const m=document.createElement("option");m.value="",m.textContent="Select a plant...",m.disabled=!0,p.appendChild(m),c.addEventListener("click",e=>{e.stopPropagation();const t="none"===p.style.display;p.style.display=t?"block":"none",u.textContent=t?"‚ñ≤":"‚ñº",t&&f()}),c.addEventListener("mouseenter",()=>{c.style.background="rgba(255,255,255,0.08)"}),c.addEventListener("mouseleave",()=>{c.style.background="rgba(255,255,255,0.04)"}),p.addEventListener("change",()=>{const e=p.value;if(e){const{tileId:t,slotIndex:n}=su(e);$u.turtleTimer={...Tu(),focus:"specific",focusTargetTileId:t,focusTargetSlotIndex:n},pp(),mi({focus:"specific",focusTargetTileId:t,focusTargetSlotIndex:n}),p.style.display="none",u.textContent="‚ñº"}});const f=()=>{const e=hi();for(;p.options.length>1;)p.remove(1);for(const t of e.plantTargets){const e=document.createElement("option");e.value=t.key;const n=t.species??"Unknown",o=null!=t.remainingMs?lu(t.remainingMs):"Ready";e.textContent=`${n} - ${o}`,p.appendChild(e)}},g=document.createElement("div");g.style.cssText="font-size:11px;color:#e0f2f1;font-weight:500;margin-bottom:2px;",i.appendChild(g);const h=document.createElement("div");h.style.cssText="font-size:10px;color:#b2dfdb;line-height:1.4;",i.appendChild(h);const b=document.createElement("div");b.style.cssText="font-size:9px;color:#80cbc4;margin-top:4px;",i.appendChild(b),l.addEventListener("click",()=>{const e=!($u.turtleTimer?.enabled??1);$u.turtleTimer={...Tu(),enabled:e},pp(),fi(e)}),Hd.turtleStatus=g,Hd.turtleDetail=h,Hd.turtleFooter=b,Hd.turtleEnableButtons.push(l),Hd.turtlePlantNameText=d,Hd.turtleUnsubscribe&&Hd.turtleUnsubscribe();Hd.turtleUnsubscribe=bi(e=>{Au(e)}),r.appendChild(i);const y=document.createElement("div");y.style.cssText="font-size:12px;font-weight:600;color:#64b5f6;margin-top:16px;margin-bottom:8px;text-transform:uppercase;letter-spacing:0.5px;",y.textContent="üè™ Shop Restock Tracker",e.appendChild(y);const x=document.createElement("div");x.style.cssText="display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:10px;",e.appendChild(x);const w=[{name:"Starweaver",emoji:"‚≠ê",color:"rgba(255,215,0,0.2)",textColor:"#FFD700"},{name:"Dawnbinder",emoji:"üåÖ",color:"rgba(255,152,0,0.2)",textColor:"#FF9800"},{name:"Moonbinder",emoji:"üåô",color:"rgba(156,39,176,0.2)",textColor:"#CE93D8"},{name:"Mythical Eggs",emoji:"ü•ö",color:"rgba(66,165,245,0.2)",textColor:"#42A5F5"}],v=e=>{const t=Date.now()-e,n=Math.floor(t/864e5),o=Math.floor(t/36e5),r=Math.floor(t/6e4);return n>0?1===n?"1 day ago":`${n} days ago`:o>0?1===o?"1 hour ago":`${o} hours ago`:r>0?1===r?"1 min ago":`${r} mins ago`:"Just now"},C=()=>{x.innerHTML="";const e=Qc();w.forEach(t=>{let n=e.get(t.name);if(!n)for(const[s,l]of e.entries())if(s.includes(t.name)||t.name.includes(s)){n=l;break}const o=document.createElement("div");o.style.cssText=`\n        padding:12px;\n        background:${t.color};\n        border-radius:8px;\n        border:2px solid ${t.textColor}40;\n        box-shadow:0 2px 8px rgba(0,0,0,0.2);\n        transition:all 0.2s ease;\n        cursor:default;\n      `,o.addEventListener("mouseenter",()=>{o.style.transform="translateY(-2px)",o.style.boxShadow="0 4px 12px rgba(0,0,0,0.3)"}),o.addEventListener("mouseleave",()=>{o.style.transform="translateY(0)",o.style.boxShadow="0 2px 8px rgba(0,0,0,0.2)"});const r=document.createElement("div");r.style.cssText="display:flex;align-items:center;gap:6px;margin-bottom:8px;";const i=document.createElement("span");i.style.cssText="font-size:18px;",i.textContent=t.emoji;const a=document.createElement("div");if(a.style.cssText=`font-size:11px;font-weight:700;color:${t.textColor};text-transform:uppercase;letter-spacing:0.5px;`,a.textContent=t.name,r.appendChild(i),r.appendChild(a),o.appendChild(r),n&&n.lastSeen){const e=new Date(n.lastSeen),r=e.toLocaleTimeString([],{hour:"numeric",minute:"2-digit",hour12:!0}),i=e.toLocaleDateString([],{month:"short",day:"numeric"}),a=v(n.lastSeen),s=document.createElement("div");s.style.cssText="margin-bottom:4px;";const l=document.createElement("div");l.style.cssText="font-size:13px;color:#fff;font-weight:600;",l.textContent=`${i} ${r}`,s.appendChild(l),o.appendChild(s);const c=document.createElement("div");c.style.cssText=`font-size:10px;color:${t.textColor};font-weight:600;background:rgba(0,0,0,0.2);padding:3px 8px;border-radius:4px;display:inline-block;`,c.textContent=a,o.appendChild(c)}else{const e=document.createElement("div");e.style.cssText="font-size:11px;color:#999;font-style:italic;text-align:center;padding:12px 0;",e.textContent="No data yet",o.appendChild(e)}x.appendChild(o)})};Uc(),Nd().catch(e=>{s("‚ö†Ô∏è Failed to start live shop tracking",e)});let T=null;return sd(()=>{null!==T&&clearTimeout(T),T=window.setTimeout(()=>{T=null,C()},500)}),C(),e}();!function(){Gd&&(Gd(),Gd=null);const e=document.createElement("div");e.className="qpm-card",e.dataset.qpmSection="stats",e.style.cssText="background: linear-gradient(135deg, rgba(100,181,246,0.08), rgba(100,181,246,0.03)); border: 1px solid rgba(100,181,246,0.15);";const t=document.createElement("div");t.className="qpm-card__header",t.style.cssText="cursor: pointer; padding: 12px 14px; border-radius: 8px; transition: all 0.2s ease; user-select: none;";const n=document.createElement("div");n.className="qpm-card__title",n.textContent="üìä Detailed Stats",n.style.cssText="font-size: 14px; font-weight: 700; letter-spacing: 0.3px; color: #64b5f6;";const o=document.createElement("span");o.style.cssText="font-size: 14px; color: #64b5f6; transition: transform 0.2s ease;",o.textContent="‚ñº";const r=document.createElement("span");r.style.cssText="font-size: 10px; color: #90a4ae; margin-left: 8px; font-weight: 400;",r.textContent="(click to expand)",t.append(n,o,r);const i=document.createElement("div");i.style.cssText="display:block;margin-top:12px;font-size:11px;color:#dbe1ff;line-height:1.6;",t.addEventListener("click",()=>{const e="none"===i.style.display;i.style.display=e?"block":"none",o.textContent=e?"‚ñº":"‚ñ≤",o.style.transform=e?"rotate(0deg)":"rotate(180deg)",r.textContent=e?"(click to expand)":"(click to collapse)",t.style.background=e?"transparent":"rgba(100,181,246,0.08)"}),t.addEventListener("mouseenter",()=>{"none"===i.style.display&&(t.style.background="rgba(100,181,246,0.05)")}),t.addEventListener("mouseleave",()=>{"none"===i.style.display&&(t.style.background="transparent")});const a=document.createElement("div");a.textContent="üçñ Auto Feed",a.style.cssText="font-weight:700;color:#ffcc80;font-size:12px;margin-bottom:4px;text-transform:uppercase;letter-spacing:0.5px;margin-top:4px;";const s=document.createElement("div");s.style.cssText="color:#f0f0f0;margin-bottom:3px;font-size:11px;line-height:1.5;";const c=document.createElement("div");c.style.cssText="color:#c0c0c0;font-size:10px;margin-bottom:10px;line-height:1.5;";const d=document.createElement("div");d.textContent="‚òÄÔ∏è Weather",d.style.cssText="font-weight:700;color:#80deea;font-size:12px;margin-bottom:4px;text-transform:uppercase;letter-spacing:0.5px;";const u=document.createElement("div");u.style.cssText="color:#f0f0f0;margin-bottom:3px;font-size:11px;line-height:1.5;";const p=document.createElement("div");p.style.cssText="color:#c0c0c0;font-size:10px;margin-bottom:10px;line-height:1.5;";const m=document.createElement("div");m.textContent="üõí Auto Shop",m.style.cssText="font-weight:700;color:#ffab91;font-size:12px;margin-bottom:4px;text-transform:uppercase;letter-spacing:0.5px;";const f=document.createElement("div");f.style.cssText="color:#f0f0f0;margin-bottom:3px;font-size:11px;line-height:1.5;";const g=document.createElement("div");g.style.cssText="color:#c0c0c0;font-size:10px;margin-bottom:8px;line-height:1.5;";const h=document.createElement("div");h.textContent="Recent Purchases",h.style.cssText="font-weight:700;font-size:11px;color:#d0d0d0;margin-top:8px;margin-bottom:4px;letter-spacing:0.5px;text-transform:uppercase;";const b=document.createElement("div");b.style.cssText="display:flex;flex-direction:column;gap:3px;font-size:10px;color:#b0b0b0;line-height:1.5;";const y=document.createElement("div");y.style.cssText="margin-top:14px;display:flex;justify-content:flex-end;padding-top:10px;border-top:1px solid rgba(255,255,255,0.08);";const x=up("‚ôª Reset Stats",Ju);x.classList.add("qpm-button--accent"),x.style.cssText="font-size:11px;font-weight:600;",y.append(x),i.append(a,s,c,d,u,p,m,f,g,h,b,y),e.append(t,i);Gd=ls(e=>{const{feed:t,weather:n,shop:o}=e;const r=[];r.push(`${t.totalFeeds} total feeds`);if(t.lastFeedAt){r.push(`last ${l(t.lastFeedAt)}`)}s.textContent=r.join(" ‚Ä¢ ");const i=Object.entries(t.perPet).sort((e,t)=>(t[1]?.count??0)-(e[1]?.count??0)).slice(0,3);if(i.length===0){c.textContent="No feed history yet"}else{const e=i.map(([e,t])=>{const n=t.lastFeedAt?` (${l(t.lastFeedAt)})`:"";return`${e} √ó${t.count}${n}`});c.textContent=e.join(" ‚Ä¢ ")}const a=n.presetUsage.weather.primary+n.presetUsage.noweather.primary;const d=n.presetUsage.weather.alternate+n.presetUsage.noweather.alternate;const m=[];m.push(`Swaps ${n.totalSwaps}`);m.push(`Primary ${a}`);if(d>0)m.push(`Alternate ${d}`);if(n.cooldownBlocks>0)m.push(`Cooldown blocks ${n.cooldownBlocks}`);u.textContent=m.join(" ‚Ä¢ ");const h=Object.entries(n.timeByKind).filter(([,e])=>e>0).sort((e,t)=>(t[1]??0)-(e[1]??0)).slice(0,3).map(([e,t])=>`${Xu(e)} ${Ku(t)}`);p.textContent=h.length>0?h.join(" ‚Ä¢ "):"No uptime recorded yet";const y=[];y.push(`Items ${o.totalPurchases}`);if(o.totalSpentCoins>0){y.push(`ü™ô ${so(o.totalSpentCoins)}`)}if(o.totalSpentCredits>0){y.push(`üç© ${o.totalSpentCredits.toLocaleString()}`)}f.textContent=y.join(" ‚Ä¢ ");const x=Object.entries(o.purchasesByCategory).filter(([,e])=>e>0).sort((e,t)=>(t[1]??0)-(e[1]??0)).map(([e,t])=>`${e}: ${t}`);g.textContent=x.length>0?x.join(" ‚Ä¢ "):"No purchases yet";b.innerHTML="";const w=o.history.slice(-5).reverse();if(w.length===0){const e=document.createElement("div");e.textContent="No recent purchases";b.appendChild(e)}else{for(const e of w){const t=document.createElement("div");const n=[];if(e.coins>0)n.push(`ü™ô ${so(e.coins)}`);if(e.credits>0)n.push(`üç© ${e.credits.toLocaleString()}`);const o=n.length?` (${n.join(" ‚Ä¢ ")})`:"";t.textContent=`${e.itemName} √ó${e.count}${o} ‚Äî ${l(e.timestamp)}`;b.appendChild(t)}}})}(),function(){if(Hd.notificationsSection)return Hd.notificationsSection;const e=document.createElement("div");e.className="qpm-card",e.dataset.qpmSection="notifications";const t=document.createElement("div");t.className="qpm-card__header";const n=document.createElement("div");n.className="qpm-card__title",n.textContent="üîî Notifications";const o=document.createElement("div");o.style.cssText="display:flex;gap:6px;flex-wrap:wrap";const r=up("",()=>{qu(!ou),C()});r.style.fontSize="10px";const i=up("",()=>{ru=!ru,f.set(Kd,ru),Bu();Ru(nu?Yd.find(e=>e.id===nu)??null:null),Du()});i.style.fontSize="10px";const a=up("Clear",()=>{yi.length=0,vi(),Nu(),nu=null,tu.clear(),Gu(null),Hu([]),Du()});a.style.fontSize="10px",o.append(r,i,a),t.append(n,o),e.appendChild(t);const s=document.createElement("div");s.style.cssText="display:flex;flex-direction:column;gap:8px;margin-top:8px;",e.appendChild(s);const l=document.createElement("div");l.style.cssText="display:flex;flex-wrap:wrap;gap:6px",s.appendChild(l);const c=document.createElement("div");c.style.cssText="max-height:240px;overflow-y:auto;padding-right:4px;",s.appendChild(c);const d=document.createElement("div");d.style.cssText="display:flex;flex-direction:column;gap:8px",c.appendChild(d);const u=document.createElement("div");u.textContent="No notifications yet.",u.style.cssText="font-size:11px;color:var(--qpm-text-muted);padding:12px;border:1px dashed rgba(255,255,255,0.1);border-radius:6px;text-align:center;",s.appendChild(u);const p=document.createElement("div");p.style.cssText="border:1px solid rgba(255,255,255,0.08);background:rgba(10,12,20,0.72);border-radius:8px;padding:12px;display:flex;flex-direction:column;gap:10px;min-height:120px",s.appendChild(p);const m=document.createElement("div");m.textContent="Select a notification to see full details.",m.style.cssText="font-size:11px;color:var(--qpm-text-muted);text-align:center;",p.appendChild(m);const g=document.createElement("div");g.style.cssText="display:none;justify-content:space-between;align-items:flex-start;gap:12px;",p.appendChild(g);const h=document.createElement("div");h.style.cssText="font-weight:600;font-size:12px;color:#fff;flex:1 1 auto;overflow:hidden;text-overflow:ellipsis;",g.appendChild(h);const b=document.createElement("div");b.style.cssText="font-size:10px;color:#ccc;white-space:nowrap;",g.appendChild(b);const y=document.createElement("div");y.style.cssText="display:none;flex-wrap:wrap;gap:6px;font-size:10px;color:#d7e3ff;",p.appendChild(y);const x=document.createElement("div");x.style.cssText="display:none;font-size:11px;line-height:1.5;color:#f5f7ff;white-space:pre-wrap;word-break:break-word;",p.appendChild(x);const w=document.createElement("div");w.style.cssText="display:none;flex-wrap:wrap;gap:6px;",p.appendChild(w);const v=document.createElement("pre");v.style.cssText="display:none;font-size:10px;color:#9cd2ff;background:rgba(255,255,255,0.05);padding:8px;border-radius:4px;margin:0;max-height:140px;overflow:auto;",p.appendChild(v),Hd.notificationsSection=e,Hd.notificationsFilterBar=l,Hd.notificationsListWrapper=c,Hd.notificationsList=d,Hd.notificationsEmpty=u,Hd.notificationsDetail=p,Hd.notificationsDetailHeader=g,Hd.notificationsDetailTitle=h,Hd.notificationsDetailTimestamp=b,Hd.notificationsDetailMeta=y,Hd.notificationsDetailMessage=x,Hd.notificationsDetailActions=w,Hd.notificationsDetailRaw=v,Hd.notificationsDetailPlaceholder=m,Hd.notificationsDetailToggle=i,Qd.clear(),eu.clear(),Zd=null,tu.clear(),nu=null,Gu(null),Hd.notificationsUnsubscribe?.(),Hd.notificationsUnsubscribe=Ti(e=>{if(Yd=e,function(e){const t=Hd.notificationsFilterBar;if(!t)return;const n=Array.from(new Set(e.map(e=>e.feature))).sort();for(const o of Array.from(Qd))n.includes(o)||Qd.delete(o);t.textContent="",Zd=Vu("All",()=>{Nu(),Hu(Yd)}),_u(Zd,0===Qd.size),t.appendChild(Zd),eu.clear();for(const o of n){const e=Vu(Uu(o),()=>{zu(o)});_u(e,Qd.has(o)),t.appendChild(e),eu.set(o,e)}}(e),Hu(e),nu){(e.find(e=>e.id===nu)??null)||Gu(null)}});const C=()=>{r.textContent=ou?"Expand":"Collapse",r.classList.toggle("qpm-button--accent",ou)};C(),Bu(),qu(ou),Ru(null),Du()}(),Qu(),function(){Hd.mutationTrackerUnsubscribe&&(Hd.mutationTrackerUnsubscribe(),Hd.mutationTrackerUnsubscribe=null);null!=Hd.mutationTrackerTicker&&(window.clearInterval(Hd.mutationTrackerTicker),Hd.mutationTrackerTicker=null);Hd.trackerAbilityHistoryUnsubscribe&&(Hd.trackerAbilityHistoryUnsubscribe(),Hd.trackerAbilityHistoryUnsubscribe=null);null!=Hd.trackerAbilityTicker&&(window.clearInterval(Hd.trackerAbilityTicker),Hd.trackerAbilityTicker=null)}();const y=lp(g),x=cp();Mu(),Fu();const w=new Map,v=new Map;let C=null;const T=e=>{if(C!==e){C=e;for(const[t,n]of w)n.classList.toggle("qpm-tab--active",t===e);for(const[t,n]of v){const o=t===e;if(n.classList.toggle("qpm-nav__button--active",o),n.dataset.tabColor){const e=n.dataset.tabColor,t=n.dataset.windowId,r=t&&sl(t);o||r?(n.style.background=e,n.style.boxShadow=`0 6px 18px ${e}`):(n.style.background=e.replace("0.28","0.14"),n.style.boxShadow="")}}}},S=(e,t,n,o)=>{const r=document.createElement("button");r.type="button",r.className="qpm-nav__button",r.innerHTML=`${n}<span>${t}</span>`,o.length>0&&r.addEventListener("click",()=>T(e));const i={dashboard:"rgba(76, 175, 80, 0.28)",turtle:"rgba(33, 150, 243, 0.28)",trackers:"rgba(156, 39, 176, 0.28)","xp-tracker":"rgba(255, 152, 0, 0.28)","shop-restock":"rgba(0, 188, 212, 0.28)","pet-hub":"rgba(103, 58, 183, 0.28)","public-rooms":"rgba(233, 30, 99, 0.28)","crop-boost":"rgba(139, 195, 74, 0.28)",achievements:"rgba(255, 215, 64, 0.28)","auto-favorite":"rgba(255, 235, 59, 0.28)","journal-checker":"rgba(121, 85, 72, 0.28)",guide:"rgba(96, 125, 139, 0.28)"};i[e]&&(r.dataset.tabColor=i[e],r.style.background=i[e].replace("0.28","0.14")),c.appendChild(r),v.set(e,r);const a=document.createElement("div");a.className="qpm-tab";for(const s of o)a.appendChild(s);d.appendChild(a),w.set(e,a)},P=await Iu(),A=Xa(),k=function(){const{root:e,body:t}=Eu("üìñ Magic Garden Guide",{subtitle:"Reference guide for game mechanics"});e.dataset.qpmSection="guide";const n=document.createElement("div");n.style.cssText="\n    width: 100%;\n    text-align: center;\n    padding: 12px;\n    background: var(--qpm-surface-1, #1a1a1a);\n    border-radius: 8px;\n    position: relative;\n  ";const o=document.createElement("div");o.textContent="(Click to open full size!)",o.style.cssText="\n    position: absolute;\n    top: 20px;\n    right: 20px;\n    color: rgba(150, 150, 150, 0.7);\n    font-size: 12px;\n    font-style: italic;\n    background: rgba(0, 0, 0, 0.5);\n    padding: 4px 8px;\n    border-radius: 4px;\n    pointer-events: none;\n    z-index: 10;\n  ";const r=document.createElement("img");return r.src="https://raw.githubusercontent.com/ryandt2305-cpu/QPM-GR/master/MGGuide.jpeg",r.alt="Magic Garden Guide",r.style.cssText="\n    width: 100%;\n    max-width: 100%;\n    height: auto;\n    border-radius: 8px;\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);\n    cursor: pointer;\n    transition: transform 0.2s;\n    display: block;\n  ",r.addEventListener("mouseenter",()=>{r.style.transform="scale(1.02)"}),r.addEventListener("mouseleave",()=>{r.style.transform="scale(1)"}),r.addEventListener("click",()=>{window.open(r.src,"_blank")}),r.onerror=()=>{n.innerHTML='\n      <div style="padding: 40px; color: var(--qpm-text-muted, #999); font-style: italic;">\n        üìñ Guide image not found. Please ensure MGGuide.jpeg is uploaded to the master branch of the repository.\n      </div>\n    '},n.appendChild(o),n.appendChild(r),t.appendChild(n),e}();S("dashboard","Dashboard","üìä",[b]),S("turtle","Turtle Timer","üê¢",[]),S("trackers","Trackers","üìà",[]),S("xp-tracker","XP Tracker","‚ú®",[]),S("shop-restock","Shop Restock","üè™",[]),S("pet-hub","Pet Hub","üêæ",[]),S("public-rooms","Public Rooms","üåê",[]),S("crop-boost","Crop Boosts","üå±",[]),S("achievements","Achievements","üèÜ",[]),S("auto-favorite","Auto-Favorite","‚≠ê",[P]),S("journal-checker","Journal","üìî",[A]),S("guide","Guide","üìñ",[k]),S("weather","Reminders","üîî",[x]),S("locker","Locker","üîí",[y]);const E=v.get("trackers");if(E){const e=E.cloneNode(!0);e.dataset.windowId="trackers-detail",e.addEventListener("click",()=>{tl("trackers-detail","üìä Ability & Mutation Trackers",op)}),E.replaceWith(e),v.set("trackers",e)}const $=v.get("xp-tracker");if($){const e=$.cloneNode(!0);e.addEventListener("click",async()=>{try{const{createXpTrackerWindow:e,showXpTrackerWindow:t,hideXpTrackerWindow:n,setGlobalXpTrackerState:o}=await Promise.resolve().then(()=>Bf);Hd.xpTrackerWindow||(Hd.xpTrackerWindow=e(),o(Hd.xpTrackerWindow));"none"!==Hd.xpTrackerWindow.root.style.display?n(Hd.xpTrackerWindow):t(Hd.xpTrackerWindow)}catch(e){s("‚ö†Ô∏è Failed to toggle XP Tracker window",e)}}),$.replaceWith(e),v.set("xp-tracker",e)}const M=v.get("shop-restock");if(M){const e=M.cloneNode(!0);e.addEventListener("click",async()=>{try{const{createShopRestockWindow:e,showShopRestockWindow:t,hideShopRestockWindow:n}=await Promise.resolve().then(()=>Yf);Hd.shopRestockWindow||(Hd.shopRestockWindow=e());"none"!==Hd.shopRestockWindow.root.style.display?n(Hd.shopRestockWindow):t(Hd.shopRestockWindow)}catch(e){s("‚ö†Ô∏è Failed to toggle Shop Restock window",e)}}),M.replaceWith(e),v.set("shop-restock",e)}const F=v.get("public-rooms");if(F){const e=F.cloneNode(!0);e.dataset.windowId="public-rooms",e.addEventListener("click",()=>{tl("public-rooms","üåê Public Rooms",e=>{Promise.resolve().then(()=>ig).then(({renderPublicRoomsWindow:t})=>{t(e)}).catch(e=>{s("‚ö†Ô∏è Failed to load Public Rooms window",e)})},"950px","85vh")}),F.replaceWith(e),v.set("public-rooms",e)}const I=v.get("crop-boost");if(I){const e=I.cloneNode(!0);e.addEventListener("click",async()=>{try{const{openCropBoostTrackerWindow:e}=await Promise.resolve().then(()=>pg);e()}catch(e){s("‚ö†Ô∏è Failed to open Crop Boost Tracker window",e)}}),I.replaceWith(e),v.set("crop-boost",e)}const L=v.get("achievements");if(L){const e=L.cloneNode(!0);e.dataset.windowId="achievements",e.addEventListener("click",()=>{tl("achievements","üèÜ Achievements",async e=>{const{createAchievementsWindow:t}=await Promise.resolve().then(()=>Og),n=t();n.root.dataset.achievementsRoot="true",e.appendChild(n.root)},void 0,"90vh")}),L.replaceWith(e),v.set("achievements",e)}const z=v.get("turtle");if(z){const e=z.cloneNode(!0);e.dataset.windowId="turtle-timer",e.addEventListener("click",()=>{tl("turtle-timer","üê¢ Bella's Turtle Temple",ip)}),z.replaceWith(e),v.set("turtle",e)}const N=v.get("weather");if(N){const e=N.cloneNode(!0);e.addEventListener("click",()=>{tl("reminders","üîî Reminders",ap,"650px","85vh")}),N.replaceWith(e),v.set("weather",e)}const q=v.get("locker");if(q){const e=q.cloneNode(!0);e.addEventListener("click",()=>{tl("locker","üîí Locker",sp,"650px","85vh")}),q.replaceWith(e),v.set("locker",e)}const B=v.get("pet-hub");if(B){const e=B.cloneNode(!0);e.dataset.windowId="pet-hub",e.addEventListener("click",()=>{tl("pet-hub","üêæ Pet Hub",e=>{Promise.resolve().then(()=>ab).then(({renderPetHubWindow:t})=>{t(e)}).catch(e=>{s("‚ö†Ô∏è Failed to load Pet Hub window",e)})},"1600px","92vh")}),B.replaceWith(e),v.set("pet-hub",e)}T("dashboard");const R=(t,n)=>{e.style.left=`${t}px`,e.style.top=`${n}px`,e.style.right="auto",e.style.bottom="auto"},D=f.get(_d,null);D&&Number.isFinite(D.left)&&Number.isFinite(D.top)&&R(D.left,D.top);const H=t=>{a.style.display=t?"none":"",i.textContent=t?"‚ñ≤":"‚ñº",r.setAttribute("aria-expanded",String(!t)),e.style.overflowY=t?"visible":"auto",f.set(Ud,t)};r.addEventListener("pointerdown",e=>{e.stopPropagation()}),r.addEventListener("click",e=>{e.stopPropagation();const t="none"===a.style.display;H(!t)}),H(!!f.get(Ud,!1));let j=!1,W=!1,G=null,O=0,V=0,_=!1;const U=(e,t,n)=>Math.min(Math.max(e,t),n),X=t=>{if(!j||G!==t.pointerId)return;const n=e.offsetWidth,o=e.offsetHeight,r=Math.max(8,window.innerWidth-n-8),i=Math.max(8,window.innerHeight-o-8),a=U(t.clientX-O,8,r),s=U(t.clientY-V,8,i),l=e.getBoundingClientRect();!W&&(Math.abs(a-l.left)>2||Math.abs(s-l.top)>2)&&(W=!0),R(a,s)},K=n=>{if(j&&G===n.pointerId){if(j=!1,window.removeEventListener("pointermove",X),window.removeEventListener("pointerup",K),window.removeEventListener("pointercancel",K),e.hasPointerCapture&&e.hasPointerCapture(n.pointerId))e.releasePointerCapture(n.pointerId);else try{e.releasePointerCapture(n.pointerId)}catch{}if(t.style.touchAction="",W){_=!0;const t=e.getBoundingClientRect();f.set(_d,{left:Math.round(t.left),top:Math.round(t.top)})}G=null,W=!1}};return t.addEventListener("pointerdown",n=>{const o=n.target;if(o&&o.closest("[data-qpm-collapse-button]"))return;if(!n.isPrimary)return;if("mouse"===n.pointerType){if(0!==n.button)return;if(1&~n.buttons)return}window.addEventListener("pointermove",X),window.addEventListener("pointerup",K),window.addEventListener("pointercancel",K),j=!0,W=!1,_=!1,G=n.pointerId;const r=e.getBoundingClientRect();O=n.clientX-r.left,V=n.clientY-r.top,e.setPointerCapture&&e.setPointerCapture(n.pointerId),t.style.touchAction="none",n.preventDefault()}),t.addEventListener("click",()=>{if(_)return void(_=!1);const e="none"===a.style.display;H(!e)}),window.addEventListener("resize",()=>{const t=e.getBoundingClientRect(),n=e.offsetWidth,o=e.offsetHeight,r=Math.max(8,window.innerWidth-n-8),i=Math.max(8,window.innerHeight-o-8),a=U(t.left,8,r),s=U(t.top,8,i);(Math.abs(a-t.left)>1||Math.abs(s-t.top)>1)&&(R(a,s),f.set(_d,{left:Math.round(a),top:Math.round(s)}))}),document.body.appendChild(e),Hd.panel=e,Hd.content=a,e}function zu(e){Qd.has(e)?Qd.delete(e):Qd.add(e),0===Qd.size?_u(Zd,!0):_u(Zd,!1);for(const[t,n]of eu)_u(n,Qd.has(t));Hu(Yd)}function Nu(){Qd.clear(),_u(Zd,!0);for(const e of eu.values())_u(e,!1);Du()}function qu(e){ou=e;try{f.set(Xd,e)}catch(t){console.warn("[qpm] failed to persist notification collapse state",t)}Du()}function Bu(){const e=Hd.notificationsDetailToggle;e&&(e.textContent=ru?"Hide extra info":"Show extra info",e.classList.toggle("qpm-button--positive",ru))}function Ru(e){const t=Hd.notificationsDetailMeta,n=Hd.notificationsDetailActions,o=Hd.notificationsDetailRaw;if(t&&n&&o)return e?void(ru?(t.style.display="flex",n.style.display=n.childElementCount>0?"flex":"none",o.style.display="block"):(t.style.display="none",n.style.display="none",o.style.display="none")):(t.style.display="none",n.style.display="none",void(o.style.display="none"))}function Du(){const e=Hd.notificationsFilterBar,t=Hd.notificationsListWrapper,n=Hd.notificationsEmpty,o=Hd.notificationsDetail,r=Hd.notificationsDetailToggle,i=Hd.notificationsSection;i&&(i.dataset.collapsed=ou?"true":"false");const a=iu>0;e&&(e.style.display=ou?"none":"flex"),t&&(t.style.display=ou?"none":a?"block":"none"),n&&(n.style.display=ou||a?"none":"block"),o&&(o.style.display=ou?"none":ru?"flex":"none"),r&&(r.style.display=ou?"none":"inline-flex",r.disabled=!nu,r.style.opacity=r.disabled?"0.6":"1")}function Hu(e){Yd=e;const t=Hd.notificationsList,n=Hd.notificationsEmpty;if(!t||!n)return;const o=Qd.size>0?e.filter(e=>Qd.has(e.feature)):e;nu&&!o.some(e=>e.id===nu)&&(nu=null);const r=o.slice().reverse();if(iu=r.length,r.length>0&&!nu&&(nu=r[0]?.id??null),t.textContent="",tu.clear(),0===r.length)return t.style.display="none",n.style.display="block",Gu(null),void Du();t.style.display="flex",n.style.display="none";for(const i of r){const e=ju(i);tu.set(i.id,e),t.appendChild(e)}Wu();Gu(r.find(e=>e.id===nu)??null),Du()}function ju(e){const t=Od[e.level]||Od.info,n=Vd[e.level]||Vd.info,o=document.createElement("button");o.type="button",o.dataset.notificationId=e.id,o.dataset.accent=t,o.setAttribute("aria-pressed","false"),o.style.cssText=`\n    text-align: left;\n    background: linear-gradient(135deg, rgba(255,255,255,0.04), rgba(255,255,255,0.01));\n    border: 1px solid rgba(255,255,255,0.1);\n    border-left: 4px solid ${t};\n    border-radius: 8px;\n    padding: 12px 14px;\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    color: #f8f8f8;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    backdrop-filter: blur(8px);\n  `,o.addEventListener("click",()=>function(e){nu=e.id,Wu(),Gu(e)}(e)),o.addEventListener("mouseenter",()=>{o.dataset.notificationId!==nu&&(o.style.background="linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03))",o.style.borderColor="rgba(255,255,255,0.16)",o.style.transform="translateX(2px)")}),o.addEventListener("mouseleave",()=>{o.dataset.notificationId!==nu&&(o.style.background="linear-gradient(135deg, rgba(255,255,255,0.04), rgba(255,255,255,0.01))",o.style.borderColor="rgba(255,255,255,0.1)",o.style.transform="none")});const r=document.createElement("div");r.style.cssText="display:flex;justify-content:space-between;align-items:center;gap:10px;";const i=document.createElement("div");i.style.cssText="display:flex;align-items:center;gap:8px;flex-wrap:wrap;flex:1;";const a=document.createElement("span");a.textContent=n,a.style.cssText=`\n    font-size: 16px;\n    line-height: 1;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    background: ${t}14;\n    border-radius: 6px;\n    flex-shrink: 0;\n  `,i.appendChild(a);const s=document.createElement("span");if(s.textContent=Uu(e.feature),s.style.cssText="\n    background: rgba(143,130,255,0.12);\n    padding: 3px 8px;\n    border-radius: 6px;\n    font-size: 11px;\n    color: #c7b8ff;\n    font-weight: 600;\n    letter-spacing: 0.3px;\n  ",i.appendChild(s),"warn"===e.level||"error"===e.level){const n=document.createElement("span");n.textContent=e.level.toUpperCase(),n.style.cssText=`\n      padding: 3px 8px;\n      border-radius: 6px;\n      background: ${t}20;\n      color: ${t};\n      font-size: 10px;\n      font-weight: 700;\n      letter-spacing: 0.5px;\n    `,i.appendChild(n)}const c=document.createElement("span");c.textContent=l(e.timestamp),c.title=new Date(e.timestamp).toLocaleString(),c.style.cssText="\n    font-size: 11px;\n    color: rgba(255,255,255,0.4);\n    white-space: nowrap;\n    flex-shrink: 0;\n    font-weight: 500;\n  ",r.append(i,c),o.appendChild(r);const d=e.message.length>160?`${e.message.slice(0,160)}‚Ä¶`:e.message,u=document.createElement("div");if(u.textContent=d,u.style.cssText="\n    font-size: 12px;\n    color: rgba(255,255,255,0.85);\n    line-height: 1.6;\n    margin-left: 36px;\n  ",o.appendChild(u),Array.isArray(e.actions)&&e.actions.length>0){const t=document.createElement("div");t.textContent=`‚ö° ${e.actions.length} quick action${e.actions.length>1?"s":""} available`,t.style.cssText="\n      font-size: 11px;\n      color: #90caf9;\n      margin-left: 36px;\n      font-weight: 500;\n    ",o.appendChild(t)}return o}function Wu(){for(const[e,t]of tu){const n=t.dataset.accent??Od.info;e===nu?(t.style.background=`linear-gradient(135deg, ${n}14, ${n}08)`,t.style.borderColor=`${n}`,t.style.borderLeftWidth="4px",t.style.boxShadow=`0 4px 12px ${n}30, inset 0 0 0 1px ${n}20`,t.style.transform="translateX(4px)",t.setAttribute("aria-pressed","true")):(t.style.background="linear-gradient(135deg, rgba(255,255,255,0.04), rgba(255,255,255,0.01))",t.style.borderColor="rgba(255,255,255,0.1)",t.style.borderLeftWidth="4px",t.style.boxShadow="none",t.style.transform="none",t.setAttribute("aria-pressed","false"))}}function Gu(e){const t=Hd.notificationsDetailPlaceholder,n=Hd.notificationsDetailHeader,o=Hd.notificationsDetailTitle,r=Hd.notificationsDetailTimestamp,i=Hd.notificationsDetailMeta,a=Hd.notificationsDetailMessage,s=Hd.notificationsDetailActions,c=Hd.notificationsDetailRaw;if(!(t&&n&&o&&r&&i&&a&&s&&c))return;if(!e)return t.style.display="block",n.style.display="none",a.style.display="none",i.style.display="none",s.style.display="none",c.style.display="none",c.textContent="",Bu(),void Du();t.style.display="none",n.style.display="flex",a.style.display="block";const d=new Date(e.timestamp);if(o.textContent=`${Uu(e.feature)} ‚Äî ${e.level.toUpperCase()}`,o.title=e.message,r.textContent=`${l(e.timestamp)} ‚Ä¢ ${d.toLocaleString()}`,i.textContent="",i.appendChild(Ou("ID",e.id)),i.appendChild(Ou("Feature",Uu(e.feature))),i.appendChild(Ou("Level",e.level.toUpperCase())),a.textContent=e.message,s.textContent="",Array.isArray(e.actions)&&e.actions.length>0)for(const l of e.actions){const e=document.createElement("button");e.type="button",e.textContent=l.label,e.className="qpm-button",e.style.fontSize="10px",e.addEventListener("click",()=>{try{l.onClick()}catch(e){console.error("[qpm] notification action error",e)}}),s.appendChild(e)}const u=Array.isArray(e.actions)?e.actions.map(({label:e})=>({label:e})):void 0,p={...e,actions:u};c.textContent=JSON.stringify(p,null,2),c.scrollTop=0,Ru(e),Bu(),Du()}function Ou(e,t){const n=document.createElement("span");n.style.cssText="padding:2px 6px;border-radius:4px;background:rgba(255,255,255,0.08);color:#d7e3ff;display:inline-flex;gap:4px;align-items:center;";const o=document.createElement("span");o.textContent=`${e}:`,o.style.cssText="font-weight:600;color:#ffffff;",n.appendChild(o);const r=document.createElement("span");return r.textContent=t,n.appendChild(r),n}function Vu(e,t){const n=document.createElement("button");return n.type="button",n.textContent=e,n.className="qpm-button",n.style.fontSize="10px",n.addEventListener("click",t),n}function _u(e,t){e&&(e.dataset.active=t?"true":"false",t?e.classList.add("qpm-button--positive"):e.classList.remove("qpm-button--positive"))}function Uu(e){return e?e.split(/[^a-zA-Z0-9]+/g).filter(Boolean).map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):"General"}function Xu(e){return e?e.split(/[_\s]+/).filter(Boolean).map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):"Unknown"}function Ku(e){const t=Math.max(0,Math.floor(e)),n=Math.floor(t/1e3),o=Math.floor(n/3600),r=Math.floor(n%3600/60),i=n%60;return o>0?`${o}h ${r}m`:r>0?`${r}m ${i.toString().padStart(2,"0")}s`:`${i}s`}function Ju(){ds(),jd=0,Wd=0,function(){if(!Hd.headerAutoFeed||!Hd.headerWeather||!Hd.headerShop)return;let e=!!$u.enabled,t=jd;const n=[];n.push(e?"On":"Off"),n.push(`${t} feeds`),Hd.headerAutoFeed.textContent=n.join(" ‚Ä¢ ");let o="Unknown",r="never",i="‚Äî";const a=[];try{const e=at();o=Xu(e.kind);const t={lastSwapAt:null,currentPreset:null,nextWeatherPreset:"unknown",nextSunnyPreset:"unknown",cooldownRemainingMs:0};if(t.lastSwapAt,t.currentPreset);else{i=`Next ${s="weather"===e.raw?t.nextWeatherPreset:t.nextSunnyPreset,s?s.charAt(0).toUpperCase()+s.slice(1):"‚Äî"}`}t.cooldownRemainingMs>0&&Math.ceil(t.cooldownRemainingMs/1e3),a.push(o,r,i)}catch{a.push(o,r,i)}var s;0===a.length&&a.push(o,r,i),Hd.headerWeather.textContent=a.join(" ‚Ä¢ ");let l=Wd,c=0;try{const e={totalPurchasedCount:0,totalSpent:0};"number"==typeof e.totalPurchasedCount&&(l=e.totalPurchasedCount),"number"==typeof e.totalSpent&&(c=e.totalSpent)}catch{}const d=[`${l} items`,`ü™ô ${so(Math.max(0,Math.round(c)))}`];if(Hd.headerShop.textContent=d.join(" ‚Ä¢ "),Hd.headerMeta){const e=[];Hd.headerMeta.textContent=e.join(" ‚Ä¢ ")}}(),dp("Stats reset")}function Qu(){const{root:e,body:t}=Eu("üê¢ Bella's Turtle Temple",{subtitle:"Growth, eggs, and support breakdown"});e.dataset.qpmSection="turtle-timer";const n=Tu(),o=document.createElement("div");o.style.cssText="display:flex;flex-wrap:wrap;gap:10px;align-items:center;";const r=document.createElement("button");r.type="button",r.className="qpm-chip",r.style.cssText="cursor:pointer;user-select:none;min-width:84px;text-align:center;",r.addEventListener("click",()=>{const e=!($u.turtleTimer?.enabled??1);$u.turtleTimer={...Tu(),enabled:e},pp(),fi(e)}),o.appendChild(r),Hd.turtleEnableButtons.push(r);const i=document.createElement("label");i.style.cssText="display:inline-flex;align-items:center;gap:6px;font-size:11px;color:#b2dfdb;";const a=document.createElement("select");a.className="qpm-select",a.style.cssText="min-width:120px;padding:4px 8px;font-size:11px;",a.addEventListener("click",e=>e.stopPropagation());const s=document.createElement("option");s.value="latest",s.textContent="Latest finish";const l=document.createElement("option");l.value="earliest",l.textContent="Earliest finish";const c=document.createElement("option");c.value="specific",c.textContent="Specific plant",a.append(s,l,c),a.value=n.focus;const d=document.createElement("label");d.style.cssText="display:inline-flex;align-items:center;gap:6px;font-size:11px;color:#b2dfdb;",d.style.display="specific"===n.focus?"inline-flex":"none";const u=document.createElement("select");u.className="qpm-select",u.style.cssText="min-width:180px;padding:4px 8px;font-size:11px;",u.addEventListener("click",e=>e.stopPropagation()),a.addEventListener("change",()=>{const e=a.value,t="earliest"===e?"earliest":"specific"===e?"specific":"latest",n={...Tu(),focus:t};$u.turtleTimer=n,pp();const o={focus:t};"specific"===t&&(o.focusTargetTileId=n.focusTargetTileId,o.focusTargetSlotIndex=n.focusTargetSlotIndex),mi(o),d.style.display="specific"===t?"inline-flex":"none"});const p=document.createElement("span");p.textContent="Focus",i.append(p,a),o.appendChild(i),Hd.turtleFocusSelects.push(a);const m=document.createElement("span");m.textContent="Target plant",d.append(m,u),o.appendChild(d),Hd.turtleFocusTargetContainers.push(d),Hd.turtleFocusTargetSelects.push(u),u.addEventListener("change",()=>{const{tileId:e,slotIndex:t}=su(u.value),n={...Tu(),focus:"specific",focusTargetTileId:e,focusTargetSlotIndex:t};$u.turtleTimer=n,pp(),mi({focus:"specific",focusTargetTileId:e,focusTargetSlotIndex:t})});const f=document.createElement("label");f.style.cssText="display:inline-flex;align-items:center;gap:6px;font-size:11px;color:#bda7f5;";const g=document.createElement("select");g.className="qpm-select",g.style.cssText="min-width:120px;padding:4px 8px;font-size:11px;",g.addEventListener("click",e=>e.stopPropagation());const h=document.createElement("option");h.value="latest",h.textContent="Latest hatch";const b=document.createElement("option");b.value="earliest",b.textContent="Earliest hatch";const y=document.createElement("option");y.value="specific",y.textContent="Specific egg",g.append(h,b,y),g.value=n.eggFocus;const x=document.createElement("label");x.style.cssText="display:inline-flex;align-items:center;gap:6px;font-size:11px;color:#bda7f5;",x.style.display="specific"===n.eggFocus?"inline-flex":"none";const w=document.createElement("select");w.className="qpm-select",w.style.cssText="min-width:180px;padding:4px 8px;font-size:11px;",w.addEventListener("click",e=>e.stopPropagation()),g.addEventListener("change",()=>{const e=g.value,t="earliest"===e?"earliest":"specific"===e?"specific":"latest",n={...Tu(),eggFocus:t};$u.turtleTimer=n,pp();const o={eggFocus:t};"specific"===t&&(o.eggFocusTargetTileId=n.eggFocusTargetTileId,o.eggFocusTargetSlotIndex=n.eggFocusTargetSlotIndex),mi(o),x.style.display="specific"===t?"inline-flex":"none"});const v=document.createElement("span");v.textContent="Egg focus",f.append(v,g),o.appendChild(f),Hd.turtleEggFocusSelects.push(g);const C=document.createElement("span");C.textContent="Target egg",x.append(C,w),o.appendChild(x),Hd.turtleEggFocusTargetContainers.push(x),Hd.turtleEggFocusTargetSelects.push(w),w.addEventListener("change",()=>{const{tileId:e,slotIndex:t}=su(w.value),n={...Tu(),eggFocus:"specific",eggFocusTargetTileId:e,eggFocusTargetSlotIndex:t};$u.turtleTimer=n,pp(),mi({eggFocus:"specific",eggFocusTargetTileId:e,eggFocusTargetSlotIndex:t})}),t.appendChild(o);const T=document.createElement("div");T.style.cssText="font-size:10px;color:#9acccc;line-height:1.4;",T.textContent="Change your target plant's with Focus to display the estimated time to mature. The Egg Hatching section displays info on egg maturing. The Food Turtles section displays food drain and restore info.",t.appendChild(T);const S=(e,t,n)=>{const o=document.createElement("div");o.style.cssText=`padding:14px;border-radius:12px;border:2px solid ${t};background:linear-gradient(135deg, rgba(10,20,20,0.6), rgba(10,20,20,0.3));display:flex;flex-direction:column;gap:10px;box-shadow: 0 4px 12px rgba(0,0,0,0.3);`;const r=document.createElement("div");r.style.cssText="display:flex;justify-content:space-between;align-items:center;gap:12px;";const i=document.createElement("div");i.style.cssText="display:flex;align-items:center;gap:10px;";const a=document.createElement("span");a.style.cssText="font-size:24px;",a.textContent=n;const s=document.createElement("div");s.style.cssText="font-weight:700;font-size:14px;color:#e0f7fa;letter-spacing:0.3px;",s.textContent=e,i.append(a,s);const l=document.createElement("div");l.style.cssText="font-size:14px;font-weight:700;color:#4CAF50;background:rgba(76,175,80,0.15);padding:6px 12px;border-radius:8px;border:1px solid rgba(76,175,80,0.3);",r.append(i,l),o.appendChild(r);const c=document.createElement("div");c.style.cssText="display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:8px;";const d=document.createElement("div");d.style.cssText="display:flex;flex-direction:column;gap:4px;padding:8px;background:rgba(255,255,255,0.05);border-radius:6px;",c.appendChild(d);const u=document.createElement("div");u.style.cssText="display:flex;flex-direction:column;gap:4px;padding:8px;background:rgba(255,255,255,0.05);border-radius:6px;",c.appendChild(u),o.appendChild(c);const p=document.createElement("div");p.style.cssText="font-size:12px;color:#b2dfdb;line-height:1.6;padding:8px;background:rgba(178,223,219,0.1);border-radius:6px;border-left:3px solid #4CAF50;display:flex;align-items:center;gap:8px;",o.appendChild(p);const m=document.createElement("div");m.style.cssText="font-size:11px;color:#80CBC4;padding:6px 10px;background:rgba(128,203,196,0.08);border-radius:6px;display:flex;align-items:center;gap:6px;",o.appendChild(m);const f=document.createElement("div");f.style.cssText="display:grid;grid-template-columns:1.4fr 0.7fr 0.6fr 0.8fr;gap:8px;font-size:11px;color:#4CAF50;text-transform:uppercase;letter-spacing:0.6px;font-weight:700;padding:6px 8px;background:rgba(76,175,80,0.1);border-radius:6px;",f.innerHTML="<span>üêæ Pet</span><span>üçñ Hunger</span><span>‚ö° Boost</span><span>‚ú® XP</span>",o.appendChild(f);const g=document.createElement("div");return g.style.cssText="display:flex;flex-direction:column;gap:3px;min-height:18px;max-height:200px;overflow-y:auto;",o.appendChild(g),{card:o,etaEl:l,summaryEl:d,totalsEl:u,simpleEl:p,luckEl:m,tableBody:g}},P=S("Plant Growth","rgba(76,175,80,0.6)","üå±");t.appendChild(P.card),Hd.turtlePlantEta=P.etaEl,Hd.turtlePlantSummary=P.summaryEl,Hd.turtlePlantTotals=P.totalsEl,Hd.turtlePlantSimple=P.simpleEl,Hd.turtlePlantLuck=P.luckEl,Hd.turtlePlantTable=P.tableBody;const A=S("Egg Hatching","rgba(156,39,176,0.6)","ü•ö");t.appendChild(A.card),Hd.turtleEggEta=A.etaEl,Hd.turtleEggSummary=A.summaryEl,Hd.turtleEggTotals=A.totalsEl,Hd.turtleEggSimple=A.simpleEl,Hd.turtleEggLuck=A.luckEl,Hd.turtleEggTable=A.tableBody;const k=document.createElement("div");k.style.cssText="padding:14px;border-radius:12px;border:2px solid rgba(255,152,0,0.6);background:linear-gradient(135deg, rgba(30,24,12,0.6), rgba(30,24,12,0.3));display:flex;flex-direction:column;gap:10px;box-shadow: 0 4px 12px rgba(0,0,0,0.3);";const E=document.createElement("div");E.style.cssText="display:flex;align-items:center;gap:10px;";const $=document.createElement("span");$.style.cssText="font-size:24px;",$.textContent="üçΩÔ∏è";const M=document.createElement("div");M.style.cssText="font-weight:700;font-size:14px;color:#FFB74D;letter-spacing:0.3px;",M.textContent="Food Turtles",E.append($,M),k.appendChild(E);const F=document.createElement("div");F.style.cssText="display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:8px;";const I=document.createElement("div");I.style.cssText="padding:8px;background:rgba(255,255,255,0.05);border-radius:6px;font-size:11px;color:#FFE082;",F.appendChild(I);const L=document.createElement("div");L.style.cssText="padding:8px;background:rgba(255,255,255,0.05);border-radius:6px;font-size:11px;color:#FFE082;",F.appendChild(L),k.appendChild(F);const z=document.createElement("div");z.style.cssText="font-size:12px;color:#FFECB3;line-height:1.6;padding:8px;background:rgba(255,236,179,0.1);border-radius:6px;border-left:3px solid #FFB74D;",k.appendChild(z);const N=document.createElement("div");N.style.cssText="display:flex;flex-direction:column;gap:4px;max-height:180px;overflow-y:auto;",k.appendChild(N),t.appendChild(k),Hd.turtleSupportSummary=I,Hd.turtleSupportTotals=L,Hd.turtleSupportSimple=z,Hd.turtleSupportList=N;const q=document.createElement("div");q.style.cssText="padding:12px;border-radius:10px;border:1px solid rgba(100,181,246,0.45);background:linear-gradient(135deg, rgba(100,181,246,0.08), rgba(100,181,246,0.03));display:flex;flex-direction:column;gap:10px;";const B=document.createElement("div");B.style.cssText="font-weight:700;font-size:13px;color:#64b5f6;letter-spacing:0.3px;",B.textContent="‚è∞ Specified ETA Helper",q.appendChild(B);const R=document.createElement("div");R.style.cssText="font-size:10px;color:#90caf9;line-height:1.5;",R.textContent="Calculate how many watering cans you need to finish a plant by a specific time.",q.appendChild(R);const D=document.createElement("div");D.style.cssText="font-size:10px;color:#ffb74d;line-height:1.5;padding:6px;background:rgba(255,152,0,0.1);border-radius:4px;border-left:3px solid #ffb74d;margin-top:6px;",D.textContent="‚ö†Ô∏è Switch to your Plant Growth Turtles before you calculate!",D.title="Calculation uses your CURRENT turtle setup. Make sure you have Plant Growth boost turtles active if you want accurate watering can counts.",q.appendChild(D);const H=document.createElement("div");H.style.cssText="display:flex;flex-wrap:wrap;gap:10px;align-items:flex-end;",q.appendChild(H);const j=document.createElement("div");j.style.cssText="display:flex;flex-direction:column;gap:4px;";const W=document.createElement("label");W.style.cssText="font-size:10px;color:#b3e5fc;font-weight:600;",W.textContent="Target Date (DD/MM)";const G=document.createElement("input");G.type="text",G.className="qpm-input",G.placeholder="DD/MM",G.style.cssText="padding:6px 10px;font-size:11px;min-width:80px;max-width:80px;",G.addEventListener("keydown",e=>e.stopPropagation()),G.addEventListener("input",e=>{let t=G.value.replace(/\D/g,"");t.length>=2&&(t=t.slice(0,2)+"/"+t.slice(2,4)),G.value=t}),j.append(W,G),H.appendChild(j);const O=document.createElement("div");O.style.cssText="display:flex;flex-direction:column;gap:4px;";const V=document.createElement("label");V.style.cssText="font-size:10px;color:#b3e5fc;font-weight:600;",V.textContent="Target Time";const _=document.createElement("input");_.type="time",_.className="qpm-input",_.style.cssText="padding:6px 10px;font-size:11px;min-width:120px;",_.addEventListener("keydown",e=>e.stopPropagation()),O.append(V,_),H.appendChild(O);const U=document.createElement("div");U.style.cssText="display:flex;flex-direction:column;gap:4px;flex:1;min-width:180px;";const X=document.createElement("label");X.style.cssText="font-size:10px;color:#b3e5fc;font-weight:600;",X.textContent="Select Plant";const K=document.createElement("select");K.className="qpm-select",K.style.cssText="padding:6px 10px;font-size:11px;",K.addEventListener("click",e=>e.stopPropagation());const J=document.createElement("option");J.value="",J.textContent="Choose a growing plant...",J.disabled=!0,J.selected=!0,K.appendChild(J),U.append(X,K),H.appendChild(U);const Q=document.createElement("button");Q.type="button",Q.className="qpm-button qpm-button--accent",Q.textContent="Calculate",Q.style.cssText="padding:6px 16px;font-size:11px;font-weight:600;align-self:flex-end;",H.appendChild(Q);const Y=document.createElement("div");Y.style.cssText="display:none;flex-direction:column;gap:6px;padding:10px;background:rgba(10,20,30,0.5);border-radius:8px;border:1px solid rgba(100,181,246,0.2);",q.appendChild(Y);const Z=()=>{const e=hi(),t=Date.now(),n=K.value;for(;K.options.length>1;)K.remove(1);let o=0;for(const r of e.plantTargets)if(r.endTime&&r.endTime>t){const e=document.createElement("option");e.value=r.key,e.textContent=`${r.species||"Unknown"} - ${lu(r.remainingMs||0)}`,e.dataset.endTime=String(r.endTime),e.dataset.species=r.species||"Unknown",K.appendChild(e),o++}if(0===o){const e=document.createElement("option");e.value="",e.textContent="No growing plants found",e.disabled=!0,K.appendChild(e)}if(n){Array.from(K.options).find(e=>e.value===n)&&(K.value=n)}};return Q.addEventListener("click",()=>{const e=K.selectedOptions[0];if(!e||!_.value||!G.value)return void(Y.style.display="none");const t=Number(e.dataset.endTime),n=e.dataset.species||"Unknown",o=Date.now(),r=G.value.split("/").map(Number),i=r[0],a=r[1];if(!i||!a||i<1||i>31||a<1||a>12)return Y.innerHTML='<div style="color:#ef5350;font-size:11px;">Invalid date! Use DD/MM format (e.g., 15/11)</div>',void(Y.style.display="flex");const s=_.value.split(":").map(Number),l=s[0]??0,c=s[1]??0,d=t-o,u=(new Date).getFullYear();let p=new Date(u,a-1,i,l,c,0,0);p.getTime()<o&&(p=new Date(u+1,a-1,i,l,c,0,0));const m=p.getTime(),f=Math.floor((m-o)/864e5),g=m-o;if(g<=0)return Y.innerHTML='<div style="color:#ef5350;font-size:11px;">Target time is in the past!</div>',void(Y.style.display="flex");const h=hi(),b=h.plant.effectiveRate||0,y=h.plant.adjustedMsRemaining,x=b>0&&y?y:d,w=b>0&&!!y&&y>0,v=Math.max(0,x-g),C=Math.ceil(v/3e5);Y.innerHTML="";const T=document.createElement("div");T.style.cssText="font-weight:700;font-size:11px;color:#64b5f6;margin-bottom:4px;",T.textContent=`Results for ${n}`,Y.appendChild(T);const S=document.createElement("div");S.style.cssText="font-size:10px;color:#e0e0e0;line-height:1.6;padding:6px;background:rgba(255,255,255,0.05);border-radius:4px;margin-bottom:4px;",S.innerHTML=w?`<strong style="color:#81c784;">üê¢ Current State (With Turtles):</strong> ${lu(x)} ‚Ä¢ ${Su(x)}`:`<strong style="color:#90caf9;">Current State (No Turtles):</strong> ${lu(x)} ‚Ä¢ ${Su(x)}`,Y.appendChild(S);const P=document.createElement("div");P.style.cssText="font-size:10px;color:#e0e0e0;line-height:1.6;";const A=0===f?"today":1===f?"tomorrow":`in ${f} days`,k=`${G.value} ${_.value}`;P.innerHTML=`<strong style="color:#ffb74d;">Target:</strong> ${k} (${A}) ‚Ä¢ ${lu(g)} from now`,Y.appendChild(P);const E=document.createElement("div");if(E.style.cssText="font-size:11px;color:#fff;font-weight:700;padding:8px;background:rgba(100,181,246,0.15);border-radius:6px;margin-top:4px;",0===C)E.innerHTML=`‚úÖ <span style="color:#81c784;">No watering cans needed!</span><br><span style="font-size:10px;font-weight:400;color:#b0b0b0;">Plant will finish ${lu(Math.abs(v))} before target time.</span>`;else{const e=w?"(based on current turtle boost)":"(no turtle boost applied)";E.innerHTML=`üíß <span style="color:#64b5f6;">Watering Cans Needed: ${C}</span><br><span style="font-size:10px;font-weight:400;color:#b0b0b0;">Each can saves 5 minutes ${e}</span>`}Y.appendChild(E),Y.style.display="flex"}),bi(()=>{Z()}),Z(),t.appendChild(q),Au(hi()),e}let Yu={groups:[],totals:{xpPerHour:0,plantMinutesPerHour:0,eggMinutesPerHour:0,coinsPerHour:0},unknown:[]},Zu=[];const ep={detailedView:!1,filterCoinOnly:!1,selectedAbilities:[]};let tp={...ep};function np(e,t,n,o){const r=document.createElement("div");r.style.cssText="display: flex; align-items: center; gap: 10px; padding: 8px; background: rgba(0, 0, 0, 0.2); border-radius: 4px;";const i=document.createElement("div");i.style.cssText="flex: 1; display: flex; flex-direction: column; gap: 2px;";const a=document.createElement("div");a.textContent=e,a.style.cssText="font-size: 12px; color: rgba(255, 255, 255, 0.9); font-weight: 500;",i.appendChild(a);const s=document.createElement("div");s.textContent=t,s.style.cssText="font-size: 11px; color: rgba(255, 255, 255, 0.6);",i.appendChild(s),r.appendChild(i);const l=document.createElement("button");l.style.cssText=`\n    width: 48px;\n    height: 24px;\n    border-radius: 12px;\n    border: none;\n    cursor: pointer;\n    position: relative;\n    transition: background 0.2s;\n    background: ${n?"var(--qpm-accent)":"rgba(255, 255, 255, 0.2)"};\n  `;const c=document.createElement("div");c.style.cssText=`\n    width: 18px;\n    height: 18px;\n    border-radius: 50%;\n    background: white;\n    position: absolute;\n    top: 3px;\n    left: ${n?"27px":"3px"};\n    transition: left 0.2s;\n  `,l.appendChild(c);let d=n;return l.addEventListener("click",()=>{d=!d,l.style.background=d?"var(--qpm-accent)":"rgba(255, 255, 255, 0.2)",c.style.left=d?"27px":"3px",o(d)}),r.appendChild(l),r}function op(e){const t=f.get("qpm-tracker-settings");t&&(tp={...ep,...t}),e.style.cssText="display: flex; flex-direction: column; gap: 12px; min-width: 900px; max-width: 1200px;";const n=document.createElement("div");n.style.cssText="\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 12px 16px;\n    background: var(--qpm-surface-2);\n    border-radius: 6px;\n    border: 1px solid var(--qpm-border);\n  ";const o=document.createElement("div");o.className="tracker-summary",o.style.cssText="font-size: 13px; color: var(--qpm-text); font-weight: 500;",o.textContent="Loading pet data...",n.appendChild(o);const r=document.createElement("div");r.className="tracker-settings-panel",r.style.cssText="display: none;";const i=document.createElement("button");i.className="qpm-button qpm-button--secondary",i.textContent="‚öôÔ∏è Filters",i.style.cssText="padding: 6px 12px; font-size: 12px;",i.title="Show filter options",i.addEventListener("click",()=>{const e="none"===r.style.display;r.style.display=e?"":"none",i.textContent=e?"‚öôÔ∏è Hide Filters":"‚öôÔ∏è Filters"}),n.appendChild(i),e.appendChild(n),r.style.cssText="\n    display: none;\n    padding: 16px;\n    background: var(--qpm-surface-2);\n    border-radius: 6px;\n    border: 1px solid var(--qpm-border);\n    margin-bottom: 12px;\n    gap: 16px;\n  ";const a=document.createElement("div");a.textContent="‚öôÔ∏è Display Options",a.style.cssText="font-weight: 600; color: var(--qpm-accent); margin-bottom: 12px; font-size: 13px;",r.appendChild(a);const l=document.createElement("div");l.style.cssText="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;";const c=np("üìä Detailed View","Show additional statistics and context",tp.detailedView,e=>{tp.detailedView=e,f.set("qpm-tracker-settings",tp),rp({summaryText:o,tbody:x,footer:w,abilityCheckboxGrid:m})});l.appendChild(c);const d=np("üí∞ Coin Abilities Only","Show only coin-generating abilities",tp.filterCoinOnly,e=>{tp.filterCoinOnly=e,f.set("qpm-tracker-settings",tp),rp({summaryText:o,tbody:x,footer:w,abilityCheckboxGrid:m})});l.appendChild(d);const u=document.createElement("div");u.className="ability-filter-container",u.style.cssText="grid-column: 1 / -1; display: flex; flex-direction: column; gap: 8px;";const p=document.createElement("div");p.textContent="‚ú® Filter by Ability",p.style.cssText="font-size: 12px; color: rgba(255, 255, 255, 0.9); font-weight: 500;",u.appendChild(p);const m=document.createElement("div");m.className="ability-checkbox-grid",m.style.cssText="\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));\n    gap: 6px;\n    max-height: 200px;\n    overflow-y: auto;\n    padding: 8px;\n    background: rgba(0, 0, 0, 0.2);\n    border-radius: 4px;\n  ",u.appendChild(m),l.appendChild(u),r.appendChild(l),e.appendChild(r);const g=document.createElement("div");g.style.cssText="\n    overflow-x: auto;\n    background: var(--qpm-surface-1);\n    border-radius: 6px;\n    border: 1px solid var(--qpm-border);\n    max-height: 60vh;\n    overflow-y: auto;\n  ";const h=document.createElement("table");h.className="tracker-detail-table",h.style.cssText="\n    width: 100%;\n    border-collapse: collapse;\n    font-size: 12px;\n  ";const b=h.createTHead();b.style.cssText="position: sticky; top: 0; z-index: 10; background: var(--qpm-surface-1);";const y=b.insertRow();y.style.cssText="\n    background: var(--qpm-surface-2);\n    border-bottom: 2px solid var(--qpm-border);\n  ";[{text:"üêæ Pet",tooltip:"Pet name or species"},{text:"‚ú® Ability",tooltip:"Pet ability name"},{text:"üé≤ Chance %",tooltip:"Calculated proc chance per minute (baseProbability √ó STR)"},{text:"‚ö° Procs/Hr",tooltip:"Expected procs per hour"},{text:"üí∞ Per Proc",tooltip:"Coins earned per successful proc"},{text:"üí∏ Per Hour",tooltip:"Total coins per hour from this ability"},{text:"‚è±Ô∏è Next ETA",tooltip:"Live countdown to next expected proc"}].forEach(({text:e,tooltip:t})=>{const n=document.createElement("th");n.textContent=e,n.title=t,n.style.cssText="\n      padding: 10px 12px;\n      text-align: left;\n      font-weight: 600;\n      color: var(--qpm-accent);\n      white-space: nowrap;\n      border-bottom: 1px solid var(--qpm-border);\n      cursor: help;\n    ",y.appendChild(n)});const x=h.createTBody();x.className="tracker-tbody",g.appendChild(h),e.appendChild(g);const w=document.createElement("div");w.className="tracker-footer",w.style.cssText="\n    padding: 12px 16px;\n    background: var(--qpm-surface-2);\n    border-radius: 6px;\n    border: 1px solid var(--qpm-border);\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--qpm-accent);\n  ",w.textContent="Total: Loading...",e.appendChild(w);const v={root:e,summaryText:o,tbody:x,footer:w,abilityCheckboxGrid:m,updateInterval:null};Cr(e=>{Zu=e,Yu=function(e){if(!e.length)return{groups:[],totals:{xpPerHour:0,plantMinutesPerHour:0,eggMinutesPerHour:0,coinsPerHour:0},unknown:[]};const t=Ws(),n=new Map,o=new Map,r=[];if(e.forEach((e,i)=>{const a=Array.isArray(e.abilities)?e.abilities:[];for(const s of a){if(!s)continue;const a=ks(s);if(!a){r.push({abilityName:s,pet:e});continue}if("continuous"!==a.trigger)continue;const l=Ms(a,e.strength),c=yu(e,a.id),d=c?vu(c,a):null,u="number"==typeof e.strength&&Number.isFinite(e.strength)?e.strength:null,p=`${a.id}::${null!=u?u.toFixed(2):"baseline"}`;let m=n.get(p);void 0===m&&(m=Vs(a.id,t,u),n.set(p,m??null));const f=d?.procsPerHour??null,g=null!=f&&f>0?f:l.procsPerHour,h=null!=f&&f>0?"observed":"estimated",b=d?.effectPerProc??null,y=m?.effectPerProc??null,x=a.effectValuePerProc??null;let w=null,v="definition",C=m?.detail??null;null!=b&&b>0?(w=b,v="observed",C=d?.sampleCount?`Observed average from ${d.sampleCount} recent sample${1===d.sampleCount?"":"s"}.`:"Observed from ability log."):null!=y&&y>0?(w=y,v="computed"):null!=x&&x>0&&(w=x,v="definition",C=a.notes??null);const T=null!=w&&g>0?g*w:Fs(a,l),S=d?.lastProcAt??c?.lastPerformedAt??null,P=d?.sampleCount??0,A={pet:e,petIndex:i,displayName:Cu(e),abilityName:s,definition:a,procsPerHour:g,procsPerHourSource:h,chancePerMinute:l.chancePerMinute,expectedMinutesBetween:g>0?60/g:null,lastProcAt:S,sampleCount:P,effectPerProc:w,effectSource:v,effectDetail:C,effectPerHour:T},k=a.id,E=o.get(k);E?(E.entries.push(A),E.totalProcsPerHour+=g,E.effectPerHour+=T,E.totalSamples+=P,(null==E.lastProcAt||null!=S&&S>E.lastProcAt)&&(E.lastProcAt=S)):o.set(k,{definition:a,entries:[A],totalProcsPerHour:g,chancePerMinute:g/60,combinedEtaMinutes:g>0?60/g:null,effectPerHour:T,totalSamples:P,lastProcAt:S,averageEffectPerProc:w})}}),0===o.size&&0===r.length)return{groups:[],totals:{xpPerHour:0,plantMinutesPerHour:0,eggMinutesPerHour:0,coinsPerHour:0},unknown:[]};const i={xpPerHour:0,plantMinutesPerHour:0,eggMinutesPerHour:0,coinsPerHour:0};return{groups:Array.from(o.values()).map(e=>{switch(e.chancePerMinute=e.entries.reduce((e,t)=>e+t.chancePerMinute,0),e.combinedEtaMinutes=e.totalProcsPerHour>0?60/e.totalProcsPerHour:null,e.averageEffectPerProc=e.totalProcsPerHour>0?e.effectPerHour/e.totalProcsPerHour:null,e.definition.category){case"xp":i.xpPerHour+=e.effectPerHour;break;case"plantGrowth":i.plantMinutesPerHour+=e.effectPerHour;break;case"eggGrowth":i.eggMinutesPerHour+=e.effectPerHour;break;case"coins":i.coinsPerHour+=e.effectPerHour}return e}).sort((e,t)=>t.totalProcsPerHour-e.totalProcsPerHour),totals:i,unknown:r}}(e),rp(v)}),rp(v),v.updateInterval=window.setInterval(()=>{!function(e){const t=e.querySelectorAll(".eta-countdown");t.forEach(e=>{if(!(e instanceof HTMLElement))return;const t=parseInt(e.dataset.lastProc||"0",10),n=parseFloat(e.dataset.effectiveRate||"0"),o=e.dataset.normalColor||"var(--qpm-positive)";if(!t||!n||0===t||0===n)return;const r=ml(t,n>0?60/n:null,n);e.textContent=r.text,e.style.color=r.isOverdue?"var(--qpm-danger)":o})}(v.tbody)},1e3);const C=new MutationObserver(()=>{document.body.contains(e)||(null!==v.updateInterval&&clearInterval(v.updateInterval),C.disconnect(),s("Tracker window cleanup: interval cleared"))});C.observe(document.body,{childList:!0,subtree:!0}),s("Trackers window rendered with live updates")}function rp(e){const t=Yu,n=Zu;!function(e,t){const n=t.groups.map(e=>({id:e.definition.id,name:e.definition.name,count:e.entries.length})),o=n.map(e=>e.id).sort().join(",");if(o===(e.dataset.abilityIds||"")&&e.children.length>0)return;if(e.dataset.abilityIds=o,e.innerHTML="",0===n.length){const t=document.createElement("div");return t.textContent="No abilities available",t.style.cssText="padding: 8px; color: rgba(255, 255, 255, 0.5); font-size: 11px;",void e.appendChild(t)}const r=document.createElement("div");r.style.cssText="display: flex; align-items: center; gap: 8px;";const i=document.createElement("span");i.textContent="Filter Ability:",i.style.cssText="font-size: 12px; color: var(--qpm-text-muted);",r.appendChild(i);const a=document.createElement("select");a.className="qpm-select",a.style.cssText="flex: 1; min-width: 200px; padding: 6px 8px; font-size: 12px;";const s=document.createElement("option");s.value="",s.textContent="All abilities",a.appendChild(s),n.forEach(({id:e,name:t,count:n})=>{const o=document.createElement("option");o.value=e,o.textContent=`${t} (${n})`,a.appendChild(o)}),1===tp.selectedAbilities.length?a.value=tp.selectedAbilities[0]||"":a.value="",a.addEventListener("change",()=>{""===a.value?tp.selectedAbilities=[]:tp.selectedAbilities=[a.value],f.set("qpm-tracker-settings",tp),rp({summaryText:e.closest(".qpm-modal-window")?.querySelector(".tracker-summary"),tbody:e.closest(".qpm-modal-window")?.querySelector(".tracker-tbody"),footer:e.closest(".qpm-modal-window")?.querySelector(".tracker-footer"),abilityCheckboxGrid:e})}),r.appendChild(a),e.appendChild(r)}(e.abilityCheckboxGrid,t);const o=new Map,r=new Map;if(e.tbody.querySelectorAll('.eta-countdown[data-is-estimate="true"]').forEach(e=>{if(!(e instanceof HTMLElement))return;const t=e.dataset.lastProc,n=e.closest("tr"),i=n?.dataset.petIndex,a=n?.dataset.abilityId,s="true"===n?.dataset.isGroupRow;if(t&&a)if(s){const e=`group:${a}`;r.set(e,parseInt(t,10))}else if(void 0!==i){const e=`${i}:${a}`;o.set(e,parseInt(t,10))}}),e.tbody.innerHTML="",0===t.groups.length){const t=e.tbody.insertRow().insertCell();return t.colSpan=7,t.style.cssText="padding: 40px; text-align: center; color: rgba(255, 255, 255, 0.5);",t.innerHTML='\n      <div style="font-size: 48px; margin-bottom: 12px;">üê¢</div>\n      <div style="font-size: 14px; font-weight: 600; margin-bottom: 6px;">No Active Pet Abilities</div>\n      <div style="font-size: 12px; opacity: 0.7;">Make sure pets are active and assigned in your garden</div>\n    ',e.footer.textContent="üìä Total: No data",void(e.summaryText.textContent="üêæ No Active Pets")}let i=t.groups;tp.filterCoinOnly&&(i=i.filter(e=>"coins"===e.definition.effectUnit||"coins"===e.definition.category)),tp.selectedAbilities.length>0&&(i=i.filter(e=>tp.selectedAbilities.includes(e.definition.id)));const a=n.length,s=t.groups.length,l=i.length,c=i.filter(e=>"coins"===e.definition.effectUnit||"coins"===e.definition.category).length;let d=[`üêæ ${a} Active Pet${1!==a?"s":""}`];tp.filterCoinOnly||tp.selectedAbilities.length>0?d.push(`üìä ${l}/${s} Abilities (filtered)`):d.push(`üìä ${s} Abilit${1!==s?"ies":"y"}`),c>0&&d.push(`üí∞ ${c} Coin-Generating`),e.summaryText.textContent=d.join(" ‚Ä¢ ");let u=0,p=0,m=0,g=0;if(0===i.length){const t=e.tbody.insertRow().insertCell();return t.colSpan=7,t.style.cssText="padding: 40px; text-align: center; color: rgba(255, 255, 255, 0.5);",t.innerHTML='\n      <div style="font-size: 48px; margin-bottom: 12px;">üîç</div>\n      <div style="font-size: 14px; font-weight: 600; margin-bottom: 6px;">No Abilities Match Filter</div>\n      <div style="font-size: 12px; opacity: 0.7;">Try adjusting your filter settings above</div>\n    ',void(e.footer.innerHTML="<strong>üìä Total:</strong> 0 abilities (filtered)")}const h=i.filter(e=>"coins"===e.definition.effectUnit||"coins"===e.definition.category),b=i.filter(e=>"coins"!==e.definition.effectUnit&&"coins"!==e.definition.category);if([...h,...b].forEach(t=>{for(const n of t.entries){fl(n,t.definition.name,e.tbody,tp.detailedView,o);const{effective:r}=pl(n.procsPerHour,n.definition.id),i=r*(n.effectPerProc??0);u+=r,p+=n.chancePerMinute,("coins"===t.definition.effectUnit||"coins"===t.definition.category)&&n.effectPerProc&&n.effectPerProc>0&&(m+=i),g++}!function(e,t,n=!1,o){if(e.entries.length<2){const e=t.rows.length-1;return e>=0?t.rows[e]??null:null}const r=t.insertRow();r.style.cssText="\n    border-bottom: 2px solid var(--qpm-border);\n    background: var(--qpm-surface-2);\n    font-weight: 600;\n  ",r.dataset.isGroupRow="true",r.dataset.abilityId=e.definition.id;const i=r.insertCell();i.textContent=`üìä Total (${e.entries.length})`,i.style.cssText="\n    padding: 10px 12px;\n    color: var(--qpm-accent);\n    font-weight: 600;\n    white-space: nowrap;\n  ";const a=r.insertCell();a.textContent=e.definition.name,a.style.cssText="\n    padding: 10px 12px;\n    color: var(--qpm-accent);\n    white-space: nowrap;\n  ";const s=r.insertCell();s.textContent=`${e.chancePerMinute.toFixed(2)}%/min`,s.style.cssText="\n    padding: 10px 12px;\n    text-align: right;\n    color: var(--qpm-accent);\n    font-family: monospace;\n    white-space: nowrap;\n    font-weight: 600;\n  ",s.title=`Combined chance from ${e.entries.length} pets`;const l=r.insertCell();l.textContent=e.totalProcsPerHour.toFixed(2),l.style.cssText="\n    padding: 10px 12px;\n    text-align: right;\n    color: var(--qpm-accent);\n    font-family: monospace;\n    font-weight: 600;\n  ",l.title=`Combined procs/hour from ${e.entries.length} pets`;const c=r.insertCell(),d=e.averageEffectPerProc??0,u=n?so:lo;c.textContent=d>0?u(d):"‚Äî",c.style.cssText=`\n    padding: 10px 12px;\n    text-align: right;\n    color: ${d>0?"var(--qpm-warning)":"var(--qpm-text-muted)"};\n    font-family: monospace;\n    font-weight: 600;\n  `,d>0&&(c.title=n?"Average coins per proc":`Exact: ${so(d)}`);const p=r.insertCell(),m=e.effectPerHour;p.textContent=m>0?u(m):"‚Äî",p.style.cssText=`\n    padding: 10px 12px;\n    text-align: right;\n    color: ${m>0?"var(--qpm-warning)":"var(--qpm-text-muted)"};\n    font-family: monospace;\n    font-weight: 600;\n  `,m>0&&(p.title=n?`Combined coins/hour from ${e.entries.length} pets`:`Exact: ${so(m)}/hr`);const f=r.insertCell();f.className="eta-countdown";const g=e.totalProcsPerHour>0?60/e.totalProcsPerHour:0;if(e.totalProcsPerHour>0){let t,n;if(e.lastProcAt&&e.lastProcAt>0)t=e.lastProcAt,n=!1;else{const r=`group:${e.definition.id}`,i=o?.get(r);t=i||Date.now(),n=!0}f.dataset.lastProc=String(t),f.dataset.effectiveRate=String(e.totalProcsPerHour),f.dataset.normalColor="var(--qpm-accent)",f.dataset.isEstimate=n?"true":"false";const r=ml(t,e.combinedEtaMinutes,e.totalProcsPerHour);f.textContent=r.text,f.style.cssText=`\n      padding: 10px 12px;\n      text-align: right;\n      color: ${r.isOverdue?"var(--qpm-danger)":"var(--qpm-accent)"};\n      font-family: monospace;\n      font-weight: 600;\n      white-space: nowrap;\n    `,f.title=n?`Estimated ${g.toFixed(1)} minutes between procs\nNo proc history yet`:`Combined average: ${g.toFixed(1)} minutes between procs\nLast proc: ${new Date(e.lastProcAt).toLocaleTimeString()}`}else f.textContent="‚Äî",f.style.cssText="\n      padding: 10px 12px;\n      text-align: right;\n      color: var(--qpm-text-muted);\n      font-family: monospace;\n      font-weight: 600;\n      white-space: nowrap;\n    ",f.title="No proc rate available"}(t,e.tbody,tp.detailedView,r)}),g>0){const t=e.tbody.insertRow();t.style.cssText="\n      background: var(--qpm-surface-2);\n      border-top: 2px solid var(--qpm-border);\n      font-weight: 600;\n      position: sticky;\n      bottom: 0;\n      z-index: 5;\n    ";const n=t.insertCell();n.textContent="üìä TOTAL",n.colSpan=2,n.style.cssText="padding: 12px; color: var(--qpm-accent); font-weight: 700; font-size: 13px; text-transform: uppercase;";const o=t.insertCell();o.textContent=`${p.toFixed(2)}%/min`,o.style.cssText="padding: 12px; text-align: right; color: var(--qpm-accent); font-family: monospace;";const r=t.insertCell();r.textContent=u.toFixed(2),r.style.cssText="padding: 12px; text-align: right; color: var(--qpm-accent); font-family: monospace;";const i=t.insertCell();i.textContent="‚Äî",i.style.cssText="padding: 12px; text-align: right; color: rgba(255, 255, 255, 0.5);";const a=t.insertCell();a.textContent=so(m),a.style.cssText="padding: 12px; text-align: right; color: #ffa500; font-family: monospace; font-weight: 700; font-size: 14px;";const s=t.insertCell();s.textContent="‚Äî",s.style.cssText="padding: 12px; text-align: right; color: rgba(255, 255, 255, 0.5);";const l=h.reduce((e,t)=>e+t.entries.length,0),c=[`<strong>üìä Total:</strong> ${g} abilit${1!==g?"ies":"y"}`];if(l>0){let e=0;for(const t of h)for(const n of t.entries){const o=Cs(t.definition.id,{petId:n.pet.petId,slotId:n.pet.slotId,slotIndex:"number"==typeof n.pet.slotIndex&&Number.isFinite(n.pet.slotIndex)?n.pet.slotIndex:null,fallbackKeys:[]});if(o){const n=xu(o);for(const o of n){const n=wu(t.definition,o);null!=n&&Number.isFinite(n)&&n>0&&(e+=n)}}}e>0?c.push(`<span style="color: #ffd700;">üí∞ ${so(e)} earned</span>`):c.push(`<span style="color: #ffd700;">üí∞ ${l} coin</span>`)}m>0&&c.push(`<span style="color: #ffa500; font-size: 14px; font-weight: 700;">üí∏ ${so(m)}/hr</span>`),u>0&&c.push(`<span style="color: var(--qpm-accent); font-size: 12px;">‚ö° ${u.toFixed(1)} procs/hr</span>`),e.footer.innerHTML=c.join(" ‚Ä¢ ")}}function ip(e){e.style.cssText="display: flex; flex-direction: column; gap: 16px; min-width: 600px;";const t=Qu();t.style.margin="0",e.appendChild(t)}function ap(e){e.style.cssText="display: flex; flex-direction: column; gap: 16px; min-width: 600px;";const t=cp();t.style.margin="0",e.appendChild(t)}function sp(e){e.style.cssText="display: flex; flex-direction: column; gap: 16px; min-width: 600px;";const t=lp(!1!==Se().syncModeEnabled);t.style.margin="0",e.appendChild(t)}function lp(e){const t=document.createElement("span");t.className="qpm-chip",t.textContent=e?"Sync Mode":"Basic Mode";const{root:n,body:o}=Eu("üîí Inventory Locker",{collapsible:!0,startCollapsed:!0,subtitleElement:t});n.dataset.qpmSection="inventory-locker";const r=document.createElement("div");r.className="qpm-section-muted",r.style.marginBottom="8px";const i=e=>{r.textContent=e?"Unlock keeps manual favorites; only locker-added favorites are removed.":"Unlock toggles every favorite for the selected crop species.",t.textContent=e?"Sync Mode":"Basic Mode"};i(e),o.appendChild(r);const a=document.createElement("div");a.innerHTML="üí° <strong>How it works:</strong><br>‚Ä¢ Open inventory to lock species<br>‚Ä¢ Locked species are favorited automatically<br>‚Ä¢ Sync mode preserves manual favorites<br>‚Ä¢ Basic mode toggles all favorites",a.style.cssText="background:#333;padding:8px;border-radius:4px;margin-bottom:8px;font-size:10px;line-height:1.5;border-left:3px solid #FFCA28",o.appendChild(a);const s=function(e,t,n){const o=document.createElement("label");o.style.cssText="display:flex;align-items:center;gap:8px;margin-bottom:6px;font-size:11px;color:#ddd";const r=document.createElement("input");r.type="checkbox",r.checked=t,r.style.cssText="width:14px;height:14px;cursor:pointer",r.addEventListener("click",e=>e.stopPropagation()),r.addEventListener("change",()=>{n(r.checked)});const i=document.createElement("span");return i.textContent=e,i.style.cssText="flex:1",o.append(r,i),o.addEventListener("click",e=>e.stopPropagation()),o}("Sync mode (preserve manual favorites)",e,e=>{$u.inventoryLocker?$u.inventoryLocker.syncMode=e:$u.inventoryLocker={syncMode:e},Pe(e),pp(),i(e),dp(e?"Inventory locker sync mode enabled":"Inventory locker sync mode disabled")});o.appendChild(s);const l=document.createElement("div");return l.textContent="Tip: open inventory to lock species. Sync mode avoids unfavoriting crops you already starred.",l.style.cssText="font-size:10px;color:#A5D6A7;line-height:1.4;margin-top:8px;",o.appendChild(l),n}function cp(){const e=document.createElement("span");e.className="qpm-chip",e.textContent=$u.mutationReminder?.enabled?"Enabled":"Disabled";const{root:t,body:n}=Eu("üß¨ Mutation Reminder",{collapsible:!0,startCollapsed:!0,subtitleElement:e});t.dataset.qpmSection="mutation-reminder";const o=document.createElement("div");o.textContent="Monitoring weather...",o.className="qpm-section-muted",n.appendChild(o);const r=document.createElement("div");r.innerHTML="üí° <strong>How it works:</strong><br>‚Ä¢ Detects weather events (Rain/Snow/Dawn/Amber)<br>‚Ä¢ Scans your plant inventory for mutations (F/W/C/D/A)<br>‚Ä¢ Notifies which plants to place for mutations<br>‚Ä¢ Example: Wet plant + Snow ‚Üí Frozen mutation!",r.style.cssText="background:#333;padding:8px;border-radius:4px;font-size:10px;line-height:1.5;border-left:3px solid #9C27B0",n.appendChild(r);const i=up($u.mutationReminder?.enabled?"‚úì Reminders Enabled":"‚úó Reminders Disabled",async()=>{if(!$u.mutationReminder)return;$u.mutationReminder.enabled=!$u.mutationReminder.enabled,i.textContent=$u.mutationReminder.enabled?"‚úì Reminders Enabled":"‚úó Reminders Disabled",i.classList.toggle("qpm-button--positive",$u.mutationReminder.enabled),i.classList.toggle("qpm-button--accent",$u.mutationReminder.enabled),e.textContent=$u.mutationReminder.enabled?"Enabled":"Disabled",pp();const{setMutationReminderEnabled:t}=await Promise.resolve().then(()=>vn);t($u.mutationReminder.enabled)});i.style.width="100%",$u.mutationReminder?.enabled&&i.classList.add("qpm-button--positive","qpm-button--accent"),n.appendChild(i);const a=up("üîç Check Now",async()=>{a.disabled=!0,a.textContent="‚è≥ Checking...";try{const{checkForMutations:e}=await Promise.resolve().then(()=>vn);await e(),a.textContent="‚úÖ Done!",setTimeout(()=>{a.textContent="üîç Check Now",a.disabled=!1},2e3)}catch(e){a.textContent="‚ùå Error",s("Error checking mutations:",e),setTimeout(()=>{a.textContent="üîç Check Now",a.disabled=!1},2e3)}});a.style.width="100%",a.style.background="#9C27B0",a.title="Manually check for mutation opportunities",n.appendChild(a);const l=document.createElement("div");l.style.cssText="margin-top:8px;padding:8px;background:#2a1a3a;border-radius:4px;border:1px dashed #9C27B0";const c=document.createElement("div");c.textContent="üß™ Debug: Simulate Weather",c.style.cssText="font-size:10px;color:#aaa;margin-bottom:6px;font-weight:bold";const d=document.createElement("div");d.style.cssText="display:grid;grid-template-columns:1fr 1fr;gap:4px";const u=[{emoji:"üåßÔ∏è",name:"Rain",type:"rain"},{emoji:"‚ùÑÔ∏è",name:"Snow",type:"snow"},{emoji:"üåÖ",name:"Dawn",type:"dawn"},{emoji:"üåÜ",name:"Amber",type:"amber"}];for(const p of u){const e=up(`${p.emoji} ${p.name}`,async()=>{e.disabled=!0;try{const{simulateWeather:t}=await Promise.resolve().then(()=>vn);await t(p.type),e.textContent=`‚úÖ ${p.name}`,setTimeout(()=>{e.textContent=`${p.emoji} ${p.name}`,e.disabled=!1},2e3)}catch(t){s("Error simulating weather:",t),e.textContent=`‚ùå ${p.name}`,setTimeout(()=>{e.textContent=`${p.emoji} ${p.name}`,e.disabled=!1},2e3)}});e.style.cssText="padding:4px 8px;font-size:10px;background:#333;border:1px solid #555",e.title=`Simulate ${p.name} weather for testing`,d.appendChild(e)}return l.append(c,d),n.appendChild(l),Hd.mutationStatus=o,t}function dp(e){!function(){if(document.getElementById(Jd))return;const e=document.createElement("style");e.id=Jd,e.textContent="@keyframes qpm-toast-in { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 0.95; } }",document.head.appendChild(e)}();const t=document.createElement("div");t.textContent=e,t.style.cssText="position:fixed;bottom:24px;right:24px;background:#2e7d32;color:#fff;padding:8px 12px;border-radius:6px;font-size:12px;z-index:2147483647;opacity:0.95;animation:qpm-toast-in 0.3s ease",document.body.appendChild(t),setTimeout(()=>t.remove(),2500)}function up(e,t){const n=document.createElement("button");return n.textContent=e,n.style.cssText="padding:6px 10px;font-size:12px;cursor:pointer;border:none;border-radius:4px;background:#555;color:#fff;transition:background 0.2s",n.onmouseover=()=>{n.disabled||(n.style.background="#777")},n.onmouseout=()=>{n.disabled||(n.textContent?.includes("‚úì")?n.style.background="#4CAF50":n.style.background="#555")},n.onclick=t,n}function pp(){try{localStorage.setItem("quinoa-pet-manager",JSON.stringify($u))}catch{}}const mp="qpm.petXpObservations.v1",fp=new Map,gp=new Map,hp=new Map,bp=new Map;let yp=!1;const xp=d(()=>{try{f.set(mp,function(){const e=[];for(const[t,n]of bp){const o=Array.from(n.values()).sort((e,t)=>e.level-t.level).map(e=>({...e}));e.push({key:t,displayName:gp.get(t)??t,lastUpdated:hp.get(t)??0,levels:o})}return{version:1,savedAt:Date.now(),species:e}}())}catch(e){s("‚ö†Ô∏è Failed to persist pet XP observations",e)}},2500);function wp(e,t,n,o,r,i){const a=c(e);if(!a)return;const s=Math.max(0,Math.round(t));if(!Number.isFinite(s))return;const l=Math.max(0,Math.round(n));if(!Number.isFinite(l))return;const d=(u=a,bp.has(u)||bp.set(u,new Map),bp.get(u));var u;const p=d.get(s);if(p){(l>p.xp||l===p.xp&&"level-up"===r&&"level-up"!==p.source)&&(p.xp=l,p.strength=o??p.strength??null,p.source=r),p.samples+=1,p.lastObservedAt=i}else d.set(s,{level:s,xp:l,strength:o??null,samples:1,lastObservedAt:i,source:r});gp.set(a,e),hp.set(a,i),xp()}function vp(e){const t=Date.now(),n=new Set;e.forEach((e,o)=>{const r=function(e,t){return e.slotId&&e.slotId.trim().length>0?`slot:${e.slotId}`:e.petId&&e.petId.trim().length>0?`pet:${e.petId}`:`index:${t}`}(e,o);n.add(r);const i=fp.get(r),a=e.species??i?.species??null,s="number"==typeof e.level&&Number.isFinite(e.level)?e.level:null,l="number"==typeof e.xp&&Number.isFinite(e.xp)?e.xp:null,c="number"==typeof e.strength&&Number.isFinite(e.strength)?e.strength:null;if(i&&a&&i.species===a){const e=i.level,n=i.xp,o=i.strength;null!=e&&null!=s&&s>e&&null!=n&&n>0&&wp(a,e,n,o,"level-up",t)}if(a&&null!=s&&null!=l){const e=i?.xp,n=i?.level;(null==e||Math.round(e)!==Math.round(l)||(null==n||n!==s))&&wp(a,s,l,c,"snapshot",t)}fp.set(r,{species:a,level:s,xp:l,strength:c})});for(const o of fp.keys())n.has(o)||fp.delete(o)}function Cp(){if(!yp){yp=!0;try{const t=f.get(mp,null);(e=t??null)&&1===e.version&&(bp.clear(),gp.clear(),hp.clear(),e.species.forEach(e=>{const t=new Map;e.levels.forEach(e=>{const n=Math.max(0,Math.round(e.level)),o=Number.isFinite(e.xp)?Math.max(0,Math.round(e.xp)):null;null!=o&&t.set(n,{level:n,xp:o,strength:e.strength??null,samples:Math.max(1,Math.round(e.samples??1)),lastObservedAt:e.lastObservedAt??0,source:"level-up"===e.source?"level-up":"snapshot"})}),0!==t.size&&(bp.set(e.key,t),gp.set(e.key,e.displayName??e.key),hp.set(e.key,e.lastUpdated??Date.now()))}))}catch(t){s("‚ö†Ô∏è Failed to restore pet XP observations",t)}var e;xr(),Cr(vp)}}const Tp=[],Sp={speciesXpPerLevel:{}};let Pp=[];function Ap(e,t,n,o,r){const i=e.strength??100,a=e.petId??"",s=e.species??"Unknown",l=Math.max(.25,i/100),c=o/60,d=o*l,u=c*l,p=Math.max(0,c/100),m=3600*Math.min(.95/60,p*l),f=r*l,g=m*f,h=Tp.filter(e=>e.petId===a&&e.abilityId===t),b=h.length>0?h[h.length-1]:null;return{petId:a,petName:e.name??e.species??"Unknown",species:s,abilityId:t,abilityName:n,strength:i,baseXpPerProc:r,actualXpPerProc:f,baseChancePerMinute:o,actualChancePerMinute:d,baseChancePerSecond:c,actualChancePerSecond:u,expectedProcsPerHour:m,expectedXpPerHour:g,lastProcAt:b?.timestamp??null,procCount:h.length,level:e.level??null,currentXp:e.xp??null}}const kp={Worm:12,Snail:12,Bee:12,Chicken:24,Bunny:24,Dragonfly:24,Pig:72,Cow:72,Turkey:72,Squirrel:100,Turtle:100,Goat:100,Butterfly:144,Peacock:144,Capybara:144};function Ep(e){const t=kp[e];if(!t)return Sp.speciesXpPerLevel[e]??null;return 3600*t/30}const $p={Worm:2,Snail:2,Bee:2.5,Chicken:2,Bunny:2,Dragonfly:2.5,Pig:2.5,Cow:2.5,Turkey:2.5,Squirrel:2,Turtle:2.5,Goat:2,Butterfly:2.5,Peacock:2.5,Capybara:2.5,Sheep:2};function Mp(e){return $p[e]??null}function Fp(e,t){if(!e||e<1)return null;const n=Mp(t);if(!n||n<=1)return null;const o=20*((e-1)/(n-1))+80,r=Math.floor(o);return r<80||r>100?null:r}function Ip(e,t,n){if(n<=0||e>=t)return null;const o=(t-e)/n,r=60*o,i=Math.floor(o);return{hours:i,minutes:Math.round(60*(o-i)),totalMinutes:r}}const Lp={respectRules:!1,avoidFavorited:!0,overrides:{},updatedAt:Date.now()},zp=["Carrot","Strawberry","Blueberry","Apple","Watermelon","Pumpkin"],Np=Object.fromEntries(Object.entries({Worm:["Carrot","Strawberry","Aloe","Tomato","Apple"],Snail:["Blueberry","Tomato","Corn","Daffodil"],Bee:["Strawberry","Blueberry","Daffodil","Lily","Chrysanthemum"],Chicken:["Aloe","Corn","Watermelon","Pumpkin"],Bunny:["Carrot","Strawberry","Blueberry","OrangeTulip","Apple"],Dragonfly:["Apple","OrangeTulip","Echeveria"],Pig:["Watermelon","Pumpkin","Mushroom","Bamboo"],Cow:["Coconut","Banana","BurrosTail","Mushroom"],Squirrel:["Pumpkin","Banana","Grape"],Turtle:["Watermelon","BurrosTail","Bamboo","Pepper"],Goat:["Pumpkin","Coconut","Pepper","Camellia","PassionFruit"],Butterfly:["Daffodil","Lily","Grape","Lemon","Sunflower","Chrysanthemum"],Capybara:["Lemon","PassionFruit","DragonFruit","Lychee"],Peacock:["Cactus","Sunflower","Lychee"]}).map(([e,t])=>{const n=c(e),o=t.map(e=>c(e)).filter(Boolean);return[n,{display:[...t],normalized:o}]})),qp=zp.map(e=>c(e));let Bp=function(){const e=f.get("quinoa-pet-food-rules",{});if(!e||"object"!=typeof e)return{...Lp};return{respectRules:"boolean"==typeof e.respectRules?e.respectRules:Lp.respectRules,avoidFavorited:"boolean"==typeof e.avoidFavorited?e.avoidFavorited:Lp.avoidFavorited,overrides:"object"==typeof e.overrides&&e.overrides?e.overrides:{},updatedAt:"number"==typeof e.updatedAt?e.updatedAt:Date.now()}}();function Rp(e){const t=[e.species,e.itemType,e.name];for(const n of t){if("string"!=typeof n||0===n.length)continue;const e=c(n);if(e)return e}return null}function Dp(e,t,n={}){if(!t||0===t.items.length)return null;const o=function(e){if(!e)return{display:[...zp],normalized:[...qp]};const t=c(e),n=t?Np[t]:void 0;return n||{display:[...zp],normalized:[...qp]}}(e),r=function(e){if(!e)return null;const t=c(e);return t&&Bp.overrides[t]||null}(e),i=new Set(o.normalized),a=r?.preferred?c(r.preferred):null;if(a&&i.add(a),r?.allowed)for(const g of r.allowed){const e=c(g);e&&i.add(e)}const s=new Set;if(r?.forbidden)for(const g of r.forbidden){const e=c(g);e&&s.add(e)}0===i.size&&qp.forEach(e=>i.add(e));const l=n.avoidFavorited??Bp.avoidFavorited,d=(e,n)=>{for(const o of t.items){const r=Rp(o);if(r&&((!e||!t.favoritedIds.has(o.id))&&n(r,o)))return o}return null},u=e=>a?d(e,e=>e===a):null,p=e=>d(e,e=>i.has(e)&&!s.has(e)),m=u(!0);if(m)return{item:m,usedFavoriteFallback:!1};if(l){const e=u(!1);if(e)return{item:e,usedFavoriteFallback:t.favoritedIds.has(e.id)}}const f=p(!0);if(f)return{item:f,usedFavoriteFallback:!1};if(l){const e=p(!1);if(e)return{item:e,usedFavoriteFallback:t.favoritedIds.has(e.id)}}return null}function Hp(){return b.MagicCircle_RoomConnection??null}function jp(){const e=b;return e.__mga_lastScopePath?.slice()??["Room","Quinoa"]}function Wp(e,t){try{const n=Hp();if(!n)return s("‚ö†Ô∏è MagicCircle_RoomConnection not found"),!1;const o={type:"FeedPet",petItemId:e,cropItemId:t,scopePath:jp()};return s("üì§ Sending FeedPet WebSocket message",o),n.sendMessage(o),!0}catch(n){return s("‚ùå Failed to send FeedPet message",n),!1}}async function Gp(e,t=!1){try{const t=vr();if(0===t.length)return{success:!1,petName:null,petSpecies:null,foodSpecies:null,error:"No active pets found"};const n=t[e];if(!n)return{success:!1,petName:null,petSpecies:null,foodSpecies:null,error:`Pet at index ${e} not found`};if(!n.petId)return{success:!1,petName:n.name,petSpecies:n.species,foodSpecies:null,error:"Pet has no petId (UUID)"};const o=await Kl();if(!o||!o.items||0===o.items.length)return{success:!1,petName:n.name,petSpecies:n.species,foodSpecies:null,error:"Failed to read inventory"};const r={items:o.items.filter(e=>"Produce"===e.itemType||"Crop"===e.itemType).map(e=>({id:e.id,species:e.species??null,itemType:e.itemType??null,name:e.name??null})),favoritedIds:new Set(o.favoritedItemIds??[]),source:"myInventoryAtom"},i=Dp(n.species,r,{avoidFavorited:!0});if(!i)return{success:!1,petName:n.name,petSpecies:n.species,foodSpecies:null,error:"No suitable food found in inventory"};const a=i.item;if(!a.id)return{success:!1,petName:n.name,petSpecies:n.species,foodSpecies:a.species,error:"Crop has no ID"};const l=null!==n.hungerPct?`hunger: ${n.hungerPct}%`:"hunger: unknown";s(`üçñ Attempting to feed ${n.name||n.species||"pet"} (${l}) with ${a.species||"food"}`);return Wp(n.petId,a.id)?(s(`‚úÖ Fed ${n.name||n.species||"pet"} with ${a.species||"food"}`),{success:!0,petName:n.name,petSpecies:n.species,foodSpecies:a.species}):{success:!1,petName:n.name,petSpecies:n.species,foodSpecies:a.species,error:"Failed to send WebSocket message"}}catch(n){return s("‚ùå Instant feed error",n),{success:!1,petName:null,petSpecies:null,foodSpecies:null,error:n instanceof Error?n.message:"Unknown error"}}}const Op={enabled:!0,autoRefresh:!0,refreshInterval:30,selectedSpecies:null};let Vp={...Op},_p=null,Up=null,Xp=null,Kp=0;const Jp=new Map;function Qp(e){Vp.selectedSpecies=e,f.set("cropBoostTracker:config",Vp),tm()}function Yp(e,t){if(e.currentScale>=e.maxScale)return 0;if(t<=0)return 1/0;const n=1+t/100,o=e.maxScale/e.currentScale,r=Math.log(o)/Math.log(n);return Math.ceil(r)}function Zp(e,t){if(0===t.length||e<=0)return{p10:0,p50:0,p90:0};const n=e*(1.5*t.reduce((e,t)=>t.effectiveBoostPercent<e.effectiveBoostPercent?t:e).expectedMinutesPerProc);return{p10:.8*n,p50:n,p90:1.5*n}}function em(){const e=function(){const e=vr(),t=[];for(const n of e){const e=[{id:"ProduceScaleBoost",name:"Crop Size Boost I",base:6,chance:.3},{id:"ProduceScaleBoostII",name:"Crop Size Boost II",base:10,chance:.4}];for(const o of e)if(n.abilities&&n.abilities.includes(o.id)){const e=n.strength??100,r=o.base*e/100,i=o.chance*e/100,a=100/i;t.push({slotIndex:n.slotIndex,displayName:n.name??n.species??"Unknown",species:n.species??"unknown",strength:e,abilityId:o.id,abilityName:o.name,baseBoostPercent:o.base,effectiveBoostPercent:r,baseProcChance:o.chance,effectiveProcChance:i,expectedMinutesPerProc:a})}}return t}(),t=function(){const e=In();if(!e)return[];const t=[],n=(e,n)=>{if(e)for(const[o,r]of Object.entries(e))if("plant"===r.objectType&&r.slots&&Array.isArray(r.slots))for(let e=0;e<r.slots.length;e++){const i=r.slots[e];if(!i||!i.species)continue;const a=i.species,s=i.targetScale??i.scale??i.plantScale??1,l=a.toLowerCase(),c=i.maxScale??i.targetMaxScale??p(l)??2,d=i.mutations??[],u=i.fruitCount??i.remainingFruitCount??1,m=i.endTime??0,f=m>0&&Date.now()>=m,g=50+(s-1)/(c-1)*50,h=Math.max(0,100-g);t.push({species:a,currentScale:s,maxScale:c,currentSizePercent:Math.max(50,Math.min(100,g)),sizeRemaining:h,mutations:d,fruitCount:u,isMature:f,tileKey:`${n}${o}`,slotIndex:e})}};return n(e.tileObjects,""),n(e.boardwalkTileObjects,"bw-"),t}();if(0===e.length)return s("‚ÑπÔ∏è Crop Boost Tracker: No active boost pets"),null;!function(e){const t=Date.now();for(const o of e){const e=`${o.tileKey}-${o.slotIndex}`,n=Jp.get(e);n?o.currentSizePercent-n.lastSize>.5&&(n.boostTimestamps.push(t),n.lastSize=o.currentSizePercent):Jp.set(e,{initialSize:o.currentSizePercent,boostTimestamps:[],lastSize:o.currentSizePercent})}const n=new Set(e.map(e=>`${e.tileKey}-${e.slotIndex}`));for(const o of Jp.keys())n.has(o)||Jp.delete(o)}(t);const n=t.filter(e=>e.sizeRemaining<=0),o=t.filter(e=>e.sizeRemaining>0),r=e.map(e=>e.effectiveBoostPercent),i=r.reduce((e,t)=>e+t,0)/r.length,a=Math.min(...r),l=Math.max(...r),c=e.map(e=>e.expectedMinutesPerProc),d=c.reduce((e,t)=>e+t,0)/c.length,u=Math.max(...c),m=Math.min(...c),f=i,g=new Map;let h=0;const b=Date.now();for(const s of o){const t=`${s.tileKey}-${s.slotIndex}`,n=Jp.get(t),o=n?.boostTimestamps.length??0,r=n?.boostTimestamps[n.boostTimestamps.length-1]??null,i=Yp(s,f),a=Zp(Math.max(0,i-o),e),l=b+60*Zp(1,e).p50*1e3,c={boostsNeeded:i,timeEstimateP10:a.p10,timeEstimateP50:a.p50,timeEstimateP90:a.p90,boostsReceived:o,lastBoostAt:r,expectedNextBoostAt:l};g.set(t,c),h=Math.max(h,i)}const y=Zp(h,e);return{boostPets:e,crops:t,totalBoostPets:e.length,totalMatureCrops:t.length,totalCropsAtMax:n.length,totalCropsNeedingBoost:o.length,averageBoostPercent:i,weakestBoostPercent:a,strongestBoostPercent:l,averageMinutesPerProc:d,slowestMinutesPerProc:u,fastestMinutesPerProc:m,overallEstimate:{boostsNeeded:h,timeEstimateP10:y.p10,timeEstimateP50:y.p50,timeEstimateP90:y.p90,boostsReceived:0,lastBoostAt:null,expectedNextBoostAt:0},cropEstimates:g,timestamp:Date.now()}}function tm(){const e=Date.now();e-Kp<5e3||(Kp=e,_p=em(),Xp&&Xp(_p))}function nm(){return _p}function om(){!function(){const e=f.get("cropBoostTracker:config",Op);Vp={...Op,...e}}(),Vp.enabled&&(Up||(s("üå± Crop Boost Tracker: Starting"),tm(),Up=Ln(()=>{tm()}))),s("üå± Crop Boost Tracker initialized")}function rm(e){if(!isFinite(e))return"N/A";if(e<1)return"< 1m";const t=Math.floor(e/60),n=Math.floor(e%60);if(t>24){return`${Math.floor(t/24)}d ${t%24}h`}return t>0?`${t}h ${n}m`:`${n}m`}function im(e,t,n){const o=rm(e),r=rm(t),i=rm(n);return o===r&&r===i?r:`${o} - ${i} (median: ${r})`}const am="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBxdWt0cXJuZ3l4a3ZyZ3RmeWdwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk2MTQzMDMsImV4cCI6MjA3NTE5MDMwM30.-d45t6qyEO54iz2SrjaoTUQjeNb6tngDx6pOQL7-Ubg";async function sm(e,t){const n=function(e,t){const n=new URL(e,"https://pquktqrngyxkvrgtfygp.supabase.co/functions/v1/");if(t)for(const[o,r]of Object.entries(t))void 0!==r&&n.searchParams.set(o,String(r));return n.toString()}(e,t),o="function"==typeof GM_xmlhttpRequest?GM_xmlhttpRequest:"function"==typeof window.GM?.xmlHttpRequest?window.GM.xmlHttpRequest.bind(window.GM):void 0,r={apikey:am,Authorization:`Bearer ${am}`};if(o)return await new Promise(e=>{o({method:"GET",url:n,headers:r,onload:t=>{if(t.status>=200&&t.status<300)try{const n=t.responseText?JSON.parse(t.responseText):null;e({status:t.status,data:n})}catch(n){console.error("[supabase] GET parse error:",n,t.responseText),e({status:t.status,data:null})}else console.error("[supabase] GET error:",t.status,t.responseText),e({status:t.status,data:null})},onerror:t=>{console.error("[supabase] GET request failed:",t),e({status:0,data:null})}})});try{const e=await fetch(n,{headers:r}),t=e.status;if(t>=200&&t<300){const n=await e.text();return{status:t,data:n?JSON.parse(n):null}}return console.error("[supabase] GET error:",t,await e.text()),{status:t,data:null}}catch(i){return console.error("[supabase] GET fetch failed:",i),{status:0,data:null}}}const lm={refreshIntervalSeconds:0};let cm={...lm},dm={connectionStatus:"connecting",allRooms:{},currentSearchTerm:"",currentPlayerFilter:"all",currentSortBy:"players-desc",lastUpdatedAt:null},um={},pm=!1,mm=null,fm=null,gm=null;function hm(e){return Number.isFinite(e)?0:lm.refreshIntervalSeconds}function bm(e){dm.connectionStatus!==e&&(dm.connectionStatus=e,gm?.(e))}function ym(e){const t=Object.entries(e||{});if(0===t.length)return{};const n=dm.currentSearchTerm.trim().toLowerCase(),o=t.filter(([e,t])=>{const o=t.playersCount||0;if("all"!==dm.currentPlayerFilter){if("empty"===dm.currentPlayerFilter&&0!==o)return!1;if("low"===dm.currentPlayerFilter&&(o<1||o>2))return!1;if("medium"===dm.currentPlayerFilter&&(o<3||o>4))return!1;if("high"===dm.currentPlayerFilter&&o<5)return!1}if(!n)return!0;const r=e.toLowerCase().includes(n),i=t.userSlots?.some(e=>e.name?.toLowerCase().includes(n));return r||Boolean(i)});return o.sort(([,e],[,t])=>{switch(dm.currentSortBy){case"name":return e.id.localeCompare(t.id);case"players-asc":return(e.playersCount||0)-(t.playersCount||0);default:return(t.playersCount||0)-(e.playersCount||0)}}),o.reduce((e,[t,n])=>(e[t]=n,e),{})}async function xm(){bm("connecting");const e=await async function(e=200){const{data:t}=await sm("list-rooms",{limit:e});return t&&Array.isArray(t)?t.map(e=>({id:e.id,isPrivate:e.is_private,playersCount:e.players_count,lastUpdatedAt:e.last_updated_at,lastUpdatedByPlayerId:e.last_updated_by_player_id,...Array.isArray(e.user_slots)?{userSlots:e.user_slots.map(e=>({name:e.name,avatarUrl:e.avatar_url??null}))}:{}})):[]}(200);e&&0!==e.length?(!function(e){const t={};for(const n of e)t[n.id]=n;dm.allRooms=t,dm.lastUpdatedAt=(new Date).toISOString(),um=ym(dm.allRooms),mm?.({...um})}(e),bm("connected")):bm("retrying")}async function wm(){pm||(pm=!0,function(){const e=f.get("publicRooms:refreshInterval",lm.refreshIntervalSeconds);cm.refreshIntervalSeconds=hm(e)}(),await xm())}async function vm(){try{await xm()}catch(t){s("‚ö†Ô∏è fetchRooms failed:",t),bm("retrying"),e="Unable to refresh rooms",fm?.(e)}var e}function Cm(e){dm.currentSearchTerm=e,um=ym(dm.allRooms),mm?.({...um})}function Tm(){return{...dm}}const Sm="qpm:achievements:v1",Pm=new Set;let Am={initialized:!1,progress:new Map,definitions:[],lastSnapshot:null},km=null,Em=null,$m=null,Mm=null,Fm=null,Im=!1,Lm=!1,zm=!1,Nm=!1,qm=!1;function Bm(e,t){for(const n of t){const t=Array.isArray(n)?n:[n];let o=e,r=!0;for(const e of t){if(!o||"object"!=typeof o||!(e in o)){r=!1;break}o=o[e]}if(r){const e=Number(o);if(Number.isFinite(e))return e}}return null}async function Rm(e,t){const n=F(e);if(n)try{t(await L(n,()=>Vm()))}catch(o){s(`‚ö†Ô∏è Achievements: failed to subscribe to ${e}`,o)}}function Dm(){Am.definitions.length||(Am.definitions=[{id:"garden:seedling-50",title:"Seedling Planter I",description:"Plant 50 crops.",category:"garden",rarity:"common",visibility:"public",target:50,icon:"üå±"},{id:"garden:seedling-200",title:"Seedling Planter II",description:"Plant 200 crops.",category:"garden",rarity:"uncommon",visibility:"public",target:200,icon:"üå±"},{id:"garden:seedling-500",title:"Seedling Planter III",description:"Plant 500 crops.",category:"garden",rarity:"rare",visibility:"public",target:500,icon:"üå±"},{id:"garden:seedling-2500",title:"Seedling Planter IV",description:"Plant 2,500 crops.",category:"garden",rarity:"legendary",visibility:"public",target:2500,icon:"üå±"},{id:"garden:seedling-5000",title:"Seedling Planter V",description:"Plant 5,000 crops.",category:"garden",rarity:"mythical",visibility:"public",target:5e3,icon:"üå±"},{id:"garden:seedling-12500",title:"Seedling Planter VI",description:"Plant 12,500 crops.",category:"garden",rarity:"divine",visibility:"public",target:12500,icon:"üå±"},{id:"garden:seedling-100000",title:"Seedling Planter VII",description:"Plant 50,000 crops.",category:"garden",rarity:"celestial",visibility:"public",target:5e4,icon:"üå±",hiddenTargetUntil:"garden:seedling-12500"},{id:"garden:harvester-300",title:"Harvester I",description:"Harvest 300 crops.",category:"garden",rarity:"common",visibility:"public",target:300,icon:"üß∫"},{id:"garden:harvester-1000",title:"Harvester II",description:"Harvest 1,000 crops.",category:"garden",rarity:"uncommon",visibility:"public",target:1e3,icon:"üß∫"},{id:"garden:harvester-5000",title:"Harvester III",description:"Harvest 5,000 crops.",category:"garden",rarity:"rare",visibility:"public",target:5e3,icon:"üß∫"},{id:"garden:harvester-20000",title:"Harvester IV",description:"Harvest 20,000 crops.",category:"garden",rarity:"legendary",visibility:"public",target:2e4,icon:"üß∫"},{id:"garden:harvester-50000",title:"Harvester V",description:"Harvest 50,000 crops.",category:"garden",rarity:"mythical",visibility:"public",target:5e4,icon:"üß∫"},{id:"garden:harvester-150000",title:"Harvester VI",description:"Harvest 75,000 crops.",category:"garden",rarity:"divine",visibility:"public",target:75e3,icon:"üß∫"},{id:"garden:harvester-100000",title:"Harvester VII",description:"Harvest 100,000 crops.",category:"garden",rarity:"celestial",visibility:"public",target:1e5,icon:"üß∫",hiddenTargetUntil:"garden:harvester-150000"},{id:"garden:watering-200",title:"I wish I could buy more than 99... I",description:"Use 200 watering cans on your crops.",category:"garden",rarity:"common",visibility:"public",target:200,icon:"üíß"},{id:"garden:watering-800",title:"I wish I could buy more than 99... II",description:"Use 800 watering cans on your crops.",category:"garden",rarity:"uncommon",visibility:"public",target:800,icon:"üíß"},{id:"garden:watering-2000",title:"I wish I could buy more than 99... III",description:"Use 2,000 watering cans on your crops.",category:"garden",rarity:"rare",visibility:"public",target:2e3,icon:"üíß"},{id:"garden:watering-10000",title:"I wish I could buy more than 99... IV",description:"Use 10,000 watering cans on your crops.",category:"garden",rarity:"legendary",visibility:"public",target:1e4,icon:"üíß"},{id:"garden:watering-50000",title:"I wish I could buy more than 99... V",description:"Use 50,000 watering cans on your crops.",category:"garden",rarity:"mythical",visibility:"public",target:5e4,icon:"üíß"},{id:"garden:watering-200000",title:"I wish I could buy more than 99... VI",description:"Use 80,000 watering cans on your crops.",category:"garden",rarity:"divine",visibility:"public",target:8e4,icon:"üíß"},{id:"garden:watering-125000",title:"I wish I could buy more than 99... VII",description:"Use 125,000 watering cans.",category:"garden",rarity:"celestial",visibility:"public",target:125e3,icon:"üíß",hiddenTargetUntil:"garden:watering-200000"},{id:"pets:hatchling-10",title:"Hatchery Rookie",description:"Hatch 10 pets.",category:"pets",rarity:"common",visibility:"public",target:10,icon:"ü•ö"},{id:"pets:hatchling-100",title:"Hatchery Scout",description:"Hatch 100 pets.",category:"pets",rarity:"uncommon",visibility:"public",target:100,icon:"ü•ö"},{id:"pets:hatchling-500",title:"Hatchery Specialist",description:"Hatch 500 pets.",category:"pets",rarity:"rare",visibility:"public",target:500,icon:"ü•ö"},{id:"pets:hatchling-2000",title:"Hatchery Expert",description:"Hatch 2,000 pets.",category:"pets",rarity:"legendary",visibility:"public",target:2e3,icon:"ü•ö"},{id:"pets:hatchling-5000",title:"Hatchery Master",description:"Hatch 5,000 pets.",category:"pets",rarity:"mythical",visibility:"public",target:5e3,icon:"ü•ö"},{id:"pets:hatchling-15000",title:"Hatchery Legend",description:"Hatch 15,000 pets.",category:"pets",rarity:"divine",visibility:"public",target:15e3,icon:"ü•ö"},{id:"pets:hatchling-50000",title:"Hatchery Celestial",description:"Hatch 50,000 pets.",category:"pets",rarity:"celestial",visibility:"public",target:5e4,icon:"ü•ö",hiddenTargetUntil:"pets:hatchling-15000"},{id:"pets:gold-1",title:"Gold Digger I",description:"Hatch 1 gold pet.",category:"pets",rarity:"common",visibility:"public",target:1,icon:"üèÖ"},{id:"pets:gold-3",title:"Gold Digger II",description:"Hatch 3 gold pets.",category:"pets",rarity:"uncommon",visibility:"public",target:3,icon:"üèÖ"},{id:"pets:gold-10",title:"Gold Digger III",description:"Hatch 10 gold pets.",category:"pets",rarity:"rare",visibility:"public",target:10,icon:"üèÖ"},{id:"pets:gold-25",title:"Gold Digger IV",description:"Hatch 25 gold pets.",category:"pets",rarity:"legendary",visibility:"public",target:25,icon:"üèÖ"},{id:"pets:gold-75",title:"Gold Digger V",description:"Hatch 75 gold pets.",category:"pets",rarity:"mythical",visibility:"public",target:75,icon:"üèÖ"},{id:"pets:gold-200",title:"Gold Digger VI",description:"Hatch 200 gold pets.",category:"pets",rarity:"divine",visibility:"public",target:200,icon:"üèÖ"},{id:"pets:gold-1000",title:"Gold Digger VII",description:"Hatch 1,000 gold pets.",category:"pets",rarity:"celestial",visibility:"public",target:1e3,icon:"üèÖ",hiddenTargetUntil:"pets:gold-200"},{id:"abilities:proc-50",title:"Trigger Happy I",description:"Trigger 50 abilities.",category:"abilities",rarity:"common",visibility:"public",target:50,icon:"‚ú®"},{id:"abilities:proc-200",title:"Trigger Happy II",description:"Trigger 200 abilities.",category:"abilities",rarity:"uncommon",visibility:"public",target:200,icon:"‚ú®"},{id:"abilities:proc-1000",title:"Trigger Happy III",description:"Trigger 1,000 abilities.",category:"abilities",rarity:"rare",visibility:"public",target:1e3,icon:"‚ú®"},{id:"abilities:proc-5000",title:"Trigger Happy IV",description:"Trigger 5,000 abilities.",category:"abilities",rarity:"legendary",visibility:"public",target:5e3,icon:"‚ú®"},{id:"abilities:proc-20000",title:"Trigger Happy V",description:"Trigger 20,000 abilities.",category:"abilities",rarity:"mythical",visibility:"public",target:2e4,icon:"‚ú®"},{id:"abilities:proc-85000",title:"Trigger Happy VI",description:"Trigger 85,000 abilities.",category:"abilities",rarity:"divine",visibility:"public",target:85e3,icon:"‚ú®"},{id:"abilities:proc-150000",title:"Trigger Happy VII",description:"Trigger 150,000 abilities.",category:"abilities",rarity:"celestial",visibility:"public",target:15e4,icon:"‚ú®",hiddenTargetUntil:"abilities:proc-85000"},{id:"economy:crop-earner-1000000",title:"Filthy Rich I",description:"Earn 1,000,000 coins from crops.",category:"wealth",rarity:"common",visibility:"public",target:1e6,icon:"üåæ"},{id:"economy:crop-earner-100000000",title:"Filthy Rich II",description:"Earn 100,000,000 coins from crops.",category:"wealth",rarity:"uncommon",visibility:"public",target:1e8,icon:"üåæ"},{id:"economy:crop-earner-10000000000",title:"Filthy Rich III",description:"Earn 10,000,000,000 coins from crops.",category:"wealth",rarity:"rare",visibility:"public",target:1e10,icon:"üåæ"},{id:"economy:crop-earner-1000000000000",title:"Filthy Rich IV",description:"Earn 1,000,000,000,000 coins from crops.",category:"wealth",rarity:"legendary",visibility:"public",target:1e12,icon:"üåæ"},{id:"economy:crop-earner-5000000000000",title:"Filthy Rich V",description:"Earn 5,000,000,000,000 coins from crops.",category:"wealth",rarity:"mythical",visibility:"public",target:5e12,icon:"üåæ"},{id:"economy:crop-earner-10000000000000",title:"Filthy Rich VI",description:"Earn 10,000,000,000,000 coins from crops.",category:"wealth",rarity:"divine",visibility:"public",target:1e13,icon:"üåæ"},{id:"economy:crop-earner-150000000000000",title:"Filthy Rich VII",description:"Earn 150,000,000,000,000 coins from crops.",category:"wealth",rarity:"celestial",visibility:"public",target:15e13,icon:"üåæ",hiddenTargetUntil:"economy:crop-earner-10000000000000"},{id:"weather:fresh-frozen-50",title:"Fresh Frozen I",description:"Watch it snow 50 times.",category:"weather",rarity:"common",visibility:"public",target:50,icon:"‚ùÑÔ∏è"},{id:"weather:fresh-frozen-125",title:"Fresh Frozen II",description:"Watch it snow 125 times.",category:"weather",rarity:"uncommon",visibility:"public",target:125,icon:"‚ùÑÔ∏è"},{id:"weather:fresh-frozen-300",title:"Fresh Frozen III",description:"Watch it snow 300 times.",category:"weather",rarity:"rare",visibility:"public",target:300,icon:"‚ùÑÔ∏è"},{id:"weather:fresh-frozen-625",title:"Fresh Frozen IV",description:"Watch it snow 625 times.",category:"weather",rarity:"legendary",visibility:"public",target:625,icon:"‚ùÑÔ∏è"},{id:"weather:fresh-frozen-1250",title:"Fresh Frozen V",description:"Watch it snow 1,250 times.",category:"weather",rarity:"mythical",visibility:"public",target:1250,icon:"‚ùÑÔ∏è"},{id:"weather:fresh-frozen-2500",title:"Fresh Frozen VI",description:"Watch it snow 2,500 times.",category:"weather",rarity:"divine",visibility:"public",target:2500,icon:"‚ùÑÔ∏è"},{id:"weather:fresh-frozen-5000",title:"Fresh Frozen VII",description:"Watch it snow 5,000 times.",category:"weather",rarity:"celestial",visibility:"public",target:5e3,icon:"‚ùÑÔ∏è",hiddenTargetUntil:"weather:fresh-frozen-2500"},{id:"weather:early-bird-50",title:"Early Bird I",description:"Sit through 50 Dawn moons.",category:"weather",rarity:"common",visibility:"public",target:50,icon:"üåÖ"},{id:"weather:early-bird-125",title:"Early Bird II",description:"Sit through 125 Dawn moons.",category:"weather",rarity:"uncommon",visibility:"public",target:125,icon:"üåÖ"},{id:"weather:early-bird-300",title:"Early Bird III",description:"Sit through 300 Dawn moons.",category:"weather",rarity:"rare",visibility:"public",target:300,icon:"üåÖ"},{id:"weather:early-bird-625",title:"Early Bird IV",description:"Sit through 625 Dawn moons.",category:"weather",rarity:"legendary",visibility:"public",target:625,icon:"üåÖ"},{id:"weather:early-bird-1250",title:"Early Bird V",description:"Sit through 1,250 Dawn moons.",category:"weather",rarity:"mythical",visibility:"public",target:1250,icon:"üåÖ"},{id:"weather:early-bird-2500",title:"Early Bird VI",description:"Sit through 2,500 Dawn moons.",category:"weather",rarity:"divine",visibility:"public",target:2500,icon:"üåÖ"},{id:"weather:early-bird-5000",title:"Early Bird VII",description:"Sit through 5,000 Dawn moons.",category:"weather",rarity:"celestial",visibility:"public",target:5e3,icon:"üåÖ",hiddenTargetUntil:"weather:early-bird-2500"},{id:"weather:night-owl-50",title:"Night Owl I",description:"Sit through 50 Amber moons.",category:"weather",rarity:"common",visibility:"public",target:50,icon:"üåô"},{id:"weather:night-owl-125",title:"Night Owl II",description:"Sit through 125 Amber moons.",category:"weather",rarity:"uncommon",visibility:"public",target:125,icon:"üåô"},{id:"weather:night-owl-300",title:"Night Owl III",description:"Sit through 300 Amber moons.",category:"weather",rarity:"rare",visibility:"public",target:300,icon:"üåô"},{id:"weather:night-owl-625",title:"Night Owl IV",description:"Sit through 625 Amber moons.",category:"weather",rarity:"legendary",visibility:"public",target:625,icon:"üåô"},{id:"weather:night-owl-1250",title:"Night Owl V",description:"Sit through 1,250 Amber moons.",category:"weather",rarity:"mythical",visibility:"public",target:1250,icon:"üåô"},{id:"weather:night-owl-2500",title:"Night Owl VI",description:"Sit through 2,500 Amber moons.",category:"weather",rarity:"divine",visibility:"public",target:2500,icon:"üåô"},{id:"weather:night-owl-5000",title:"Night Owl VII",description:"Sit through 5,000 Amber moons.",category:"weather",rarity:"celestial",visibility:"public",target:5e3,icon:"üåô",hiddenTargetUntil:"weather:night-owl-2500"},{id:"pets:rainbow-1",title:"Pure Luck I",description:"Hatch 1 rainbow pet.",category:"pets",rarity:"common",visibility:"public",target:1,icon:"üåà"},{id:"pets:rainbow-2",title:"Pure Luck II",description:"Hatch 2 rainbow pets.",category:"pets",rarity:"uncommon",visibility:"public",target:2,icon:"üåà"},{id:"pets:rainbow-3",title:"Pure Luck III",description:"Hatch 3 rainbow pets.",category:"pets",rarity:"rare",visibility:"public",target:3,icon:"üåà"},{id:"pets:rainbow-6",title:"Pure Luck IV",description:"Hatch 6 rainbow pets.",category:"pets",rarity:"legendary",visibility:"public",target:6,icon:"üåà"},{id:"pets:rainbow-10",title:"Pure Luck V",description:"Hatch 10 rainbow pets.",category:"pets",rarity:"mythical",visibility:"public",target:10,icon:"üåà"},{id:"pets:rainbow-20",title:"Pure Luck VI",description:"Hatch 20 rainbow pets.",category:"pets",rarity:"divine",visibility:"public",target:20,icon:"üåà"},{id:"pets:rainbow-50",title:"Pure Luck VII",description:"Hatch 50 rainbow pets.",category:"pets",rarity:"celestial",visibility:"public",target:50,icon:"üåà",hiddenTargetUntil:"pets:rainbow-20"},{id:"garden:seed-hoarder-100",title:"Seed Hoarder I",description:"Hold 100 seeds of a single type.",category:"garden",rarity:"common",visibility:"public",target:100,icon:"üå±"},{id:"garden:seed-hoarder-500",title:"Seed Hoarder II",description:"Hold 500 seeds of a single type.",category:"garden",rarity:"uncommon",visibility:"public",target:500,icon:"üå±"},{id:"garden:seed-hoarder-1500",title:"Seed Hoarder III",description:"Hold 1,500 seeds of a single type.",category:"garden",rarity:"rare",visibility:"public",target:1500,icon:"üå±"},{id:"garden:seed-hoarder-5000",title:"Seed Hoarder IV",description:"Hold 5,000 seeds of a single type.",category:"garden",rarity:"legendary",visibility:"public",target:5e3,icon:"üå±"},{id:"garden:seed-hoarder-15000",title:"Seed Hoarder V",description:"Hold 15,000 seeds of a single type.",category:"garden",rarity:"mythical",visibility:"public",target:15e3,icon:"üå±"},{id:"garden:seed-hoarder-35000",title:"Seed Hoarder VI",description:"Hold 35,000 seeds of a single type.",category:"garden",rarity:"divine",visibility:"public",target:35e3,icon:"üå±"},{id:"garden:seed-hoarder-80000",title:"Seed Hoarder VII",description:"Hold 80,000 seeds of a single type.",category:"garden",rarity:"celestial",visibility:"public",target:8e4,icon:"üå±",hiddenTargetUntil:"garden:seed-hoarder-35000"},{id:"onetime:this-is-only-the-beginning",title:"This is just the beginning",description:"Crop Eater ate a crop.",category:"obscure",rarity:"common",visibility:"public",target:1,icon:"ü™ì",oneTime:!0},{id:"onetime:yummy-crop-eater",title:"YUMMY!",description:"Crop Eater ate a celestial crop.",category:"obscure",rarity:"rare",visibility:"public",target:1,icon:"üç¨",oneTime:!0},{id:"onetime:eating-good",title:"Eating Good :(",description:"Fed pet produce worth over 500M.",category:"pets",rarity:"legendary",visibility:"public",target:5e8,icon:"ü•ó",oneTime:!0},{id:"onetime:all-i-see-is-money",title:"All I see is Money",description:"Only gold or rainbow pets in inventory and hutch.",category:"pets",rarity:"celestial",visibility:"public",target:1,icon:"üí∞",oneTime:!0},{id:"onetime:gamblers-fallacy",title:"Gamblers Fallacy",description:"12h accumulated with 3+ Crop Size Boost pets active and no boost proc.",category:"obscure",rarity:"legendary",visibility:"public",target:1,icon:"üé≤",oneTime:!0},{id:"onetime:money-cant-buy-happiness",title:"Money can‚Äôt buy happiness",description:"Open 1,000 eggs or reach 1B crop value sold with no rainbow pets ever.",category:"wealth",rarity:"legendary",visibility:"public",target:1,icon:"üí∏",oneTime:!0},{id:"onetime:rich",title:"Rich",description:"Reach 50B coin balance.",category:"wealth",rarity:"rare",visibility:"public",target:5e10,icon:"üè¶",oneTime:!0},{id:"onetime:baller-status",title:"Baller Status",description:"Reach 1T coin balance.",category:"wealth",rarity:"mythical",visibility:"public",target:1e12,icon:"ü™ô",oneTime:!0},{id:"onetime:whos-bill-gates",title:"Who's Bill Gates?",description:"Reach 10T coin balance.",category:"wealth",rarity:"divine",visibility:"public",target:1e13,icon:"üè∞",oneTime:!0},{id:"onetime:what-is-money",title:"What is money??",description:"Reach 100T coin balance.",category:"wealth",rarity:"celestial",visibility:"public",target:1e14,icon:"üíé",oneTime:!0},{id:"onetime:what-is-grass",title:"What is Grass..",description:"Reach 1Q coin balance.",category:"wealth",rarity:"celestial",visibility:"public",target:1e15,icon:"üåæ",oneTime:!0},{id:"onetime:god-tier-research",title:"GOD-TIER RESEARCH",description:"Complete all journal sections.",category:"collection",rarity:"celestial",visibility:"public",target:1,icon:"üìö",oneTime:!0},{id:"collection:pets-3",title:"Animal Lover I",description:"Complete the pets journal.",category:"collection",rarity:"common",visibility:"public",target:3,icon:"üìî"},{id:"collection:pets-7",title:"Animal Lover II",description:"Complete the pets journal.",category:"collection",rarity:"uncommon",visibility:"public",target:7,icon:"üìî"},{id:"collection:pets-12",title:"Animal Lover III",description:"Complete the pets journal.",category:"collection",rarity:"rare",visibility:"public",target:12,icon:"üìî"},{id:"collection:pets-20",title:"Animal Lover IV",description:"Complete the pets journal.",category:"collection",rarity:"legendary",visibility:"public",target:20,icon:"üìî"},{id:"collection:pets-35",title:"Animal Lover V",description:"Complete the pets journal.",category:"collection",rarity:"mythical",visibility:"public",target:35,icon:"üìî"},{id:"collection:pets-50",title:"Animal Lover VI",description:"Complete the pets journal.",category:"collection",rarity:"divine",visibility:"public",target:50,icon:"üìî"},{id:"collection:pets-60",title:"Animal Lover VII",description:"Complete the pets journal.",category:"collection",rarity:"celestial",visibility:"public",target:60,icon:"üìî",hiddenTargetUntil:"collection:pets-50"},{id:"collection:produce-10",title:"Completionist I",description:"Complete the produce journal.",category:"collection",rarity:"common",visibility:"public",target:10,icon:"üìî"},{id:"collection:produce-25",title:"Completionist II",description:"Complete the produce journal.",category:"collection",rarity:"uncommon",visibility:"public",target:25,icon:"üìî"},{id:"collection:produce-50",title:"Completionist III",description:"Complete the produce journal.",category:"collection",rarity:"rare",visibility:"public",target:50,icon:"üìî"},{id:"collection:produce-100",title:"Completionist IV",description:"Complete the produce journal.",category:"collection",rarity:"legendary",visibility:"public",target:100,icon:"üìî"},{id:"collection:produce-250",title:"Completionist V",description:"Complete the produce journal.",category:"collection",rarity:"mythical",visibility:"public",target:250,icon:"üìî"},{id:"collection:produce-325",title:"Completionist VI",description:"Complete the produce journal.",category:"collection",rarity:"divine",visibility:"public",target:325,icon:"üìî"},{id:"collection:produce-385",title:"Completionist VII",description:"Complete the produce journal.",category:"collection",rarity:"celestial",visibility:"public",target:385,icon:"üìî",hiddenTargetUntil:"collection:produce-325"}])}function Hm(){return Dm(),[...Am.definitions]}function jm(){return new Map(Am.progress)}async function Wm(){const e=cs(),t=Xl();let n=null,o=null,r=null,i=null,a=null;const l={};let c=null,d=null;const u={},p={};let m=null;try{const e=F("myCoinsCountAtom");if(e){const t=await I(e);n="number"==typeof t?t:Number(t??NaN),Number.isFinite(n)||(n=null)}}catch(T){s("‚ö†Ô∏è Achievements: coin balance snapshot failed",T)}try{const n=F("inventoryValueAtom");if(n){const e=await I(n);Number.isFinite(e)&&(a=e)}if(null==a&&e?.shop){const t=Bm(e.shop,["inventoryValue","inventoryWorth",["inventory","value"],["inventory","worth"],["inventory","total"],["inventory","coins"],["inventory","netWorth"]]);null!=t&&(a=t)}if(null==a){const e=(e=>{let t=0,n=!1;const o=["value","worth","price","sellValue","sellPrice","coinValue",["sell","value"],["sale","value"]];for(const r of e){const e=Number(r.quantity??r.count??r.amount??r.stackSize??0);if(!Number.isFinite(e)||e<=0)continue;const i=Bm(r,o)??Bm(r.raw,o);null!=i&&i>0&&(n=!0,t+=i*e)}return n?t:null})(t);null!=e&&(a=e)}}catch(T){s("‚ö†Ô∏è Achievements: inventory value snapshot failed",T)}try{const e=e=>{let t=null;const n=e=>{const t=e?.raw??{};if([e.itemType,e.name,e.displayName,e.id,e.species,t.itemType,t.type,t.category,t.subType,t.itemCategory,t.itemSubType,t.kind].some(e=>`${e??""}`.toLowerCase().includes("seed")))return!0;const n=[t.tags,t.tagList,t.itemTags,t.labels];for(const o of n)if(Array.isArray(o)&&o.some(e=>`${e??""}`.toLowerCase().includes("seed")))return!0;return!0===t.isSeed},o=e=>{const t=e?.raw??{},n=[e.quantity,e.count,e.amount,e.stackSize,e.qty,e.owned,e.quantityOwned,t.quantity,t.count,t.amount,t.stackSize,t.qty,t.owned,t.quantityOwned];for(const o of n){const e=Number(o);if(Number.isFinite(e)&&e>0)return e}return null};for(const r of e){if(!n(r))continue;const e=o(r);!Number.isFinite(e)||e<=0||(t=null==t?e:Math.max(t,e))}return t},n=await Kl(),o=e(n?.items??[]),r=[o,e(t)].filter(e=>Number.isFinite(e));r.length&&(c=Math.max(...r))}catch(T){s("‚ö†Ô∏è Achievements: seed stack scan failed",T)}try{if(Ts().forEach(e=>{const{abilityId:t,events:n,lastPerformedAt:o}=e;u[t]=(u[t]??0)+n.length;const r=n.length?Math.max(...n.map(e=>e.performedAt)):o??null,i=p[t];p[t]=null==i?r:Math.max(i,r??0)}),0===Object.keys(u).length){const e=b?.AriesMod?.services?.PetsService;if(e&&"function"==typeof e.getAbilityLogs)try{const t=await e.getAbilityLogs();Array.isArray(t)&&t.forEach(e=>{const t=String(e?.abilityId??e?.id??"").trim(),n=Number(e?.performedAt??e?.timestamp??e?.createdAt??0);if(!t)return;if(!Number.isFinite(n)||n<=0)return;u[t]=(u[t]??0)+1;const o=p[t];p[t]=null==o?n:Math.max(o,n)})}catch(T){s("‚ö†Ô∏è Achievements: Aries ability log backfill failed",T)}}}catch(T){s("‚ö†Ô∏è Achievements: ability history scan failed",T)}try{const e=e=>{const t=(e,n)=>{if(n>4||null==e)return[];if(Array.isArray(e)){const t=e.filter(e=>e&&"object"==typeof e);if(t.length)return t}if("object"!=typeof e)return[];const o=[],r=["items","pets","inventory","entries","list","data","value"];for(const t of r){const n=e[t];Array.isArray(n)&&o.push(...n.filter(e=>e&&"object"==typeof e))}for(const i of Object.values(e))o.push(...t(i,n+1));return o};return t(e,0)},n=async t=>{const n=F(t);if(!n)return[];try{const t=await I(n);return e(t)}catch(T){return s(`‚ö†Ô∏è Achievements: failed to read ${t} for rainbow count`,T),[]}},o=async()=>{let o=[];const r=["myPetInventoryAtom","myPetHutchPetItemsAtom"];for(const e of r)o.push(...await n(e));if(!o.length)try{const t=M(/pet|hutch/i);for(const n of t)try{const t=await I(n);o.push(...e(t))}catch{}}catch{}if(!o.length)for(const e of t){const t=e?.raw??e;(String(t?.itemType??t?.type??"").toLowerCase().includes("pet")||t?.petSpecies||t?.species)&&o.push(t)}return o},r=e=>{const t=e?.raw??e??{};if([e.rarity,e.petRarity,e.rarityName,e.quality,e.variant,e.mutation,e.name,e.petVariant,t.rarity,t.petRarity,t.rarityName,t.quality,t.variant,t.mutation,t.name].some(e=>`${e??""}`.toLowerCase().includes("rainbow")))return!0;const n=[];return Array.isArray(e?.mutations)&&n.push(...e.mutations),Array.isArray(t?.mutations)&&n.push(...t.mutations),Array.isArray(t?.pet?.mutations)&&n.push(...t.pet.mutations),!!n.some(e=>`${e??""}`.toLowerCase().includes("rainbow"))||(!0===e?.isRainbow||!0===t.isRainbow)},i=(e=>{let t=0;const n=new Set;return e.forEach((e,o)=>{if(!e)return;if(!r(e))return;const i=String(e.id??e.itemId??e.petId??`${e.petSpecies??e.species??"pet"}:${o}`);n.has(i)||(n.add(i),t+=1)}),t})(await o());Number.isFinite(i)&&(d=i)}catch(T){s("‚ö†Ô∏è Achievements: rainbow ownership scan failed",T)}try{const e=vr();if(e?.length){m=e.filter(e=>e.abilities?.some(e=>"ProduceScaleBoost"===e||"ProduceScaleBoostII"===e)).length}}catch(T){s("‚ö†Ô∏è Achievements: boost pet scan failed",T)}try{const e=F("lastCurrencyTransactionAtom");e&&(o=await I(e))}catch(T){s("‚ö†Ô∏è Achievements: transaction snapshot failed",T)}let f=null,g=null,h=null,y=null,x=null,w=null;try{const e=await ra();if(e)h=Math.round(e.produce.collected),y=Math.round(e.produce.total),f=Math.round(e.produce.percentage),x=Math.round(e.petVariants.collected),w=Math.round(e.petVariants.total),g=Math.round(e.petVariants.percentage);else{const e=await na();if(e?.produce){const t=Object.values(e.produce);if(t.length){const e=t.filter(e=>100===e?.completion).length;h=e,y=t.length,f=Math.round(e/t.length*100)}}if(e?.pets){const t=Object.values(e.pets);if(t.length){const e=t.filter(e=>100===e?.completion).length;x=e,w=t.length,g=Math.round(e/t.length*100)}}}}catch(T){s("‚ö†Ô∏è Achievements: journal snapshot failed",T)}const v=t=>{if(!t||"object"!=typeof t||!e)return;const n=t.player??t,o=n.garden??n.plants??n.farm??n,a=n.pets??n,s=n.abilities??n.abilityStats??n,c=n.shop??n.shops??n.economy??n,d=n.weather??n,u=t.player;if(u&&"object"==typeof u){const t=Bm(u,["numSeedsPlanted","numPlantsPotted"]);null!=t&&t>e.garden.totalPlanted&&(e.garden.totalPlanted=t);const n=Bm(u,["numCropsHarvested"]);null!=n&&n>e.garden.totalHarvested&&(e.garden.totalHarvested=n);const o=Bm(u,["numPlantsWatered"]);null!=o&&o>e.garden.totalWateringCans&&(e.garden.totalWateringCans=o);const a=Bm(u,["numPlantsDestroyed"]);null!=a&&a>e.garden.totalDestroyed&&(e.garden.totalDestroyed=a);const s=Bm(u,["numEggsHatched"]);null!=s&&s>e.pets.totalHatched&&(e.pets.totalHatched=s);const l=Bm(u,["numRainbowPetsHatched",["rarity","rainbow"]]);null!=l&&l>e.pets.hatchedByRarity.rainbow&&(e.pets.hatchedByRarity.rainbow=l);const c=Bm(u,["totalEarningsSellCrops"]);null!=c&&(r=c);const d=Bm(u,["totalEarningsSellPet"]);null!=d&&(i=d)}const p=Bm(o,["seedsPlanted","totalPlanted","planted",["stats","planted"],"totalSeedsPlanted"]);null!=p&&p>e.garden.totalPlanted&&(e.garden.totalPlanted=p);const m=Bm(o,["cropsHarvested","totalHarvested","harvested",["stats","harvested"],"totalCropsHarvested"]);null!=m&&m>e.garden.totalHarvested&&(e.garden.totalHarvested=m);const f=Bm(o,["plantsWatered","totalWateringCans","watered",["stats","watered"],"wateringCansUsed","watercanUsed"]);null!=f&&f>e.garden.totalWateringCans&&(e.garden.totalWateringCans=f);const g=Bm(o,["plantsDestroyed","totalDestroyed","destroyed"]);null!=g&&g>e.garden.totalDestroyed&&(e.garden.totalDestroyed=g);const h=Bm(a,["eggsHatched","totalHatched","hatched","petsHatched"]);null!=h&&h>e.pets.totalHatched&&(e.pets.totalHatched=h);const b=Bm(a,["gold","hatchedGold","goldPets",["rarity","gold"]]);null!=b&&b>e.pets.hatchedByRarity.gold&&(e.pets.hatchedByRarity.gold=b);const y=a.hatchedByType;if(y&&"object"==typeof y){let t=e.pets.totalHatched,n=e.pets.hatchedByRarity.gold,o=e.pets.hatchedByRarity.rainbow;for(const e of Object.values(y)){if(!e||"object"!=typeof e)continue;const r=Number(e.normal??0),i=Number(e.gold??0),a=Number(e.rainbow??0);Number.isFinite(r)&&(t+=r),Number.isFinite(i)&&(t+=i,n+=i),Number.isFinite(a)&&(t+=a,o+=a)}t>e.pets.totalHatched&&(e.pets.totalHatched=t),n>e.pets.hatchedByRarity.gold&&(e.pets.hatchedByRarity.gold=n),o>e.pets.hatchedByRarity.rainbow&&(e.pets.hatchedByRarity.rainbow=o)}const x=(()=>{const t=Bm(s,["totalProcs","procs","abilityProcs",["stats","procs"]]);if(null!=t)return t;const n=s.triggers??s.triggerCounts??s.abilityTriggers??s;if(n&&"object"==typeof n){let t=0,o=0;for(const e of Object.values(n))if(e&&"object"==typeof e&&"triggers"in e){const n=Number(e.triggers),r=Number(e.totalValue??0);Number.isFinite(n)&&(t+=n),Number.isFinite(r)&&(o+=r)}return o>e.abilities.totalEstimatedValue&&(e.abilities.totalEstimatedValue=o),t>0?t:null}return null})();null!=x&&x>e.abilities.totalProcs&&(e.abilities.totalProcs=x);const w=Bm(c,["totalSpentCoins","coinsSpent","spentCoins","totalCoinsSpent","totalCoinsUsed","coinsUsed","spendCoins","spent",["spend","coins"],["coins","spent"]]);if(null!=w&&w>e.shop.totalSpentCoins&&(e.shop.totalSpentCoins=w),u&&"object"==typeof u){const t=Bm(u,["coinsSpent","totalCoinsSpent","totalSpentCoins"]);null!=t&&t>e.shop.totalSpentCoins&&(e.shop.totalSpentCoins=t)}const v=Bm(c,["cropEarnings","cropsEarned","coinsFromCrops","coinsEarnedFromCrops","totalCropEarnings","cropCoinsEarned",["cropsSold","coins"],["cropsSold","value"],["cropsSold","total"],"cropsSoldValue",["shop","totalSpentCoins"]]);null!=v&&null==r&&(r=v);const C=Bm(c,["petEarnings","coinsFromPets","coinsEarnedFromPets","petsSoldValue"]);if(null!=C&&null==i&&(i=C),null==r){const e=Bm(c,["cropsSoldCount"]);null!=e&&(r=e)}const T=Bm(d,["totalSwaps","swaps","weatherSwaps"]);if(null!=T&&(e.weather.totalSwaps=T),d&&"object"==typeof d&&d!==n){let t=0;for(const[e,n]of Object.entries(d))if(n&&"object"==typeof n&&"triggers"in n){const o=Number(n.triggers);Number.isFinite(o)&&(t+=o,l[e]=o)}t>e.weather.totalSwaps&&(e.weather.totalSwaps=t)}};try{const t=F("myStatsAtom");if(t&&e){const e=await I(t);if(v(e),!Im&&e&&"object"==typeof e){Im=!0;Object.keys(e),["player","garden","plants","farm","pets","abilities","abilityStats","shop","economy","weather"].reduce((t,n)=>(n in e&&(t[n]=Object.keys(e[n]||{})),t),{});if(!qm&&e.player){qm=!0;const t=e.player;Object.keys(t||{}),Object.fromEntries(Object.entries(t||{}).slice(0,5))}}}}catch(T){s("‚ö†Ô∏è Achievements: merge from live stats atom failed",T)}try{const e=await async function(){try{const e=b?.AriesMod?.services?.StatsService;return e?"function"==typeof e.getStats?await e.getStats():"function"==typeof e.getSnapshot?await e.getSnapshot():"function"==typeof e.getState?await e.getState():"object"==typeof e.stats?e.stats:null:null}catch(T){return s("‚ö†Ô∏è Achievements: Aries StatsService fetch failed",T),null}}();if(e&&(v(e),!Lm&&e&&"object"==typeof e)){Lm=!0;Object.keys(e),["garden","plants","farm","pets","abilities","abilityStats","shop","economy","weather"].reduce((t,n)=>(n in e&&(t[n]=Object.keys(e[n]||{})),t),{});if(!zm){zm=!0;const t=(e,t)=>{if(!e||"object"!=typeof e||!(t in e))return;const n=e[t];return n&&"object"==typeof n?Object.fromEntries(Object.entries(n).slice(0,5)):n};t(e,"garden"),t(e,"pets"),t(e,"abilities"),t(e,"shops"),t(e,"weather"),Nm||(Nm=!0,e.shops&&e.shops)}}}catch(T){s("‚ö†Ô∏è Achievements: Aries stats merge failed",T)}const C={stats:e,inventoryCount:t.length,inventoryValue:a,journalProduceCompletion:f,journalPetCompletion:g,journalProduceCompleted:h,journalProduceTotal:y,journalPetCompleted:x,journalPetTotal:w,coinBalance:n,lastCurrencyTransaction:o,cropEarnings:r,petEarnings:i,weatherTriggers:l,maxSeedsOfSingleType:c,rainbowHatches:(()=>{const t=e?.pets.hatchedByRarity.rainbow;return null!=d?d:t??null})(),abilityCounts:u,abilityLastProc:p,boostPetsActive:m};return e.garden.totalPlanted,e.garden.totalHarvested,e.garden.totalWateringCans,e.garden.totalDestroyed,e.pets.totalHatched,e.pets.hatchedByRarity.gold,e.abilities.totalProcs,e.abilities.totalEstimatedValue,e.weather.totalSwaps,Am.lastSnapshot=C,C}let Gm=null;const Om=800;function Vm(){null!=Gm&&clearTimeout(Gm),Gm=window.setTimeout(async()=>{Gm=null;try{Dm();const e=await Wm();!function(e,t){const n=Date.now(),o=t.abilityCounts??{},r=t.abilityLastProc??{};e.forEach(e=>{const i=Am.progress.get(e.id)??{id:e.id,current:0,target:"number"==typeof e.target?e.target:0,completedAt:null,lastUpdated:n,ineligible:!1};let a=i.current;const l="number"==typeof e.target?e.target:0,c=!!i.completedAt,d=!!e.oneTime;let u=!!i.ineligible;try{if(t.stats){const s=t.weatherTriggers??{};if(e.id.startsWith("garden:seedling-"))a=t.stats.garden.totalPlanted;else if(e.id.startsWith("garden:harvester-"))a=t.stats.garden.totalHarvested;else if(e.id.startsWith("garden:watering-"))a=t.stats.garden.totalWateringCans;else if(e.id.startsWith("pets:hatchling-"))a=t.stats.pets.totalHatched;else if(e.id.startsWith("pets:gold-"))a=t.stats.pets.hatchedByRarity.gold;else if(e.id.startsWith("pets:rainbow-"))a=t.rainbowHatches??t.stats.pets.hatchedByRarity.rainbow;else if(e.id.startsWith("abilities:proc-"))a=t.stats.abilities.totalProcs;else if(e.id.startsWith("economy:crop-earner-"))a=t.cropEarnings??i.current;else if(e.id.startsWith("weather:fresh-frozen-"))a=s.frost??0;else if(e.id.startsWith("weather:early-bird-"))a=s.dawn??0;else if(e.id.startsWith("weather:night-owl-"))a=s.ambermoon??0;else if(e.id.startsWith("collection:produce-"))a=t.journalProduceCompleted??i.current;else if(e.id.startsWith("collection:pets-"))a=t.journalPetCompleted??i.current;else if(e.id.startsWith("garden:seed-hoarder-"))a=t.maxSeedsOfSingleType??0;else if("onetime:rich"===e.id||"onetime:baller-status"===e.id||"onetime:whos-bill-gates"===e.id||"onetime:what-is-money"===e.id||"onetime:what-is-grass"===e.id)a=t.coinBalance??i.current;else if("onetime:god-tier-research"===e.id){const e=null!=t.journalProduceCompleted&&null!=t.journalProduceTotal&&t.journalProduceCompleted>=t.journalProduceTotal,n=null!=t.journalPetCompleted&&null!=t.journalPetTotal&&t.journalPetCompleted>=t.journalPetTotal;a=e&&n?l:0}else if("onetime:money-cant-buy-happiness"===e.id){const e=t.stats.pets.totalHatched,n=t.cropEarnings??0,o=e>=1e3&&n>=1e9;u=o,o&&(a=l)}else if("onetime:this-is-only-the-beginning"===e.id)a=o.ProduceEater??0,a>0&&(a=l);else if("onetime:yummy-crop-eater"===e.id)a=o.ProduceEater??0,a>0&&(a=l);else if("onetime:gamblers-fallacy"===e.id){const e=t.boostPetsActive??0,o=Math.max(r.ProduceScaleBoost??0,r.ProduceScaleBoostII??0),i=o>0?n-o:Number.POSITIVE_INFINITY;a=e>=3&&i>=432e5?l:0}else a=i.current}}catch(g){s("‚ö†Ô∏è Achievements evaluate error",g)}const p=!u&&a>=l&&l>0,m=i.completedAt||(p?n:null),f={...i,current:a,target:l,completedAt:m,lastUpdated:n,ineligible:u};Am.progress.set(e.id,f),!c&&p&&Ci({feature:"achievements",level:"success",message:`${d?"One-time achievement":"Achievement"}: ${e.title} completed!`})})}(Am.definitions,e),function(){try{const e=Array.from(Am.progress.values());f.set(Sm,{progress:e})}catch(e){s("‚ö†Ô∏è Achievements: failed to persist",e)}}(),Pm.forEach(e=>{try{e(Am.progress)}catch(t){s("‚ö†Ô∏è Achievements listener error",t)}})}catch(e){s("‚ö†Ô∏è Achievements evaluation failed",e)}},Om)}function _m(){if(!Am.initialized){Am.initialized=!0,function(){try{const e=f.get(Sm,null);if(!e||"object"!=typeof e)return;Array.isArray(e.progress)&&e.progress.forEach(e=>{if(!e||"object"!=typeof e)return;const t=String(e.id??"");if(!t)return;const n={id:t,current:Number(e.current??0),target:Number(e.target??0),completedAt:e.completedAt??null,lastUpdated:e.lastUpdated??Date.now(),ineligible:!!e.ineligible};Am.progress.set(t,n)})}catch(e){s("‚ö†Ô∏è Achievements: failed to load persisted state",e)}}(),Dm(),async function(){if(fs)return;fs=!0;const e=F("myPetSlotInfosAtom");if(!e)throw fs=!1,new Error("myPetSlotInfosAtom not available");try{gs=await L(e,e=>{try{vs(e)}catch(t){s("‚ö†Ô∏è Failed processing ability triggers",t)}})}catch(t){throw fs=!1,gs=null,t}}().catch(e=>s("‚ö†Ô∏è Achievements: ability trigger store start failed",e)),xr().catch(e=>s("‚ö†Ô∏è Achievements: pet info store start failed",e)),Vm();try{km=ls(()=>Vm())}catch(e){s("‚ö†Ô∏è Achievements: failed to subscribe to stats",e)}Rm("myStatsAtom",e=>{Mm=e}),function(){try{const e=b?.AriesMod?.services?.StatsService;if(e&&"function"==typeof e.subscribe){const t=e.subscribe(()=>Vm());"function"==typeof t&&(Fm=t)}}catch(e){s("‚ö†Ô∏è Achievements: failed to subscribe to Aries StatsService",e)}}(),Rm("newLogsAtom",e=>{Em=e}),Rm("newCropLogsFromSellingAtom",e=>{$m=e}),s("‚úÖ Achievements store initialized (phase 1 stub)")}}function Um(){Vm()}const Xm={worm:30,snail:60,bee:15,chicken:60,bunny:45,dragonfly:15,pig:60,cow:75,turkey:60,squirrel:30,turtle:90,goat:60,butterfly:30,peacock:60,capybara:60};function Km(e){if(!e)return null;const t=e.replace(/[^a-z0-9]/gi,"").toLowerCase();return Xm[t]??null}function Jm(e,t){const n=Km(e);return n?t/n:null}function Qm(e,t,n,o,r){const i=Jm(e,t);if(!i||o<=0)return null;const a=i*(60*(n*r/o));return Math.ceil(a/t)+1}const Ym=new Set(["ProduceScaleBoost","ProduceScaleBoostII","GoldGranter","RainbowGranter","ProduceMutationBoost","ProduceMutationBoostII"]);let Zm=null,ef=0;function tf(e,t){if(!Ym.has(e))return null;const n=function(){const e=Date.now();if(Zm&&e-ef<5e3)return Zm;try{Zm=Ws(),ef=e}catch(t){Zm=null,ef=0,s("Failed to build ability valuation context:",t)}return Zm}();if(!n)return null;try{return Vs(e,n,t)}catch(o){return s("Failed to resolve dynamic ability effect:",o),null}}function nf(e){const t=e.species??"",n=e.targetScale??null,o=t?Mp(t):null,r=_o(t),i=null!=r?Jm(t,r):null,a=Ko(t);let s=Fp(n,t);if(null==s&&null!=n){const e=o?Math.max(.01,o-1):1,t=Math.max(0,Math.min(1,(n-1)/e));s=Math.round(80+20*t)}let l=e.strength??null;null!=l&&null!=s&&l>s&&(l=s);const c=null!=l&&null!=s?Math.round(l/s*100):null,d=e.hungerValue??null,u=e.hungerPct??null;let p=null,m=null;if(null!=i&&null!=r){p=i/r,null!=u&&i>0&&(m=u/100*(r/i))}const f=e.xp??null,g=e.level??null,h=(e.abilities??[]).map(e=>function(e,t){const n=ks(e),o=t??100;let r=null,i=n?.name??e;const a=e.match(/I{1,3}V?$/);a&&(r={I:1,II:2,III:3,IV:4}[a[0]]??null,i=i.replace(/\s+(I{1,3}V?|[1-4])$/,""));const s=n?.baseProbability??null,l=null!=s?s*o/100:null,c=n?.rollPeriodMinutes??null;let d=null,u=null,p=null;null!=l&&null!=c&&c>0&&(d=l/100*(60/c),u=24*d,p=d>0?60/d:null);const m=n?.effectBaseValue??null,f=null!=m?m*o/100:null,g=n?.effectValuePerProc??null;let h=null,b=null;null!=g&&null!=d&&(h=g*d,b=24*h);let y=null,x=null;const w=tf(e,o);return w?(y=w.effectPerProc,x=w.detail,null!=y&&y>0&&null!=d&&null==h&&(h=y*d,b=24*h)):Ym.has(e)&&null==x&&(x="Garden context not available"),{id:e,name:n?.name??e,tier:r,baseName:i,category:n?.category??"misc",trigger:n?.trigger??"unknown",baseProbability:s,effectiveProbability:l,rollPeriodMinutes:c,procsPerHour:d,procsPerDay:u,timeBetweenProcs:p,effectLabel:n?.effectLabel??null,effectBaseValue:m,effectSuffix:n?.effectSuffix??null,effectiveValue:f,effectUnit:n?.effectUnit??null,valuePerHour:h,valuePerDay:b,gardenValuePerProc:y,gardenValueDetail:x,notes:n?.notes??null}}(e,l)),b=e.mutations??[],y=b.some(e=>e.toLowerCase().includes("gold")),x=b.some(e=>e.toLowerCase().includes("rainbow"));return{petId:e.petId,name:e.name,species:e.species,location:"active",slotIndex:e.slotIndex,currentStrength:l,maxStrength:s,targetScale:n,maxScale:o,strengthProgress:c,maturityTime:a,xp:f,level:g,xpToNextLevel:null,hungerPct:u,hungerValue:d,hungerMax:r,hungerDepletionRate:i,feedsPerHour:p,timeUntilStarving:m,mutations:b,mutationCount:b.length,hasGold:y,hasRainbow:x,abilities:h,abilityCount:h.length,position:e.position,updatedAt:e.updatedAt,raw:e.raw}}function of(e){return e>=1e9?`${(e/1e9).toFixed(2)}B coins`:e>=1e6?`${(e/1e6).toFixed(2)}M coins`:e>=1e3?`${(e/1e3).toFixed(2)}K coins`:`${e.toFixed(0)} coins`}function rf(){s("üß™ Testing Pet Data Access...\n");const e=vr();if(0!==e.length){s(`‚úÖ Found ${e.length} active pet(s)\n`),s("=".repeat(80)+"\n");for(const t of e){const e=nf(t);if(s(`\nüêæ PET: ${e.name??"Unnamed"} (${e.species??"Unknown Species"})`),s(`   ID: ${e.petId??"N/A"}`),s(`   Slot: ${e.slotIndex}`),s(""),s("üìä STRENGTH & GROWTH:"),s(`   Current Strength: ${e.currentStrength??"N/A"}`),s(`   Max Strength: ${e.maxStrength??"N/A"}`),s("   Strength Progress: "+(null!=e.strengthProgress?`${e.strengthProgress}%`:"N/A")),s(`   Target Scale: ${e.targetScale??"N/A"}`),s(`   Max Scale: ${e.maxScale??"N/A"}`),s("   Time to Mature: "+(null!=e.maturityTime?`${e.maturityTime}h`:"N/A")),s(""),s("üéì XP & LEVELING:"),s(`   XP: ${e.xp??"N/A"}`),s(`   Level: ${e.level??"N/A"}`),s(`   XP to Next Level: ${e.xpToNextLevel??"N/A"}`),s(""),s("üçñ HUNGER SYSTEM:"),s("   Hunger: "+(null!=e.hungerPct?`${e.hungerPct.toFixed(1)}%`:"N/A")),s(`   Hunger Value: ${e.hungerValue??"N/A"} / ${e.hungerMax??"N/A"}`),s("   Depletion Rate: "+(null!=e.hungerDepletionRate?`${e.hungerDepletionRate}/h`:"N/A")),s(`   Feeds Per Hour: ${null!=e.feedsPerHour?e.feedsPerHour.toFixed(2):"N/A"}`),s("   Time Until Starving: "+(null!=e.timeUntilStarving?`${e.timeUntilStarving.toFixed(1)}h`:"N/A")),s(""),s(`‚ú® MUTATIONS (${e.mutationCount}):`),e.mutations.length>0?(e.mutations.forEach(e=>s(`   ‚Ä¢ ${e}`)),s("   Gold: "+(e.hasGold?"‚úÖ":"‚ùå")),s("   Rainbow: "+(e.hasRainbow?"‚úÖ":"‚ùå"))):s("   (none)"),s(""),s(`‚ö° ABILITIES (${e.abilityCount}):`),e.abilities.length>0)for(const t of e.abilities)s(`\n   üìå ${t.name} (${t.id})`),s(`      Category: ${t.category} | Trigger: ${t.trigger}`),s(`      Tier: ${t.tier??"N/A"} | Base Name: ${t.baseName}`),s(""),s("      PROBABILITY & PROC RATES:"),s("      ‚Ä¢ Base Probability: "+(null!=t.baseProbability?`${t.baseProbability}%`:"N/A")),s("      ‚Ä¢ Effective Probability: "+(null!=t.effectiveProbability?`${t.effectiveProbability.toFixed(2)}%`:"N/A")),s("      ‚Ä¢ Roll Period: "+(null!=t.rollPeriodMinutes?`${t.rollPeriodMinutes}m`:"N/A")),s(`      ‚Ä¢ Procs Per Hour: ${null!=t.procsPerHour?t.procsPerHour.toFixed(2):"N/A"}`),s(`      ‚Ä¢ Procs Per Day: ${null!=t.procsPerDay?t.procsPerDay.toFixed(2):"N/A"}`),s("      ‚Ä¢ Avg Time Between Procs: "+(null!=t.timeBetweenProcs?`${t.timeBetweenProcs.toFixed(1)}m`:"N/A")),s(""),s("      EFFECT VALUES:"),s(`      ‚Ä¢ Label: ${t.effectLabel??"N/A"}`),s("      ‚Ä¢ Base Value: "+(null!=t.effectBaseValue?`${t.effectBaseValue}${t.effectSuffix??""}`:"N/A")),s("      ‚Ä¢ Effective Value: "+(null!=t.effectiveValue?`${t.effectiveValue.toFixed(2)}${t.effectSuffix??""}`:"N/A")),s(`      ‚Ä¢ Unit: ${t.effectUnit??"N/A"}`),s(""),null!=t.gardenValuePerProc&&(s("      üåø GARDEN VALUE:"),s(`      ‚Ä¢ Value Per Proc: ${of(t.gardenValuePerProc)}`),t.gardenValueDetail&&s(`      ‚Ä¢ Detail: ${t.gardenValueDetail}`),s("")),s("      VALUE PER TIME:"),s(`      ‚Ä¢ Value Per Hour: ${null!=t.valuePerHour?of(t.valuePerHour):"N/A"}`),s(`      ‚Ä¢ Value Per Day: ${null!=t.valuePerDay?of(t.valuePerDay):"N/A"}`),t.notes&&(s(""),s(`      üìù Notes: ${t.notes}`));else s("   (none)");s("\n"+"=".repeat(80))}s("\n‚úÖ Test complete! All pet data accessed successfully.\n"),s("üí° Available data includes:"),s("   ‚Ä¢ Basic info (name, species, ID, slot)"),s("   ‚Ä¢ Strength metrics (current, max, progress, scale)"),s("   ‚Ä¢ XP & leveling data"),s("   ‚Ä¢ Hunger system (%, value, depletion rate, feeds/hour, time until starving)"),s("   ‚Ä¢ Mutations (list, count, gold/rainbow flags)"),s("   ‚Ä¢ Detailed ability stats:"),s("     - Probability & proc rates (base, effective, per hour, per day, time between)"),s("     - Effect values (base, effective, unit, label)"),s("     - Value per time period (hour, day)"),s("     - Category, trigger, tier, notes"),s("\nüìä This data is ready for the comparison hub!")}else s("‚ùå No active pets found. Make sure pets are placed in your garden.")}function af(e,t){s(`üîç Comparing Pet Slot ${e} vs Slot ${t}...\n`);const n=vr(),o=n.find(t=>t.slotIndex===e),r=n.find(e=>e.slotIndex===t);if(!o)return void s(`‚ùå No pet found in slot ${e}`);if(!r)return void s(`‚ùå No pet found in slot ${t}`);const i=nf(o),a=nf(r),l=(e,t,n,o=!0,r="")=>{const i=null!=t?`${t}${r}`:"N/A",a=null!=n?`${n}${r}`:"N/A";let l="";"number"==typeof t&&"number"==typeof n&&(l=t>n?o?" üèÜ A":" üèÜ B":n>t?o?" üèÜ B":" üèÜ A":" ‚öñÔ∏è TIE"),s(`   ${e.padEnd(25)} | ${i.padEnd(15)} | ${a.padEnd(15)} ${l}`)};s(`${"Attribute".padEnd(25)} | ${"Pet A".padEnd(15)} | ${"Pet B".padEnd(15)}`),s("=".repeat(80)),s("\nüêæ BASIC INFO:"),l("Name",i.name,a.name,!1),l("Species",i.species,a.species,!1),l("Pet ID",i.petId,a.petId,!1),s("\nüìä STRENGTH:"),l("Current Strength",i.currentStrength,a.currentStrength,!0),l("Max Strength",i.maxStrength,a.maxStrength,!0),l("Strength Progress",i.strengthProgress,a.strengthProgress,!0,"%"),l("Target Scale",i.targetScale,a.targetScale,!0),s("\nüéì XP & LEVEL:"),l("XP",i.xp,a.xp,!0),l("Level",i.level,a.level,!0),s("\nüçñ HUNGER:"),l("Hunger %",i.hungerPct,a.hungerPct,!0,"%"),l("Depletion Rate",i.hungerDepletionRate,a.hungerDepletionRate,!1,"/h"),l("Feeds Per Hour",i.feedsPerHour,a.feedsPerHour,!1),l("Time Until Starving",i.timeUntilStarving,a.timeUntilStarving,!0,"h"),s("\n‚ú® MUTATIONS:"),l("Mutation Count",i.mutationCount,a.mutationCount,!0),l("Has Gold",i.hasGold?"Yes":"No",a.hasGold?"Yes":"No",!1),l("Has Rainbow",i.hasRainbow?"Yes":"No",a.hasRainbow?"Yes":"No",!1),s("\n‚ö° ABILITIES:"),l("Ability Count",i.abilityCount,a.abilityCount,!0);const c=new Set(i.abilities.map(e=>e.baseName)),d=new Set(a.abilities.map(e=>e.baseName)),u=[...c].filter(e=>d.has(e));if(u.length>0){s(`\nüìä SHARED ABILITIES (${u.length}):`);for(const e of u){const t=i.abilities.find(t=>t.baseName===e),n=a.abilities.find(t=>t.baseName===e);if(t&&n&&(s(`\n   ${e}:`),l("     Tier",t.tier,n.tier,!0),l("     Eff. Probability",t.effectiveProbability,n.effectiveProbability,!0,"%"),l("     Procs Per Hour",t.procsPerHour,n.procsPerHour,!0),l("     Effective Value",t.effectiveValue,n.effectiveValue,!0,t.effectSuffix??""),null!=t.gardenValuePerProc&&null!=n.gardenValuePerProc)){const e=of(t.gardenValuePerProc),o=of(n.gardenValuePerProc);let r="";r=t.gardenValuePerProc>n.gardenValuePerProc?" üèÜ A":n.gardenValuePerProc>t.gardenValuePerProc?" üèÜ B":" ‚öñÔ∏è TIE",s(`        ${"Garden Value/Proc".padEnd(25)} | ${e.padEnd(15)} | ${o.padEnd(15)} ${r}`),t.gardenValueDetail&&s(`        üí° ${t.gardenValueDetail}`)}}}s("\n"+"=".repeat(80)),s("\n‚úÖ Comparison complete!")}function sf(){s("üìö Testing Ability Definitions...\n");const e=Es();s(`‚úÖ Found ${e.length} ability definition(s)\n`),s("=".repeat(80));for(const t of e)s(`\n‚ö° ${t.name} (${t.id})`),s(`   Category: ${t.category}`),s(`   Trigger: ${t.trigger}`),null!=t.baseProbability&&s(`   Base Probability: ${t.baseProbability}%`),null!=t.rollPeriodMinutes&&s(`   Roll Period: ${t.rollPeriodMinutes} minutes`),null!=t.effectBaseValue&&s(`   Effect: ${t.effectBaseValue}${t.effectSuffix??""} ${t.effectLabel??""}`),t.notes&&s(`   Notes: ${t.notes}`);s("\n"+"=".repeat(80)),s("\n‚úÖ All ability definitions retrieved successfully!")}"undefined"!=typeof window&&(window.testPetData=rf,window.testComparePets=af,window.testAbilityDefinitions=sf,s("üß™ Pet Data Tester loaded! Available console commands:"),s("   ‚Ä¢ window.testPetData() - Get detailed stats for all active pets"),s("   ‚Ä¢ window.testComparePets(0, 1) - Compare two pets side-by-side"),s("   ‚Ä¢ window.testAbilityDefinitions() - List all ability definitions"));const lf=["qws:pets:teams:v1","MGA_petPresets","aries:teams","aries:petTeams","qws:teams","qws:petTeams","petTeams","teams"];function cf(){const e=[];return lf.forEach(t=>{try{const n=localStorage.getItem(t);if(!n)return;const o=JSON.parse(n),r=[];Array.isArray(o)?r.push(o):o&&"object"==typeof o&&Object.values(o).forEach(e=>{Array.isArray(e)&&r.push(e)}),r.forEach(t=>{t.forEach(t=>{const n=function(e){if(!e||"object"!=typeof e)return null;const t=e,n=Array.isArray(t.slots)?t.slots:Array.isArray(t.team)?t.team:[],o=[];for(let a=0;a<3;a+=1){const e=n[a];if("string"==typeof e&&e.trim())o.push(e.trim());else if("number"==typeof e&&Number.isFinite(e))o.push(String(e));else if(e&&"object"==typeof e){const t=e,n=t.id??t.petId??t.slotId;o.push("string"==typeof n&&n.trim()?n.trim():null)}else o.push(null)}const r="string"==typeof t.id&&t.id.trim()?t.id.trim():"string"==typeof t.teamId&&t.teamId.trim()?t.teamId.trim():`team-${Math.random().toString(36).slice(2,8)}`,i=t.name??t.label??t.title??r;return{id:r,name:"string"==typeof i&&i.trim()?i.trim():r,slotIds:o,source:"unknown"}}(t);n&&(n.source="localStorage",e.push(n))})})}catch(n){s("‚ö†Ô∏è AriesBridge: failed parsing team storage",n)}}),e}function df(){const e=[];e.push(...cf());const t=function(){const e=vr();return e.length?{id:"active-pets",name:"Active Pets",slotIds:e.slice(0,3).map(e=>String(e.petId??e.slotIndex??"").trim()||null),source:"activePets"}:null}();return t&&e.push(t),e}function uf(){const e={getAchievements:()=>function(){const e=Hm(),t=jm();return e.map(e=>{const n=t.get(e.id);return{id:e.id,title:e.title,description:e.description,category:e.category,rarity:e.rarity,target:"number"==typeof e.target?e.target:null,current:n?.current??0,completedAt:n?.completedAt??null,ineligible:!!n?.ineligible}})}(),getTeams:()=>df()};try{x("QPM_ARIES_BRIDGE",e),s("‚úÖ AriesBridge: exposed QPM_ARIES_BRIDGE with achievements and teams")}catch(t){s("‚ö†Ô∏è AriesBridge: failed to expose bridge",t)}}const pf={debugPets:()=>{const e=wr();return console.log("=== Active Pets Debug (v2024-11-13-DOM-STRENGTH) ==="),console.table(e.map(e=>({Slot:e.slotIndex,Name:e.name||e.species,Species:e.species,Level:e.level,Strength:e.strength,TargetScale:e.targetScale,Abilities:e.abilities.join(", "),Hunger:e.hungerPct?`${e.hungerPct.toFixed(1)}%`:"N/A"}))),console.log("Full normalized data:",e),console.log("\n=== Raw Data Inspection ==="),e.forEach((e,t)=>{if(console.log(`\nPet ${t} (${e.name}):`),console.log("Raw object:",e.raw),e.raw&&"object"==typeof e.raw){const t=e.raw;console.log("Available fields:",Object.keys(t)),t.slot&&"object"==typeof t.slot&&(console.log("slot fields:",Object.keys(t.slot)),console.log("slot.xp:",t.slot.xp)),t.pet&&"object"==typeof t.pet&&console.log("pet fields:",Object.keys(t.pet))}}),e},debugAllAtoms:()=>{try{const e=window.__qpmJotaiAtomCache__;if(!e||"function"!=typeof e.entries)return console.error("Jotai atom cache not available"),null;console.log("=== All Available Atoms ===");const t=[];for(const[o,r]of e.entries())if(r&&"object"==typeof r&&"debugLabel"in r){const n=r.debugLabel;"string"==typeof n&&t.push({label:n,hasValue:e.has(o)})}console.table(t),console.log("\n=== Pet-related Atoms ===");const n=t.filter(e=>e.label.toLowerCase().includes("pet"));return console.table(n),t}catch(e){return console.error("Failed to list atoms:",e),null}},showPetSpriteGrid:(e="pets",t=80)=>_i(e,t),showAllSpriteSheets:(e=120)=>function(e=80){const t=Di.getSheets();t.length?t.forEach(t=>_i(t,e)):s("‚ö†Ô∏è No sprite sheets recorded yet. Open your garden or hutch first.")}(e),listSpriteResources:(e="all")=>function(e="all"){return Bi("all"===e?"all":e)}(e),loadTrackedSpriteSheets:(e=8,t="all")=>Wi(e,t),spriteExtractor:Di,viewAllSprites:()=>{console.log("=== Exporting all sprite tiles ===");const e=document.createElement("div");e.style.cssText="\n      position: fixed;\n      top: 50px;\n      right: 50px;\n      background: rgba(0,0,0,0.9);\n      padding: 20px;\n      max-width: 800px;\n      max-height: 80vh;\n      overflow: auto;\n      z-index: 999999;\n      display: grid;\n      grid-template-columns: repeat(10, 1fr);\n      gap: 5px;\n    ";for(let n=0;n<60;n++){const t=Di.getTile("plants",n);if(t){const o=document.createElement("div");o.style.cssText="position: relative; text-align: center;";const r=document.createElement("div");r.textContent=`${n}`,r.style.cssText="font-size: 10px; color: #fff; background: rgba(0,0,0,0.7); padding: 2px;";const i=new Image;i.src=t.toDataURL(),i.style.cssText="width: 64px; height: 64px; image-rendering: pixelated; border: 1px solid #444;",i.title=`Tile ${n}`,o.appendChild(r),o.appendChild(i),e.appendChild(o)}}const t=document.createElement("button");t.textContent="Close",t.style.cssText="position: sticky; top: 0; left: 0; z-index: 1; grid-column: 1 / -1;",t.onclick=()=>e.remove(),e.insertBefore(t,e.firstChild),document.body.appendChild(e),console.log("Sprite viewer opened. Click tiles to see index.")},checkTargetScale:()=>{const e=wr();return console.log("=== TargetScale Analysis ==="),console.log("Checking if targetScale might be strength-related...\n"),e.forEach((e,t)=>{const n=e.targetScale??0,o=e.xp??0,r=Math.round(50*n),i=Math.round(100*(n-1)),a=Math.round(45*n+5);console.log(`Pet ${t}: ${e.name}`),console.log(`  XP: ${o}`),console.log(`  TargetScale: ${n.toFixed(6)}`),console.log(`  Possible STR (√ó50): ${r}`),console.log(`  Possible STR ((x-1)√ó100): ${i}`),console.log(`  Possible STR (√ó45+5): ${a}\n`)}),e},debugSlotInfos:()=>{try{const e=window.__qpmJotaiAtomCache__,t=window.__qpmJotaiStore__;if(!e||!t)return console.error("Jotai cache/store not available"),null;console.log("=== myPetSlotInfosAtom Data ===");let n=null;for(const[r,i]of e.entries())if(i&&"object"==typeof i&&"debugLabel"in i){if("myPetSlotInfosAtom"===i.debugLabel){n=r;break}}if(!n)return console.error("myPetSlotInfosAtom not found in cache"),null;const o=t.get(n);return console.log("Raw value:",o),Array.isArray(o)&&(console.log(`\nFound ${o.length} entries:\n`),o.forEach((e,t)=>{console.log(`Entry ${t}:`,e),e&&"object"==typeof e&&(console.log("  Fields:",Object.keys(e)),"slot"in e&&e.slot&&"object"==typeof e.slot&&console.log("  slot fields:",Object.keys(e.slot)),"pet"in e&&e.pet&&"object"==typeof e.pet&&console.log("  pet fields:",Object.keys(e.pet)),"stats"in e&&e.stats&&"object"==typeof e.stats&&(console.log("  stats fields:",Object.keys(e.stats)),console.log("  stats content:",e.stats)))})),o}catch(e){return console.error("Failed to inspect myPetSlotInfosAtom:",e),null}},debugPetInventory:()=>{try{const t=window.__qpmJotaiAtomCache__,n=window.__qpmJotaiStore__;if(!t||!n)return console.error("Jotai cache/store not available"),null;console.log("=== Pet Inventory & Hutch Atoms ===\n");const o=["myPetInventoryAtom","myPetHutchPetItemsAtom","myPrimitivePetSlotsAtom","petInfosAtom"],r={};for(const i of o){console.log(`\n--- ${i} ---`);let o=null;for(const[e,n]of t.entries())if(n&&"object"==typeof n&&"debugLabel"in n){if(n.debugLabel===i){o=e;break}}if(o)try{const e=n.get(o);if(r[i]=e,console.log("Value:",e),Array.isArray(e)&&e.length>0){const t=e[0];t&&"object"==typeof t&&(console.log("First entry fields:",Object.keys(t)),"pet"in t&&t.pet&&"object"==typeof t.pet&&(console.log("  pet fields:",Object.keys(t.pet)),console.log("  pet sample:",t.pet)),"stats"in t&&t.stats&&"object"==typeof t.stats&&(console.log("  stats fields:",Object.keys(t.stats)),console.log("  stats sample:",t.stats)),"slot"in t&&t.slot&&"object"==typeof t.slot&&console.log("  slot fields:",Object.keys(t.slot)))}}catch(e){console.error(`Error reading ${i}:`,e)}else console.log(`${i} not found`)}return r}catch(e){return console.error("Failed to inspect pet atoms:",e),null}},searchPageWindow:()=>{try{const e=window.unsafeWindow||window;console.log("=== Searching Page Window for Pet Data ===\n");const t=["myData","myPets","activePets","petData","pets","UnifiedState","gameState","quinoaData"],n={};for(const r of t)if(r in e){console.log(`\nFound: ${r}`);const t=e[r];if(console.log("Type:",typeof t),t&&"object"==typeof t&&(console.log("Keys:",Object.keys(t).slice(0,20)),n[r]=t,"pets"in t&&console.log("  ‚Üí has pets property:",t.pets),"activePets"in t&&console.log("  ‚Üí has activePets property:",t.activePets),"inventory"in t&&t.inventory)){console.log("  ‚Üí has inventory property");const e=t.inventory;if(e&&"object"==typeof e&&"items"in e){const t=e.items;if(Array.isArray(t)){console.log(`  ‚Üí inventory has ${t.length} items`);const e=t.filter(e=>e&&"object"==typeof e&&("Pet"===e.itemType||"Pet"===e.type||"petSpecies"in e||"species"in e));e.length>0&&(console.log(`  ‚Üí Found ${e.length} pet items in inventory`),console.log("  ‚Üí First pet item:",e[0]),console.log("  ‚Üí First pet fields:",Object.keys(e[0])))}}}}console.log("\n=== Searching all window properties ===");const o=Object.keys(e).filter(e=>e.toLowerCase().includes("pet")||e.toLowerCase().includes("animal")||e.toLowerCase().includes("creature"));return console.log("Pet-related keys:",o),n}catch(e){return console.error("Failed to search page window:",e),null}},inspectPetCards:()=>{try{console.log("=== Inspecting Pet Card UI Elements ===\n");const e=["[data-pet-slot]","[data-pet-id]","[data-slot-index]",".pet-card",".pet-slot",'[class*="pet"]','[class*="Pet"]'],t=[];for(const n of e){const e=document.querySelectorAll(n);e.length>0&&(console.log(`Found ${e.length} elements with selector: ${n}`),e.forEach(e=>{e instanceof HTMLElement&&!t.includes(e)&&t.push(e)}))}return console.log(`\nTotal unique pet card elements found: ${t.length}\n`),t.slice(0,10).forEach((e,t)=>{console.log(`\n--- Element ${t} ---`),console.log("Tag:",e.tagName),console.log("Classes:",e.className),console.log("Text content:",e.textContent?.substring(0,200)),console.log("Data attributes:",Object.keys(e.dataset));const n=e.textContent||"",o=n.match(/(?:level|lvl|lv)[:\s]*(\d+)/i),r=n.match(/(?:str|strength)[:\s]*(\d+)/i),i=n.match(/(?:age)[:\s]*(\d+)/i);o&&console.log("  ‚Üí Found level:",o[1]),r&&console.log("  ‚Üí Found strength:",r[1]),i&&console.log("  ‚Üí Found age:",i[1])}),t}catch(e){return console.error("Failed to inspect pet cards:",e),null}},findPetDataInDOM:()=>{try{console.log("=== Searching DOM for Pet Level/Strength Data ===\n");const e=wr().map(e=>e.name).filter(Boolean);console.log("Looking for pets:",e);const t=document.querySelectorAll("*"),n=[];for(const o of t){const t=o.textContent?.toLowerCase()||"";if(!(t.length>500)){for(const r of e)if(r&&t.includes(r.toLowerCase())){n.push({el:o,reason:`Contains pet name: ${r}`});break}/\b(age|level|lvl|lv|str|strength|max str)\b/i.test(t)&&n.push({el:o,reason:"Contains level/strength keywords"})}}return console.log(`\nFound ${n.length} potentially relevant elements\n`),n.slice(0,15).forEach(({el:e,reason:t},n)=>{console.log(`\n--- Element ${n} ---`),console.log("Reason:",t),console.log("Tag:",e.tagName),console.log("Classes:",e.className),console.log("Text (first 300 chars):",e.textContent?.substring(0,300));const o=e.textContent||"",r=o.match(/age[:\s]*(\d+)/i),i=o.match(/(?:max\s+)?str[:\s]*(\d+)/i),a=o.match(/(?:level|lvl|lv)[:\s]*(\d+)/i);r&&console.log("  ‚úì Age:",r[1]),i&&console.log("  ‚úì Strength:",i[1]),a&&console.log("  ‚úì Level:",a[1])}),n}catch(e){return console.error("Failed to search DOM:",e),null}},extractStrengthFromUI:()=>{try{console.log("=== Extracting Strength from Pet Card UI ===\n");const e=wr(),t=[],n=Array.from(document.querySelectorAll("*"));for(const o of e){const e=o.name||o.species||`Pet ${o.slotIndex}`;let r=null,i=null;for(const t of n){const e=t.textContent||"";if(e.length>100)continue;const n=e.match(/\bSTR\s+(\d+)\b/i);if(n&&n[1]){const o=parseInt(n[1],10);console.log(`Found STR ${o} in element:`,t),console.log("  Tag:",t.tagName),console.log("  Classes:",t.className),console.log("  Text:",e.trim()),console.log("  Parent:",t.parentElement?.className),r||(r=o,i=t)}}t.push({pet:e,strength:r,element:i})}return console.log("\n=== Extracted Strength Values ==="),console.table(t.map(e=>({Pet:e.pet,Strength:e.strength??"Not found"}))),t}catch(e){return console.error("Failed to extract strength from UI:",e),null}},debugLevels:()=>{try{console.log("=== Pet Level Calculation Debug ===\n");const e=wr();return e.forEach((e,t)=>{if(console.log(`\n--- Pet ${t}: ${e.name} (${e.species}) ---`),console.log(`XP: ${e.xp??"N/A"}`),console.log(`Strength: ${e.strength??"N/A"}`),console.log(`Level (Jotai): ${e.level??"null"}`),e.petId){const t=(n=e.petId,Jo.get(n)??[]);if(console.log(`XP History: ${t.length} samples`),t.length>=2){const e=t[0],n=t[t.length-1],o=n.xp-e.xp,r=(n.timestamp-e.timestamp)/1e3,i=o/r;console.log(`  First sample: ${e.xp} XP at ${new Date(e.timestamp).toLocaleTimeString()}`),console.log(`  Last sample: ${n.xp} XP at ${new Date(n.timestamp).toLocaleTimeString()}`),console.log(`  XP gained: ${o.toFixed(0)} over ${r.toFixed(0)}s`),console.log(`  XP rate: ${i.toFixed(2)} XP/sec`)}const o=Yo(e);if(console.log("\nLevel Estimate:"),console.log(`  Current Level: ${o.currentLevel??"N/A"} / ${o.maxLevel}`),console.log(`  Confidence: ${o.confidence}`),console.log(`  Total XP Needed: ${o.totalXPNeeded?.toFixed(0)??"N/A"}`),console.log(`  XP Rate: ${o.xpGainRate?.toFixed(2)??"N/A"} XP/sec`),o.totalXPNeeded&&e.xp){const t=e.xp/o.totalXPNeeded*100;console.log(`  Progress: ${t.toFixed(1)}%`)}}var n}),e}catch(e){return console.error("Failed to debug levels:",e),null}},feedPet:async e=>{console.log(`üçñ Feeding pet at index ${e}...`);const t=await Gp(e);return t.success?console.log(`‚úÖ Successfully fed ${t.petName||t.petSpecies} with ${t.foodSpecies}`):console.error(`‚ùå Failed to feed pet: ${t.error}`),t},feedPetByIds:async(e,t)=>{console.log(`üçñ Feeding pet ${e} with crop ${t}...`);const n=await async function(e,t){try{const n=vr().find(t=>t.petId===e);return Wp(e,t)?(s(`‚úÖ Fed pet ${e} with crop ${t}`),{success:!0,petName:n?.name??null,petSpecies:n?.species??null,foodSpecies:null}):{success:!1,petName:n?.name??null,petSpecies:n?.species??null,foodSpecies:null,error:"Failed to send WebSocket message"}}catch(n){return s("‚ùå Feed by IDs error",n),{success:!1,petName:null,petSpecies:null,foodSpecies:null,error:n instanceof Error?n.message:"Unknown error"}}}(e,t);return n.success?console.log("‚úÖ Successfully fed pet"):console.error(`‚ùå Failed to feed pet: ${n.error}`),n},feedAllPets:async(e=40)=>{console.log(`üçñ Feeding all pets below ${e}% hunger...`);const t=await async function(e=40,t=!1){const n=vr(),o=[];for(let r=0;r<n.length;r++){const i=n[r];if(!i)continue;const a=i.hungerPct??100;if(a>=e){s(`‚è≠Ô∏è Skipping ${i.name||i.species} - hunger ${a}% >= ${e}%`);continue}s(`üçñ Feeding ${i.name||i.species} - hunger ${a}%`);const l=await Gp(r,t);o.push(l),r<n.length-1&&await new Promise(e=>setTimeout(e,500))}return o}(e),n=t.filter(e=>e.success).length,o=t.filter(e=>!e.success).length;return console.log(`‚úÖ Fed ${n} pets, ${o} failed`),t},isInstantFeedAvailable:()=>{const e=null!==Hp();return console.log(e?"‚úÖ Instant feed is available":"‚ùå Instant feed is NOT available (RoomConnection missing)"),e},debugInventory:async()=>{try{const{getAtomByLabel:e,readAtomValue:t}=await Promise.resolve().then(()=>z);console.log("=== Inventory Debug ===\n");const n=e("userSlotsAtom");if(n){const e=await t(n);console.log("userSlotsAtom inventory:",e);const o=Array.isArray(e)?e.filter(e=>"Plant"===e.itemType||e.slots&&e.slots.length>0):[];return console.log(`\nFound ${o?.length||0} plant items:`),console.table(o?.map((e,t)=>({Index:t,Species:e.species||"N/A",Name:e.name||"N/A",ItemType:e.itemType,HasSlots:!!(e.slots&&e.slots.length>0),NumSlots:e.slots?.length||0,Keys:Object.keys(e).join(", ")}))),o&&o.length>0&&(console.log("\n=== First Plant Item (Full Structure) ==="),console.log(o[0]),o[0].slots&&(console.log("\n=== Slots Detail ==="),console.log(o[0].slots))),{userSlots:e,plantItems:o}}return console.error("‚ùå userSlotsAtom not found"),null}catch(e){return console.error("Failed to debug inventory:",e),null}},testPetData:rf,testComparePets:af,testAbilityDefinitions:sf,debugAriesIntegration:()=>{console.log("=== Aries Mod Integration Debug ===\n");const e=[{name:"window.PetsService",value:window.PetsService},{name:"window.QWS",value:window.QWS},{name:"window.QWS?.PetsService",value:window.QWS?.PetsService},{name:"unsafeWindow.PetsService",value:"undefined"!=typeof unsafeWindow?unsafeWindow.PetsService:void 0},{name:"unsafeWindow.QWS",value:"undefined"!=typeof unsafeWindow?unsafeWindow.QWS:void 0}];console.log("Checking for PetsService in various locations:\n"),e.forEach(e=>{if(void 0!==e.value){if(console.log(`‚úÖ ${e.name}:`,e.value),e.value&&"object"==typeof e.value&&(console.log("   Properties:",Object.keys(e.value)),"function"==typeof e.value.getTeams))try{const t=e.value.getTeams();console.log(`   Teams (${Array.isArray(t)?t.length:"N/A"}):`,t)}catch(t){console.log("   Error calling getTeams():",t)}}else console.log(`‚ùå ${e.name}: Not found`)}),console.log("\n=== Instructions ==="),console.log("If PetsService is not detected:"),console.log("1. Make sure Aries mod is installed and running"),console.log("2. Check that both scripts are loaded (QPM and Aries)"),console.log("3. Try reloading the page"),console.log('4. Check console for "[Aries]" prefixed logs from QPM'),console.log("\nIf you see PetsService but it's not working:"),console.log('‚Ä¢ Open Pet Hub (QPM menu) and go to "3v3 Compare" tab'),console.log('‚Ä¢ Click the "üîÑ Refresh" button in the Aries section'),console.log("‚Ä¢ Check console for detection logs")},toggleBadgePreview:async e=>{try{const{toggleBadgePreview:t}=await Promise.resolve().then(()=>Og),n=t(e);return s(`QPM badge preview ${n?"enabled":"disabled"}${void 0===e?"":` (forced ${e})`}`),n}catch(t){return console.error("Failed to toggle badge preview",t),null}},debugInventoryAtoms:async(e=["myInventoryAtom","myCropInventoryAtom","seedInventoryAtom"])=>{const t=window.__qpmJotaiAtomCache__,n=window.__qpmJotaiStore__;console.log("Atom cache present:",!!t,"Store present:",!!n);const o=[];e.forEach(e=>{const n=F(e);if(n){const r=!!t?.has?.(n);o.push({label:e,hasValue:r})}}),console.table(o);for(const i of e){const e=F(i);if(e)try{const t=await I(e);console.log(`Value for ${i}:`,t)}catch(r){console.error(`Failed reading ${i}`,r)}}return o},scanSeeds:async()=>{const e=await Kl(),t=Xl(),n=e=>{const t=e?.raw??{},n=[e.quantity,e.count,e.amount,e.stackSize,e.qty,e.owned,e.quantityOwned,t.quantity,t.count,t.amount,t.stackSize,t.qty,t.owned,t.quantityOwned];for(const o of n){const e=Number(o);if(Number.isFinite(e)&&e>0)return e}return null},o=e=>{const t=e?.raw??{};if([e.itemType,e.name,e.displayName,e.id,e.species,t.itemType,t.type,t.category,t.subType,t.itemCategory,t.itemSubType,t.kind].some(e=>`${e??""}`.toLowerCase().includes("seed")))return!0;const n=[t.tags,t.tagList,t.itemTags,t.labels];for(const o of n)if(Array.isArray(o)&&o.some(e=>`${e??""}`.toLowerCase().includes("seed")))return!0;return!0===t.isSeed},r=e=>{const t=[];let r=0;for(const i of e){if(!o(i))continue;const e=n(i);if(!Number.isFinite(e)||e<=0)continue;const a=String(i.id??i.itemId??i.species??i.name??"unknown");t.push({id:a,qty:e,name:i.displayName??i.name??null}),r=Math.max(r,e)}return t.sort((e,t)=>t.qty-e.qty),{max:r,seeds:t}},i=r(e?.items??[]),a=r(t);return console.log("Seed scan (direct atom read): max",i.max,i.seeds.slice(0,10)),console.log("Seed scan (cached store): max",a.max,a.seeds.slice(0,10)),{directScan:i,cachedScan:a}},auditRainbowPets:async()=>{const e=async e=>{const t=F(e);if(!t)return null;try{const e=await I(t);if(Array.isArray(e))return e;if(e&&Array.isArray(e.items))return e.items}catch(n){console.error(`Failed to read ${e}`,n)}return null},t=["myPetInventoryAtom","myPetHutchPetItemsAtom"],n={},o=e=>{const t=e?.raw??{};return!![e.rarity,e.petRarity,e.rarityName,e.quality,e.variant,e.mutation,e.name,e.petVariant,t.rarity,t.petRarity,t.rarityName,t.quality,t.variant,t.mutation,t.name].some(e=>`${e??""}`.toLowerCase().includes("rainbow"))||(!0===e.isRainbow||!0===t.isRainbow)};for(const r of t){const t=await e(r);if(!t)continue;const i=[];t.forEach((e,t)=>{const n=e?.raw??{};o(e)&&i.push({id:String(e.id??e.itemId??`idx-${t}`),targetScale:Number(e.targetScale??n.targetScale??null)||null,fields:[e.rarity,e.petRarity,e.rarityName,e.quality,e.variant,e.mutation,e.name,e.petVariant,n.rarity,n.petRarity,n.rarityName,n.quality,n.variant,n.mutation,n.name]})}),n[r]=i,console.log(`Rainbow hits for ${r}:`,i)}return n},openPetHub3v3:async()=>{try{const e=document.querySelector('button[data-window-id="pet-hub"]');if(e)return e.click(),setTimeout(()=>{const e=Array.from(document.querySelectorAll("button")).find(e=>e.textContent?.includes("3v3 Compare"));e?.click()},300),!0;return tl("pet-hub","üêæ Pet Hub",e=>Promise.resolve().then(()=>ab).then(({renderPetHubWindow:t})=>t(e)),"1600px","92vh"),setTimeout(()=>{const e=Array.from(document.querySelectorAll("button")).find(e=>e.textContent?.includes("3v3 Compare"));e?.click()},400),!0}catch(e){return console.error("Failed to open Pet Hub 3v3",e),!1}}};x("QPM",pf),x("QPM_DEBUG_API",pf);const mf="undefined"!=typeof unsafeWindow?unsafeWindow:window;mf.QPM_DEBUG_API=pf,mf.QPM=pf,s("‚úÖ QPM debug API registered");const ff={enabled:!1,threshold:40,pollMs:3e3,clickCooldownMs:4e3,retryDelaySeconds:15,logs:!0,ui:{preventScrollClicks:!0},inventoryLocker:{syncMode:!0},mutationReminder:{enabled:!0,showNotifications:!0,highlightPlants:!0},harvestReminder:{enabled:!1,highlightEnabled:!0,toastEnabled:!0,minSize:80,selectedMutations:{Rainbow:!0,Gold:!1,Frozen:!1,Wet:!1,Chilled:!1,Dawnlit:!1,Amberlit:!1,Amberbound:!1,Dawnbound:!1}},turtleTimer:{enabled:!0,includeBoardwalk:!1,minActiveHungerPct:2,fallbackTargetScale:1.5,focus:"latest"}};const gf=function(){try{return JSON.parse(localStorage.getItem("quinoa-pet-manager")||"{}")}catch{return{}}}(),hf={...ff,...gf,ui:{...ff.ui,...gf.ui||{}},inventoryLocker:{...ff.inventoryLocker,...gf.inventoryLocker||{}},mutationReminder:{...ff.mutationReminder,...gf.mutationReminder||{}},harvestReminder:{...ff.harvestReminder,...gf.harvestReminder||{},selectedMutations:{...ff.harvestReminder.selectedMutations,...gf.harvestReminder?.selectedMutations||{}}},turtleTimer:{...ff.turtleTimer,...gf.turtleTimer||{}}};function bf(e,t,n){return.4*e+(t<=2?30:t<=4?20:10)+("easy"===n?30:"medium"===n?20:"hard"===n?10:"very-hard"===n?5:0)}function yf(e,t,n,o,r){const i=(o-n.length)/o*100,a=function(e,t,n,o){if(0===e.length)return"easy";const r=e.map(e=>function(e,t,n,o){return"Normal"===e?"easy":"Max Weight"===e||"Max"===e?"pet"===n?"very-hard":"hard":"Rainbow"===e?"pet"===n?"very-hard":o.hasRainbowGranter?"medium":"very-hard":"Gold"===e?"pet"===n?"hard":o.hasGoldGranter?"medium":"very-hard":"Wet"===e||"Chilled"===e?"easy":"Frozen"===e?"medium":"Dawnlit"===e||"Ambershine"===e?o.hasRainbowGranter?"hard":"medium":"Amberlit"===e?o.hasRainbowGranter?"very-hard":"hard":"Dawncharged"===e?o.hasDawnbinder?"hard":"impossible":"Ambercharged"===e?o.hasMoonbinder?"hard":"impossible":"medium"}(e,0,n,o)),i=["easy","medium","hard","very-hard","impossible"];return r.reduce((e,t)=>i.indexOf(t)>i.indexOf(e)?t:e)}(n,0,t,r),s=bf(i,n.length,a),l=(c=s)>=70?"high":c>=40?"medium":"low";var c;const d=function(e,t,n,o){if(0===e.length)return"Complete!";const r=[],i=e.includes("Rainbow"),a=e.includes("Gold");if(i||a)if("produce"===n)if(o.hasRainbowGranter||o.hasGoldGranter){const e=[];i&&o.hasRainbowGranter&&e.push("Rainbow"),a&&o.hasGoldGranter&&e.push("Gold"),e.length>0?r.push(`Use ${e.join(" and/or ")} Pets`):r.push("‚ö†Ô∏è Rare without Granters")}else r.push("‚ö†Ô∏è Rare without Granters");else r.push("Hatch eggs (0.1-1%)");const s=e.includes("Wet"),l=e.includes("Chilled"),c=e.includes("Frozen");s&&r.push("Rain (~20-35min)"),l&&r.push("Snow (~20-35min)"),c&&r.push("Wet+Chilled (~30-45min)");const d=e.includes("Dawnlit")||e.includes("Ambershine"),u=e.includes("Amberlit"),p=e.includes("Dawncharged"),m=e.includes("Ambercharged");d&&r.push("‚ö†Ô∏è Log before charging! Dawn event"),u&&r.push("‚ö†Ô∏è Log before charging! Amber event"),p&&(o.hasDawnbinder?r.push("Dawnlit + Dawnbinder (25%/min)"):r.push("‚ö†Ô∏è Need Dawnbinder")),m&&(o.hasMoonbinder?r.push("Amberlit + Moonbinder (25%/min)"):r.push("‚ö†Ô∏è Need Moonbinder")),(e.includes("Max Weight")||e.includes("Max"))&&("pet"===n?r.push("‚ö†Ô∏è Hatch at lvl 70+ (rare)"):r.push("Needs Size Boost ability")),"produce"===n&&["Starweaver","Moonbinder","Dawnbinder"].includes(t)&&e.includes("Normal")&&r.unshift("üåü Log NORMAL first!");return r.join(" | ")||"Grow normally"}(n,e,t,r),u=function(e,t,n,o,r){const i=[];return n>=90?i.push(`Almost complete (${n.toFixed(0)}%)`):n>=70&&i.push(`Good progress (${n.toFixed(0)}%)`),1===r?i.push("Just 1 variant away from completion"):2===r?i.push("Only 2 variants remaining"):r<=4&&i.push(`${r} variants remaining`),"easy"===o?i.push("Quick and easy to complete"):"medium"===o?i.push("Moderate effort required"):"hard"===o?i.push("Challenging but achievable"):"very-hard"===o&&i.push("Very difficult - requires rare conditions"),i}(0,0,i,a,n.length),p=function(e,t){if(0===e.length)return"Complete";if("impossible"===t)return"Impossible without required resources";const n=function(e){switch(e){case"easy":return"20-30 minutes";case"medium":return"30-45 minutes";case"hard":return"Several hours to 1 day";case"very-hard":return"Days to weeks"}}(t);return 1===e.length?n:2===e.length?"easy"===t?"30-60 minutes":"medium"===t?"1-2 hours":"hard"===t?"1-2 days":"1-2 weeks":e.length<=4?"easy"===t?"1-2 hours":"medium"===t?"2-4 hours":"hard"===t?"2-4 days":"2-4 weeks":"easy"===t?"2-4 hours":"medium"===t?"4-8 hours":"hard"===t?"1 week":"1+ month"}(n,a);return{species:e,type:t,priority:l,missingVariants:n,completionPct:i,difficulty:a,estimatedTime:p,strategy:d,reasons:u}}async function xf(e){const t=await async function(){const e={hasRainbowGranter:!1,hasGoldGranter:!1,hasMutationBoost:!1,hasDawnbinder:!1,hasMoonbinder:!1,granterCount:0,granterStrengthAvg:0};try{let t=0;const n=vr();s(`[JOURNAL-GRANTER] Checking ${n.length} active pets`);for(const i of n){const n=i.abilities||[],o=i.strength??100,r=n.some(e=>{const t="string"==typeof e?e:e?.type||e?.abilityType||"";return t.toLowerCase().includes("rainbow")&&t.toLowerCase().includes("grant")}),a=n.some(e=>{const t="string"==typeof e?e:e?.type||e?.abilityType||"";return t.toLowerCase().includes("gold")&&t.toLowerCase().includes("grant")});r&&(s(`[JOURNAL-GRANTER] Found Rainbow Granter in active pets: ${i.species||"unknown"}`),e.hasRainbowGranter=!0,e.granterCount++,t+=o),a&&(s(`[JOURNAL-GRANTER] Found Gold Granter in active pets: ${i.species||"unknown"}`),e.hasGoldGranter=!0,e.granterCount++,t+=o),(n.includes("Crop Mutation Boost I")||n.includes("Crop Mutation Boost II"))&&(e.hasMutationBoost=!0)}const o=await Kl();if(o?.items){const t=o.items.filter(e=>"Pet"===e.itemType);s(`[JOURNAL-GRANTER] Checking ${t.length} pets in inventory`);for(const n of t){if("Pet"!==n.itemType)continue;const t=n.abilities||[],o=(n.strength,t.some(e=>{const t="string"==typeof e?e:e?.type||e?.abilityType||"";return t.toLowerCase().includes("rainbow")&&t.toLowerCase().includes("grant")})),r=t.some(e=>{const t="string"==typeof e?e:e?.type||e?.abilityType||"";return t.toLowerCase().includes("gold")&&t.toLowerCase().includes("grant")});o&&(s(`[JOURNAL-GRANTER] Found Rainbow Granter in inventory: ${n.species||"unknown"}`),e.hasRainbowGranter=!0),r&&(s(`[JOURNAL-GRANTER] Found Gold Granter in inventory: ${n.species||"unknown"}`),e.hasGoldGranter=!0),(t.includes("Crop Mutation Boost I")||t.includes("Crop Mutation Boost II"))&&(e.hasMutationBoost=!0),"Dawnbinder"===n.species&&(e.hasDawnbinder=!0),"Moonbinder"===n.species&&(e.hasMoonbinder=!0)}}const r=F("myPetHutchAtom");if(r){const t=await I(r),n=t?.pets||[];s(`[JOURNAL-GRANTER] Checking ${n.length} pets in hutch`);for(const o of n){const t=o.abilities||[],n=t.some(e=>{const t="string"==typeof e?e:e?.type||e?.abilityType||"";return t.toLowerCase().includes("rainbow")&&t.toLowerCase().includes("grant")}),r=t.some(e=>{const t="string"==typeof e?e:e?.type||e?.abilityType||"";return t.toLowerCase().includes("gold")&&t.toLowerCase().includes("grant")});n&&(s(`[JOURNAL-GRANTER] Found Rainbow Granter in hutch: ${o.species||"unknown"}`),e.hasRainbowGranter=!0),r&&(s(`[JOURNAL-GRANTER] Found Gold Granter in hutch: ${o.species||"unknown"}`),e.hasGoldGranter=!0),(t.includes("Crop Mutation Boost I")||t.includes("Crop Mutation Boost II"))&&(e.hasMutationBoost=!0)}}e.granterCount>0&&(e.granterStrengthAvg=t/e.granterCount),s(`[JOURNAL-GRANTER] Final detection results: Rainbow=${e.hasRainbowGranter}, Gold=${e.hasGoldGranter}, Granters=${e.granterCount}, MutationBoost=${e.hasMutationBoost}`)}catch(t){s("‚ùå Error detecting player resources:",t)}return e}(),n=[];for(const o of e.produce){const e=o.variants.filter(e=>!e.collected).map(e=>e.variant);if(0===e.length)continue;const r=yf(o.species,"produce",e,o.variants.length,t);n.push(r)}for(const o of e.pets){const e=o.variants.filter(e=>!e.collected).map(e=>e.variant);if(0===e.length)continue;const r=yf(o.species,"pet",e,o.variants.length,t);n.push(r)}return n}function wf(e){const t=[...e].sort((e,t)=>{const n=bf(e.completionPct,e.missingVariants.length,e.difficulty);return bf(t.completionPct,t.missingVariants.length,t.difficulty)-n}).filter(e=>"impossible"!==e.difficulty).slice(0,10),n=t.reduce((e,t)=>e+t.missingVariants.length,0),o=t.some(e=>"very-hard"===e.difficulty),r=t.some(e=>"hard"===e.difficulty);let i="1-2 weeks";return i=o?"2-4 weeks":r?"1-2 weeks":t.every(e=>"easy"===e.difficulty)?"2-3 days":"4-7 days",{steps:t,estimatedTime:i,expectedCompletion:n}}function vf(e){return e.filter(e=>e.missingVariants.length<=2&&("easy"===e.difficulty||"medium"===e.difficulty)).sort((e,t)=>e.missingVariants.length-t.missingVariants.length).slice(0,10)}function Cf(e){return e.filter(e=>"hard"===e.difficulty||"very-hard"===e.difficulty).sort((e,t)=>{const n=["easy","medium","hard","very-hard","impossible"];return n.indexOf(t.difficulty)-n.indexOf(e.difficulty)}).slice(0,10)}window.addEventListener("error",e=>{try{if(String(e?.message||"").includes("Failed to execute 'contains' on 'Node'"))return e.stopImmediatePropagation?.(),e.preventDefault?.(),!1}catch{}return!0},!0),async function(){if(s("üöÄ Quinoa Pet Manager initializing..."),Di.init(),await async function(){s("‚è≥ Waiting for game to load..."),await t,await e(100);const n=Date.now()+3e4;for(;Date.now()<n;){const t=a();if(t&&t.querySelector("canvas, button, [data-tm-main-interface], [data-tm-hud-root], [data-tm-player-id]"))return void s("‚úÖ Game UI detected");if(document.querySelector("#App canvas"))return void s("‚úÖ Game UI detected");await e(500)}s("‚ö†Ô∏è Game UI not detected within timeout, proceeding anyway")}(),"undefined"!=typeof window){("undefined"!=typeof unsafeWindow?unsafeWindow:window).inspectPetSprites=Ui,s("üñºÔ∏è inspectPetSprites() available in console")}var n;ss(),Cp(),function(){try{const e=f.get("qpm.xpTrackerProcs.v1",null);e?.procs&&Tp.splice(0,Tp.length,...e.procs);const t=f.get("qpm.xpTrackerConfig.v1",null);t?.speciesXpPerLevel&&Object.assign(Sp.speciesXpPerLevel,t.speciesXpPerLevel)}catch(e){s("‚ö†Ô∏è Failed to restore XP tracker data",e)}}(),Nl(),uc(),_m(),uf(),await Ul(),ce(),await Fn(),n={enabled:hf.harvestReminder.enabled,highlightEnabled:hf.harvestReminder.highlightEnabled,toastEnabled:hf.harvestReminder.toastEnabled,minSize:hf.harvestReminder.minSize,selectedMutations:hf.harvestReminder.selectedMutations},Co?n&&Mo(n):(Co=!0,n&&Mo(n),To=In(),Ln(e=>{To=e,vo.enabled&&zo()},!1),Io(),zo(),s("üåæ Harvest reminder ready")),pi(hf.turtleTimer),Bt(),zn||(zn=!0,s("üåø Garden mutation tracker starting..."),ot(),Rn=at(),qn=Un(Rn.kind),Nn=In(),it(e=>{const t=Rn;Rn=e;const n=Un(e.kind),o=n!==qn,r=!t||t.startedAt!==e.startedAt||t.expectedEndAt!==e.expectedEndAt||t.hash!==e.hash;o?(qn=n,Hn()):r&&"unknown"!==n&&Hn()}),Ln(e=>{Nn=e,Hn()},!0),Hn(),s("üåø Garden mutation tracker ready")),Mo({enabled:hf.harvestReminder.enabled,highlightEnabled:hf.harvestReminder.highlightEnabled,toastEnabled:hf.harvestReminder.toastEnabled,minSize:hf.harvestReminder.minSize,selectedMutations:hf.harvestReminder.selectedMutations}),mi(hf.turtleTimer),om(),Va(),wm(),$u=hf,await Lu(),console.log(`[QPM] Version ${Rd} - Updates handled by Tampermonkey`),s("‚úÖ Quinoa Pet Manager initialized successfully")}().catch(e=>{console.error("[QuinoaPetMgr] Initialization failed:",e)});const Tf=Object.freeze(Object.defineProperty({__proto__:null,generateJournalStrategy:async function(){try{const e=await oa();if(!e)return s("‚ö†Ô∏è Could not get journal summary"),null;const t=await xf(e),n={recommendedFocus:t.sort((e,t)=>{const n=bf(e.completionPct,e.missingVariants.length,e.difficulty);return bf(t.completionPct,t.missingVariants.length,t.difficulty)-n}).slice(0,10),fastestPath:wf(t),lowHangingFruit:vf(t),longTermGoals:Cf(t)};return s(`[JOURNAL] Generated strategy: ${n.recommendedFocus.length} recommendations, ${n.fastestPath.steps.length} fastest path steps`),n}catch(e){return s("‚ùå Error generating journal strategy:",e),null}},getDifficultyDescription:function(e){switch(e){case"easy":return"Easy";case"medium":return"Medium";case"hard":return"Hard";case"very-hard":return"Very Hard";case"impossible":return"Impossible"}},getDifficultyEmoji:function(e){switch(e){case"easy":return"üü¢";case"medium":return"üü°";case"hard":return"üü†";case"very-hard":return"üî¥";case"impossible":return"‚õî"}},getPriorityEmoji:function(e){switch(e){case"high":return"üî¥";case"medium":return"üü°";case"low":return"‚ö™"}}},Symbol.toStringTag,{value:"Module"}));let Sf=new Set;const Pf=Object.freeze(Object.defineProperty({__proto__:null,resetPetHatchingTracker:function(){Sf.clear(),function(){try{f.set("qpm.petHatchingTracker.knownPetIds.v1",Array.from(Sf))}catch(e){s("‚ö†Ô∏è Failed to save known pet IDs to storage",e)}}(),s("üóëÔ∏è Pet hatching tracker reset - all known pet IDs cleared")}},Symbol.toStringTag,{value:"Module"})),Af=["PetXpBoost","PetXpBoostII"];function kf(e){if(!e)return null;const t=e.match(/\((\d+)\)/);return t&&t[1]?parseInt(t[1],10):null}async function Ef(e,t,n=10){const o=await async function(e){const t=[];for(const o of e){if(!o.species||null===o.xp||null===o.strength)continue;const e=Ep(o.species);if(!e)continue;const n=Math.floor(o.xp/e),r=Math.min(30,n),i=o.strength-r,a=Math.min(i+30,100);if(o.strength>=a)continue;const s=a-o.strength,l=e-o.xp%e+e*(s-1);t.push({name:o.name||o.species,species:o.species,level:o.strength,xp:o.xp,maxStr:a,xpNeeded:l,xpPerLevel:e,source:"active"})}try{const e=F("myInventoryAtom");if(e){const n=await I(e);if(n&&Array.isArray(n.items))for(const e of n.items){const n=e.petSpecies||e.species;if("Pet"!==e.itemType||!n||null===e.xp||void 0===e.xp)continue;const o=Ep(n);if(!o)continue;let r,i;if(null!==e.strength&&void 0!==e.strength){r=e.strength;const t=Math.floor(e.xp/o),n=r-Math.min(30,t);i=Math.min(n+30,100)}else{const t=kf(e.name);if(!t||t<80||t>100)continue;i=t;const n=i-30,a=Math.floor(e.xp/o);r=n+Math.min(30,a)}if(r>=i)continue;const a=i-r,s=o-e.xp%o+o*(a-1);t.push({name:e.name||n,species:n,level:r,xp:e.xp,maxStr:i,xpNeeded:s,xpPerLevel:o,source:"inventory"})}}}catch(n){s("‚ö†Ô∏è Failed to read inventory for near max level pets:",n)}try{const e=F("myPetHutchPetItemsAtom");if(e){const n=await I(e);if(Array.isArray(n))for(const e of n){const n=e.petSpecies||e.species;if(!n||null===e.xp||void 0===e.xp)continue;const o=Ep(n);if(!o)continue;let r,i;if(null!==e.strength&&void 0!==e.strength){r=e.strength;const t=Math.floor(e.xp/o),n=r-Math.min(30,t);i=Math.min(n+30,100)}else{const t=kf(e.name);if(!t||t<80||t>100)continue;i=t;const n=i-30,a=Math.floor(e.xp/o);r=n+Math.min(30,a)}if(r>=i)continue;const a=i-r,s=o-e.xp%o+o*(a-1);t.push({name:e.name||n,species:n,level:r,xp:e.xp,maxStr:i,xpNeeded:s,xpPerLevel:o,source:"hutch"})}}}catch(n){s("‚ö†Ô∏è Failed to read hutch for near max level pets:",n)}return t}(e);return o.sort((e,t)=>e.xpNeeded-t.xpNeeded).slice(0,n)}function $f(e){const t=[];if(!e.abilities||0===e.abilities.length)return t;for(const n of e.abilities){if(!n)continue;const e=ks(n);e&&("continuous"===e.trigger&&Af.includes(e.id)&&t.push({ability:e,rawName:n}))}return t}function Mf(e,t,n=!0){const o=document.createElement("div");o.style.cssText="\n    border-bottom: 1px solid var(--qpm-border, #444);\n  ";const r=document.createElement("div");r.style.cssText="\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 10px 16px;\n    background: var(--qpm-surface-2, #222);\n    cursor: pointer;\n    user-select: none;\n  ";const i=document.createElement("div");i.textContent=e,i.style.cssText="\n    color: var(--qpm-text, #fff);\n    font-size: 13px;\n    font-weight: 600;\n  ";const a=document.createElement("span");a.textContent=n?"‚ñº":"‚ñ≤",a.style.cssText="\n    color: var(--qpm-text-muted, #aaa);\n    font-size: 10px;\n  ",r.appendChild(i),r.appendChild(a);const s=document.createElement("div");s.style.cssText=`\n    display: ${n?"block":"none"};\n    padding: 0;\n  `;const l=()=>{const e="block"===s.style.display;s.style.display=e?"none":"block",a.textContent=e?"‚ñ≤":"‚ñº"};return r.onclick=l,o.appendChild(r),o.appendChild(s),{root:o,content:s,toggle:l}}let Ff={species:new Set,sources:new Set(["active","inventory","hutch"])};async function If(e){try{const t=await Ef(e.latestPets,e.totalTeamXpPerHour,50);if(0===t.length)return void(e.nearMaxLevelContainer.innerHTML='\n        <div style="color: var(--qpm-text-muted, #aaa); font-style: italic;">\n          No pets near max level (all pets are either at max level or don\'t have enough data)\n        </div>\n      ');const n=[...new Set(t.map(e=>e.species))].sort();let o='<div style="font-weight: 600; margin-bottom: 8px; color: var(--qpm-accent, #4CAF50);">Pets Closest to Max Level:</div>';o+='<div style="margin-bottom: 12px; padding: 8px; background: rgba(255, 255, 255, 0.05); border-radius: 4px;">',o+='<div style="font-size: 11px; font-weight: 600; margin-bottom: 4px; color: var(--qpm-text-muted, #aaa);">Filter by Species:</div>',o+='<div style="display: flex; flex-wrap: wrap; gap: 6px;">';const r=0===Ff.species.size;o+=`<button\n      onclick="window.qpmNearMaxToggleSpecies('__ALL__')"\n      style="\n        padding: 4px 8px;\n        font-size: 11px;\n        background: ${r?"var(--qpm-accent, #4CAF50)":"rgba(255, 255, 255, 0.1)"};\n        color: var(--qpm-text, #fff);\n        border: 1px solid ${r?"var(--qpm-accent, #4CAF50)":"rgba(255, 255, 255, 0.2)"};\n        border-radius: 4px;\n        cursor: pointer;\n        font-weight: ${r?"600":"400"};\n      ">All</button>`;for(const e of n){const t=0===Ff.species.size||Ff.species.has(e);o+=`<button\n        onclick="window.qpmNearMaxToggleSpecies('${e}')"\n        style="\n          padding: 4px 8px;\n          font-size: 11px;\n          background: ${t?"var(--qpm-accent, #4CAF50)":"rgba(255, 255, 255, 0.1)"};\n          color: var(--qpm-text, #fff);\n          border: 1px solid ${t?"var(--qpm-accent, #4CAF50)":"rgba(255, 255, 255, 0.2)"};\n          border-radius: 4px;\n          cursor: pointer;\n          font-weight: ${t?"600":"400"};\n        ">${e}</button>`}o+="</div>",o+='<div style="font-size: 11px; font-weight: 600; margin: 8px 0 4px 0; color: var(--qpm-text-muted, #aaa);">Filter by Location:</div>',o+='<div style="display: flex; flex-wrap: wrap; gap: 6px;">';const i=[{key:"active",label:"Active",icon:"üü¢"},{key:"inventory",label:"Inventory",icon:"üì¶"},{key:"hutch",label:"Hutch",icon:"üè†"}];for(const e of i){const t=Ff.sources.has(e.key);o+=`<button\n        onclick="window.qpmNearMaxToggleSource('${e.key}')"\n        style="\n          padding: 4px 8px;\n          font-size: 11px;\n          background: ${t?"var(--qpm-accent, #4CAF50)":"rgba(255, 255, 255, 0.1)"};\n          color: var(--qpm-text, #fff);\n          border: 1px solid ${t?"var(--qpm-accent, #4CAF50)":"rgba(255, 255, 255, 0.2)"};\n          border-radius: 4px;\n          cursor: pointer;\n          font-weight: ${t?"600":"400"};\n        ">${e.icon} ${e.label}</button>`}o+="</div>",o+="</div>";const a=t.filter(e=>!(Ff.species.size>0&&!Ff.species.has(e.species))&&!!Ff.sources.has(e.source)).slice(0,10);if(0===a.length)return o+='<div style="color: var(--qpm-text-muted, #aaa); font-style: italic; margin-top: 8px;">No pets match the current filters</div>',void(e.nearMaxLevelContainer.innerHTML=o);o+=`<div style="margin-top: 8px; font-size: 10px; color: var(--qpm-text-muted, #aaa);">Showing ${a.length} of ${t.length} pets</div>`;for(const s of a){const t="active"===s.source?"üü¢":"inventory"===s.source?"üì¶":"üè†",n="active"===s.source?e.totalTeamXpPerHour:3600;let r="‚Äî";if(n>0&&s.xpNeeded>0&&s.maxStr){const e=Ip(0,s.xpNeeded,n);if(e)if(e.hours>=24){const t=Math.floor(e.hours/24);r=`${t}d ${e.hours%24}h ${e.minutes}m`}else r=`${e.hours}h ${e.minutes}m`}o+=`\n        <div style="padding: 4px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">\n          <span style="color: var(--qpm-text, #fff);">${t} ${s.name} (${s.species})</span>\n          <span style="color: var(--qpm-text-muted, #aaa); margin-left: 8px;">Lv${s.level} ‚Üí Lv${s.maxStr||"?"}</span>\n          <span style="color: var(--qpm-warning, #FF9800); margin-left: 8px;">(${r})</span>\n          <span style="color: var(--qpm-positive, #4CAF50); margin-left: 8px;">(${so(s.xp)} XP, needs ${so(s.xpNeeded)})</span>\n        </div>\n      `}e.nearMaxLevelContainer.innerHTML=o}catch(t){s("‚ö†Ô∏è Failed to update near max level display:",t),e.nearMaxLevelContainer.innerHTML='\n      <div style="color: var(--qpm-danger, #f44336);">\n        Failed to load near max level pets\n      </div>\n    '}}function Lf(e){e.petLevelTbody.innerHTML="",e.tbody.innerHTML="";const t=[];for(const a of e.latestPets){const e=$f(a);for(const{ability:n,rawName:o}of e){const e=Ap(a,n.id,o,n.baseProbability??0,n.effectValuePerProc??0);t.push(e)}}e.latestStats=t;const n=t.length>0?function(e){const t=e.reduce((e,t)=>e+t.expectedXpPerHour,0),n=e.reduce((e,t)=>e+t.expectedProcsPerHour,0),o=100*(1-e.map(e=>e.actualChancePerSecond/100).reduce((e,t)=>e*(1-t),1)),r=60*o,i=e.map(e=>e.lastProcAt).filter(e=>null!==e);return{totalXpPerHour:t,totalProcsPerHour:n,combinedChancePerSecond:o,combinedChancePerMinute:r,lastProcAt:i.length>0?Math.max(...i):null,totalProcCount:e.reduce((e,t)=>e+t.procCount,0)}}(t):null,o=n?n.totalXpPerHour:0;if(e.totalTeamXpPerHour=3600+o,0===t.length)e.tbody.innerHTML='\n      <div style="color: var(--qpm-warning, #FF9800); font-style: italic;">\n        ‚ö†Ô∏è No pets with XP Boost abilities detected. Equip pets with XP Boost I or XP Boost II to generate team-wide XP.\n      </div>\n      <div style="margin-top: 8px; color: var(--qpm-text-muted, #aaa); font-size: 11px;">\n        Each active pet still receives 3,600 XP/hour base (1 XP/second).\n      </div>\n    ';else{const r=t.map(e=>`${e.petName} (${e.abilityName}, ${e.actualChancePerMinute.toFixed(2)}%/min)`).join(", ");e.tbody.innerHTML=`\n      <div style="margin-bottom: 12px; padding: 10px; background: var(--qpm-surface-2, #1a1a1a); border-left: 3px solid var(--qpm-accent, #4CAF50); border-radius: 4px;">\n        <div style="font-size: 12px; font-weight: 600; margin-bottom: 6px; color: var(--qpm-accent, #4CAF50);">XP Rate Per Pet (Each Active Pet Receives):</div>\n        <div style="margin-left: 8px; font-size: 11px; color: var(--qpm-text, #fff); line-height: 1.6;">\n          ‚Ä¢ Base: <span style="color: var(--qpm-warning, #FF9800); font-weight: 600; font-family: monospace;">3,600 XP/hr</span> <span style="color: var(--qpm-text-muted, #aaa);">(1 XP/second, always)</span><br/>\n          ‚Ä¢ Ability Bonus: <span style="color: var(--qpm-warning, #FF9800); font-weight: 600; font-family: monospace;">+${so(o)} XP/hr</span> <span style="color: var(--qpm-text-muted, #aaa);">(shared by all pets)</span><br/>\n          ‚Ä¢ <strong style="color: var(--qpm-accent, #4CAF50);">Total: ${so(e.totalTeamXpPerHour)} XP/hr per pet</strong>\n        </div>\n      </div>\n      <div style="margin-bottom: 8px;">\n        <strong style="color: var(--qpm-accent, #4CAF50);">Combined Chance:</strong>\n        <span style="color: var(--qpm-accent, #4CAF50); font-weight: 600; font-family: monospace;">${n.combinedChancePerMinute.toFixed(2)}%/min</span>\n        <span style="color: var(--qpm-text-muted, #aaa); font-size: 11px; margin-left: 8px;">(~${n.totalProcsPerHour.toFixed(1)} procs/hr)</span>\n      </div>\n      <div style="margin-bottom: 6px; color: var(--qpm-text-muted, #aaa); font-size: 11px; font-style: italic;">\n        Note: Each ability rolls independently every second. When an XP Boost procs, all active pets receive the XP.\n      </div>\n      <div>\n        <strong style="color: var(--qpm-accent, #4CAF50);">XP Boost Pets:</strong>\n        <span style="color: var(--qpm-text, #fff);">${r}</span>\n      </div>\n    `}0===t.length?e.summaryText.textContent="‚ö†Ô∏è No pets with XP Boost abilities detected. Each pet receives 3,600 XP/hr base only.":e.summaryText.innerHTML=`\n      <strong>Each Pet Receives:</strong> ${so(e.totalTeamXpPerHour)} XP/hr (${so(3600)} base + ${so(o)} ability bonus) ‚Ä¢\n      <strong>Active Pets:</strong> ${e.latestPets.length} (${t.length} with XP Boost)\n    `;for(const a of e.latestPets)zf(e.petLevelTbody,a,e.totalTeamXpPerHour);const r=new Set;for(const a of e.latestPets)a.species&&r.add(a.species);const i={...Sp.speciesXpPerLevel};for(const a of Object.keys(i))r.add(a);e.lastKnownSpecies=r,If(e)}function zf(e,t,n){const o=e.insertRow();o.style.cssText="border-bottom: 1px solid var(--qpm-border, #444);";const r=o.insertCell(),i=t.species&&t.targetScale?Fp(t.targetScale,t.species):null,a=t.name||t.species||"Unknown";i?r.innerHTML=`\n      <div style="font-weight: 500; color: var(--qpm-text, #fff);">${a}</div>\n      <div style="font-size: 10px; color: var(--qpm-text-muted, #888); margin-top: 2px;">MAX STR ${i}</div>\n    `:r.textContent=a,r.style.cssText="\n    padding: 10px 12px;\n    color: var(--qpm-text, #fff);\n  ",r.title=`Slot: ${t.slotIndex}\nPet ID: ${t.petId||"N/A"}\nStrength: ${t.strength??"N/A"}${i?`\nMAX STR: ${i}`:""}${t.targetScale?`\nTarget Scale: ${t.targetScale.toFixed(2)}`:""}`;const s=o.insertCell();s.textContent=t.species||"‚Äî",s.style.cssText="\n    padding: 10px 12px;\n    color: var(--qpm-text-muted, #aaa);\n  ";const l=o.insertCell(),c=$f(t);if(c.length>0){const e=c.map(e=>e.rawName).join(", ");l.textContent=e,l.style.cssText="\n      padding: 10px 12px;\n      color: var(--qpm-accent, #4CAF50);\n      font-size: 11px;\n    ",l.title="This pet generates XP for the team"}else l.textContent="‚Äî",l.style.cssText="\n      padding: 10px 12px;\n      color: var(--qpm-text-muted, #666);\n      font-size: 11px;\n    ";const d=o.insertCell();null!==t.strength&&void 0!==t.strength?(d.textContent=String(t.strength),d.style.cssText="\n      padding: 10px 12px;\n      text-align: right;\n      color: var(--qpm-accent, #4CAF50);\n      font-family: monospace;\n      font-weight: 600;\n    ",d.title=`Current Strength: ${t.strength}\n(Strength increases by 1 each time XP threshold is reached)`):(d.textContent="‚ö†Ô∏è ‚Äî",d.style.cssText="\n      padding: 10px 12px;\n      text-align: right;\n      color: var(--qpm-warning, #FF9800);\n      font-family: monospace;\n      font-weight: 600;\n    ",d.title="Strength data not available");const u=o.insertCell();u.textContent=null!==t.xp?so(t.xp):"‚Äî",u.style.cssText="\n    padding: 10px 12px;\n    text-align: right;\n    color: var(--qpm-warning, #FF9800);\n    font-family: monospace;\n  ";const p=o.insertCell();if(p.style.cssText="\n    padding: 10px 12px;\n    text-align: right;\n    color: var(--qpm-text, #fff);\n    min-width: 200px;\n  ",t.species&&null!==t.xp&&null!==t.strength){const e=Ep(t.species);if(e){const n=Math.floor(t.xp/e),o=Math.min(30,n),r=t.strength-o,i=Math.min(r+30,100),a=t.xp%e,s=a/e*100;t.strength>=i?(p.innerHTML=`\n          <div style="color: var(--qpm-accent, #4CAF50); font-weight: 600; font-size: 12px;">üåü MAX STR ${i}</div>\n          <div style="font-size: 10px; color: var(--qpm-text-muted, #aaa); margin-top: 2px;">No further STR gains</div>\n        `,p.title=`Pet is at MAX Strength (${i})\nTotal XP: ${so(t.xp)}\nLevels gained from hatch: ${n}${t.targetScale?`\nTarget Scale: ${t.targetScale.toFixed(2)}`:""}`):(p.innerHTML=`\n          <div style="font-size: 11px; margin-bottom: 4px;">${so(a)} / ${so(e)} (${Math.min(100,s).toFixed(1)}%)</div>\n          <div style="width: 100%; height: 8px; background: #333; border-radius: 4px; overflow: hidden;">\n            <div style="width: ${Math.min(100,s).toFixed(1)}%; height: 100%; background: linear-gradient(90deg, #4CAF50, #8BC34A);"></div>\n          </div>\n        `,p.title=`Total XP: ${so(t.xp)}\nLevels gained from hatch: ${n}${i?`\nMAX STR: ${i}`:""}${t.targetScale?`\nTarget Scale: ${t.targetScale.toFixed(2)}`:""}`)}else p.innerHTML='<span style="color: var(--qpm-text-muted, #aaa); font-size: 11px;">Configure XP/level</span>'}else p.textContent="‚Äî";const m=o.insertCell();if(m.style.cssText="\n    padding: 10px 12px;\n    text-align: right;\n    color: var(--qpm-text, #fff);\n    font-family: monospace;\n    font-weight: 500;\n  ",t.species&&null!==t.xp&&null!==t.strength){const e=Ep(t.species),o=Uo(t.species);if(e){const r=Math.floor(t.xp/e),i=Math.min(30,r),a=t.strength-i,s=Math.min(a+30,100);if(t.strength>=s)m.innerHTML='<span style="color: var(--qpm-accent, #4CAF50); font-weight: 600;">‚Äî</span>',m.title="Pet is at MAX Strength - no further STR gains possible";else if(n>0){const r=t.xp%e,i=Ip(r,e,n),a=function(e,t,n,o){return Qm(e,t,n,o,1)}(t.species,o,e,n),s=a&&a>0?`üçñ ${a}`:"";i?(m.innerHTML=`\n            <div style="color: var(--qpm-positive, #4CAF50);">${i.hours}h ${i.minutes}m</div>\n            <div style="font-size: 10px; color: var(--qpm-text-muted, #aaa); margin-top: 2px;">${so(n)} XP/hr</div>\n            ${s?`<div style="font-size: 10px; color: var(--qpm-warning, #FF9800); margin-top: 2px;">${s}</div>`:""}\n          `,m.title=`This pet receives ${so(n)} XP/hr\n(3,600 base + ability bonus shared by all pets)${s?`\n~${a} feeds per level`:""}`):r>=e?m.innerHTML='<span style="color: var(--qpm-accent, #4CAF50); font-weight: 600;">Ready!</span>':m.textContent="‚Äî"}else 0===n?m.innerHTML='<span style="color: var(--qpm-text-muted, #aaa); font-size: 11px;">No XP boost</span>':m.textContent="‚Äî"}else m.innerHTML='<span style="color: var(--qpm-text-muted, #aaa); font-size: 11px;">‚Äî</span>'}else m.textContent="‚Äî";const f=o.insertCell();if(f.style.cssText="\n    padding: 10px 12px;\n    text-align: right;\n    color: var(--qpm-text, #fff);\n    font-family: monospace;\n    font-weight: 500;\n  ",t.species&&null!==t.xp&&null!==t.strength){const e=Ep(t.species);if(e){const o=Math.floor(t.xp/e),r=Math.min(30,o),i=t.strength-r,a=Math.min(i+30,100);if(t.strength>=a)f.innerHTML='<span style="color: var(--qpm-accent, #4CAF50); font-weight: 600;">‚Äî</span>',f.title="Pet is already at MAX Strength";else if(n>0){const o=a-t.strength,r=e-t.xp%e+e*(o-1),i=r/n,s=Math.floor(i/24),l=Math.floor(i%24),c=Math.floor(i%1*60);let d="";d=s>0?`${s}d ${l}h`:l>0?`${l}h ${c}m`:`${c}m`;const u=Uo(t.species),p=u?Qm(t.species,u,e,n,o):null,m=p&&p>0?`üçñ ${p}`:"";f.innerHTML=`\n          <div style="color: var(--qpm-warning, #FF9800); font-weight: 600;">${d}</div>\n          <div style="font-size: 10px; color: var(--qpm-text-muted, #aaa); margin-top: 2px;">${o} STR left</div>\n          ${m?`<div style="font-size: 10px; color: var(--qpm-warning, #FF9800); margin-top: 2px;">${m}</div>`:""}\n        `,f.title=`${o} STR levels remaining\n${so(r)} XP needed\nThis pet receives ${so(n)} XP/hr\n(3,600 base + ability bonus)${m?`\n~${p} total feeds to max`:""}`}else 0===n?f.innerHTML='<span style="color: var(--qpm-text-muted, #aaa); font-size: 11px;">No XP boost</span>':(f.innerHTML='<span style="color: var(--qpm-text-muted, #aaa); font-size: 11px;">‚Äî</span>',f.title="Max STR unknown")}else f.innerHTML='<span style="color: var(--qpm-text-muted, #aaa); font-size: 11px;">‚Äî</span>'}else f.textContent="‚Äî"}function Nf(e){const t=e.getBoundingClientRect(),n=window.innerWidth,o=window.innerHeight;let r=parseFloat(e.style.top)||t.top,i=parseFloat(e.style.left)||t.left,a=parseFloat(e.style.right);isNaN(a)||""===e.style.right||(i=n-t.right,e.style.right="");const s=Math.max(8,n-t.width-8),l=Math.max(8,o-t.height-8);i=Math.min(Math.max(i,8),s),r=Math.min(Math.max(r,8),l),e.style.left=`${i}px`,e.style.top=`${r}px`}let qf=null;const Bf=Object.freeze(Object.defineProperty({__proto__:null,createXpTrackerWindow:function(){const e=document.createElement("div");e.style.cssText="\n    position: fixed;\n    top: 80px;\n    right: 20px;\n    width: 850px;\n    max-height: 80vh;\n    overflow-y: auto;\n    background: var(--qpm-background, rgba(0, 0, 0, 0.92));\n    border: 2px solid var(--qpm-border, #555);\n    border-radius: 8px;\n    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);\n    z-index: 10002;\n    font-family: Arial, sans-serif;\n    display: none;\n  ";const t=document.createElement("div");t.style.cssText="\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 12px 16px;\n    background: var(--qpm-surface-1, #1a1a1a);\n    border-bottom: 2px solid var(--qpm-border, #555);\n    cursor: move;\n  ";const n=document.createElement("h3");n.textContent="‚ú® XP Tracker",n.style.cssText="\n    margin: 0;\n    color: var(--qpm-text, #fff);\n    font-size: 16px;\n    font-weight: 600;\n  ";const o=document.createElement("button");o.textContent="‚úï",o.style.cssText="\n    background: transparent;\n    border: none;\n    color: var(--qpm-text, #fff);\n    font-size: 20px;\n    cursor: pointer;\n    padding: 0 8px;\n    line-height: 1;\n  ",o.onclick=()=>{e.style.display="none"},t.appendChild(n),t.appendChild(o),e.appendChild(t);const r=document.createElement("div");r.style.cssText="\n    padding: 12px 16px;\n    background: var(--qpm-surface-1, #1a1a1a);\n    border-bottom: 1px solid var(--qpm-border, #444);\n  ";const i=document.createElement("div");i.style.cssText="\n    color: var(--qpm-text, #fff);\n    font-size: 13px;\n    line-height: 1.6;\n  ",i.textContent="Loading XP data...",r.appendChild(i),e.appendChild(r);const a=Mf("üêæ All Active Pets"),s=function(){const e=document.createElement("table");e.style.cssText="\n    width: 100%;\n    border-collapse: collapse;\n    font-size: 12px;\n  ";const t=document.createElement("thead");t.innerHTML='\n    <tr style="background: var(--qpm-surface-2, #222); border-bottom: 2px solid var(--qpm-border, #555);">\n      <th style="padding: 10px 12px; text-align: left; color: var(--qpm-text, #fff); font-weight: 600;">Pet</th>\n      <th style="padding: 10px 12px; text-align: left; color: var(--qpm-text, #fff); font-weight: 600;">Species</th>\n      <th style="padding: 10px 12px; text-align: left; color: var(--qpm-text, #fff); font-weight: 600;">XP Ability</th>\n      <th style="padding: 10px 12px; text-align: right; color: var(--qpm-text, #fff); font-weight: 600;">Strength</th>\n      <th style="padding: 10px 12px; text-align: right; color: var(--qpm-text, #fff); font-weight: 600;">Current XP</th>\n      <th style="padding: 10px 12px; text-align: right; color: var(--qpm-text, #fff); font-weight: 600;">Progress to Next STR</th>\n      <th style="padding: 10px 12px; text-align: right; color: var(--qpm-text, #fff); font-weight: 600;">Time to Next STR</th>\n      <th style="padding: 10px 12px; text-align: right; color: var(--qpm-text, #fff); font-weight: 600;">Time to Max STR</th>\n    </tr>\n  ';const n=document.createElement("tbody");return e.appendChild(t),e.appendChild(n),e}(),l=s.querySelector("tbody");a.content.appendChild(s),e.appendChild(a.root);const c=Mf("‚ú® XP Generation Summary"),d=document.createElement("div");d.style.cssText="\n    padding: 12px 16px;\n    color: var(--qpm-text, #fff);\n    font-size: 12px;\n    line-height: 1.6;\n  ",c.content.appendChild(d),e.appendChild(c.root);const u=Mf("üèÜ Near Max Level","near-max-level-section",!1),p=document.createElement("div");p.style.cssText="\n    padding: 12px 16px;\n    color: var(--qpm-text, #fff);\n    font-size: 12px;\n    line-height: 1.8;\n    font-family: monospace;\n  ",p.textContent="Loading...",u.content.appendChild(p),e.appendChild(u.root);const m=d,f=document.createElement("tbody");document.body.appendChild(e),function(e,t){let n=0,o=0,r=0,i=0;function a(e){e.preventDefault(),r=e.clientX,i=e.clientY,document.onmouseup=l,document.onmousemove=s}function s(t){t.preventDefault(),n=r-t.clientX,o=i-t.clientY,r=t.clientX,i=t.clientY,e.style.top=e.offsetTop-o+"px",e.style.left=e.offsetLeft-n+"px"}function l(){document.onmouseup=null,document.onmousemove=null,Nf(e)}t.onmousedown=a}(e,t);const g={root:e,summaryText:i,petLevelTbody:l,tbody:m,combinedTbody:f,nearMaxLevelContainer:p,updateInterval:null,latestPets:[],latestStats:[],totalTeamXpPerHour:0,lastKnownSpecies:new Set,unsubscribePets:null,unsubscribeXpTracker:null,resizeListener:null},h=()=>{"none"!==e.style.display&&Nf(e)};var b;return window.addEventListener("resize",h),g.resizeListener=h,g.unsubscribePets=Cr(e=>{g.latestPets=e,Lf(g)}),g.unsubscribeXpTracker=(b=()=>{!function(e){e.petLevelTbody.innerHTML="";for(const t of e.latestPets)zf(e.petLevelTbody,t,e.totalTeamXpPerHour)}(g)},Pp.push(b),()=>{Pp=Pp.filter(e=>e!==b)}),g.updateInterval=window.setInterval(()=>{!function(e){const t=e.root.querySelectorAll(".eta-countdown");t.forEach(e=>{const t=parseInt(e.dataset.lastProc??"0",10),n=parseFloat(e.dataset.effectiveRate??"0");if(!n||n<=0)return;const o=ml(t,60/n,n);e.textContent=o.text,e.style.color=o.isOverdue?"var(--qpm-danger, #f44336)":e.classList.contains("combined")?"var(--qpm-accent, #4CAF50)":"var(--qpm-positive, #4CAF50)"})}(g)},1e3),g},hideXpTrackerWindow:function(e){e.root.style.display="none"},setGlobalXpTrackerState:function(e){qf=e,window.qpmNearMaxToggleSpecies=e=>{qf?(alert(`[QPM DEBUG] Filter button clicked!\nSpecies: ${e}\nCurrent filters: ${Array.from(Ff.species).join(", ")||"ALL"}`),"__ALL__"===e?Ff.species.clear():Ff.species.has(e)?Ff.species.delete(e):(Ff.species.size,Ff.species.add(e)),If(qf)):alert("[QPM DEBUG] globalXpTrackerState not set! Window not initialized properly.")},window.qpmNearMaxToggleSource=e=>{qf?(alert(`[QPM DEBUG] Location filter clicked!\nSource: ${e}\nCurrent filters: ${Array.from(Ff.sources).join(", ")}`),Ff.sources.has(e)?Ff.sources.delete(e):Ff.sources.add(e),If(qf)):alert("[QPM DEBUG] globalXpTrackerState not set! Window not initialized properly.")}},showXpTrackerWindow:function(e){e.root.style.display="block",Lf(e)}},Symbol.toStringTag,{value:"Module"})),Rf={weather:["Rain","Snow","Frost"],eggs:["Uncommon Eggs","Rare Eggs","Mythical Eggs","Legendary Eggs"],crops:["Carrot","Strawberry","Aloe","Delphinium","Blueberry","Apple","Tulip","Tomato","Corn","Camellia","Squash","Mushroom","Banana","Grape","Coconut","Lychee","Bamboo"],seeds:["Carrot","Strawberry","Aloe","Delphinium","Blueberry","Apple","Tulip","Tomato","Daffodil","Corn","Watermelon","Pumpkin","Echeveria","Coconut","Banana","Lily","Camellia","Squash","Burro's Tail","Mushroom","Cactus","Bamboo","Chrysanthemum","Grape","Pepper","Lemon","Passion Fruit","Dragon Fruit","Lychee","Sunflower","Starweaver","Dawnbinder","Moonbinder"]};function Df(e){return Rf.weather.includes(e)?"weather":Rf.eggs.some(t=>e.includes(t))?"egg":Rf.crops.includes(e)?"crop":Rf.seeds.includes(e)?"seed":"unknown"}const Hf=[/!!!/,/omg/i,/ping/i,/spam/i,/^\d+/,/\d+\s+[A-Z]/,/stock!!!/i,/vegetables/i,/named/i];function jf(e){if(!function(e){return!(Hf.some(t=>t.test(e))||e.length>50)}(e))return!1;const t=Df(e);return"seed"===t||"egg"===t}const Wf=36e6;function Gf(e,t){try{if(e.includes("/")){const t=e.split(" ");if(t.length<3)return Date.now();const n=t[0],o=t[1],r=t[2].toLowerCase(),i=n.split("/").map(Number),a=o.split(":").map(Number);if(3!==i.length||2!==a.length)return Date.now();const l=i[0],c=i[1],d=i[2];let u,p;if(u=l,p=c,u<1||u>31||p<1||p>12)return s("‚ö†Ô∏è Invalid date after parsing:",e,{day:u,month:p,year:d}),Date.now();const m=a[0],f=a[1];let g=m;"pm"===r&&12!==m?g+=12:"am"===r&&12===m&&(g=0);const h=Date.UTC(d,p-1,u,g,f,0,0);return h-Wf}if(t){const n=e.split(" ");if(n.length<2)return Date.now();const o=n[0],r=n[1].toLowerCase(),i=o.split(":").map(Number);if(2!==i.length)return Date.now();const a=i[0],s=i[1];let l=a;"pm"===r&&12!==a?l+=12:"am"===r&&12===a&&(l=0);const c=new Date(t).getUTCFullYear(),d=new Date(t).getUTCMonth(),u=new Date(t).getUTCDate(),p=Date.UTC(c,d,u,l,s,0,0);return p-Wf}return Date.now()}catch(n){return s("‚ö†Ô∏è Failed to parse timestamp:",e,n),Date.now()}}function Of(e){const t=[],n=e.split("|").map(e=>e.trim());for(const o of n){const e=o.match(/@([^@]+?)(?:\s+(\d+))?$/);if(e&&e[1]){const n=e[1].trim();if(!jf(n))continue;const o=e[2]?parseInt(e[2],10):0;t.push({name:n,quantity:o,type:Df(n)})}}return t}function Vf(e,t){const n=t.map(e=>`${e.name}:${e.quantity}`).join(",");return`${e}-${btoa(n).substring(0,8)}`}async function _f(e){return new Promise((t,n)=>{const o=new FileReader;o.onload=e=>{try{const n=e.target?.result,o=async function(e){const t=[],n=(new DOMParser).parseFromString(e,"text/html"),o=Array.from(n.querySelectorAll(".chatlog__message-group"));let r;const i=o.length;let a=0;s(`üìä Parsing ${i} message groups from Discord HTML...`);for(let l=0;l<i;l+=50){const e=Math.min(l+50,i),n=o.slice(l,e);for(const o of n){const e=o.querySelector(".chatlog__author");if(!e||!e.textContent?.includes("Magic Shopkeeper"))continue;const n=o.querySelector(".chatlog__timestamp a");if(n){const e=Gf(n.textContent?.trim()||"");r=new Date(e)}const i=o.querySelectorAll(".chatlog__message-container");for(const o of i){let e="",n=0;const i=o.querySelector(".chatlog__timestamp a"),a=o.querySelector(".chatlog__short-timestamp");if(i)e=i.textContent?.trim()||"",n=Gf(e),r=new Date(n);else{if(!a)continue;e=a.textContent?.trim()||"",n=Gf(e,r)}const s=o.querySelector(".chatlog__content");if(!s)continue;const l=s.textContent?.trim()||"";if(!l)continue;const c=Of(l);if(0===c.length)continue;const d={id:Vf(n,c),timestamp:n,dateString:e,items:c,source:"discord"};t.push(d)}}a+=n.length,e<i&&(s(`üìä Parsed ${a}/${i} message groups (${t.length} events so far)...`),await new Promise(e=>setTimeout(e,0)))}return s(`‚úÖ Parsed ${t.length} restock events from ${i} message groups`),t}(n);t(o)}catch(o){n(o)}},o.onerror=()=>{n(new Error("Failed to read file"))},o.readAsText(e)})}function Uf(e){return e.toLocaleString()}function Xf(e){return new Date(e).toLocaleString()}function Kf(e){const t=Jc(),n=Yc();null!==e.countdownInterval&&(clearInterval(e.countdownInterval),e.countdownInterval=null),e.contentContainer.innerHTML="";const o=Jf();e.contentContainer.appendChild(o);const r=function(e){const t=document.createElement("div");t.style.cssText="\n    margin-bottom: 20px;\n    padding: 16px;\n    background: rgba(255, 255, 255, 0.05);\n    border-radius: 8px;\n    border: 2px dashed rgba(255, 255, 255, 0.2);\n  ";const n=document.createElement("h4");n.textContent="üì• Import Discord Data",n.style.cssText="\n    margin: 0 0 12px 0;\n    color: var(--qpm-accent, #4CAF50);\n    font-size: 14px;\n  ",t.appendChild(n);const o=document.createElement("p");o.style.cssText="\n    margin: 0 0 12px 0;\n    font-size: 12px;\n    color: var(--qpm-text-muted, #aaa);\n    line-height: 1.5;\n  ",o.textContent="Upload a Discord HTML export from the restock channel to import historical data.",t.appendChild(o);const r=document.createElement("input");r.type="file",r.accept=".html",r.style.display="none";const i=document.createElement("button");i.textContent="üìÅ Choose HTML File",i.style.cssText="\n    padding: 8px 16px;\n    background: var(--qpm-accent, #4CAF50);\n    color: white;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 12px;\n    font-weight: 600;\n    margin-right: 8px;\n  ",i.onclick=()=>r.click(),r.onchange=async e=>{const t=e.target,n=t.files?.[0];if(n){i.disabled=!0,i.textContent="‚è≥ Parsing...";try{const e=await _f(n);!function(e){let t=0;const n=new Set(Dc.map(e=>e.id));for(const o of e)n.has(o.id)||(Dc.push(o),n.add(o.id),t++);jc=!1,Xc(!0),ld(),s(`dY"S Added ${t} new restock events (${e.length-t} duplicates skipped)`)}(e),i.textContent=`‚úÖ Imported ${e.length} restocks`,setTimeout(()=>{i.disabled=!1,i.textContent="üìÅ Choose HTML File"},3e3)}catch(o){s("‚ùå Failed to parse Discord HTML:",o),i.textContent="‚ùå Import failed",setTimeout(()=>{i.disabled=!1,i.textContent="üìÅ Choose HTML File"},3e3)}}},t.appendChild(r),t.appendChild(i);const a=Jc();if(a.length>0){const n=document.createElement("div");n.style.cssText="display: flex; gap: 8px; margin-top: 12px;";const o=document.createElement("button");o.textContent="üì§ Export HTML",o.style.cssText="\n      padding: 8px 16px;\n      background: rgba(66, 165, 245, 0.2);\n      color: #42A5F5;\n      border: 1px solid #42A5F5;\n      border-radius: 4px;\n      cursor: pointer;\n      font-size: 12px;\n      font-weight: 600;\n    ",o.onclick=()=>{!function(){const e=Jc();if(0===e.length)return void s("‚ö†Ô∏è No restock data to export");const t=[...e].sort((e,t)=>e.timestamp-t.timestamp),n=`<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="utf-8">\n  <title>Shop Restock Data Export</title>\n  <style>\n    body { font-family: Arial, sans-serif; background: #36393f; color: #dcddde; padding: 20px; }\n    .chatlog__message-group { margin-bottom: 20px; padding: 10px; background: #2f3136; border-radius: 4px; }\n    .chatlog__author { font-weight: 600; color: #7289da; margin-bottom: 8px; }\n    .chatlog__message-container { margin: 4px 0; padding: 4px 0; }\n    .chatlog__timestamp { font-size: 11px; color: #72767d; margin-right: 8px; }\n    .chatlog__short-timestamp { font-size: 11px; color: #72767d; margin-right: 8px; }\n    .chatlog__content { color: #dcddde; }\n  </style>\n</head>\n<body>\n  <h1>Shop Restock Data Export</h1>\n  <p>Total Events: ${e.length} | Exported: ${(new Date).toLocaleString()}</p>\n  <p style="font-size: 12px; color: #72767d;">Note: All times are shown in your local timezone (${Intl.DateTimeFormat().resolvedOptions().timeZone})</p>\n\n  <div class="chatlog__message-group">\n    <div class="chatlog__author">Magic Shopkeeper</div>\n${t.map(e=>{const t=new Date(e.timestamp);return`    <div class="chatlog__message-container">\n      <span class="chatlog__timestamp"><a>${t.toLocaleString(void 0,{day:"2-digit",month:"2-digit",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}).replace(",","")}</a></span>\n      <span class="chatlog__short-timestamp">${t.toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit",hour12:!0})}</span>\n      <div class="chatlog__content">${e.items.map(e=>e.quantity>0?`@${e.name} ${e.quantity}`:`@${e.name}`).join(" | ")}</div>\n    </div>`}).join("\n")}\n  </div>\n</body>\n</html>`,o=new Blob([n],{type:"text/html"}),r=URL.createObjectURL(o),i=document.createElement("a");i.href=r,i.download=`qpm-shop-restock-export-${Date.now()}.html`,i.click(),URL.revokeObjectURL(r),s(`‚úÖ Exported ${e.length} restock events to HTML`)}()},n.appendChild(o);const r=document.createElement("button");r.textContent="üóëÔ∏è Clear Restock Data",r.style.cssText="\n      padding: 8px 16px;\n      background: rgba(244, 67, 54, 0.2);\n      color: #f44336;\n      border: 1px solid #f44336;\n      border-radius: 4px;\n      cursor: pointer;\n      font-size: 12px;\n      font-weight: 600;\n    ",r.onclick=()=>{confirm("‚ö†Ô∏è This will clear all Shop Restock history and prediction data.\n\nYour other QPM settings (auto-feed, XP tracking, etc.) will NOT be affected.\n\nThis cannot be undone. Are you sure?")&&(ad(),Kf(e),alert("‚úÖ Shop restock history and prediction data has been cleared."))},n.appendChild(r),t.appendChild(n)}return t}(e);if(e.contentContainer.appendChild(r),t.length>0){const t=document.createElement("div");t.style.cssText="\n      text-align: center;\n      padding: 40px 20px;\n      color: var(--qpm-text-muted, #aaa);\n    ",t.textContent="‚è≥ Loading predictions and statistics...",e.contentContainer.appendChild(t),requestAnimationFrame(()=>{e.contentContainer.removeChild(t);const o=function(e){const t=document.createElement("div");t.style.cssText="\n    margin-bottom: 20px;\n    padding: 16px;\n    background: rgba(66, 165, 245, 0.1);\n    border-radius: 8px;\n    border: 2px solid rgba(66, 165, 245, 0.3);\n  ";const n=document.createElement("h4");n.textContent="üîÆ Next Rare Restock Windows",n.style.cssText="\n    margin: 0 0 4px 0;\n    color: #42A5F5;\n    font-size: 14px;\n  ",t.appendChild(n);const o=document.createElement("p");o.textContent="Window-based predictions from pseudo-RNG analysis of 34,861 events",o.style.cssText="\n    margin: 0 0 12px 0;\n    font-size: 10px;\n    color: #888;\n    font-style: italic;\n  ",t.appendChild(o);const r=cd(),i=dd();if(i.length>0){const e=document.createElement("div");e.style.cssText="\n      margin-bottom: 12px;\n      padding: 10px;\n      background: rgba(255, 152, 0, 0.15);\n      border: 2px solid rgba(255, 152, 0, 0.4);\n      border-radius: 6px;\n    ";const n=document.createElement("div");n.textContent="üö® Active Alerts",n.style.cssText="\n      color: #FF9800;\n      font-weight: 700;\n      font-size: 11px;\n      margin-bottom: 8px;\n      text-transform: uppercase;\n    ",e.appendChild(n);for(const t of i){const n=document.createElement("div");n.style.cssText=`\n        padding: 6px 8px;\n        margin-bottom: 4px;\n        background: rgba(0, 0, 0, 0.3);\n        border-left: 3px solid ${"high"===t.urgency?"#f44336":"medium"===t.urgency?"#FF9800":"#4CAF50"};\n        border-radius: 3px;\n        font-size: 10px;\n        color: #fff;\n      `,n.textContent=t.message,e.appendChild(n)}t.appendChild(e)}const a=[{name:"Sunflower",color:"#FFD700"},{name:"Mythical Eggs",color:"#9C27B0"},{name:"Starweaver",color:"#FFD700"},{name:"Moonbinder",color:"#CE93D8"},{name:"Dawnbinder",color:"#FF9800"}],s=document.createElement("div");s.style.cssText="\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n  ";for(const c of a){const e=r.get(c.name);if(id(c.name),!e)continue;const t=document.createElement("div");t.style.cssText=`\n      background: rgba(0, 0, 0, 0.3);\n      border-radius: 6px;\n      border-left: 3px solid ${c.color};\n      overflow: hidden;\n    `;const n=document.createElement("div");n.style.cssText="\n      display: flex;\n      justify-content: space-between;\n      align-items: flex-start;\n      padding: 10px 12px;\n      cursor: pointer;\n      transition: background 0.2s;\n    ",n.addEventListener("mouseenter",()=>{n.style.background="rgba(255, 255, 255, 0.05)"}),n.addEventListener("mouseleave",()=>{n.style.background=""});const o=document.createElement("div");o.style.cssText="display: flex; align-items: center; gap: 8px;";const i=document.createElement("span");i.textContent=c.name,i.style.cssText=`\n      color: ${c.color};\n      font-weight: 600;\n      font-size: 12px;\n    `;const a=document.createElement("span");a.textContent="‚ñº",a.style.cssText="\n      color: #aaa;\n      font-size: 10px;\n      transition: transform 0.2s;\n    ",o.appendChild(i),o.appendChild(a);const l=document.createElement("div");l.style.cssText="\n      display: flex;\n      flex-direction: column;\n      align-items: flex-end;\n      gap: 4px;\n      font-size: 10px;\n    ";const d=document.createElement("div");d.style.cssText="\n      padding: 3px 8px;\n      border-radius: 10px;\n      font-weight: 600;\n      font-size: 9px;\n      text-transform: uppercase;\n    ",e.cooldownActive?(d.textContent="‚è≥ Cooldown",d.style.cssText+="background: rgba(244, 67, 54, 0.3); color: #f44336; border: 1px solid #f44336;"):e.tooEarly?(d.textContent="‚è∞ Too Early",d.style.cssText+="background: rgba(255, 152, 0, 0.3); color: #FF9800; border: 1px solid #FF9800;"):(d.textContent="üìä Monitoring",d.style.cssText+="background: rgba(66, 165, 245, 0.3); color: #42A5F5; border: 1px solid #42A5F5;"),l.appendChild(d);const u=document.createElement("div");if(u.style.cssText="color: #42A5F5; font-size: 10px; font-weight: 600; text-align: right;",e.cooldownActive||e.tooEarly)e.cooldownActive&&null!==e.hardCooldownRemaining?(u.style.color="#f44336",u.setAttribute("data-countdown-target",String(Date.now()+60*e.hardCooldownRemaining*60*1e3)),u.setAttribute("data-countdown-prefix","Cooldown: ")):e.tooEarly&&null!==e.practicalMinimumRemaining&&(u.style.color="#FF9800",u.setAttribute("data-countdown-target",String(Date.now()+60*e.practicalMinimumRemaining*60*1e3)),u.setAttribute("data-countdown-prefix","Monitor in: "));else{let t=null,n=null;const o=Date.now();if(e.nextWindows.length>0){const r=e.nextWindows.find(e=>e.endTime>=o);r&&(t=r.startTime,n=r.endTime)}if(e.statisticalPrediction){const r=e.statisticalPrediction.certaintyRange.earliest,i=e.statisticalPrediction.certaintyRange.latest;i>=o&&(t=t?Math.min(t,r):r,n=n?Math.max(n,i):i)}if(t&&n&&n>=o){const e=new Date(t),o=new Date(n),r=e.toLocaleString([],{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}),i=o.toLocaleString([],{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0});u.textContent=`${r} - ${i}`}}if((u.textContent||u.hasAttribute("data-countdown-target"))&&l.appendChild(u),null!==e.timeSinceLastSeen){const t=document.createElement("div");t.style.cssText="color: #aaa; font-size: 9px;";const n=e.timeSinceLastSeen.toFixed(1),o=(e.timeSinceLastSeen/24).toFixed(1);t.textContent=`Last seen: ${o}d ago (${n}h)`,l.appendChild(t)}n.appendChild(o),n.appendChild(l),t.appendChild(n);const p=document.createElement("div");if(p.style.cssText="\n      display: none;\n      padding: 12px;\n      background: linear-gradient(135deg, rgba(0, 0, 0, 0.5) 0%, rgba(33, 150, 243, 0.1) 100%);\n      border-top: 1px solid rgba(255, 255, 255, 0.1);\n      font-size: 10px;\n    ",e.cooldownActive||e.tooEarly){const t=document.createElement("div");if(t.style.cssText="\n        padding: 10px;\n        background: rgba(255, 152, 0, 0.1);\n        border-left: 3px solid #FF9800;\n        border-radius: 3px;\n        margin-bottom: 10px;\n      ",e.cooldownActive&&null!==e.hardCooldownRemaining){const n=document.createElement("div");n.style.cssText="color: #f44336; font-weight: 600; margin-bottom: 4px;",n.setAttribute("data-countdown-target",String(Date.now()+60*e.hardCooldownRemaining*60*1e3)),n.setAttribute("data-countdown-prefix","‚è≥ Hard cooldown: "),t.appendChild(n)}if(e.tooEarly&&null!==e.practicalMinimumRemaining){const n=document.createElement("div");n.style.cssText="color: #FF9800; font-weight: 600; margin-bottom: 4px;",n.setAttribute("data-countdown-target",String(Date.now()+60*e.practicalMinimumRemaining*60*1e3)),n.setAttribute("data-countdown-prefix","‚è∞ Practical minimum: "),t.appendChild(n);const o=document.createElement("div");o.style.cssText="color: #888; font-size: 9px; margin-top: 4px; font-style: italic;",o.textContent="Based on historical intervals - prevents false alarms",t.appendChild(o)}p.appendChild(t)}if(e.correlationSignals&&e.correlationSignals.length>0){const t=document.createElement("div");t.style.cssText="\n        padding: 10px;\n        background: rgba(206, 147, 216, 0.1);\n        border-left: 3px solid #CE93D8;\n        border-radius: 3px;\n        margin-bottom: 10px;\n      ";const n=document.createElement("div");n.style.cssText="color: #CE93D8; font-weight: 700; margin-bottom: 6px;",n.textContent="üîó Correlation Signals",t.appendChild(n);for(const o of e.correlationSignals){const e=document.createElement("div");e.style.cssText="color: #fff; margin-bottom: 4px;";const n=(100*o.probability).toFixed(0);e.innerHTML=`<span style="color: #FFD700;">Sunflower detected</span> ‚Üí <span style="color: ${c.color};">${c.name} possible</span> <span style="color: #CE93D8;">(${n}%)</span>`,t.appendChild(e);const r=document.createElement("div");r.style.cssText="color: #888; font-size: 9px; margin-left: 12px;";const i=((Date.now()-o.detectedAt)/36e5).toFixed(1);r.textContent=`Detected ${i}h ago`,t.appendChild(r)}p.appendChild(t)}const m=Date.now(),f=e.nextWindows.filter(e=>e.endTime>=m);if(f.length>0){const e=document.createElement("div");e.style.cssText="\n        padding: 10px;\n        background: rgba(66, 165, 245, 0.1);\n        border-left: 3px solid #42A5F5;\n        border-radius: 3px;\n        margin-bottom: 10px;\n      ";const t=document.createElement("div");t.style.cssText="color: #42A5F5; font-weight: 700; margin-bottom: 6px;",t.textContent="üìÖ Next Possible Windows",e.appendChild(t);for(let n=0;n<Math.min(5,f.length);n++){const t=f[n],o=document.createElement("div");o.style.cssText="\n          padding: 6px 8px;\n          margin-bottom: 4px;\n          background: rgba(0, 0, 0, 0.3);\n          border-radius: 3px;\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n        ";const r=document.createElement("span");r.style.cssText="color: #fff;",r.textContent=bc(t);const i=document.createElement("span");i.style.cssText="\n          padding: 2px 6px;\n          border-radius: 8px;\n          font-size: 8px;\n          font-weight: 700;\n          text-transform: uppercase;\n        ","high"===t.confidence?(i.textContent="HIGH",i.style.cssText+="background: #4CAF50; color: white;"):"medium"===t.confidence?(i.textContent="MED",i.style.cssText+="background: #FF9800; color: white;"):(i.textContent="LOW",i.style.cssText+="background: #666; color: white;"),o.appendChild(r),o.appendChild(i),e.appendChild(o)}p.appendChild(e)}if(e.monitoringSchedule){const t=document.createElement("div");t.style.cssText="\n        padding: 10px;\n        background: rgba(76, 175, 80, 0.1);\n        border-left: 3px solid #4CAF50;\n        border-radius: 3px;\n        margin-bottom: 10px;\n      ";const n=document.createElement("div");n.style.cssText="color: #4CAF50; font-weight: 700; margin-bottom: 6px;",n.textContent="‚è∞ Monitoring Schedule",t.appendChild(n);const o=document.createElement("div");o.style.cssText="color: #aaa; margin-bottom: 6px;",o.textContent=e.monitoringSchedule.message,t.appendChild(o);const r=document.createElement("div");r.style.cssText="display: flex; flex-wrap: wrap; gap: 4px;";const i=(new Date).getHours();for(const a of e.monitoringSchedule.optimalHours){const e=document.createElement("span"),t=a===i;e.style.cssText=`\n          padding: 3px 6px;\n          background: ${t?"rgba(76, 175, 80, 0.3)":"rgba(244, 67, 54, 0.3)"};\n          border: 1px solid ${t?"#4CAF50":"#f44336"};\n          border-radius: 4px;\n          font-size: 9px;\n          font-weight: 600;\n          color: ${t?"#4CAF50":"#f44336"};\n        `;const n=0===a?12:a>12?a-12:a,o=a>=12?"PM":"AM";e.textContent=`${n}${o}`,r.appendChild(e)}t.appendChild(r),p.appendChild(t)}const g=Jc().filter(e=>e.items.some(e=>e.name===c.name)).sort((e,t)=>t.timestamp-e.timestamp).slice(0,3);if(g.length>0){const e=document.createElement("div");e.style.cssText="\n        padding: 10px;\n        background: rgba(0, 0, 0, 0.3);\n        border-top: 1px solid rgba(255, 255, 255, 0.1);\n        border-radius: 3px;\n      ";const t=document.createElement("div");t.style.cssText="color: #42A5F5; font-weight: 700; margin-bottom: 6px;",t.textContent="üìä Past 3 Restocks",e.appendChild(t);for(const n of g){const t=new Date(n.timestamp),o=document.createElement("div");o.style.cssText="\n          color: #aaa;\n          font-size: 9px;\n          margin-bottom: 4px;\n          padding: 4px 6px;\n          background: rgba(255, 255, 255, 0.03);\n          border-radius: 3px;\n        ",o.innerHTML=`\n          <span style="color: #4CAF50;">‚úì</span> ${t.toLocaleString([],{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}\n        `,e.appendChild(o)}p.appendChild(e)}t.appendChild(p);let h=!1;n.addEventListener("click",()=>{h=!h,p.style.display=h?"block":"none",a.style.transform=h?"rotate(180deg)":""}),s.appendChild(t)}t.appendChild(s);const l=()=>{const e=Date.now();t.querySelectorAll("[data-countdown-target]").forEach(t=>{const n=t,o=parseInt(n.getAttribute("data-countdown-target")||"0",10),r=n.getAttribute("data-countdown-prefix")||"";if(o>0){const t=o-e;if(t<=0)n.textContent=r+"00d 00h 00m 00s",n.style.color="#4CAF50";else{const e=Math.floor(t/864e5),o=Math.floor(t%864e5/36e5),i=Math.floor(t%36e5/6e4),a=Math.floor(t%6e4/1e3),s=`${e.toString().padStart(2,"0")}d ${o.toString().padStart(2,"0")}h ${i.toString().padStart(2,"0")}m ${a.toString().padStart(2,"0")}s`;n.textContent=r+s}}})};l(),null!==e.countdownInterval&&clearInterval(e.countdownInterval);return e.countdownInterval=window.setInterval(()=>{document.contains(t)?l():null!==e.countdownInterval&&(clearInterval(e.countdownInterval),e.countdownInterval=null)},1e3),t}(e);e.contentContainer.appendChild(o);const r=function(e){const t=document.createElement("div");t.style.cssText="\n    margin-bottom: 20px;\n    padding: 16px;\n    background: rgba(255, 255, 255, 0.05);\n    border-radius: 8px;\n  ";const n=document.createElement("h4");n.textContent="üìä Summary Statistics",n.style.cssText="\n    margin: 0 0 12px 0;\n    color: var(--qpm-accent, #4CAF50);\n    font-size: 14px;\n  ",t.appendChild(n);const o=document.createElement("div");o.style.cssText="\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n    gap: 12px;\n  ";const r=[{label:"Total Restocks",value:Uf(e.totalRestocks),icon:"üîÑ"},{label:"Unique Items",value:Uf(e.uniqueItems),icon:"üì¶"},{label:"Avg Interval",value:`${e.avgRestockInterval.toFixed(1)} min`,icon:"‚è±Ô∏è"},{label:"Total Items",value:Uf(e.totalItems),icon:"üìä"}];e.dateRange&&r.push({label:"First Restock",value:Xf(e.dateRange.start),icon:"üìÖ"},{label:"Last Restock",value:Xf(e.dateRange.end),icon:"üìÖ"});for(const i of r){const e=document.createElement("div");e.style.cssText="\n      padding: 12px;\n      background: rgba(0, 0, 0, 0.3);\n      border-radius: 4px;\n      border: 1px solid rgba(255, 255, 255, 0.1);\n    ";const t=document.createElement("div");t.textContent=`${i.icon} ${i.label}`,t.style.cssText="\n      font-size: 11px;\n      color: var(--qpm-text-muted, #aaa);\n      margin-bottom: 4px;\n    ";const n=document.createElement("div");n.textContent=i.value,n.style.cssText="\n      font-size: 16px;\n      font-weight: 600;\n      color: var(--qpm-text, #fff);\n    ",e.appendChild(t),e.appendChild(n),o.appendChild(e)}return t.appendChild(o),t}(n);e.contentContainer.appendChild(r);const i=function(){const e=document.createElement("div");e.style.cssText="\n    margin-bottom: 20px;\n  ";const t=document.createElement("h4");t.textContent="üéØ Item Statistics",t.style.cssText="\n    margin: 0 0 12px 0;\n    color: var(--qpm-accent, #4CAF50);\n    font-size: 14px;\n  ",e.appendChild(t);const n=Qc(),o=Array.from(n.values()).filter(e=>"unknown"!==e.type).sort((e,t)=>t.totalRestocks-e.totalRestocks),r=30;let i=r,a=!1;const s=document.createElement("table");s.style.cssText="\n    width: 100%;\n    border-collapse: collapse;\n    font-size: 12px;\n  ";const l=document.createElement("thead"),c=document.createElement("tr");c.style.cssText="\n    border-bottom: 2px solid var(--qpm-border, #444);\n    background: rgba(255, 255, 255, 0.05);\n  ";const d=["Item","Type","Restocks","Avg Qty","Rate","Rarity","Last Seen","Next Restock"];for(const m of d){const e=document.createElement("th");e.textContent=m,e.style.cssText="\n      padding: 10px 12px;\n      text-align: left;\n      color: var(--qpm-text-muted, #aaa);\n      font-weight: 600;\n    ",c.appendChild(e)}l.appendChild(c),s.appendChild(l);const u=document.createElement("tbody"),p=e=>{const t=document.createElement("tr");t.style.cssText="\n      border-bottom: 1px solid var(--qpm-border, #444);\n    ";const n={common:"#aaa",uncommon:"#4CAF50",rare:"#42A5F5",mythic:"#9C27B0",divine:"#FF9800",celestial:"#FFD700"};let o="N/A",r="font-size: 11px; color: #aaa;";const i=td(e.name);if(i){const e=new Date(i),t=e.toLocaleTimeString([],{hour:"numeric",minute:"2-digit",hour12:!0});o=`${e.toLocaleDateString([],{month:"short",day:"numeric"})} ${t}`,r="font-size: 11px; color: #42A5F5; font-weight: 600;"}const a=[{value:e.name,style:"font-weight: 600;"},{value:e.type,style:"text-transform: capitalize; color: #aaa;"},{value:Uf(e.totalRestocks),style:""},{value:e.avgQuantity.toFixed(1),style:""},{value:`${e.appearanceRate.toFixed(1)}%`,style:""},{value:e.rarity,style:`color: ${n[e.rarity]}; text-transform: capitalize; font-weight: 600;`},{value:new Date(e.lastSeen).toLocaleDateString(),style:"font-size: 11px; color: #aaa;"},{value:o,style:r}];for(const s of a){const e=document.createElement("td");e.textContent=s.value,e.style.cssText=`\n        padding: 10px 12px;\n        ${s.style}\n      `,t.appendChild(e)}return t};for(let m=0;m<Math.min(r,o.length);m++)u.appendChild(p(o[m]));if(s.appendChild(u),e.appendChild(s),o.length>r){const t=document.createElement("button");t.textContent=`üìã Show All Items (${o.length-r} more)`,t.style.cssText="\n      width: 100%;\n      padding: 10px;\n      margin-top: 12px;\n      background: rgba(66, 165, 245, 0.15);\n      border: 1px solid rgba(66, 165, 245, 0.3);\n      color: #42A5F5;\n      font-size: 12px;\n      font-weight: 600;\n      cursor: pointer;\n      border-radius: 4px;\n      transition: all 0.2s;\n    ",t.addEventListener("mouseenter",()=>{t.style.background="rgba(66, 165, 245, 0.25)"}),t.addEventListener("mouseleave",()=>{t.style.background=a?"rgba(66, 165, 245, 0.2)":"rgba(66, 165, 245, 0.15)"}),t.addEventListener("click",()=>{if(a){for(;u.children.length>r;)u.removeChild(u.lastChild);i=r,a=!1,t.textContent=`üìã Show All Items (${o.length-r} more)`,t.style.background="rgba(66, 165, 245, 0.15)"}else t.textContent="‚è≥ Loading...",t.disabled=!0,requestAnimationFrame(()=>{for(let e=i;e<o.length;e++)u.appendChild(p(o[e]));i=o.length,a=!0,t.textContent="üìã Show Less",t.disabled=!1,t.style.background="rgba(66, 165, 245, 0.2)"})}),e.appendChild(t)}return e}();e.contentContainer.appendChild(i)})}else{const t=document.createElement("div");t.style.cssText="\n      text-align: center;\n      padding: 40px 20px;\n      color: var(--qpm-text-muted, #aaa);\n      font-style: italic;\n    ",t.textContent="No restock data imported yet. Upload a Discord HTML export to get started!",e.contentContainer.appendChild(t)}}function Jf(){const e=document.createElement("div");e.style.cssText="\n    margin-bottom: 20px;\n    padding: 16px;\n    background: rgba(76, 175, 80, 0.1);\n    border-radius: 8px;\n    border: 2px solid rgba(76, 175, 80, 0.3);\n  ";const t=document.createElement("h4");t.textContent="üì° Live Shop Monitoring",t.style.cssText="\n    margin: 0 0 12px 0;\n    color: var(--qpm-accent, #4CAF50);\n    font-size: 14px;\n  ",e.appendChild(t);const n=document.createElement("div"),o=Ad,r=Bd();n.style.cssText="\n    margin-bottom: 12px;\n    font-size: 12px;\n    padding: 8px 12px;\n    background: rgba(0, 0, 0, 0.3);\n    border-radius: 4px;\n  ",n.innerHTML=o?'<span style="color: #4CAF50;">‚óè Active</span> - Monitoring shop for restocks in real-time':'<span style="color: #aaa;">‚óã Inactive</span> - Live tracking is not running',e.appendChild(n);const i=document.createElement("p");i.style.cssText="\n    margin: 0 0 12px 0;\n    font-size: 12px;\n    color: var(--qpm-text-muted, #aaa);\n    line-height: 1.5;\n  ",i.textContent="Automatically detects and records shop restocks while you play.",e.appendChild(i);const a=document.createElement("button");return a.textContent=r?"üõë Disable Live Tracking":"‚ñ∂Ô∏è Enable Live Tracking",a.style.cssText=`\n    padding: 8px 16px;\n    background: ${r?"rgba(244, 67, 54, 0.2)":"rgba(76, 175, 80, 0.2)"};\n    color: ${r?"#f44336":"#4CAF50"};\n    border: 1px solid ${r?"#f44336":"#4CAF50"};\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 12px;\n    font-weight: 600;\n  `,a.onclick=()=>{r?qd():(kd=!0,Ad||Nd());const t=e.parentElement;if(t){const n=Jf();t.replaceChild(n,e)}},e.appendChild(a),e}function Qf(e){const t=e.getBoundingClientRect(),n=window.innerWidth,o=window.innerHeight;let r=parseFloat(e.style.top)||t.top,i=parseFloat(e.style.left)||t.left,a=parseFloat(e.style.right);isNaN(a)||""===e.style.right||(i=n-t.right,e.style.right="");const s=Math.max(8,n-t.width-8),l=Math.max(8,o-t.height-8);i=Math.min(Math.max(i,8),s),r=Math.min(Math.max(r,8),l),e.style.left=`${i}px`,e.style.top=`${r}px`}const Yf=Object.freeze(Object.defineProperty({__proto__:null,createShopRestockWindow:function(){const e=document.createElement("div");e.style.cssText="\n    position: fixed;\n    top: 80px;\n    right: 20px;\n    width: 900px;\n    max-height: 80vh;\n    overflow-y: auto;\n    background: var(--qpm-background, rgba(0, 0, 0, 0.92));\n    border: 2px solid var(--qpm-border, #555);\n    border-radius: 8px;\n    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);\n    z-index: 10003;\n    font-family: Arial, sans-serif;\n    display: none;\n  ";const t=document.createElement("div");t.style.cssText="\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 12px 16px;\n    background: var(--qpm-surface-1, #1a1a1a);\n    border-bottom: 2px solid var(--qpm-border, #555);\n    cursor: move;\n  ";const n=document.createElement("h3");n.textContent="üè™ Shop Restock Tracker",n.style.cssText="\n    margin: 0;\n    color: var(--qpm-text, #fff);\n    font-size: 16px;\n    font-weight: 600;\n  ";const o=document.createElement("button");o.textContent="‚úï",o.style.cssText="\n    background: transparent;\n    border: none;\n    color: var(--qpm-text, #fff);\n    font-size: 20px;\n    cursor: pointer;\n    padding: 0 8px;\n    line-height: 1;\n  ",o.onclick=()=>{e.style.display="none"},t.appendChild(n),t.appendChild(o),e.appendChild(t);const r=document.createElement("div");r.style.cssText="\n    padding: 16px;\n    color: var(--qpm-text, #fff);\n  ",e.appendChild(r),function(e,t){let n=0,o=0,r=0,i=0;function a(e){e.preventDefault(),r=e.clientX,i=e.clientY,document.onmouseup=l,document.onmousemove=s}function s(t){t.preventDefault(),n=r-t.clientX,o=i-t.clientY,r=t.clientX,i=t.clientY,e.style.top=e.offsetTop-o+"px",e.style.left=e.offsetLeft-n+"px"}function l(){document.onmouseup=null,document.onmousemove=null,Qf(e)}t.onmousedown=a}(e,t),document.body.appendChild(e);const i={root:e,contentContainer:r,countdownInterval:null,resizeListener:null},a=()=>{"none"!==e.style.display&&Qf(e)};window.addEventListener("resize",a),i.resizeListener=a,Uc(),Bd()&&Nd(),Kf(i);let s=null;return sd(()=>{null!==s&&clearTimeout(s),s=window.setTimeout(()=>{s=null,Kf(i)},500)}),i},hideShopRestockWindow:function(e){e.root.style.display="none"},showShopRestockWindow:function(e){e.root.style.display="block"}},Symbol.toStringTag,{value:"Module"}));function Zf(e,t="info"){console.log(`[PublicRooms:${t}]`,e)}function eg(){const e=document.createElement("div");e.id="pr-app";const t={...cm};return e.innerHTML=`\n    <div style="padding: 20px;">\n      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 12px; border-bottom: 2px solid rgba(66, 165, 245, 0.25);">\n        <div>\n          <h3 style="color: #fff; margin: 0 0 4px 0; font-size: 22px; display: flex; align-items: center; gap: 10px;">\n            üåê Public Rooms\n          </h3>\n          <div style="display: flex; align-items: center; gap: 8px;">\n            <p style="margin: 0; font-size: 11px; color: #888;">Powered by Supabase</p>\n            <span id="pr-connection-status" style="font-size: 11px; color: #42A5F5;">üîÑ Connecting...</span>\n          </div>\n          <div id="pr-room-statline" style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 6px;">\n            <span id="pr-total-rooms-pill" style="padding: 3px 10px; border-radius: 999px; background: rgba(66, 165, 245, 0.15); border: 1px solid rgba(66, 165, 245, 0.35); color: #90CAF9; font-size: 11px; font-weight: 600;">Rooms: --</span>\n            <span id="pr-visible-rooms-pill" style="padding: 3px 10px; border-radius: 999px; background: rgba(76, 175, 80, 0.15); border: 1px solid rgba(76, 175, 80, 0.35); color: #A5D6A7; font-size: 11px; font-weight: 600;">Showing: --</span>\n          </div>\n        </div>\n        <div style="display: flex; gap: 8px; align-items: center;">\n          <button id="pr-refresh-btn" class="qpm-button qpm-button--neutral" style="padding: 8px 16px; font-size: 13px;">üîÑ Refresh</button>\n        </div>\n      </div>\n\n      <div class="qpm-card" style="margin-bottom: 16px; background: rgba(33, 150, 243, 0.08); border: 2px solid rgba(33, 150, 243, 0.25);">\n        <h4 style="color: #42A5F5; margin-bottom: 12px; font-size: 15px; display: flex; align-items: center; gap: 8px;">\n          <span style="font-size: 18px;">üîç</span> Discover Rooms & Players\n        </h4>\n        <input type="text" id="pr-search-input" placeholder="üîé Search by room code or player name..."\n          style="width: 100%; padding: 12px; margin-bottom: 12px; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(66, 165, 245, 0.4); color: #fff; border-radius: 6px; font-size: 13px; box-sizing: border-box;">\n\n        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">\n          <div>\n            <label style="color: #42A5F5; font-size: 12px; display: block; margin-bottom: 6px; font-weight: 600;">üë• Player Count:</label>\n            <select id="pr-player-filter" style="width: 100%; padding: 10px; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(66, 165, 245, 0.4); color: #fff; border-radius: 6px; font-size: 13px; cursor: pointer;">\n              <option value="all">All Rooms</option>\n              <option value="empty">Empty (0)</option>\n              <option value="low">Few (1-2)</option>\n              <option value="medium">Some (3-4)</option>\n              <option value="high">Many (5-6)</option>\n            </select>\n          </div>\n          <div>\n            <label style="color: #42A5F5; font-size: 12px; display: block; margin-bottom: 6px; font-weight: 600;">üìä Sort By:</label>\n            <select id="pr-sort-by" style="width: 100%; padding: 10px; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(66, 165, 245, 0.4); color: #fff; border-radius: 6px; font-size: 13px; cursor: pointer;">\n              <option value="name">Room Code</option>\n              <option value="players-desc" selected>Most Players</option>\n              <option value="players-asc">Least Players</option>\n            </select>\n          </div>\n        </div>\n      </div>\n\n      <div style="margin-bottom: 12px; padding-bottom: 10px; border-bottom: 2px solid rgba(255, 255, 255, 0.08);">\n        <h4 style="color: #fff; margin: 0; font-size: 16px; display: flex; align-items: center; gap: 8px;">\n          <span style="font-size: 20px;">üéÆ</span> Available Rooms\n        </h4>\n      </div>\n      <div id="pr-rooms-list" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 16px; margin-bottom: 20px;">\n        <p style="text-align: center; color: #aaa; grid-column: 1/-1; font-size: 14px;">Loading rooms...</p>\n      </div>\n\n      <div class="qpm-card" style="background: rgba(255, 152, 0, 0.08); border: 2px solid rgba(255, 152, 0, 0.25);">\n        <h4 style="color: #FF9800; margin-bottom: 12px; font-size: 15px; display: flex; align-items: center; gap: 8px;">\n          <span style="font-size: 18px;">‚öôÔ∏è</span> Settings\n        </h4>\n        <div>\n          <label style="color: #FF9800; font-size: 12px; display: block; margin-bottom: 6px; font-weight: 600;">üîÑ Room Refresh:</label>\n          <select id="pr-refresh-interval" style="width: 100%; padding: 10px; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(255, 152, 0, 0.4); color: #fff; border-radius: 6px; font-size: 13px; cursor: pointer;">\n            <option value="15" ${15===t.refreshIntervalSeconds?"selected":""}>15 seconds</option>\n            <option value="30" ${30===t.refreshIntervalSeconds?"selected":""}>30 seconds</option>\n            <option value="60" ${60===t.refreshIntervalSeconds?"selected":""}>1 minute</option>\n            <option value="90" ${90===t.refreshIntervalSeconds?"selected":""}>1.5 minutes</option>\n            <option value="120" ${120===t.refreshIntervalSeconds?"selected":""}>2 minutes</option>\n            <option value="0" ${0===t.refreshIntervalSeconds?"selected":""}>Never</option>\n          </select>\n        </div>\n      </div>\n    </div>\n  `,e}function tg(e){const t=e.avatarUrl?`<span style="width: 20px; height: 20px; border-radius: 50%; background-image: url(${e.avatarUrl}); background-size: cover; background-position: center; border: 1px solid rgba(255,255,255,0.15);"></span>`:'<span style="font-size: 12px; opacity: 0.7;">üë§</span>';return`\n    <span class="pr-player-chip" data-player-name="${e.name||""}" style="display: inline-flex; align-items: center; gap: 6px; padding: 6px 10px; border-radius: 999px; background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.08); color: #fff; font-size: 12px; font-weight: 600;">\n      ${t}\n      ${e.name||"Unknown"}\n    </span>\n  `}function ng(e){const t=document.getElementById("pr-rooms-list");if(!t)return;t.innerHTML="";const n=Object.keys(e);!function(e,t){const n=document.getElementById("pr-total-rooms-pill"),o=document.getElementById("pr-visible-rooms-pill");n&&(n.textContent=`Rooms: ${e}`),o&&(o.textContent=`Showing: ${t}`)}(Object.keys(Tm().allRooms||{}).length,n.length);const o=document.createDocumentFragment();0!==n.length?(n.forEach(t=>{const n=e[t];if(!n)return;const r=n.playersCount||0;let i="#666",a="rgba(102, 102, 102, 0.2)";const s=r>=6;s?(i="#E53935",a="rgba(229, 57, 53, 0.25)"):r>=5?(i="#4CAF50",a="rgba(76, 175, 80, 0.2)"):r>=3?(i="#FF9800",a="rgba(255, 152, 0, 0.2)"):r>=1&&(i="#42A5F5",a="rgba(66, 165, 245, 0.2)");const l=function(e){const t=e.trim();return t.length<=16?t:`${t.slice(0,10)}‚Ä¶${t.slice(-4)}`}(n.id),c=n.id.trim().startsWith("I-")?"Discord":"Web";const d="Discord"===c?"#7289DA":"#26A69A",u="Discord"===c?"rgba(114, 137, 218, 0.2)":"rgba(38, 166, 154, 0.2)",p=n.userSlots&&n.userSlots.length>0?`<div style="display: flex; flex-wrap: wrap; gap: 6px; margin-top: 12px;">${n.userSlots.map(tg).join("")}</div>`:'<div style="color: #777; font-size: 12px; margin-top: 10px;">No visible players</div>',m=document.createElement("div");m.className="qpm-card",m.style.cssText="padding: 16px; position: relative; background: linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(0, 0, 0, 0.2) 100%); border: 2px solid rgba(66, 165, 245, 0.2); transition: all 0.2s ease;",m.addEventListener("mouseenter",()=>{m.style.borderColor="rgba(66, 165, 245, 0.5)",m.style.transform="translateY(-2px)",m.style.boxShadow="0 8px 16px rgba(0, 0, 0, 0.3)"}),m.addEventListener("mouseleave",()=>{m.style.borderColor="rgba(66, 165, 245, 0.2)",m.style.transform="",m.style.boxShadow=""}),m.innerHTML=`\n      <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">\n        <div style="font-size: 17px; font-weight: bold; color: #fff; flex: 1; display: flex; align-items: center; gap: 8px; flex-wrap: wrap;">\n          ${n.isPrivate?'<span title="Private" style="font-size: 14px; color: #ffb74d;">üîí</span>':'<span title="Public" style="font-size: 14px; color: #4CAF50;">üîì</span>'}\n          <span title="${n.id}" style="display: inline-flex; align-items: center; gap: 8px;">\n            ${l}\n          </span>\n          <span title="Detected origin" style="padding: 3px 8px; border-radius: 10px; background: ${u}; border: 1px solid ${d}; color: ${d}; font-size: 11px; font-weight: 700; display: inline-flex; align-items: center; gap: 6px;">\n            ${"Discord"===c?"üõ∞Ô∏è Discord":"üåê Web"}\n          </span>\n        </div>\n        <div style="background: ${a}; padding: 4px 10px; border-radius: 12px; border: 1px solid ${i}; display: flex; align-items: center; gap: 4px; white-space: nowrap;">\n          <span style="font-size: 12px;">üë•</span>\n          <span style="font-size: 12px; font-weight: 600; color: ${i};">${r}</span>\n        </div>\n      </div>\n      <div style="font-size: 11px; color: #666; font-family: monospace; margin-top: 4px;">Updated: ${n.lastUpdatedAt?new Date(n.lastUpdatedAt).toLocaleTimeString():"n/a"}</div>\n      ${p}\n      <div style="display: flex; gap: 8px; margin-top: 14px;">\n        <button\n          class="qpm-button ${s?"qpm-button--negative":"qpm-button--positive"} pr-join-btn"\n          data-room-code="${t}"\n          style="flex: 1; padding: 8px; font-size: 13px; font-weight: 600; ${s?"background: linear-gradient(135deg, rgba(229,57,53,0.85), rgba(183,28,28,0.9)); border: 2px solid rgba(229,57,53,0.9); color: #fff;":""}"\n        >${s?"‚õî Full":"üöÄ Join"}</button>\n        <button class="qpm-button qpm-button--neutral pr-view-btn" data-room-code="${t}" style="padding: 8px; font-size: 13px; font-weight: 600;">üëÅÔ∏è Players</button>\n      </div>\n    `,o.appendChild(m)}),t.appendChild(o),t.querySelectorAll(".pr-join-btn").forEach(e=>{e.addEventListener("click",e=>{const t=e.target.getAttribute("data-room-code");t&&(window.location.href=`/r/${t}`)})}),t.querySelectorAll(".pr-player-chip").forEach(e=>{e.addEventListener("click",e=>{const t=e.currentTarget.getAttribute("data-player-name");if(!t)return;const n=document.getElementById("pr-search-input");n&&(n.value=t),Cm(t)})}),t.querySelectorAll(".pr-view-btn").forEach(e=>{e.addEventListener("click",e=>{const t=e.target.getAttribute("data-room-code");if(!t)return;const n=Tm().allRooms[t];n?n.userSlots&&0!==n.userSlots.length?function(e){const t=document.createElement("div");t.style.cssText="position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 9999; display: flex; align-items: center; justify-content: center; padding: 20px;";const n=document.createElement("div");n.style.cssText="width: min(520px, 100%); max-height: 80vh; overflow: auto; background: #111827; border: 2px solid rgba(66,165,245,0.35); border-radius: 10px; padding: 18px; color: #fff; box-shadow: 0 12px 32px rgba(0,0,0,0.4);";const o=e.userSlots||[];n.innerHTML=`\n    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">\n      <div>\n        <div style="font-size: 18px; font-weight: 700;">Players in ${e.id}</div>\n        <div style="font-size: 12px; color: #9CA3AF;">${o.length} visible player${1===o.length?"":"s"}</div>\n      </div>\n      <button id="pr-modal-close" class="qpm-button qpm-button--neutral" style="padding: 6px 12px;">‚úñ</button>\n    </div>\n    <div style="display: flex; flex-direction: column; gap: 10px;">\n      ${0===o.length?'<div style="color: #9CA3AF; font-size: 13px; text-align: center; padding: 20px;">No players visible for this room.</div>':o.map(e=>`\n        <div class="qpm-card" style="padding: 10px 12px; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08); display: flex; align-items: center; gap: 10px;">\n          ${e.avatarUrl?`<img src="${e.avatarUrl}" alt="avatar" style="width: 36px; height: 36px; border-radius: 50%; border: 1px solid rgba(255,255,255,0.2); object-fit: cover;">`:'<div style="width: 36px; height: 36px; border-radius: 50%; background: rgba(255,255,255,0.08); display: grid; place-items: center; color: #9CA3AF;">üë§</div>'}\n          <div style="flex: 1;">\n            <div style="font-size: 14px; font-weight: 700;">${e.name||"Unknown player"}</div>\n            <div style="font-size: 11px; color: #9CA3AF;">Tap to search by this player</div>\n          </div>\n          <button class="qpm-button qpm-button--neutral pr-search-player" data-player-name="${e.name||""}" style="padding: 6px 10px; font-size: 12px;">üîç Search</button>\n        </div>\n      `).join("")}\n    </div>\n  `,t.appendChild(n),document.body.appendChild(t);const r=()=>t.remove();n.querySelector("#pr-modal-close")?.addEventListener("click",r),t.addEventListener("click",e=>{e.target===t&&r()}),n.querySelectorAll(".pr-search-player").forEach(e=>{e.addEventListener("click",e=>{const t=e.currentTarget.getAttribute("data-player-name")||"",n=document.getElementById("pr-search-input");n&&(n.value=t),Cm(t),r()})})}(n):Zf("No players visible in this room","info"):Zf("Room data unavailable","error")})})):t.innerHTML='<p style="text-align: center; color: #aaa; grid-column: 1/-1; font-size: 14px;">No rooms found. Try adjusting filters or search by player name.</p>'}function og(e){const t=document.getElementById("pr-rooms-list");if(t){t.innerHTML=`\n      <div style="text-align: center; color: #ff4d4d; grid-column: 1/-1; padding: 40px;">\n        <div style="font-size: 32px; margin-bottom: 16px;">‚ö†Ô∏è</div>\n        <p style="font-size: 14px; margin-bottom: 16px;">${e}</p>\n        <button id="pr-retry-fetch-btn" style="padding: 10px 20px; background: rgba(66, 165, 245, 0.2); border: 2px solid #42A5F5; border-radius: 6px; color: #42A5F5; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s;">üîÑ Retry</button>\n      </div>\n    `;const n=document.getElementById("pr-retry-fetch-btn");n&&n.addEventListener("click",()=>{t.innerHTML='<p style="text-align: center; color: #aaa; grid-column: 1/-1; font-size: 14px;">Loading rooms...</p>',vm()})}}function rg(e){const t=document.getElementById("pr-connection-status"),n=document.getElementById("pr-rooms-list");if(t){const n={connecting:{text:"üîÑ Connecting...",color:"#42A5F5"},connected:{text:"‚úÖ Connected",color:"#4CAF50"},failed:{text:"‚ùå Connection Failed",color:"#ff4d4d"},retrying:{text:"üîÑ Retrying...",color:"#FF9800"}}[e];t.textContent=n.text,t.style.color=n.color}!n||"connecting"!==e&&"retrying"!==e||(n.innerHTML=`\n      <div style="text-align: center; color: #aaa; grid-column: 1/-1; padding: 40px;">\n        <div style="font-size: 32px; margin-bottom: 16px;">üîÑ</div>\n        <p style="font-size: 14px; margin-bottom: 8px;">${"connecting"===e?"Connecting to Public Rooms...":"Retrying connection..."}</p>\n        <p style="font-size: 12px; color: #666;">This may take a few seconds</p>\n      </div>\n    `)}const ig=Object.freeze(Object.defineProperty({__proto__:null,renderPublicRoomsWindow:function(e){if(e.innerHTML="",e.style.cssText="height: 100%; overflow-y: auto; background: linear-gradient(135deg, rgba(33, 33, 33, 0.95) 0%, rgba(0, 0, 0, 0.95) 50%, rgba(22, 22, 44, 0.95) 100%);",!document.querySelector("#pr-hidden-style")){const e=document.createElement("style");e.id="pr-hidden-style",e.textContent=".hidden { display: none !important; }",document.head.appendChild(e)}const t=eg();e.appendChild(t);const n=document.getElementById("pr-search-input"),o=document.getElementById("pr-player-filter"),r=document.getElementById("pr-sort-by"),i=document.getElementById("pr-refresh-interval"),a=document.getElementById("pr-refresh-btn");if(n){let e=null;const t=e=>e.stopPropagation();["keydown","keyup","keypress"].forEach(e=>n.addEventListener(e,t)),n.addEventListener("input",t=>{e&&window.clearTimeout(e),e=window.setTimeout(()=>{Cm(t.target.value)},200)})}var s;o?.addEventListener("change",e=>{var t;t=e.target.value,dm.currentPlayerFilter=t,um=ym(dm.allRooms),mm?.({...um})}),r?.addEventListener("change",e=>{var t;t=e.target.value,dm.currentSortBy=t,um=ym(dm.allRooms),mm?.({...um})}),i?.addEventListener("change",e=>{const t=parseInt(e.target.value,10);var n;n=t,cm.refreshIntervalSeconds=hm(n),f.set("publicRooms:refreshInterval",cm.refreshIntervalSeconds),Zf("Refresh interval set to "+(t>0?`${t}s`:"never"),"success")}),a?.addEventListener("click",()=>{vm(),Zf("Refreshing rooms...","info")}),mm=s=ng,s({...um}),function(e){gm=e,e(dm.connectionStatus)}(rg),function(e){fm=e}(og),wm().catch(e=>{Zf("Unable to initialize Public Rooms","error"),console.error("[PublicRooms] init failed",e)})}},Symbol.toStringTag,{value:"Module"}));function ag(e){return e.charAt(0).toUpperCase()+e.slice(1)}function sg(e){e.innerHTML="",e.style.cssText="\n    padding: 20px;\n    display: flex;\n    flex-direction: column;\n    gap: 16px;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n  ";const t=nm(),n={...Vp};if(!t){const t=document.createElement("div");return t.style.cssText="\n      text-align: center;\n      padding: 40px 20px;\n      color: rgba(255, 255, 255, 0.5);\n      font-size: 14px;\n    ",t.innerHTML='\n      <div style="font-size: 48px; margin-bottom: 12px;">üêæ</div>\n      <div style="font-weight: 500; margin-bottom: 8px;">No Crop Size Boost pets active</div>\n      <div style="font-size: 12px;">Add pets with "Crop Size Boost I" or "Crop Size Boost II" abilities</div>\n    ',void e.appendChild(t)}const o=document.createElement("div");o.style.cssText="\n    padding: 16px;\n    background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(76, 175, 80, 0.05));\n    border: 1px solid rgba(76, 175, 80, 0.3);\n    border-radius: 8px;\n  ";const r=document.createElement("div");r.style.cssText="font-size: 14px; font-weight: 600; color: #4CAF50; margin-bottom: 8px;",r.textContent=`üêæ ${t.totalBoostPets} Active Boost Pet${1!==t.totalBoostPets?"s":""}`,o.appendChild(r);const i=document.createElement("div");i.style.cssText="display: flex; flex-direction: column; gap: 6px; font-size: 12px;",t.boostPets.forEach(e=>{const t=document.createElement("div");var n;t.style.cssText="color: rgba(255, 255, 255, 0.8);",t.innerHTML=`\n      ‚Ä¢ <strong>${e.displayName}</strong>: ${e.abilityName}\n      <span style="color: #4CAF50; font-weight: 600;">(+${n=e.effectiveBoostPercent,n.toFixed(1)}% per proc)</span>\n    `,i.appendChild(t)}),o.appendChild(i);const a=document.createElement("div");a.style.cssText="margin-top: 12px; padding: 8px; background: rgba(255, 152, 0, 0.1); border: 1px solid rgba(255, 152, 0, 0.3); border-radius: 4px; font-size: 11px; color: rgba(255, 255, 255, 0.7);",a.innerHTML='\n    <div style="font-weight: 600; color: #FF9800; margin-bottom: 4px;">‚ö†Ô∏è Important Notes:</div>\n    <div>‚Ä¢ Crop Size Boost abilities do <strong>NOT stack</strong> - only the weakest boost is used in calculations</div>\n    <div>‚Ä¢ Time estimates are conservative and include RNG variance</div>\n  ',o.appendChild(a),e.appendChild(o);const s=document.createElement("div");s.style.cssText="\n    padding: 14px 18px;\n    background: linear-gradient(135deg, rgba(76, 175, 80, 0.15), rgba(76, 175, 80, 0.05));\n    border: 2px solid rgba(76, 175, 80, 0.4);\n    border-radius: 8px;\n    margin-bottom: 16px;\n    box-shadow: 0 2px 8px rgba(76, 175, 80, 0.1);\n  ";const l=document.createElement("div");l.style.cssText="font-size: 12px; font-weight: 700; color: #4CAF50; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.8px; display: flex; align-items: center; gap: 6px;",l.innerHTML="üìñ <span>Crop Status Legend</span>",s.appendChild(l);const c=document.createElement("div");c.style.cssText="display: flex; gap: 24px; font-size: 13px; color: rgba(255, 255, 255, 0.9);",c.innerHTML='\n    <div style="display: flex; align-items: center; gap: 8px; padding: 6px 12px; background: rgba(255, 255, 255, 0.08); border-radius: 6px;">\n      <span style="font-size: 20px;">üå±</span>\n      <span style="font-weight: 600;">Still Growing</span>\n    </div>\n    <div style="display: flex; align-items: center; gap: 8px; padding: 6px 12px; background: rgba(255, 255, 255, 0.08); border-radius: 6px;">\n      <span style="font-size: 20px;">üåæ</span>\n      <span style="font-weight: 600;">Fully Grown (Mature)</span>\n    </div>\n  ',s.appendChild(c),e.appendChild(s);const d=document.createElement("div");d.style.cssText="\n    display: flex;\n    justify-content: flex-end;\n    gap: 8px;\n  ";const u=document.createElement("button");u.style.cssText="\n    padding: 6px 12px;\n    background: rgba(100, 181, 246, 0.2);\n    border: 1px solid #64B5F6;\n    border-radius: 4px;\n    color: #64B5F6;\n    font-size: 12px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.2s;\n  ",u.textContent=ug?"üìä Simple View":"üìà Detailed View",u.addEventListener("click",()=>{ug=!ug,lg&&sg(lg)}),u.addEventListener("mouseenter",()=>{u.style.background="rgba(100, 181, 246, 0.3)"}),u.addEventListener("mouseleave",()=>{u.style.background="rgba(100, 181, 246, 0.2)"}),d.appendChild(u),e.appendChild(d);const p=document.createElement("div");p.style.cssText="\n    padding: 16px;\n    background: rgba(255, 255, 255, 0.05);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: 8px;\n  ";const m=document.createElement("div");m.style.cssText="font-size: 13px; font-weight: 600; color: rgba(255, 255, 255, 0.7); margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.5px;",m.textContent="üìä Overall Progress",p.appendChild(m);const f=document.createElement("div");f.style.cssText="\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));\n    gap: 12px;\n  ";if([{label:"Total Crops",value:t.crops.length,color:"#fff"},{label:"At Max Size",value:t.totalCropsAtMax,color:"#4CAF50"},{label:"Crops Needing Boost",value:t.totalCropsNeedingBoost,color:"#FF9800"},{label:"Progress",value:`${t.crops.length>0?Math.round(t.totalCropsAtMax/t.crops.length*100):0}%`,color:"#64B5F6"}].forEach(({label:e,value:t,color:n})=>{const o=document.createElement("div");o.innerHTML=`\n      <div style="font-size: 11px; color: rgba(255, 255, 255, 0.6); margin-bottom: 4px;">${e}</div>\n      <div style="font-size: 20px; font-weight: 600; color: ${n};">${t}</div>\n    `,f.appendChild(o)}),p.appendChild(f),e.appendChild(p),t.totalCropsNeedingBoost>0){const n=document.createElement("div");n.style.cssText="\n      padding: 16px;\n      background: linear-gradient(135deg, rgba(255, 193, 7, 0.15), rgba(255, 193, 7, 0.05));\n      border: 2px solid rgba(255, 193, 7, 0.4);\n      border-radius: 8px;\n    ",n.setAttribute("data-countdown-section","overall");const o=document.createElement("div");o.style.cssText="font-size: 14px; font-weight: 600; color: #FFC107; margin-bottom: 12px;",o.textContent="üéØ Time Until All Crops Max Size",n.appendChild(o);const r=document.createElement("div");if(r.style.cssText="font-size: 13px; color: rgba(255, 255, 255, 0.9); margin-bottom: 8px;",r.innerHTML=`<strong>Boosts Needed:</strong> ${t.overallEstimate.boostsNeeded}`,n.appendChild(r),ug){const e=document.createElement("div");e.style.cssText="font-size: 16px; font-weight: 600; color: #FFC107; margin-bottom: 8px;";const o=im(t.overallEstimate.timeEstimateP10,t.overallEstimate.timeEstimateP50,t.overallEstimate.timeEstimateP90);e.innerHTML=`‚è∞ ${o}`,n.appendChild(e);const r=document.createElement("div");r.style.cssText="font-size: 11px; color: rgba(255, 255, 255, 0.5); margin-top: 4px; font-style: italic;",r.textContent="* Time estimates based on combined proc rates (P10-P90 range, median)",n.appendChild(r)}else{const e=document.createElement("div");if(e.style.cssText="font-size: 16px; font-weight: 600; color: #FFC107;",e.setAttribute("data-next-boost-range","true"),t.boostPets.length>0){const n=1-t.boostPets.map(e=>e.effectiveProcChance/60/100).reduce((e,t)=>e*(1-t),1);if(n>0){const t=Math.log(1-n),o=Math.log(.9)/t,r=Math.log(.1)/t,i=rm(o/60),a=rm(r/60);e.innerHTML=`‚è∞ Next boost: <span style="color: #FFC107;">${i} - ${a}</span>`}}else e.innerHTML='‚è∞ Next boost: <span style="color: #999;">No boost pets</span>';n.appendChild(e)}e.appendChild(n)}const g=document.createElement("div");g.style.cssText="\n    padding: 16px;\n    background: rgba(255, 255, 255, 0.05);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: 8px;\n  ";const h=document.createElement("div");h.style.cssText="font-size: 13px; font-weight: 600; color: rgba(255, 255, 255, 0.7); margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.5px;",h.textContent="üå± View Specific Crop",g.appendChild(h);const b=document.createElement("div");b.style.cssText="display: flex; gap: 12px; align-items: center;";const y=document.createElement("select");y.style.cssText="\n    flex: 1;\n    padding: 8px 12px;\n    background: rgba(0, 0, 0, 0.3);\n    border: 1px solid rgba(255, 255, 255, 0.2);\n    border-radius: 4px;\n    color: #fff;\n    font-size: 14px;\n    cursor: pointer;\n  ";const x=document.createElement("option");x.value="",x.textContent="All Crops",y.appendChild(x);const w=function(){const e=nm();if(!e)return[];const t=new Set;for(const n of e.crops)t.add(n.species);return Array.from(t).sort()}();w.forEach(e=>{const t=document.createElement("option");t.value=e,t.textContent=ag(e),y.appendChild(t)}),y.value=n.selectedSpecies??"",y.addEventListener("change",()=>{Qp(y.value||null),lg&&sg(lg)}),b.appendChild(y),g.appendChild(b),e.appendChild(g);const v=n.selectedSpecies,C=(v?t.crops.filter(e=>e.species===v):t.crops).filter(e=>e.sizeRemaining>0);if(C.sort((e,n)=>{const o=`${e.tileKey}-${e.slotIndex}`,r=`${n.tileKey}-${n.slotIndex}`,i=t.cropEstimates.get(o),a=t.cropEstimates.get(r),s=i?.boostsNeeded??0;return(a?.boostsNeeded??0)-s}),C.length>0){const n=document.createElement("div");n.style.cssText="\n      padding: 16px;\n      background: rgba(255, 255, 255, 0.02);\n      border: 1px solid rgba(255, 255, 255, 0.1);\n      border-radius: 8px;\n    ";const o=document.createElement("div");o.style.cssText="font-size: 13px; font-weight: 600; color: rgba(255, 255, 255, 0.7); margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.5px;",o.textContent=v?`üåæ ${ag(v)} Crops (${C.length})`:`üåæ All Crops Needing Boosts (${C.length})`,n.appendChild(o);const r=document.createElement("table");r.style.cssText="\n      width: 100%;\n      border-collapse: collapse;\n      font-size: 13px;\n    ";const i=document.createElement("thead");i.innerHTML=`\n      <tr>\n        <th style="text-align: left; padding: 10px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); color: rgba(255, 255, 255, 0.6); font-weight: 600; text-transform: uppercase; font-size: 11px;">Crop</th>\n        <th style="text-align: right; padding: 10px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); color: rgba(255, 255, 255, 0.6); font-weight: 600; text-transform: uppercase; font-size: 11px;">Size</th>\n        <th style="text-align: right; padding: 10px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); color: rgba(255, 255, 255, 0.6); font-weight: 600; text-transform: uppercase; font-size: 11px;">Boosts</th>\n        <th style="text-align: right; padding: 10px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); color: rgba(255, 255, 255, 0.6); font-weight: 600; text-transform: uppercase; font-size: 11px;">${ug?"Time Estimate":"Next Boost"}</th>\n      </tr>\n    `,r.appendChild(i);const a=document.createElement("tbody");C.forEach((e,n)=>{const o=`${e.tileKey}-${e.slotIndex}`,r=t.cropEstimates.get(o),i=document.createElement("tr");i.style.cssText="\n        border-bottom: 1px solid rgba(255, 255, 255, 0.05);\n        transition: background 0.2s;\n      ",i.addEventListener("mouseenter",()=>{i.style.background="rgba(76, 175, 80, 0.1)"}),i.addEventListener("mouseleave",()=>{i.style.background="transparent"});const s=document.createElement("td");s.style.cssText="padding: 12px 10px; display: flex; align-items: center; gap: 8px;";const l=document.createElement("span");l.textContent=e.isMature?"üåæ":"üå±",l.style.cssText="font-size: 16px; flex-shrink: 0;";const c=document.createElement("div");c.style.cssText="\n        width: 24px;\n        height: 24px;\n        background-size: contain;\n        background-repeat: no-repeat;\n        background-position: center;\n        flex-shrink: 0;\n        image-rendering: pixelated;\n      ";let d=e.species;const u=["Rainbow","Gold","Golden","Frozen","Amber","Wet","Chilled","Dawnlit"];for(const t of u)if(d.startsWith(t+" ")){d=d.substring(t.length+1);break}const p=Gi(d.toLowerCase().trim());p?c.style.backgroundImage=`url(${p})`:c.style.background="linear-gradient(135deg, #4CAF50 0%, #45a049 100%)";const m=document.createElement("span"),f=e.mutations.length>0?` <span style="color: #FFD700;">(${e.mutations.join(", ")})</span>`:"";m.innerHTML=`${ag(e.species)}${f}`,s.appendChild(l),s.appendChild(c),s.appendChild(m),i.appendChild(s);const g=document.createElement("td");g.style.cssText="padding: 12px 10px; text-align: right;";const h=e.currentSizePercent.toFixed(1);g.innerHTML=`<span style="color: ${e.currentSizePercent>=90?"#4CAF50":e.currentSizePercent>=70?"#FF9800":"#fff"}; font-weight: 600;">${h}%</span>`,i.appendChild(g);const b=document.createElement("td");b.style.cssText="padding: 12px 10px; text-align: right;",r&&ug?b.innerHTML=`<span style="color: #64B5F6; font-weight: 600;">${r.boostsReceived}/${r.boostsNeeded}</span>`:r?b.innerHTML=`<span style="color: #64B5F6; font-weight: 600;">${r.boostsNeeded}</span>`:b.textContent="N/A",i.appendChild(b);const y=document.createElement("td");if(y.style.cssText="padding: 12px 10px; text-align: right; color: #FFC107; font-weight: 500;",r)if(ug){const e=im(r.timeEstimateP10,r.timeEstimateP50,r.timeEstimateP90);y.textContent=e}else{const e=rm(r.timeEstimateP10),t=rm(r.timeEstimateP90);y.innerHTML=`<span style="color: #FFC107;">${e} - ${t}</span>`}else y.textContent="N/A";i.appendChild(y),a.appendChild(i)}),r.appendChild(a),n.appendChild(r),e.appendChild(n)}else{const t=document.createElement("div");t.style.cssText="\n      padding: 24px;\n      text-align: center;\n      background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(76, 175, 80, 0.05));\n      border: 2px solid rgba(76, 175, 80, 0.4);\n      border-radius: 8px;\n      color: #4CAF50;\n    ",t.innerHTML=`\n      <div style="font-size: 48px; margin-bottom: 12px;">‚ú®</div>\n      <div style="font-size: 16px; font-weight: 600; margin-bottom: 8px;">All crops ${v?`(${ag(v)}) `:""}are at maximum size!</div>\n      <div style="font-size: 13px; color: rgba(255, 255, 255, 0.6);">You're doing great! üéâ</div>\n    `,e.appendChild(t)}}let lg=null,cg=!1,dg=null,ug=!1;const pg=Object.freeze(Object.defineProperty({__proto__:null,openCropBoostTrackerWindow:function(){tl("crop-boost-tracker","üå± Crop Size Boost Tracker",e=>{lg=e,cg||(Xp=()=>{dg&&clearTimeout(dg),dg=window.setTimeout(()=>{const e=document.activeElement;e&&"SELECT"===e.tagName||lg&&sg(lg)},100)},cg=!0),sg(e)},"650px","75vh")}},Symbol.toStringTag,{value:"Module"})),mg={rainbow:{blendMode:"color",colors:["#FF1744","#FF9100","#FFEA00","#00E676","#2979FF","#D500F9"],gradientAngle:130,masked:!0},gold:{blendMode:"source-atop",colors:["rgb(255, 215, 0)"],alpha:.7}},fg=new Map,gg=new Set;function hg(e,t){const n=(e??"").toLowerCase();const o=t.toLowerCase(),r=`${n}::${o}`,i=fg.get(r);if(i)return i;const a=function(e){return Di.getPetSprite(e)}(n);if(!a)return function(e){if(gg.has(e))return;gg.add(e),s(`‚ö†Ô∏è Missing base sprite for ${e} while generating mutation variant.`)}(n),null;const l=mg[o];if(!l)return null;try{const e=function(e,t){if("undefined"==typeof document||"function"!=typeof document.createElement)return null;const n=e.width,o=e.height,r=yg(n,o),i=r.getContext("2d");if(!i)return null;i.drawImage(e,0,0),i.save(),i.globalCompositeOperation=t.blendMode,"number"==typeof t.alpha&&(i.globalAlpha=t.alpha);if(t.masked){const n=function(e,t){const n=yg(e.width,e.height),o=n.getContext("2d");if(!o)return null;return bg(o,t,n.width,n.height),o.globalCompositeOperation="destination-in",o.drawImage(e,0,0),o.globalCompositeOperation="source-over",n}(e,t);n&&i.drawImage(n,0,0)}else bg(i,t,n,o);return i.restore(),r}(a,l)??a,t=e.toDataURL("image/png");return fg.set(r,t),t}catch(c){return s("‚ö†Ô∏è Failed to render mutation sprite",c),null}}function bg(e,t,n,o){if(t.colors.length){if(1===t.colors.length)e.fillStyle=t.colors[0]??"#ffffff";else{const r=function(e,t,n,o){const r=(t-90)*(Math.PI/180),i=n/2,a=o/2,s=Math.sqrt(n*n+o*o)/2,l=i-Math.cos(r)*s,c=a-Math.sin(r)*s,d=i+Math.cos(r)*s,u=a+Math.sin(r)*s;return e.createLinearGradient(l,c,d,u)}(e,t.gradientAngle??0,n,o),i=Math.max(1,t.colors.length-1);t.colors.forEach((e,t)=>{r.addColorStop(t/i,e)}),e.fillStyle=r}e.fillRect(0,0,n,o)}}function yg(e,t){const n=document.createElement("canvas");return n.width=e,n.height=t,n}let xg=!1,wg=null;const vg=["common","uncommon","rare","legendary","mythical","divine","celestial"],Cg=vg.reduce((e,t,n)=>(e[t]=n,e),{}),Tg={common:{bg:"#1f2430",color:"#e0e0e0",border:"#2f3644",bar:"linear-gradient(90deg, #9ea7b8, #c7cfdd)",accent:"#c7cfdd"},uncommon:{bg:"#1f3024",color:"#d7f7df",border:"#3a5f44",bar:"linear-gradient(90deg, #5bbf7a, #8ee0a8)",accent:"#8ee0a8"},rare:{bg:"#1f233a",color:"#e6e1ff",border:"#5b5fa8",bar:"linear-gradient(90deg, #6d7dff, #a48bff)",accent:"#a48bff"},legendary:{bg:"#2c210f",color:"#ffecc2",border:"#d9a441",bar:"linear-gradient(90deg, #ffcc55, #ffdf99)",accent:"#ffcc55"},mythical:{bg:"#271a3a",color:"#f2d9ff",border:"#9b6bdf",bar:"linear-gradient(90deg, #b377ff, #e2c3ff)",accent:"#d3a2ff"},divine:{bg:"#301616",color:"#ffe4d7",border:"#d46b4e",bar:"linear-gradient(90deg, #ff7b4a, #ffc2a1)",accent:"#ff9e7a"},celestial:{bg:"linear-gradient(120deg, #1b1f3a, #1f2f46, #2f1f46)",color:"#f8fbff",border:"rgba(255,255,255,0.85)",bar:"linear-gradient(90deg, #ff6ec7, #ffd166, #6ec8ff, #b37bff, #ff6ec7)",accent:"#ffd166"}};function Sg(e){const t=Math.abs(e),n=e=>{const t=e.toFixed(1);return t.endsWith(".0")?t.slice(0,-2):t};return t>=1e15?`${n(t/1e15)}Q`:t>=1e12?`${n(t/1e12)}T`:t>=1e9?`${n(t/1e9)}B`:t>=1e6?`${n(t/1e6)}M`:t>=1e3?`${n(t/1e3)}K`:e.toLocaleString()}function Pg(e,t={}){const n=t.hideTarget??!1,o="number"==typeof e.target?e.target:void 0,r=n?"???":null!=o?Sg(o):"‚Äî",i=e.id.replace(/-\d+$/u,""),a={"garden:seedling":()=>`Plant ${r} crops.`,"garden:harvester":()=>`Harvest ${r} crops.`,"garden:watering":()=>`Use ${r} watering cans.`,"garden:seed-hoarder":()=>`Hold ${r} seeds of one type.`,"pets:hatchling":()=>`Hatch ${r} pets.`,"pets:gold":()=>`Hatch ${r} gold pets.`,"pets:rainbow":()=>`Hatch ${r} rainbow pets.`,"abilities:proc":()=>`Trigger ${r} pet ability procs.`,"economy:crop-earner":()=>`Sell crops worth ${r} coins.`,"weather:fresh-frozen":()=>`Watch it snow ${r} times.`,"weather:early-bird":()=>`Sit through ${r} Dawn moons.`,"weather:night-owl":()=>`Sit through ${r} Amber moons.`,"collection:produce":()=>`Complete ${r} produce journal entries.`,"collection:pets":()=>`Complete ${r} pet journal entries.`};if(e.oneTime)return e.description;const s=a[i];return s?s():n?e.description.replace(/\d[\d,_.]*(?:\s*[A-Za-z]+)?/u,"???"):e.description}const Ag=28,kg={items:"https://magicgarden.gg/version/436ff68/assets/tiles/items.png",animations:"https://magicgarden.gg/version/436ff68/assets/tiles/animations.png",seeds:"https://magicgarden.gg/version/436ff68/assets/tiles/seeds.png",plants:"https://magicgarden.gg/version/436ff68/assets/tiles/plants.png",mutations:"https://magicgarden.gg/version/436ff68/assets/tiles/mutations.png",pets:"https://magicgarden.gg/version/436ff68/assets/tiles/pets.png"},Eg=new Set,$g=new Map;function Mg(e,t){const n=Di.getTile(e,t);if(n)return n;const o=kg[e];return o&&(Eg.has(e)||(Eg.add(e),Di.loadSheetFromUrl(o,e).catch(()=>Eg.delete(e)))),Di.getTile(e,t)}function Fg(e,t,n=28){const o=Mg(e,t);if(!o)return null;const r=o.toDataURL("image/png"),i=document.createElement("div");i.style.cssText=`\n    width: ${n}px;\n    height: ${n}px;\n    background-size: contain;\n    background-repeat: no-repeat;\n    background-position: center;\n    flex-shrink: 0;\n    image-rendering: pixelated;\n    image-rendering: -moz-crisp-edges;\n    image-rendering: crisp-edges;\n  `;try{i.style.backgroundImage=`url(${r})`}catch(a){return s("‚ö†Ô∏è Failed to build tile sprite element",a),null}return i}function Ig(e,t){const n=`${e}:${t}`;if($g.has(n))return $g.get(n)??null;const o=Mg(e,t);if(!o)return null;try{const e=o.toDataURL("image/png");return $g.set(n,e),e}catch(r){return s("‚ö†Ô∏è Failed to read tile data URL",r),null}}function Lg(e,t,n=28){const o=hg(e,t)??Oi(e);if(!o)return null;const r=document.createElement("div");return r.style.cssText=`\n    width: ${n}px;\n    height: ${n}px;\n    background-size: contain;\n    background-repeat: no-repeat;\n    background-position: center;\n    flex-shrink: 0;\n    image-rendering: pixelated;\n    image-rendering: -moz-crisp-edges;\n    image-rendering: crisp-edges;\n  `,r.style.backgroundImage=`url(${o})`,r}function zg(e,t=28){if(!e.length)return null;const n=document.createElement("div");return n.style.cssText=`position: relative; width: ${t}px; height: ${t}px; display: inline-flex; align-items: center; justify-content: center; flex-shrink: 0;`,e.forEach(e=>{e.style.position="absolute",e.style.inset="0",n.appendChild(e)}),n}function Ng(e,t,n=28){const o=Fg(e,t,n),r=Ig(e,t);if(!o||!r)return{element:o,url:r};const i=document.createElement("div");i.style.cssText=`position:absolute; inset:0; background: linear-gradient(135deg, #ff1744, #ff9100, #ffea00, #00e676, #2979ff, #d500f9); mask-image: url(${r}); -webkit-mask-image: url(${r}); mask-size: contain; -webkit-mask-size: contain; mask-repeat: no-repeat; -webkit-mask-repeat: no-repeat; opacity: 0.9; mix-blend-mode: screen;`;return{element:zg([o,i],n)??o,url:r}}function qg(e,t){const n=Lg(e,"rainbow",Ag);if(n){return{element:n,url:hg(e,"rainbow")??Oi(e)??null}}return Ng("pets",t,Ag)}function Bg(e){const t=e.id.replace(/-\d+$/u,""),n=(e,t)=>{const n=Ig(e,t);return{element:Fg(e,t),url:n}},o=(e,t)=>{const n=t?hg(e,t)??Oi(e):Oi(e),o=t?Lg(e,t,Ag):function(e,t){const n=t?.size,o=Oi(e);if(!o)return null;const r=document.createElement("div");return r.style.cssText=`\n    width: ${n}px;\n    height: ${n}px;\n    background-size: contain;\n    background-repeat: no-repeat;\n    background-position: center;\n    flex-shrink: 0;\n    image-rendering: pixelated;\n    image-rendering: -moz-crisp-edges;\n    image-rendering: crisp-edges;\n  `,r.style.backgroundImage=`url(${o})`,r}(e,{size:Ag});return{element:o,url:n}},r={"onetime:this-is-only-the-beginning":()=>qg("worm",9),"onetime:yummy-crop-eater":()=>{const e=qg("worm",9),t=Fg("plants",51,Math.round(1.1*Ag));t&&(t.style.transform="translate(8px, 6px)",t.style.zIndex="1");const n=e.element;n&&(n.style.zIndex="2");const o=[t,n].filter(e=>!!e),r=o.length?zg(o,Ag):e.element,i=Ig("plants",51);return{element:r,url:e.url??i}},"onetime:eating-good":()=>n("pets",6),"onetime:all-i-see-is-money":()=>Ng("pets",4,Ag),"onetime:money-cant-buy-happiness":()=>{const e=Ig("pets",10)??Ig("items",10);return e?function(e,t=28){const n=document.createElement("div");n.style.cssText=`position:absolute; inset:0; background: url(${e}) center/contain no-repeat; image-rendering: pixelated;`;const o=document.createElement("div");return o.style.cssText=`position:absolute; inset:0; background: linear-gradient(135deg, #ff1744, #ff9100, #ffea00, #00e676, #2979ff, #d500f9); mask-image: url(${e}); -webkit-mask-image: url(${e}); mask-size: contain; -webkit-mask-size: contain; mask-repeat: no-repeat; -webkit-mask-repeat: no-repeat; opacity: 0.9; mix-blend-mode: screen;`,{element:zg([n,o],t),url:e}}(e,Ag):Ng("pets",10,Ag)},"onetime:gamblers-fallacy":()=>n("pets",0),"onetime:rich":()=>n("items",0),"onetime:baller-status":()=>n("items",0),"onetime:whos-bill-gates":()=>n("items",0),"onetime:what-is-money":()=>n("items",0),"onetime:what-is-grass":()=>n("items",0),"onetime:god-tier-research":()=>n("animations",92)},i=r[e.id];if(i)return i();const a={"garden:seedling":()=>n("seeds",2),"garden:seed-hoarder":()=>n("seeds",1),"garden:watering":()=>n("items",8),"garden:harvester":()=>n("plants",14),"pets:hatchling":()=>o("bunny"),"pets:gold":()=>o("capybara","gold"),"pets:rainbow":()=>o("peacock","rainbow"),"economy:crop-earner":()=>n("items",10),"abilities:proc":()=>n("items",13),"collection:produce":()=>n("items",24),"collection:pets":()=>n("items",25),"weather:fresh-frozen":()=>n("animations",19),"weather:early-bird":()=>n("animations",49),"weather:night-owl":()=>n("animations",39)}[t]??("weather"===e.category?()=>n("animations",9):void 0);return a?a():{element:null,url:null}}function Rg(e,t,n=52){const{element:o,url:r}=Bg(e),i=document.createElement("div");if(i.style.cssText=`position: relative; width: ${n}px; height: ${n}px; display: inline-flex; align-items: center; justify-content: center; flex-shrink: 0;`,o)o.style.width=`${n}px`,o.style.height=`${n}px`,i.appendChild(o);else if(r){const e=document.createElement("div");e.style.cssText=`position:absolute; inset:0; background: url(${r}) center/contain no-repeat; image-rendering: pixelated;`,i.appendChild(e)}else{const o=document.createElement("div");o.textContent=e.icon??"‚òÖ";const r="celestial"===t?"linear-gradient(135deg, #ff1744, #ff9100, #ffea00, #00e676, #2979ff, #d500f9)":"rgba(255,255,255,0.06)",a="celestial"===t?"transparent":"#fff";o.style.cssText=`\n      position: absolute;\n      inset: 0;\n      display: inline-flex;\n      align-items: center;\n      justify-content: center;\n      font-size: ${Math.max(14,Math.round(.6*n))}px;\n      color: ${a};\n      background: ${r};\n      border-radius: 10px;\n      ${"celestial"===t?"background-clip: text; -webkit-background-clip: text; text-shadow: 0 0 6px rgba(0,0,0,0.35);":""}\n    `,i.appendChild(o)}const a=r??null,s=e.id.startsWith("pets:gold"),l=Cg[t];if(a&&l>=Cg.legendary&&!s){const e=document.createElement("div"),n="celestial"===t?"linear-gradient(135deg, #ff6ec7, #ffd166, #6ec8ff, #b37bff)":Tg[t].bar,o="legendary"===t||"mythical"===t?.5:"divine"===t?.6:"celestial"===t?.8:.65;e.style.cssText=`position:absolute; inset:0; background:${n}; mask-image: url(${a}); -webkit-mask-image: url(${a}); mask-size: contain; -webkit-mask-size: contain; mask-repeat: no-repeat; -webkit-mask-repeat: no-repeat; opacity: ${o}; mix-blend-mode: screen;`,i.appendChild(e)}if(a&&"celestial"===t){const e=document.createElement("div");e.style.cssText=`\n      position:absolute;\n      inset:0;\n      background: linear-gradient(135deg, #ff1744, #ff9100, #ffea00, #00e676, #2979ff, #d500f9);\n      mask-image: url(${a});\n      -webkit-mask-image: url(${a});\n      mask-size: contain;\n      -webkit-mask-size: contain;\n      mask-repeat: no-repeat;\n      -webkit-mask-repeat: no-repeat;\n      opacity: 0.92;\n      mix-blend-mode: screen;\n      filter: saturate(1.05);\n    `,i.appendChild(e)}return i}function Dg(e,t,n){const o=document.createElement("div"),r=e.entries[0]?.category,i=r&&{all:"#8f82ff",garden:"#7cb342",pets:"#64b5f6",abilities:"#ba68c8",shop:"#4dd0e1",weather:"#90caf9",wealth:"#ffca28",collection:"#ff8a65",streaks:"#f06292",obscure:"#b0bec5"}[r]||"#8f82ff";o.style.cssText="\n    background: #0f1624;\n    border: 1px solid rgba(255,255,255,0.05);\n    border-radius: 14px;\n    padding: 14px;\n    box-shadow: 0 10px 28px rgba(0,0,0,0.35);\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n    position: relative;\n    overflow: hidden;\n  ";const a=document.createElement("div");a.style.cssText=`position:absolute; inset:0; background: linear-gradient(135deg, ${i}22, transparent); pointer-events:none;`,o.appendChild(a);const s=document.createElement("div");s.style.cssText="display: grid; grid-template-columns: auto 1fr auto; gap: 10px; align-items: center; position: relative; z-index: 1;";const l=document.createElement("div");l.style.cssText="font-weight: 800; color: #fff; display: inline-flex; align-items: center; gap: 8px; letter-spacing: 0.01em; filter: drop-shadow(0 2px 6px rgba(0,0,0,0.35));";const c=document.createElement("span");c.style.cssText="font-size: 11px; padding: 4px 8px; border-radius: 999px; border: 1px solid rgba(255,255,255,0.12); box-shadow: 0 2px 8px rgba(0,0,0,0.25);";const d=document.createElement("div");d.style.cssText="display: flex; align-items: center; justify-content: space-between; gap: 8px; flex-wrap: wrap; padding: 6px 8px; background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.07); border-radius: 10px; position: relative; z-index: 1;";const u=document.createElement("span");u.style.cssText="font-size: 11px; color: #cfd8dc; font-weight: 700;";const p=document.createElement("div");p.style.cssText="display: flex; gap: 6px; align-items: center;";const m=document.createElement("span");m.textContent=r??"misc",m.style.cssText=`font-size: 11px; padding: 4px 8px; border-radius: 999px; background: ${i}22; color: #e3f2fd; border: 1px solid ${i}44;`;const f=document.createElement("span");f.textContent=e.entries[0]?.title??"Achievement";const g=e=>{if(!e)return;const t=Tg[e.rarity];f.style.color=t.accent??t.color};g(e.entries[0]);const h=e.entries[0],b=h?Bg(h).element:null;b&&l.prepend(b),l.append(f),s.append(l,c);const y=e=>{const t=document.createElement("button");return t.textContent=e,t.style.cssText="border: 1px solid rgba(143,130,255,0.5); background: rgba(255,255,255,0.05); color: #e0e0e0; border-radius: 8px; padding: 4px 8px; cursor: pointer; font-weight: 700;",t},x=y("< Previous"),w=y("Next >");p.append(x,w),d.append(m,u,p);const v=document.createElement("div");if(v.style.cssText="position: relative; max-height: 220px; overflow: hidden; padding-right: 4px;",v.style.overscrollBehavior="contain",!e.entries.length){const e=document.createElement("div");return e.style.cssText="color: #cfd8dc; font-size: 12px;",e.textContent="No achievement data available.",o.append(s,d,e),o}const C=e.entries.map((e,n)=>{const o=function(e,t,n){const o=document.createElement("div");o.dataset.tierIndex=String(n);const r=Tg[e.rarity],i="celestial"===e.rarity?"linear-gradient(180deg, rgba(0,0,0,0.28), rgba(0,0,0,0.28)), ":"";o.style.cssText="padding: 12px; border-radius: 12px; display: flex; flex-direction: column; gap: 10px; scroll-snap-align: start;",o.style.background=`${i}${r.bg}`,o.style.border=`1px solid ${r.border??"rgba(143,130,255,0.25)"}`,o.style.boxShadow="0 8px 18px rgba(0,0,0,0.35)";const a=t.get(e.id),s=a?.current??0,l=a?.target??("number"==typeof e.target?e.target:0),c=l>0?Math.min(100,Math.round(s/l*100)):0,d=!!a?.completedAt,u=!!a?.ineligible,p=e.hiddenTargetUntil,m=!p||!!t.get(p)?.completedAt,f=!d&&null!=p&&!m,g=document.createElement("div");g.style.cssText=`color: ${"celestial"===e.rarity?"#f4f7ff":"#d6e1ec"}; font-size: 12px; line-height: 1.45;`,g.textContent=Pg(e,{hideTarget:f});const h=document.createElement("div");h.style.cssText="background: rgba(255,255,255,0.08); border-radius: 12px; height: 12px; overflow: hidden;";const b=document.createElement("div");b.style.cssText=`height: 100%; width: ${c}%; background: ${r.bar}; transition: width 0.3s;`,h.appendChild(b);const y=document.createElement("div");return y.style.cssText=`display: flex; justify-content: space-between; color: ${"celestial"===e.rarity?"#e4ebff":"#b0bec5"}; font-size: 11px; font-weight: 700; letter-spacing: 0.01em;`,y.textContent=u?"N/A (ineligible)":d?"Completed":f?"Progress hidden until the previous tier is complete":`${s.toLocaleString()} / ${l.toLocaleString()}`,o.append(g,h,y),o}(e,t,n);return o.style.position="absolute",o.style.inset="0",o.style.margin="0",o.style.transition="opacity 0.15s ease",o.style.opacity="0",o.style.pointerEvents="none",v.appendChild(o),o}),T=e=>Math.min(Math.max(e,0),C.length-1),S=e=>{C.forEach((t,n)=>{const o=n===e;t.style.opacity=o?"1":"0",t.style.pointerEvents=o?"auto":"none",t.style.position=o?"relative":"absolute",t.style.boxShadow=o?"0 6px 18px rgba(126,0,252,0.25)":"none"})},P=n.groupPages[e.key],A=Number.isInteger(P)?T(P):(()=>{const n=e.entries.findIndex(e=>!t.get(e.id)?.completedAt),o=-1===n?e.entries.length-1:n;return T(o)})();n.groupPages[e.key]=A;let k=A;const E=()=>{const t=e.entries[k];f.textContent=t.title,g(t),(e=>{const t=Tg[e.rarity];c.textContent=e.rarity.toUpperCase(),c.style.background=t.bg,c.style.color=t.color,c.style.border=`1px solid ${t.border??"rgba(255,255,255,0.12)"}`})(t),u.textContent=`Tier ${k+1} / ${e.entries.length}`,x.disabled=0===k,w.disabled=k===e.entries.length-1,x.style.opacity=x.disabled?"0.5":"1",w.style.opacity=w.disabled?"0.5":"1"},$=t=>{const o=T(t);o!==k&&(k=o,n.groupPages[e.key]=o,E(),S(o))};return C.forEach((e,t)=>{e.addEventListener("click",()=>$(t))}),v.addEventListener("wheel",e=>{e.preventDefault();const t=e.deltaY;t>5?$(k+1):t<-5&&$(k-1)},{passive:!1}),x.addEventListener("click",()=>$(k-1)),w.addEventListener("click",()=>$(k+1)),S(k),E(),s.append(l,c),o.append(s,d,v),setTimeout(()=>S(k),0),o}function Hg(e){const t=jm(),n=Hm().length,o=Array.from(t.values()).filter(e=>e.completedAt).length,r=Am.lastSnapshot?{...Am.lastSnapshot}:null,i=r?.inventoryCount??0,a=r?.inventoryValue,s=r?.cropEarnings??r?.stats?.shop?.totalSpentCoins??r?.shop?.totalSpentCoins??r?.shop?.coinsSpent??0;e.summary.innerHTML=`\n    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px;">\n      <div style="background: linear-gradient(135deg, #7e00fc, #a463ff); border-radius: 12px; padding: 12px; color: #fff; box-shadow: 0 12px 28px rgba(0,0,0,0.4);">\n        <div style="font-size: 26px; font-weight: 900;">${o}/${n}</div>\n        <div style="font-size: 12px; opacity: 0.9;">Completed</div>\n      </div>\n      <div style="background: rgba(255,255,255,0.06); border: 1px solid rgba(143,130,255,0.25); border-radius: 12px; padding: 12px; color: #fff;">\n        <div style="font-size: 14px; font-weight: 700;">Inventory Items</div>\n        <div style="color: #ffecb3; font-weight: 800; font-size: 18px;">${i.toLocaleString()}</div>\n        <div style="color: #b0bec5; font-weight: 700; font-size: 12px; margin-top: 2px;">Value: ${null!=a?lo(a):"‚Äî"}</div>\n      </div>\n      <div style="background: rgba(255,255,255,0.06); border: 1px solid rgba(255,202,40,0.35); border-radius: 12px; padding: 12px; color: #fff;">\n        <div style="font-size: 14px; font-weight: 700;">Crop Value Sold</div>\n        <div style="color: #ffd54f; font-weight: 800; font-size: 18px;">${lo(s)}</div>\n      </div>\n    </div>\n  `}function jg(e,t){const n=jm(),o=t??Hm(),r=o.map(e=>({def:e,prog:n.get(e.id)})).filter(({def:t})=>"all"===e.filterCategory||t.category===e.filterCategory).filter(({def:t,prog:n})=>{if(xg)return!0;const o=!!n?.completedAt&&!n?.ineligible,r="number"==typeof t.target?t.target:n?.target??0,i=n?.current??0,a=!o&&r>0&&i>0&&i<r;return"completed"===e.filterStatus?o:"in-progress"===e.filterStatus?a:o||a}),i=o.filter(t=>"all"===e.filterCategory||t.category===e.filterCategory),a=xg?r.map(({def:e})=>({def:e,prog:n.get(e.id)??{current:e.target??1,target:e.target??1,completedAt:Date.now()}})):r,s=[...vg].reverse(),l=new Map;s.forEach(e=>l.set(e,[])),a.forEach(e=>{const t=l.get(e.def.rarity);t&&t.push(e)}),s.forEach(e=>{const t=l.get(e);t?.sort((e,t)=>{const n=e.prog?.completedAt?new Date(e.prog.completedAt).getTime():0;return(t.prog?.completedAt?new Date(t.prog.completedAt).getTime():0)-n})}),e.badgesList.innerHTML="";const c=i.filter(e=>{const t=n.get(e.id);return!!t?.completedAt&&!t?.ineligible}).length,d=i.length,u=document.createElement("div");u.style.cssText="margin-bottom: 10px; font-weight: 800; color: #fff; letter-spacing: 0.01em; display: flex; align-items: center; gap: 8px;";const p=document.createElement("div");p.textContent=`${c}/${d} badges earned`,p.style.cssText="padding: 6px 10px; border-radius: 999px; background: linear-gradient(135deg, rgba(143,130,255,0.18), rgba(255,255,255,0.08)); border: 1px solid rgba(255,255,255,0.18); font-size: 12px;",u.appendChild(p),e.badgesList.appendChild(u);const m={common:{bg:"linear-gradient(135deg, #1f2430, #252b3a)",border:"1px solid rgba(255,255,255,0.08)",glow:"0 8px 20px rgba(0,0,0,0.35)",text:"#e0e0e0"},uncommon:{bg:"linear-gradient(135deg, #1f3024, #24382a)",border:"1px solid rgba(120,200,140,0.55)",glow:"0 8px 22px rgba(0,255,120,0.15)",text:"#d7f7df"},rare:{bg:"linear-gradient(135deg, #1f233a, #2c3160)",border:"1px solid rgba(160,140,255,0.65)",glow:"0 10px 26px rgba(160,140,255,0.25)",text:"#e6e1ff"},legendary:{bg:"linear-gradient(135deg, #2c210f, #3a2a12)",border:"1px solid rgba(255,215,0,0.7)",glow:"0 12px 28px rgba(255,215,0,0.25)",text:"#ffecc2"},mythical:{bg:"linear-gradient(135deg, #271a3a, #36254d)",border:"1px solid rgba(214,139,255,0.75)",glow:"0 14px 30px rgba(214,139,255,0.35)",text:"#f2d9ff"},divine:{bg:"linear-gradient(135deg, #301616, #3f1c1c)",border:"1px solid rgba(255,180,150,0.85)",glow:"0 16px 32px rgba(255,180,150,0.35)",text:"#ffe4d7"},celestial:{bg:"linear-gradient(135deg, #291f46, #1f2f46, #2f1f46)",border:"1px solid rgba(255,255,255,0.85)",glow:"0 18px 36px rgba(255,255,255,0.4)",text:"#f8fbff"}},f=e=>Sg(e);if(s.forEach(t=>{const n=document.createElement("div");n.style.cssText="display: flex; flex-direction: column; gap: 10px; padding: 8px; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.06); border-radius: 12px; min-height: 120px;";const o=document.createElement("div");o.textContent=t.charAt(0).toUpperCase()+t.slice(1),o.style.cssText="font-weight: 800; color: #fff; font-size: 13px; letter-spacing: 0.02em;",n.appendChild(o);const r=l.get(t)??[];if(r.length||xg){if(!r.length&&xg){const e=document.createElement("div");e.style.cssText="color: #90a4ae; font-size: 11px; padding: 8px; border: 1px dashed rgba(255,255,255,0.08); border-radius: 10px;",e.textContent="Preview only",n.appendChild(e)}else r.forEach(e=>n.appendChild((({def:e,prog:t})=>{const n=m[e.rarity],o=document.createElement("div");o.style.cssText=`\n      background: ${n.bg};\n      border: ${n.border};\n      border-radius: 12px;\n      padding: 10px;\n      display: flex;\n      gap: 10px;\n      align-items: center;\n      box-shadow: ${n.glow};\n    `;const r=Rg(e,e.rarity,56);o.appendChild(r);const i=document.createElement("div");i.style.cssText="display: flex; flex-direction: column; gap: 6px; flex: 1; min-width: 0;";const a=document.createElement("div");a.textContent=e.title,a.style.cssText=`font-weight: 800; color: ${n.text}; font-size: 14px;`;const s=t?.completedAt?new Date(t.completedAt).toLocaleString():"‚Äî",l=document.createElement("div");l.style.cssText="font-size: 11px; color: rgba(255,255,255,0.7);",l.textContent=`Completed: ${s}`;const c=document.createElement("div");c.textContent=Pg(e,{hideTarget:!1}),c.style.cssText="font-size: 11px; color: rgba(255,255,255,0.78); line-height: 1.4;";const d=document.createElement("div"),u=Math.min(t?.current??0,"number"==typeof e.target?e.target:t?.current??0),p="number"==typeof e.target?e.target:t?.target??u,g=`${f(u)} / ${f(p)}`;d.style.cssText=`font-size: 12px; color: ${n.text}; font-weight: 700;`,d.textContent=g;const h=document.createElement("div");h.style.cssText="background: rgba(255,255,255,0.12); border-radius: 999px; height: 8px; overflow: hidden;";const b=document.createElement("div"),y="celestial"===e.rarity?"linear-gradient(90deg, #ff6ec7, #ffd166, #6ec8ff, #b37bff, #ff6ec7)":Tg[e.rarity].bar;return b.style.cssText=`height: 100%; width: 100%; background: ${y};`,h.appendChild(b),i.append(a,c,l,d,h),o.append(i),o})(e)));e.badgesList.appendChild(n)}}),!a.length){const t=document.createElement("div");t.style.cssText="grid-column: 1 / -1; color: #cfd8dc; font-size: 12px; padding: 12px; text-align: center; border: 1px dashed rgba(255,255,255,0.12); border-radius: 10px;",t.textContent="Earn achievements to unlock badges!",e.badgesList.appendChild(t)}}function Wg(e,t){const n=jm(),o=(t??Hm()).filter(e=>e.oneTime);e.oneTimeList.innerHTML="";const r=new Map;vg.forEach(e=>r.set(e,[])),o.forEach(t=>{const o=n.get(t.id),i=!!o?.completedAt,a=!i,s="all"===e.filterStatus||("completed"===e.filterStatus?i:a),l="all"===e.filterCategory||t.category===e.filterCategory;if(!s||!l)return;const c=r.get(t.rarity);c&&c.push({def:t,prog:o})});if(vg.forEach(t=>{const n=r.get(t)??[];if(!n.length)return;const o=document.createElement("div");o.style.cssText="display: flex; flex-direction: column; gap: 10px; padding: 8px; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.06); border-radius: 12px;";const i=document.createElement("div");i.textContent=t.charAt(0).toUpperCase()+t.slice(1),i.style.cssText="font-weight: 800; color: #fff; font-size: 13px; letter-spacing: 0.02em;",o.appendChild(i),n.forEach(e=>o.appendChild((({def:e,prog:t})=>{const n=Tg[e.rarity],o=document.createElement("div");o.style.cssText=`\n      background: ${n.bg};\n      border: 1px solid ${n.border??"rgba(255,255,255,0.12)"};\n      border-radius: 12px;\n      padding: 10px;\n      display: grid;\n      grid-template-columns: auto 1fr;\n      gap: 10px;\n      align-items: center;\n      box-shadow: 0 10px 26px rgba(0,0,0,0.35);\n    `;const r=Rg(e,e.rarity,48);o.appendChild(r);const i=document.createElement("div");i.style.cssText="display: flex; flex-direction: column; gap: 6px; min-width: 0;";const a=document.createElement("div");a.textContent=e.title,a.style.cssText=`font-weight: 800; color: ${n.accent??n.color}; font-size: 14px;`;const s=document.createElement("div");s.textContent=Pg(e,{hideTarget:!1}),s.style.cssText="font-size: 12px; color: #cfd8dc; line-height: 1.4;";const l=document.createElement("div"),c=!!t?.completedAt;return l.textContent=c?`Completed: ${new Date(t.completedAt).toLocaleString()}`:"Not yet earned",l.style.cssText=`font-size: 11px; color: ${c?"#b0f4c6":"#ffcdd2"}; font-weight: 700;`,i.append(a,s,l),o.append(i),o})(e))),e.oneTimeList.appendChild(o)}),!e.oneTimeList.childElementCount){const t=document.createElement("div");t.style.cssText="grid-column: 1 / -1; color: #cfd8dc; font-size: 12px; padding: 12px; text-align: center; border: 1px dashed rgba(255,255,255,0.12); border-radius: 10px;",t.textContent=o.length?"No one-time achievements match this filter.":"No one-time achievements found yet.",e.oneTimeList.appendChild(t)}}function Gg(e){return xg=e??!xg,s("üß™ Badge preview "+(xg?"ENABLED (visual only)":"DISABLED (earned only)")),wg&&jg(wg),xg}"undefined"!=typeof window&&(window.toggleBadgePreview=Gg);const Og=Object.freeze(Object.defineProperty({__proto__:null,createAchievementsWindow:function(){const e=document.createElement("div");e.dataset.achievementsRoot="true",e.style.cssText="display: flex; flex-direction: column; gap: 12px; width: 100%; min-width: min(1100px, 100%); max-width: 100%;";const t=Hm(),n=t.filter(e=>!e.oneTime),o=t.filter(e=>e.oneTime),r=document.createElement("div");r.style.cssText="display: inline-flex; gap: 8px; background: rgba(255,255,255,0.04); padding: 6px; border-radius: 12px; align-self: flex-start; border: 1px solid rgba(255,255,255,0.08);";const i={achievements:document.createElement("button"),badges:document.createElement("button"),onetime:document.createElement("button")};Object.entries(i).forEach(([e,t])=>{t.type="button",t.textContent="achievements"===e?"Achievements":"badges"===e?"Badges":"One-time",t.style.cssText="border: none; padding: 8px 14px; border-radius: 10px; background: transparent; color: #e0e0e0; cursor: pointer; font-weight: 700;",r.appendChild(t)});const a=document.createElement("div"),l=document.createElement("div");l.style.cssText="display: flex; gap: 8px; flex-wrap: wrap; align-items: center;";const c=document.createElement("div");c.style.cssText="display: grid; gap: 14px; grid-template-columns: repeat(auto-fit, minmax(340px, 1fr)); align-items: stretch;";const d=document.createElement("div");d.style.cssText="display: flex; flex-direction: column; gap: 12px;",d.append(a,l,c);const u=document.createElement("div");u.style.cssText="display: grid; gap: 14px; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); align-items: stretch;";const p=document.createElement("div");p.style.cssText="display: none; flex-direction: column; gap: 12px;";const m=document.createElement("div");m.style.cssText="display: flex; gap: 8px; flex-wrap: wrap; align-items: center;";const f=document.createElement("div");f.style.cssText="color: #cfd8dc; font-size: 12px; opacity: 0.9;",f.textContent="Unique achievements that can only be earned once.",p.append(m,f,u);const g=document.createElement("div");g.style.cssText="display: grid; gap: 12px; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); align-items: start; width: 100%;";const h=document.createElement("div");h.style.cssText="display: none; flex-direction: column; gap: 12px;";const b=document.createElement("div");b.style.cssText="display:flex;gap:8px;flex-wrap:wrap;align-items:center;";const y=document.createElement("button");y.type="button",y.textContent="Refresh badges",y.style.cssText="border: 1px solid rgba(143,130,255,0.4); background: rgba(255,255,255,0.06); color: #e0e0e0; border-radius: 8px; padding: 6px 10px; font-weight: 700; cursor: pointer;",y.addEventListener("click",()=>{try{Um()}catch{}jg(w,t)});const x=document.createElement("button");x.type="button",x.textContent="Hide previewed badges",x.style.cssText="border: 1px solid rgba(255,99,132,0.5); background: rgba(255,255,255,0.05); color: #ffcdd2; border-radius: 8px; padding: 6px 10px; font-weight: 700; cursor: pointer;",x.addEventListener("click",()=>{try{Gg(!1)}catch{xg=!1}jg(w,t)}),b.append(y),h.append(b,g),e.append(r,d,p,h);const w={root:e,list:c,oneTimeList:u,badgesList:g,achievementsSection:d,oneTimeSection:p,badgesSection:h,tabButtons:i,summary:a,unsubscribe:null,filterStatus:"in-progress",filterCategory:"all",groupPages:{},activeTab:"achievements"};xg=!1,wg=w;const v=()=>{Object.entries(i).forEach(([e,t])=>{const n=w.activeTab===e;t.style.background=n?"linear-gradient(90deg, #7e00fc, #a463ff)":"transparent",t.style.color=n?"#fff":"#e0e0e0",t.style.boxShadow=n?"0 6px 14px rgba(126,0,252,0.35)":"none"}),d.style.display="achievements"===w.activeTab?"flex":"none",p.style.display="onetime"===w.activeTab?"flex":"none",h.style.display="badges"===w.activeTab?"flex":"none"};i.achievements.addEventListener("click",()=>{w.activeTab="achievements",w.filterStatus="in-progress",P(),v(),E()}),i.badges.addEventListener("click",()=>{w.activeTab="badges",w.filterStatus="completed",P(),v(),jg(w,t)}),i.onetime.addEventListener("click",()=>{w.activeTab="onetime",w.filterStatus="all",P(),v(),Wg(w,o)}),v();const C=[{key:"all",label:"All"},{key:"in-progress",label:"In Progress"},{key:"completed",label:"Completed"}],T=document.createElement("div");T.style.cssText="display: inline-flex; gap: 6px; background: rgba(255,255,255,0.04); padding: 6px; border-radius: 999px; border: 1px solid rgba(143,130,255,0.25);";const S=[],P=()=>{S.forEach(({key:e,btn:t})=>{const n=w.filterStatus===e;t.style.background=n?"linear-gradient(90deg, #7e00fc, #a463ff)":"transparent",t.style.color=n?"#fff":"#e0e0e0",t.style.boxShadow=n?"0 6px 14px rgba(126,0,252,0.35)":"none"})};C.forEach(({key:e,label:n})=>{const r=document.createElement("button");r.type="button",r.textContent=n,r.style.cssText="border: none; padding: 6px 12px; border-radius: 999px; background: transparent; color: #e0e0e0; cursor: pointer; font-weight: 600;",r.addEventListener("click",()=>{w.filterStatus=e,P(),E(),Wg(w,o),jg(w,t)}),S.push({key:e,btn:r}),T.appendChild(r)}),P();const A=document.createElement("div");A.style.cssText="display: inline-flex; gap: 6px; background: rgba(255,255,255,0.04); padding: 6px; border-radius: 999px; border: 1px solid rgba(143,130,255,0.25);",C.forEach(({key:e,label:t})=>{const n=document.createElement("button");n.type="button",n.textContent=t,n.style.cssText="border: none; padding: 6px 12px; border-radius: 999px; background: transparent; color: #e0e0e0; cursor: pointer; font-weight: 600;",n.addEventListener("click",()=>{w.filterStatus=e,P(),E(),Wg(w,o)}),S.push({key:e,btn:n}),A.appendChild(n)}),P();const k=document.createElement("select");k.style.cssText="padding: 8px 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.18); background: linear-gradient(135deg, #0b1020, #141a2a); color: #f5f7ff; box-shadow: inset 0 1px 0 rgba(255,255,255,0.06);",[{key:"all",label:"All Categories"},{key:"garden",label:"Garden"},{key:"pets",label:"Pets"},{key:"abilities",label:"Abilities"},{key:"shop",label:"Shop"},{key:"weather",label:"Weather"},{key:"wealth",label:"Wealth"},{key:"collection",label:"Collection"},{key:"streaks",label:"Streaks"},{key:"obscure",label:"Obscure"}].forEach(({key:e,label:t})=>{const n=document.createElement("option");n.value=e,n.textContent=t,n.style.background="#0b1020",n.style.color="#f5f7ff",k.appendChild(n)}),k.addEventListener("change",()=>{w.filterCategory=k.value,E(),Wg(w,o),jg(w,t)}),l.append(T,k),m.append(A);const E=()=>{const e=n,t=jm();P(),Hg(w),c.innerHTML="";const o=function(e){const t=[],n=new Map;return e.forEach(e=>{const o=e.id.replace(/-\d+$/u,"");n.has(o)||(n.set(o,[]),t.push(o)),n.get(o).push(e)}),t.map(e=>({key:e,entries:(n.get(e)??[]).slice().sort((e,t)=>{const n=Cg[e.rarity]-Cg[t.rarity];return 0!==n?n:("number"==typeof e.target?e.target:0)-("number"==typeof t.target?t.target:0)})}))}(e);o.map(e=>{const n=e.entries[0]?.category;if("all"!==w.filterCategory&&n!==w.filterCategory)return null;const o=e.entries.filter((n,o)=>{const r=t.get(n.id),i=!!r?.completedAt,a=e.entries[o-1],s=!a||!!t.get(a.id)?.completedAt,l=!i&&(s||"common"===n.rarity);return"completed"===w.filterStatus?i:"in-progress"!==w.filterStatus||l});return o.length?{key:e.key,entries:o}:null}).filter(e=>Boolean(e)).forEach(e=>c.appendChild(Dg(e,t,w)))};var $;w.unsubscribe=($=()=>{E(),"onetime"===w.activeTab&&Wg(w,o),"badges"===w.activeTab&&jg(w,t)},Pm.add($),$(jm()),()=>Pm.delete($));try{Um()}catch(M){s("‚ö†Ô∏è Achievements recompute failed",M)}return E(),Wg(w,o),w},toggleBadgePreview:Gg},Symbol.toStringTag,{value:"Module"})),Vg={pets:{Worm:{name:"Worm",hungerCost:500,abilities:{SeedFinderI:50,ProduceEater:50},baseTileScale:.6,maxScale:2,sellPrice:5e3,weight:.1,moveProb:.1,hoursToMature:12,rarity:"Common"},Snail:{name:"Snail",hungerCost:1e3,abilities:{CoinFinderI:100},baseTileScale:.6,maxScale:2,sellPrice:1e4,weight:.15,moveProb:.01,hoursToMature:12,rarity:"Common"},Bee:{name:"Bee",hungerCost:1500,abilities:{ProduceScaleBoost:50,ProduceMutationBoost:50},baseTileScale:.6,maxScale:2.5,sellPrice:3e4,weight:.2,moveProb:.5,hoursToMature:12,rarity:"Common"},Chicken:{name:"Chicken",hungerCost:3e3,abilities:{EggGrowthBoost:80,PetRefund:20},baseTileScale:.8,maxScale:2,sellPrice:5e4,weight:3,moveProb:.2,hoursToMature:24,rarity:"Uncommon"},Bunny:{name:"Bunny",hungerCost:750,abilities:{CoinFinderII:60,SellBoostI:40},baseTileScale:.7,maxScale:2,sellPrice:75e3,weight:2,moveProb:.3,hoursToMature:24,rarity:"Uncommon"},Dragonfly:{name:"Dragonfly",hungerCost:250,abilities:{HungerRestore:70,PetMutationBoost:30},baseTileScale:.6,maxScale:2.5,sellPrice:15e4,weight:.2,moveProb:.7,hoursToMature:24,rarity:"Uncommon"},Pig:{name:"Pig",hungerCost:5e4,abilities:{SellBoostII:30,PetAgeBoost:30,PetHatchSizeBoost:30},baseTileScale:1,maxScale:2.5,sellPrice:5e5,weight:200,moveProb:.2,hoursToMature:72,rarity:"Rare"},Cow:{name:"Cow",hungerCost:25e3,abilities:{SeedFinderII:30,HungerBoost:30,PlantGrowthBoost:30},baseTileScale:1.1,maxScale:2.5,sellPrice:1e6,weight:600,moveProb:.1,hoursToMature:72,rarity:"Rare"},Turkey:{name:"Turkey",hungerCost:500,abilities:{RainDance:60,EggGrowthBoostII_NEW:35,DoubleHatch:5},baseTileScale:1,maxScale:2.5,sellPrice:3e6,weight:10,moveProb:.25,hoursToMature:72,rarity:"Rare"},Squirrel:{name:"Squirrel",hungerCost:15e3,abilities:{CoinFinderIII:70,SellBoostIII:20,PetMutationBoostII:10},baseTileScale:.6,maxScale:2,sellPrice:5e6,weight:.5,moveProb:.4,hoursToMature:100,rarity:"Legendary"},Turtle:{name:"Turtle",hungerCost:1e5,abilities:{HungerRestoreII:25,HungerBoostII:25,PlantGrowthBoostII:25,EggGrowthBoostII:25},baseTileScale:1,maxScale:2.5,sellPrice:1e7,weight:150,moveProb:.05,hoursToMature:100,rarity:"Legendary"},Goat:{name:"Goat",hungerCost:2e4,abilities:{PetHatchSizeBoostII:10,PetAgeBoostII:40,PetXpBoost:40},baseTileScale:1,maxScale:2,sellPrice:2e7,weight:100,moveProb:.2,hoursToMature:100,rarity:"Legendary"},Butterfly:{name:"Butterfly",hungerCost:25e3,abilities:{ProduceScaleBoostII:40,ProduceMutationBoostII:40,SeedFinderIII:20},baseTileScale:.6,maxScale:2.5,sellPrice:5e7,weight:.2,moveProb:.6,hoursToMature:144,rarity:"Mythic"},Peacock:{name:"Peacock",hungerCost:1e5,abilities:{SellBoostIV:40,PetXpBoostII:50,PetRefundII:10},baseTileScale:1.2,maxScale:2.5,sellPrice:1e8,weight:5,moveProb:.2,hoursToMature:144,rarity:"Mythic"},Capybara:{name:"Capybara",hungerCost:15e4,abilities:{DoubleHarvest:50,ProduceRefund:50},baseTileScale:1,maxScale:2.5,sellPrice:2e8,weight:50,moveProb:.2,hoursToMature:144,rarity:"Mythic"}}},_g=new Map;function Ug(e){return e.trim().toLowerCase()}function Xg(e){return Math.abs(e)>=1e9?`${(e/1e9).toFixed(2)}B`:Math.abs(e)>=1e6?`${(e/1e6).toFixed(2)}M`:Math.abs(e)>=1e3?`${(e/1e3).toFixed(2)}K`:e.toFixed(0)}function Kg(e){return null==e||Number.isNaN(e)?"‚Äî":Xg(e)}!function(){const e=Vg;if(e?.pets)for(const[t,n]of Object.entries(e.pets))n&&_g.set(Ug(t),{weight:"number"==typeof n.weight?n.weight:null,maturityHours:"number"==typeof n.hoursToMature?n.hoursToMature:null,hungerCost:"number"==typeof n.hungerCost?n.hungerCost:null,sellPrice:"number"==typeof n.sellPrice?n.sellPrice:null,rarity:n.rarity??null})}();const Jg=[{id:"crop_harvest_value",name:"Crop Harvest Value",displayName:"üí∞ Crop Harvest Value",description:"Abilities that increase coin income through harvesting and selling crops",abilityIds:["DoubleHarvest","ProduceRefund","SellBoostI","SellBoostII","SellBoostIII","SellBoostIV"],comparisonMetric:"garden_impact",calculateComparableValue:(e,t)=>{const n=Ws(In());if(null!=e.gardenValuePerProc&&e.gardenValuePerProc>0)return e.gardenValuePerProc;try{const o=Vs(e.id,n,t??100);if(o&&o.effectPerProc>0)return o.effectPerProc}catch(o){}if(n.totalMatureValue>0&&n.crops.length>0){const t=n.totalMatureValue/n.crops.length;if("DoubleHarvest"===e.id)return t;if("ProduceRefund"===e.id)return t;if(e.id.startsWith("SellBoost")){const t=10+2*((e.tier??1)-1);return n.totalMatureValue*t/100}return t}return null!=e.effectiveValue&&e.effectiveValue>0?e.effectiveValue:null}},{id:"mutation",name:"Mutation",displayName:"üåü Mutation & Transformation",description:"Abilities that transform crops through size increases or color mutations",abilityIds:["ProduceScaleBoost","ProduceScaleBoostII","ProduceMutationBoost","ProduceMutationBoostII","GoldGranter","RainbowGranter"],comparisonMetric:"garden_impact",calculateComparableValue:(e,t)=>{const n=Ws(In());try{const o=Vs(e.id,n,t??100);if(o&&o.effectPerProc>0){return(e.procsPerHour??0)*o.effectPerProc}}catch(o){}return null!=e.valuePerHour&&e.valuePerHour>0?e.valuePerHour:null!=e.gardenValuePerProc&&null!=e.procsPerHour?e.gardenValuePerProc*e.procsPerHour:null}}],Qg=new Map;for(const sb of Jg)for(const e of sb.abilityIds)Qg.set(e,sb);function Yg(e){return Qg.get(e)??null}function Zg(e){const t=null!=e.effectiveProbability?`${e.effectiveProbability.toFixed(1)}%`:"‚Äî",n=null!=e.procsPerHour?`${e.procsPerHour.toFixed(2)}/hr`:"‚Äî",o=e.baseName?.toLowerCase()??e.name.toLowerCase(),r=o.includes("egg growth"),i=o.includes("plant growth"),a=o.includes("rainbow")||o.includes("gold")||o.includes("size")||"coins"===e.effectUnit,s="xp"===e.effectUnit||"xp"===e.category;if(r){const o=e.valuePerHour??e.effectiveValue??null;return{valueText:null!=o?`${o.toFixed(1)} min/hr`:"‚Äî",procsText:n,probText:t}}if(i){const o=e.valuePerHour??e.effectiveValue??null;return{valueText:null!=o?`${o.toFixed(1)} min/hr`:"‚Äî",procsText:n,probText:t}}if(a){return{valueText:null!=e.valuePerHour?`${Kg(e.valuePerHour)}/hr`:"‚Äî",procsText:n,probText:t}}if(s){return{valueText:null!=e.valuePerHour?`${Xg(e.valuePerHour)} XP/hr`:"‚Äî",procsText:n,probText:t}}if(e.effectLabel&&null!=e.effectiveValue){return{valueText:`${e.effectLabel}: ${e.effectiveValue.toFixed(2)}${e.effectSuffix??""}`,procsText:n,probText:t}}return{valueText:null!=e.valuePerHour?`${Xg(e.valuePerHour)}/hr`:"‚Äî",procsText:n,probText:t}}function eh(e,t,n){if(!t||!n||t<=0||n<=t)return e;const o=n/t;return{...e,effectiveProbability:null!=e.effectiveProbability?e.effectiveProbability*o:null,procsPerHour:null!=e.procsPerHour?e.procsPerHour*o:null,procsPerDay:null!=e.procsPerDay?e.procsPerDay*o:null,valuePerHour:null!=e.valuePerHour?e.valuePerHour*o:null,valuePerDay:null!=e.valuePerDay?e.valuePerDay*o:null,gardenValuePerProc:null!=e.gardenValuePerProc?e.gardenValuePerProc*o:null,effectiveValue:null!=e.effectiveValue?e.effectiveValue*o:e.effectiveValue}}const th={plantGrowth:{base:"#2E7D32",glow:"rgba(46,125,50,0.65)",text:"#C8E6C9",border:"rgba(200,230,201,0.4)",label:"Plant Growth"},eggGrowth:{base:"#FF7043",glow:"rgba(255,112,67,0.65)",text:"#FFE0B2",border:"rgba(255,224,178,0.45)",label:"Egg Growth"},xp:{base:"#7C4DFF",glow:"rgba(124,77,255,0.65)",text:"#EDE7F6",border:"rgba(237,231,246,0.45)",label:"XP"},coins:{base:"#FFB300",glow:"rgba(255,179,0,0.65)",text:"#FFF8E1",border:"rgba(255,248,225,0.45)",label:"Coins"},misc:{base:"#90A4AE",glow:"rgba(144,164,174,0.6)",text:"#ECEFF1",border:"rgba(236,239,241,0.4)",label:"Ability"},hunger:{base:"#26C6DA",glow:"rgba(38,198,218,0.65)",text:"#E0F7FA",border:"rgba(224,247,250,0.45)",label:"Hunger"},mutation:{base:"#EC407A",glow:"rgba(236,64,122,0.6)",text:"#FCE4EC",border:"rgba(252,228,236,0.45)",label:"Mutation"},rainbow:{base:"#7C4DFF",glow:"rgba(124,77,255,0.7)",text:"#F3E5F5",border:"rgba(243,229,245,0.55)",label:"Rainbow"},gold:{base:"#FDD835",glow:"rgba(253,216,53,0.75)",text:"#FFFDE7",border:"rgba(255,253,231,0.55)",label:"Gold"},default:{base:"#5E5CE6",glow:"rgba(94,92,230,0.5)",text:"#E0E7FF",border:"rgba(224,231,255,0.4)",label:"Ability"}};function nh(e){const t=(e||"").toLowerCase();return t.includes("rainbow")?"linear-gradient(135deg, #FF0000 0%, #FF7F00 16.67%, #FFFF00 33.33%, #00FF00 50%, #0000FF 66.67%, #4B0082 83.33%, #9400D3 100%)":t.includes("gold")||t.includes("golden")?"linear-gradient(135deg, #FFD700 0%, #FFA500 50%, #FFD700 100%)":t.includes("crop eater")||t.includes("crop refund")?"#FF5722":t.includes("crop mutation boost")?"#E91E63":t.includes("crop size boost")?"#4CAF50":t.includes("seed finder")?"#FF9800":t.includes("coin finder")?"#FFD700":t.includes("egg growth boost")?"#9C27B0":t.includes("pet refund")?"#00BCD4":t.includes("pet mutation boost")?"#E91E63":t.includes("sell boost")?"#F44336":t.includes("hunger restore")||t.includes("hunger boost")?"#EC407A":t.includes("hatch xp boost")?"#7C4DFF":t.includes("xp boost")?"#2196F3":t.includes("max strength boost")?"#673AB7":t.includes("plant growth boost")?"#26A69A":t.includes("rain dance")?"#2196F3":t.includes("double hatch")?"#5C6BC0":t.includes("double harvest")?"#1976D2":"#90A4AE"}const oh={left:{border:"rgba(64,196,255,0.7)",glow:"0 0 22px rgba(64,196,255,0.35)",text:"#C9F1FF",gradient:"linear-gradient(135deg, rgba(64,196,255,0.16), rgba(10,23,42,0.75))",accent:"#7dd3ff"},right:{border:"rgba(189,147,249,0.8)",glow:"0 0 22px rgba(189,147,249,0.4)",text:"#F7E5FF",gradient:"linear-gradient(135deg, rgba(189,147,249,0.18), rgba(25,6,41,0.8))",accent:"#e3b7ff"}};function rh(e,t,n,o){const r=function(e){return null==e||Number.isNaN(e)?null:Math.max(0,Math.min(100,e))}(n);return`\n    <div style="display:flex;flex-direction:column;gap:6px;padding:8px 10px;border-radius:12px;background:rgba(0,0,0,0.25);border:1px solid rgba(255,255,255,0.08);">\n      <div style="display:flex;justify-content:space-between;align-items:center;">\n        <span style="font-size:11px;color:rgba(255,255,255,0.75);letter-spacing:0.4px;">${e}</span>\n        <span style="font-size:13px;font-weight:700;color:${o};">${t}</span>\n      </div>\n      <div style="height:8px;border-radius:999px;background:rgba(255,255,255,0.08);overflow:hidden;">\n        <div style="height:100%;width:${null!=r?`${r}%`:"0%"};background:linear-gradient(90deg, ${o}, rgba(255,255,255,0.65));transition:width 0.3s ease;"></div>\n      </div>\n    </div>\n  `}const ih=["rainbow","gold"],ah=new WeakMap;let sh=null,lh=!1;const ch="rgba(64, 255, 194, 0.28)",dh="rgba(64, 255, 194, 0.9)",uh=new Map;function ph(e){return`${e.species??"unknown"}-${e.mutations&&e.mutations.length?e.mutations.join(","):"none"}`}const mh=new Map,fh=new Set;let gh=0,hh=!1;function bh(e){if(!e)return;e.querySelectorAll("[data-pet-sprite-id]").forEach(e=>{"1"!==e.dataset.petSpriteHydrated&&e.dataset.petSpriteId&&fh.add(e)}),fh.size&&yh()}function yh(){if(hh)return;hh=!0;const e=b?.requestAnimationFrame??window.requestAnimationFrame;"function"==typeof e?e(xh):window.setTimeout(xh,16)}function xh(){if(hh=!1,!fh.size)return;const e=performance.now();for(const t of Array.from(fh))if(fh.delete(t),wh(t),performance.now()-e>=12)break;fh.size&&yh()}function wh(e){if(!e.isConnected){const t=e.dataset.petSpriteId;return t&&mh.delete(t),e.removeAttribute("data-pet-sprite-id"),void(e.dataset.petSpriteHydrated="1")}const t=e.dataset.petSpriteId;if(!t)return;const n=mh.get(t);if(!n)return e.dataset.petSpriteHydrated="1",void e.removeAttribute("data-pet-sprite-id");const o=Ch({species:n.species,mutations:n.mutations,hasGold:n.hasGold,hasRainbow:n.hasRainbow});o&&(e.style.backgroundImage=`url(${o})`,n.species&&uh.set(ph(n),o)),mh.delete(t),e.dataset.petSpriteHydrated="1",e.removeAttribute("data-pet-sprite-id")}const vh=e=>{if(!sh)return;const t=e.target;t&&(sh.element.contains(t)||sh.select.contains(t))||Rh()};function Ch(e){if(!e?.species)return null;const t=e.species.toLowerCase(),n=function(e){const t=new Set,n=e=>{const n=function(e){const t=String(e??"").toLowerCase();return"rainbow"===t?"rainbow":"gold"===t?"gold":null}(e);n&&t.add(n)};(e.mutations??[]).forEach(n),e.hasRainbow&&n("rainbow");e.hasGold&&n("gold");return t}(e);for(const o of ih)if(n.has(o)){const e=hg(t,o);if(e)return e}return Oi(t)}const Th=new Set;let Sh=[],Ph="unknown",Ah=!1,kh=null,Eh=null;function $h(){kh||(kh=(async()=>{const e=function(){let e;const t=function(){const e=b.AriesMod??window.AriesMod??w("AriesMod"),t=e?.services?.PetsService;if(t&&"function"==typeof t.getTeams&&!1!==t.enabled)return s("[Aries] ‚úÖ Found PetsService via AriesMod.services.PetsService"),t;return null}();if(t)return t;if(e=b.PetsService,e&&"function"==typeof e.getTeams)return s("[Aries] ‚úÖ Found PetsService at pageWindow.PetsService"),e;if(y&&(e=window.PetsService,e&&"function"==typeof e.getTeams))return s("[Aries] ‚úÖ Found PetsService at window.PetsService"),e;if(e=w("PetsService"),e&&"function"==typeof e.getTeams)return s("[Aries] ‚úÖ Found PetsService via readSharedGlobal"),e;const n=b.QWS;if(n&&"object"==typeof n.PetsService&&(e=n.PetsService??void 0,e&&"function"==typeof e.getTeams))return s("[Aries] ‚úÖ Found PetsService at pageWindow.QWS.PetsService"),e;const o=window.QWS;if(o&&"object"==typeof o.PetsService&&(e=o.PetsService??void 0,e&&"function"==typeof e.getTeams))return s("[Aries] ‚úÖ Found PetsService at window.QWS.PetsService"),e;const r=function(){const e=[b.aries_mod,window.aries_mod,w("aries_mod"),Ih("aries_mod")];for(const t of e){if(!Fh(t).length)continue;const e=()=>Lh(Fh(t));return s("[Aries] ‚úÖ Found teams via aries_mod state"),{getTeams:e}}return null}();if(r)return r;const i=function(){const e=["qws:pets:teams:v1","MGA_petPresets","aries:teams","aries:petTeams","qws:teams","qws:petTeams","petTeams","teams"];for(const t of e)try{const e=localStorage.getItem(t);if(!e)continue;const n=JSON.parse(e);if(!Array.isArray(n))continue;if(n.every(e=>e&&"object"==typeof e&&"id"in e&&"name"in e&&"slots"in e&&Array.isArray(e.slots))&&n.length>0)return{getTeams:()=>n}}catch{}return null}();if(i)return s("[Aries] ‚úÖ Found teams in localStorage"),i;return null}();if(!e)return Ph="unavailable",Mh(),kh=null,void(null==Eh&&Th.size>0&&(Eh=window.setTimeout(()=>{Eh=null,$h()},4e3)));if(s("[Aries] üîó PetsService detected, setting up team sync"),null!=Eh&&(window.clearTimeout(Eh),Eh=null),Ah)kh=null;else{Ah=!0,Ph="ready";try{Sh=await async function(e){try{return Lh(await Promise.resolve(e.getTeams()))}catch(t){return s("Aries getTeams failed",t),[]}}(e),s(`[Aries] Loaded ${Sh.length} team(s):`,Sh.map(e=>e.name).join(", ")),Mh()}catch(t){s("[Aries] Failed to read Aries teams",t)}if("function"==typeof e.onTeamsChangeNow)try{await e.onTeamsChangeNow(e=>{Sh=Lh(e),s(`[Aries] Teams updated: ${Sh.length} team(s)`),Mh()}),s("[Aries] Successfully subscribed to team changes")}catch(t){s("[Aries] Failed to subscribe to Aries teams",t)}else s("[Aries] onTeamsChangeNow not available; presets will be static");kh=null}})().catch(e=>{s("Aries watcher setup failed",e),kh=null}))}function Mh(){const e={status:Ph,teams:Sh};for(const n of Th)try{n(e)}catch(t){s("Aries listener failed",t)}}function Fh(e){if(!e||"object"!=typeof e)return[];const t=e.pets??e.pet??e,n=t?.teams??t?.presets??t?.petTeams??t?.petTeam;return Array.isArray(n)?n:n&&"object"==typeof n?Object.values(n):[]}function Ih(e){try{const t=localStorage.getItem(e);return t?JSON.parse(t):null}catch{return null}}function Lh(e){if(!Array.isArray(e))return[];const t=[];return e.forEach(e=>{const n=function(e){if(!e||"object"!=typeof e)return null;const t=e,n=zh(t.id??t.teamId??t.key)??`team-${Math.random().toString(36).slice(2,8)}`,o=t.name??t.label??t.title??n,r="string"==typeof o&&o.trim().length?o.trim():`Team ${n}`,i=Array.isArray(t.slots)?t.slots:Array.isArray(t.team)?t.team:[],a=[];for(let s=0;s<3;s+=1)a.push(zh(i[s]));return{id:n,name:r,slotIds:a}}(e);n&&t.push(n)}),t}function zh(e){if("string"==typeof e){const t=e.trim();return t.length?t:null}if("number"==typeof e&&Number.isFinite(e))return String(e);if(e&&"object"==typeof e){const t=e;return zh(t.id)??zh(t.petId)??zh(t.slotId)??null}return null}function Nh(e,t){let n=e.isConnected;const o=new MutationObserver(()=>{const r=e.isConnected;n||!r?n&&!r&&(o.disconnect(),t()):n=!0});o.observe(document.body,{childList:!0,subtree:!0})}function qh(e,t){ah.has(e)||(ah.set(e,t),e.style.cursor="pointer",e.addEventListener("mousedown",t=>{e.disabled||(t.preventDefault(),t.stopPropagation(),function(e){sh?.select===e?Rh():Bh(e)}(e))}),e.addEventListener("keydown",t=>{e.disabled||("ArrowDown"===t.key||"Enter"===t.key||" "===t.key?(t.preventDefault(),Bh(e)):"Escape"===t.key&&Rh())}))}function Bh(e){const t=ah.get(e);if(!t)return;const n=Array.from(e.options);if(!n.length)return;Rh();const o=t(),r=e.getBoundingClientRect(),i=document.createElement("div"),a=r.left+window.scrollX,s=r.bottom+window.scrollY+8;let l=Math.min(360,window.innerHeight-r.bottom-8-4),c=s;if(l<160){const e=r.top-8;e>l&&(l=Math.min(360,e),c=r.top+window.scrollY-8-l)}const d=l>0?Math.min(360,l):240;i.style.cssText=`\n    position: absolute;\n    left: ${a}px;\n    top: ${c}px;\n    width: ${r.width}px;\n    max-height: ${d}px;\n    overflow-y: auto;\n    background: rgba(8, 10, 15, 0.98);\n    border: 1px solid var(--qpm-border);\n    border-radius: 10px;\n    box-shadow: 0 18px 40px rgba(0,0,0,0.55);\n    z-index: 1000000;\n    padding: 6px;\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n  `,n.forEach(t=>{const n=Number(t.value),r=Number.isFinite(n)?o[n]??null:null,a=r?Ch(r.stats):null,s=function(e,t,n,o,r){const i=document.createElement("button");i.type="button",i.style.cssText=`\n    width: 100%;\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 8px 10px;\n    border: none;\n    border-radius: 8px;\n    background: ${r?"rgba(143,130,255,0.18)":"transparent"};\n    color: var(--qpm-text);\n    font-size: 13px;\n    text-align: left;\n    cursor: pointer;\n  `;const a=document.createElement("div");a.style.cssText=`\n    width: 30px;\n    height: 30px;\n    border-radius: 8px;\n    flex-shrink: 0;\n    image-rendering: pixelated;\n    background: ${o?`url("${o}") center/contain no-repeat`:"rgba(255,255,255,0.05)"};\n  `;const s=document.createElement("div");s.style.cssText="flex:1;font-weight:600;",s.textContent=n,i.appendChild(a),i.appendChild(s);const l=e=>{i.style.background="hover"===e?"rgba(143,130,255,0.22)":"selected"===e?"rgba(143,130,255,0.18)":"transparent"};r&&l("selected");return i.addEventListener("mouseenter",()=>l("hover")),i.addEventListener("mouseleave",()=>l(r?"selected":"idle")),i.addEventListener("click",()=>{e.value!==t&&(e.value=t,e.dispatchEvent(new Event("change",{bubbles:!0}))),Rh()}),i}(e,t.value,t.textContent??t.value,a,t.value===e.value);i.appendChild(s)}),i.children.length||(i.textContent="No pets available",i.style.color="var(--qpm-text-dim)",i.style.textAlign="center",i.style.padding="12px"),document.body.appendChild(i),sh={element:i,select:e},function(){if(lh)return;lh=!0,document.addEventListener("mousedown",Hh,!0),window.addEventListener("resize",Rh),document.addEventListener("scroll",vh,!0),document.addEventListener("keydown",jh,!0)}()}function Rh(){sh&&(sh.element.remove(),sh=null,Dh())}function Dh(e=!1){lh&&(!e&&sh||(lh=!1,sh=null,document.removeEventListener("mousedown",Hh,!0),window.removeEventListener("resize",Rh),document.removeEventListener("scroll",vh,!0),document.removeEventListener("keydown",jh,!0)))}function Hh(e){if(!sh)return;const t=e.target;sh.element.contains(t)||sh.select.contains(t)||Rh()}function jh(e){"Escape"===e.key&&Rh()}const Wh=["Inventory","inventoryAtom","lockerAtom"],Gh=["petHutchAtom","petHutch","hutchAtom","petHutchData","hutchPets","petHutchPets","Hutch Pets","petHutchEntries","/home/runner/work/magiccircle.gg/magiccircle.gg/client/src/games/Quinoa/atoms/inventoryAtoms.ts/myPetHutchStoragesAtom","/home/runner/work/magiccircle.gg/magiccircle.gg/client/src/games/Quinoa/atoms/inventoryAtoms.ts/myPetHutchItemsAtom","/home/runner/work/magiccircle.gg/magiccircle.gg/client/src/games/Quinoa/atoms/inventoryAtoms.ts/myPetHutchPetItemsAtom","/home/runner/work/magiccircle.gg/magiccircle.gg/client/src/games/Quinoa/atoms/inventoryAtoms.ts/myNumPetHutchItemsAtom"];function Oh(e){const t=(e,n)=>{if(n>4||null==e)return[];if(Array.isArray(e)){const t=e.filter(e=>e&&"object"==typeof e);if(t.length)return t}if("object"!=typeof e)return[];const o=[],r=["items","pets","inventory","entries","list","data","value"];for(const t of r){const n=e[t];Array.isArray(n)&&o.push(...n.filter(e=>e&&"object"==typeof e))}for(const i of Object.values(e))o.push(...t(i,n+1));return o};return t(e,0)}function Vh(e){if(!e||"object"!=typeof e)return!1;if(e.petSpecies||e.species)return!0;if(Array.isArray(e.abilities)||Array.isArray(e.mutations))return!0;return!!String(e.itemType??e.type??"").toLowerCase().includes("pet")||!(!e.pet||"object"!=typeof e.pet)&&Boolean(e.pet.species||e.pet.petSpecies)}function _h(e,t){const n=e?.id??e?.petId??e?.itemId??e?.slotId??e?.uuid;if(n)return`${t}:${String(n)}`;return`${t}:${(e?.petSpecies??e?.species??"unknown").toLowerCase()}:${e?.xp??e?.pet?.xp??0}:${e?.targetScale??e?.pet?.targetScale??""}:${Array.isArray(e?.mutations)?e.mutations.length:0}`}function Uh(e,t){const n=new Set,o=[];for(const r of e){if(!Vh(r))continue;const e=_h(r,t);n.has(e)||(n.add(e),o.push(r))}return o}async function Xh(e){const t=F(e);if(!t)return[];try{return Oh(await I(t))}catch(n){return s(`Failed to read ${e}:`,n),[]}}async function Kh(){let e=[];for(const t of Wh){const n=await Xh(t);n.length&&(e=e.concat(n))}if(!e.length){const t=Xl();for(const n of t){const t=n.raw,o=Boolean(t?.petSpecies||t?.species);(n.itemType&&"pet"===n.itemType.toLowerCase()||n.species||o)&&e.push(t??n)}}return Uh(e,"inventory")}async function Jh(){let e=[];for(const o of Gh){const t=await Xh(o);t.length&&(e=e.concat(t))}if(!e.length)try{const n=M(/PetHutch|hutch/i);for(const o of n)try{const t=await I(o);e=e.concat(Oh(t))}catch(t){s("Failed reading hutch atom candidate",t)}}catch(t){s("Failed to scan atom cache for hutch",t)}if(!e.length)try{const t="undefined"!=typeof unsafeWindow?unsafeWindow:window,n=Object.keys(t).filter(e=>e.toLowerCase().includes("hutch"));for(const r of n){const n=t[r];if(n&&"object"==typeof n&&(n.debugLabel||n.label))try{const t=await I(n);e=e.concat(Oh(t));continue}catch{}if(e=e.concat(Oh(n)),n instanceof Map)for(const[,t]of n.entries()){const n=t?.value??t;e=e.concat(Oh(n))}}const o=Object.values(t).find(e=>e instanceof Map&&[...e.keys()].some(e=>String(e).includes("myPetHutch")));if(o)for(const[,r]of o.entries()){const t=r?.value??r;if(r?.debugLabel??r?.label??"")try{const t=await I(r);e=e.concat(Oh(t));continue}catch{}e=e.concat(Oh(t))}}catch(n){s("Failed to scan global hutch entries",n)}return Uh(e,"hutch")}function Qh(e){return e&&Array.isArray(e)?e.map(e=>"string"==typeof e?e:e&&"object"==typeof e?e.name??e.type??e.abilityType??null:null).filter(e=>Boolean(e)):[]}function Yh(e,t){let n=0;const o=Array.from(e.options);for(const r of o){if(n>=16)break;const e=Number(r.value);if(!Number.isFinite(e))continue;const o=t[e];if(!o)continue;const i=uh.get(ph(o.stats));i&&(r.style.backgroundImage=`url(${i})`,r.style.backgroundRepeat="no-repeat",r.style.backgroundSize="20px 20px",r.style.backgroundPosition="6px center",r.style.paddingLeft="30px",r.style.imageRendering="pixelated",n+=1)}}function Zh(e,t){const n=Ch(t?.stats??null);n?(e.style.backgroundImage=`url(${n})`,e.style.backgroundRepeat="no-repeat",e.style.backgroundSize="24px 24px",e.style.backgroundPosition="8px center",e.style.paddingLeft="40px",e.style.imageRendering="pixelated"):(e.style.backgroundImage="",e.style.paddingLeft="12px")}async function eb(){const e=[];let t=0;const n=async()=>{t+=1,t%8==0&&await new Promise(e=>{const t=b?.requestAnimationFrame??window.requestAnimationFrame;"function"!=typeof t?setTimeout(e,0):t(()=>e())})},o=async(t,o,r)=>{try{const n=nf(t);e.push({stats:n,source:o,petInfo:t})}catch(i){s(r,i)}finally{await n()}},r=async(e,t)=>{try{const n=function(e){if(!e||"object"!=typeof e)return null;if(!(e.petSpecies||e.pet?.species||e.itemType&&String(e.itemType).toLowerCase().includes("pet")||e.type&&String(e.type).toLowerCase().includes("pet")))return null;const t=e.petSpecies??e.species??e.pet?.species??null;if(!t)return null;const n=e.targetScale??e.pet?.targetScale??null;let o=null;if(null!=n&&(o=Fp(n,t),null==o)){const e=Mp(t)??2;if(e>1){const t=(n-1)/(e-1);o=Math.round(80+20*t)}}null==o&&(o=100);let r=e.strength??e.pet?.strength??null;if(null!=r&&r>o&&(r=o),null==r&&null!=e.xp){const n=Ep(t);if(n&&n>0){const t=Math.min(30,Math.floor(e.xp/n)),i=50,a=(o-i)/30;r=Math.min(o,Math.round(i+t*a))}}const i=Qh(e.mutations??e.pet?.mutations),a=Qh(e.abilities??e.pet?.abilities);return{slotIndex:-1,slotId:null,petId:e.id??e.petId??null,hungerPct:null,hungerValue:null,hungerMax:null,hungerRaw:null,name:e.name??e.pet?.name??null,species:t,targetScale:n,mutations:i,abilities:a,xp:e.xp??e.pet?.xp??null,level:r,levelRaw:null,strength:r,position:null,updatedAt:Date.now(),raw:e}}(e);if(!n)return;await o(n,t,`Failed to get stats for ${t} pet:`)}catch(r){s(`Failed to convert ${t} entry to pet info:`,r),await n()}},i=vr();for(const s of i)await o(s,"active","Failed to get stats for active pet:");const[a,l]=await Promise.all([Kh(),Jh()]);for(const s of a)await r(s,"inventory");for(const s of l)await r(s,"hutch");return e}function tb(e,t,n=!1){const o=e.species?function(e){const t="sprite-"+ ++gh;return mh.set(t,{species:e.species??null,mutations:[...e.mutations??[]],hasGold:Boolean(e.hasGold),hasRainbow:Boolean(e.hasRainbow)}),t}(e):null;return`\n    <div ${o?`data-pet-sprite-id="${o}"`:""} style="${`\n    width: ${t}px;\n    height: ${t}px;\n    border-radius: ${Math.round(.2*t)}px;\n    background: linear-gradient(135deg,#3a3f5a,#202437);\n    position: relative;\n    overflow: hidden;\n    image-rendering: pixelated;\n    background-size: contain;\n    background-repeat: no-repeat;\n    background-position: center;\n    ${n?"border: 1px solid var(--qpm-border);":""}\n  `}"></div>\n  `}function nb(e){const t=document.createElement("div");if(e.length<2)return t.innerHTML='<div style="padding:20px;color:var(--qpm-text-dim);">Need at least 2 pets to compare.</div>',t;let n=0,o=1,r="";const i=document.createElement("div"),a=()=>{Rh();const t=e=>{if(!r.trim())return!0;if(r.startsWith("group:")){const t=r.substring(6);return e.stats.abilities.some(e=>{const n=Yg(e.id);return n&&n.id===t})}return e.stats.abilities.some(e=>e.name.toLowerCase().includes(r.toLowerCase())||(e.baseName||"").toLowerCase().includes(r.toLowerCase()))};[b,x].forEach((r,i)=>{const a=r.value;r.innerHTML="",e.forEach((e,n)=>{if(!t(e))return;const o=document.createElement("option");o.value=n.toString(),o.textContent=`${e.stats.name||e.stats.species||"Pet"} [${e.stats.currentStrength??"?"} STR]`,r.appendChild(o)}),Yh(r,e),qh(r,()=>e);if(Array.from(r.options).some(e=>e.value===a))r.value=a;else if(r.options.length){r.selectedIndex=0;const e=Number(r.value);0===i?n=e:o=e}});const a=e[n],s=e[o];Zh(b,a),Zh(x,s),a&&s&&t(a)&&t(s)?(i.innerHTML="",i.appendChild(ob(a,s,0,r)),bh(i)):i.innerHTML='<div style="padding:12px;color:var(--qpm-text-dim);">Select two pets with the chosen ability.</div>'},s=document.createElement("div");s.style.cssText="display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:18px;margin-bottom:16px;padding:12px;border:1px solid var(--qpm-border);border-radius:8px;background:rgba(143,130,255,0.05);";const l=document.createElement("div");l.style.cssText="display:flex;flex-direction:column;gap:6px;max-width:240px;text-align:left;";const c=document.createElement("select");c.style.cssText="padding:8px 10px;border:1px solid var(--qpm-border);border-radius:6px;background:rgba(18,20,26,0.6);color:var(--qpm-text);font-size:13px;";const d=document.createElement("div");d.style.cssText="font-size:12px;color:var(--qpm-text-dim);text-transform:uppercase;letter-spacing:0.5px;",d.textContent="Ability filter";const u=Array.from(new Set(e.flatMap(e=>e.stats.abilities.map(e=>e.baseName||e.name.split(" ")[0])))).filter(Boolean).sort();c.appendChild(new Option("All abilities",""));const p=document.createElement("optgroup");p.label="‚îÅ‚îÅ‚îÅ Ability Groups ‚îÅ‚îÅ‚îÅ",Jg.forEach(e=>{const t=new Option(e.displayName,`group:${e.id}`);p.appendChild(t)}),c.appendChild(p);const m=document.createElement("optgroup");m.label="‚îÅ‚îÅ‚îÅ Individual Abilities ‚îÅ‚îÅ‚îÅ",u.forEach(e=>{const t=new Option(e,e?e.toLowerCase():"");m.appendChild(t)}),c.appendChild(m),c.addEventListener("change",()=>{r=c.value,a()}),l.appendChild(d),l.appendChild(c);const f=document.createElement("div");f.style.cssText="display:flex;justify-content:center;margin:0 0 12px;",f.appendChild(l);const g=(t,n,o)=>{const r=document.createElement("div");r.style.cssText="display:flex;flex-direction:column;gap:6px;flex:1;max-width:320px;";const i=document.createElement("div");i.textContent=t,i.style.cssText="font-size:12px;color:var(--qpm-text-dim);text-transform:uppercase;letter-spacing:0.5px;";const s=document.createElement("select");return s.style.cssText="\n      width: 100%;\n      padding: 10px 12px;\n      background: rgba(18, 20, 26, 0.6);\n      color: var(--qpm-text);\n      border: 1px solid var(--qpm-border);\n      border-radius: 6px;\n      font-size: 14px;\n      font-weight: 500;\n    ",e.forEach((e,t)=>{const o=document.createElement("option");o.value=t.toString(),o.textContent=`${e.stats.name||e.stats.species||"Pet"} [${e.stats.currentStrength??"?"} STR]`,t===n&&(o.selected=!0),s.appendChild(o)}),s.addEventListener("change",t=>{const n=Number(t.target.value);o(n),Zh(s,e[n]),a()}),Yh(s,e),Zh(s,e[n]),qh(s,()=>e),r.appendChild(i),r.appendChild(s),{wrap:r,select:s}},{wrap:h,select:b}=g("Pet A",n,t=>{n=t,n===o&&(o=(t+1)%e.length)}),{wrap:y,select:x}=g("Pet B",o,t=>{o=t,o===n&&(n=(t+1)%e.length)});return s.appendChild(h),s.appendChild(y),t.appendChild(f),t.appendChild(s),t.appendChild(i),a(),t}function ob(e,t,n,o){const r=document.createElement("div");r.style.cssText="\n    display: grid;\n    grid-template-columns: repeat(3, minmax(0, 1fr));\n    gap: 12px;\n    align-items: stretch;\n  ";const i=e?.stats??null,a=t?.stats??null,s=function(e,t){if(e&&!t)return"A";if(t&&!e)return"B";if(!e||!t)return null;const n=Number(e.currentStrength??0),o=Number(t.currentStrength??0);if(n!==o)return n>o?"A":"B";const r=Number(e.maxStrength??0),i=Number(t.maxStrength??0);if(r!==i)return r>i?"A":"B";const a=Number(e.abilityCount??e.abilities.length??0),s=Number(t.abilityCount??t.abilities.length??0);if(a!==s)return a>s?"A":"B";const l=Number(e.mutationCount??e.mutations.length??0),c=Number(t.mutationCount??t.mutations.length??0);if(l!==c)return l>c?"A":"B";const d=e=>[...e.abilities].sort((e,t)=>{const n=(t.valuePerHour||0)-(e.valuePerHour||0);return Math.abs(n)>1e-6?n:(t.procsPerHour||0)-(e.procsPerHour||0)})[0],u=d(e),p=d(t),m=u&&u.valuePerHour||0,f=p&&p.valuePerHour||0;if(m!==f)return m>f?"A":"B";const g=u&&u.procsPerHour||0,h=p&&p.procsPerHour||0;return g!==h?g>h?"A":"B":null}(i,a),l=(e,t)=>{const n=Number(e),o=Number(t);return Number.isFinite(n)&&Number.isFinite(o)&&n!==o?n>o?"A":"B":null};l(i?.currentStrength,a?.currentStrength),l(i?.maxStrength,a?.maxStrength),l(i?.xp,a?.xp),l(i?.abilityCount??i?.abilities.length,a?.abilityCount??a?.abilities.length),l(i?.mutationCount??i?.mutations.length,a?.mutationCount??a?.mutations.length);const c=document.createElement("div");c.style.cssText="\n    background: rgba(255,255,255,0.03);\n    border: 1px solid var(--qpm-border);\n    border-radius: 10px;\n    padding: 12px;\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    align-content: center;\n    text-align: center;\n    font-size: 12px;\n    color: var(--qpm-text);\n  ";const d=(e,t,n)=>{const o=t??"‚Äî",r=n??"‚Äî",i=Number(t),a=Number(n),s=Number.isFinite(i)&&Number.isFinite(a),l=s&&i>a,c=s&&a>i,d=s&&i<a,u=s&&a<i,p="rgba(143,130,255,0.08)",m="#C9F1FF",f="#F7E5FF";return`\n      <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px;">\n        <div style="background:${p};padding:6px;border-radius:6px;${l?`box-shadow:0 0 0 1px ${dh};background:${ch};`:d?"box-shadow:0 0 0 1px var(--qpm-error);background:rgba(244,67,54,0.08);":""}">\n          <div style="font-size:10px;color:${m};">${e}</div>\n          <div style="font-weight:700;color:${l?"rgb(64, 255, 194)":d?"var(--qpm-error)":m};">${o}</div>\n        </div>\n        <div style="background:${p};padding:6px;border-radius:6px;${c?`box-shadow:0 0 0 1px ${dh};background:${ch};`:u?"box-shadow:0 0 0 1px var(--qpm-error);background:rgba(244,67,54,0.08);":""}">\n          <div style="font-size:10px;color:${f};">${e}</div>\n          <div style="font-weight:700;color:${c?"rgb(64, 255, 194)":u?"var(--qpm-error)":f};">${r}</div>\n        </div>\n      </div>\n    `},u=e=>e?.effectiveProbability??e?.probability??e?.procChance??null,p=e=>e?.procsPerHour??e?.procs??null,m=e=>e?.valuePerHour??e?.effectiveValue??e?.gardenValuePerProc??e?.value??null,f=(e,t)=>{const n=l(m(e),m(t));if(n)return n;const o=l(p(e),p(t));return o||l(u(e),u(t))},g=e=>{if(!e)return null;return(e.baseName||e.name).replace(/\s+(I|II|III|IV|V)$/i,"").trim()},h=i?.species??null,b=a?.species??null,y=h&&b&&h!==b,x=e=>{if(!e)return null;let t=e.stats.abilities;if(o.trim())if(o.startsWith("group:")){const n=o.substring(6);t=e.stats.abilities.filter(e=>{const t=Yg(e.id);return t&&t.id===n})}else t=e.stats.abilities.filter(e=>e.name.toLowerCase().includes(o.toLowerCase())||(e.baseName||"").toLowerCase().includes(o.toLowerCase()));return[...t].sort((e,t)=>{const n=(t.valuePerHour||0)-(e.valuePerHour||0);return Math.abs(n)>1e-6?n:(t.procsPerHour||0)-(e.procsPerHour||0)})[0]??null};let w=null,v=null,C=!1,T=!1,S=null,P=[];if(y&&e&&t){const n=e=>{if(!o.trim())return e;if(o.startsWith("group:")){const t=o.substring(6);return e.filter(e=>{const n=Yg(e.id);return n&&n.id===t})}return e.filter(e=>e.name.toLowerCase().includes(o.toLowerCase())||(e.baseName||"").toLowerCase().includes(o.toLowerCase()))},r=n(e.stats.abilities),i=n(t.stats.abilities);let a=!1;for(const e of r){const t=g(e);if(t){for(const n of i){const o=g(n);if(o&&t===o){w=e,v=n,C=!0,a=!0;break}}if(a)break}}if(!a){for(const e of r){const t=Yg(e.id);if(t)for(const n of i){const o=Yg(n.id);o&&t.id===o.id&&(P.push({abilityA:e,abilityB:n}),w&&v||(w=e,v=n,S=t,T=!0))}}P.length>0&&(a=!0)}a||(w=x(e),v=x(t))}else w=x(e),v=x(t);let A=null,k=null,E=null,$=null;if(y&&C){const e=Km(h),t=Km(b);e&&e>0&&(A=e/60),t&&t>0&&(k=t/60);const n=h?Ep(h):null,o=b?Ep(b):null,r=w?w.valuePerHour&&w.valuePerHour>0?w.valuePerHour:w.procsPerHour&&w.effectiveValue?w.procsPerHour*w.effectiveValue:null:null,i=v?v.valuePerHour&&v.valuePerHour>0?v.valuePerHour:v.procsPerHour&&v.effectiveValue?v.procsPerHour*v.effectiveValue:null:null;n&&r&&r>0&&(E=n/r),o&&i&&i>0&&($=o/i)}const M=(e,t="",n=!1,o=!1,r=!1,i="left")=>{if(!e)return'<div style="color:var(--qpm-text-dim);font-size:11px;">No proc data</div>';const{valueText:a,procsText:s,probText:l}=Zg(e),c="rgb(64, 255, 194)",d="left"===i?"#C9F1FF":"#F7E5FF",u=n?c:d,p=o?c:d,m=r?c:d,f=n||o||r;return`\n      <div style="display:flex;flex-direction:column;gap:4px;font-size:11px;color:${d};padding:8px;border:1px solid ${f?dh:"var(--qpm-border)"};border-radius:8px;background:${f?ch:"rgba(255,255,255,0.02)"};text-align:left;">\n        <div style="font-weight:700;">${t||e.name}</div>\n        <div style="display:flex;justify-content:space-between;"><span style="color:var(--qpm-text-dim);">Proc %</span><span style="font-weight:700;color:${u};">${l}</span></div>\n        <div style="display:flex;justify-content:space-between;"><span style="color:var(--qpm-text-dim);">Procs/Hr</span><span style="font-weight:700;color:${p};">${s}</span></div>\n        <div style="display:flex;justify-content:space-between;"><span style="color:var(--qpm-text-dim);">Impact</span><span style="font-weight:700;color:${m};">${a}</span></div>\n      </div>\n    `},F=i&&(i.currentStrength??0)<(i.maxStrength??0)||a&&(a.currentStrength??0)<(a.maxStrength??0),I=w&&i?eh(w,i.currentStrength,i.maxStrength):null,L=v&&a?eh(v,a.currentStrength,a.maxStrength):null,z=l(u(w),u(v)),N=l(p(w),p(v)),q=l(m(w),m(v)),B=f(w,v),R=l(u(I),u(L)),D=l(p(I),p(L)),H=l(m(I),m(L)),j=f(I,L),W=rb(e,n,"A"===s,o,"left",{}),G=rb(t,n,"B"===s,o,"right",{}),O=F?`\n      <div style="margin-top:4px;padding:8px;border:1px dashed var(--qpm-border);border-radius:8px;background:rgba(143,130,255,0.05);">\n        <div style="font-size:11px;color:var(--qpm-text-dim);margin-bottom:6px;">Potential ability output at max STR</div>\n        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">\n          <div>${M(I,I?`${I.name} (max)`:"","A"===R||"A"===j,"A"===D||"A"===j,"A"===H||"A"===j,"left")}</div>\n          <div>${M(L,L?`${L.name} (max)`:"","B"===R||"B"===j,"B"===D||"B"===j,"B"===H||"B"===j,"right")}</div>\n        </div>\n      </div>\n    `:"",V=y&&C?`\n    <div style="margin-top:8px;padding:8px;border:1px dashed rgba(255,193,7,0.5);border-radius:8px;background:rgba(255,193,7,0.05);">\n      <div style="font-size:11px;color:rgba(255,193,7,0.9);margin-bottom:6px;font-weight:600;">üìä Cross-Species Comparison</div>\n      ${null!=A&&null!=k?d("Hunger Lifespan (h)",A.toFixed(1),k.toFixed(1)):""}\n      ${null!=E&&null!=$?d("Time/Level (h)",E.toFixed(2),$.toFixed(2)):""}\n    </div>\n  `:"",_=y&&T&&S?(()=>{const e=P.map(e=>{const t=function(e,t,n,o){const r=Yg(e.id),i=Yg(t.id);if(!r||!i||r.id!==i.id)return null;const a=r.calculateComparableValue(e,n),s=i.calculateComparableValue(t,o);let l=null;return null!=a&&null!=s&&(a>s?l="A":s>a&&(l="B")),{abilityA:e,abilityB:t,group:r,valueA:a,valueB:s,winner:l,comparisonLabel:"value_per_hour"===r.comparisonMetric?"üí∞ Value/Hour":"garden_impact"===r.comparisonMetric?"üåø Garden Impact/Hour":"‚ö° Procs/Hour"}}(e.abilityA,e.abilityB,i?.currentStrength??null,a?.currentStrength??null);if(!t)return"";const n="crop_harvest_value"===t.group.id,o=e=>null==e?"‚Äî":n?`${Kg(e)}/proc`:Kg(e),r="A"===t.winner,s="B"===t.winner;return`\n        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:6px;">\n          <div style="padding:6px;border-radius:6px;background:rgba(143,130,255,0.08);${r?"box-shadow:0 0 0 1px rgb(64,255,194);background:rgba(64,255,194,0.1);":""}">\n            <div style="font-size:10px;color:#C9F1FF;font-weight:600;">${e.abilityA.name}</div>\n            <div style="font-size:11px;color:${r?"rgb(64,255,194)":"#fff"};font-weight:${r?"700":"400"};">${o(t.valueA)}</div>\n          </div>\n          <div style="padding:6px;border-radius:6px;background:rgba(143,130,255,0.08);${s?"box-shadow:0 0 0 1px rgb(64,255,194);background:rgba(64,255,194,0.1);":""}">\n            <div style="font-size:10px;color:#F7E5FF;font-weight:600;">${e.abilityB.name}</div>\n            <div style="font-size:11px;color:${s?"rgb(64,255,194)":"#fff"};font-weight:${s?"700":"400"};">${o(t.valueB)}</div>\n          </div>\n        </div>\n      `}).join("");return`\n      <div style="margin-top:8px;padding:8px;border:1px dashed rgba(100,200,255,0.5);border-radius:8px;background:rgba(100,200,255,0.05);">\n        <div style="font-size:11px;color:rgba(100,200,255,0.9);margin-bottom:6px;font-weight:600;">üîÑ Cross-Ability Comparison: ${S.displayName}</div>\n        <div style="font-size:10px;color:var(--qpm-text-dim);margin-bottom:6px;">${S.description}</div>\n        ${e}\n      </div>\n    `})():"";return c.innerHTML=`\n    <div style="font-size: 13px; font-weight: 700; color: var(--qpm-accent);">Duel Metrics</div>\n    ${d("Strength",i?.currentStrength,a?.currentStrength)}\n    ${d("Max STR",i?.maxStrength,a?.maxStrength)}\n    <div style="background:rgba(255,255,255,0.02);border:1px solid var(--qpm-border);padding:8px;border-radius:8px;display:grid;grid-template-columns:1fr 1fr;gap:8px;text-align:left;">\n      <div>${M(w,"","A"===z||"A"===B,"A"===N||"A"===B,"A"===q||"A"===B,"left")}</div>\n      <div>${M(v,"","B"===z||"B"===B,"B"===N||"B"===B,"B"===q||"B"===B,"right")}</div>\n    </div>\n    ${V}\n    ${_}\n    ${O}\n  `,r.appendChild(W),r.appendChild(c),r.appendChild(G),r}function rb(e,t,n,o,r,i={}){const a=document.createElement("div"),s=oh[r],l=n?"rgba(64,255,194,0.9)":s.border,c=n?"0 0 22px rgba(64,255,194,0.45)":s.glow;if(a.dataset.slot=String(t+1),a.style.cssText=`\n    background: ${s.gradient};\n    border: 1px solid ${l};\n    border-radius: 16px;\n    padding: 16px;\n    min-height: 220px;\n    box-shadow: ${c};\n    position: relative;\n    overflow: hidden;\n  `,!e)return a.innerHTML='\n      <div style="font-size: 13px; font-weight: 600; color: var(--qpm-text-dim); text-align: center;">\n        Empty Slot\n      </div>\n    ',a;const d=e.stats;var u;(u=d.species??null)&&_g.get(Ug(u));const p=d.hungerPct??null,m=d.species?Ep(d.species):null,f=d.xp??0,g=m?f%m:0,h=m&&m>0?g/m*100:0,b=m?`${g.toFixed(0)} / ${m} XP`:"‚Äî",y=p;let x=null;if(d.species&&null!=p){const e=Km(d.species);null!=e&&(x=p/100*(e/60))}const w=[];null!=y&&w.push(`${y.toFixed(0)}%`),null!=x&&w.push(`${x.toFixed(1)}h left`);const v=w.join(" ‚Ä¢ ")||"‚Äî",C=null!=d.maxStrength&&null!=d.currentStrength?Math.max(0,d.maxStrength-d.currentStrength):null,T=d.maxStrength&&d.currentStrength?Math.max(0,d.maxStrength-d.currentStrength)/Math.max(1,d.maxStrength/30):null,S=m&&T?Math.round(T*m):null;C&&C>0?S&&Xg(S):null!=d.xp&&Xg(d.xp);const P=o.trim().toLowerCase();[...P?d.abilities.filter(e=>e.name.toLowerCase().includes(P)||(e.baseName||"").toLowerCase().includes(P)):d.abilities].sort((e,t)=>{const n=(t.valuePerHour||0)-(e.valuePerHour||0);return Math.abs(n)>.01?n:(t.procsPerHour||0)-(e.procsPerHour||0)}).slice(0,3).map(e=>{const{valueText:t,procsText:n,probText:o}=Zg(e),r=function(e){if(!e)return th.default;const t=e.category??"";if(t&&Object.prototype.hasOwnProperty.call(th,t))return th[t];const n=(e.baseName??e.name).toLowerCase();return n.includes("rainbow")?th.rainbow:n.includes("gold")?th.gold:n.includes("hunger")?th.hunger:n.includes("mutation")?th.mutation:th.default}(e);return`\n      <div style="display:flex;align-items:center;gap:10px;padding:10px;border-radius:12px;background:rgba(8,5,16,0.45);border:1px solid ${r.border};box-shadow:0 0 14px ${r.glow};">\n        <span style="width:18px;height:18px;border-radius:6px;background:${r.base};border:1px solid rgba(255,255,255,0.15);"></span>\n        <div style="flex:1;">\n          <div style="font-size:12px;font-weight:600;color:${r.text};">${e.name}</div>\n          <div style="font-size:10px;color:var(--qpm-text-dim);">${t}</div>\n        </div>\n        <div style="text-align:right;font-size:10px;color:var(--qpm-text-dim);">\n          <div style="font-weight:600;color:${r.text};">${n}</div>\n          <div>${o} proc</div>\n        </div>\n      </div>\n    `}).join("");const A=d.abilities.slice(0,4).map(e=>({color:nh(e.baseName||e.name),name:e.name||"Unknown Ability"})),k=`\n    <div style="display:flex;flex-direction:column;gap:10px;width:100%;">\n      ${rh("XP/Level",b,h,"#7C4DFF")}\n      ${rh("Hunger",v,y,"#9BF5C3")}\n    </div>\n  `,E=`\n    <div style="position:relative;display:flex;flex-direction:column;align-items:center;gap:8px;width:100%;padding:8px 0;">\n      \x3c!-- STR text above image --\x3e\n      <div style="font-size:13px;font-weight:600;color:${s.text};">\n        STR: ${null!=d.currentStrength?d.currentStrength.toFixed(0):"?"}\n      </div>\n\n      \x3c!-- Pet image centered --\x3e\n      <div style="position:relative;display:flex;justify-content:center;">\n        ${tb(d,128,!1)}\n\n        \x3c!-- Ability squares positioned to the left of pet image --\x3e\n        <div class="qpm-ability-squares" style="position:absolute;left:-30px;top:50%;transform:translateY(-50%);display:flex;flex-direction:column;gap:6px;"></div>\n      </div>\n\n      \x3c!-- MAX STR text below image --\x3e\n      <div style="font-size:13px;font-weight:600;color:${s.text};">\n        MAX STR: ${null!=d.maxStrength?d.maxStrength.toFixed(0):"?"}\n      </div>\n    </div>\n  `;a.innerHTML=`\n    <div style="display:flex;flex-direction:column;align-items:center;gap:12px;text-align:center;">\n      <div>\n        <div style="font-size:16px;font-weight:700;color:${s.text};">${d.name||d.species||"Pet"}</div>\n        <div style="font-size:12px;color:rgba(255,255,255,0.7);">${d.species||"Unknown Species"}</div>\n      </div>\n      ${E}\n      ${k}\n    </div>\n  `;const $=a.querySelector(".qpm-ability-squares");return $&&A.forEach(({color:e,name:t})=>{const n=document.createElement("div");n.style.cssText=`\n        width: 20px;\n        height: 20px;\n        background: ${e};\n        border-radius: 4px;\n        border: 1px solid rgba(255, 255, 255, 0.4);\n        cursor: help;\n        transition: all 0.2s;\n      `,n.title=t,n.addEventListener("mouseenter",()=>{n.style.transform="scale(1.15)",n.style.borderColor="rgba(255,255,255,0.8)"}),n.addEventListener("mouseleave",()=>{n.style.transform="scale(1)",n.style.borderColor="rgba(255,255,255,0.4)"}),$.appendChild(n)}),a}function ib(e){const t=document.createElement("div");if(e.length<2)return t.innerHTML='<div style="padding:20px;color:var(--qpm-text-dim);">Need more pets for 3v3 teams.</div>',t;const n=function(e){const t=new Map,n=(e,n)=>{const o=zh(e);o&&!t.has(o)&&t.set(o,n)};return e.forEach(e=>{n(e.stats.petId,e),n(e.petInfo?.petId??null,e),n(e.petInfo?.slotId??null,e);const t=e.petInfo?.raw;if(t){n(t.id,e),n(t.petId,e),n(t.slotId,e);const o=t.slot;o&&(n(o.id,e),n(o.petId,e),n(o.slotId,e))}}),t}(e),o=[e[0]??null,e[1]??null,e[2]??null],r=[e[3]??null,e[4]??null,e[5]??null];let i="";const a=document.createElement("div");a.style.cssText="\n    display: grid;\n    grid-template-columns: repeat(2, minmax(0, 1fr));\n    gap: 10px;\n    margin-bottom: 14px;\n  ";const l=(t,n,o)=>{const r=document.createElement("div");r.style.cssText="\n      border: 1px solid var(--qpm-border);\n      border-radius: 8px;\n      padding: 10px;\n      background: rgba(143, 130, 255, 0.05);\n    ";const a=document.createElement("div");a.textContent=t,a.style.cssText="font-weight:700;color:var(--qpm-accent);margin-bottom:6px;";const s=document.createElement("div");return s.style.cssText="display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:6px;",n.forEach((t,r)=>{const a=document.createElement("select");a.style.cssText="\n        width: 100%;\n        padding: 8px;\n        background: rgba(18, 20, 26, 0.6);\n        color: var(--qpm-text);\n        border: 1px solid var(--qpm-border);\n        border-radius: 6px;\n        font-size: 12px;\n      ",a.dataset.slot=String(r);const l=()=>{const o=a.value;if(a.innerHTML="",e.forEach((e,n)=>{if(i)if(i.startsWith("group:")){const t=i.substring(6);if(!e.stats.abilities.some(e=>{const n=Yg(e.id);return n&&n.id===t}))return}else if(!e.stats.abilities.some(e=>(e.baseName||"").toLowerCase().includes(i.toLowerCase())||e.name.toLowerCase().includes(i.toLowerCase())))return;const o=document.createElement("option");o.value=n.toString(),o.textContent=`${e.stats.name||e.stats.species||"Pet"} [${e.stats.currentStrength??"?"} STR]`,e!==t||a.value||(o.selected=!0),a.appendChild(o)}),Yh(a,e),Array.from(a.options).some(e=>e.value===o))a.value=o;else if(a.options.length){a.selectedIndex=0;const t=Number(a.value);n[r]=e[t]??null}Zh(a,n[r])};l(),a.addEventListener("change",t=>{const i=[...n],s=Number(t.target.value);i[r]=e[s]??null,o(i),Zh(a,i[r]),T()}),a.dataset.rebuild="1",a._rebuild=l,qh(a,()=>e),s.appendChild(a)}),r.appendChild(a),r.appendChild(s),r};let c;a.appendChild(l("üîµ Team A",o,e=>{o.splice(0,o.length,...e)})),a.appendChild(l("üî¥ Team B",r,e=>{r.splice(0,r.length,...e)}));const d=(e,t)=>{const o=[],r=[];e.slotIds.forEach((e,t)=>{if(!e)return void(o[t]=null);const i=n.get(e)??null;i||r.push(t+1),o[t]=i}),t.splice(0,t.length,...o),r.length?(c.textContent=`Applied "${e.name}" but slots ${r.join(", ")} are missing in Pet Hub data.`,c.style.color="var(--qpm-error)"):(c.textContent=`‚úÖ Applied "${e.name}" preset.`,c.style.color="var(--qpm-success)"),T()},u=(e,t)=>{let n=[];const o=document.createElement("div");o.style.cssText="display:flex;flex-direction:column;gap:4px;";const r=document.createElement("div");r.textContent=e,r.style.cssText="font-size:12px;font-weight:600;color:var(--qpm-accent);";const i=document.createElement("select");i.style.cssText="padding:6px 10px;border:1px solid var(--qpm-border);border-radius:6px;background:rgba(18,20,26,0.6);color:var(--qpm-text);font-size:13px;",i.disabled=!0,i.appendChild(new Option("No presets detected","")),i.addEventListener("change",()=>{const e=n.find(e=>e.id===i.value);e&&(t(e),i.value="")});return o.append(r,i),{wrapper:o,updateOptions:e=>{n=e,i.innerHTML="",i.appendChild(new Option("Select preset","")),e.length?(e.forEach(e=>{i.appendChild(new Option(e.name,e.id))}),i.disabled=!1):i.disabled=!0}}},p=document.createElement("div");p.style.cssText="display:none;flex-direction:column;gap:10px;margin-bottom:12px;padding:10px;border:1px solid var(--qpm-border);border-radius:10px;background:rgba(143,130,255,0.08);";const m=document.createElement("div");m.style.cssText="display:flex;align-items:center;justify-content:space-between;";const f=document.createElement("div");f.textContent="üîó Aries Mod Presets",f.style.cssText="font-size:13px;font-weight:700;color:var(--qpm-accent);";const g=document.createElement("button");g.textContent="üîÑ Refresh",g.style.cssText="padding:4px 8px;font-size:11px;background:rgba(143,130,255,0.2);color:var(--qpm-accent);border:1px solid var(--qpm-border);border-radius:4px;cursor:pointer;",g.title="Manually retry detection of Aries Mod",g.addEventListener("click",()=>{s("[Aries] Manual refresh triggered"),Ah=!1,kh=null,null!=Eh&&(window.clearTimeout(Eh),Eh=null),$h()}),m.append(f,g),c=document.createElement("div"),c.style.cssText="font-size:11px;color:var(--qpm-text-dim);",c.textContent="Detecting Aries Mod teams...";const h=document.createElement("div");h.style.cssText="display:grid;grid-template-columns:repeat(auto-fit, minmax(220px,1fr));gap:10px;";const b=u("Apply to Team A",e=>d(e,o)),y=u("Apply to Team B",e=>d(e,r));h.append(b.wrapper,y.wrapper),p.append(m,c,h);var x;Nh(t,(x=({status:e,teams:t})=>{"ready"===e&&t.length>0?(p.style.display="flex",c.textContent=`‚úÖ Found ${t.length} preset(s). Select one to populate team slots automatically.`,c.style.color="var(--qpm-success)",b.updateOptions(t),y.updateOptions(t),h.style.display="grid"):"ready"===e&&0===t.length?(p.style.display="flex",c.textContent="‚ö†Ô∏è No pet teams found in Aries Mod. Create teams first.",c.style.color="var(--qpm-warning)",h.style.display="none"):p.style.display="none"},Th.add(x),x({status:Ph,teams:Sh}),$h(),()=>{Th.delete(x)}));const w=document.createElement("div");w.style.cssText="display:grid;grid-template-columns:1fr;gap:12px;";const v=()=>{const e=document.createDocumentFragment();for(let t=0;t<3;t++){const n=ob(o[t]??null,r[t]??null,t,i);e.appendChild(n)}for(;w.firstChild;)w.removeChild(w.firstChild);w.appendChild(e),bh(w)};let C=null;const T=()=>{null!=C&&window.clearTimeout(C),C=window.setTimeout(()=>{C=null,v()},50)},S=document.createElement("div");S.style.cssText="display:flex;flex-direction:column;gap:6px;align-items:center;text-align:center;";const P=document.createElement("div");P.textContent="Ability filter",P.style.cssText="font-size:12px;color:var(--qpm-text-dim);text-transform:uppercase;letter-spacing:0.5px;";const A=document.createElement("select");A.style.cssText="padding:6px 10px;border:1px solid var(--qpm-border);border-radius:6px;background:rgba(18,20,26,0.6);color:var(--qpm-text);font-size:13px;width:220px;",A.appendChild(new Option("All abilities",""));const k=document.createElement("optgroup");k.label="‚îÅ‚îÅ‚îÅ Ability Groups ‚îÅ‚îÅ‚îÅ",Jg.forEach(e=>{const t=new Option(e.displayName,`group:${e.id}`);k.appendChild(t)}),A.appendChild(k);const E=Array.from(new Set(e.flatMap(e=>e.stats.abilities.map(e=>e.baseName||e.name.split(" ")[0])))).filter(e=>Boolean(e)).sort(),$=document.createElement("optgroup");$.label="‚îÅ‚îÅ‚îÅ Individual Abilities ‚îÅ‚îÅ‚îÅ",E.forEach(e=>{const t=new Option(e,e.toLowerCase());$.appendChild(t)}),A.appendChild($),A.addEventListener("change",()=>{i=A.value.trim(),a.querySelectorAll('select[data-rebuild="1"]').forEach(e=>{const t=e._rebuild;"function"==typeof t&&t()}),T()}),S.appendChild(P),S.appendChild(A);const M=document.createElement("div");return M.style.cssText="display:flex;justify-content:center;margin-bottom:12px;",M.appendChild(S),t.appendChild(M),t.appendChild(p),t.appendChild(a),t.appendChild(w),v(),t}window.__QPM__=window.__QPM__||{},window.__QPM__.getAtomByLabel=F;const ab=Object.freeze(Object.defineProperty({__proto__:null,renderPetHubWindow:function(e){e.innerHTML="",e.style.cssText="\n    padding: 0;\n    min-height: 400px;\n  ",e.innerHTML='<div style="padding: 40px; text-align: center; color: var(--qpm-text-dim);">Loading pets...</div>',eb().then(t=>{e.innerHTML="",0!==t.length?function(e,t){const n=document.createElement("div");n.style.cssText="\n    display: flex;\n    border-bottom: 1px solid var(--qpm-border);\n    background: rgba(143, 130, 255, 0.05);\n  ";const o=document.createElement("div");o.style.cssText="\n    padding: 20px;\n    overflow-y: auto;\n    max-height: 75vh;\n    min-width: 1080px;\n  ";let r="compare";const i=(e,t,o)=>{const i=document.createElement("button");i.textContent=`${o} ${t}`;return(()=>{const t=r===e;i.style.cssText=`\n        flex: 1;\n        padding: 14px 20px;\n        background: ${t?"rgba(143, 130, 255, 0.15)":"transparent"};\n        color: ${t?"var(--qpm-accent)":"var(--qpm-text-dim)"};\n        border: none;\n        border-bottom: 2px solid ${t?"var(--qpm-accent)":"transparent"};\n        font-size: 14px;\n        font-weight: 600;\n        cursor: pointer;\n        transition: all 0.2s;\n      `})(),i.addEventListener("click",()=>{r=e,Array.from(n.children).forEach(e=>{const t=e;t.style.background=t===i?"rgba(143,130,255,0.15)":"transparent",t.style.color=t===i?"var(--qpm-accent)":"var(--qpm-text-dim)",t.style.borderBottom=t===i?"2px solid var(--qpm-accent)":"2px solid transparent"}),a()}),i},a=()=>{o.innerHTML="";if("team"===r&&t.length>10){const e=document.createElement("div");e.style.cssText="padding:40px;text-align:center;color:var(--qpm-text-dim);",e.textContent="‚è≥ Loading...",o.appendChild(e),requestAnimationFrame(()=>{o.innerHTML="","compare"===r?o.appendChild(nb(t)):"team"===r&&o.appendChild(ib(t)),bh(o)})}else"compare"===r?o.appendChild(nb(t)):"team"===r&&o.appendChild(ib(t)),bh(o)};n.appendChild(i("compare","1v1 Compare","‚öñÔ∏è")),n.appendChild(i("team","3v3 Compare","üë•")),e.appendChild(n),e.appendChild(o),a(),Nh(e,()=>{Dh(!0),null!=Eh&&(window.clearTimeout(Eh),Eh=null),mh.clear(),fh.clear(),gh=0,hh=!1})}(e,t):e.innerHTML='\n        <div style="padding: 60px; text-align: center; color: var(--qpm-text-dim);">\n          <div style="font-size: 48px; margin-bottom: 12px;">üêæ</div>\n          <div style="font-size: 16px; font-weight: 600;">No Pets Found</div>\n          <div style="font-size: 13px;">Hatch or place some pets to use the Pet Hub.</div>\n        </div>\n      '}).catch(t=>{s("Failed to load pets:",t),e.innerHTML=`\n      <div style="padding: 40px; text-align: center; color: var(--qpm-error);">\n        <div style="font-size: 48px; margin-bottom: 15px;">‚ö†Ô∏è</div>\n        <div style="font-size: 16px; font-weight: 600; margin-bottom: 8px;">Failed to Load Pets</div>\n        <div style="font-size: 13px; color: var(--qpm-text-dim);">${t}</div>\n      </div>\n    `})}},Symbol.toStringTag,{value:"Module"}))}();

})();